---
title: Używanie wzorców w obiektach — samouczek języka C#
description: W tym samouczku przedstawiono techniki używania dopasowania wzorca w składowych klasy do tworzenia lepszych modeli dla zachowań obiektów
ms.date: 11/05/2020
ms.openlocfilehash: 072f6f57696504c2d691473e3a43c1cda53f227f
ms.sourcegitcommit: 6bef8abde346c59771a35f4f76bf037ff61c5ba3
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/06/2020
ms.locfileid: "94332192"
---
# <a name="use-pattern-matching-to-build-your-class-behavior-for-better-code"></a><span data-ttu-id="8b08a-103">Użyj dopasowania wzorca, aby utworzyć zachowanie klasy dla lepszego kodu</span><span class="sxs-lookup"><span data-stu-id="8b08a-103">Use pattern matching to build your class behavior for better code</span></span>

<span data-ttu-id="8b08a-104">Funkcje dopasowania wzorców w języku C# zapewniają składnię do wyrażania algorytmów.</span><span class="sxs-lookup"><span data-stu-id="8b08a-104">The pattern matching features in C# provide syntax to express your algorithms.</span></span> <span data-ttu-id="8b08a-105">Za pomocą tych technik można zaimplementować zachowanie w klasach.</span><span class="sxs-lookup"><span data-stu-id="8b08a-105">You can use these techniques to implement the behavior in your classes.</span></span> <span data-ttu-id="8b08a-106">Można połączyć projekt klasy zorientowany obiektowo z implementacją zorientowaną na dane, aby zapewnić zwięzły kod podczas modelowania rzeczywistych obiektów.</span><span class="sxs-lookup"><span data-stu-id="8b08a-106">You can combine object-oriented class design with a data-oriented implementation to provide concise code while modeling real-world objects.</span></span>

<span data-ttu-id="8b08a-107">Z tego samouczka dowiesz się, jak wykonywać następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="8b08a-107">In this tutorial, you'll learn how to:</span></span>

> [!div class="checklist"]
>
> - <span data-ttu-id="8b08a-108">Wyrażaj klasy zorientowane obiektowo przy użyciu wzorców danych.</span><span class="sxs-lookup"><span data-stu-id="8b08a-108">Express your object oriented classes using data patterns.</span></span>
> - <span data-ttu-id="8b08a-109">Zaimplementuj te wzorce przy użyciu funkcji dopasowania do wzorca języka C#.</span><span class="sxs-lookup"><span data-stu-id="8b08a-109">Implement those patterns using C#'s pattern matching features.</span></span>
> - <span data-ttu-id="8b08a-110">Aby sprawdzić poprawność implementacji, Skorzystaj z diagnostyki kompilatora.</span><span class="sxs-lookup"><span data-stu-id="8b08a-110">Leverage compiler diagnostics to validate your implementation.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="8b08a-111">Wymagania wstępne</span><span class="sxs-lookup"><span data-stu-id="8b08a-111">Prerequisites</span></span>

<span data-ttu-id="8b08a-112">Musisz skonfigurować maszynę do uruchamiania programu .NET 5, w tym kompilatora C# 9,0.</span><span class="sxs-lookup"><span data-stu-id="8b08a-112">You’ll need to set up your machine to run .NET 5, including the C# 9.0 compiler.</span></span> <span data-ttu-id="8b08a-113">Kompilator języka C# 9,0 jest dostępny w programie [Visual Studio 2019 w 16,8 wersji zapoznawczej](https://visualstudio.microsoft.com/vs/preview/) lub [programie .NET 5,0 SDK Preview](https://dotnet.microsoft.com/download/dotnet/5.0).</span><span class="sxs-lookup"><span data-stu-id="8b08a-113">The C# 9.0 compiler is available starting with [Visual Studio 2019 version 16.8 preview](https://visualstudio.microsoft.com/vs/preview/) or the [.NET 5.0 SDK preview](https://dotnet.microsoft.com/download/dotnet/5.0).</span></span>

## <a name="build-a-simulation-of-a-canal-lock"></a><span data-ttu-id="8b08a-114">Tworzenie symulacji blokady kanału</span><span class="sxs-lookup"><span data-stu-id="8b08a-114">Build a simulation of a canal lock</span></span>

<span data-ttu-id="8b08a-115">W tym samouczku utworzysz klasę języka C#, która symuluje [blokadę kanału](https://en.wikipedia.org/wiki/Lock_(water_navigation)).</span><span class="sxs-lookup"><span data-stu-id="8b08a-115">In this tutorial, you'll build a C# class that simulates a [canal lock](https://en.wikipedia.org/wiki/Lock_(water_navigation)).</span></span> <span data-ttu-id="8b08a-116">Krótko, blokada kanału to urządzenie, które podnosi i obniża liczbę łodzi, gdy podróżują między dwoma rozciągami się wodą na różnych poziomach.</span><span class="sxs-lookup"><span data-stu-id="8b08a-116">Briefly, a canal lock is a device that raises and lowers boats as they travel between two stretches of water at different levels.</span></span> <span data-ttu-id="8b08a-117">Blokada ma dwie bramy i pewne mechanizmy zmiany poziomu wody.</span><span class="sxs-lookup"><span data-stu-id="8b08a-117">A lock has two gates and some mechanism to change the water level.</span></span>

<span data-ttu-id="8b08a-118">W normalnej operacji jednostka pływająca wchodzi w skład jednej z bram, podczas gdy poziom wody w blokadzie dopasowuje poziom wody po stronie.</span><span class="sxs-lookup"><span data-stu-id="8b08a-118">In its normal operation, a boat enters one of the gates while the water level in the lock matches the water level on the side the boat enters.</span></span> <span data-ttu-id="8b08a-119">Po zablokowaniu poziom wody zostanie zmieniony w celu dopasowania do poziomu wody, w którym łódź opuści blokadę.</span><span class="sxs-lookup"><span data-stu-id="8b08a-119">Once in the lock, the water level is changed to match the water level where the boat will leave the lock.</span></span> <span data-ttu-id="8b08a-120">Po dopasowaniu poziomu wody do tej strony zostanie otwarta brama po stronie zamykania.</span><span class="sxs-lookup"><span data-stu-id="8b08a-120">Once the water level matches that side, the gate on the exit side opens.</span></span> <span data-ttu-id="8b08a-121">Środki bezpieczeństwa upewnij się, że operator nie może utworzyć niebezpiecznej sytuacji w obszarze kanału.</span><span class="sxs-lookup"><span data-stu-id="8b08a-121">Safety measures make sure an operator can't create a dangerous situation in the canal.</span></span> <span data-ttu-id="8b08a-122">Poziom wody można zmienić tylko wtedy, gdy obie bramy są zamknięte.</span><span class="sxs-lookup"><span data-stu-id="8b08a-122">The water level can be changed only when both gates are closed.</span></span> <span data-ttu-id="8b08a-123">Można otworzyć co najwyżej jedną bramę.</span><span class="sxs-lookup"><span data-stu-id="8b08a-123">At most one gate can be open.</span></span> <span data-ttu-id="8b08a-124">Aby otworzyć bramę, poziom wody w blokadzie musi pasować do poziomu wody poza otwartą bramą.</span><span class="sxs-lookup"><span data-stu-id="8b08a-124">To open a gate, the water level in the lock must match the water level outside the gate being opened.</span></span>

<span data-ttu-id="8b08a-125">Aby modelować to zachowanie, można utworzyć klasę języka C#.</span><span class="sxs-lookup"><span data-stu-id="8b08a-125">You can build a C# class to model this behavior.</span></span> <span data-ttu-id="8b08a-126">`CanalLock`Klasa może obsługiwać polecenia otwierania lub zamykania jednej bramy.</span><span class="sxs-lookup"><span data-stu-id="8b08a-126">A `CanalLock` class would support commands to open or close either gate.</span></span> <span data-ttu-id="8b08a-127">Inne polecenia mogą podnieść lub obniżyć wodę.</span><span class="sxs-lookup"><span data-stu-id="8b08a-127">It would have other commands to raise or lower the water.</span></span> <span data-ttu-id="8b08a-128">Klasa powinna również obsługiwać właściwości, aby odczytać bieżący stan obu bram i poziomu wody.</span><span class="sxs-lookup"><span data-stu-id="8b08a-128">The class should also support properties to read the current state of both gates and the water level.</span></span> <span data-ttu-id="8b08a-129">Metody implementują środki bezpieczeństwa.</span><span class="sxs-lookup"><span data-stu-id="8b08a-129">Your methods implement the safety measures.</span></span>

## <a name="define-a-class"></a><span data-ttu-id="8b08a-130">Definiowanie klasy</span><span class="sxs-lookup"><span data-stu-id="8b08a-130">Define a class</span></span>

<span data-ttu-id="8b08a-131">Utworzysz aplikację konsolową w celu przetestowania `CanalLock` klasy.</span><span class="sxs-lookup"><span data-stu-id="8b08a-131">You'll build a console application to test your `CanalLock` class.</span></span> <span data-ttu-id="8b08a-132">Utwórz nowy projekt konsoli dla platformy .NET 5 przy użyciu programu Visual Studio lub interfejsu wiersza polecenia platformy .NET.</span><span class="sxs-lookup"><span data-stu-id="8b08a-132">Create a new console project for .NET 5 using either Visual Studio or the .NET CLI.</span></span> <span data-ttu-id="8b08a-133">Następnie Dodaj nową klasę i nadaj jej nazwę `CanalLock` .</span><span class="sxs-lookup"><span data-stu-id="8b08a-133">Then, add a new class and name it `CanalLock`.</span></span> <span data-ttu-id="8b08a-134">Następnie Zaprojektuj publiczny interfejs API, ale pozostaw nie zaimplementowane metody:</span><span class="sxs-lookup"><span data-stu-id="8b08a-134">Next, design your public API, but leave the methods not implemented:</span></span>

:::code language="csharp" source="snippets/pattern-objects/InterimSteps.cs" ID="APIDesign":::

<span data-ttu-id="8b08a-135">Poprzedni kod inicjuje obiekt, aby obie bramy były zamknięte, a poziom wody jest niski.</span><span class="sxs-lookup"><span data-stu-id="8b08a-135">The preceding code initializes the object so both gates are closed, and the water level is low.</span></span> <span data-ttu-id="8b08a-136">Następnie Napisz następujący kod testowy w swojej `Main` metodzie, aby poprowadzić Cię przez proces tworzenia pierwszej implementacji klasy:</span><span class="sxs-lookup"><span data-stu-id="8b08a-136">Next, write the following test code in your `Main` method to guide you as you create a first implementation of the class:</span></span>

:::code language="csharp" source="snippets/pattern-objects/Program.cs" ID="HappyTests":::

<span data-ttu-id="8b08a-137">Następnie Dodaj pierwszą implementację każdej metody w `CanalLock` klasie.</span><span class="sxs-lookup"><span data-stu-id="8b08a-137">Next, add a first implementation of each method in the `CanalLock` class.</span></span> <span data-ttu-id="8b08a-138">Poniższy kod implementuje metody klasy bez obaw dla reguł bezpieczeństwa.</span><span class="sxs-lookup"><span data-stu-id="8b08a-138">The following code implements the methods of the class without concern to the safety rules.</span></span> <span data-ttu-id="8b08a-139">Później dodasz testy bezpieczeństwa:</span><span class="sxs-lookup"><span data-stu-id="8b08a-139">You'll add safety tests later:</span></span>

:::code language="csharp" source="snippets/pattern-objects/InterimSteps.cs" ID="FirstImplementation":::

<span data-ttu-id="8b08a-140">Testy, które zostały przez Ciebie zrobione, zostały przekazane do tej pory.</span><span class="sxs-lookup"><span data-stu-id="8b08a-140">The tests you've written so far pass.</span></span> <span data-ttu-id="8b08a-141">Podstawowe informacje zostały zaimplementowane.</span><span class="sxs-lookup"><span data-stu-id="8b08a-141">You've implemented the basics.</span></span> <span data-ttu-id="8b08a-142">Teraz Napisz test pod kątem pierwszego warunku niepowodzenia.</span><span class="sxs-lookup"><span data-stu-id="8b08a-142">Now, write a test for the first failure condition.</span></span> <span data-ttu-id="8b08a-143">Na końcu poprzednich testów obie bramy są zamknięte, a poziom wody jest ustawiony na niski.</span><span class="sxs-lookup"><span data-stu-id="8b08a-143">At the end of the previous tests, both gates are closed, and the water level is set to low.</span></span> <span data-ttu-id="8b08a-144">Dodaj test, aby spróbować otworzyć górną bramę:</span><span class="sxs-lookup"><span data-stu-id="8b08a-144">Add a test to try opening the upper gate:</span></span>

:::code language="csharp" source="snippets/pattern-objects/Program.cs" ID="HighGateSafetyTest":::

<span data-ttu-id="8b08a-145">Ten test zakończy się niepowodzeniem, ponieważ Brama zostanie otwarta.</span><span class="sxs-lookup"><span data-stu-id="8b08a-145">This test fails because the gate opens.</span></span> <span data-ttu-id="8b08a-146">Jako Pierwsza implementacja można rozwiązać ten problem przy użyciu następującego kodu:</span><span class="sxs-lookup"><span data-stu-id="8b08a-146">As a first implementation, you could fix it with the following code:</span></span>

:::code language="csharp" source="snippets/pattern-objects/InterimSteps.cs" ID="SecondImplementation":::

<span data-ttu-id="8b08a-147">Testy zostały zakończone pomyślnie.</span><span class="sxs-lookup"><span data-stu-id="8b08a-147">Your tests pass.</span></span> <span data-ttu-id="8b08a-148">Ale w miarę dodawania kolejnych testów należy dodać więcej `if` klauzul i przetestować różne właściwości.</span><span class="sxs-lookup"><span data-stu-id="8b08a-148">But, as you add more tests, you'll add more and more `if` clauses and test different properties.</span></span> <span data-ttu-id="8b08a-149">Wkrótce te metody będą zbyt skomplikowane podczas dodawania większej liczby warunków.</span><span class="sxs-lookup"><span data-stu-id="8b08a-149">Soon, these methods will get too complicated as you add more conditionals.</span></span>

## <a name="implement-the-commands-with-patterns"></a><span data-ttu-id="8b08a-150">Implementowanie poleceń przy użyciu wzorców</span><span class="sxs-lookup"><span data-stu-id="8b08a-150">Implement the commands with patterns</span></span>

<span data-ttu-id="8b08a-151">Lepszym sposobem jest użycie *wzorców* w celu ustalenia, czy obiekt jest w prawidłowym stanie do wykonania polecenia.</span><span class="sxs-lookup"><span data-stu-id="8b08a-151">A better way is to use *patterns* to determine if the object is in a valid state to execute a command.</span></span> <span data-ttu-id="8b08a-152">Można podać, czy polecenie jest dozwolone jako funkcja trzech zmiennych: stanu bramy, poziomu wody i nowego ustawienia:</span><span class="sxs-lookup"><span data-stu-id="8b08a-152">You can express if a command is allowed as a function of three variables: the state of the gate, the level of the water, and the new setting:</span></span>

| <span data-ttu-id="8b08a-153">Nowe ustawienie</span><span class="sxs-lookup"><span data-stu-id="8b08a-153">New setting</span></span> | <span data-ttu-id="8b08a-154">Stan bramy</span><span class="sxs-lookup"><span data-stu-id="8b08a-154">Gate state</span></span> | <span data-ttu-id="8b08a-155">Poziom wody</span><span class="sxs-lookup"><span data-stu-id="8b08a-155">Water Level</span></span> | <span data-ttu-id="8b08a-156">Wynik</span><span class="sxs-lookup"><span data-stu-id="8b08a-156">Result</span></span>             |
| ----------- | ---------- | ----------- | ------------------ |
| <span data-ttu-id="8b08a-157">Zamknięty</span><span class="sxs-lookup"><span data-stu-id="8b08a-157">Closed</span></span>      | <span data-ttu-id="8b08a-158">Zamknięty</span><span class="sxs-lookup"><span data-stu-id="8b08a-158">Closed</span></span>     | <span data-ttu-id="8b08a-159">Wysoki</span><span class="sxs-lookup"><span data-stu-id="8b08a-159">High</span></span>        | <span data-ttu-id="8b08a-160">Zamknięty</span><span class="sxs-lookup"><span data-stu-id="8b08a-160">Closed</span></span>             |
| <span data-ttu-id="8b08a-161">Zamknięty</span><span class="sxs-lookup"><span data-stu-id="8b08a-161">Closed</span></span>      | <span data-ttu-id="8b08a-162">Zamknięty</span><span class="sxs-lookup"><span data-stu-id="8b08a-162">Closed</span></span>     | <span data-ttu-id="8b08a-163">Niski</span><span class="sxs-lookup"><span data-stu-id="8b08a-163">Low</span></span>         | <span data-ttu-id="8b08a-164">Zamknięty</span><span class="sxs-lookup"><span data-stu-id="8b08a-164">Closed</span></span>             |
| <span data-ttu-id="8b08a-165">Zamknięty</span><span class="sxs-lookup"><span data-stu-id="8b08a-165">Closed</span></span>      | <span data-ttu-id="8b08a-166">Otwórz</span><span class="sxs-lookup"><span data-stu-id="8b08a-166">Open</span></span>       | <span data-ttu-id="8b08a-167">Wysoki</span><span class="sxs-lookup"><span data-stu-id="8b08a-167">High</span></span>        | <span data-ttu-id="8b08a-168">Otwórz</span><span class="sxs-lookup"><span data-stu-id="8b08a-168">Open</span></span>               |
| <span data-ttu-id="8b08a-169">~~Zamknięty~~</span><span class="sxs-lookup"><span data-stu-id="8b08a-169">~~Closed~~</span></span>  | <span data-ttu-id="8b08a-170">~~Otwórz~~</span><span class="sxs-lookup"><span data-stu-id="8b08a-170">~~Open~~</span></span>   | <span data-ttu-id="8b08a-171">~~Niski~~</span><span class="sxs-lookup"><span data-stu-id="8b08a-171">~~Low~~</span></span>     | <span data-ttu-id="8b08a-172">~~Zamknięty~~</span><span class="sxs-lookup"><span data-stu-id="8b08a-172">~~Closed~~</span></span>         |
| <span data-ttu-id="8b08a-173">Otwórz</span><span class="sxs-lookup"><span data-stu-id="8b08a-173">Open</span></span>        | <span data-ttu-id="8b08a-174">Zamknięty</span><span class="sxs-lookup"><span data-stu-id="8b08a-174">Closed</span></span>     | <span data-ttu-id="8b08a-175">Wysoki</span><span class="sxs-lookup"><span data-stu-id="8b08a-175">High</span></span>        | <span data-ttu-id="8b08a-176">Otwórz</span><span class="sxs-lookup"><span data-stu-id="8b08a-176">Open</span></span>               |
| <span data-ttu-id="8b08a-177">Otwórz</span><span class="sxs-lookup"><span data-stu-id="8b08a-177">Open</span></span>        | <span data-ttu-id="8b08a-178">Zamknięty</span><span class="sxs-lookup"><span data-stu-id="8b08a-178">Closed</span></span>     | <span data-ttu-id="8b08a-179">Niski</span><span class="sxs-lookup"><span data-stu-id="8b08a-179">Low</span></span>         | <span data-ttu-id="8b08a-180">Zamknięte (błąd)</span><span class="sxs-lookup"><span data-stu-id="8b08a-180">Closed (Error)</span></span>     |
| <span data-ttu-id="8b08a-181">Otwórz</span><span class="sxs-lookup"><span data-stu-id="8b08a-181">Open</span></span>        | <span data-ttu-id="8b08a-182">Otwórz</span><span class="sxs-lookup"><span data-stu-id="8b08a-182">Open</span></span>       | <span data-ttu-id="8b08a-183">Wysoki</span><span class="sxs-lookup"><span data-stu-id="8b08a-183">High</span></span>        | <span data-ttu-id="8b08a-184">Otwórz</span><span class="sxs-lookup"><span data-stu-id="8b08a-184">Open</span></span>               |
| <span data-ttu-id="8b08a-185">~~Otwórz~~</span><span class="sxs-lookup"><span data-stu-id="8b08a-185">~~Open~~</span></span>    | <span data-ttu-id="8b08a-186">~~Otwórz~~</span><span class="sxs-lookup"><span data-stu-id="8b08a-186">~~Open~~</span></span>   | <span data-ttu-id="8b08a-187">~~Niski~~</span><span class="sxs-lookup"><span data-stu-id="8b08a-187">~~Low~~</span></span>     | <span data-ttu-id="8b08a-188">~~Zamknięte (błąd)~~</span><span class="sxs-lookup"><span data-stu-id="8b08a-188">~~Closed (Error)~~</span></span> |

<span data-ttu-id="8b08a-189">Czwarty i ostatni wiersz w tabeli ma przekreślony tekst, ponieważ są one nieprawidłowe.</span><span class="sxs-lookup"><span data-stu-id="8b08a-189">The fourth and last rows in the table have strike through text because they're invalid.</span></span> <span data-ttu-id="8b08a-190">Dodany kod powinien mieć pewność, że brama wysokiej wody nigdy nie jest otwierana, gdy woda jest niska.</span><span class="sxs-lookup"><span data-stu-id="8b08a-190">The code you're adding now should make sure the high water gate is never opened when the water is low.</span></span>  <span data-ttu-id="8b08a-191">Te Stany można zakodować jako pojedyncze wyrażenie przełącznika (należy pamiętać, że `false` wskazuje "zamknięte"):</span><span class="sxs-lookup"><span data-stu-id="8b08a-191">Those states can be coded as a single switch expression (remember that `false` indicates "Closed"):</span></span>

:::code language="csharp" source="snippets/pattern-objects/InterimSteps.cs" ID="ThirdImplementation":::

<span data-ttu-id="8b08a-192">Wypróbuj tę wersję.</span><span class="sxs-lookup"><span data-stu-id="8b08a-192">Try this version.</span></span> <span data-ttu-id="8b08a-193">Testy są przekazywane, sprawdzając, czy kod.</span><span class="sxs-lookup"><span data-stu-id="8b08a-193">Your tests pass, validating the code.</span></span> <span data-ttu-id="8b08a-194">W pełnej tabeli przedstawiono możliwe kombinacje danych wejściowych i wyników.</span><span class="sxs-lookup"><span data-stu-id="8b08a-194">The full table shows the possible combinations of inputs and results.</span></span> <span data-ttu-id="8b08a-195">Oznacza to, że ty i inni deweloperzy mogą szybko zapoznać się z tabelą i zobaczyć, że zostały omówione wszystkie możliwe dane wejściowe.</span><span class="sxs-lookup"><span data-stu-id="8b08a-195">That means you and other developers can quickly look at the table and see that you've covered all the possible inputs.</span></span> <span data-ttu-id="8b08a-196">Jeszcze łatwiejsze kompilator może również pomóc.</span><span class="sxs-lookup"><span data-stu-id="8b08a-196">Even easier, the compiler can help as well.</span></span> <span data-ttu-id="8b08a-197">Po dodaniu poprzedniego kodu można zobaczyć, że kompilator generuje ostrzeżenie: *CS8524* wskazuje, że wyrażenie Switch nie obejmuje wszystkich możliwych danych wejściowych.</span><span class="sxs-lookup"><span data-stu-id="8b08a-197">After you add the previous code, you can see that the compiler generates a warning: *CS8524* indicates the switch expression doesn't cover all possible inputs.</span></span> <span data-ttu-id="8b08a-198">Przyczyną tego ostrzeżenia jest to, że jeden z danych wejściowych jest `enum` typem.</span><span class="sxs-lookup"><span data-stu-id="8b08a-198">The reason for that warning is that one of the inputs is an `enum` type.</span></span> <span data-ttu-id="8b08a-199">Kompilator interpretuje "wszystkie możliwe dane wejściowe" jako wszystkie dane wejściowe z typu podstawowego, zwykle jest to `int` .</span><span class="sxs-lookup"><span data-stu-id="8b08a-199">The compiler interprets "all possible inputs" as all inputs from the underlying type, typically an `int`.</span></span> <span data-ttu-id="8b08a-200">To `switch` wyrażenie sprawdza tylko wartości zadeklarowane w `enum` .</span><span class="sxs-lookup"><span data-stu-id="8b08a-200">This `switch` expression only checks the values declared in the `enum`.</span></span> <span data-ttu-id="8b08a-201">Aby usunąć ostrzeżenie, można dodać wzorzec catch-all dla ostatniego ramienia wyrażenia.</span><span class="sxs-lookup"><span data-stu-id="8b08a-201">To remove the warning, you can add a catch-all discard pattern for the last arm of the expression.</span></span> <span data-ttu-id="8b08a-202">Ten warunek zgłasza wyjątek, ponieważ wskazuje nieprawidłowe dane wejściowe:</span><span class="sxs-lookup"><span data-stu-id="8b08a-202">This condition throws an exception, because it indicates invalid input:</span></span>

```csharp
_  => throw new InvalidOperationException("Invalid internal state"),
```

<span data-ttu-id="8b08a-203">Poprzedni ARM przełącznika musi być ostatni w `switch` wyrażeniu, ponieważ dopasowuje wszystkie dane wejściowe.</span><span class="sxs-lookup"><span data-stu-id="8b08a-203">The preceding switch arm must be last in your `switch` expression because it matches all inputs.</span></span> <span data-ttu-id="8b08a-204">Eksperymentuj przez przeniesienie go wcześniej w kolejności.</span><span class="sxs-lookup"><span data-stu-id="8b08a-204">Experiment by moving it earlier in the order.</span></span> <span data-ttu-id="8b08a-205">Powoduje błąd kompilatora *CS8510* dla nieosiągalnego kodu we wzorcu.</span><span class="sxs-lookup"><span data-stu-id="8b08a-205">That causes a compiler error *CS8510* for unreachable code in a pattern.</span></span>  <span data-ttu-id="8b08a-206">Naturalna struktura wyrażeń przełączników umożliwia kompilatorowi generowanie błędów i ostrzeżeń dla możliwych błędów.</span><span class="sxs-lookup"><span data-stu-id="8b08a-206">The natural structure of switch expressions enables the compiler to generate errors and warnings for possible mistakes.</span></span> <span data-ttu-id="8b08a-207">Kompilator "bezpieczeństwo sieci" ułatwia tworzenie poprawnego kodu w mniejszej liczbie iteracji i swobodę łączenia broni przełączania z symbolami wieloznacznymi.</span><span class="sxs-lookup"><span data-stu-id="8b08a-207">The compiler "safety net" makes it easier for you to create correct code in fewer iterations, and the freedom to combine switch arms with wildcards.</span></span> <span data-ttu-id="8b08a-208">Kompilator będzie wystawiał błędy, jeśli Twoje połączenie powoduje nieosiągalne nieoczekiwane poręczenia, i ostrzeżenia w przypadku usunięcia wymaganej aktywacji.</span><span class="sxs-lookup"><span data-stu-id="8b08a-208">The compiler will issue errors if your combination results in unreachable arms you didn't expect, and warnings if you remove an arm that's needed.</span></span>

<span data-ttu-id="8b08a-209">Pierwsza zmiana polega na połączeniu wszystkich ramion, w których polecenie zamyka bramę; jest to zawsze dozwolone.</span><span class="sxs-lookup"><span data-stu-id="8b08a-209">The first change is to combine all the arms where the command is to close the gate; that's always allowed.</span></span> <span data-ttu-id="8b08a-210">Dodaj następujący kod jako pierwszy ARM w wyrażeniu przełącznika:</span><span class="sxs-lookup"><span data-stu-id="8b08a-210">Add the following code as the first arm in your switch expression:</span></span>

```csharp
(false, _, _) => false,
```

<span data-ttu-id="8b08a-211">Po dodaniu poprzedniego ramienia aktywacji uzyskasz cztery błędy kompilatora, po jednym dla każdej z ramion, gdzie polecenie jest `false` .</span><span class="sxs-lookup"><span data-stu-id="8b08a-211">After you add the previous switch arm, you'll get four compiler errors, one on each of the arms where the command is `false`.</span></span> <span data-ttu-id="8b08a-212">Te poręczenia zostały już omówione przez nowo dodaną ramię.</span><span class="sxs-lookup"><span data-stu-id="8b08a-212">Those arms are already covered by the newly added arm.</span></span> <span data-ttu-id="8b08a-213">Możesz bezpiecznie usunąć te cztery wiersze.</span><span class="sxs-lookup"><span data-stu-id="8b08a-213">You can safely remove those four lines.</span></span> <span data-ttu-id="8b08a-214">Ten nowy przełącznik ARM zakończył te warunki.</span><span class="sxs-lookup"><span data-stu-id="8b08a-214">You intended this new switch arm to replace those conditions.</span></span>

<span data-ttu-id="8b08a-215">Następnie można uprościć cztery ramiona, w których polecenie służy do otwierania bramy.</span><span class="sxs-lookup"><span data-stu-id="8b08a-215">Next, you can simplify the four arms where the command is to open the gate.</span></span> <span data-ttu-id="8b08a-216">W obu przypadkach, gdy poziom wody jest wysoki, bramę można otworzyć.</span><span class="sxs-lookup"><span data-stu-id="8b08a-216">In both cases where the water level is high, the gate can be opened.</span></span> <span data-ttu-id="8b08a-217">(W jednym jest już otwarty). Jeden przypadek, w którym poziom wody jest niski zgłasza wyjątek, a drugi nie powinien wystąpić.</span><span class="sxs-lookup"><span data-stu-id="8b08a-217">(In one, it's already open.) One case where the water level is low throws an exception, and the other shouldn't happen.</span></span> <span data-ttu-id="8b08a-218">Jeśli blokada wodna jest już w nieprawidłowym stanie, należy ją bezpiecznie zgłosić.</span><span class="sxs-lookup"><span data-stu-id="8b08a-218">It should be safe to throw the same exception if the water lock is already in an invalid state.</span></span> <span data-ttu-id="8b08a-219">Dla tych broni można wykonać następujące uproszczenia:</span><span class="sxs-lookup"><span data-stu-id="8b08a-219">You can make the following simplifications for those arms:</span></span>

```csharp
(true, _, WaterLevel.High) => true,
(true, false, WaterLevel.Low) => throw new InvalidOperationException("Cannot open high gate when the water is low"),
_ => throw new InvalidOperationException("Invalid internal state"),
```

<span data-ttu-id="8b08a-220">Uruchom ponownie testy i przekaże je.</span><span class="sxs-lookup"><span data-stu-id="8b08a-220">Run your tests again, and they pass.</span></span> <span data-ttu-id="8b08a-221">Oto Ostatnia wersja `SetHighGate` metody:</span><span class="sxs-lookup"><span data-stu-id="8b08a-221">Here's the final version of the `SetHighGate` method:</span></span>

:::code language="csharp" source="snippets/pattern-objects/CanalLock.cs" ID="FinalImplementaton":::

## <a name="implement-patterns-yourself"></a><span data-ttu-id="8b08a-222">Zaimplementuj wzorce</span><span class="sxs-lookup"><span data-stu-id="8b08a-222">Implement patterns yourself</span></span>

<span data-ttu-id="8b08a-223">Teraz, gdy zobaczysz technikę, Wypełnij `SetLowGate` `SetWaterLevel` metody i.</span><span class="sxs-lookup"><span data-stu-id="8b08a-223">Now that you've seen the technique, fill in the `SetLowGate` and `SetWaterLevel` methods yourself.</span></span>  <span data-ttu-id="8b08a-224">Zacznij od dodania poniższego kodu w celu przetestowania nieprawidłowych operacji na tych metodach:</span><span class="sxs-lookup"><span data-stu-id="8b08a-224">Start by adding the following code to test invalid operations on those methods:</span></span>

:::code language="csharp" source="snippets/pattern-objects/Program.cs" ID="FinalTestCode":::

<span data-ttu-id="8b08a-225">Uruchom aplikację ponownie.</span><span class="sxs-lookup"><span data-stu-id="8b08a-225">Run your application again.</span></span> <span data-ttu-id="8b08a-226">Można zobaczyć, że nowe testy zakończą się niepowodzeniem, a blokada kanału jest w nieprawidłowym stanie.</span><span class="sxs-lookup"><span data-stu-id="8b08a-226">You can see the new tests fail, and the canal lock gets into an invalid state.</span></span> <span data-ttu-id="8b08a-227">Spróbuj samodzielnie zaimplementować pozostałe metody.</span><span class="sxs-lookup"><span data-stu-id="8b08a-227">Try to implement the remaining methods yourself.</span></span> <span data-ttu-id="8b08a-228">Metoda ustawiania dolnej bramy powinna być podobna do metody w celu ustawienia górnej bramy.</span><span class="sxs-lookup"><span data-stu-id="8b08a-228">The method to set the lower gate should be similar to the method to set the upper gate.</span></span> <span data-ttu-id="8b08a-229">Metoda, która zmienia poziom wody, ma inne sprawdzenia, ale powinna być zgodna z podobną strukturą.</span><span class="sxs-lookup"><span data-stu-id="8b08a-229">The method that changes the water level has different checks, but should follow a similar structure.</span></span> <span data-ttu-id="8b08a-230">Pomocne może być użycie tego samego procesu dla metody, która ustawia poziom wody.</span><span class="sxs-lookup"><span data-stu-id="8b08a-230">You may find it helpful to use the same process for the method that sets the water level.</span></span> <span data-ttu-id="8b08a-231">Zacznij od wszystkich czterech danych wejściowych: stanu obu bram, bieżącego stanu wody i żądanego nowego poziomu wody.</span><span class="sxs-lookup"><span data-stu-id="8b08a-231">Start with all four inputs: The state of both gates, the current state of the water level, and the requested new water level.</span></span> <span data-ttu-id="8b08a-232">Wyrażenie Switch powinno rozpoczynać się od:</span><span class="sxs-lookup"><span data-stu-id="8b08a-232">The switch expression should start with:</span></span>

```csharp
CanalLockWaterLevel = (newLevel, CanalLockWaterLevel, LowWaterGateOpen, HighWaterGateOpen) switch
{
    // elided
};
```

<span data-ttu-id="8b08a-233">Masz 16 łącznych ramion do przełączania, aby wypełnić.</span><span class="sxs-lookup"><span data-stu-id="8b08a-233">You'll have 16 total switch arms to fill in.</span></span> <span data-ttu-id="8b08a-234">Następnie przetestuj i Uprość.</span><span class="sxs-lookup"><span data-stu-id="8b08a-234">Then, test and simplify.</span></span>

<span data-ttu-id="8b08a-235">Czy zostały wprowadzone metody podobne do tego?</span><span class="sxs-lookup"><span data-stu-id="8b08a-235">Did you make methods something like this?</span></span>

:::code language="csharp" source="snippets/pattern-objects/CanalLock.cs" ID="FinalExercise":::

<span data-ttu-id="8b08a-236">Testy powinny być przekazywane, a blokada kanału powinna działać bezpiecznie.</span><span class="sxs-lookup"><span data-stu-id="8b08a-236">Your tests should pass, and the canal lock should operate safely.</span></span>

## <a name="summary"></a><span data-ttu-id="8b08a-237">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="8b08a-237">Summary</span></span>

<span data-ttu-id="8b08a-238">W ramach tego samouczka nauczysz się użyć dopasowania wzorców do sprawdzenia stanu wewnętrznego obiektu przed zastosowaniem jakichkolwiek zmian w tym stanie.</span><span class="sxs-lookup"><span data-stu-id="8b08a-238">In this tutorial, you learned to use pattern matching to check the internal state of an object before applying any changes to that state.</span></span> <span data-ttu-id="8b08a-239">Można sprawdzić kombinacje właściwości.</span><span class="sxs-lookup"><span data-stu-id="8b08a-239">You can check combinations of properties.</span></span> <span data-ttu-id="8b08a-240">Po skompilowaniu tabel dla dowolnego z tych przejść Przetestuj swój kod, a następnie Uprość go pod kątem czytelności i utrzymania.</span><span class="sxs-lookup"><span data-stu-id="8b08a-240">Once you've built tables for any of those transitions, you test your code, then simplify for readability and maintainability.</span></span> <span data-ttu-id="8b08a-241">Te początkowe refaktoryzacje mogą sugerować dalsze refaktoryzacje, które weryfikują stan wewnętrzny lub zarządzają zmianami interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="8b08a-241">These initial refactorings may suggest further refactorings that validate internal state or manage other API changes.</span></span> <span data-ttu-id="8b08a-242">Ten samouczek umożliwia łączenie klas i obiektów z bardziej zorientowanymi na dane oparte na wzorcu podejściem do implementowania tych klas.</span><span class="sxs-lookup"><span data-stu-id="8b08a-242">This tutorial combined classes and objects with a more data-oriented, pattern-based approach to implement those classes.</span></span>
