---
title: 'Bezpieczne aktualizowanie interfejsów przy użyciu domyślnych metod interfejsu w języku C #'
description: W tym zaawansowanym samouczku opisano, jak bezpiecznie dodawać nowe możliwości do istniejących definicji interfejsu bez przerywania wszystkich klas i struktur implementujących ten interfejs.
ms.date: 05/06/2019
ms.technlogy: csharp-advanced-concepts
ms.custom: mvc
ms.openlocfilehash: 650aea78b421783b3f249b3670578aa60e800ab2
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/14/2020
ms.locfileid: "79156782"
---
# <a name="tutorial-update-interfaces-with-default-interface-methods-in-c-80"></a><span data-ttu-id="4b323-103">Samouczek: Aktualizowanie interfejsów za pomocą domyślnych metod interfejsu w języku C# 8.0</span><span class="sxs-lookup"><span data-stu-id="4b323-103">Tutorial: Update interfaces with default interface methods in C# 8.0</span></span>

<span data-ttu-id="4b323-104">Począwszy od języka C# 8.0 w platformie .NET Core 3.0, można zdefiniować implementację podczas deklarowania członka interfejsu.</span><span class="sxs-lookup"><span data-stu-id="4b323-104">Beginning with C# 8.0 on .NET Core 3.0, you can define an implementation when you declare a member of an interface.</span></span> <span data-ttu-id="4b323-105">Najbardziej typowym scenariuszem jest bezpieczne dodawanie elementów członkowskich do interfejsu już zwolniony i używany przez niezliczonych klientów.</span><span class="sxs-lookup"><span data-stu-id="4b323-105">The most common scenario is to safely add members to an interface already released and used by innumerable clients.</span></span>

<span data-ttu-id="4b323-106">Ten samouczek zawiera informacje na temat wykonywania następujących czynności:</span><span class="sxs-lookup"><span data-stu-id="4b323-106">In this tutorial, you'll learn how to:</span></span>

> [!div class="checklist"]
>
> * <span data-ttu-id="4b323-107">Bezpiecznie rozszerzaj interfejsy, dodając metody z implementacjami.</span><span class="sxs-lookup"><span data-stu-id="4b323-107">Extend interfaces safely by adding methods with implementations.</span></span>
> * <span data-ttu-id="4b323-108">Tworzenie sparametryzowanych implementacji w celu zapewnienia większej elastyczności.</span><span class="sxs-lookup"><span data-stu-id="4b323-108">Create parameterized implementations to provide greater flexibility.</span></span>
> * <span data-ttu-id="4b323-109">Włącz implementatorów, aby zapewnić bardziej szczegółową implementację w postaci zastąpienia.</span><span class="sxs-lookup"><span data-stu-id="4b323-109">Enable implementers to provide a more specific implementation in the form of an override.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="4b323-110">Wymagania wstępne</span><span class="sxs-lookup"><span data-stu-id="4b323-110">Prerequisites</span></span>

<span data-ttu-id="4b323-111">Musisz skonfigurować komputer do uruchamiania .NET Core, w tym kompilator C# 8.0.</span><span class="sxs-lookup"><span data-stu-id="4b323-111">You’ll need to set up your machine to run .NET Core, including the C# 8.0 compiler.</span></span> <span data-ttu-id="4b323-112">Kompilator C# 8.0 jest dostępny począwszy od [programu Visual Studio 2019 w wersji 16.3](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=inline+link&utm_content=download+vs2019) lub [sdk .NET Core 3.0](https://dotnet.microsoft.com/download).</span><span class="sxs-lookup"><span data-stu-id="4b323-112">The C# 8.0 compiler is available starting with [Visual Studio 2019 version 16.3](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=inline+link&utm_content=download+vs2019) or the [.NET Core 3.0 SDK](https://dotnet.microsoft.com/download).</span></span>

## <a name="scenario-overview"></a><span data-ttu-id="4b323-113">Omówienie scenariusza</span><span class="sxs-lookup"><span data-stu-id="4b323-113">Scenario overview</span></span>

<span data-ttu-id="4b323-114">Ten samouczek rozpoczyna się od wersji 1 biblioteki relacji z klientem.</span><span class="sxs-lookup"><span data-stu-id="4b323-114">This tutorial starts with version 1 of a customer relationship library.</span></span> <span data-ttu-id="4b323-115">Możesz uzyskać aplikację startową na naszym [reppo próbek na GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/starter/customer-relationship).</span><span class="sxs-lookup"><span data-stu-id="4b323-115">You can get the starter application on our [samples repo on GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/starter/customer-relationship).</span></span> <span data-ttu-id="4b323-116">Firma, która zbudowała tę bibliotekę, zamierzała, aby klienci z istniejącymi aplikacjami przyjęli swoją bibliotekę.</span><span class="sxs-lookup"><span data-stu-id="4b323-116">The company that built this library intended customers with existing applications to adopt their library.</span></span> <span data-ttu-id="4b323-117">Pod warunkiem minimalnych definicji interfejsu dla użytkowników ich biblioteki do zaimplementowania.</span><span class="sxs-lookup"><span data-stu-id="4b323-117">They provided minimal interface definitions for users of their library to implement.</span></span> <span data-ttu-id="4b323-118">Oto definicja interfejsu dla klienta:</span><span class="sxs-lookup"><span data-stu-id="4b323-118">Here's the interface definition for a customer:</span></span>

[!code-csharp[InitialCustomerInterface](~/samples/snippets/csharp/tutorials/default-interface-members-versions/starter/customer-relationship/ICustomer.cs?name=SnippetICustomerVersion1)]

<span data-ttu-id="4b323-119">Zdefiniowali drugi interfejs, który reprezentuje kolejność:</span><span class="sxs-lookup"><span data-stu-id="4b323-119">They defined a second interface that represents an order:</span></span>

[!code-csharp[InitialOrderInterface](~/samples/snippets/csharp/tutorials/default-interface-members-versions/starter/customer-relationship/IOrder.cs?name=SnippetIorderVersion1)]

<span data-ttu-id="4b323-120">Z tych interfejsów zespół może utworzyć bibliotekę dla swoich użytkowników, aby stworzyć lepsze środowisko dla swoich klientów.</span><span class="sxs-lookup"><span data-stu-id="4b323-120">From those interfaces, the team could build a library for their users to create a better experience for their customers.</span></span> <span data-ttu-id="4b323-121">Ich celem było stworzenie głębszych relacji z istniejącymi klientami i poprawa ich relacji z nowymi klientami.</span><span class="sxs-lookup"><span data-stu-id="4b323-121">Their goal was to create a deeper relationship with existing customers and improve their relationships with new customers.</span></span>

<span data-ttu-id="4b323-122">Teraz nadszedł czas, aby uaktualnić bibliotekę do następnej wersji.</span><span class="sxs-lookup"><span data-stu-id="4b323-122">Now, it's time to upgrade the library for the next release.</span></span> <span data-ttu-id="4b323-123">Jedna z żądanych funkcji umożliwia rabat lojalnościowy dla klientów, którzy mają wiele zamówień.</span><span class="sxs-lookup"><span data-stu-id="4b323-123">One of the requested features enables a loyalty discount for customers that have lots of orders.</span></span> <span data-ttu-id="4b323-124">Ten nowy rabat lojalnościowy jest stosowany za każdym razem, gdy klient składa zamówienie.</span><span class="sxs-lookup"><span data-stu-id="4b323-124">This new loyalty discount gets applied whenever a customer makes an order.</span></span> <span data-ttu-id="4b323-125">Określony rabat jest własnością każdego indywidualnego klienta.</span><span class="sxs-lookup"><span data-stu-id="4b323-125">The specific discount is a property of each individual customer.</span></span> <span data-ttu-id="4b323-126">Każda implementacja `ICustomer` można ustawić różne reguły dla rabatu lojalnościowego.</span><span class="sxs-lookup"><span data-stu-id="4b323-126">Each implementation of `ICustomer` can set different rules for the loyalty discount.</span></span>

<span data-ttu-id="4b323-127">Najbardziej naturalnym sposobem dodania tej funkcji `ICustomer` jest zwiększenie interfejsu za pomocą metody zastosowania dowolnego rabatu lojalnościowego.</span><span class="sxs-lookup"><span data-stu-id="4b323-127">The most natural way to add this functionality is to enhance the `ICustomer` interface with a method to apply any loyalty discount.</span></span> <span data-ttu-id="4b323-128">Ta sugestia projektowa wywołała niepokój wśród doświadczonych programistów: "Interfejsy są niezmienne po ich wydaniu!</span><span class="sxs-lookup"><span data-stu-id="4b323-128">This design suggestion caused concern among experienced developers: "Interfaces are immutable once they've been released!</span></span> <span data-ttu-id="4b323-129">To przełomowa zmiana!"</span><span class="sxs-lookup"><span data-stu-id="4b323-129">This is a breaking change!"</span></span> <span data-ttu-id="4b323-130">C# 8.0 dodaje *domyślne implementacje interfejsu* do uaktualniania interfejsów.</span><span class="sxs-lookup"><span data-stu-id="4b323-130">C# 8.0 adds *default interface implementations* for upgrading interfaces.</span></span> <span data-ttu-id="4b323-131">Autorzy biblioteki można dodać nowe elementy członkowskie do interfejsu i zapewnić domyślną implementację dla tych elementów członkowskich.</span><span class="sxs-lookup"><span data-stu-id="4b323-131">The library authors can add new members to the interface and provide a default implementation for those members.</span></span>

<span data-ttu-id="4b323-132">Implementacje interfejsu domyślnego umożliwiają deweloperom uaktualnienie interfejsu, jednocześnie umożliwiając implementatorom zastąpienie tej implementacji.</span><span class="sxs-lookup"><span data-stu-id="4b323-132">Default interface implementations enable developers to upgrade an interface while still enabling any implementors to override that implementation.</span></span> <span data-ttu-id="4b323-133">Użytkownicy biblioteki mogą akceptować domyślną implementację jako nieubijającą się zmianę.</span><span class="sxs-lookup"><span data-stu-id="4b323-133">Users of the library can accept the default implementation as a non-breaking change.</span></span> <span data-ttu-id="4b323-134">Jeśli ich reguły biznesowe są różne, mogą zastąpić.</span><span class="sxs-lookup"><span data-stu-id="4b323-134">If their business rules are different, they can override.</span></span>

## <a name="upgrade-with-default-interface-methods"></a><span data-ttu-id="4b323-135">Uaktualnianie za pomocą domyślnych metod interfejsu</span><span class="sxs-lookup"><span data-stu-id="4b323-135">Upgrade with default interface methods</span></span>

<span data-ttu-id="4b323-136">Zespół zgodził się na najbardziej prawdopodobną domyślną implementację: zniżkę lojalnościową dla klientów.</span><span class="sxs-lookup"><span data-stu-id="4b323-136">The team agreed on the most likely default implementation: a loyalty discount for customers.</span></span>

<span data-ttu-id="4b323-137">Uaktualnienie powinno zapewnić funkcjonalność, aby ustawić dwie właściwości: liczbę zamówień potrzebnych do zakwalifikowania się do rabatu i procent rabatu.</span><span class="sxs-lookup"><span data-stu-id="4b323-137">The upgrade should provide the functionality to set two properties: the number of orders needed to be eligible for the discount, and the percentage of the discount.</span></span> <span data-ttu-id="4b323-138">To sprawia, że jest to idealny scenariusz dla domyślnych metod interfejsu.</span><span class="sxs-lookup"><span data-stu-id="4b323-138">This makes it a perfect scenario for default interface methods.</span></span> <span data-ttu-id="4b323-139">Można dodać metodę do `ICustomer` interfejsu i zapewnić najbardziej prawdopodobną implementację.</span><span class="sxs-lookup"><span data-stu-id="4b323-139">You can add a method to the `ICustomer` interface, and provide the most likely implementation.</span></span> <span data-ttu-id="4b323-140">Wszystkie istniejące i wszystkie nowe implementacje można użyć implementacji domyślnej lub podać własne.</span><span class="sxs-lookup"><span data-stu-id="4b323-140">All existing, and any new implementations can use the default implementation, or provide their own.</span></span>

<span data-ttu-id="4b323-141">Najpierw dodaj nową metodę do implementacji:</span><span class="sxs-lookup"><span data-stu-id="4b323-141">First, add the new method to the implementation:</span></span>

[!code-csharp[InitialOrderInterface](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/ICustomer.cs?name=SnippetLoyaltyDiscountVersionOne)]

<span data-ttu-id="4b323-142">Autor biblioteki napisał pierwszy test, aby sprawdzić implementację:</span><span class="sxs-lookup"><span data-stu-id="4b323-142">The library author wrote a first test to check the implementation:</span></span>

[!code-csharp[TestDefaultImplementation](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/Program.cs?name=SnippetTestDefaultImplementation)]

<span data-ttu-id="4b323-143">Należy zwrócić uwagę na następującą część badania:</span><span class="sxs-lookup"><span data-stu-id="4b323-143">Notice the following portion of the test:</span></span>

[!code-csharp[TestDefaultImplementation](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/Program.cs?name=SnippetHighlightCast)]

<span data-ttu-id="4b323-144">To oddanych od `SampleCustomer` do `ICustomer` jest konieczne.</span><span class="sxs-lookup"><span data-stu-id="4b323-144">That cast from `SampleCustomer` to `ICustomer` is necessary.</span></span> <span data-ttu-id="4b323-145">Klasa `SampleCustomer` nie musi zapewniać implementacji `ComputeLoyaltyDiscount`dla ; który jest dostarczany `ICustomer` przez interfejs.</span><span class="sxs-lookup"><span data-stu-id="4b323-145">The `SampleCustomer` class doesn't need to provide an implementation for `ComputeLoyaltyDiscount`; that's provided by the `ICustomer` interface.</span></span> <span data-ttu-id="4b323-146">Jednak `SampleCustomer` klasa nie dziedziczy członków z jego interfejsów.</span><span class="sxs-lookup"><span data-stu-id="4b323-146">However, the `SampleCustomer` class doesn't inherit members from its interfaces.</span></span> <span data-ttu-id="4b323-147">Ta zasada nie uległa zmianie.</span><span class="sxs-lookup"><span data-stu-id="4b323-147">That rule hasn't changed.</span></span> <span data-ttu-id="4b323-148">Aby wywołać dowolną metodę zadeklarowaną i zaimplementowaną w interfejsie, `ICustomer` zmienna musi być typem interfejsu, w tym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="4b323-148">In order to call any method declared and implemented in the interface, the variable must be the type of the interface, `ICustomer` in this example.</span></span>

## <a name="provide-parameterization"></a><span data-ttu-id="4b323-149">Podaj parametryzację</span><span class="sxs-lookup"><span data-stu-id="4b323-149">Provide parameterization</span></span>

<span data-ttu-id="4b323-150">To dobry początek.</span><span class="sxs-lookup"><span data-stu-id="4b323-150">That's a good start.</span></span> <span data-ttu-id="4b323-151">Ale domyślna implementacja jest zbyt restrykcyjna.</span><span class="sxs-lookup"><span data-stu-id="4b323-151">But, the default implementation is too restrictive.</span></span> <span data-ttu-id="4b323-152">Wielu konsumentów tego systemu może wybrać różne progi dla liczby zakupów, inną długość członkostwa lub inną zniżkę procentową.</span><span class="sxs-lookup"><span data-stu-id="4b323-152">Many consumers of this system may choose different thresholds for number of purchases, a different length of membership, or a different percentage discount.</span></span> <span data-ttu-id="4b323-153">Można zapewnić lepsze środowisko uaktualniania dla większej liczby klientów, zapewniając sposób, aby ustawić te parametry.</span><span class="sxs-lookup"><span data-stu-id="4b323-153">You can provide a better upgrade experience for more customers by providing a way to set those parameters.</span></span> <span data-ttu-id="4b323-154">Dodajmy metodę statyczną, która ustawia te trzy parametry kontrolujące domyślną implementację:</span><span class="sxs-lookup"><span data-stu-id="4b323-154">Let's add a static method that sets those three parameters controlling the default implementation:</span></span>

[!code-csharp[VersionTwoImplementation](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/ICustomer.cs?name=SnippetLoyaltyDiscountVersionTwo)]

<span data-ttu-id="4b323-155">Istnieje wiele nowych funkcji języka pokazano w tym małym fragmentu kodu.</span><span class="sxs-lookup"><span data-stu-id="4b323-155">There are many new language capabilities shown in that small code fragment.</span></span> <span data-ttu-id="4b323-156">Interfejsy mogą teraz zawierać elementy członkowskie statyczne, w tym pola i metody.</span><span class="sxs-lookup"><span data-stu-id="4b323-156">Interfaces can now include static members, including fields and methods.</span></span> <span data-ttu-id="4b323-157">Włączone są również różne modyfikatory dostępu.</span><span class="sxs-lookup"><span data-stu-id="4b323-157">Different access modifiers are also enabled.</span></span> <span data-ttu-id="4b323-158">Dodatkowe pola są prywatne, nowa metoda jest publiczna.</span><span class="sxs-lookup"><span data-stu-id="4b323-158">The additional fields are private, the new method is public.</span></span> <span data-ttu-id="4b323-159">Wszystkie modyfikatory są dozwolone na elementy członkowskie interfejsu.</span><span class="sxs-lookup"><span data-stu-id="4b323-159">Any of the modifiers are allowed on interface members.</span></span>

<span data-ttu-id="4b323-160">Aplikacje, które używają ogólnej formuły do obliczania rabatu lojalnościowego, ale różne parametry, nie muszą zapewniać implementacji niestandardowej; można ustawić argumenty za pomocą metody statycznej.</span><span class="sxs-lookup"><span data-stu-id="4b323-160">Applications that use the general formula for computing the loyalty discount, but different parameters, don't need to provide a custom implementation; they can set the arguments through a static method.</span></span> <span data-ttu-id="4b323-161">Na przykład poniższy kod ustawia "uznanie klienta", które nagradza każdego klienta z więcej niż jednego miesiąca członkostwa:</span><span class="sxs-lookup"><span data-stu-id="4b323-161">For example, the following code sets a "customer appreciation" that rewards any customer with more than one month's membership:</span></span>

[!code-csharp[SetLoyaltyThresholds](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/Program.cs?name=SnippetSetLoyaltyThresholds)]

## <a name="extend-the-default-implementation"></a><span data-ttu-id="4b323-162">Rozszerzanie implementacji domyślnej</span><span class="sxs-lookup"><span data-stu-id="4b323-162">Extend the default implementation</span></span>

<span data-ttu-id="4b323-163">Kod, który został dodany do tej pory dostarczył wygodną implementację dla tych scenariuszy, w których użytkownicy chcą coś w rodzaju domyślnej implementacji lub aby zapewnić niepowiązany zestaw reguł.</span><span class="sxs-lookup"><span data-stu-id="4b323-163">The code you've added so far has provided a convenient implementation for those scenarios where users want something like the default implementation, or to provide an unrelated set of rules.</span></span> <span data-ttu-id="4b323-164">W przypadku końcowej funkcji refaktoryzacji kodu nieco, aby włączyć scenariusze, w których użytkownicy mogą chcieć tworzyć na domyślnej implementacji.</span><span class="sxs-lookup"><span data-stu-id="4b323-164">For a final feature, let's refactor the code a bit to enable scenarios where users may want to build on the default implementation.</span></span>

<span data-ttu-id="4b323-165">Rozważmy startup, który chce przyciągnąć nowych klientów.</span><span class="sxs-lookup"><span data-stu-id="4b323-165">Consider a startup that wants to attract new customers.</span></span> <span data-ttu-id="4b323-166">Oferują one 50% zniżki na pierwsze zamówienie nowego klienta.</span><span class="sxs-lookup"><span data-stu-id="4b323-166">They offer a 50% discount off a new customer's first order.</span></span> <span data-ttu-id="4b323-167">W przeciwnym razie istniejący klienci otrzymują standardowy rabat.</span><span class="sxs-lookup"><span data-stu-id="4b323-167">Otherwise, existing customers get the standard discount.</span></span> <span data-ttu-id="4b323-168">Autor biblioteki musi przenieść implementację `protected static` domyślną do metody, aby każda klasa implementująca ten interfejs mogła ponownie użyć kodu w swojej implementacji.</span><span class="sxs-lookup"><span data-stu-id="4b323-168">The library author needs to move the default implementation into a `protected static` method so that any class implementing this interface can reuse the code in their implementation.</span></span> <span data-ttu-id="4b323-169">Domyślna implementacja elementu członkowskiego interfejsu wywołuje tę metodę udostępnioną, jak również:</span><span class="sxs-lookup"><span data-stu-id="4b323-169">The default implementation of the interface member calls this shared method as well:</span></span>

[!code-csharp[VersionTwoImplementation](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/ICustomer.cs?name=SnippetFinalVersion)]

<span data-ttu-id="4b323-170">W implementacji klasy, która implementuje ten interfejs, zastąpienie można wywołać metodę pomocnika statycznego i rozszerzyć tę logikę, aby zapewnić rabat "nowego klienta":</span><span class="sxs-lookup"><span data-stu-id="4b323-170">In an implementation of a class that implements this interface, the override can call the static helper method, and extend that logic to provide the "new customer" discount:</span></span>

[!code-csharp[VersionTwoImplementation](~/samples/snippets/csharp/tutorials/default-interface-members-versions/finished/customer-relationship/SampleCustomer.cs?name=SnippetOverrideAndExtend)]

<span data-ttu-id="4b323-171">Możesz zobaczyć cały gotowy kod w naszym [reppo przykładów na GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/finished/customer-relationship).</span><span class="sxs-lookup"><span data-stu-id="4b323-171">You can see the entire finished code in our [samples repo on GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/finished/customer-relationship).</span></span> <span data-ttu-id="4b323-172">Możesz uzyskać aplikację startową na naszym [reppo próbek na GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/starter/customer-relationship).</span><span class="sxs-lookup"><span data-stu-id="4b323-172">You can get the starter application on our [samples repo on GitHub](https://github.com/dotnet/samples/tree/master/csharp/tutorials/default-interface-members-versions/starter/customer-relationship).</span></span>

<span data-ttu-id="4b323-173">Te nowe funkcje oznaczają, że interfejsy mogą być aktualizowane bezpiecznie, gdy istnieje rozsądna domyślna implementacja dla tych nowych członków.</span><span class="sxs-lookup"><span data-stu-id="4b323-173">These new features mean that interfaces can be updated safely when there's a reasonable default implementation for those new members.</span></span> <span data-ttu-id="4b323-174">Starannie projektuj interfejsy, aby wyrazić pojedyncze pomysły funkcjonalne, które mogą być implementowane przez wiele klas.</span><span class="sxs-lookup"><span data-stu-id="4b323-174">Carefully design interfaces to express single functional ideas that can be implemented by multiple classes.</span></span> <span data-ttu-id="4b323-175">Ułatwia to uaktualnienie tych definicji interfejsu, gdy zostaną wykryte nowe wymagania dla tego samego pomysłu funkcjonalnego.</span><span class="sxs-lookup"><span data-stu-id="4b323-175">That makes it easier to upgrade those interface definitions when new requirements are discovered for that same functional idea.</span></span>
