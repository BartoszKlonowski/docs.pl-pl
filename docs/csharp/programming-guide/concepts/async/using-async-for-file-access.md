---
title: Asynchroniczny dostęp do plików (C#)
description: Dowiedz się, jak korzystać z funkcji asynchronicznej w celu uzyskiwania dostępu do plików w języku C#. Można wywołać metody asynchroniczne bez używania wywołań zwrotnych lub dzieląc kod w różnych metodach.
ms.date: 08/19/2020
ms.assetid: bb018fea-5313-4c80-ab3f-7c24b2145bd9
ms.openlocfilehash: 9a8db6004e8fff2cb39f0c350b403b56ea619e54
ms.sourcegitcommit: 9c45035b781caebc63ec8ecf912dc83fb6723b1f
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/25/2020
ms.locfileid: "88812045"
---
# <a name="asynchronous-file-access-c"></a><span data-ttu-id="3864e-104">Asynchroniczny dostęp do plików (C#)</span><span class="sxs-lookup"><span data-stu-id="3864e-104">Asynchronous file access (C#)</span></span>

<span data-ttu-id="3864e-105">Do uzyskiwania dostępu do plików można użyć funkcji asynchronicznej.</span><span class="sxs-lookup"><span data-stu-id="3864e-105">You can use the async feature to access files.</span></span> <span data-ttu-id="3864e-106">Za pomocą funkcji asynchronicznej można wywołać metody asynchroniczne bez używania wywołań zwrotnych lub dzieląc kod w wielu metodach lub wyrażeniach lambda.</span><span class="sxs-lookup"><span data-stu-id="3864e-106">By using the async feature, you can call into asynchronous methods without using callbacks or splitting your code across multiple methods or lambda expressions.</span></span> <span data-ttu-id="3864e-107">Aby przeprowadzić synchroniczne asynchroniczne kod, wystarczy wywołać metodę asynchroniczną zamiast metody synchronicznej i dodać kilka słów kluczowych do kodu.</span><span class="sxs-lookup"><span data-stu-id="3864e-107">To make synchronous code asynchronous, you just call an asynchronous method instead of a synchronous method and add a few keywords to the code.</span></span>

<span data-ttu-id="3864e-108">Aby dodać asynchroniczności do wywołań dostępu do plików, należy wziąć pod uwagę następujące przyczyny:</span><span class="sxs-lookup"><span data-stu-id="3864e-108">You might consider the following reasons for adding asynchrony to file access calls:</span></span>

> [!div class="checklist"]
>
> - <span data-ttu-id="3864e-109">Asynchroniczności sprawia, że aplikacje interfejsu użytkownika działają szybciej, ponieważ wątek interfejsu użytkownika uruchamiający operację może wykonać inne czynności.</span><span class="sxs-lookup"><span data-stu-id="3864e-109">Asynchrony makes UI applications more responsive because the UI thread that launches the operation can perform other work.</span></span> <span data-ttu-id="3864e-110">Jeśli wątek interfejsu użytkownika musi wykonać kod, który zajmuje dużo czasu (na przykład więcej niż 50 milisekund), interfejs użytkownika może się zamrozić do momentu zakończenia operacji we/wy, a wątek interfejsu użytkownika może ponownie przetwarzać dane wejściowe klawiatury i myszy oraz inne zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="3864e-110">If the UI thread must execute code that takes a long time (for example, more than 50 milliseconds), the UI may freeze until the I/O is complete and the UI thread can again process keyboard and mouse input and other events.</span></span>
> - <span data-ttu-id="3864e-111">Asynchroniczności poprawia skalowalność ASP.NET i innych aplikacji opartych na serwerze, zmniejszając potrzebę wątków.</span><span class="sxs-lookup"><span data-stu-id="3864e-111">Asynchrony improves the scalability of ASP.NET and other server-based applications by reducing the need for threads.</span></span> <span data-ttu-id="3864e-112">Jeśli aplikacja korzysta z dedykowanego wątku na odpowiedź i jednocześnie są obsługiwane tysiące żądań, są zbędne tysiące wątków.</span><span class="sxs-lookup"><span data-stu-id="3864e-112">If the application uses a dedicated thread per response and a thousand requests are being handled simultaneously, a thousand threads are needed.</span></span> <span data-ttu-id="3864e-113">Operacje asynchroniczne często nie muszą używać wątku podczas oczekiwania.</span><span class="sxs-lookup"><span data-stu-id="3864e-113">Asynchronous operations often don't need to use a thread during the wait.</span></span> <span data-ttu-id="3864e-114">Z chwilą korzystają z istniejącego wątku zakończenia operacji we/wy.</span><span class="sxs-lookup"><span data-stu-id="3864e-114">They use the existing I/O completion thread briefly at the end.</span></span>
> - <span data-ttu-id="3864e-115">Opóźnienie operacji dostępu do pliku może być bardzo niskie w bieżących warunkach, ale opóźnienie może znacznie wzrosnąć w przyszłości.</span><span class="sxs-lookup"><span data-stu-id="3864e-115">The latency of a file access operation might be very low under current conditions, but the latency may greatly increase in the future.</span></span> <span data-ttu-id="3864e-116">Na przykład plik można przenieść na serwer, na którym znajduje się na całym świecie.</span><span class="sxs-lookup"><span data-stu-id="3864e-116">For example, a file may be moved to a server that's across the world.</span></span>
> - <span data-ttu-id="3864e-117">Dodatkowe obciążenie związane z korzystaniem z funkcji asynchronicznej jest małe.</span><span class="sxs-lookup"><span data-stu-id="3864e-117">The added overhead of using the Async feature is small.</span></span>
> - <span data-ttu-id="3864e-118">Zadania asynchroniczne można łatwo uruchomić równolegle.</span><span class="sxs-lookup"><span data-stu-id="3864e-118">Asynchronous tasks can easily be run in parallel.</span></span>

## <a name="use-appropriate-classes"></a><span data-ttu-id="3864e-119">Użyj odpowiednich klas</span><span class="sxs-lookup"><span data-stu-id="3864e-119">Use appropriate classes</span></span>

<span data-ttu-id="3864e-120">Proste przykłady w tym temacie pokazują <xref:System.IO.File.WriteAllTextAsync%2A?displayProperty=nameWithType> i <xref:System.IO.File.ReadAllTextAsync%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="3864e-120">The simple examples in this topic demonstrate <xref:System.IO.File.WriteAllTextAsync%2A?displayProperty=nameWithType> and <xref:System.IO.File.ReadAllTextAsync%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="3864e-121">W celu uzyskania ograniczonej kontroli nad operacjami we/wy pliku Użyj <xref:System.IO.FileStream> klasy, która powoduje, że asynchroniczne operacje we/wy są wykonywane na poziomie systemu operacyjnego.</span><span class="sxs-lookup"><span data-stu-id="3864e-121">For finite control over the file I/O operations, use the <xref:System.IO.FileStream> class, which has an option that causes asynchronous I/O to occur at the operating system level.</span></span> <span data-ttu-id="3864e-122">Korzystając z tej opcji, można uniknąć blokowania wątku puli wątków w wielu przypadkach.</span><span class="sxs-lookup"><span data-stu-id="3864e-122">By using this option, you can avoid blocking a thread pool thread in many cases.</span></span> <span data-ttu-id="3864e-123">Aby włączyć tę opcję, należy określić `useAsync=true` argument or `options=FileOptions.Asynchronous` w wywołaniu konstruktora.</span><span class="sxs-lookup"><span data-stu-id="3864e-123">To enable this option, you specify the `useAsync=true` or `options=FileOptions.Asynchronous` argument in the constructor call.</span></span>

<span data-ttu-id="3864e-124">Nie można użyć tej opcji razem z <xref:System.IO.StreamReader> i, <xref:System.IO.StreamWriter> Jeśli otworzysz je bezpośrednio, określając ścieżkę pliku.</span><span class="sxs-lookup"><span data-stu-id="3864e-124">You can't use this option with <xref:System.IO.StreamReader> and <xref:System.IO.StreamWriter> if you open them directly by specifying a file path.</span></span> <span data-ttu-id="3864e-125">Można jednak użyć tej opcji, jeśli podajesz im <xref:System.IO.Stream> , że została <xref:System.IO.FileStream> otwarta Klasa.</span><span class="sxs-lookup"><span data-stu-id="3864e-125">However, you can use this option if you provide them a <xref:System.IO.Stream> that the <xref:System.IO.FileStream> class opened.</span></span> <span data-ttu-id="3864e-126">Wywołania asynchroniczne są szybsze w aplikacjach interfejsu użytkownika, nawet jeśli wątek puli wątków jest zablokowany, ponieważ wątek interfejsu użytkownika nie jest blokowany podczas oczekiwania.</span><span class="sxs-lookup"><span data-stu-id="3864e-126">Asynchronous calls are faster in UI apps even if a thread pool thread is blocked, because the UI thread isn't blocked during the wait.</span></span>

## <a name="write-text"></a><span data-ttu-id="3864e-127">Zapisz tekst</span><span class="sxs-lookup"><span data-stu-id="3864e-127">Write text</span></span>

<span data-ttu-id="3864e-128">Poniższe przykłady zapisują tekst do pliku.</span><span class="sxs-lookup"><span data-stu-id="3864e-128">The following examples write text to a file.</span></span> <span data-ttu-id="3864e-129">W każdej instrukcji Await Metoda natychmiast opuszcza.</span><span class="sxs-lookup"><span data-stu-id="3864e-129">At each await statement, the method immediately exits.</span></span> <span data-ttu-id="3864e-130">Po zakończeniu operacji we/wy pliku Metoda zostaje wznowiona przy użyciu instrukcji, która następuje po instrukcji Await.</span><span class="sxs-lookup"><span data-stu-id="3864e-130">When the file I/O is complete, the method resumes at the statement that follows the await statement.</span></span> <span data-ttu-id="3864e-131">Modyfikator Async jest w definicji metod, które używają instrukcji Await.</span><span class="sxs-lookup"><span data-stu-id="3864e-131">The async modifier is in the definition of methods that use the await statement.</span></span>

### <a name="simple-example"></a><span data-ttu-id="3864e-132">Prosty przykład</span><span class="sxs-lookup"><span data-stu-id="3864e-132">Simple example</span></span>

:::code language="csharp" source="snippets/file-access/Program.cs" id="SimpleWrite":::

### <a name="finite-control-example"></a><span data-ttu-id="3864e-133">Przykład skończonego formantu</span><span class="sxs-lookup"><span data-stu-id="3864e-133">Finite control example</span></span>

:::code language="csharp" source="snippets/file-access/Program.cs" id="WriteText":::

<span data-ttu-id="3864e-134">Oryginalny przykład zawiera instrukcję `await sourceStream.WriteAsync(encodedText, 0, encodedText.Length);` , która jest umową obejmującą następujące dwie instrukcje:</span><span class="sxs-lookup"><span data-stu-id="3864e-134">The original example has the statement `await sourceStream.WriteAsync(encodedText, 0, encodedText.Length);`, which is a contraction of the following two statements:</span></span>

```csharp
Task theTask = sourceStream.WriteAsync(encodedText, 0, encodedText.Length);
await theTask;
```

<span data-ttu-id="3864e-135">Pierwsza instrukcja zwraca zadanie i powoduje uruchomienie przetwarzania plików.</span><span class="sxs-lookup"><span data-stu-id="3864e-135">The first statement returns a task and causes file processing to start.</span></span> <span data-ttu-id="3864e-136">Druga instrukcja z Await powoduje, że metoda natychmiast zakończy działanie i zwróci inne zadanie.</span><span class="sxs-lookup"><span data-stu-id="3864e-136">The second statement with the await causes the method to immediately exit and return a different task.</span></span> <span data-ttu-id="3864e-137">Po późniejszym zakończeniu przetwarzania plików wykonanie powraca do instrukcji, która następuje po oczekiwania.</span><span class="sxs-lookup"><span data-stu-id="3864e-137">When the file processing later completes, execution returns to the statement that follows the await.</span></span>

## <a name="read-text"></a><span data-ttu-id="3864e-138">Odczytaj tekst</span><span class="sxs-lookup"><span data-stu-id="3864e-138">Read text</span></span>

<span data-ttu-id="3864e-139">Poniższe przykłady odczytują tekst z pliku.</span><span class="sxs-lookup"><span data-stu-id="3864e-139">The following examples read text from a file.</span></span>

### <a name="simple-example"></a><span data-ttu-id="3864e-140">Prosty przykład</span><span class="sxs-lookup"><span data-stu-id="3864e-140">Simple example</span></span>

:::code language="csharp" source="snippets/file-access/Program.cs" id="SimpleRead":::

### <a name="finite-control-example"></a><span data-ttu-id="3864e-141">Przykład skończonego formantu</span><span class="sxs-lookup"><span data-stu-id="3864e-141">Finite control example</span></span>

<span data-ttu-id="3864e-142">Tekst jest buforowany i, w tym przypadku, umieszczony w <xref:System.Text.StringBuilder> .</span><span class="sxs-lookup"><span data-stu-id="3864e-142">The text is buffered and, in this case, placed into a <xref:System.Text.StringBuilder>.</span></span> <span data-ttu-id="3864e-143">W przeciwieństwie do poprzedniego przykładu, obliczanie oczekiwania powoduje utworzenie wartości.</span><span class="sxs-lookup"><span data-stu-id="3864e-143">Unlike in the previous example, the evaluation of the await produces a value.</span></span> <span data-ttu-id="3864e-144"><xref:System.IO.Stream.ReadAsync%2A>Metoda zwraca <xref:System.Threading.Tasks.Task> \<<xref:System.Int32>>, więc Ocena await generuje `Int32` wartość `numRead` po zakończeniu operacji.</span><span class="sxs-lookup"><span data-stu-id="3864e-144">The <xref:System.IO.Stream.ReadAsync%2A> method returns a <xref:System.Threading.Tasks.Task>\<<xref:System.Int32>>, so the evaluation of the await produces an `Int32` value `numRead` after the operation completes.</span></span> <span data-ttu-id="3864e-145">Aby uzyskać więcej informacji, zobacz [asynchroniczne typy zwracane (C#)](async-return-types.md).</span><span class="sxs-lookup"><span data-stu-id="3864e-145">For more information, see [Async Return Types (C#)](async-return-types.md).</span></span>

:::code language="csharp" source="snippets/file-access/Program.cs" id="ReadText":::

## <a name="parallel-asynchronous-io"></a><span data-ttu-id="3864e-146">Równoległe asynchroniczne operacje we/wy</span><span class="sxs-lookup"><span data-stu-id="3864e-146">Parallel asynchronous I/O</span></span>

<span data-ttu-id="3864e-147">W poniższych przykładach pokazano przetwarzanie równoległe, pisząc 10 plików tekstowych.</span><span class="sxs-lookup"><span data-stu-id="3864e-147">The following examples demonstrate parallel processing by writing 10 text files.</span></span>

### <a name="simple-example"></a><span data-ttu-id="3864e-148">Prosty przykład</span><span class="sxs-lookup"><span data-stu-id="3864e-148">Simple example</span></span>

:::code language="csharp" source="snippets/file-access/Program.cs" id="SimpleParallelWrite":::

### <a name="finite-control-example"></a><span data-ttu-id="3864e-149">Przykład skończonego formantu</span><span class="sxs-lookup"><span data-stu-id="3864e-149">Finite control example</span></span>

<span data-ttu-id="3864e-150">Dla każdego pliku <xref:System.IO.Stream.WriteAsync%2A> Metoda zwraca zadanie, które jest następnie dodawane do listy zadań.</span><span class="sxs-lookup"><span data-stu-id="3864e-150">For each file, the <xref:System.IO.Stream.WriteAsync%2A> method returns a task that is then added to a list of tasks.</span></span> <span data-ttu-id="3864e-151">`await Task.WhenAll(tasks);`Instrukcja kończy metodę i wznawia działanie w ramach metody po zakończeniu przetwarzania plików dla wszystkich zadań.</span><span class="sxs-lookup"><span data-stu-id="3864e-151">The `await Task.WhenAll(tasks);` statement exits the method and resumes within the method when file processing is complete for all of the tasks.</span></span>

<span data-ttu-id="3864e-152">Przykład zamyka wszystkie <xref:System.IO.FileStream> wystąpienia w `finally` bloku po zakończeniu zadań.</span><span class="sxs-lookup"><span data-stu-id="3864e-152">The example closes all <xref:System.IO.FileStream> instances in a `finally` block after the tasks are complete.</span></span> <span data-ttu-id="3864e-153">Jeśli każdy z `FileStream` nich został utworzony w `using` instrukcji, `FileStream` może zostać usunięty przed ukończeniem zadania.</span><span class="sxs-lookup"><span data-stu-id="3864e-153">If each `FileStream` was instead created in a `using` statement, the `FileStream` might be disposed of before the task was complete.</span></span>

<span data-ttu-id="3864e-154">Wszelkie zwiększenia wydajności są niemal całkowicie od przetwarzania równoległego, a nie do przetwarzania asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="3864e-154">Any performance boost is almost entirely from the parallel processing and not the asynchronous processing.</span></span> <span data-ttu-id="3864e-155">Zalety asynchroniczności są takie same, że nie wiążą się z wieloma wątkami i nie wiążą się z wątkiem interfejsu użytkownika.</span><span class="sxs-lookup"><span data-stu-id="3864e-155">The advantages of asynchrony are that it doesn't tie up multiple threads, and that it doesn't tie up the user interface thread.</span></span>

:::code language="csharp" source="snippets/file-access/Program.cs" id="ParallelWriteText":::

<span data-ttu-id="3864e-156">W przypadku korzystania <xref:System.IO.Stream.WriteAsync%2A> z <xref:System.IO.Stream.ReadAsync%2A> metod i można określić <xref:System.Threading.CancellationToken> , której można użyć do anulowania strumienia średniej operacji.</span><span class="sxs-lookup"><span data-stu-id="3864e-156">When using the <xref:System.IO.Stream.WriteAsync%2A> and <xref:System.IO.Stream.ReadAsync%2A> methods, you can specify a <xref:System.Threading.CancellationToken>, which you can use to cancel the operation mid-stream.</span></span> <span data-ttu-id="3864e-157">Aby uzyskać więcej informacji, zobacz [Anulowanie w zarządzanych wątkach](../../../../standard/threading/cancellation-in-managed-threads.md).</span><span class="sxs-lookup"><span data-stu-id="3864e-157">For more information, see [Cancellation in managed threads](../../../../standard/threading/cancellation-in-managed-threads.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="3864e-158">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="3864e-158">See also</span></span>

- [<span data-ttu-id="3864e-159">Programowanie asynchroniczne z Async i Await (C#)</span><span class="sxs-lookup"><span data-stu-id="3864e-159">Asynchronous programming with async and await (C#)</span></span>](index.md)
- [<span data-ttu-id="3864e-160">Asynchroniczne typy zwracane (C#)</span><span class="sxs-lookup"><span data-stu-id="3864e-160">Async return types (C#)</span></span>](async-return-types.md)
