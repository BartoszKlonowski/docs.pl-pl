---
title: Programowanie asynchroniczne w języku C#
description: Omówienie C# Obsługa języków programowania asynchronicznego przy użyciu async, operator await, zadań i zadań<T>
ms.date: 03/18/2019
ms.openlocfilehash: a306ff75357f9f61ec9b086485472d99de5ad083
ms.sourcegitcommit: a970268118ea61ce14207e0916e17243546a491f
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 06/21/2019
ms.locfileid: "67307126"
---
# <a name="the-task-asynchronous-programming-model-in-c"></a><span data-ttu-id="457a7-103">Zadania asynchronicznego modelu programowania w języku C\#</span><span class="sxs-lookup"><span data-stu-id="457a7-103">The Task asynchronous programming model in C\#</span></span>

<span data-ttu-id="457a7-104">Z zadań modelu programowania asynchronicznego (TAP) udostępnia abstrakcję za pośrednictwem kodu asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="457a7-104">The Task asynchronous programming model (TAP) provides an abstraction over asynchronous code.</span></span> <span data-ttu-id="457a7-105">Pisanie kodu jako sekwencja instrukcji, tak jak zawsze.</span><span class="sxs-lookup"><span data-stu-id="457a7-105">You write code as a sequence of statements, just like always.</span></span> <span data-ttu-id="457a7-106">Możesz przeczytać ten kod tak, jakby każda instrukcja kończy się przed rozpoczęciem następnego.</span><span class="sxs-lookup"><span data-stu-id="457a7-106">You can read that code as though each statement completes before the next begins.</span></span> <span data-ttu-id="457a7-107">Kompilator wykonuje szereg przekształcenia, ponieważ niektóre z tych instrukcji może rozpocząć pracę i zwracają <xref:System.Threading.Tasks.Task> reprezentujący pracy w toku.</span><span class="sxs-lookup"><span data-stu-id="457a7-107">The compiler performs a number of transformations because some of those statements may start work and return a <xref:System.Threading.Tasks.Task> that represents the ongoing work.</span></span>

<span data-ttu-id="457a7-108">Jest celem tej składni: Włącz kod odczytuje np. sekwencja instrukcji, ale jest wykonywany w kolejności dużo bardziej skomplikowany, oparte na alokacji zasobów zewnętrznych, a po zakończeniu zadania.</span><span class="sxs-lookup"><span data-stu-id="457a7-108">That's the goal of this syntax: enable code that reads like a sequence of statements, but executes in a much more complicated order based on external resource allocation and when tasks complete.</span></span> <span data-ttu-id="457a7-109">Jest to analogiczne jak osoby wskazówki dotyczące procesów, które obejmuje zadań asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="457a7-109">It's analogous to how people give instructions for processes that include asynchronous tasks.</span></span> <span data-ttu-id="457a7-110">W tym artykule użyjemy przykładowe instrukcje dokonywania śniadanie, aby zobaczyć, jak `async` i `await` słowa kluczowe ułatwiają przeglądanie informacji o kod, który zawiera szereg instrukcji asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="457a7-110">Throughout this article, you'll use an example of instructions for making a breakfast to see how the `async` and `await` keywords make it easier to reason about code that includes a series of asynchronous instructions.</span></span> <span data-ttu-id="457a7-111">Możesz napisać instrukcje podobną do poniższej liście, aby wyjaśnić, jak śniadanie:</span><span class="sxs-lookup"><span data-stu-id="457a7-111">You'd write the instructions something like the following list to explain how to make a breakfast:</span></span>

1. <span data-ttu-id="457a7-112">Umieścić napić się kawy.</span><span class="sxs-lookup"><span data-stu-id="457a7-112">Pour a cup of coffee.</span></span>
1. <span data-ttu-id="457a7-113">Cieplnej się pan, a następnie FRJ potrawach dwa.</span><span class="sxs-lookup"><span data-stu-id="457a7-113">Heat up a pan, then fry two eggs.</span></span>
1. <span data-ttu-id="457a7-114">FRJ trzy wycinki bekon.</span><span class="sxs-lookup"><span data-stu-id="457a7-114">Fry three slices of bacon.</span></span>
1. <span data-ttu-id="457a7-115">Wyskakujące dwóch rodzajów chleb.</span><span class="sxs-lookup"><span data-stu-id="457a7-115">Toast two pieces of bread.</span></span>
1. <span data-ttu-id="457a7-116">Dodaj masła i zakleszczenie do wyskakującego powiadomienia.</span><span class="sxs-lookup"><span data-stu-id="457a7-116">Add butter and jam to the toast.</span></span>
1. <span data-ttu-id="457a7-117">Umieścić szkła soku pomarańczowego.</span><span class="sxs-lookup"><span data-stu-id="457a7-117">Pour a glass of orange juice.</span></span>

<span data-ttu-id="457a7-118">W przypadku korzystania z gotowania może wykonać te instrukcje **asynchronicznie**.</span><span class="sxs-lookup"><span data-stu-id="457a7-118">If you have experience with cooking, you'd execute those instructions **asynchronously**.</span></span> <span data-ttu-id="457a7-119">czy start ciepły pan dla potrawach, a następnie uruchomić bekon.</span><span class="sxs-lookup"><span data-stu-id="457a7-119">You'd start warming the pan for eggs, then start the bacon.</span></span> <span data-ttu-id="457a7-120">Czy umieścić chleb w tostera, a następnie uruchomić potrawach.</span><span class="sxs-lookup"><span data-stu-id="457a7-120">You'd put the bread in the toaster, then start the eggs.</span></span> <span data-ttu-id="457a7-121">W każdym kroku procesu można będzie uruchomić zadanie, a następnie zwrócić uwagę na zadania, które są gotowe do Twojej uwagi.</span><span class="sxs-lookup"><span data-stu-id="457a7-121">At each step of the process, you'd start a task, then turn your attention to tasks that are ready for your attention.</span></span>

<span data-ttu-id="457a7-122">Gotowania śniadanie jest dobrym przykładem pracę asynchroniczną, która nie jest równoległe.</span><span class="sxs-lookup"><span data-stu-id="457a7-122">Cooking breakfast is a good example of asynchronous work that isn't parallel.</span></span> <span data-ttu-id="457a7-123">Jedna osoba (lub wątek) może obsługiwać te zadania.</span><span class="sxs-lookup"><span data-stu-id="457a7-123">One person (or thread) can handle all these tasks.</span></span> <span data-ttu-id="457a7-124">Trwając w sposób analogiczny śniadanie, jedna osoba ułatwia śniadanie asynchronicznie przez uruchomienie kolejnego przed ukończeniem pierwszego.</span><span class="sxs-lookup"><span data-stu-id="457a7-124">Continuing the breakfast analogy, one person can make breakfast asynchronously by starting the next task before the first completes.</span></span> <span data-ttu-id="457a7-125">Gotowania w miarę czy ktoś obserwuje go.</span><span class="sxs-lookup"><span data-stu-id="457a7-125">The cooking progresses whether or not someone is watching it.</span></span> <span data-ttu-id="457a7-126">Zaraz po uruchomieniu ciepły pan dla potrawach, możesz rozpocząć smażeniu bekon.</span><span class="sxs-lookup"><span data-stu-id="457a7-126">As soon as you start warming the pan for the eggs, you can begin frying the bacon.</span></span> <span data-ttu-id="457a7-127">Po rozpoczęciu bekon można umieścić chleb w tostera.</span><span class="sxs-lookup"><span data-stu-id="457a7-127">Once the bacon starts, you can put the bread into the toaster.</span></span>

<span data-ttu-id="457a7-128">Dla algorytmu równoległego będziesz potrzebować wielu kucharzy (lub wątki).</span><span class="sxs-lookup"><span data-stu-id="457a7-128">For a parallel algorithm, you'd need multiple cooks (or threads).</span></span> <span data-ttu-id="457a7-129">Jeden czyniłyby potrawach, jeden bekon, i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="457a7-129">One would make the eggs, one the bacon, and so on.</span></span> <span data-ttu-id="457a7-130">Każdy z nich będzie koncentrować się na wystarczy, że jedno zadanie.</span><span class="sxs-lookup"><span data-stu-id="457a7-130">Each one would be focused on just that one task.</span></span> <span data-ttu-id="457a7-131">Każdy Cooka (lub wątek) zostałby zablokowany synchronicznie oczekuje bekon gotowość do przerzucenia lub wyskakujące przeskoczyć do.</span><span class="sxs-lookup"><span data-stu-id="457a7-131">Each cook (or thread) would be blocked synchronously waiting for bacon to be ready to flip, or the toast to pop.</span></span> 

<span data-ttu-id="457a7-132">Teraz należy wziąć pod uwagę te tych samych instrukcji, zapisywane jako C# instrukcji:</span><span class="sxs-lookup"><span data-stu-id="457a7-132">Now, consider those same instructions written as C# statements:</span></span>

[!code-csharp[SynchronousBreakfast](~/samples/snippets/csharp/tour-of-async/AsyncBreakfast-starter/Program.cs#Main)]

<span data-ttu-id="457a7-133">Komputery nie interpretuje tych instrukcji, co zrobić z tymi samymi osobami sposób.</span><span class="sxs-lookup"><span data-stu-id="457a7-133">Computers don't interpret those instructions the same way people do.</span></span> <span data-ttu-id="457a7-134">Komputer będzie blokować na każdej instrukcji, przed zakończeniem pracy przed przejściem do następnej instrukcji.</span><span class="sxs-lookup"><span data-stu-id="457a7-134">The computer will block on each statement until the work is complete before moving on to the next statement.</span></span> <span data-ttu-id="457a7-135">Tworząca unsatisfying śniadanie.</span><span class="sxs-lookup"><span data-stu-id="457a7-135">That creates an unsatisfying breakfast.</span></span> <span data-ttu-id="457a7-136">Nie można uruchomić kolejnych zadaniach, aż do zakończenia miał wcześniej zadania.</span><span class="sxs-lookup"><span data-stu-id="457a7-136">The later tasks wouldn't be started until the earlier tasks had completed.</span></span> <span data-ttu-id="457a7-137">Zajęłoby znacznie dłużej w celu utworzenia śniadanie, a niektóre elementy będą stają się coraz zimnych przed obsługiwanych.</span><span class="sxs-lookup"><span data-stu-id="457a7-137">It would take much longer to create the breakfast, and some items would have gotten cold before being served.</span></span> 

<span data-ttu-id="457a7-138">Jeśli chcesz, aby komputer asynchroniczne wykonywanie instrukcje powyżej, należy napisać kod asynchroniczny.</span><span class="sxs-lookup"><span data-stu-id="457a7-138">If you want the computer to execute the above instructions asynchronously, you must write asynchronous code.</span></span>

<span data-ttu-id="457a7-139">Te rozważania są ważne dla programów, które piszesz już dziś.</span><span class="sxs-lookup"><span data-stu-id="457a7-139">These concerns are important for the programs you write today.</span></span> <span data-ttu-id="457a7-140">Podczas pisania programów klienckich ma interfejsu użytkownika, aby reagować na dane wejściowe użytkownika.</span><span class="sxs-lookup"><span data-stu-id="457a7-140">When you write client programs, you want the UI to be responsive to user input.</span></span> <span data-ttu-id="457a7-141">Aplikacja nie powinna upewnij telefonu sprawiać wrażenie podczas pobierania danych z sieci web.</span><span class="sxs-lookup"><span data-stu-id="457a7-141">Your application shouldn't make a phone appear frozen while it's downloading data from the web.</span></span> <span data-ttu-id="457a7-142">Podczas pisania programów serwera, które nie mają zablokowane wątki.</span><span class="sxs-lookup"><span data-stu-id="457a7-142">When you write server programs, you don't want threads blocked.</span></span> <span data-ttu-id="457a7-143">Te wątki mogą obsługująca innych żądań.</span><span class="sxs-lookup"><span data-stu-id="457a7-143">Those threads could be serving other requests.</span></span> <span data-ttu-id="457a7-144">Przy użyciu kodu synchronicznego, gdy asynchronicznych rozwiązań alternatywnych istnieją dobrze jest możliwość skalowania w poziomie mniej opracowanego.</span><span class="sxs-lookup"><span data-stu-id="457a7-144">Using synchronous code when asynchronous alternatives exist hurts your ability to scale out less expensively.</span></span> <span data-ttu-id="457a7-145">Płacisz za tych zablokowane wątki.</span><span class="sxs-lookup"><span data-stu-id="457a7-145">You pay for those blocked threads.</span></span>

<span data-ttu-id="457a7-146">Pomyślne nowoczesne aplikacje wymagają kodu asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="457a7-146">Successful modern applications require asynchronous code.</span></span> <span data-ttu-id="457a7-147">Bez obsługi języka kodu asynchronicznego zapisywać wywołań zwrotnych, zakończenia zdarzenia lub inne oznacza, że zostanie przesłonięty, oryginalnym celem kodu.</span><span class="sxs-lookup"><span data-stu-id="457a7-147">Without language support, writing asynchronous code required callbacks, completion events, or other means that obscured the original intent of the code.</span></span> <span data-ttu-id="457a7-148">Zaletą synchroniczny kod jest ona łatwa do zrozumienia.</span><span class="sxs-lookup"><span data-stu-id="457a7-148">The advantage of the synchronous code is that it's easy to understand.</span></span> <span data-ttu-id="457a7-149">Akcje krok po kroku ułatwiają przeskanować i zrozumieć.</span><span class="sxs-lookup"><span data-stu-id="457a7-149">The step-by-step actions make it easy to scan and understand.</span></span> <span data-ttu-id="457a7-150">Tradycyjne modelami asynchronicznymi wymuszone możesz skoncentrować się na asynchroniczne rodzaj kodu, a nie na podstawowe działania kodu.</span><span class="sxs-lookup"><span data-stu-id="457a7-150">Traditional asynchronous models forced you to focus on the asynchronous nature of the code, not on the fundamental actions of the code.</span></span>

## <a name="dont-block-await-instead"></a><span data-ttu-id="457a7-151">Nie blokuj, zamiast tego await</span><span class="sxs-lookup"><span data-stu-id="457a7-151">Don't block, await instead</span></span>

<span data-ttu-id="457a7-152">Poprzedni kod pokazuje złym zwyczajem: konstruowanie synchroniczny kod w celu wykonywania operacji asynchronicznej.</span><span class="sxs-lookup"><span data-stu-id="457a7-152">The preceding code demonstrates a bad practice: constructing synchronous code to perform asynchronous operations.</span></span> <span data-ttu-id="457a7-153">W ten kod blokuje wątku, ale wykonanie go z innymi dostawcami.</span><span class="sxs-lookup"><span data-stu-id="457a7-153">As written, this code blocks the thread executing it from doing any other work.</span></span> <span data-ttu-id="457a7-154">Nie były wyświetlane, gdy dowolne zadania są w toku.</span><span class="sxs-lookup"><span data-stu-id="457a7-154">It won't be interrupted while any of the tasks are in progress.</span></span> <span data-ttu-id="457a7-155">Jest tak, jakby stared na tostera po umieszczenie chleb w.</span><span class="sxs-lookup"><span data-stu-id="457a7-155">It would be as though you stared at the toaster after putting the bread in.</span></span> <span data-ttu-id="457a7-156">Czy można zignorować każdy rozmawiając aż wyskakujące zdjęte ze stosu.</span><span class="sxs-lookup"><span data-stu-id="457a7-156">You'd ignore anyone talking to you until the toast popped.</span></span> 

<span data-ttu-id="457a7-157">Zacznijmy od, aktualizując ten kod, tak aby nie blokuje wątku, podczas wykonywania zadania.</span><span class="sxs-lookup"><span data-stu-id="457a7-157">Let's start by updating this code so that the thread doesn't block while tasks are running.</span></span> <span data-ttu-id="457a7-158">`await` — Słowo kluczowe umożliwia nieblokującej na poziomie uruchomić zadanie, a następnie kontynuuj wykonywanie po zakończeniu tego zadania.</span><span class="sxs-lookup"><span data-stu-id="457a7-158">The `await` keyword provides a non-blocking way to start a task, then continue execution when that task completes.</span></span> <span data-ttu-id="457a7-159">Prosta wersja asynchronicznego wykonującego kodu śniadanie będzie wyglądać poniższy fragment kodu:</span><span class="sxs-lookup"><span data-stu-id="457a7-159">A simple asynchronous version of the make a breakfast code would look like the following snippet:</span></span>

[!code-csharp[SimpleAsyncBreakfast](~/samples/snippets/csharp/tour-of-async/AsyncBreakfast-V2/Program.cs#Main)]

<span data-ttu-id="457a7-160">Ten kod nie blokuje, gdy są gotowania potrawach lub bekon.</span><span class="sxs-lookup"><span data-stu-id="457a7-160">This code doesn't block while the eggs or the bacon are cooking.</span></span> <span data-ttu-id="457a7-161">Ten kod nie będzie jednak uruchomić innych zadań.</span><span class="sxs-lookup"><span data-stu-id="457a7-161">This code won't start any other tasks though.</span></span> <span data-ttu-id="457a7-162">Czy nadal umieścić wyskakujące w tostera, a stare go do momentu jej POP.</span><span class="sxs-lookup"><span data-stu-id="457a7-162">You'd still put the toast in the toaster and stare at it until it pops.</span></span> <span data-ttu-id="457a7-163">Ale co najmniej reaguje dla każdego, kto chce Twojej uwagi.</span><span class="sxs-lookup"><span data-stu-id="457a7-163">But at least, you'd respond to anyone that wanted your attention.</span></span> <span data-ttu-id="457a7-164">Restauracji, gdzie są umieszczone wiele zamówień Cooka uruchomiła inny śniadanie podczas pierwszego jest gotowania.</span><span class="sxs-lookup"><span data-stu-id="457a7-164">In a restaurant where multiple orders are placed, the cook could start another breakfast while the first is cooking.</span></span>

<span data-ttu-id="457a7-165">Wątek nad śniadanie nie jest blokowane podczas oczekiwania na rozpoczęte zadanie, które nie zostało jeszcze zakończone.</span><span class="sxs-lookup"><span data-stu-id="457a7-165">Now, the thread working on the breakfast isn't blocked while awaiting any started task that hasn't yet finished.</span></span> <span data-ttu-id="457a7-166">W niektórych aplikacjach ta zmiana ma wszystko, co jest potrzebne.</span><span class="sxs-lookup"><span data-stu-id="457a7-166">For some applications, this change is all that's needed.</span></span> <span data-ttu-id="457a7-167">Aplikacji GUI nadal odpowiada na użytkownika za pomocą tylko tej zmiany.</span><span class="sxs-lookup"><span data-stu-id="457a7-167">A GUI application still responds to the user with just this change.</span></span> <span data-ttu-id="457a7-168">Jednak w tym scenariuszu ma więcej.</span><span class="sxs-lookup"><span data-stu-id="457a7-168">However, for this scenario, you want more.</span></span> <span data-ttu-id="457a7-169">Nie chcesz każdego składnika zadań, które mają być wykonywane sekwencyjnie.</span><span class="sxs-lookup"><span data-stu-id="457a7-169">You don't want each of the component tasks to be executed sequentially.</span></span> <span data-ttu-id="457a7-170">Zaleca się rozpoczynać każde z zadań składnik przed oczekiwanie na ukończenie poprzedniego zadania.</span><span class="sxs-lookup"><span data-stu-id="457a7-170">It's better to start each of the component tasks before awaiting the previous task's completion.</span></span>

## <a name="start-tasks-concurrently"></a><span data-ttu-id="457a7-171">Równoczesne zadania uruchamiania</span><span class="sxs-lookup"><span data-stu-id="457a7-171">Start tasks concurrently</span></span>

<span data-ttu-id="457a7-172">W wielu przypadkach chcesz uruchomić kilka niezależnych zadań od razu.</span><span class="sxs-lookup"><span data-stu-id="457a7-172">In many scenarios, you want to start several independent tasks immediately.</span></span> <span data-ttu-id="457a7-173">Następnie gdy poszczególne podzadania zakończą, można kontynuować inne prace, które jest gotowe.</span><span class="sxs-lookup"><span data-stu-id="457a7-173">Then, as each task finishes, you can continue other work that's ready.</span></span> <span data-ttu-id="457a7-174">Analogicznie śniadanie to jak się dostać śniadanie wykonywane szybciej.</span><span class="sxs-lookup"><span data-stu-id="457a7-174">In the breakfast analogy, that's how you get breakfast done more quickly.</span></span> <span data-ttu-id="457a7-175">Możesz także uzyskać, wszystko gotowe blisko tym samym czasie.</span><span class="sxs-lookup"><span data-stu-id="457a7-175">You also get everything done close to the same time.</span></span> <span data-ttu-id="457a7-176">Przedstawiamy śniadanie gorąca.</span><span class="sxs-lookup"><span data-stu-id="457a7-176">You'll get a hot breakfast.</span></span>

<span data-ttu-id="457a7-177"><xref:System.Threading.Tasks.Task?displayProperty=nameWithType> i powiązanych typów klas, które umożliwia przeglądanie informacji o zadania, które są w toku.</span><span class="sxs-lookup"><span data-stu-id="457a7-177">The <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> and related types are classes you can use to reason about tasks that are in progress.</span></span> <span data-ttu-id="457a7-178">Która pozwala napisać kod, który bardziej przypomina sposób, w rzeczywistości utworzyłoby śniadanie.</span><span class="sxs-lookup"><span data-stu-id="457a7-178">That enables you to write code that more closely resembles the way you'd actually create breakfast.</span></span> <span data-ttu-id="457a7-179">Chce się uruchomić, gotowania potrawach, bekon i powiadomienie typu toast w tym samym czasie.</span><span class="sxs-lookup"><span data-stu-id="457a7-179">You'd start cooking the eggs, bacon, and toast at the same time.</span></span> <span data-ttu-id="457a7-180">Każdy wymaga akcji, czy zwrócić uwagę na to zadanie, zajmie się następnej akcji, następnie await do czegoś innego, która wymaga uwagi.</span><span class="sxs-lookup"><span data-stu-id="457a7-180">As each requires action, you'd turn your attention to that task, take care of the next action, then await for something else that requires your attention.</span></span>

<span data-ttu-id="457a7-181">Uruchomienie zadania i przechowywania w <xref:System.Threading.Tasks.Task> obiekt, który reprezentuje pracę.</span><span class="sxs-lookup"><span data-stu-id="457a7-181">You start a task and hold on to the <xref:System.Threading.Tasks.Task> object that represents the work.</span></span> <span data-ttu-id="457a7-182">Będziesz `await` każdego zadania, przed rozpoczęciem pracy z jego wynik.</span><span class="sxs-lookup"><span data-stu-id="457a7-182">You'll `await` each task before working with its result.</span></span>

<span data-ttu-id="457a7-183">Upewnijmy się te zmiany do kodu śniadanie.</span><span class="sxs-lookup"><span data-stu-id="457a7-183">Let's make these changes to the breakfast code.</span></span> <span data-ttu-id="457a7-184">Pierwszym krokiem jest do przechowywania zadań dla operacji podczas uruchamiania, a nie oczekuje na ich:</span><span class="sxs-lookup"><span data-stu-id="457a7-184">The first step is to store the tasks for operations when they start, rather than awaiting them:</span></span>

```csharp
Coffee cup = PourCoffee();
Console.WriteLine("coffee is ready");
Task<Egg> eggTask = FryEggs(2);
Egg eggs = await eggTask;
Console.WriteLine("eggs are ready");
Task<Bacon> baconTask = FryBacon(3);
Bacon bacon = await baconTask;
Console.WriteLine("bacon is ready");
Task<Toast> toastTask = ToastBread(2);
Toast toast = await toastTask;
ApplyButter(toast);
ApplyJam(toast);
Console.WriteLine("toast is ready");
Juice oj = PourOJ();
Console.WriteLine("oj is ready");

Console.WriteLine("Breakfast is ready!");
```

<span data-ttu-id="457a7-185">Następnie możesz przenieść `await` instrukcji bekon i potrawach na końcu metody, zanim śniadanie:</span><span class="sxs-lookup"><span data-stu-id="457a7-185">Next, you can move the `await` statements for the bacon and eggs to the end of the method, before serving breakfast:</span></span>

```csharp
Coffee cup = PourCoffee();
Console.WriteLine("coffee is ready");
Task<Egg> eggTask = FryEggs(2);
Task<Bacon> baconTask = FryBacon(3);
Task<Toast> toastTask = ToastBread(2);
Toast toast = await toastTask;
ApplyButter(toast);
ApplyJam(toast);
Console.WriteLine("toast is ready");
Juice oj = PourOJ();
Console.WriteLine("oj is ready");

Egg eggs = await eggTask;
Console.WriteLine("eggs are ready");
Bacon bacon = await baconTask;
Console.WriteLine("bacon is ready");

Console.WriteLine("Breakfast is ready!");
```

<span data-ttu-id="457a7-186">Powyższy kod działa lepiej.</span><span class="sxs-lookup"><span data-stu-id="457a7-186">The preceding code works better.</span></span> <span data-ttu-id="457a7-187">Asynchroniczne zadania możesz rozpocząć tylko raz.</span><span class="sxs-lookup"><span data-stu-id="457a7-187">You start all the asynchronous tasks at once.</span></span> <span data-ttu-id="457a7-188">Każde zadanie podrzędne jest await, tylko wtedy, gdy potrzebujesz wyników.</span><span class="sxs-lookup"><span data-stu-id="457a7-188">You await each task only when you need the results.</span></span> <span data-ttu-id="457a7-189">Powyższy kod może być podobny do kodu w aplikacji sieci web, który zgłasza żądania dotyczące różnych mikrousług, a następnie scala wyniki w pojedynczej strony.</span><span class="sxs-lookup"><span data-stu-id="457a7-189">The preceding code may be similar to code in a web application that makes requests of different microservices, then combines the results into a single page.</span></span> <span data-ttu-id="457a7-190">Wprowadzisz wszystkich żądań, następnie `await` wszystkie te zadania i narzędzia compose strony sieci web.</span><span class="sxs-lookup"><span data-stu-id="457a7-190">You'll make all the requests immediately, then `await` all those tasks and compose the web page.</span></span>

## <a name="composition-with-tasks"></a><span data-ttu-id="457a7-191">Kompozycja z zadaniami</span><span class="sxs-lookup"><span data-stu-id="457a7-191">Composition with tasks</span></span>

 <span data-ttu-id="457a7-192">Masz wszystko gotowe do śniadanie w tym samym czasie, z wyjątkiem wyskakującego powiadomienia.</span><span class="sxs-lookup"><span data-stu-id="457a7-192">You have everything ready for breakfast at the same time except the toast.</span></span> <span data-ttu-id="457a7-193">Tworzenie wyskakujące jest skład operację asynchroniczną (toasting chleb) oraz operacje synchroniczne (dodanie masła i zakleszczenie).</span><span class="sxs-lookup"><span data-stu-id="457a7-193">Making the toast is the composition of an asynchronous operation (toasting the bread), and synchronous operations (adding the butter and the jam).</span></span> <span data-ttu-id="457a7-194">Aktualizowanie tego kodu pokazano bardzo ważnym pojęciem:</span><span class="sxs-lookup"><span data-stu-id="457a7-194">Updating this code illustrates an important concept:</span></span>

> [!IMPORTANT]
> <span data-ttu-id="457a7-195">Skład następuje Praca synchroniczna operacja asynchroniczna jest operacją asynchroniczną.</span><span class="sxs-lookup"><span data-stu-id="457a7-195">The composition of an asynchronous operation followed by synchronous work is an asynchronous operation.</span></span> <span data-ttu-id="457a7-196">Określona w inny sposób, jeśli jakakolwiek część operacji jest asynchroniczne, cała operacja jest asynchroniczna.</span><span class="sxs-lookup"><span data-stu-id="457a7-196">Stated another way, if any portion of an operation is asynchronous, the entire operation is asynchronous.</span></span>

<span data-ttu-id="457a7-197">Powyższy kod wykazało, że można użyć <xref:System.Threading.Tasks.Task> lub <xref:System.Threading.Tasks.Task%601> obiektów, aby pomieścić uruchomione zadania podrzędne.</span><span class="sxs-lookup"><span data-stu-id="457a7-197">The preceding code showed you that you can use <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> objects to hold running tasks.</span></span> <span data-ttu-id="457a7-198">Możesz `await` każdego zadania, przed rozpoczęciem korzystania z jego wynik.</span><span class="sxs-lookup"><span data-stu-id="457a7-198">You `await` each task before using its result.</span></span> <span data-ttu-id="457a7-199">Następnym krokiem jest, aby utworzyć metody, które reprezentują kombinacji innych zadań.</span><span class="sxs-lookup"><span data-stu-id="457a7-199">The next step is to create methods that represent the combination of other work.</span></span> <span data-ttu-id="457a7-200">Przed rozpoczęciem obsługi śniadanie, należy poczekać na zadanie, które reprezentuje toasting chleb przed dodaniem masła i zakleszczenie.</span><span class="sxs-lookup"><span data-stu-id="457a7-200">Before serving breakfast, you want to await the task that represents toasting the bread before adding butter and jam.</span></span> <span data-ttu-id="457a7-201">Może reprezentować pracę z następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="457a7-201">You can represent that work with the following code:</span></span>

[!code-csharp[ComposeToastTask](~/samples/snippets/csharp/tour-of-async/AsyncBreakfast-V3/Program.cs#ComposeToastTask)]

<span data-ttu-id="457a7-202">Powyższa metoda ma `async` modyfikator w podpisie.</span><span class="sxs-lookup"><span data-stu-id="457a7-202">The preceding method has the `async` modifier in its signature.</span></span> <span data-ttu-id="457a7-203">Który sygnalizuje kompilatorowi, ta metoda zawiera `await` instrukcji; zawiera on operacji asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="457a7-203">That signals to the compiler that this method contains an `await` statement; it contains asynchronous operations.</span></span> <span data-ttu-id="457a7-204">Ta metoda reprezentuje zadanie, które toasts chleb, a następnie dodaje masła i zakleszczenie.</span><span class="sxs-lookup"><span data-stu-id="457a7-204">This method represents the task that toasts the bread, then adds butter and jam.</span></span> <span data-ttu-id="457a7-205">Ta metoda zwraca <xref:System.Threading.Tasks.Task%601> reprezentujący kompozycji te trzy operacje.</span><span class="sxs-lookup"><span data-stu-id="457a7-205">This method returns a <xref:System.Threading.Tasks.Task%601> that represents the composition of those three operations.</span></span> <span data-ttu-id="457a7-206">Główny blok kodu staje się:</span><span class="sxs-lookup"><span data-stu-id="457a7-206">The main block of code now becomes:</span></span>

[!code-csharp[StartConcurrentTasks](~/samples/snippets/csharp/tour-of-async/AsyncBreakfast-V3/Program.cs#Main)]

<span data-ttu-id="457a7-207">Poprzednia zmiana zilustrowane ważną technikę do pracy z kodu asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="457a7-207">The previous change illustrated an important technique for working with asynchronous code.</span></span> <span data-ttu-id="457a7-208">Dzięki oddzieleniu operacji na nową metodę, która zwraca klasę task, redagowania zadań.</span><span class="sxs-lookup"><span data-stu-id="457a7-208">You compose tasks by separating the operations into a new method that returns a task.</span></span> <span data-ttu-id="457a7-209">Możesz wybrać, kiedy należy poczekać na zadanie.</span><span class="sxs-lookup"><span data-stu-id="457a7-209">You can choose when to await that task.</span></span> <span data-ttu-id="457a7-210">Można jednocześnie uruchomić inne zadania.</span><span class="sxs-lookup"><span data-stu-id="457a7-210">You can start other tasks concurrently.</span></span>

## <a name="await-tasks-efficiently"></a><span data-ttu-id="457a7-211">Efektywne await zadania</span><span class="sxs-lookup"><span data-stu-id="457a7-211">Await tasks efficiently</span></span>

<span data-ttu-id="457a7-212">Seria `await` instrukcji na końcu poprzedniego kodu można zwiększyć za pomocą metody `Task` klasy.</span><span class="sxs-lookup"><span data-stu-id="457a7-212">The series of `await` statements at the end of the preceding code can be improved by using methods of the `Task` class.</span></span> <span data-ttu-id="457a7-213">Jedną z tych interfejsów API jest <xref:System.Threading.Tasks.Task.WhenAll%2A>, co powoduje zwrócenie <xref:System.Threading.Tasks.Task> którego działanie jest kończone po zakończeniu wszystkich zadań w swojej listy argumentów, jak pokazano w poniższym kodzie:</span><span class="sxs-lookup"><span data-stu-id="457a7-213">One of those APIs is <xref:System.Threading.Tasks.Task.WhenAll%2A>, which returns a <xref:System.Threading.Tasks.Task> that completes when all the tasks in its argument list have completed, as shown in the following code:</span></span>

```csharp
await Task.WhenAll(eggTask, baconTask, toastTask);
Console.WriteLine("eggs are ready");
Console.WriteLine("bacon is ready");
Console.WriteLine("toast is ready");
Console.WriteLine("Breakfast is ready!");
```

<span data-ttu-id="457a7-214">Innym rozwiązaniem jest użycie <xref:System.Threading.Tasks.Task.WhenAny%2A>, co powoduje zwrócenie `Task<Task>` , działanie jest kończone po zakończeniu przez dowolny z jej argumentów.</span><span class="sxs-lookup"><span data-stu-id="457a7-214">Another option is to use <xref:System.Threading.Tasks.Task.WhenAny%2A>, which returns a `Task<Task>` that completes when any of its arguments completes.</span></span> <span data-ttu-id="457a7-215">Zwrócone zadanie może poczekać, wiedząc, że zostało już zakończone.</span><span class="sxs-lookup"><span data-stu-id="457a7-215">You can await the returned task, knowing that it has already finished.</span></span> <span data-ttu-id="457a7-216">Poniższy kod przedstawia sposób użycia <xref:System.Threading.Tasks.Task.WhenAny%2A> aby poczekać na pierwsze zadanie, aby zakończyć i następnie przetworzyć jego wynik.</span><span class="sxs-lookup"><span data-stu-id="457a7-216">The following code shows how you could use <xref:System.Threading.Tasks.Task.WhenAny%2A> to await the first task to finish and then process its result.</span></span> <span data-ttu-id="457a7-217">Po przetworzeniu wynikiem ukończone zadanie podrzędne, usuń ukończone zadania z listy zadań przekazany do `WhenAny`.</span><span class="sxs-lookup"><span data-stu-id="457a7-217">After processing the result from the completed task, you remove that completed task from the list of tasks passed to `WhenAny`.</span></span>

[!code-csharp[AwaitAnyTask](~/samples/snippets/csharp/tour-of-async/AsyncBreakfast-final/Program.cs#AwaitAnyTask)]

<span data-ttu-id="457a7-218">Po wprowadzeniu wszystkich tych zmian, ostateczną wersją `Main` wygląda podobnie do poniższego kodu:</span><span class="sxs-lookup"><span data-stu-id="457a7-218">After all those changes, the final version of `Main` looks like the following code:</span></span>

[!code-csharp[Final](~/samples/snippets/csharp/tour-of-async/AsyncBreakfast-final/Program.cs#Main)]

<span data-ttu-id="457a7-219">Ten kod końcowy jest asynchroniczna.</span><span class="sxs-lookup"><span data-stu-id="457a7-219">This final code is asynchronous.</span></span> <span data-ttu-id="457a7-220">Odzwierciedla dokładniej, jak osoba będzie Cooka śniadanie.</span><span class="sxs-lookup"><span data-stu-id="457a7-220">It more accurately reflects how a person would cook a breakfast.</span></span> <span data-ttu-id="457a7-221">Należy porównać poprzedni kod z pierwszym przykładowy kod w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="457a7-221">Compare the preceding code with the first code sample in this article.</span></span> <span data-ttu-id="457a7-222">Akcje podstawowe są nadal jasne z kodu.</span><span class="sxs-lookup"><span data-stu-id="457a7-222">The core actions are still clear from reading the code.</span></span> <span data-ttu-id="457a7-223">Możesz przeczytać ten kod w taki sam sposób, wczytane tych instrukcji składania śniadanie na początku tego artykułu.</span><span class="sxs-lookup"><span data-stu-id="457a7-223">You can read this code the same way you'd read those instructions for making a breakfast at the beginning of this article.</span></span> <span data-ttu-id="457a7-224">Funkcje języka `async` i `await` Podaj tłumaczenia sprawia, że każda osoba z tymi pisemnych instrukcji: uruchamiania zadań, jak można, a nie blokować oczekiwanie na ukończenie zadań.</span><span class="sxs-lookup"><span data-stu-id="457a7-224">The language features for `async` and `await` provide the translation every person makes to follow those written instructions: start tasks as you can and don't block waiting for tasks to complete.</span></span>
