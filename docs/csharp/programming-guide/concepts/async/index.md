---
title: 'Programowanie asynchroniczne w języku C #'
description: Przegląd obsługi języka Języka C# dla programowania asynchronicznego przy użyciu async, await, Task i Task<T>
ms.date: 03/18/2019
ms.openlocfilehash: 4cbbff0f2c48f0ec2f8befa234ea5023465a1c5d
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/15/2020
ms.locfileid: "79169912"
---
# <a name="asynchronous-programming-with-async-and-await"></a><span data-ttu-id="8d95e-103">Programowanie asynchroniczne przy użyciu elementów async i await</span><span class="sxs-lookup"><span data-stu-id="8d95e-103">Asynchronous programming with async and await</span></span>

<span data-ttu-id="8d95e-104">Task asynchroniczny model programowania (TAP) zapewnia abstrakcję za pomocą kodu asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="8d95e-104">The Task asynchronous programming model (TAP) provides an abstraction over asynchronous code.</span></span> <span data-ttu-id="8d95e-105">Piszesz kod jako sekwencję instrukcji, tak jak zawsze.</span><span class="sxs-lookup"><span data-stu-id="8d95e-105">You write code as a sequence of statements, just like always.</span></span> <span data-ttu-id="8d95e-106">Można odczytać ten kod tak, jakby każda instrukcja kończy się przed rozpoczęciem następnego.</span><span class="sxs-lookup"><span data-stu-id="8d95e-106">You can read that code as though each statement completes before the next begins.</span></span> <span data-ttu-id="8d95e-107">Kompilator wykonuje szereg przekształceń, ponieważ niektóre z tych <xref:System.Threading.Tasks.Task> instrukcji może rozpocząć pracę i zwrócić a, który reprezentuje trwającej pracy.</span><span class="sxs-lookup"><span data-stu-id="8d95e-107">The compiler performs a number of transformations because some of those statements may start work and return a <xref:System.Threading.Tasks.Task> that represents the ongoing work.</span></span>

<span data-ttu-id="8d95e-108">To jest cel tej składni: włącz kod, który odczytuje jak sekwencja instrukcji, ale jest wykonywany w znacznie bardziej skomplikowanej kolejności na podstawie zewnętrznej alokacji zasobów i po zakończeniu zadań.</span><span class="sxs-lookup"><span data-stu-id="8d95e-108">That's the goal of this syntax: enable code that reads like a sequence of statements, but executes in a much more complicated order based on external resource allocation and when tasks complete.</span></span> <span data-ttu-id="8d95e-109">Jest to analogiczne do tego, jak ludzie udzielają instrukcji dla procesów, które zawierają zadania asynchroniczne.</span><span class="sxs-lookup"><span data-stu-id="8d95e-109">It's analogous to how people give instructions for processes that include asynchronous tasks.</span></span> <span data-ttu-id="8d95e-110">W tym artykule użyjesz przykładu instrukcji dotyczących tworzenia śniadania, aby zobaczyć, jak `async` słowa kluczowe i `await` ułatwiają rozumowanie kodu zawierającego serię instrukcji asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="8d95e-110">Throughout this article, you'll use an example of instructions for making a breakfast to see how the `async` and `await` keywords make it easier to reason about code that includes a series of asynchronous instructions.</span></span> <span data-ttu-id="8d95e-111">Chcesz napisać instrukcje coś w rodzaju poniższej listy, aby wyjaśnić, jak zrobić śniadanie:</span><span class="sxs-lookup"><span data-stu-id="8d95e-111">You'd write the instructions something like the following list to explain how to make a breakfast:</span></span>

1. <span data-ttu-id="8d95e-112">Wlać filiżankę kawy.</span><span class="sxs-lookup"><span data-stu-id="8d95e-112">Pour a cup of coffee.</span></span>
1. <span data-ttu-id="8d95e-113">Podgrzać patelnię, a następnie smażyć dwa jajka.</span><span class="sxs-lookup"><span data-stu-id="8d95e-113">Heat up a pan, then fry two eggs.</span></span>
1. <span data-ttu-id="8d95e-114">Smażyć trzy plasterki boczku.</span><span class="sxs-lookup"><span data-stu-id="8d95e-114">Fry three slices of bacon.</span></span>
1. <span data-ttu-id="8d95e-115">Toast dwa kawałki chleba.</span><span class="sxs-lookup"><span data-stu-id="8d95e-115">Toast two pieces of bread.</span></span>
1. <span data-ttu-id="8d95e-116">Dodaj masło i dżem do tosty.</span><span class="sxs-lookup"><span data-stu-id="8d95e-116">Add butter and jam to the toast.</span></span>
1. <span data-ttu-id="8d95e-117">Wlać szklankę soku pomarańczowego.</span><span class="sxs-lookup"><span data-stu-id="8d95e-117">Pour a glass of orange juice.</span></span>

<span data-ttu-id="8d95e-118">Jeśli masz doświadczenie z gotowaniem, należy wykonać te instrukcje **asynchronicznie**.</span><span class="sxs-lookup"><span data-stu-id="8d95e-118">If you have experience with cooking, you'd execute those instructions **asynchronously**.</span></span> <span data-ttu-id="8d95e-119">Zacząłbyś rozgrzewać patelnię do jaj, a następnie rozpocząć bekon.</span><span class="sxs-lookup"><span data-stu-id="8d95e-119">You'd start warming the pan for eggs, then start the bacon.</span></span> <span data-ttu-id="8d95e-120">Włożyłeś chleb do tostera, a potem zacząłeś jajka.</span><span class="sxs-lookup"><span data-stu-id="8d95e-120">You'd put the bread in the toaster, then start the eggs.</span></span> <span data-ttu-id="8d95e-121">Na każdym etapie procesu należy rozpocząć zadanie, a następnie zwrócić uwagę na zadania, które są gotowe do uwagi.</span><span class="sxs-lookup"><span data-stu-id="8d95e-121">At each step of the process, you'd start a task, then turn your attention to tasks that are ready for your attention.</span></span>

<span data-ttu-id="8d95e-122">Gotowanie śniadania jest dobrym przykładem pracy asynchronicznej, która nie jest równoległa.</span><span class="sxs-lookup"><span data-stu-id="8d95e-122">Cooking breakfast is a good example of asynchronous work that isn't parallel.</span></span> <span data-ttu-id="8d95e-123">Jedna osoba (lub wątek) może obsłużyć wszystkie te zadania.</span><span class="sxs-lookup"><span data-stu-id="8d95e-123">One person (or thread) can handle all these tasks.</span></span> <span data-ttu-id="8d95e-124">Kontynuując analogię śniadania, jedna osoba może zrobić śniadanie asynchronicznie, rozpoczynając następne zadanie przed zakończeniem pierwszego.</span><span class="sxs-lookup"><span data-stu-id="8d95e-124">Continuing the breakfast analogy, one person can make breakfast asynchronously by starting the next task before the first completes.</span></span> <span data-ttu-id="8d95e-125">Gotowanie postępuje niezależnie od tego, czy ktoś go obserwuje.</span><span class="sxs-lookup"><span data-stu-id="8d95e-125">The cooking progresses whether or not someone is watching it.</span></span> <span data-ttu-id="8d95e-126">Jak tylko zaczniesz rozgrzewać patelnię do jaj, możesz rozpocząć smażenie boczku.</span><span class="sxs-lookup"><span data-stu-id="8d95e-126">As soon as you start warming the pan for the eggs, you can begin frying the bacon.</span></span> <span data-ttu-id="8d95e-127">Po rozpoczęciu boczku można umieścić chleb w tosterze.</span><span class="sxs-lookup"><span data-stu-id="8d95e-127">Once the bacon starts, you can put the bread into the toaster.</span></span>

<span data-ttu-id="8d95e-128">Dla algorytmu równoległego, trzeba wielu kucharzy (lub wątków).</span><span class="sxs-lookup"><span data-stu-id="8d95e-128">For a parallel algorithm, you'd need multiple cooks (or threads).</span></span> <span data-ttu-id="8d95e-129">Można by zrobić jajka, jeden bekon, i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="8d95e-129">One would make the eggs, one the bacon, and so on.</span></span> <span data-ttu-id="8d95e-130">Każdy z nich będzie koncentrować się tylko na tym jednym zadaniu.</span><span class="sxs-lookup"><span data-stu-id="8d95e-130">Each one would be focused on just that one task.</span></span> <span data-ttu-id="8d95e-131">Każdy kucharz (lub nici) będzie zablokowany synchronicznie czekając na boczek, aby być gotowym do przerzucenia, lub toast pop.</span><span class="sxs-lookup"><span data-stu-id="8d95e-131">Each cook (or thread) would be blocked synchronously waiting for bacon to be ready to flip, or the toast to pop.</span></span>

<span data-ttu-id="8d95e-132">Teraz należy wziąć pod uwagę te same instrukcje napisane jako instrukcje C#:</span><span class="sxs-lookup"><span data-stu-id="8d95e-132">Now, consider those same instructions written as C# statements:</span></span>

[!code-csharp[SynchronousBreakfast](~/samples/snippets/csharp/tour-of-async/AsyncBreakfast-starter/Program.cs#Main)]

<span data-ttu-id="8d95e-133">Komputery nie interpretują tych instrukcji w taki sam sposób, jak ludzie.</span><span class="sxs-lookup"><span data-stu-id="8d95e-133">Computers don't interpret those instructions the same way people do.</span></span> <span data-ttu-id="8d95e-134">Komputer zablokuje każdą instrukcję, dopóki praca nie zostanie zakończona przed przejściem do następnej instrukcji.</span><span class="sxs-lookup"><span data-stu-id="8d95e-134">The computer will block on each statement until the work is complete before moving on to the next statement.</span></span> <span data-ttu-id="8d95e-135">To tworzy niesatysfakcjonujące śniadanie.</span><span class="sxs-lookup"><span data-stu-id="8d95e-135">That creates an unsatisfying breakfast.</span></span> <span data-ttu-id="8d95e-136">Późniejsze zadania nie zostaną uruchomione, dopóki nie zostaną ukończone wcześniejsze zadania.</span><span class="sxs-lookup"><span data-stu-id="8d95e-136">The later tasks wouldn't be started until the earlier tasks had completed.</span></span> <span data-ttu-id="8d95e-137">Stworzenie śniadania zajęłoby znacznie więcej czasu, a niektóre produkty stałyby się zimne przed serwem.</span><span class="sxs-lookup"><span data-stu-id="8d95e-137">It would take much longer to create the breakfast, and some items would have gotten cold before being served.</span></span>

<span data-ttu-id="8d95e-138">Jeśli chcesz, aby komputer wykonywał powyższe instrukcje asynchronicznie, musisz napisać kod asynchroniczny.</span><span class="sxs-lookup"><span data-stu-id="8d95e-138">If you want the computer to execute the above instructions asynchronously, you must write asynchronous code.</span></span>

<span data-ttu-id="8d95e-139">Te obawy są ważne dla programów, które piszesz dzisiaj.</span><span class="sxs-lookup"><span data-stu-id="8d95e-139">These concerns are important for the programs you write today.</span></span> <span data-ttu-id="8d95e-140">Podczas pisania programów klienckich, chcesz interfejsu użytkownika, aby reagować na dane wejściowe użytkownika.</span><span class="sxs-lookup"><span data-stu-id="8d95e-140">When you write client programs, you want the UI to be responsive to user input.</span></span> <span data-ttu-id="8d95e-141">Aplikacja nie powinna sprawiać, że telefon jest wyświetlany na zablokowanej, podczas pobierania danych z sieci Web.</span><span class="sxs-lookup"><span data-stu-id="8d95e-141">Your application shouldn't make a phone appear frozen while it's downloading data from the web.</span></span> <span data-ttu-id="8d95e-142">Podczas pisania programów serwerowych nie chcesz blokować wątków.</span><span class="sxs-lookup"><span data-stu-id="8d95e-142">When you write server programs, you don't want threads blocked.</span></span> <span data-ttu-id="8d95e-143">Te wątki mogą obsługiwać inne żądania.</span><span class="sxs-lookup"><span data-stu-id="8d95e-143">Those threads could be serving other requests.</span></span> <span data-ttu-id="8d95e-144">Przy użyciu kodu synchronicznego, gdy istnieją alternatywy asynchroniczne boli zdolność do skalowania w sposób tańszy.</span><span class="sxs-lookup"><span data-stu-id="8d95e-144">Using synchronous code when asynchronous alternatives exist hurts your ability to scale out less expensively.</span></span> <span data-ttu-id="8d95e-145">Płacisz za te zablokowane wątki.</span><span class="sxs-lookup"><span data-stu-id="8d95e-145">You pay for those blocked threads.</span></span>

<span data-ttu-id="8d95e-146">Pomyślne nowoczesne aplikacje wymagają kodu asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="8d95e-146">Successful modern applications require asynchronous code.</span></span> <span data-ttu-id="8d95e-147">Bez obsługi języka, pisanie kodu asynchronicznego wymagane wywołania wywołania, zdarzenia zakończenia lub inne środki, które zasłonięte oryginalne intencji kodu.</span><span class="sxs-lookup"><span data-stu-id="8d95e-147">Without language support, writing asynchronous code required callbacks, completion events, or other means that obscured the original intent of the code.</span></span> <span data-ttu-id="8d95e-148">Zaletą kodu synchronicznego jest to, że jest łatwy do zrozumienia.</span><span class="sxs-lookup"><span data-stu-id="8d95e-148">The advantage of the synchronous code is that it's easy to understand.</span></span> <span data-ttu-id="8d95e-149">Akcje krok po kroku ułatwiają skanowanie i rozumienie.</span><span class="sxs-lookup"><span data-stu-id="8d95e-149">The step-by-step actions make it easy to scan and understand.</span></span> <span data-ttu-id="8d95e-150">Tradycyjne modele asynchroniczne zmusiły do skupienia się na asynchronicznym charakterze kodu, a nie na podstawowych akcjach kodu.</span><span class="sxs-lookup"><span data-stu-id="8d95e-150">Traditional asynchronous models forced you to focus on the asynchronous nature of the code, not on the fundamental actions of the code.</span></span>

## <a name="dont-block-await-instead"></a><span data-ttu-id="8d95e-151">Nie blokuj, zamiast tego czekaj</span><span class="sxs-lookup"><span data-stu-id="8d95e-151">Don't block, await instead</span></span>

<span data-ttu-id="8d95e-152">Poprzedni kod demonstruje złe praktyki: konstruowanie kodu synchronicznego do wykonywania operacji asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="8d95e-152">The preceding code demonstrates a bad practice: constructing synchronous code to perform asynchronous operations.</span></span> <span data-ttu-id="8d95e-153">Jak napisano, ten kod blokuje wątek wykonującgo go z wykonywania innych prac.</span><span class="sxs-lookup"><span data-stu-id="8d95e-153">As written, this code blocks the thread executing it from doing any other work.</span></span> <span data-ttu-id="8d95e-154">Nie zostanie ona przerwana, gdy którekolwiek z zadań jest w toku.</span><span class="sxs-lookup"><span data-stu-id="8d95e-154">It won't be interrupted while any of the tasks are in progress.</span></span> <span data-ttu-id="8d95e-155">Byłoby tak, jakby patrzył na toster po włożeniu chleba.</span><span class="sxs-lookup"><span data-stu-id="8d95e-155">It would be as though you stared at the toaster after putting the bread in.</span></span> <span data-ttu-id="8d95e-156">Chcesz zignorować ktoś mówi do ciebie, aż toast pojawiło.</span><span class="sxs-lookup"><span data-stu-id="8d95e-156">You'd ignore anyone talking to you until the toast popped.</span></span>

<span data-ttu-id="8d95e-157">Zacznijmy od zaktualizowania tego kodu, aby wątek nie blokować, gdy zadania są uruchomione.</span><span class="sxs-lookup"><span data-stu-id="8d95e-157">Let's start by updating this code so that the thread doesn't block while tasks are running.</span></span> <span data-ttu-id="8d95e-158">Słowo `await` kluczowe zapewnia nieblokujący sposób, aby rozpocząć zadanie, a następnie kontynuować wykonywanie po zakończeniu tego zadania.</span><span class="sxs-lookup"><span data-stu-id="8d95e-158">The `await` keyword provides a non-blocking way to start a task, then continue execution when that task completes.</span></span> <span data-ttu-id="8d95e-159">Prosta asynchroniczna wersja kodu śniadaniowego będzie wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="8d95e-159">A simple asynchronous version of the make a breakfast code would look like the following snippet:</span></span>

[!code-csharp[SimpleAsyncBreakfast](~/samples/snippets/csharp/tour-of-async/AsyncBreakfast-V2/Program.cs#Main)]

<span data-ttu-id="8d95e-160">Ten kod nie blokuje się podczas gotowania jaj lub bekonu.</span><span class="sxs-lookup"><span data-stu-id="8d95e-160">This code doesn't block while the eggs or the bacon are cooking.</span></span> <span data-ttu-id="8d95e-161">Ten kod nie uruchamia żadnych innych zadań, chociaż.</span><span class="sxs-lookup"><span data-stu-id="8d95e-161">This code won't start any other tasks though.</span></span> <span data-ttu-id="8d95e-162">Nadal można umieścić toast w tosterze i patrzeć na to, aż wyskoczy.</span><span class="sxs-lookup"><span data-stu-id="8d95e-162">You'd still put the toast in the toaster and stare at it until it pops.</span></span> <span data-ttu-id="8d95e-163">Ale przynajmniej, chcesz odpowiedzieć na każdego, kto chciał swoją uwagę.</span><span class="sxs-lookup"><span data-stu-id="8d95e-163">But at least, you'd respond to anyone that wanted your attention.</span></span> <span data-ttu-id="8d95e-164">W restauracji, w której składa się wiele zamówień, kucharz może rozpocząć kolejne śniadanie, podczas gdy pierwszy gotuje.</span><span class="sxs-lookup"><span data-stu-id="8d95e-164">In a restaurant where multiple orders are placed, the cook could start another breakfast while the first is cooking.</span></span>

<span data-ttu-id="8d95e-165">Teraz wątek pracujący nad śniadaniem nie jest zablokowany w oczekiwaniu na rozpoczęte zadanie, które jeszcze się nie zakończyło.</span><span class="sxs-lookup"><span data-stu-id="8d95e-165">Now, the thread working on the breakfast isn't blocked while awaiting any started task that hasn't yet finished.</span></span> <span data-ttu-id="8d95e-166">W przypadku niektórych aplikacji ta zmiana jest wszystkim, co jest potrzebne.</span><span class="sxs-lookup"><span data-stu-id="8d95e-166">For some applications, this change is all that's needed.</span></span> <span data-ttu-id="8d95e-167">Aplikacja GUI nadal odpowiada użytkownikowi tylko z tej zmiany.</span><span class="sxs-lookup"><span data-stu-id="8d95e-167">A GUI application still responds to the user with just this change.</span></span> <span data-ttu-id="8d95e-168">Jednak w tym scenariuszu chcesz więcej.</span><span class="sxs-lookup"><span data-stu-id="8d95e-168">However, for this scenario, you want more.</span></span> <span data-ttu-id="8d95e-169">Nie chcesz, aby każde z zadań składnika było wykonywane sekwencyjnie.</span><span class="sxs-lookup"><span data-stu-id="8d95e-169">You don't want each of the component tasks to be executed sequentially.</span></span> <span data-ttu-id="8d95e-170">Lepiej jest rozpocząć każde z zadań składnika przed oczekiwaniem na zakończenie poprzedniego zadania.</span><span class="sxs-lookup"><span data-stu-id="8d95e-170">It's better to start each of the component tasks before awaiting the previous task's completion.</span></span>

## <a name="start-tasks-concurrently"></a><span data-ttu-id="8d95e-171">Jednoczesne uruchamianie zadań</span><span class="sxs-lookup"><span data-stu-id="8d95e-171">Start tasks concurrently</span></span>

<span data-ttu-id="8d95e-172">W wielu scenariuszach chcesz natychmiast uruchomić kilka niezależnych zadań.</span><span class="sxs-lookup"><span data-stu-id="8d95e-172">In many scenarios, you want to start several independent tasks immediately.</span></span> <span data-ttu-id="8d95e-173">Następnie po zakończeniu każdego zadania można kontynuować inną pracę, która jest gotowa.</span><span class="sxs-lookup"><span data-stu-id="8d95e-173">Then, as each task finishes, you can continue other work that's ready.</span></span> <span data-ttu-id="8d95e-174">W analogii śniadaniowej, w ten sposób można dostać śniadanie zrobić szybciej.</span><span class="sxs-lookup"><span data-stu-id="8d95e-174">In the breakfast analogy, that's how you get breakfast done more quickly.</span></span> <span data-ttu-id="8d95e-175">Można również uzyskać wszystko zrobić blisko tego samego czasu.</span><span class="sxs-lookup"><span data-stu-id="8d95e-175">You also get everything done close to the same time.</span></span> <span data-ttu-id="8d95e-176">Otrzymasz gorące śniadanie.</span><span class="sxs-lookup"><span data-stu-id="8d95e-176">You'll get a hot breakfast.</span></span>

<span data-ttu-id="8d95e-177">Typy <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> i pokrewne są klasy, których można użyć do powoda dotyczące zadań, które są w toku.</span><span class="sxs-lookup"><span data-stu-id="8d95e-177">The <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> and related types are classes you can use to reason about tasks that are in progress.</span></span> <span data-ttu-id="8d95e-178">Dzięki temu można napisać kod, który bardziej przypomina sposób, w jaki faktycznie tworzysz śniadanie.</span><span class="sxs-lookup"><span data-stu-id="8d95e-178">That enables you to write code that more closely resembles the way you'd actually create breakfast.</span></span> <span data-ttu-id="8d95e-179">W tym samym czasie zacząłbyś gotować jajka, bekon i tosty.</span><span class="sxs-lookup"><span data-stu-id="8d95e-179">You'd start cooking the eggs, bacon, and toast at the same time.</span></span> <span data-ttu-id="8d95e-180">Ponieważ każdy wymaga działania, należy zwrócić uwagę na to zadanie, dbać o następnedziałanie, a następnie czekać na coś innego, co wymaga twojej uwagi.</span><span class="sxs-lookup"><span data-stu-id="8d95e-180">As each requires action, you'd turn your attention to that task, take care of the next action, then await for something else that requires your attention.</span></span>

<span data-ttu-id="8d95e-181">Uruchomić zadanie i przytrzymaj <xref:System.Threading.Tasks.Task> obiekt, który reprezentuje pracę.</span><span class="sxs-lookup"><span data-stu-id="8d95e-181">You start a task and hold on to the <xref:System.Threading.Tasks.Task> object that represents the work.</span></span> <span data-ttu-id="8d95e-182">Będziesz `await` każde zadanie przed pracą z jego wynikiem.</span><span class="sxs-lookup"><span data-stu-id="8d95e-182">You'll `await` each task before working with its result.</span></span>

<span data-ttu-id="8d95e-183">Wytoczmy te zmiany w kodzie śniadaniowym.</span><span class="sxs-lookup"><span data-stu-id="8d95e-183">Let's make these changes to the breakfast code.</span></span> <span data-ttu-id="8d95e-184">Pierwszym krokiem jest przechowywanie zadań dla operacji po ich uruchomieniu, a nie oczekiwanie na nie:</span><span class="sxs-lookup"><span data-stu-id="8d95e-184">The first step is to store the tasks for operations when they start, rather than awaiting them:</span></span>

```csharp
Coffee cup = PourCoffee();
Console.WriteLine("coffee is ready");
Task<Egg> eggsTask = FryEggs(2);
Egg eggs = await eggsTask;
Console.WriteLine("eggs are ready");
Task<Bacon> baconTask = FryBacon(3);
Bacon bacon = await baconTask;
Console.WriteLine("bacon is ready");
Task<Toast> toastTask = ToastBread(2);
Toast toast = await toastTask;
ApplyButter(toast);
ApplyJam(toast);
Console.WriteLine("toast is ready");
Juice oj = PourOJ();
Console.WriteLine("oj is ready");

Console.WriteLine("Breakfast is ready!");
```

<span data-ttu-id="8d95e-185">Następnie możesz przenieść `await` oświadczenia o bekon i jajka do końca metody, przed podaniem śniadania:</span><span class="sxs-lookup"><span data-stu-id="8d95e-185">Next, you can move the `await` statements for the bacon and eggs to the end of the method, before serving breakfast:</span></span>

```csharp
Coffee cup = PourCoffee();
Console.WriteLine("coffee is ready");
Task<Egg> eggsTask = FryEggs(2);
Task<Bacon> baconTask = FryBacon(3);
Task<Toast> toastTask = ToastBread(2);
Toast toast = await toastTask;
ApplyButter(toast);
ApplyJam(toast);
Console.WriteLine("toast is ready");
Juice oj = PourOJ();
Console.WriteLine("oj is ready");

Egg eggs = await eggsTask;
Console.WriteLine("eggs are ready");
Bacon bacon = await baconTask;
Console.WriteLine("bacon is ready");

Console.WriteLine("Breakfast is ready!");
```

<span data-ttu-id="8d95e-186">Poprzedni kod działa lepiej.</span><span class="sxs-lookup"><span data-stu-id="8d95e-186">The preceding code works better.</span></span> <span data-ttu-id="8d95e-187">Wszystkie zadania asynchroniczne są uruchamiane jednocześnie.</span><span class="sxs-lookup"><span data-stu-id="8d95e-187">You start all the asynchronous tasks at once.</span></span> <span data-ttu-id="8d95e-188">Możesz czekać na każde zadanie tylko wtedy, gdy potrzebujesz wyników.</span><span class="sxs-lookup"><span data-stu-id="8d95e-188">You await each task only when you need the results.</span></span> <span data-ttu-id="8d95e-189">Poprzedni kod może być podobny do kodu w aplikacji sieci web, który sprawia, że żądania różnych mikrousług, a następnie łączy wyniki w jednej stronie.</span><span class="sxs-lookup"><span data-stu-id="8d95e-189">The preceding code may be similar to code in a web application that makes requests of different microservices, then combines the results into a single page.</span></span> <span data-ttu-id="8d95e-190">Natychmiast zrobisz wszystkie żądania, `await` a następnie wszystkie te zadania i skomponujesz stronę internetową.</span><span class="sxs-lookup"><span data-stu-id="8d95e-190">You'll make all the requests immediately, then `await` all those tasks and compose the web page.</span></span>

## <a name="composition-with-tasks"></a><span data-ttu-id="8d95e-191">Kompozycja z zadaniami</span><span class="sxs-lookup"><span data-stu-id="8d95e-191">Composition with tasks</span></span>

 <span data-ttu-id="8d95e-192">Masz wszystko gotowe na śniadanie w tym samym czasie z wyjątkiem tosty.</span><span class="sxs-lookup"><span data-stu-id="8d95e-192">You have everything ready for breakfast at the same time except the toast.</span></span> <span data-ttu-id="8d95e-193">Dokonywanie toast jest skład operacji asynchronicznej (opiekanie chleba) i operacji synchronicznych (dodawanie masła i dżemu).</span><span class="sxs-lookup"><span data-stu-id="8d95e-193">Making the toast is the composition of an asynchronous operation (toasting the bread), and synchronous operations (adding the butter and the jam).</span></span> <span data-ttu-id="8d95e-194">Aktualizacja tego kodu ilustruje ważną koncepcję:</span><span class="sxs-lookup"><span data-stu-id="8d95e-194">Updating this code illustrates an important concept:</span></span>

> [!IMPORTANT]
> <span data-ttu-id="8d95e-195">Skład operacji asynchronicznej, po której następuje praca synchroniczna, jest operacją asynchroniczną.</span><span class="sxs-lookup"><span data-stu-id="8d95e-195">The composition of an asynchronous operation followed by synchronous work is an asynchronous operation.</span></span> <span data-ttu-id="8d95e-196">Podana w inny sposób, jeśli jakakolwiek część operacji jest asynchroniczna, cała operacja jest asynchroniczna.</span><span class="sxs-lookup"><span data-stu-id="8d95e-196">Stated another way, if any portion of an operation is asynchronous, the entire operation is asynchronous.</span></span>

<span data-ttu-id="8d95e-197">Poprzedni kod pokazał, że można <xref:System.Threading.Tasks.Task> <xref:System.Threading.Tasks.Task%601> użyć lub obiektów do przechowywania uruchomionych zadań.</span><span class="sxs-lookup"><span data-stu-id="8d95e-197">The preceding code showed you that you can use <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> objects to hold running tasks.</span></span> <span data-ttu-id="8d95e-198">Każde `await` zadanie przed użyciem jego wyniku.</span><span class="sxs-lookup"><span data-stu-id="8d95e-198">You `await` each task before using its result.</span></span> <span data-ttu-id="8d95e-199">Następnym krokiem jest utworzenie metod, które reprezentują kombinację innej pracy.</span><span class="sxs-lookup"><span data-stu-id="8d95e-199">The next step is to create methods that represent the combination of other work.</span></span> <span data-ttu-id="8d95e-200">Przed podaniem śniadania, chcesz poczekać na zadanie, które reprezentuje opiekanie chleba przed dodaniem masła i dżemu.</span><span class="sxs-lookup"><span data-stu-id="8d95e-200">Before serving breakfast, you want to await the task that represents toasting the bread before adding butter and jam.</span></span> <span data-ttu-id="8d95e-201">Można reprezentować tę pracę z następującym kodem:</span><span class="sxs-lookup"><span data-stu-id="8d95e-201">You can represent that work with the following code:</span></span>

[!code-csharp[ComposeToastTask](~/samples/snippets/csharp/tour-of-async/AsyncBreakfast-V3/Program.cs#ComposeToastTask)]

<span data-ttu-id="8d95e-202">Poprzednia metoda ma `async` modyfikator w podpisie.</span><span class="sxs-lookup"><span data-stu-id="8d95e-202">The preceding method has the `async` modifier in its signature.</span></span> <span data-ttu-id="8d95e-203">Sygnalizuje kompilatorowi, `await` że ta metoda zawiera instrukcję; zawiera operacje asynchroniczne.</span><span class="sxs-lookup"><span data-stu-id="8d95e-203">That signals to the compiler that this method contains an `await` statement; it contains asynchronous operations.</span></span> <span data-ttu-id="8d95e-204">Ta metoda reprezentuje zadanie, które grzanki chleba, a następnie dodaje masło i dżem.</span><span class="sxs-lookup"><span data-stu-id="8d95e-204">This method represents the task that toasts the bread, then adds butter and jam.</span></span> <span data-ttu-id="8d95e-205">Ta metoda <xref:System.Threading.Tasks.Task%601> zwraca a, który reprezentuje skład tych trzech operacji.</span><span class="sxs-lookup"><span data-stu-id="8d95e-205">This method returns a <xref:System.Threading.Tasks.Task%601> that represents the composition of those three operations.</span></span> <span data-ttu-id="8d95e-206">Głównym blokiem kodu staje się teraz:</span><span class="sxs-lookup"><span data-stu-id="8d95e-206">The main block of code now becomes:</span></span>

[!code-csharp[StartConcurrentTasks](~/samples/snippets/csharp/tour-of-async/AsyncBreakfast-V3/Program.cs#Main)]

<span data-ttu-id="8d95e-207">Poprzednia zmiana zilustrowała ważną technikę pracy z kodem asynchronicznym.</span><span class="sxs-lookup"><span data-stu-id="8d95e-207">The previous change illustrated an important technique for working with asynchronous code.</span></span> <span data-ttu-id="8d95e-208">Zadania można składać, oddzielając operacje na nową metodę, która zwraca zadanie.</span><span class="sxs-lookup"><span data-stu-id="8d95e-208">You compose tasks by separating the operations into a new method that returns a task.</span></span> <span data-ttu-id="8d95e-209">Możesz wybrać, kiedy należy czekać na to zadanie.</span><span class="sxs-lookup"><span data-stu-id="8d95e-209">You can choose when to await that task.</span></span> <span data-ttu-id="8d95e-210">Można uruchomić inne zadania jednocześnie.</span><span class="sxs-lookup"><span data-stu-id="8d95e-210">You can start other tasks concurrently.</span></span>

## <a name="await-tasks-efficiently"></a><span data-ttu-id="8d95e-211">Sprawnie czekaj na zadania</span><span class="sxs-lookup"><span data-stu-id="8d95e-211">Await tasks efficiently</span></span>

<span data-ttu-id="8d95e-212">Seria instrukcji `await` na końcu poprzedniego kodu można poprawić przy użyciu metod `Task` klasy.</span><span class="sxs-lookup"><span data-stu-id="8d95e-212">The series of `await` statements at the end of the preceding code can be improved by using methods of the `Task` class.</span></span> <span data-ttu-id="8d95e-213">Jednym z tych <xref:System.Threading.Tasks.Task.WhenAll%2A>interfejsów API jest , który zwraca a, <xref:System.Threading.Tasks.Task> który kończy się po zakończeniu wszystkich zadań na liście argumentów, jak pokazano w następującym kodzie:</span><span class="sxs-lookup"><span data-stu-id="8d95e-213">One of those APIs is <xref:System.Threading.Tasks.Task.WhenAll%2A>, which returns a <xref:System.Threading.Tasks.Task> that completes when all the tasks in its argument list have completed, as shown in the following code:</span></span>

```csharp
await Task.WhenAll(eggsTask, baconTask, toastTask);
Console.WriteLine("eggs are ready");
Console.WriteLine("bacon is ready");
Console.WriteLine("toast is ready");
Console.WriteLine("Breakfast is ready!");
```

<span data-ttu-id="8d95e-214">Inną opcją <xref:System.Threading.Tasks.Task.WhenAny%2A>jest użycie `Task<Task>` , który zwraca, że kończy się po zakończeniu któregokolwiek z jego argumentów.</span><span class="sxs-lookup"><span data-stu-id="8d95e-214">Another option is to use <xref:System.Threading.Tasks.Task.WhenAny%2A>, which returns a `Task<Task>` that completes when any of its arguments completes.</span></span> <span data-ttu-id="8d95e-215">Możesz poczekać na zwrócone zadanie, wiedząc, że zostało już zakończone.</span><span class="sxs-lookup"><span data-stu-id="8d95e-215">You can await the returned task, knowing that it has already finished.</span></span> <span data-ttu-id="8d95e-216">Poniższy kod pokazuje, jak <xref:System.Threading.Tasks.Task.WhenAny%2A> można użyć do oczekiwania na pierwsze zadanie, aby zakończyć, a następnie przetworzyć jego wynik.</span><span class="sxs-lookup"><span data-stu-id="8d95e-216">The following code shows how you could use <xref:System.Threading.Tasks.Task.WhenAny%2A> to await the first task to finish and then process its result.</span></span> <span data-ttu-id="8d95e-217">Po przetworzeniu wyniku z ukończonego zadania należy usunąć to ukończone `WhenAny`zadanie z listy zadań przekazanych do .</span><span class="sxs-lookup"><span data-stu-id="8d95e-217">After processing the result from the completed task, you remove that completed task from the list of tasks passed to `WhenAny`.</span></span>

[!code-csharp[AwaitAnyTask](~/samples/snippets/csharp/tour-of-async/AsyncBreakfast-final/Program.cs#AwaitAnyTask)]

<span data-ttu-id="8d95e-218">Po tych wszystkich zmianach `Main` ostateczna wersja wygląda jak następujący kod:</span><span class="sxs-lookup"><span data-stu-id="8d95e-218">After all those changes, the final version of `Main` looks like the following code:</span></span>

[!code-csharp[Final](~/samples/snippets/csharp/tour-of-async/AsyncBreakfast-final/Program.cs#Main)]

<span data-ttu-id="8d95e-219">Ten końcowy kod jest asynchroniczny.</span><span class="sxs-lookup"><span data-stu-id="8d95e-219">This final code is asynchronous.</span></span> <span data-ttu-id="8d95e-220">Dokładniej odzwierciedla, jak dana osoba będzie gotować śniadanie.</span><span class="sxs-lookup"><span data-stu-id="8d95e-220">It more accurately reflects how a person would cook a breakfast.</span></span> <span data-ttu-id="8d95e-221">Porównaj poprzedni kod z pierwszym próbku kodu w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="8d95e-221">Compare the preceding code with the first code sample in this article.</span></span> <span data-ttu-id="8d95e-222">Podstawowe akcje są nadal jasne z czytania kodu.</span><span class="sxs-lookup"><span data-stu-id="8d95e-222">The core actions are still clear from reading the code.</span></span> <span data-ttu-id="8d95e-223">Możesz przeczytać ten kod w taki sam sposób, jak byś przeczytał te instrukcje dotyczące przygotowania śniadania na początku tego artykułu.</span><span class="sxs-lookup"><span data-stu-id="8d95e-223">You can read this code the same way you'd read those instructions for making a breakfast at the beginning of this article.</span></span> <span data-ttu-id="8d95e-224">Funkcje języka `async` i `await` zapewniają tłumaczenie, które każda osoba wykonuje, aby postępować zgodnie z tymi pisemnymi instrukcjami: uruchamiaj zadania tak, jak to tylko możliwe i nie blokuj oczekiwania na wykonanie zadań.</span><span class="sxs-lookup"><span data-stu-id="8d95e-224">The language features for `async` and `await` provide the translation every person makes to follow those written instructions: start tasks as you can and don't block waiting for tasks to complete.</span></span>
