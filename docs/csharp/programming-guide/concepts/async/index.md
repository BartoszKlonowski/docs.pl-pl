---
title: 'Programowanie asynchroniczne w języku C #'
description: Omówienie obsługi języka C# w programowaniu asynchronicznym przy użyciu asynchronicznego, await, zadania i zadania<T>
ms.date: 05/26/2020
ms.openlocfilehash: 703392ca6ba4e6fb08dd8a88817babc167394788
ms.sourcegitcommit: 03fec33630b46e78d5e81e91b40518f32c4bd7b5
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 05/27/2020
ms.locfileid: "84007965"
---
# <a name="asynchronous-programming-with-async-and-await"></a><span data-ttu-id="c6d28-103">Programowanie asynchroniczne przy użyciu elementów async i await</span><span class="sxs-lookup"><span data-stu-id="c6d28-103">Asynchronous programming with async and await</span></span>

<span data-ttu-id="c6d28-104">[Model programowania asynchronicznego zadania (TAP)](task-asynchronous-programming-model.md) zawiera streszczenie w porównaniu z kodem asynchronicznym.</span><span class="sxs-lookup"><span data-stu-id="c6d28-104">The [Task asynchronous programming model (TAP)](task-asynchronous-programming-model.md) provides an abstraction over asynchronous code.</span></span> <span data-ttu-id="c6d28-105">Napiszesz kod jako sekwencję instrukcji, tak jak zawsze.</span><span class="sxs-lookup"><span data-stu-id="c6d28-105">You write code as a sequence of statements, just like always.</span></span> <span data-ttu-id="c6d28-106">Można odczytać ten kod, tak jakby każda instrukcja została zakończona przed rozpoczęciem następnego.</span><span class="sxs-lookup"><span data-stu-id="c6d28-106">You can read that code as though each statement completes before the next begins.</span></span> <span data-ttu-id="c6d28-107">Kompilator wykonuje szereg transformacji, ponieważ niektóre z tych instrukcji mogą zacząć pracę i zwrócić <xref:System.Threading.Tasks.Task> , która reprezentuje bieżącą pracę.</span><span class="sxs-lookup"><span data-stu-id="c6d28-107">The compiler performs a number of transformations because some of those statements may start work and return a <xref:System.Threading.Tasks.Task> that represents the ongoing work.</span></span>

<span data-ttu-id="c6d28-108">Jest to cel tej składni: Włącz kod, który odczytuje się jak sekwencja instrukcji, ale wykonuje się w znacznie bardziej skomplikowanej kolejności na podstawie zewnętrznej alokacji zasobów i po zakończeniu zadań.</span><span class="sxs-lookup"><span data-stu-id="c6d28-108">That's the goal of this syntax: enable code that reads like a sequence of statements, but executes in a much more complicated order based on external resource allocation and when tasks complete.</span></span> <span data-ttu-id="c6d28-109">Jest to analogiczne do sposobu, w jaki ludzie udostępniają instrukcje dotyczące procesów zawierających zadania asynchroniczne.</span><span class="sxs-lookup"><span data-stu-id="c6d28-109">It's analogous to how people give instructions for processes that include asynchronous tasks.</span></span> <span data-ttu-id="c6d28-110">W tym artykule przedstawiono przykład instrukcji służących do nawiązywania śniadania, aby zobaczyć `async` , jak słowa kluczowe i ułatwiają `await` postanowienie o kodzie, który zawiera szereg instrukcji asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="c6d28-110">Throughout this article, you'll use an example of instructions for making a breakfast to see how the `async` and `await` keywords make it easier to reason about code, that includes a series of asynchronous instructions.</span></span> <span data-ttu-id="c6d28-111">Napiszesz instrukcje podobne do poniższej listy, aby wyjaśnić, jak utworzyć śniadanie:</span><span class="sxs-lookup"><span data-stu-id="c6d28-111">You'd write the instructions something like the following list to explain how to make a breakfast:</span></span>

1. <span data-ttu-id="c6d28-112">Wlać filiżankę kawy.</span><span class="sxs-lookup"><span data-stu-id="c6d28-112">Pour a cup of coffee.</span></span>
1. <span data-ttu-id="c6d28-113">Podgrzewaj panoramę, a następnie przefrj dwie jaja.</span><span class="sxs-lookup"><span data-stu-id="c6d28-113">Heat up a pan, then fry two eggs.</span></span>
1. <span data-ttu-id="c6d28-114">Narybka trzy wycinki Bacon.</span><span class="sxs-lookup"><span data-stu-id="c6d28-114">Fry three slices of bacon.</span></span>
1. <span data-ttu-id="c6d28-115">Wyskakujące dwa elementy chleba.</span><span class="sxs-lookup"><span data-stu-id="c6d28-115">Toast two pieces of bread.</span></span>
1. <span data-ttu-id="c6d28-116">Dodaj masło i dżem do wyskakującego powiadomienia.</span><span class="sxs-lookup"><span data-stu-id="c6d28-116">Add butter and jam to the toast.</span></span>
1. <span data-ttu-id="c6d28-117">Wlać szklany sok pomarańczowy.</span><span class="sxs-lookup"><span data-stu-id="c6d28-117">Pour a glass of orange juice.</span></span>

<span data-ttu-id="c6d28-118">W przypadku korzystania z funkcji gotowania należy wykonać te instrukcje **asynchronicznie**.</span><span class="sxs-lookup"><span data-stu-id="c6d28-118">If you have experience with cooking, you'd execute those instructions **asynchronously**.</span></span> <span data-ttu-id="c6d28-119">Zaczniesz rozgrzewać panoramy dla jaj, a następnie uruchomić Bacon.</span><span class="sxs-lookup"><span data-stu-id="c6d28-119">You'd start warming the pan for eggs, then start the bacon.</span></span> <span data-ttu-id="c6d28-120">Należy umieścić chleb w wyskakującym, a następnie rozpocząć jaja.</span><span class="sxs-lookup"><span data-stu-id="c6d28-120">You'd put the bread in the toaster, then start the eggs.</span></span> <span data-ttu-id="c6d28-121">W każdym kroku procesu należy uruchomić zadanie, a następnie zwrócić uwagę na zadania, które są gotowe do Twojej uwagi.</span><span class="sxs-lookup"><span data-stu-id="c6d28-121">At each step of the process, you'd start a task, then turn your attention to tasks that are ready for your attention.</span></span>

<span data-ttu-id="c6d28-122">Śniadanie gotowania jest dobrym przykładem asynchronicznej pracy, która nie jest równoległa.</span><span class="sxs-lookup"><span data-stu-id="c6d28-122">Cooking breakfast is a good example of asynchronous work that isn't parallel.</span></span> <span data-ttu-id="c6d28-123">Jedna osoba (lub wątek) może obsłużyć wszystkie te zadania.</span><span class="sxs-lookup"><span data-stu-id="c6d28-123">One person (or thread) can handle all these tasks.</span></span> <span data-ttu-id="c6d28-124">W przypadku kontynuowania nieprzerwanego śniadania jedna osoba może napełnić proces, rozpoczynając następne zadanie przed pierwszym zakończeniem.</span><span class="sxs-lookup"><span data-stu-id="c6d28-124">Continuing the breakfast analogy, one person can make breakfast asynchronously by starting the next task before the first completes.</span></span> <span data-ttu-id="c6d28-125">Postęp gotowania niezależnie od tego, czy ktoś ją ogląda.</span><span class="sxs-lookup"><span data-stu-id="c6d28-125">The cooking progresses whether or not someone is watching it.</span></span> <span data-ttu-id="c6d28-126">Gdy tylko zaczniesz rozgrzewać kadrowanie dla jaj, możesz zacząć Frying Bacon.</span><span class="sxs-lookup"><span data-stu-id="c6d28-126">As soon as you start warming the pan for the eggs, you can begin frying the bacon.</span></span> <span data-ttu-id="c6d28-127">Po rozpoczęciu Bacon można umieścić chleb w wyskakującym pasku.</span><span class="sxs-lookup"><span data-stu-id="c6d28-127">Once the bacon starts, you can put the bread into the toaster.</span></span>

<span data-ttu-id="c6d28-128">Dla algorytmu równoległego potrzebna jest wiele Cooka (lub wątków).</span><span class="sxs-lookup"><span data-stu-id="c6d28-128">For a parallel algorithm, you'd need multiple cooks (or threads).</span></span> <span data-ttu-id="c6d28-129">Jedna z nich spowoduje, że jaja, jeden z Bacon i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="c6d28-129">One would make the eggs, one the bacon, and so on.</span></span> <span data-ttu-id="c6d28-130">Każdy z nich będzie koncentrować się tylko na jednym zadaniu.</span><span class="sxs-lookup"><span data-stu-id="c6d28-130">Each one would be focused on just that one task.</span></span> <span data-ttu-id="c6d28-131">Każdy Cooka (lub wątek) zostałby zablokowany synchronicznie, oczekując na Bacon w celu przerzucenia lub wyskakującego okienka.</span><span class="sxs-lookup"><span data-stu-id="c6d28-131">Each cook (or thread) would be blocked synchronously waiting for bacon to be ready to flip, or the toast to pop.</span></span>

<span data-ttu-id="c6d28-132">Teraz Rozważ te same instrukcje, które zostały wpisane jako instrukcje języka C#:</span><span class="sxs-lookup"><span data-stu-id="c6d28-132">Now, consider those same instructions written as C# statements:</span></span>

:::code language="csharp" source="snippets/index/AsyncBreakfast-starter/Program.cs" highlight="8-27":::

> [!NOTE]
> <span data-ttu-id="c6d28-133">`Coffee`Klasy, `Egg` , `Bacon` , `Toast` i `Juice` są puste.</span><span class="sxs-lookup"><span data-stu-id="c6d28-133">The `Coffee`, `Egg`, `Bacon`, `Toast`, and `Juice` classes are empty.</span></span> <span data-ttu-id="c6d28-134">Są one po prostu klasy znaczników do celów demonstracyjnych, nie zawierają żadnych właściwości ani nie mają żadnego innego celu.</span><span class="sxs-lookup"><span data-stu-id="c6d28-134">They are simply marker classes for the purpose of demonstration, contain no properties, and serve no other purpose.</span></span>

<span data-ttu-id="c6d28-135">Komputery nie interpretują tych instrukcji w taki sam sposób jak ludzie.</span><span class="sxs-lookup"><span data-stu-id="c6d28-135">Computers don't interpret those instructions the same way people do.</span></span> <span data-ttu-id="c6d28-136">Komputer będzie blokować każdą instrukcję do momentu zakończenia pracy przed przejściem do następnej instrukcji.</span><span class="sxs-lookup"><span data-stu-id="c6d28-136">The computer will block on each statement until the work is complete before moving on to the next statement.</span></span> <span data-ttu-id="c6d28-137">Spowoduje to utworzenie niespełniającego śniadania.</span><span class="sxs-lookup"><span data-stu-id="c6d28-137">That creates an unsatisfying breakfast.</span></span> <span data-ttu-id="c6d28-138">Późniejsze zadania nie zostaną uruchomione do momentu ukończenia wcześniejszych zadań.</span><span class="sxs-lookup"><span data-stu-id="c6d28-138">The later tasks wouldn't be started until the earlier tasks had completed.</span></span> <span data-ttu-id="c6d28-139">Utworzenie śniadania może zająć dużo czasu, a niektóre elementy byłyby na zimno przed rozpoczęciem.</span><span class="sxs-lookup"><span data-stu-id="c6d28-139">It would take much longer to create the breakfast, and some items would have gotten cold before being served.</span></span>

<span data-ttu-id="c6d28-140">Jeśli chcesz, aby komputer wykonywał powyższe instrukcje asynchronicznie, musisz napisać kod asynchroniczny.</span><span class="sxs-lookup"><span data-stu-id="c6d28-140">If you want the computer to execute the above instructions asynchronously, you must write asynchronous code.</span></span>

<span data-ttu-id="c6d28-141">Te zagadnienia są ważne w przypadku programów, które można napisać dzisiaj.</span><span class="sxs-lookup"><span data-stu-id="c6d28-141">These concerns are important for the programs you write today.</span></span> <span data-ttu-id="c6d28-142">Podczas pisania programów klienckich, interfejs użytkownika ma reagować na dane wejściowe użytkownika.</span><span class="sxs-lookup"><span data-stu-id="c6d28-142">When you write client programs, you want the UI to be responsive to user input.</span></span> <span data-ttu-id="c6d28-143">Twoja aplikacja nie powinna sprawiać, że telefon jest zamrożony podczas pobierania danych z sieci Web.</span><span class="sxs-lookup"><span data-stu-id="c6d28-143">Your application shouldn't make a phone appear frozen while it's downloading data from the web.</span></span> <span data-ttu-id="c6d28-144">W przypadku pisania programów serwerowych nie ma możliwości blokowania wątków.</span><span class="sxs-lookup"><span data-stu-id="c6d28-144">When you write server programs, you don't want threads blocked.</span></span> <span data-ttu-id="c6d28-145">Te wątki mogą obsługiwać inne żądania.</span><span class="sxs-lookup"><span data-stu-id="c6d28-145">Those threads could be serving other requests.</span></span> <span data-ttu-id="c6d28-146">Użycie kodu synchronicznego, gdy istnieje asynchroniczna alternatywa, powoduje, że skalowanie w poziomie jest tańsze.</span><span class="sxs-lookup"><span data-stu-id="c6d28-146">Using synchronous code when asynchronous alternatives exist hurts your ability to scale out less expensively.</span></span> <span data-ttu-id="c6d28-147">Płacisz za te zablokowane wątki.</span><span class="sxs-lookup"><span data-stu-id="c6d28-147">You pay for those blocked threads.</span></span>

<span data-ttu-id="c6d28-148">Pomyślne aplikacje Modern wymagają kodu asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="c6d28-148">Successful modern applications require asynchronous code.</span></span> <span data-ttu-id="c6d28-149">Bez obsługi języka, pisania asynchronicznie wymaganego kodu wywołania zwrotne, zdarzenia ukończenia lub inne oznacza, że zasłania pierwotny cel kodu.</span><span class="sxs-lookup"><span data-stu-id="c6d28-149">Without language support, writing asynchronous code required callbacks, completion events, or other means that obscured the original intent of the code.</span></span> <span data-ttu-id="c6d28-150">Zaletą kodu synchronicznego jest łatwość zrozumienia.</span><span class="sxs-lookup"><span data-stu-id="c6d28-150">The advantage of the synchronous code is that it's easy to understand.</span></span> <span data-ttu-id="c6d28-151">Akcje krok po kroku ułatwiają skanowanie i zrozumienie.</span><span class="sxs-lookup"><span data-stu-id="c6d28-151">The step-by-step actions make it easy to scan and understand.</span></span> <span data-ttu-id="c6d28-152">Tradycyjne modele asynchroniczne zmuszają do skoncentrowania się na asynchronicznym charakterze kodu, a nie na podstawowych działaniach kodu.</span><span class="sxs-lookup"><span data-stu-id="c6d28-152">Traditional asynchronous models forced you to focus on the asynchronous nature of the code, not on the fundamental actions of the code.</span></span>

## <a name="dont-block-await-instead"></a><span data-ttu-id="c6d28-153">Nie blokuj, await zamiast</span><span class="sxs-lookup"><span data-stu-id="c6d28-153">Don't block, await instead</span></span>

<span data-ttu-id="c6d28-154">Powyższy kod demonstruje niewłaściwe rozwiązanie: konstruowanie kodu synchronicznego do wykonywania operacji asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="c6d28-154">The preceding code demonstrates a bad practice: constructing synchronous code to perform asynchronous operations.</span></span> <span data-ttu-id="c6d28-155">Zgodnie z zapisaniem ten kod blokuje wątek wykonujący go przez wykonywanie innych czynności.</span><span class="sxs-lookup"><span data-stu-id="c6d28-155">As written, this code blocks the thread executing it from doing any other work.</span></span> <span data-ttu-id="c6d28-156">Nie zostanie ona przerwana, gdy jakieś zadania są w toku.</span><span class="sxs-lookup"><span data-stu-id="c6d28-156">It won't be interrupted while any of the tasks are in progress.</span></span> <span data-ttu-id="c6d28-157">Po wprowadzeniu chleba na wyskakującym pasku jest to możliwe.</span><span class="sxs-lookup"><span data-stu-id="c6d28-157">It would be as though you stared at the toaster after putting the bread in.</span></span> <span data-ttu-id="c6d28-158">Dowiesz się, jak wszyscy rozmawiają z Twoim zdjęte.</span><span class="sxs-lookup"><span data-stu-id="c6d28-158">You'd ignore anyone talking to you until the toast popped.</span></span>

<span data-ttu-id="c6d28-159">Zacznijmy od zaktualizowania tego kodu, aby wątek nie zablokuje wykonywania zadań.</span><span class="sxs-lookup"><span data-stu-id="c6d28-159">Let's start by updating this code so that the thread doesn't block while tasks are running.</span></span> <span data-ttu-id="c6d28-160">`await`Słowo kluczowe zapewnia nieblokujący sposób uruchamiania zadania, a następnie kontynuuje wykonywanie po zakończeniu zadania.</span><span class="sxs-lookup"><span data-stu-id="c6d28-160">The `await` keyword provides a non-blocking way to start a task, then continue execution when that task completes.</span></span> <span data-ttu-id="c6d28-161">Prosta, asynchroniczna wersja kodu naśniadania będzie wyglądać następująco:</span><span class="sxs-lookup"><span data-stu-id="c6d28-161">A simple asynchronous version of the make a breakfast code would look like the following snippet:</span></span>

:::code language="csharp" source="snippets/index/AsyncBreakfast-V2/Program.cs" id="SnippetMain":::

> [!TIP]
> <span data-ttu-id="c6d28-162">Treści metod `FryEggsAsync` , `FryBaconAsync` , i, `ToastBreadAsync` zostały zaktualizowane, aby zwracały `Task<Egg>` , `Task<Bacon>` i `Task<Toast>` odpowiednio.</span><span class="sxs-lookup"><span data-stu-id="c6d28-162">The method bodies of the `FryEggsAsync`, `FryBaconAsync`, and `ToastBreadAsync` have all been updated to return `Task<Egg>`, `Task<Bacon>`, and `Task<Toast>` respectively.</span></span> <span data-ttu-id="c6d28-163">Metody są zmieniane z oryginalnej wersji w celu uwzględnienia sufiksu "Async".</span><span class="sxs-lookup"><span data-stu-id="c6d28-163">The methods are renamed from their original version to include the "Async" suffix.</span></span> <span data-ttu-id="c6d28-164">Ich wdrożenia są wyświetlane [w dalszej części tego artykułu](#final-version) .</span><span class="sxs-lookup"><span data-stu-id="c6d28-164">Their implementations are shown as part of the [final version](#final-version) later in this article.</span></span>

<span data-ttu-id="c6d28-165">Ten kod nie jest blokowany, gdy jaja lub Bacon są gotowania.</span><span class="sxs-lookup"><span data-stu-id="c6d28-165">This code doesn't block while the eggs or the bacon are cooking.</span></span> <span data-ttu-id="c6d28-166">W tym kodzie nie zostaną uruchomione żadne inne zadania.</span><span class="sxs-lookup"><span data-stu-id="c6d28-166">This code won't start any other tasks though.</span></span> <span data-ttu-id="c6d28-167">Nadal wyskakujące powiadomienie na wyskakującym pasku i stare je do momentu pop.</span><span class="sxs-lookup"><span data-stu-id="c6d28-167">You'd still put the toast in the toaster and stare at it until it pops.</span></span> <span data-ttu-id="c6d28-168">Ale co najmniej, wystarczy odpowiedzieć na każdą z nich.</span><span class="sxs-lookup"><span data-stu-id="c6d28-168">But at least, you'd respond to anyone that wanted your attention.</span></span> <span data-ttu-id="c6d28-169">W restauracji, w której znajduje się wiele zamówień, Cooka może rozpocząć kolejną śniadanie, podczas gdy pierwszy jest gotowania.</span><span class="sxs-lookup"><span data-stu-id="c6d28-169">In a restaurant where multiple orders are placed, the cook could start another breakfast while the first is cooking.</span></span>

<span data-ttu-id="c6d28-170">Teraz wątek pracujący nad śniadaniem nie jest blokowany podczas oczekiwania na zadanie uruchomione, które jeszcze się nie zakończyło.</span><span class="sxs-lookup"><span data-stu-id="c6d28-170">Now, the thread working on the breakfast isn't blocked while awaiting any started task that hasn't yet finished.</span></span> <span data-ttu-id="c6d28-171">W przypadku niektórych aplikacji ta zmiana jest wymagana.</span><span class="sxs-lookup"><span data-stu-id="c6d28-171">For some applications, this change is all that's needed.</span></span> <span data-ttu-id="c6d28-172">Aplikacja GUI nadal reaguje na użytkownika za pomocą tylko tej zmiany.</span><span class="sxs-lookup"><span data-stu-id="c6d28-172">A GUI application still responds to the user with just this change.</span></span> <span data-ttu-id="c6d28-173">Jednak w tym scenariuszu potrzebujesz więcej informacji.</span><span class="sxs-lookup"><span data-stu-id="c6d28-173">However, for this scenario, you want more.</span></span> <span data-ttu-id="c6d28-174">Nie chcesz, aby poszczególne zadania składników były wykonywane sekwencyjnie.</span><span class="sxs-lookup"><span data-stu-id="c6d28-174">You don't want each of the component tasks to be executed sequentially.</span></span> <span data-ttu-id="c6d28-175">Przed zaczekaniem na ukończenie poprzedniego zadania lepiej uruchomić wszystkie zadania składników.</span><span class="sxs-lookup"><span data-stu-id="c6d28-175">It's better to start each of the component tasks before awaiting the previous task's completion.</span></span>

## <a name="start-tasks-concurrently"></a><span data-ttu-id="c6d28-176">Uruchom zadania współbieżnie</span><span class="sxs-lookup"><span data-stu-id="c6d28-176">Start tasks concurrently</span></span>

<span data-ttu-id="c6d28-177">W wielu scenariuszach należy od razu zacząć uruchamiać kilka niezależnych zadań.</span><span class="sxs-lookup"><span data-stu-id="c6d28-177">In many scenarios, you want to start several independent tasks immediately.</span></span> <span data-ttu-id="c6d28-178">Następnie, po zakończeniu każdego zadania, można kontynuować wykonywanie innych gotowych zadań.</span><span class="sxs-lookup"><span data-stu-id="c6d28-178">Then, as each task finishes, you can continue other work that's ready.</span></span> <span data-ttu-id="c6d28-179">W przypadku korzystania z analogu śniadaniowego wiesz, jak szybko uzyskać śniadanie.</span><span class="sxs-lookup"><span data-stu-id="c6d28-179">In the breakfast analogy, that's how you get breakfast done more quickly.</span></span> <span data-ttu-id="c6d28-180">Wszystko to jest również wykonywane blisko tego samego czasu.</span><span class="sxs-lookup"><span data-stu-id="c6d28-180">You also get everything done close to the same time.</span></span> <span data-ttu-id="c6d28-181">Uzyskasz gorącą śniadanie.</span><span class="sxs-lookup"><span data-stu-id="c6d28-181">You'll get a hot breakfast.</span></span>

<span data-ttu-id="c6d28-182"><xref:System.Threading.Tasks.Task?displayProperty=nameWithType>I powiązane typy są klasami, których można użyć, aby przyczynić się do zadań, które są w toku.</span><span class="sxs-lookup"><span data-stu-id="c6d28-182">The <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> and related types are classes you can use to reason about tasks that are in progress.</span></span> <span data-ttu-id="c6d28-183">Dzięki temu można napisać kod, który jest bardziej zbliżony do sposobu, w jaki faktycznie tworzysz śniadanie.</span><span class="sxs-lookup"><span data-stu-id="c6d28-183">That enables you to write code that more closely resembles the way you'd actually create breakfast.</span></span> <span data-ttu-id="c6d28-184">W tym samym czasie można rozpocząć gotowanie jaj, Bacon i wyskakujących powiadomień.</span><span class="sxs-lookup"><span data-stu-id="c6d28-184">You'd start cooking the eggs, bacon, and toast at the same time.</span></span> <span data-ttu-id="c6d28-185">Ponieważ każda z nich wymaga działania, należy zwrócić uwagę na to zadanie, zadbać o następną akcję, a następnie oczekiwać na coś innego, co wymaga uwagi.</span><span class="sxs-lookup"><span data-stu-id="c6d28-185">As each requires action, you'd turn your attention to that task, take care of the next action, then await for something else that requires your attention.</span></span>

<span data-ttu-id="c6d28-186">Uruchamiasz zadanie i przytrzymasz do <xref:System.Threading.Tasks.Task> obiektu, który reprezentuje pracę.</span><span class="sxs-lookup"><span data-stu-id="c6d28-186">You start a task and hold on to the <xref:System.Threading.Tasks.Task> object that represents the work.</span></span> <span data-ttu-id="c6d28-187">`await`Każde zadanie zostanie wyświetlone przed rozpoczęciem pracy z jego wynikiem.</span><span class="sxs-lookup"><span data-stu-id="c6d28-187">You'll `await` each task before working with its result.</span></span>

<span data-ttu-id="c6d28-188">Wprowadźmy te zmiany w kodzie śniadania.</span><span class="sxs-lookup"><span data-stu-id="c6d28-188">Let's make these changes to the breakfast code.</span></span> <span data-ttu-id="c6d28-189">Pierwszym krokiem jest przechowywanie zadań do operacji po ich uruchomieniu, a nie ich oczekiwanie:</span><span class="sxs-lookup"><span data-stu-id="c6d28-189">The first step is to store the tasks for operations when they start, rather than awaiting them:</span></span>

```csharp
Coffee cup = PourCoffee();
Console.WriteLine("coffee is ready");

Task<Egg> eggsTask = FryEggsAsync(2);
Egg eggs = await eggsTask;
Console.WriteLine("eggs are ready");

Task<Bacon> baconTask = FryBaconAsync(3);
Bacon bacon = await baconTask;
Console.WriteLine("bacon is ready");

Task<Toast> toastTask = ToastBreadAsync(2);
Toast toast = await toastTask;
ApplyButter(toast);
ApplyJam(toast);
Console.WriteLine("toast is ready");

Juice oj = PourOJ();
Console.WriteLine("oj is ready");
Console.WriteLine("Breakfast is ready!");
```

<span data-ttu-id="c6d28-190">Następnie można przenieść `await` instrukcje dotyczące Bacon i jaj do końca metody przed objęciem śniadania:</span><span class="sxs-lookup"><span data-stu-id="c6d28-190">Next, you can move the `await` statements for the bacon and eggs to the end of the method, before serving breakfast:</span></span>

```csharp
Coffee cup = PourCoffee();
Console.WriteLine("coffee is ready");

Task<Egg> eggsTask = FryEggsAsync(2);
Task<Bacon> baconTask = FryBaconAsync(3);
Task<Toast> toastTask = ToastBreadAsync(2);

Toast toast = await toastTask;
ApplyButter(toast);
ApplyJam(toast);
Console.WriteLine("toast is ready");
Juice oj = PourOJ();
Console.WriteLine("oj is ready");

Egg eggs = await eggsTask;
Console.WriteLine("eggs are ready");
Bacon bacon = await baconTask;
Console.WriteLine("bacon is ready");

Console.WriteLine("Breakfast is ready!");
```

<span data-ttu-id="c6d28-191">Poprzedni kod działa lepiej.</span><span class="sxs-lookup"><span data-stu-id="c6d28-191">The preceding code works better.</span></span> <span data-ttu-id="c6d28-192">Wszystkie zadania asynchroniczne są uruchamiane jednocześnie.</span><span class="sxs-lookup"><span data-stu-id="c6d28-192">You start all the asynchronous tasks at once.</span></span> <span data-ttu-id="c6d28-193">Każde zadanie zostanie zaczekane tylko wtedy, gdy są potrzebne wyniki.</span><span class="sxs-lookup"><span data-stu-id="c6d28-193">You await each task only when you need the results.</span></span> <span data-ttu-id="c6d28-194">Poprzedni kod może być podobny do kodu w aplikacji sieci Web, która wysyła żądania różnych mikrousług, a następnie łączy wyniki w jedną stronę.</span><span class="sxs-lookup"><span data-stu-id="c6d28-194">The preceding code may be similar to code in a web application that makes requests of different microservices, then combines the results into a single page.</span></span> <span data-ttu-id="c6d28-195">Wszystkie żądania zostaną wprowadzone natychmiast, następnie `await` wszystkie te zadania i tworzą stronę sieci Web.</span><span class="sxs-lookup"><span data-stu-id="c6d28-195">You'll make all the requests immediately, then `await` all those tasks and compose the web page.</span></span>

## <a name="composition-with-tasks"></a><span data-ttu-id="c6d28-196">Kompozycja z zadaniami</span><span class="sxs-lookup"><span data-stu-id="c6d28-196">Composition with tasks</span></span>

 <span data-ttu-id="c6d28-197">Wszystko jest gotowe do śniadania w tym samym czasie, z wyjątkiem wyskakującego powiadomienia.</span><span class="sxs-lookup"><span data-stu-id="c6d28-197">You have everything ready for breakfast at the same time except the toast.</span></span> <span data-ttu-id="c6d28-198">Wyskakujące powiadomienia są kompozycją operacji asynchronicznej (wyskakujące chleb) i synchronicznymi operacjami (dodaniem masła i zakleszczeniem).</span><span class="sxs-lookup"><span data-stu-id="c6d28-198">Making the toast is the composition of an asynchronous operation (toasting the bread), and synchronous operations (adding the butter and the jam).</span></span> <span data-ttu-id="c6d28-199">Aktualizacja tego kodu ilustruje ważną koncepcję:</span><span class="sxs-lookup"><span data-stu-id="c6d28-199">Updating this code illustrates an important concept:</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c6d28-200">Kompozycja operacji asynchronicznej, po której następuje synchroniczna operacja, jest operacją asynchroniczną.</span><span class="sxs-lookup"><span data-stu-id="c6d28-200">The composition of an asynchronous operation followed by synchronous work is an asynchronous operation.</span></span> <span data-ttu-id="c6d28-201">Podano inny sposób, jeśli jakakolwiek część operacji jest asynchroniczna, cała operacja jest asynchroniczna.</span><span class="sxs-lookup"><span data-stu-id="c6d28-201">Stated another way, if any portion of an operation is asynchronous, the entire operation is asynchronous.</span></span>

<span data-ttu-id="c6d28-202">Powyższy kod wskazuje, że można użyć <xref:System.Threading.Tasks.Task> lub <xref:System.Threading.Tasks.Task%601> obiektów do przechowywania uruchomionych zadań.</span><span class="sxs-lookup"><span data-stu-id="c6d28-202">The preceding code showed you that you can use <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> objects to hold running tasks.</span></span> <span data-ttu-id="c6d28-203">`await`Każde zadanie przed użyciem jego wyniku.</span><span class="sxs-lookup"><span data-stu-id="c6d28-203">You `await` each task before using its result.</span></span> <span data-ttu-id="c6d28-204">Następnym krokiem jest utworzenie metod, które reprezentują kombinację innych zadań.</span><span class="sxs-lookup"><span data-stu-id="c6d28-204">The next step is to create methods that represent the combination of other work.</span></span> <span data-ttu-id="c6d28-205">Przed objęciem śniadania, należy oczekiwać, że zadanie reprezentuje wyskakujące chleb przed dodaniem masła i dżemu.</span><span class="sxs-lookup"><span data-stu-id="c6d28-205">Before serving breakfast, you want to await the task that represents toasting the bread before adding butter and jam.</span></span> <span data-ttu-id="c6d28-206">Można przedstawić, że pracujesz z poniższym kodem:</span><span class="sxs-lookup"><span data-stu-id="c6d28-206">You can represent that work with the following code:</span></span>

:::code language="csharp" source="snippets/index/AsyncBreakfast-V3/Program.cs" id="SnippetComposeToastTask":::

<span data-ttu-id="c6d28-207">Poprzednia metoda ma `async` modyfikator w podpisie.</span><span class="sxs-lookup"><span data-stu-id="c6d28-207">The preceding method has the `async` modifier in its signature.</span></span> <span data-ttu-id="c6d28-208">Sygnalizuje kompilatorowi, że ta metoda zawiera `await` instrukcję; zawiera operacje asynchroniczne.</span><span class="sxs-lookup"><span data-stu-id="c6d28-208">That signals to the compiler that this method contains an `await` statement; it contains asynchronous operations.</span></span> <span data-ttu-id="c6d28-209">Ta metoda przedstawia zadanie, które wyskakujące chleb, a następnie dodaje masło i dżem.</span><span class="sxs-lookup"><span data-stu-id="c6d28-209">This method represents the task that toasts the bread, then adds butter and jam.</span></span> <span data-ttu-id="c6d28-210">Ta metoda zwraca <xref:System.Threading.Tasks.Task%601> , który reprezentuje skład tych trzech operacji.</span><span class="sxs-lookup"><span data-stu-id="c6d28-210">This method returns a <xref:System.Threading.Tasks.Task%601> that represents the composition of those three operations.</span></span> <span data-ttu-id="c6d28-211">Główny blok kodu jest teraz:</span><span class="sxs-lookup"><span data-stu-id="c6d28-211">The main block of code now becomes:</span></span>

:::code language="csharp" source="snippets/index/AsyncBreakfast-V3/Program.cs" id="SnippetMain":::

<span data-ttu-id="c6d28-212">Poprzednia zmiana ilustruje ważną technikę pracy z kodem asynchronicznym.</span><span class="sxs-lookup"><span data-stu-id="c6d28-212">The previous change illustrated an important technique for working with asynchronous code.</span></span> <span data-ttu-id="c6d28-213">Tworzysz zadania, oddzielając operacje do nowej metody, która zwraca zadanie.</span><span class="sxs-lookup"><span data-stu-id="c6d28-213">You compose tasks by separating the operations into a new method that returns a task.</span></span> <span data-ttu-id="c6d28-214">Możesz określić, kiedy ma oczekiwać to zadanie.</span><span class="sxs-lookup"><span data-stu-id="c6d28-214">You can choose when to await that task.</span></span> <span data-ttu-id="c6d28-215">Można uruchamiać inne zadania współbieżnie.</span><span class="sxs-lookup"><span data-stu-id="c6d28-215">You can start other tasks concurrently.</span></span>

## <a name="await-tasks-efficiently"></a><span data-ttu-id="c6d28-216">Efektywne zadania oczekujące</span><span class="sxs-lookup"><span data-stu-id="c6d28-216">Await tasks efficiently</span></span>

<span data-ttu-id="c6d28-217">Serie `await` instrukcji na końcu powyższego kodu można ulepszyć przy użyciu metod `Task` klasy.</span><span class="sxs-lookup"><span data-stu-id="c6d28-217">The series of `await` statements at the end of the preceding code can be improved by using methods of the `Task` class.</span></span> <span data-ttu-id="c6d28-218">Jeden z tych interfejsów API to <xref:System.Threading.Tasks.Task.WhenAll%2A> , które zwraca, <xref:System.Threading.Tasks.Task> gdy wszystkie zadania na liście argumentów zostały ukończone, jak pokazano w poniższym kodzie:</span><span class="sxs-lookup"><span data-stu-id="c6d28-218">One of those APIs is <xref:System.Threading.Tasks.Task.WhenAll%2A>, which returns a <xref:System.Threading.Tasks.Task> that completes when all the tasks in its argument list have completed, as shown in the following code:</span></span>

```csharp
await Task.WhenAll(eggsTask, baconTask, toastTask);
Console.WriteLine("eggs are ready");
Console.WriteLine("bacon is ready");
Console.WriteLine("toast is ready");
Console.WriteLine("Breakfast is ready!");
```

<span data-ttu-id="c6d28-219">Kolejną opcją jest użycie <xref:System.Threading.Tasks.Task.WhenAny%2A> , która zwraca zakończenie, `Task<Task>` gdy którykolwiek z jego argumentów zakończy działanie.</span><span class="sxs-lookup"><span data-stu-id="c6d28-219">Another option is to use <xref:System.Threading.Tasks.Task.WhenAny%2A>, which returns a `Task<Task>` that completes when any of its arguments completes.</span></span> <span data-ttu-id="c6d28-220">Możesz oczekiwać na zwrócone zadanie, wiedząc, że już zostało zakończone.</span><span class="sxs-lookup"><span data-stu-id="c6d28-220">You can await the returned task, knowing that it has already finished.</span></span> <span data-ttu-id="c6d28-221">Poniższy kod pokazuje, jak można użyć <xref:System.Threading.Tasks.Task.WhenAny%2A> do oczekiwania na zakończenie pierwszego zadania, a następnie przetworzyć jego wynik.</span><span class="sxs-lookup"><span data-stu-id="c6d28-221">The following code shows how you could use <xref:System.Threading.Tasks.Task.WhenAny%2A> to await the first task to finish and then process its result.</span></span> <span data-ttu-id="c6d28-222">Po przetworzeniu wyniku z zadania zakończonego zadanie zostało usunięte z listy zadań przesłanych do `WhenAny` .</span><span class="sxs-lookup"><span data-stu-id="c6d28-222">After processing the result from the completed task, you remove that completed task from the list of tasks passed to `WhenAny`.</span></span>

```csharp
var breakfastTasks = new List<Task> { eggsTask, baconTask, toastTask };
while (breakfastTasks.Count > 0)
{
    Task finishedTask = await Task.WhenAny(breakfastTasks);
    if (finishedTask == eggsTask)
    {
        Console.WriteLine("eggs are ready");
    }
    else if (finishedTask == baconTask)
    {
        Console.WriteLine("bacon is ready");
    }
    else if (finishedTask == toastTask)
    {
        Console.WriteLine("toast is ready");
    }
    breakfastTasks.Remove(finishedTask);
}
```

<span data-ttu-id="c6d28-223">Po wprowadzeniu wszystkich zmian końcowa wersja kodu będzie wyglądać następująco:<a id="final-version"></a></span><span class="sxs-lookup"><span data-stu-id="c6d28-223">After all those changes, the final version of the code looks like this: <a id="final-version"></a></span></span>
:::code language="csharp" source="snippets/index/AsyncBreakfast-final/Program.cs" highlight="9-40":::

<span data-ttu-id="c6d28-224">Ten ostatni kod jest asynchroniczny.</span><span class="sxs-lookup"><span data-stu-id="c6d28-224">This final code is asynchronous.</span></span> <span data-ttu-id="c6d28-225">Dokładniej odzwierciedla to, w jaki sposób osoba może zacooka śniadanie.</span><span class="sxs-lookup"><span data-stu-id="c6d28-225">It more accurately reflects how a person would cook a breakfast.</span></span> <span data-ttu-id="c6d28-226">Porównaj poprzedni kod z pierwszym przykładowym kodem w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="c6d28-226">Compare the preceding code with the first code sample in this article.</span></span> <span data-ttu-id="c6d28-227">Podstawowe działania są nadal jasne przed odczytaniem kodu.</span><span class="sxs-lookup"><span data-stu-id="c6d28-227">The core actions are still clear from reading the code.</span></span> <span data-ttu-id="c6d28-228">Można odczytać ten kod w taki sam sposób, jak w przypadku uzyskania śniadania na początku tego artykułu.</span><span class="sxs-lookup"><span data-stu-id="c6d28-228">You can read this code the same way you'd read those instructions for making a breakfast at the beginning of this article.</span></span> <span data-ttu-id="c6d28-229">Funkcje języka dla `async` i `await` zapewniają tłumaczenie dla każdej osoby, która wykonuje te instrukcje: Rozpocznij zadania w miarę możliwości i nie blokuj oczekiwania na ukończenie zadań.</span><span class="sxs-lookup"><span data-stu-id="c6d28-229">The language features for `async` and `await` provide the translation every person makes to follow those written instructions: start tasks as you can and don't block waiting for tasks to complete.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c6d28-230">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="c6d28-230">Next steps</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="c6d28-231">Dowiedz się więcej o modelu programowania asynchronicznego zadań</span><span class="sxs-lookup"><span data-stu-id="c6d28-231">Learn about the task asynchronous programming model</span></span>](task-asynchronous-programming-model.md)
