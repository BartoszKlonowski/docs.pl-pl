---
title: Wspólne wzorce dla delegatów
description: Dowiedz się więcej o typowych wzorców do używania delegatów w kodzie, aby uniknąć silnego sprzężenia między składnikami.
ms.date: 06/20/2016
ms.assetid: 0ff8fdfd-6a11-4327-b061-0f2526f35b43
ms.openlocfilehash: 22ab88e5b139381e3a8921baa20df035f1405146
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/14/2020
ms.locfileid: "79399666"
---
# <a name="common-patterns-for-delegates"></a><span data-ttu-id="fd0eb-103">Wspólne wzorce dla delegatów</span><span class="sxs-lookup"><span data-stu-id="fd0eb-103">Common Patterns for Delegates</span></span>

[<span data-ttu-id="fd0eb-104">Wstecz</span><span class="sxs-lookup"><span data-stu-id="fd0eb-104">Previous</span></span>](delegates-strongly-typed.md)

<span data-ttu-id="fd0eb-105">Delegaci zapewniają mechanizm, który umożliwia projektowanie oprogramowania obejmujące minimalne sprzężenie między komponentami.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-105">Delegates provide a mechanism that enables software designs involving minimal coupling between components.</span></span>

<span data-ttu-id="fd0eb-106">Doskonałym przykładem tego rodzaju konstrukcji jest LINQ.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-106">One excellent example for this kind of design is LINQ.</span></span> <span data-ttu-id="fd0eb-107">Wzorzec wyrażenia kwerendy LINQ opiera się na delegatów dla wszystkich jego funkcji.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-107">The LINQ Query Expression Pattern relies on delegates for all of its features.</span></span> <span data-ttu-id="fd0eb-108">Rozważmy ten prosty przykład:</span><span class="sxs-lookup"><span data-stu-id="fd0eb-108">Consider this simple example:</span></span>

```csharp
var smallNumbers = numbers.Where(n => n < 10);
```

<span data-ttu-id="fd0eb-109">Spowoduje to filtrsekwencję liczb tylko do tych, które są mniejsze niż wartość 10.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-109">This filters the sequence of numbers to only those less than the value 10.</span></span>
<span data-ttu-id="fd0eb-110">Metoda `Where` używa delegata, który określa, które elementy sekwencji przekazać filtr.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-110">The `Where` method uses a delegate that determines which elements of a sequence pass the filter.</span></span> <span data-ttu-id="fd0eb-111">Podczas tworzenia kwerendy LINQ, należy podać implementację pełnomocnika w tym konkretnym celu.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-111">When you create a LINQ query, you supply the implementation of the delegate for this specific purpose.</span></span>

<span data-ttu-id="fd0eb-112">Prototypem metody Where jest:</span><span class="sxs-lookup"><span data-stu-id="fd0eb-112">The prototype for the Where method is:</span></span>

```csharp
public static IEnumerable<TSource> Where<TSource> (this IEnumerable<TSource> source, Func<TSource, bool> predicate);
```

<span data-ttu-id="fd0eb-113">W tym przykładzie jest powtarzany ze wszystkimi metodami, które są częścią LINQ.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-113">This example is repeated with all the methods that are part of LINQ.</span></span> <span data-ttu-id="fd0eb-114">Wszystkie one opierają się na delegatów dla kodu, który zarządza określonej kwerendy.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-114">They all rely on delegates for the code that manages the specific query.</span></span> <span data-ttu-id="fd0eb-115">Ten wzorzec projektowania interfejsu API jest bardzo potężny, aby dowiedzieć się i zrozumieć.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-115">This API design pattern is a very powerful one to learn and understand.</span></span>

<span data-ttu-id="fd0eb-116">W tym prostym przykładzie przedstawiono, jak delegaci wymagają bardzo mało sprzężenia między składnikami.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-116">This simple example illustrates how delegates require very little coupling between components.</span></span> <span data-ttu-id="fd0eb-117">Nie trzeba tworzyć klasy, która pochodzi z określonej klasy podstawowej.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-117">You don't need to create a class that derives from a particular base class.</span></span> <span data-ttu-id="fd0eb-118">Nie trzeba implementować określonego interfejsu.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-118">You don't need to implement a specific interface.</span></span>
<span data-ttu-id="fd0eb-119">Jedynym wymogiem jest zapewnienie wdrożenia jednej metody, która ma podstawowe znaczenie dla wykonywanego zadania.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-119">The only requirement is to provide the implementation of one method that is fundamental to the task at hand.</span></span>

## <a name="building-your-own-components-with-delegates"></a><span data-ttu-id="fd0eb-120">Budowanie własnych komponentów z delegatami</span><span class="sxs-lookup"><span data-stu-id="fd0eb-120">Building Your Own Components with Delegates</span></span>

<span data-ttu-id="fd0eb-121">Skorzystajmy na tym przykładzie, tworząc składnik przy użyciu projektu, który opiera się na delegatów.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-121">Let's build on that example by creating a component using a design that relies on delegates.</span></span>

<span data-ttu-id="fd0eb-122">Zdefiniujmy składnik, który może służyć do wiadomości dziennika w dużym systemie.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-122">Let's define a component that could be used for log messages in a large system.</span></span> <span data-ttu-id="fd0eb-123">Składniki biblioteki mogą być używane w wielu różnych środowiskach, na wielu różnych platformach.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-123">The library components could be used in many different environments, on multiple different platforms.</span></span> <span data-ttu-id="fd0eb-124">Istnieje wiele typowych funkcji w składniku, który zarządza dzienników.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-124">There are a lot of common features in the component that manages the logs.</span></span> <span data-ttu-id="fd0eb-125">Będzie musiał akceptować wiadomości z dowolnego składnika w systemie.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-125">It will need to accept messages from any component in the system.</span></span> <span data-ttu-id="fd0eb-126">Te komunikaty będą miały różne priorytety, którymi może zarządzać podstawowy składnik.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-126">Those messages will have different priorities, which the core component can manage.</span></span> <span data-ttu-id="fd0eb-127">Wiadomości powinny mieć sygnatury czasowe w ostatecznej formie archiwizowanej.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-127">The messages should have timestamps in their final archived form.</span></span> <span data-ttu-id="fd0eb-128">W przypadku bardziej zaawansowanych scenariuszy można filtrować wiadomości według składnika źródłowego.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-128">For more advanced scenarios, you could filter messages by the source component.</span></span>

<span data-ttu-id="fd0eb-129">Jest jeden aspekt funkcji, który często się zmienia: gdzie wiadomości są zapisywane.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-129">There is one aspect of the feature that will change often: where messages are written.</span></span> <span data-ttu-id="fd0eb-130">W niektórych środowiskach mogą być zapisywane w konsoli błędów.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-130">In some environments, they may be written to the error console.</span></span> <span data-ttu-id="fd0eb-131">W innych plik.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-131">In others, a file.</span></span> <span data-ttu-id="fd0eb-132">Inne możliwości obejmują przechowywanie bazy danych, dzienniki zdarzeń systemu operacyjnego lub inne magazyny dokumentów.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-132">Other possibilities include database storage, OS event logs, or other document storage.</span></span>

<span data-ttu-id="fd0eb-133">Istnieją również kombinacje danych wyjściowych, które mogą być używane w różnych scenariuszach.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-133">There are also combinations of output that might be used in different scenarios.</span></span> <span data-ttu-id="fd0eb-134">Możesz napisać wiadomości do konsoli i do pliku.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-134">You may want to write messages to the console and to a file.</span></span>

<span data-ttu-id="fd0eb-135">Projekt oparty na delegatach zapewni dużą elastyczność i ułatwi obsługę mechanizmów przechowywania, które mogą zostać dodane w przyszłości.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-135">A design based on delegates will provide a great deal of flexibility, and make it easy to support storage mechanisms that may be added in the future.</span></span>

<span data-ttu-id="fd0eb-136">Zgodnie z tym projektem podstawowy składnik dziennika może być niewirtualną, nawet zapieczętowaną klasą.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-136">Under this design, the primary log component can be a non-virtual, even sealed class.</span></span> <span data-ttu-id="fd0eb-137">Można podłączyć dowolny zestaw delegatów do zapisywania wiadomości na różnych nośnikach magazynu.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-137">You can plug in any set of delegates to write the messages to different storage media.</span></span> <span data-ttu-id="fd0eb-138">Wbudowana obsługa delegatów multiemisji ułatwia obsługę scenariuszy, w których wiadomości muszą być zapisywane w wielu lokalizacjach (pliku i konsoli).</span><span class="sxs-lookup"><span data-stu-id="fd0eb-138">The built in support for multicast delegates makes it easy to support scenarios where messages must be written to multiple locations (a file, and a console).</span></span>

## <a name="a-first-implementation"></a><span data-ttu-id="fd0eb-139">Pierwsza implementacja</span><span class="sxs-lookup"><span data-stu-id="fd0eb-139">A First Implementation</span></span>

<span data-ttu-id="fd0eb-140">Zacznijmy od małych: początkowej implementacji będzie akceptować nowe wiadomości i zapisywać je przy użyciu dowolnego dołączonego delegata.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-140">Let's start small: the initial implementation will accept new messages, and write them using any attached delegate.</span></span> <span data-ttu-id="fd0eb-141">Możesz zacząć od jednego pełnomocnika, który zapisuje wiadomości do konsoli.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-141">You can start with one delegate that writes messages to the console.</span></span>

[!code-csharp[LoggerImplementation](../../samples/snippets/csharp/delegates-and-events/Logger.cs#FirstImplementation "A first Logger implementation.")]

<span data-ttu-id="fd0eb-142">Klasa statyczna powyżej jest najprostszą rzeczą, która może działać.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-142">The static class above is the simplest thing that can work.</span></span> <span data-ttu-id="fd0eb-143">Musimy napisać pojedynczą implementację dla metody, która zapisuje wiadomości do konsoli:</span><span class="sxs-lookup"><span data-stu-id="fd0eb-143">We need to write the single implementation for the method that writes messages to the console:</span></span>

[!code-csharp[LogToConsole](../../samples/snippets/csharp/delegates-and-events/LoggingMethods.cs#LogToConsole "A Console logger.")]

<span data-ttu-id="fd0eb-144">Na koniec należy podłączyć delegata, dołączając go do delegata WriteMessage zadeklarowanego w rejestratorze:</span><span class="sxs-lookup"><span data-stu-id="fd0eb-144">Finally, you need to hook up the delegate by attaching it to the WriteMessage delegate declared in the logger:</span></span>

[!code-csharp[ConnectDelegate](../../samples/snippets/csharp/delegates-and-events/Program.cs#ConnectDelegate "Connect to the delegate")]

## <a name="practices"></a><span data-ttu-id="fd0eb-145">Praktyk</span><span class="sxs-lookup"><span data-stu-id="fd0eb-145">Practices</span></span>

<span data-ttu-id="fd0eb-146">Nasza dotychczasowa próbka jest dość prosta, ale nadal pokazuje niektóre z ważnych wytycznych dotyczących projektów z udziałem delegatów.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-146">Our sample so far is fairly simple, but it still demonstrates some of the important guidelines for designs involving delegates.</span></span>

<span data-ttu-id="fd0eb-147">Korzystanie z typów delegatów zdefiniowanych w ramach podstawowej ułatwia użytkownikom pracę z delegatami.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-147">Using the delegate types defined in the Core Framework makes it easier for users to work with the delegates.</span></span> <span data-ttu-id="fd0eb-148">Nie trzeba definiować nowych typów, a deweloperzy korzystający z biblioteki nie muszą uczyć się nowych, wyspecjalizowanych typów delegatów.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-148">You don't need to define new types, and developers using your library do not need to learn new, specialized delegate types.</span></span>

<span data-ttu-id="fd0eb-149">Interfejsy używane są tak minimalne i elastyczne, jak to możliwe: Aby utworzyć nowy rejestrator wyjściowy, należy utworzyć jedną metodę.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-149">The interfaces used are as minimal and as flexible as possible: To create a new output logger, you must create one method.</span></span> <span data-ttu-id="fd0eb-150">Ta metoda może być metodą statyczną lub metodą wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-150">That method may be a static method, or an instance method.</span></span> <span data-ttu-id="fd0eb-151">Może mieć dowolny dostęp.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-151">It may have any access.</span></span>

## <a name="formatting-output"></a><span data-ttu-id="fd0eb-152">Wyjście formatowania</span><span class="sxs-lookup"><span data-stu-id="fd0eb-152">Formatting Output</span></span>

<span data-ttu-id="fd0eb-153">Zróbmy tę pierwszą wersję nieco bardziej niezawodne, a następnie rozpocząć tworzenie innych mechanizmów rejestrowania.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-153">Let's make this first version a bit more robust, and then start creating other logging mechanisms.</span></span>

<span data-ttu-id="fd0eb-154">Następnie dodajmy kilka argumentów do `LogMessage()` metody, aby klasa dziennika tworzył bardziej uporządkowane komunikaty:</span><span class="sxs-lookup"><span data-stu-id="fd0eb-154">Next, let's add a few arguments to the `LogMessage()` method so that your log class creates more structured messages:</span></span>

[!code-csharp[Severity](../../samples/snippets/csharp/delegates-and-events/Logger.cs#Severity "Define severities")]
[!code-csharp[NextLogger](../../samples/snippets/csharp/delegates-and-events/Logger.cs#LoggerTwo "Refine the Logger")]

<span data-ttu-id="fd0eb-155">Następnie użyjmy tego `Severity` argumentu do filtrowania wiadomości, które są wysyłane do danych wyjściowych dziennika.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-155">Next, let's make use of that `Severity` argument to filter the messages that are sent to the log's output.</span></span>

[!code-csharp[FinalLogger](../../samples/snippets/csharp/delegates-and-events/Logger.cs#LoggerFinal "Finish the Logger")]

## <a name="practices"></a><span data-ttu-id="fd0eb-156">Praktyk</span><span class="sxs-lookup"><span data-stu-id="fd0eb-156">Practices</span></span>

<span data-ttu-id="fd0eb-157">Dodano nowe funkcje do infrastruktury rejestrowania.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-157">You've added new features to the logging infrastructure.</span></span> <span data-ttu-id="fd0eb-158">Ponieważ składnik rejestratora jest bardzo luźno sprzężona z dowolnym mechanizmem wyjściowym, te nowe funkcje można dodać bez wpływu na którykolwiek z kodu implementującego delegata rejestratora.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-158">Because the logger component is very loosely coupled to any output mechanism, these new features can be added with no impact on any of the code implementing the logger delegate.</span></span>

<span data-ttu-id="fd0eb-159">Podczas tworzenia tego, zobaczysz więcej przykładów, jak to luźne sprzęgło umożliwia większą elastyczność w aktualizowaniu części witryny bez żadnych zmian w innych lokalizacjach.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-159">As you keep building this, you'll see more examples of how this loose coupling enables greater flexibility in updating parts of the site without any changes to other locations.</span></span> <span data-ttu-id="fd0eb-160">W rzeczywistości w większej aplikacji klasy danych wyjściowych rejestratora może być w innym zestawie, a nawet nie muszą być przebudowany.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-160">In fact, in a larger application, the logger output classes might be in a different assembly, and not even need to be rebuilt.</span></span>

## <a name="building-a-second-output-engine"></a><span data-ttu-id="fd0eb-161">Budowa drugiego silnika wyjściowego</span><span class="sxs-lookup"><span data-stu-id="fd0eb-161">Building a Second Output Engine</span></span>

<span data-ttu-id="fd0eb-162">Składnik Dziennik nadchodzi dobrze.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-162">The Log component is coming along well.</span></span> <span data-ttu-id="fd0eb-163">Dodajmy jeszcze jeden aparat wyjściowy, który rejestruje wiadomości do pliku.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-163">Let's add one more output engine that logs messages to a file.</span></span> <span data-ttu-id="fd0eb-164">Będzie to nieco bardziej zaangażowany silnik wyjściowy.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-164">This will be a slightly more involved output engine.</span></span> <span data-ttu-id="fd0eb-165">Będzie to klasa, która hermetyzuje operacje pliku i zapewnia, że plik jest zawsze zamknięty po każdym zapisie.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-165">It will be a class that encapsulates the file operations, and ensures that the file is always closed after each write.</span></span> <span data-ttu-id="fd0eb-166">Gwarantuje to, że wszystkie dane są opróżniane na dysku po wygenerowaniu każdej wiadomości.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-166">That ensures that all the data is flushed to disk after each message is generated.</span></span>

<span data-ttu-id="fd0eb-167">Oto, że plik na logger:</span><span class="sxs-lookup"><span data-stu-id="fd0eb-167">Here is that file based logger:</span></span>

[!code-csharp[FileLogger](../../samples/snippets/csharp/delegates-and-events/FileLogger.cs#FileLogger "Log to files")]

<span data-ttu-id="fd0eb-168">Po utworzeniu tej klasy można utworzyć jej wystąpienia i dołączyć metodę LogMessage do składnika Logger:</span><span class="sxs-lookup"><span data-stu-id="fd0eb-168">Once you've created this class, you can instantiate it and it attaches its LogMessage method to the Logger component:</span></span>

[!code-csharp[FileLogger](../../samples/snippets/csharp/delegates-and-events/Program.cs#FileLogger "Log to files")]

<span data-ttu-id="fd0eb-169">Te dwa nie wykluczają się wzajemnie.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-169">These two are not mutually exclusive.</span></span> <span data-ttu-id="fd0eb-170">Można dołączyć obie metody dziennika i wygenerować wiadomości do konsoli i pliku:</span><span class="sxs-lookup"><span data-stu-id="fd0eb-170">You could attach both log methods and generate messages to the console and a file:</span></span>

```csharp
var fileOutput = new FileLogger("log.txt");
Logger.WriteMessage += LoggingMethods.LogToConsole; // LoggingMethods is the static class we utilized earlier
```

<span data-ttu-id="fd0eb-171">Później, nawet w tej samej aplikacji, można usunąć jednego z delegatów bez żadnych innych problemów z systemem:</span><span class="sxs-lookup"><span data-stu-id="fd0eb-171">Later, even in the same application, you can remove one of the delegates without any other issues to the system:</span></span>

```csharp
Logger.WriteMessage -= LoggingMethods.LogToConsole;
```

## <a name="practices"></a><span data-ttu-id="fd0eb-172">Praktyk</span><span class="sxs-lookup"><span data-stu-id="fd0eb-172">Practices</span></span>

<span data-ttu-id="fd0eb-173">Teraz dodano drugi program obsługi danych wyjściowych dla podsystemu rejestrowania.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-173">Now, you've added a second output handler for the logging sub-system.</span></span>
<span data-ttu-id="fd0eb-174">Ten potrzebuje nieco więcej infrastruktury, aby poprawnie obsługiwać system plików.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-174">This one needs a bit more infrastructure to correctly support the file system.</span></span> <span data-ttu-id="fd0eb-175">Delegat jest metodą wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-175">The delegate is an instance method.</span></span> <span data-ttu-id="fd0eb-176">Jest to również metoda prywatna.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-176">It's also a private method.</span></span>
<span data-ttu-id="fd0eb-177">Nie ma potrzeby większej dostępności, ponieważ infrastruktura delegata można połączyć delegatów.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-177">There's no need for greater accessibility because the delegate infrastructure can connect the delegates.</span></span>

<span data-ttu-id="fd0eb-178">Po drugie, projekt oparty na delegowaniu umożliwia wiele metod wyjściowych bez dodatkowego kodu.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-178">Second, the delegate-based design enables multiple output methods without any extra code.</span></span> <span data-ttu-id="fd0eb-179">Nie trzeba tworzyć żadnej dodatkowej infrastruktury do obsługi wielu metod wyjściowych.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-179">You don't need to build any additional infrastructure to support multiple output methods.</span></span> <span data-ttu-id="fd0eb-180">Po prostu stają się inną metodą na liście wywołania.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-180">They simply become another method on the invocation list.</span></span>

<span data-ttu-id="fd0eb-181">Należy zwrócić szczególną uwagę na kod w metodzie danych wyjściowych rejestrowania plików.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-181">Pay special attention to the code in the file logging output method.</span></span> <span data-ttu-id="fd0eb-182">Jest kodowany, aby upewnić się, że nie zgłasza żadnych wyjątków.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-182">It is coded to ensure that it does not throw any exceptions.</span></span> <span data-ttu-id="fd0eb-183">Chociaż nie zawsze jest to absolutnie konieczne, często jest to dobra praktyka.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-183">While this isn't always strictly necessary, it's often a good practice.</span></span> <span data-ttu-id="fd0eb-184">Jeśli którakolwiek z metod delegata zgłasza wyjątek, pozostałych delegatów, które są na wywołanie nie będą wywoływane.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-184">If either of the delegate methods throws an exception, the remaining delegates that are on the invocation won't be invoked.</span></span>

<span data-ttu-id="fd0eb-185">W ostatniej uwadze rejestrator plików musi zarządzać swoimi zasobami, otwierając i zamykając plik w każdej wiadomości dziennika.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-185">As a last note, the file logger must manage its resources by opening and closing the file on each log message.</span></span> <span data-ttu-id="fd0eb-186">Można zachować plik otwarty i zaimplementować IDisposable, aby zamknąć plik po zakończeniu.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-186">You could choose to keep the file open and implement IDisposable to close the file when you are completed.</span></span>
<span data-ttu-id="fd0eb-187">Każda z tych metod ma swoje zalety i wady.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-187">Either method has its advantages and disadvantages.</span></span> <span data-ttu-id="fd0eb-188">Oba utworzyć nieco więcej sprzężenia między klasami.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-188">Both do create a bit more coupling between the classes.</span></span>

<span data-ttu-id="fd0eb-189">Żaden kod w Logger klasy musiałby zostać zaktualizowany w celu obsługi obu scenariuszy.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-189">None of the code in the Logger class would need to be updated in order to support either scenario.</span></span>

## <a name="handling-null-delegates"></a><span data-ttu-id="fd0eb-190">Obsługa delegatów null</span><span class="sxs-lookup"><span data-stu-id="fd0eb-190">Handling Null Delegates</span></span>

<span data-ttu-id="fd0eb-191">Na koniec zaktualizujmy LogMessage metody tak, aby była niezawodna dla tych przypadków, gdy nie jest wybrany mechanizm wyjściowy.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-191">Finally, let's update the LogMessage method so that it is robust for those cases when no output mechanism is selected.</span></span> <span data-ttu-id="fd0eb-192">Bieżąca implementacja `NullReferenceException` spowoduje `WriteMessage` wyświetlenie a, gdy pełnomocnik nie ma listy wywołania dołączone.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-192">The current implementation will throw a `NullReferenceException` when the `WriteMessage` delegate does not have an invocation list attached.</span></span>
<span data-ttu-id="fd0eb-193">Możesz preferować projekt, który po cichu trwa, gdy nie zostały dołączone żadne metody.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-193">You may prefer a design that silently continues when no methods have been attached.</span></span> <span data-ttu-id="fd0eb-194">Jest to łatwe przy użyciu operatora warunkowego null, w połączeniu `Delegate.Invoke()` z metodą:</span><span class="sxs-lookup"><span data-stu-id="fd0eb-194">This is easy using the null conditional operator, combined with the `Delegate.Invoke()` method:</span></span>

```csharp
public static void LogMessage(string msg)
{
    WriteMessage?.Invoke(msg);
}
```

<span data-ttu-id="fd0eb-195">Operator warunkowy`?.`null ( ) zwarcia,`WriteMessage` gdy lewy operand (w tym przypadku) jest null, co oznacza, że nie jest podejmowano próby rejestrowania wiadomości.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-195">The null conditional operator (`?.`) short-circuits when the left operand (`WriteMessage` in this case) is null, which means no attempt is made to log a message.</span></span>

<span data-ttu-id="fd0eb-196">Nie znajdziesz metody wymienionej `Invoke()` w dokumentacji `System.Delegate` dla `System.MulticastDelegate`lub .</span><span class="sxs-lookup"><span data-stu-id="fd0eb-196">You won't find the `Invoke()` method listed in the documentation for `System.Delegate` or `System.MulticastDelegate`.</span></span> <span data-ttu-id="fd0eb-197">Kompilator generuje metodę `Invoke` bezpiecznego typu dla dowolnego zadeklarowanego typu delegata.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-197">The compiler generates a type safe `Invoke` method for any delegate type declared.</span></span> <span data-ttu-id="fd0eb-198">W tym przykładzie `Invoke` oznacza to, że ma pojedynczy `string` argument i ma typ zwracania void.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-198">In this example, that means `Invoke` takes a single `string` argument, and has a void return type.</span></span>

## <a name="summary-of-practices"></a><span data-ttu-id="fd0eb-199">Podsumowanie praktyk</span><span class="sxs-lookup"><span data-stu-id="fd0eb-199">Summary of Practices</span></span>

<span data-ttu-id="fd0eb-200">Widzieliście początki składnika dziennika, który można rozszerzyć o inne moduły zapisujące i inne funkcje.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-200">You've seen the beginnings of a log component that could be expanded with other writers, and other features.</span></span> <span data-ttu-id="fd0eb-201">Za pomocą delegatów w projekcie te różne składniki są bardzo luźno sprzęgo.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-201">By using delegates in the design these different components are very loosely coupled.</span></span> <span data-ttu-id="fd0eb-202">Zapewnia to kilka zalet.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-202">This provides several advantages.</span></span> <span data-ttu-id="fd0eb-203">Bardzo łatwo jest stworzyć nowe mechanizmy wyjściowe i dołączyć je do systemu.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-203">It's very easy to create new output mechanisms and attach them to the system.</span></span> <span data-ttu-id="fd0eb-204">Te inne mechanizmy potrzebują tylko jednej metody: metody, która zapisuje komunikat dziennika.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-204">These other mechanisms only need one method: the method that writes the log message.</span></span> <span data-ttu-id="fd0eb-205">Jest to projekt, który jest bardzo odporny, gdy dodawane są nowe funkcje.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-205">It's a design that is very resilient when new features are added.</span></span> <span data-ttu-id="fd0eb-206">Kontrakt wymagany dla każdego modułu zapisującego jest zaimplementowanie jednej metody.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-206">The contract required for any writer is to implement one method.</span></span> <span data-ttu-id="fd0eb-207">Ta metoda może być metodą statyczną lub instancji.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-207">That method could be a static or instance method.</span></span> <span data-ttu-id="fd0eb-208">Może to być publiczny, prywatny lub inny dostęp prawny.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-208">It could be public, private, or any other legal access.</span></span>

<span data-ttu-id="fd0eb-209">Logger Klasy można wprowadzić dowolną liczbę ulepszeń lub zmian bez wprowadzania wprowadzania zmian.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-209">The Logger class can make any number of enhancements or changes without introducing breaking changes.</span></span> <span data-ttu-id="fd0eb-210">Podobnie jak każda klasa, nie można zmodyfikować publicznego interfejsu API bez ryzyka zerwania zmian.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-210">Like any class, you cannot modify the public API without the risk of breaking changes.</span></span> <span data-ttu-id="fd0eb-211">Ale ponieważ sprzężenie między rejestratora i aparatów wyjściowych jest tylko za pośrednictwem delegata, nie inne typy (jak interfejsy lub klasy podstawowe) są zaangażowane.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-211">But, because the coupling between the logger and any output engines is only through the delegate, no other types (like interfaces or base classes) are involved.</span></span> <span data-ttu-id="fd0eb-212">Sprzęgło jest tak małe, jak to możliwe.</span><span class="sxs-lookup"><span data-stu-id="fd0eb-212">The coupling is as small as possible.</span></span>

[<span data-ttu-id="fd0eb-213">Dalej</span><span class="sxs-lookup"><span data-stu-id="fd0eb-213">Next</span></span>](events-overview.md)
