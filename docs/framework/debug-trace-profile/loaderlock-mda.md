---
title: loaderLock MDA
ms.date: 03/30/2017
helpviewer_keywords:
- deadlocks [.NET Framework]
- LoaderLock MDA
- MDAs (managed debugging assistants), loader locks
- managed debugging assistants (MDAs), loader locks
- operating system loader locks
- loader locks
- locks, threads
ms.assetid: 8c10fa02-1b9c-4be5-ab03-451d943ac1ee
author: mairaw
ms.author: mairaw
ms.openlocfilehash: dbc6cc814d23923f01eceea70bd2fe45b9cbff8a
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 05/04/2018
ms.locfileid: "33388202"
---
# <a name="loaderlock-mda"></a><span data-ttu-id="ccfbd-102">loaderLock MDA</span><span class="sxs-lookup"><span data-stu-id="ccfbd-102">loaderLock MDA</span></span>
<span data-ttu-id="ccfbd-103">`loaderLock` Zarządzany Asystent debugowania (MDA) wykrywa próby wykonania kodu zarządzanego w wątku, który posiada blokady modułu ładującego systemu operacyjnego Microsoft Windows.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-103">The `loaderLock` managed debugging assistant (MDA) detects attempts to execute managed code on a thread that holds the Microsoft Windows operating system loader lock.</span></span>  <span data-ttu-id="ccfbd-104">Takie wykonanie jest niedozwolona, ponieważ może to prowadzić do zakleszczenia i korzystanie z bibliotek DLL, zanim zostały zainicjowane przez modułu ładującego systemu operacyjnego.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-104">Any such execution is illegal because it can lead to deadlocks and to use of DLLs before they have been initialized by the operating system's loader.</span></span>  
  
## <a name="symptoms"></a><span data-ttu-id="ccfbd-105">Symptomy</span><span class="sxs-lookup"><span data-stu-id="ccfbd-105">Symptoms</span></span>  
 <span data-ttu-id="ccfbd-106">Najczęściej błędu podczas wykonywania kodu wewnątrz blokady modułu ładującego systemu operacyjnego jest, że wątki będą zakleszczenie podczas próby wywołania innych funkcji Win32, wymagających blokady modułu ładującego.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-106">The most common failure when executing code inside the operating system's loader lock is that threads will deadlock when attempting to call other Win32 functions that also require the loader lock.</span></span>  <span data-ttu-id="ccfbd-107">Przykłady takich funkcji `LoadLibrary`, `GetProcAddress`, `FreeLibrary`, i `GetModuleHandle`.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-107">Examples of such functions are `LoadLibrary`, `GetProcAddress`, `FreeLibrary`, and `GetModuleHandle`.</span></span>  <span data-ttu-id="ccfbd-108">Aplikacja nie może bezpośrednio wywoływać te funkcje; środowisko uruchomieniowe języka wspólnego (CLR) może wywoływać te funkcje w wyniku wyższy poziom wywołania jak <xref:System.Reflection.Assembly.Load%2A> lub w pierwszym wywołaniu platformy wywołania metody.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-108">The application might not directly call these functions; the common language runtime (CLR) might call these functions as the result of a higher level call like <xref:System.Reflection.Assembly.Load%2A> or the first call to a platform invoke method.</span></span>  
  
 <span data-ttu-id="ccfbd-109">Zakleszczenie może również wystąpić, jeśli wątek oczekuje na inny wątek rozpoczęcia lub zakończenia.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-109">Deadlocks can also occur if a thread is waiting for another thread to start or finish.</span></span>  <span data-ttu-id="ccfbd-110">Gdy wątek rozpoczyna się lub kończy wykonywanie, jego muszą uzyskać blokady modułu ładującego systemu operacyjnego na potrzeby dostarczania zdarzeń do odpowiednich bibliotek DLL.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-110">When a thread starts or finishes executing, it must acquire the operating system's loader lock to deliver events to affected DLLs.</span></span>  
  
 <span data-ttu-id="ccfbd-111">Na koniec istnieją przypadki, w którym mogą wystąpić wywołania do biblioteki dll, zanim te biblioteki DLL została poprawnie zainicjowana przez moduł ładujący systemu operacyjnego.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-111">Finally, there are cases where calls into DLLs can occur before those DLLs have been properly initialized by the operating system's loader.</span></span>  <span data-ttu-id="ccfbd-112">W przeciwieństwie do błędów zakleszczenia, które można zdiagnozować, sprawdzając stosy wątków objętego zakleszczenia, jest bardzo trudne do diagnozowania Użyj niezainicjowanego dll bez użycia tego MDA.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-112">Unlike the deadlock failures, which can be diagnosed by examining the stacks of all the threads involved in the deadlock, it is very difficult to diagnose the use of uninitialized DLLs without using this MDA.</span></span>  
  
## <a name="cause"></a><span data-ttu-id="ccfbd-113">Przyczyna</span><span class="sxs-lookup"><span data-stu-id="ccfbd-113">Cause</span></span>  
 <span data-ttu-id="ccfbd-114">Mieszane zarządzanych/niezarządzanych C++ zestawy przeznaczony dla wersji systemu .NET Framework w wersji 1.0 lub 1.1 zazwyczaj próba wykonania kodu zarządzanego wewnątrz blokady modułu ładującego, chyba że szczególną zostanie podjęta, na przykład łączenie z **/noentry**.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-114">Mixed managed/unmanaged C++ assemblies built for .NET Framework versions 1.0 or 1.1 generally attempt to execute managed code inside the loader lock unless special care has been taken, for example, linking with **/NOENTRY**.</span></span>
  
 <span data-ttu-id="ccfbd-115">Zarządzanych/niezarządzanych C++ zestawów mieszanych skompilowany dla platformy .NET Framework w wersji 2.0 są mniej podatny na te problemy o zmniejszenie ryzyka, podobnie jak aplikacje przy użyciu niezarządzanych bibliotek DLL, które naruszają zasady systemu operacyjnego.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-115">Mixed managed/unmanaged C++ assemblies built for .NET Framework version 2.0 are less susceptible to these problems, having the same reduced risk as applications using unmanaged DLLs that violate the operating system's rules.</span></span>  <span data-ttu-id="ccfbd-116">Na przykład, jeśli niezarządzanej DLL `DllMain` wywołania punktu wejścia `CoCreateInstance` uzyskać zarządzanego obiektu, który został ujawniony dla modelu COM, wynikiem jest próba wykonania kodu zarządzanego wewnątrz blokady modułu ładującego.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-116">For example, if an unmanaged DLL's `DllMain` entry point calls `CoCreateInstance` to obtain a managed object that has been exposed to COM, the result is an attempt to execute managed code inside the loader lock.</span></span> <span data-ttu-id="ccfbd-117">Aby uzyskać więcej informacji dotyczących problemów blokady modułu ładującego w programie .NET Framework w wersji 2.0 lub nowszej, zobacz [inicjowanie zestawów mieszanych](/cpp/dotnet/initialization-of-mixed-assemblies).</span><span class="sxs-lookup"><span data-stu-id="ccfbd-117">For more information about loader lock issues in the .NET Framework version 2.0 and later, see [Initialization of Mixed Assemblies](/cpp/dotnet/initialization-of-mixed-assemblies).</span></span>  
  
## <a name="resolution"></a><span data-ttu-id="ccfbd-118">Rozwiązanie</span><span class="sxs-lookup"><span data-stu-id="ccfbd-118">Resolution</span></span>  
 <span data-ttu-id="ccfbd-119">W programie Visual C++ .NET 2002 i Visual C++ .NET 2003 biblioteki DLL są kompilowane przy użyciu `/clr` — opcja kompilatora można w sposób niejednoznaczny zakleszczenie po załadowaniu; ten problem został wywołany mieszanych problem DLL ładowania lub modułu ładującego blokady.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-119">In Visual C++ .NET 2002 and Visual C++ .NET 2003, DLLs compiled with the `/clr` compiler option could non-deterministically deadlock when loaded; this issue was called the mixed DLL loading or loader lock issue.</span></span> <span data-ttu-id="ccfbd-120">W programie Visual C++ 2005 lub nowszego oraz prawie wszystkie z systemem innym niż determinizm została usunięta z mieszanym proces ładowania biblioteki DLL.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-120">In Visual C++ 2005 and later, almost all non-determinism has been removed from the mixed DLL loading process.</span></span> <span data-ttu-id="ccfbd-121">Istnieje jednak kilka pozostałych scenariusze, dla których moduł ładujący (sposób niejednoznaczny) może wystąpić blokady.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-121">However, there are a few remaining scenarios for which loader lock can (deterministically) occur.</span></span> <span data-ttu-id="ccfbd-122">Aby uzyskać szczegóły konta z przyczynami i rozwiązaniami w przypadku pozostałych problemów blokady modułu ładującego, zobacz [inicjowanie zestawów mieszanych](/cpp/dotnet/initialization-of-mixed-assemblies).</span><span class="sxs-lookup"><span data-stu-id="ccfbd-122">For a detailed account of the causes and resolutions for the remaining loader lock issues, see [Initialization of Mixed Assemblies](/cpp/dotnet/initialization-of-mixed-assemblies).</span></span> <span data-ttu-id="ccfbd-123">Ten temat nie wskazuje na problem blokady modułu ładującego, należy zbadać stosu wątku w celu ustalenia, dlaczego występuje blokady modułu ładującego i sposobu rozwiązania problemu.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-123">If that topic does not identify your loader lock problem, you have to examine the thread's stack to determine why the loader lock is occurring and how to correct the problem.</span></span> <span data-ttu-id="ccfbd-124">Sprawdź ślad stosu wątku, który został aktywowany to zdarzenie MDA.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-124">Look at the stack trace for the thread that has activated this MDA.</span></span>  <span data-ttu-id="ccfbd-125">Wątek próbuje nielegalnego wywołania wewnątrz kodu zarządzanego podczas utrzymywania blokady modułu ładującego systemu operacyjnego.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-125">The thread is attempting to illegally call into managed code while holding the operating system's loader lock.</span></span>  <span data-ttu-id="ccfbd-126">Prawdopodobnie zobaczysz bibliotekę DLL `DllMain` lub równoważne wpisu punktu na stosie.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-126">You will probably see a DLL's `DllMain` or equivalent entry point on the stack.</span></span>  <span data-ttu-id="ccfbd-127">Zasady systemu operacyjnego legalnie jak z wewnątrz punkt wejścia są bardzo ograniczone.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-127">The operating system's rules for what you can legally do from inside such an entry point are quite limited.</span></span>  <span data-ttu-id="ccfbd-128">Te zasady uniemożliwiają wszelkie wykonania kodu zarządzanego.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-128">These rules preclude any managed execution.</span></span>  
  
## <a name="effect-on-the-runtime"></a><span data-ttu-id="ccfbd-129">Wpływ na środowisko uruchomieniowe</span><span class="sxs-lookup"><span data-stu-id="ccfbd-129">Effect on the Runtime</span></span>  
 <span data-ttu-id="ccfbd-130">Zazwyczaj kilka wątków wewnątrz procesu zostanie zakleszczenie.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-130">Typically, several threads inside the process will deadlock.</span></span>  <span data-ttu-id="ccfbd-131">Jeden z tych wątków prawdopodobnie będzie odpowiedzialny za wykonywanie wyrzucania elementów bezużytecznych, więc tego zakleszczenia może mieć istotny wpływ na cały proces wątku.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-131">One of those threads is likely to be a thread responsible for performing a garbage collection, so this deadlock can have a major impact on the entire process.</span></span>  <span data-ttu-id="ccfbd-132">Ponadto uniemożliwi dodatkowe operacje, które wymagają blokady modułu ładującego systemu operacyjnego, takich jak ładowanie i zwalnianie zestawów lub biblioteki dll i uruchamianie lub zatrzymywanie wątków.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-132">Furthermore, it will prevent any additional operations that require the operating system's loader lock, like loading and unloading assemblies or DLLs and starting or stopping threads.</span></span>  
  
 <span data-ttu-id="ccfbd-133">W niektórych przypadkach nietypowe istnieje również możliwość naruszenia zasad dostępu lub podobnych problemów w bibliotek DLL, które są nazywane przed zostały zainicjowane.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-133">In some unusual cases, it is also possible for access violations or similar problems to be triggered in DLLs which are called before they have been initialized.</span></span>  
  
## <a name="output"></a><span data-ttu-id="ccfbd-134">Dane wyjściowe</span><span class="sxs-lookup"><span data-stu-id="ccfbd-134">Output</span></span>  
 <span data-ttu-id="ccfbd-135">To zdarzenie MDA zgłasza, że niedozwolony zarządzanego wykonania podjęto próbę.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-135">This MDA reports that an illegal managed execution is being attempted.</span></span>  <span data-ttu-id="ccfbd-136">Należy zbadać stosu wątku w celu ustalenia, dlaczego występuje blokady modułu ładującego i sposobu rozwiązania problemu.</span><span class="sxs-lookup"><span data-stu-id="ccfbd-136">You need to examine the thread's stack to determine why the loader lock is occurring and how to correct the problem.</span></span>  
  
## <a name="configuration"></a><span data-ttu-id="ccfbd-137">Konfiguracja</span><span class="sxs-lookup"><span data-stu-id="ccfbd-137">Configuration</span></span>  
  
```xml  
<mdaConfig>  
  <assistants>  
    <loaderLock/>  
  </assistants>  
</mdaConfig>  
```  
  
## <a name="see-also"></a><span data-ttu-id="ccfbd-138">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="ccfbd-138">See Also</span></span>  
 [<span data-ttu-id="ccfbd-139">Diagnozowanie błędów przy użyciu asystentów zarządzanego debugowania</span><span class="sxs-lookup"><span data-stu-id="ccfbd-139">Diagnosing Errors with Managed Debugging Assistants</span></span>](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)
