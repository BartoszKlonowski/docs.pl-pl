---
title: Zmiany w uwierzytelnianiu NTLM dla HttpWebRequest w wersji 3.5 z dodatkiem SP1
ms.date: 03/30/2017
ms.assetid: 8bf0b428-5a21-4299-8d6e-bf8251fd978a
ms.openlocfilehash: 40e041f17a07e17aad3d5f10f7920b0466e2b1b0
ms.sourcegitcommit: 6b308cf6d627d78ee36dbbae8972a310ac7fd6c8
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 01/23/2019
ms.locfileid: "54589561"
---
# <a name="changes-to-ntlm-authentication-for-httpwebrequest-in-version-35-sp1"></a><span data-ttu-id="06f83-102">Zmiany w uwierzytelnianiu NTLM dla HttpWebRequest w wersji 3.5 z dodatkiem SP1</span><span class="sxs-lookup"><span data-stu-id="06f83-102">Changes to NTLM authentication for HttpWebRequest in Version 3.5 SP1</span></span>
<span data-ttu-id="06f83-103">Zmiany zabezpieczeń zostały wprowadzone w .NET Framework w wersji 3.5 z dodatkiem SP1 i później, wpływają na Windows jak zintegrowane uwierzytelnianie jest obsługiwane przez <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Security.NegotiateStream>, i pokrewne klasy w przestrzeni nazw System.Net.</span><span class="sxs-lookup"><span data-stu-id="06f83-103">Security changes were made in .NET Framework version 3.5 SP1 and later that affect how integrated Windows authentication is handled by the <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Security.NegotiateStream>, and related classes in the System.Net namespace.</span></span> <span data-ttu-id="06f83-104">Te zmiany mogą mieć wpływ na aplikacje, które używają tych klas do żądań sieci web i odbierania odpowiedzi, gdy jest używane zintegrowane uwierzytelnianie Windows oparte na NTLM.</span><span class="sxs-lookup"><span data-stu-id="06f83-104">These changes can affect applications that use these classes to make web requests and receive responses where integrated Windows authentication based on NTLM is used.</span></span> <span data-ttu-id="06f83-105">Ta zmiana może wpłynąć na serwerach sieci web i aplikacji klienckich, które są skonfigurowane do korzystania ze zintegrowanego uwierzytelniania Windows.</span><span class="sxs-lookup"><span data-stu-id="06f83-105">This change can impact web servers and client applications that are configured to use integrated Windows authentication.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="06f83-106">Omówienie</span><span class="sxs-lookup"><span data-stu-id="06f83-106">Overview</span></span>  
 <span data-ttu-id="06f83-107">Projekt zintegrowane uwierzytelnianie Windows umożliwia pewne odpowiedzi poświadczeń jako uniwersalny, co oznacza, mogą być ponownie używane lub przesyłane dalej.</span><span class="sxs-lookup"><span data-stu-id="06f83-107">The design of integrated Windows authentication allows for some credential responses to be universal, meaning they can be re-used or forwarded.</span></span> <span data-ttu-id="06f83-108">Jeśli ta funkcja konkretnego projektu nie jest wymagana, protokoły uwierzytelniania powinien mieć docelowy szczegółowe informacje, a także informacje określonego kanału.</span><span class="sxs-lookup"><span data-stu-id="06f83-108">If this particular design feature is not needed, then the authentication protocols should carry target specific information as well as channel specific information.</span></span> <span data-ttu-id="06f83-109">Usługi mogą udzielić im ochrona rozszerzona, aby upewnić się, że poświadczenie odpowiedzi zawiera usługi szczegółowe informacje, takie jak nazwy głównej nazwy usługi (SPN).</span><span class="sxs-lookup"><span data-stu-id="06f83-109">Services can then provide extended protection to ensure that credential responses contain service specific information such as a Service Principal Name (SPN).</span></span> <span data-ttu-id="06f83-110">Dzięki tym informacjom wymianę poświadczeń usługi mają możliwość zapewnienia lepszej ochrony przed złośliwym korzystaniem z odpowiedzi na poświadczenie, które może być nieprawidłowo uzyskany.</span><span class="sxs-lookup"><span data-stu-id="06f83-110">With this information in the credential exchanges, services are able to better protect against malicious use of credential responses that might have been improperly obtained.</span></span>  
  
 <span data-ttu-id="06f83-111">Wiele składników w <xref:System.Net> i <xref:System.Net.Security> przestrzenie nazw wykonać zintegrowane uwierzytelnianie Windows w imieniu aplikacji wywołującej.</span><span class="sxs-lookup"><span data-stu-id="06f83-111">Multiple components in the <xref:System.Net> and <xref:System.Net.Security> namespaces perform integrated Windows authentication on behalf of a calling application.</span></span> <span data-ttu-id="06f83-112">W tej sekcji opisano zmiany w przestrzeni nazw System.Net składników można dodawać ochronę rozszerzoną ich używane zintegrowane uwierzytelnianie Windows.</span><span class="sxs-lookup"><span data-stu-id="06f83-112">This section describes changes to System.Net components to add extended protection in their use of integrated Windows authentication.</span></span>  
  
## <a name="changes"></a><span data-ttu-id="06f83-113">Zmiany</span><span class="sxs-lookup"><span data-stu-id="06f83-113">Changes</span></span>  
 <span data-ttu-id="06f83-114">Proces uwierzytelniania NTLM, które są używane z uwierzytelnianiem zintegrowanym Windows zawiera żądanie wystawiony przez komputer docelowy i wysyłane z powrotem do komputera klienckiego.</span><span class="sxs-lookup"><span data-stu-id="06f83-114">The NTLM authentication process used with integrated Windows authentication includes a challenge issued by the destination computer and sent back to the client computer.</span></span> <span data-ttu-id="06f83-115">Gdy komputer otrzyma wezwanie on sam wygenerowany, uwierzytelnianie zakończy się niepowodzeniem, chyba że połączenie jest pętlą Wstecz (adres IPv4 127.0.0.1, na przykład).</span><span class="sxs-lookup"><span data-stu-id="06f83-115">When a computer receives a challenge it generated itself, the authentication will fail unless the connection is a loop back connection (IPv4 address 127.0.0.1, for example).</span></span>  
  
 <span data-ttu-id="06f83-116">Podczas uzyskiwania dostępu do usługi uruchomionej na wewnętrznym serwerze sieci Web, są często uzyskać dostępu do usługi przy użyciu adresu URL, które są podobne do `http://contoso/service` lub `https://contoso/service`.</span><span class="sxs-lookup"><span data-stu-id="06f83-116">When accessing a service running on an internal Web server, it is common to access the service using a URL similar to `http://contoso/service` or `https://contoso/service`.</span></span> <span data-ttu-id="06f83-117">Nazwy "contoso" nie jest często nazwę komputera komputera, na którym została wdrożona usługa.</span><span class="sxs-lookup"><span data-stu-id="06f83-117">The name "contoso" is often not the computer name of the computer on which the service is deployed.</span></span> <span data-ttu-id="06f83-118"><xref:System.Net> Pokrewne obszary nazw obsługi za pomocą protokołu NetBIOS usługi Active Directory, DNS, hosty komputera lokalnego pliku (zazwyczaj WINDOWS\system32\drivers\etc\hosts, na przykład) lub lmhosts komputera lokalnego pliku (zazwyczaj WINDOWS\system32\ drivers\etc\lmhosts, na przykład) do rozpoznawania nazw na adresy.</span><span class="sxs-lookup"><span data-stu-id="06f83-118">The <xref:System.Net> and related namespaces support using Active Directory, DNS, NetBIOS, the local computer's hosts file (typically WINDOWS\system32\drivers\etc\hosts, for example), or the local computer's lmhosts file (typically WINDOWS\system32\drivers\etc\lmhosts, for example) to resolve names to addresses.</span></span> <span data-ttu-id="06f83-119">Nazwy "contoso" zostanie rozwiązany, tak aby żądania wysyłane na "contoso" są wysyłane do odpowiedniego serwera.</span><span class="sxs-lookup"><span data-stu-id="06f83-119">The name "contoso" is resolved so that requests sent to "contoso" are sent to the appropriate server computer.</span></span>  
  
 <span data-ttu-id="06f83-120">W przypadku skonfigurowania w przypadku dużych wdrożeń, jest również typowe dla nazwy pojedynczego serwera wirtualnego, należy podać do wdrożenia z podstawowej nazwy maszyn nigdy używane przez aplikacje klienckie i użytkowników końcowych.</span><span class="sxs-lookup"><span data-stu-id="06f83-120">When configured for large deployments, it is also common for a single virtual server name to be given to the deployment with the underlying machine names never used by client applications and end users.</span></span> <span data-ttu-id="06f83-121">Na przykład może wywołać serwera `www.contoso.com`, ale w wewnętrznej sieci po prostu użyć "contoso".</span><span class="sxs-lookup"><span data-stu-id="06f83-121">For example, you might call the server `www.contoso.com`, but on an internal network simply use "contoso".</span></span> <span data-ttu-id="06f83-122">Ta nazwa nosi nazwę nagłówka hosta w żądaniu klienta sieci web.</span><span class="sxs-lookup"><span data-stu-id="06f83-122">This name is called the Host header in the client web request.</span></span> <span data-ttu-id="06f83-123">Określone przez protokół HTTP pole Host w nagłówku żądania określa Internetu hosta i portu numer żądanych zasobów.</span><span class="sxs-lookup"><span data-stu-id="06f83-123">As specified by the HTTP protocol, the Host request-header field specifies the Internet host and port number of the resource being requested.</span></span> <span data-ttu-id="06f83-124">Te informacje są uzyskiwane z oryginalnego identyfikatora URI, podane przez użytkownika lub odwołuje się do innych zasobów (zwykle adres HTTP URL).</span><span class="sxs-lookup"><span data-stu-id="06f83-124">This information is obtained from the original URI given by the user or referring resource (generally an HTTP URL).</span></span> <span data-ttu-id="06f83-125">W programie .NET Framework w wersji 4, te informacje można również ustawić przez klienta za pomocą nowego <xref:System.Net.HttpWebRequest.Host%2A> właściwości.</span><span class="sxs-lookup"><span data-stu-id="06f83-125">On .NET Framework version 4, this information can also be set by the client using the new <xref:System.Net.HttpWebRequest.Host%2A> property.</span></span>  
  
 <span data-ttu-id="06f83-126"><xref:System.Net.AuthenticationManager> Klasy kontrolki składników zarządzanych uwierzytelniania ("moduły"), które są używane przez <xref:System.Net.WebRequest> klas pochodnych i <xref:System.Net.WebClient> klasy.</span><span class="sxs-lookup"><span data-stu-id="06f83-126">The <xref:System.Net.AuthenticationManager> class controls the managed authentication components ("modules") that are used by <xref:System.Net.WebRequest> derivative classes and the <xref:System.Net.WebClient> class.</span></span> <span data-ttu-id="06f83-127"><xref:System.Net.AuthenticationManager> Klasy zawiera właściwości, która udostępnia <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType> obiektu indeksowane przez ciąg identyfikatora URI, dla aplikacji, aby podać niestandardowy ciąg nazwy SPN, który ma być używany podczas uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="06f83-127">The <xref:System.Net.AuthenticationManager> class provides a property that exposes a <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType> object, indexed by URI string, for applications to supply a custom SPN string to be used during authentication.</span></span>  
  
 <span data-ttu-id="06f83-128">W wersji 3.5 z dodatkiem SP1, teraz używane wartości domyślne do określania nazwy hosta w adresie URL żądania w głównej nazwy usługi w uwierzytelnianiu NTLM (NT LAN Manager) programu exchange, kiedy <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> nie ustawiono właściwości.</span><span class="sxs-lookup"><span data-stu-id="06f83-128">Version 3.5 SP1 now defaults to specifying the host name used in the request URL in the SPN in the NTLM (NT LAN Manager) authentication exchange when the <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> property is not set.</span></span> <span data-ttu-id="06f83-129">Nazwa hosta używana w adresie URL żądania może różnić się od nagłówka hosta określona w <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType> w żądaniu klienta.</span><span class="sxs-lookup"><span data-stu-id="06f83-129">The host name used in the request URL may be different from the Host header specified in the <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType> in the client request.</span></span> <span data-ttu-id="06f83-130">Nazwa hosta używana w adresie URL żądania może różnić się od aktualną nazwą hosta serwera, nazwę komputera serwera, adres IP tego komputera lub adres sprzężenia zwrotnego.</span><span class="sxs-lookup"><span data-stu-id="06f83-130">The host name used in the request URL may be different from the actual host name of the server, the machine name of the server, the computer's IP address, or the loopback address.</span></span> <span data-ttu-id="06f83-131">W takich przypadkach Windows zakończy się niepowodzeniem żądania uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="06f83-131">In these cases, Windows will fail the authentication request.</span></span> <span data-ttu-id="06f83-132">Aby rozwiązać ten problem, musimy powiadomić Windows, nazwa hosta używana w adresie URL żądania w kliencie żądania ("contoso", na przykład) jest faktycznie alternatywną nazwę komputera lokalnego.</span><span class="sxs-lookup"><span data-stu-id="06f83-132">To address the issue, we need to notify Windows that the host name used in the request URL in the client request ("contoso", for example) is actually an alternate name for the local computer.</span></span>  
  
 <span data-ttu-id="06f83-133">Istnieje kilka możliwych metod dla aplikacji serwera obejść tę zmianę.</span><span class="sxs-lookup"><span data-stu-id="06f83-133">There are several possible methods for a server application to work around this change.</span></span> <span data-ttu-id="06f83-134">Zalecanym podejściem jest mapowanie nazwy hosta, używany w adresie URL żądania, aby `BackConnectionHostNames` klucza w rejestrze na serwerze.</span><span class="sxs-lookup"><span data-stu-id="06f83-134">The recommended approach is to map the host name used in the request URL to the `BackConnectionHostNames` key in the registry on the server.</span></span> <span data-ttu-id="06f83-135">`BackConnectionHostNames` Klucz rejestru zwykle są używane do mapowania nazwy hosta na adres sprzężenia zwrotnego.</span><span class="sxs-lookup"><span data-stu-id="06f83-135">The `BackConnectionHostNames` registry key is normally used to map a host name to a loopback address.</span></span> <span data-ttu-id="06f83-136">Poniżej przedstawiono kroki.</span><span class="sxs-lookup"><span data-stu-id="06f83-136">The steps are listed below.</span></span>  
  
 <span data-ttu-id="06f83-137">Aby określić nazwy hostów, które są mapowane na adres sprzężenia zwrotnego i można połączyć się z witryny sieci Web na komputerze lokalnym, wykonaj następujące kroki:</span><span class="sxs-lookup"><span data-stu-id="06f83-137">To specify the host names that are mapped to the loopback address and can connect to Web sites on a local computer, follow these steps:</span></span>  
  
 1. <span data-ttu-id="06f83-138">Kliknij przycisk Start, kliknij przycisk Uruchom, wpisz wyrażenie regedit i kliknij przycisk OK.</span><span class="sxs-lookup"><span data-stu-id="06f83-138">Click Start, click Run, type regedit, and then click OK.</span></span>  
  
 2. <span data-ttu-id="06f83-139">W Edytorze rejestru Znajdź, a następnie kliknij przycisk następujący klucz rejestru:</span><span class="sxs-lookup"><span data-stu-id="06f83-139">In Registry Editor, locate and then click the following registry key:</span></span>  
  
 `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0`  
  
 3. <span data-ttu-id="06f83-140">Kliknij prawym przyciskiem myszy MSV1_0, wskaż polecenie Nowy, a następnie kliknij wartość ciągu wielokrotnego.</span><span class="sxs-lookup"><span data-stu-id="06f83-140">Right-click MSV1_0, point to New, and then click Multi-String Value.</span></span>  
  
 4. <span data-ttu-id="06f83-141">Typ `BackConnectionHostNames`, a następnie naciśnij klawisz ENTER.</span><span class="sxs-lookup"><span data-stu-id="06f83-141">Type `BackConnectionHostNames`, and then press ENTER.</span></span>  
  
 5. <span data-ttu-id="06f83-142">Kliknij prawym przyciskiem myszy `BackConnectionHostNames`, a następnie kliknij polecenie Modyfikuj.</span><span class="sxs-lookup"><span data-stu-id="06f83-142">Right-click `BackConnectionHostNames`, and then click Modify.</span></span>  
  
 6. <span data-ttu-id="06f83-143">W polu dane wartości wpisz nazwę hosta lub nazwy hostów dla witryny (nazwa hosta używany w adresie URL żądania), które znajdują się na komputerze lokalnym, a następnie kliknij przycisk OK.</span><span class="sxs-lookup"><span data-stu-id="06f83-143">In the Value data box, type the host name or the host names for the sites (the host name used in the request URL) that are on the local computer, and then click OK.</span></span>  
  
 7. <span data-ttu-id="06f83-144">Zamknij Edytor rejestru, a następnie ponownie uruchom usługę IISAdmin i uruchom polecenie IISReset.</span><span class="sxs-lookup"><span data-stu-id="06f83-144">Quit Registry Editor, and then restart the IISAdmin service and run IISReset.</span></span>  
  
 <span data-ttu-id="06f83-145">Mniej bezpieczna opcja pracy około jest wyłączenie sprawdzania wstecz pętli, zgodnie z opisem w <https://support.microsoft.com/kb/896861>.</span><span class="sxs-lookup"><span data-stu-id="06f83-145">A less secure work around is to disable the loop back check, as described in <https://support.microsoft.com/kb/896861>.</span></span> <span data-ttu-id="06f83-146">Powoduje to wyłączenie ochrony przed atakami odbicia.</span><span class="sxs-lookup"><span data-stu-id="06f83-146">This disables the protection against reflection attacks.</span></span> <span data-ttu-id="06f83-147">Dlatego lepiej jest ograniczyć zestaw alternatywnych nazw tylko te, które oczekują maszynę aby rzeczywiście używane.</span><span class="sxs-lookup"><span data-stu-id="06f83-147">So it is better to constrain the set of alternate names to only those you expect the machine to actually use.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="06f83-148">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="06f83-148">See also</span></span>
- <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType>
- <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType>
- <xref:System.Net.HttpWebRequest.Host%2A?displayProperty=nameWithType>
