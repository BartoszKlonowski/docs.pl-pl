---
title: Organizowanie międzyoperacyjne
ms.date: 03/30/2017
helpviewer_keywords:
- marshaling, COM interop
- interop marshaling
- interop marshaling, about interop marshaling
ms.assetid: 115f7a2f-d422-4605-ab36-13a8dd28142a
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 3d6ddc2978078fd307ad79cffe14d53619d8be9e
ms.sourcegitcommit: 56ac30a336668124cb7d95d8ace16bd985875147
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 05/09/2019
ms.locfileid: "65469715"
---
# <a name="interop-marshaling"></a><span data-ttu-id="bd5ec-102">Organizowanie międzyoperacyjne</span><span class="sxs-lookup"><span data-stu-id="bd5ec-102">Interop Marshaling</span></span>
<a name="top"></a> <span data-ttu-id="bd5ec-103">Marshaling międzyoperacyjny decyduje o tym, jak dane są przekazywane w metodzie argumentów i zwracanych wartości między zarządzanymi i niezarządzanymi pamięci podczas wywołania.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-103">Interop marshaling governs how data is passed in method arguments and return values between managed and unmanaged memory during calls.</span></span> <span data-ttu-id="bd5ec-104">Marshaling międzyoperacyjny jest czynnością środowiska wykonawczego, wykonywane przez usługę organizowania wykonywalnych języka wspólnego.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-104">Interop marshaling is a run-time activity performed by the common language runtime's marshaling service.</span></span>  
  
 <span data-ttu-id="bd5ec-105">Większość typów danych mają wspólne reprezentacji w pamięci zarządzanych i niezarządzanych.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-105">Most data types have common representations in both managed and unmanaged memory.</span></span> <span data-ttu-id="bd5ec-106">Organizator międzyoperacyjny obsługuje następujące typy dla Ciebie.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-106">The interop marshaler handles these types for you.</span></span> <span data-ttu-id="bd5ec-107">Inne typy może być niejednoznaczne lub nie jest reprezentowana w ogóle w pamięci zarządzanej.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-107">Other types can be ambiguous or not represented at all in managed memory.</span></span>  
  
 <span data-ttu-id="bd5ec-108">Niejednoznaczny typ może mieć wiele reprezentacji niezarządzanych, mapowane na jeden typ zarządzany, albo brakuje informacji o typie, takich jak rozmiar tablicy.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-108">An ambiguous type can have either multiple unmanaged representations that map to a single managed type, or missing type information, such as the size of an array.</span></span> <span data-ttu-id="bd5ec-109">Niejednoznacznych typów Organizator zawiera reprezentację domyślne i Reprezentacje alternatywne, w których istnieje wiele reprezentacji.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-109">For ambiguous types, the marshaler provides a default representation and alternative representations where multiple representations exist.</span></span> <span data-ttu-id="bd5ec-110">Możesz podać jawne instrukcje można organizatora, w jaki jest do organizowania niejednoznaczny typ.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-110">You can supply explicit instructions to the marshaler on how it is to marshal an ambiguous type.</span></span>  
  
 <span data-ttu-id="bd5ec-111">Ten przegląd zawiera następujące sekcje:</span><span class="sxs-lookup"><span data-stu-id="bd5ec-111">This overview contains the following sections:</span></span>  
  
- [<span data-ttu-id="bd5ec-112">Wywołanie platformy i modele międzyoperacyjnego modelu COM</span><span class="sxs-lookup"><span data-stu-id="bd5ec-112">Platform Invoke and COM Interop Models</span></span>](#platform_invoke_and_com_interop_models)  
  
- [<span data-ttu-id="bd5ec-113">Marshaling i Apartamentach COM</span><span class="sxs-lookup"><span data-stu-id="bd5ec-113">Marshaling and COM Apartments</span></span>](#marshaling_and_com_apartments)  
  
- [<span data-ttu-id="bd5ec-114">Kierowanie wywołań zdalnych</span><span class="sxs-lookup"><span data-stu-id="bd5ec-114">Marshaling Remote Calls</span></span>](#marshaling_remote_calls)  
  
- [<span data-ttu-id="bd5ec-115">Tematy pokrewne</span><span class="sxs-lookup"><span data-stu-id="bd5ec-115">Related Topics</span></span>](#related_topics)  
  
- [<span data-ttu-id="bd5ec-116">Dokumentacja</span><span class="sxs-lookup"><span data-stu-id="bd5ec-116">Reference</span></span>](#reference)  
  
<a name="platform_invoke_and_com_interop_models"></a>   
## <a name="platform-invoke-and-com-interop-models"></a><span data-ttu-id="bd5ec-117">Wywołanie platformy i modele międzyoperacyjnego modelu COM</span><span class="sxs-lookup"><span data-stu-id="bd5ec-117">Platform Invoke and COM Interop Models</span></span>  
 <span data-ttu-id="bd5ec-118">Środowisko uruchomieniowe języka wspólnego zawiera dwa mechanizmy współdziałanie z kodem niezarządzanym:</span><span class="sxs-lookup"><span data-stu-id="bd5ec-118">The common language runtime provides two mechanisms for interoperating with unmanaged code:</span></span>  
  
- <span data-ttu-id="bd5ec-119">Wywołanie platformy, które umożliwia kodowi zarządzanemu wywoływania funkcji wyeksportowanych z biblioteką niezarządzaną.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-119">Platform invoke, which enables managed code to call functions exported from an unmanaged library.</span></span>  
  
- <span data-ttu-id="bd5ec-120">Usługa międzyoperacyjna modelu COM, który umożliwia interakcję z obiektami Component Object Model (COM) za pośrednictwem interfejsów kodu zarządzanego.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-120">COM interop, which enables managed code to interact with Component Object Model (COM) objects through interfaces.</span></span>  
  
 <span data-ttu-id="bd5ec-121">Wywołanie obie platformy i COM międzyoperacyjny Użyj marshaling międzyoperacyjny dokładnie przenoszenie argumenty metody między obiekt wywołujący i obiekt wywoływany i z powrotem, jeśli wymagane.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-121">Both platform invoke and COM interop use interop marshaling to accurately move method arguments between caller and callee and back, if required.</span></span> <span data-ttu-id="bd5ec-122">Jak pokazano na poniższej ilustracji, wywołania platformy przepływy wywołanie metody z kodu zarządzanego do kodu niezarządzanego i nigdy nie inny sposób, chyba że [funkcji wywołania zwrotnego](callback-functions.md) są zaangażowani.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-122">As the following illustration shows, a platform invoke method call flows from managed to unmanaged code and never the other way, except when [callback functions](callback-functions.md) are involved.</span></span> <span data-ttu-id="bd5ec-123">Mimo że wywołanie platformy wywołania mogą przepływać tylko z kodu zarządzanego do kodu niezarządzanego, dane mogą przepływać w obu kierunkach, jako parametry wejściowe i wyjściowe.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-123">Even though platform invoke calls can flow only from managed to unmanaged code, data can flow in both directions as input or output parameters.</span></span> <span data-ttu-id="bd5ec-124">Wywołań metod międzyoperacyjnego modelu COM może przepływać w obu kierunkach.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-124">COM interop method calls can flow in either direction.</span></span>  
  
 <span data-ttu-id="bd5ec-125">![Wywołanie platformy](./media/interop-marshaling/interop-marshaling-invoke-and-com.png "wywołania platformy i wywołania międzyoperacyjnego modelu COM przepływu")</span><span class="sxs-lookup"><span data-stu-id="bd5ec-125">![Platform invoke](./media/interop-marshaling/interop-marshaling-invoke-and-com.png "Platform invoke and COM interop call flow")</span></span>  
  
 <span data-ttu-id="bd5ec-126">Na najniższym poziomie zarówno mechanizmów używać tego samego międzyoperacyjnego organizowanie usług. Jednak niektóre typy danych są obsługiwane wyłącznie przez COM interop lub wywołania platformy.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-126">At the lowest level, both mechanisms use the same interop marshaling service; however, certain data types are supported exclusively by COM interop or platform invoke.</span></span> <span data-ttu-id="bd5ec-127">Aby uzyskać więcej informacji, zobacz [domyślne zachowanie Marshalingu](default-marshaling-behavior.md).</span><span class="sxs-lookup"><span data-stu-id="bd5ec-127">For details, see [Default Marshaling Behavior](default-marshaling-behavior.md).</span></span>  
  
 [<span data-ttu-id="bd5ec-128">Powrót do początku</span><span class="sxs-lookup"><span data-stu-id="bd5ec-128">Back to top</span></span>](#top)  
  
<a name="marshaling_and_com_apartments"></a>   
## <a name="marshaling-and-com-apartments"></a><span data-ttu-id="bd5ec-129">Marshaling i Apartamentach COM</span><span class="sxs-lookup"><span data-stu-id="bd5ec-129">Marshaling and COM Apartments</span></span>  
 <span data-ttu-id="bd5ec-130">Organizator międzyoperacyjny kieruje dane między stosie uruchomieniowym wspólnego języka i niezarządzanym stosu.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-130">The interop marshaler marshals data between the common language runtime heap and the unmanaged heap.</span></span> <span data-ttu-id="bd5ec-131">Marshaling występuje zawsze, gdy obiektami wywołującym i wywoływanym nie może działać na tym samym wystąpieniu danych.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-131">Marshaling occurs whenever the caller and callee cannot operate on the same instance of data.</span></span> <span data-ttu-id="bd5ec-132">Organizator międzyoperacyjny umożliwia obiektami wywołującym i wywoływanym były widoczne dla działających na tych samych danych, nawet jeśli mają własne kopię danych.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-132">The interop marshaler makes it possible for the caller and callee to appear to be operating on the same data even if they have their own copy of the data.</span></span>  
  
 <span data-ttu-id="bd5ec-133">COM ma również organizatora, który kieruje dane między apartamentach COM lub różnych procesów COM.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-133">COM also has a marshaler that marshals data between COM apartments or different COM processes.</span></span> <span data-ttu-id="bd5ec-134">Przy wywoływaniu między kodem zarządzanym i niezarządzanym w obrębie tego samego apartamentu COM, organizator międzyoperacyjny jest tylko organizatora zaangażowane.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-134">When calling between managed and unmanaged code within the same COM apartment, the interop marshaler is the only marshaler involved.</span></span> <span data-ttu-id="bd5ec-135">Przy wywoływaniu między kodem zarządzanym i kodu niezarządzanego w różnych apartamentu COM lub innego procesu, organizator międzyoperacyjny i Organizator modelu COM są zaangażowane.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-135">When calling between managed code and unmanaged code in a different COM apartment or a different process, both the interop marshaler and the COM marshaler are involved.</span></span>  
  
### <a name="com-clients-and-managed-servers"></a><span data-ttu-id="bd5ec-136">Klienci COM i serwerów zarządzanych</span><span class="sxs-lookup"><span data-stu-id="bd5ec-136">COM Clients and Managed Servers</span></span>  
 <span data-ttu-id="bd5ec-137">Wyeksportowane serwera zarządzanego z biblioteki typów są rejestrowane przez [Regasm.exe (narzędzie rejestracji zestawów)](../tools/regasm-exe-assembly-registration-tool.md) ma `ThreadingModel` wpis rejestru równa `Both`.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-137">An exported managed server with a type library registered by the [Regasm.exe (Assembly Registration Tool)](../tools/regasm-exe-assembly-registration-tool.md) has a `ThreadingModel` registry entry set to `Both`.</span></span> <span data-ttu-id="bd5ec-138">Ta wartość wskazuje, że serwer można aktywować apartamentem jednowątkowym (przedziale STA) lub wielowątkowe apartamentu (MTA).</span><span class="sxs-lookup"><span data-stu-id="bd5ec-138">This value indicates that the server can be activated in a single-threaded apartment (STA) or a multithreaded apartment (MTA).</span></span> <span data-ttu-id="bd5ec-139">Obiekt serwera jest tworzony w tej samej apartamentu jako obiektu wywołującego, jak pokazano w poniższej tabeli.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-139">The server object is created in the same apartment as its caller, as shown in the following table.</span></span>  
  
|<span data-ttu-id="bd5ec-140">Klient modelu COM</span><span class="sxs-lookup"><span data-stu-id="bd5ec-140">COM client</span></span>|<span data-ttu-id="bd5ec-141">Serwer .NET</span><span class="sxs-lookup"><span data-stu-id="bd5ec-141">.NET server</span></span>|<span data-ttu-id="bd5ec-142">Charakteryzuje się wymaganiami</span><span class="sxs-lookup"><span data-stu-id="bd5ec-142">Marshaling requirements</span></span>|  
|----------------|-----------------|-----------------------------|  
|<span data-ttu-id="bd5ec-143">STA</span><span class="sxs-lookup"><span data-stu-id="bd5ec-143">STA</span></span>|<span data-ttu-id="bd5ec-144">`Both` becomes STA.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-144">`Both` becomes STA.</span></span>|<span data-ttu-id="bd5ec-145">Marshaling tego samego typu apartment.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-145">Same-apartment marshaling.</span></span>|  
|<span data-ttu-id="bd5ec-146">MTA</span><span class="sxs-lookup"><span data-stu-id="bd5ec-146">MTA</span></span>|<span data-ttu-id="bd5ec-147">`Both` becomes MTA.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-147">`Both` becomes MTA.</span></span>|<span data-ttu-id="bd5ec-148">Marshaling tego samego typu apartment.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-148">Same-apartment marshaling.</span></span>|  
  
 <span data-ttu-id="bd5ec-149">Ponieważ klient i serwer znajdują się w tej samej typu apartment, interop marshaling usługi automatycznie obsługuje marshaling wszystkich danych.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-149">Because the client and server are in the same apartment, the interop marshaling service automatically handles all data marshaling.</span></span> <span data-ttu-id="bd5ec-150">Poniższa ilustracja przedstawia międzyoperacyjny usługi organizowania działające między zarządzanymi i niezarządzanymi stosów w ramach tego samego typu apartment styl modelu COM.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-150">The following illustration shows the interop marshaling service operating between managed and unmanaged heaps within the same COM-style apartment.</span></span>  
  
 <span data-ttu-id="bd5ec-151">![Marshaling międzyoperacyjny między zarządzane i niezarządzane stosów](./media/interop-marshaling/interop-heaps-managed-and-unmanaged.gif "tego samego apartamentu marshaling procesu")</span><span class="sxs-lookup"><span data-stu-id="bd5ec-151">![Interop marshaling between managed and unmanaged heaps](./media/interop-marshaling/interop-heaps-managed-and-unmanaged.gif "Same-apartment marshaling process")</span></span>  
  
 <span data-ttu-id="bd5ec-152">Jeśli planujesz eksportu serwera zarządzanego, należy pamiętać, określa, czy klient modelu COM apartamentu serwera.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-152">If you plan to export a managed server, be aware that the COM client determines the apartment of the server.</span></span> <span data-ttu-id="bd5ec-153">Serwerów zarządzanych, wywoływany przez klient modelu COM, zainicjować w MTA musi zapewnić bezpieczeństwo wątkowe.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-153">A managed server called by a COM client initialized in an MTA must ensure thread safety.</span></span>  
  
### <a name="managed-clients-and-com-servers"></a><span data-ttu-id="bd5ec-154">Zarządzanych klientów i serwerów COM</span><span class="sxs-lookup"><span data-stu-id="bd5ec-154">Managed Clients and COM Servers</span></span>  
 <span data-ttu-id="bd5ec-155">Ustawieniem domyślnym dla klientów zarządzanych apartamentach jest MTA; Typ aplikacji klient modelu .NET można jednak zmienić domyślne ustawienie.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-155">The default setting for managed client apartments is MTA; however, the application type of the .NET client can change the default setting.</span></span> <span data-ttu-id="bd5ec-156">Na przykład ustawienie typu apartment klienta Visual Basic jest komórce jednowątkowej</span><span class="sxs-lookup"><span data-stu-id="bd5ec-156">For example, a Visual Basic client apartment setting is STA.</span></span> <span data-ttu-id="bd5ec-157">Możesz użyć <xref:System.STAThreadAttribute?displayProperty=nameWithType>, <xref:System.MTAThreadAttribute?displayProperty=nameWithType>, <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> właściwości lub <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> właściwość, aby sprawdzić i zmienić ustawienia typu apartment klient zarządzany.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-157">You can use the <xref:System.STAThreadAttribute?displayProperty=nameWithType>, the <xref:System.MTAThreadAttribute?displayProperty=nameWithType>, the <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> property, or the <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> property to examine and change the apartment setting of a managed client.</span></span>  
  
 <span data-ttu-id="bd5ec-158">Tworzenie składnika ustawienie koligacji wątku serwera COM.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-158">The author of the component sets the thread affinity of a COM server.</span></span> <span data-ttu-id="bd5ec-159">W poniższej tabeli przedstawiono kombinacje ustawień apartamentu dla klientów programu .NET i serwerów COM.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-159">The following table shows the combinations of apartment settings for .NET clients and COM servers.</span></span> <span data-ttu-id="bd5ec-160">Pokazuje również, wynikowy marshaling wymagania dotyczące kombinacje.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-160">It also shows the resulting marshaling requirements for the combinations.</span></span>  
  
|<span data-ttu-id="bd5ec-161">Klient .NET</span><span class="sxs-lookup"><span data-stu-id="bd5ec-161">.NET client</span></span>|<span data-ttu-id="bd5ec-162">Serwer COM</span><span class="sxs-lookup"><span data-stu-id="bd5ec-162">COM server</span></span>|<span data-ttu-id="bd5ec-163">Charakteryzuje się wymaganiami</span><span class="sxs-lookup"><span data-stu-id="bd5ec-163">Marshaling requirements</span></span>|  
|-----------------|----------------|-----------------------------|  
|<span data-ttu-id="bd5ec-164">MTA (ustawienie domyślne)</span><span class="sxs-lookup"><span data-stu-id="bd5ec-164">MTA (default)</span></span>|<span data-ttu-id="bd5ec-165">MTA</span><span class="sxs-lookup"><span data-stu-id="bd5ec-165">MTA</span></span><br /><br /> <span data-ttu-id="bd5ec-166">STA</span><span class="sxs-lookup"><span data-stu-id="bd5ec-166">STA</span></span>|<span data-ttu-id="bd5ec-167">Marshaling międzyoperacyjny.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-167">Interop marshaling.</span></span><br /><br /> <span data-ttu-id="bd5ec-168">Współdziałanie i organizowanie COM.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-168">Interop and COM marshaling.</span></span>|  
|<span data-ttu-id="bd5ec-169">STA</span><span class="sxs-lookup"><span data-stu-id="bd5ec-169">STA</span></span>|<span data-ttu-id="bd5ec-170">MTA</span><span class="sxs-lookup"><span data-stu-id="bd5ec-170">MTA</span></span><br /><br /> <span data-ttu-id="bd5ec-171">STA</span><span class="sxs-lookup"><span data-stu-id="bd5ec-171">STA</span></span>|<span data-ttu-id="bd5ec-172">Współdziałanie i organizowanie COM.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-172">Interop and COM marshaling.</span></span><br /><br /> <span data-ttu-id="bd5ec-173">Marshaling międzyoperacyjny.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-173">Interop marshaling.</span></span>|  
  
 <span data-ttu-id="bd5ec-174">Gdy klienta zarządzanego i niezarządzanego serwera są tego samego typu apartment, współdziałanie marshaling usługi obsługuje kierowanie wszystkich danych.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-174">When a managed client and unmanaged server are in the same apartment, the interop marshaling service handles all data marshaling.</span></span> <span data-ttu-id="bd5ec-175">Jednak jeśli klienta i serwera są inicjowane w apartamentach różnych, kierowanie modelu COM jest również wymagane.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-175">However, when client and server are initialized in different apartments, COM marshaling is also required.</span></span> <span data-ttu-id="bd5ec-176">Na poniższej ilustracji pokazano elementy wywołania typu apartment krzyżowe.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-176">The following illustration shows the elements of a cross-apartment call.</span></span>  
  
 <span data-ttu-id="bd5ec-177">![COM marshaling](./media/interop-marshaling/single-process-across-multi-apartment.gif "apartamentu dla wielu wywołań między klient modelu .NET i obiektu COM")</span><span class="sxs-lookup"><span data-stu-id="bd5ec-177">![COM marshaling](./media/interop-marshaling/single-process-across-multi-apartment.gif "Cross-apartment call between a .NET client and COM object")</span></span>  
  
 <span data-ttu-id="bd5ec-178">Dla typu apartment między organizowanie, należy wykonać następujące:</span><span class="sxs-lookup"><span data-stu-id="bd5ec-178">For cross-apartment marshaling, you can do the following:</span></span>  
  
- <span data-ttu-id="bd5ec-179">Zaakceptuj obciążenie szeregowanie między apartamentu, który jest widoczne tylko wtedy, gdy istnieje wiele wywołań przez granicę.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-179">Accept the overhead of the cross-apartment marshaling, which is noticeable only when there are many calls across the boundary.</span></span> <span data-ttu-id="bd5ec-180">Należy zarejestrować biblioteki typów składnika modelu COM dla wywołań do pomyślnie przekroczenia granic typu apartment.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-180">You must register the type library of the COM component for calls to successfully cross the apartment boundary.</span></span>  
  
- <span data-ttu-id="bd5ec-181">Zmiany głównego wątku, ustawiając wątku klienta STA i MTA.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-181">Alter the main thread by setting the client thread to STA or MTA.</span></span> <span data-ttu-id="bd5ec-182">Na przykład jeśli Twoja C# klient wywołuje wiele składników STA COM, możesz uniknąć apartamentu między organizowanie, ustawiając wątku głównego w komórce jednowątkowej</span><span class="sxs-lookup"><span data-stu-id="bd5ec-182">For example, if your C# client calls many STA COM components, you can avoid cross-apartment marshaling by setting the main thread to STA.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="bd5ec-183">Gdy wątek C# klienta jest ustawiona na STA, wywołania składników MTA COM będzie wymagać między apartamentu marshaling.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-183">Once the thread of a C# client is set to STA, calls to MTA COM components will require cross-apartment marshaling.</span></span>  
  
 <span data-ttu-id="bd5ec-184">Aby uzyskać instrukcje dotyczące jawne wybranie ustawienia modelu typu apartment, zobacz [zarządzane i niezarządzane wątkowości](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/5s8ee185(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="bd5ec-184">For instructions on explicitly selecting an apartment model, see [Managed and Unmanaged Threading](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/5s8ee185(v=vs.100)).</span></span>  
  
 [<span data-ttu-id="bd5ec-185">Powrót do początku</span><span class="sxs-lookup"><span data-stu-id="bd5ec-185">Back to top</span></span>](#top)  
  
<a name="marshaling_remote_calls"></a>   
## <a name="marshaling-remote-calls"></a><span data-ttu-id="bd5ec-186">Kierowanie wywołań zdalnych</span><span class="sxs-lookup"><span data-stu-id="bd5ec-186">Marshaling Remote Calls</span></span>  
 <span data-ttu-id="bd5ec-187">Podobnie jak w przypadku wielu apartamentu organizowanie, kierowanie modelu COM jest zaangażowana w każdym wywołaniu między kodem zarządzanym i niezarządzanym zawsze wtedy, gdy obiekty znajdują się w osobnych procesach.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-187">As with cross-apartment marshaling, COM marshaling is involved in each call between managed and unmanaged code whenever the objects reside in separate processes.</span></span> <span data-ttu-id="bd5ec-188">Na przykład:</span><span class="sxs-lookup"><span data-stu-id="bd5ec-188">For example:</span></span>  
  
- <span data-ttu-id="bd5ec-189">Klient modelu COM, który wywołuje serwerów zarządzanych na zdalnym hoście używa rozproszonych (DCOM).</span><span class="sxs-lookup"><span data-stu-id="bd5ec-189">A COM client that invokes a managed server on a remote host uses distributed COM (DCOM).</span></span>  
  
- <span data-ttu-id="bd5ec-190">Klient zarządzany, który wywołuje serwer COM, na zdalnym hoście używa protokołu DCOM.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-190">A managed client that invokes a COM server on a remote host uses DCOM.</span></span>  
  
 <span data-ttu-id="bd5ec-191">Na poniższej ilustracji przedstawiono marshaling międzyoperacyjny jak i kierowanie modelu COM zapewniają kanałów komunikacyjnych granice procesu i hosta.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-191">The following illustration shows how interop marshaling and COM marshaling provide communications channels across process and host boundaries.</span></span>  
  
 <span data-ttu-id="bd5ec-192">![COM marshaling](./media/interop-marshaling/interop-and-com-marshaling.gif "szeregowanie między procesami")</span><span class="sxs-lookup"><span data-stu-id="bd5ec-192">![COM marshaling](./media/interop-marshaling/interop-and-com-marshaling.gif "Cross-process marshaling")</span></span>  
  
### <a name="preserving-identity"></a><span data-ttu-id="bd5ec-193">Zachowywanie tożsamości</span><span class="sxs-lookup"><span data-stu-id="bd5ec-193">Preserving Identity</span></span>  
 <span data-ttu-id="bd5ec-194">Środowisko uruchomieniowe języka wspólnego zachowuje tożsamość odwołania zarządzane i niezarządzane.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-194">The common language runtime preserves the identity of managed and unmanaged references.</span></span> <span data-ttu-id="bd5ec-195">Poniższa ilustracja przedstawia przepływ bezpośrednimi odwołaniami niezarządzane (górny wiersz) i bezpośredniego zarządzanych odwołania (dolny wiersz) granice procesu i hosta.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-195">The following illustration shows the flow of direct unmanaged references (top row) and direct managed references (bottom row) across process and host boundaries.</span></span>  
  
 <span data-ttu-id="bd5ec-196">![Wywoływana otoka COM i wywoływana otoka środowiska uruchomieniowego](./media/interop-marshaling/interop-direct-ref-across-process.gif "odwołania przechodzi przez granice procesu i hosta")</span><span class="sxs-lookup"><span data-stu-id="bd5ec-196">![COM callable wrapper and runtime callable wrapper](./media/interop-marshaling/interop-direct-ref-across-process.gif "Reference passing across process and host boundaries")</span></span>  
  
 <span data-ttu-id="bd5ec-197">Na tej ilustracji:</span><span class="sxs-lookup"><span data-stu-id="bd5ec-197">In this illustration:</span></span>  
  
- <span data-ttu-id="bd5ec-198">Niezarządzany klient pobiera odwołanie do obiektu COM z obiektu zarządzanego, która pobiera odwołanie z hosta zdalnego.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-198">An unmanaged client gets a reference to a COM object from a managed object that gets this reference from a remote host.</span></span> <span data-ttu-id="bd5ec-199">Mechanizm komunikacji zdalnej jest model DCOM.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-199">The remoting mechanism is DCOM.</span></span>  
  
- <span data-ttu-id="bd5ec-200">Klient zarządzany pobiera odwołanie do zarządzanego obiektu z obiektu COM, który pobiera odwołanie z hosta zdalnego.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-200">A managed client gets a reference to a managed object from a COM object that gets this reference from a remote host.</span></span> <span data-ttu-id="bd5ec-201">Mechanizm komunikacji zdalnej jest model DCOM.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-201">The remoting mechanism is DCOM.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="bd5ec-202">Musi być zarejestrowana wyeksportowanej biblioteki typów z serwerów zarządzanych.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-202">The exported type library of the managed server must be registered.</span></span>  
  
 <span data-ttu-id="bd5ec-203">Liczba procesów granic między obiektami wywołującym i wywoływanym nie ma znaczenia; Ten sam bezpośredniego odwołuje się do występuje wywołań w procesie i spoza procesu.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-203">The number of process boundaries between caller and callee is irrelevant; the same direct referencing occurs for in-process and out-of-process calls.</span></span>  
  
### <a name="managed-remoting"></a><span data-ttu-id="bd5ec-204">Zarządzanych usług zdalnych</span><span class="sxs-lookup"><span data-stu-id="bd5ec-204">Managed Remoting</span></span>  
 <span data-ttu-id="bd5ec-205">Środowisko wykonawcze zapewnia również zarządzanych usług zdalnych, używane do ustanawiania kanału komunikacyjnego między obiektami zarządzanej granice procesu i hosta.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-205">The runtime also provides managed remoting, which you can use to establish a communications channel between managed objects across process and host boundaries.</span></span> <span data-ttu-id="bd5ec-206">Zarządzane komunikacji zdalnej może obsłużyć zapory między składnikami komunikujące się, jak pokazano na następującym rysunku.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-206">Managed remoting can accommodate a firewall between the communicating components, as the following illustration shows.</span></span>  
  
 <span data-ttu-id="bd5ec-207">![Protokół SOAP lub TcpChannel](./media/interop-marshaling/interop-remote-soap-or-tcp.gif "zdalnego wywołania przez zapory za pomocą protokołu SOAP lub klasy TcpChannel")</span><span class="sxs-lookup"><span data-stu-id="bd5ec-207">![SOAP or TcpChannel](./media/interop-marshaling/interop-remote-soap-or-tcp.gif "Remote calls across firewalls using SOAP or the TcpChannel class")</span></span>  
<span data-ttu-id="bd5ec-208">Zdalne wywołania przez zapory za pomocą protokołu SOAP lub klasy TcpChannel</span><span class="sxs-lookup"><span data-stu-id="bd5ec-208">Remote calls across firewalls using SOAP or the TcpChannel class</span></span>  
  
 <span data-ttu-id="bd5ec-209">Niektóre wywołania niezarządzanych może channeled za pośrednictwem protokołu SOAP, takie jak wywołania między obsługiwanych składników i modelu COM.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-209">Some unmanaged calls can be channeled through SOAP, such as the calls between serviced components and COM.</span></span>  
  
 [<span data-ttu-id="bd5ec-210">Powrót do początku</span><span class="sxs-lookup"><span data-stu-id="bd5ec-210">Back to top</span></span>](#top)  
  
<a name="related_topics"></a>   
## <a name="related-topics"></a><span data-ttu-id="bd5ec-211">Tematy pokrewne</span><span class="sxs-lookup"><span data-stu-id="bd5ec-211">Related Topics</span></span>  
  
|<span data-ttu-id="bd5ec-212">Tytuł</span><span class="sxs-lookup"><span data-stu-id="bd5ec-212">Title</span></span>|<span data-ttu-id="bd5ec-213">Opis</span><span class="sxs-lookup"><span data-stu-id="bd5ec-213">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="bd5ec-214">Domyślne zachowanie marshalingu</span><span class="sxs-lookup"><span data-stu-id="bd5ec-214">Default Marshaling Behavior</span></span>](default-marshaling-behavior.md)|<span data-ttu-id="bd5ec-215">W tym artykule opisano reguły, które międzyoperacyjny usługa kierowania używa do organizowania danych.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-215">Describes the rules that the interop marshaling service uses to marshal data.</span></span>|  
|[<span data-ttu-id="bd5ec-216">Marshaling danych w wywołaniu platformy</span><span class="sxs-lookup"><span data-stu-id="bd5ec-216">Marshaling Data with Platform Invoke</span></span>](marshaling-data-with-platform-invoke.md)|<span data-ttu-id="bd5ec-217">W tym artykule opisano, jak deklarować parametrów metod i przekazywać argumenty do funkcji eksportowanych przez niezarządzanych bibliotek.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-217">Describes how to declare method parameters and pass arguments to functions exported by unmanaged libraries.</span></span>|  
|[<span data-ttu-id="bd5ec-218">Marshaling danych za pomocą modelu COM</span><span class="sxs-lookup"><span data-stu-id="bd5ec-218">Marshaling Data with COM Interop</span></span>](marshaling-data-with-com-interop.md)|<span data-ttu-id="bd5ec-219">Opisuje sposób dostosowywania otoki COM, aby zmienić zachowanie organizowania.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-219">Describes how to customize COM wrappers to alter marshaling behavior.</span></span>|  
|[<span data-ttu-id="bd5ec-220">Instrukcje: Migrowanie zarządzanego kodu DCOM do WCF</span><span class="sxs-lookup"><span data-stu-id="bd5ec-220">How to: Migrate Managed-Code DCOM to WCF</span></span>](how-to-migrate-managed-code-dcom-to-wcf.md)|<span data-ttu-id="bd5ec-221">W tym artykule opisano, jak przeprowadzić migrację z modelu DCOM do WCF.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-221">Describes how to migrate from DCOM to WCF.</span></span>|  
|[<span data-ttu-id="bd5ec-222">Instrukcje: Mapa wyników HRESULT i wyjątków</span><span class="sxs-lookup"><span data-stu-id="bd5ec-222">How to: Map HRESULTs and Exceptions</span></span>](how-to-map-hresults-and-exceptions.md)|<span data-ttu-id="bd5ec-223">W tym artykule opisano sposób mapowania niestandardowej wyjątków na wartości HRESULT i zapewnia pełną mapowania od każdego HRESULT do jej klasy porównywalne wyjątków w programie .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-223">Describes how to map custom exceptions to HRESULTs and provides the complete mapping from each HRESULT to its comparable exception class in the .NET Framework.</span></span>|  
|<span data-ttu-id="bd5ec-224">[Międzyoperacyjne używanie typów ogólnych](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms229590(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="bd5ec-224">[Interoperating Using Generic Types](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms229590(v=vs.100))</span></span>|<span data-ttu-id="bd5ec-225">W tym artykule opisano akcje, które są obsługiwane w przypadku współdziałania COM za pomocą typów ogólnych.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-225">Describes which actions are supported when using generic types for COM interoperability.</span></span>|  
|[<span data-ttu-id="bd5ec-226">Współdziałanie z kodem niezarządzanym</span><span class="sxs-lookup"><span data-stu-id="bd5ec-226">Interoperating with Unmanaged Code</span></span>](index.md)|<span data-ttu-id="bd5ec-227">Opisuje współdziałanie usługi udostępniane przez środowisko uruchomieniowe języka wspólnego.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-227">Describes interoperability services provided by the common language runtime.</span></span>|  
|<span data-ttu-id="bd5ec-228">[Zaawansowane współdziałanie modeli COM](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bd9cdfyx(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="bd5ec-228">[Advanced COM Interoperability](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bd9cdfyx(v=vs.100))</span></span>|<span data-ttu-id="bd5ec-229">Zawiera łącza do dodatkowych informacji o dołączaniu składników COM do aplikacji środowiska .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-229">Provides links to more information about incorporating COM components into your .NET Framework application.</span></span>|  
|<span data-ttu-id="bd5ec-230">[Zagadnienia dotyczące projektowania do celów międzyoperacyjności](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/61aax4kh(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="bd5ec-230">[Design Considerations for Interoperation](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/61aax4kh(v=vs.100))</span></span>|<span data-ttu-id="bd5ec-231">Zawiera wskazówki dotyczące pisania zintegrowane składników COM.</span><span class="sxs-lookup"><span data-stu-id="bd5ec-231">Provides tips for writing integrated COM components.</span></span>|  
  
 [<span data-ttu-id="bd5ec-232">Powrót do początku</span><span class="sxs-lookup"><span data-stu-id="bd5ec-232">Back to top</span></span>](#top)  
  
<a name="reference"></a>   
## <a name="reference"></a><span data-ttu-id="bd5ec-233">Tematy pomocy</span><span class="sxs-lookup"><span data-stu-id="bd5ec-233">Reference</span></span>  
 <xref:System.Runtime.InteropServices?displayProperty=nameWithType>  
  
 [<span data-ttu-id="bd5ec-234">Powrót do początku</span><span class="sxs-lookup"><span data-stu-id="bd5ec-234">Back to top</span></span>](#top)
