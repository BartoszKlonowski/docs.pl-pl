---
title: Organizowanie międzyoperacyjne
ms.date: 03/30/2017
helpviewer_keywords:
- marshaling, COM interop
- interop marshaling
- interop marshaling, about interop marshaling
ms.assetid: 115f7a2f-d422-4605-ab36-13a8dd28142a
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 20766f4f7971d8aa304c7c3eead94f089f059d64
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/22/2019
ms.locfileid: "69946715"
---
# <a name="interop-marshaling"></a><span data-ttu-id="e44d1-102">Organizowanie międzyoperacyjne</span><span class="sxs-lookup"><span data-stu-id="e44d1-102">Interop Marshaling</span></span>
<a name="top"></a><span data-ttu-id="e44d1-103">Organizowanie międzyoperacyjności reguluje sposób przekazywania danych w argumentach metod i zwraca wartości między zarządzaną i niezarządzaną pamięcią podczas wywołań.</span><span class="sxs-lookup"><span data-stu-id="e44d1-103">Interop marshaling governs how data is passed in method arguments and return values between managed and unmanaged memory during calls.</span></span> <span data-ttu-id="e44d1-104">Organizowanie międzyoperacyjności to działanie czasu wykonywania wykonywane przez usługę Marshaling środowiska uruchomieniowego języka wspólnego.</span><span class="sxs-lookup"><span data-stu-id="e44d1-104">Interop marshaling is a run-time activity performed by the common language runtime's marshaling service.</span></span>  
  
 <span data-ttu-id="e44d1-105">Większość typów danych ma wspólne reprezentacje w pamięci zarządzanej i niezarządzanej.</span><span class="sxs-lookup"><span data-stu-id="e44d1-105">Most data types have common representations in both managed and unmanaged memory.</span></span> <span data-ttu-id="e44d1-106">Organizator międzyoperacyjny obsługuje te typy.</span><span class="sxs-lookup"><span data-stu-id="e44d1-106">The interop marshaler handles these types for you.</span></span> <span data-ttu-id="e44d1-107">Inne typy mogą być niejednoznaczne lub niereprezentowane w całości w pamięci zarządzanej.</span><span class="sxs-lookup"><span data-stu-id="e44d1-107">Other types can be ambiguous or not represented at all in managed memory.</span></span>  
  
 <span data-ttu-id="e44d1-108">Niejednoznaczny typ może mieć wiele niezarządzanych reprezentacji, które są mapowane na pojedynczy typ zarządzany lub brakujące informacje o typie, takie jak rozmiar tablicy.</span><span class="sxs-lookup"><span data-stu-id="e44d1-108">An ambiguous type can have either multiple unmanaged representations that map to a single managed type, or missing type information, such as the size of an array.</span></span> <span data-ttu-id="e44d1-109">Dla niejednoznacznych typów, organizator udostępnia domyślną reprezentację i alternatywne reprezentacje, w których istnieje wiele reprezentacji.</span><span class="sxs-lookup"><span data-stu-id="e44d1-109">For ambiguous types, the marshaler provides a default representation and alternative representations where multiple representations exist.</span></span> <span data-ttu-id="e44d1-110">Możesz dostarczyć jawne instrukcje do organizatora, w jaki sposób ma on zorganizować niejednoznaczny typ.</span><span class="sxs-lookup"><span data-stu-id="e44d1-110">You can supply explicit instructions to the marshaler on how it is to marshal an ambiguous type.</span></span>  
  
 <span data-ttu-id="e44d1-111">To omówienie zawiera następujące sekcje:</span><span class="sxs-lookup"><span data-stu-id="e44d1-111">This overview contains the following sections:</span></span>  
  
- [<span data-ttu-id="e44d1-112">Wywołania platformy i modele międzyoperacyjności modelu COM</span><span class="sxs-lookup"><span data-stu-id="e44d1-112">Platform Invoke and COM Interop Models</span></span>](#platform_invoke_and_com_interop_models)  
  
- [<span data-ttu-id="e44d1-113">Organizowanie i apartamentach COM</span><span class="sxs-lookup"><span data-stu-id="e44d1-113">Marshaling and COM Apartments</span></span>](#marshaling_and_com_apartments)  
  
- [<span data-ttu-id="e44d1-114">Kierowanie zdalnych wywołań</span><span class="sxs-lookup"><span data-stu-id="e44d1-114">Marshaling Remote Calls</span></span>](#marshaling_remote_calls)  
  
- [<span data-ttu-id="e44d1-115">Tematy pokrewne</span><span class="sxs-lookup"><span data-stu-id="e44d1-115">Related Topics</span></span>](#related_topics)  
  
- [<span data-ttu-id="e44d1-116">Dokumentacja</span><span class="sxs-lookup"><span data-stu-id="e44d1-116">Reference</span></span>](#reference)  
  
<a name="platform_invoke_and_com_interop_models"></a>   
## <a name="platform-invoke-and-com-interop-models"></a><span data-ttu-id="e44d1-117">Wywołania platformy i modele międzyoperacyjności modelu COM</span><span class="sxs-lookup"><span data-stu-id="e44d1-117">Platform Invoke and COM Interop Models</span></span>  
 <span data-ttu-id="e44d1-118">Środowisko uruchomieniowe języka wspólnego udostępnia dwa mechanizmy współdziałania z niezarządzanym kodem:</span><span class="sxs-lookup"><span data-stu-id="e44d1-118">The common language runtime provides two mechanisms for interoperating with unmanaged code:</span></span>  
  
- <span data-ttu-id="e44d1-119">Wywołanie platformy, które umożliwia kodowi zarządzanemu wywoływanie funkcji wyeksportowanych z niezarządzanej biblioteki.</span><span class="sxs-lookup"><span data-stu-id="e44d1-119">Platform invoke, which enables managed code to call functions exported from an unmanaged library.</span></span>  
  
- <span data-ttu-id="e44d1-120">Międzyoperacyjność modelu COM, która umożliwia współdziałanie kodu zarządzanego z obiektami Component Object Model (COM) za pomocą interfejsów.</span><span class="sxs-lookup"><span data-stu-id="e44d1-120">COM interop, which enables managed code to interact with Component Object Model (COM) objects through interfaces.</span></span>  
  
 <span data-ttu-id="e44d1-121">Zarówno wywołanie platformy, jak i międzyoperacyjność modelu COM używają organizowania międzyoperacyjnego do dokładnego przenoszenia argumentów metody między obiektem wywołującym i wywoływanym z powrotem, w razie potrzeby.</span><span class="sxs-lookup"><span data-stu-id="e44d1-121">Both platform invoke and COM interop use interop marshaling to accurately move method arguments between caller and callee and back, if required.</span></span> <span data-ttu-id="e44d1-122">Jak widać na poniższej ilustracji, wywołanie metody wywołuje metodę przepływów z zarządzanego do kodu niezarządzanego i nigdy nie w inny sposób, z wyjątkiem sytuacji, gdy są używane [funkcje wywołania zwrotnego](callback-functions.md) .</span><span class="sxs-lookup"><span data-stu-id="e44d1-122">As the following illustration shows, a platform invoke method call flows from managed to unmanaged code and never the other way, except when [callback functions](callback-functions.md) are involved.</span></span> <span data-ttu-id="e44d1-123">Mimo że wywołania wywołania platformy mogą przepływać tylko z kodu zarządzanego do niezarządzanego, dane mogą być przesyłane w obu kierunkach jako parametry wejściowe lub wyjściowe.</span><span class="sxs-lookup"><span data-stu-id="e44d1-123">Even though platform invoke calls can flow only from managed to unmanaged code, data can flow in both directions as input or output parameters.</span></span> <span data-ttu-id="e44d1-124">Wywołania metod międzyoperacyjnych modelu COM mogą przepływać w dowolnym kierunku.</span><span class="sxs-lookup"><span data-stu-id="e44d1-124">COM interop method calls can flow in either direction.</span></span>  
  
 <span data-ttu-id="e44d1-125">![Wywołanie platformy] Wywołanie (./media/interop-marshaling/interop-marshaling-invoke-and-com.png "platformy i przepływ wywołań międzyoperacyjnych modelu COM")</span><span class="sxs-lookup"><span data-stu-id="e44d1-125">![Platform invoke](./media/interop-marshaling/interop-marshaling-invoke-and-com.png "Platform invoke and COM interop call flow")</span></span>  
  
 <span data-ttu-id="e44d1-126">Na najniższym poziomie oba mechanizmy korzystają z tej samej usługi organizowania międzyoperacyjnego. Niektóre typy danych są jednak obsługiwane wyłącznie przez międzyoperacyjność modelu COM lub wywołanie platformy.</span><span class="sxs-lookup"><span data-stu-id="e44d1-126">At the lowest level, both mechanisms use the same interop marshaling service; however, certain data types are supported exclusively by COM interop or platform invoke.</span></span> <span data-ttu-id="e44d1-127">Aby uzyskać szczegółowe informacje, zobacz [domyślne zachowanie organizowania](default-marshaling-behavior.md).</span><span class="sxs-lookup"><span data-stu-id="e44d1-127">For details, see [Default Marshaling Behavior](default-marshaling-behavior.md).</span></span>  
  
 [<span data-ttu-id="e44d1-128">Powrót do początku</span><span class="sxs-lookup"><span data-stu-id="e44d1-128">Back to top</span></span>](#top)  
  
<a name="marshaling_and_com_apartments"></a>   
## <a name="marshaling-and-com-apartments"></a><span data-ttu-id="e44d1-129">Organizowanie i apartamentach COM</span><span class="sxs-lookup"><span data-stu-id="e44d1-129">Marshaling and COM Apartments</span></span>  
 <span data-ttu-id="e44d1-130">Organizator międzyoperacyjny kierujący dane między stertą środowiska uruchomieniowego języka wspólnego i niezarządzaną stertą.</span><span class="sxs-lookup"><span data-stu-id="e44d1-130">The interop marshaler marshals data between the common language runtime heap and the unmanaged heap.</span></span> <span data-ttu-id="e44d1-131">Kierowanie odbywa się zawsze wtedy, gdy obiekt wywołujący i wywoływany nie mogą działać na tym samym wystąpieniu danych.</span><span class="sxs-lookup"><span data-stu-id="e44d1-131">Marshaling occurs whenever the caller and callee cannot operate on the same instance of data.</span></span> <span data-ttu-id="e44d1-132">Organizator międzyoperacyjny sprawia, że jest możliwe, że obiekt wywołujący i wywoływany przez nie działa na tych samych danych, nawet jeśli mają własną kopię danych.</span><span class="sxs-lookup"><span data-stu-id="e44d1-132">The interop marshaler makes it possible for the caller and callee to appear to be operating on the same data even if they have their own copy of the data.</span></span>  
  
 <span data-ttu-id="e44d1-133">Model COM ma również organizatora, który kierujący dane między modelami COM apartamentach lub różnymi procesami COM.</span><span class="sxs-lookup"><span data-stu-id="e44d1-133">COM also has a marshaler that marshals data between COM apartments or different COM processes.</span></span> <span data-ttu-id="e44d1-134">Podczas wywoływania między kodem zarządzanym i niezarządzanym w ramach tej samej komórki COM Organizator międzyoperacyjny jest tym jedynym organizatorem.</span><span class="sxs-lookup"><span data-stu-id="e44d1-134">When calling between managed and unmanaged code within the same COM apartment, the interop marshaler is the only marshaler involved.</span></span> <span data-ttu-id="e44d1-135">Podczas wywoływania kodu zarządzanego i niezarządzanego kodu w innej komórkowym modelu COM lub innym procesie, są to między innymi Organizator międzyoperacyjny i organizator COM.</span><span class="sxs-lookup"><span data-stu-id="e44d1-135">When calling between managed code and unmanaged code in a different COM apartment or a different process, both the interop marshaler and the COM marshaler are involved.</span></span>  
  
### <a name="com-clients-and-managed-servers"></a><span data-ttu-id="e44d1-136">Klienci COM i serwery zarządzane</span><span class="sxs-lookup"><span data-stu-id="e44d1-136">COM Clients and Managed Servers</span></span>  
 <span data-ttu-id="e44d1-137">Wyeksportowany serwer zarządzany z biblioteką typów zarejestrowanego przez [Regasm. exe (Narzędzie rejestracji zestawów)](../tools/regasm-exe-assembly-registration-tool.md) ma `ThreadingModel` wpis rejestru ustawiony na `Both`.</span><span class="sxs-lookup"><span data-stu-id="e44d1-137">An exported managed server with a type library registered by the [Regasm.exe (Assembly Registration Tool)](../tools/regasm-exe-assembly-registration-tool.md) has a `ThreadingModel` registry entry set to `Both`.</span></span> <span data-ttu-id="e44d1-138">Ta wartość wskazuje, że serwer można aktywować w komórce jednowątkowej (STA) lub w wielowątkowej komórce (MTA).</span><span class="sxs-lookup"><span data-stu-id="e44d1-138">This value indicates that the server can be activated in a single-threaded apartment (STA) or a multithreaded apartment (MTA).</span></span> <span data-ttu-id="e44d1-139">Obiekt serwera jest tworzony w tym samym elemencie Apartment co jego obiekt wywołujący, jak pokazano w poniższej tabeli.</span><span class="sxs-lookup"><span data-stu-id="e44d1-139">The server object is created in the same apartment as its caller, as shown in the following table.</span></span>  
  
|<span data-ttu-id="e44d1-140">Klient COM</span><span class="sxs-lookup"><span data-stu-id="e44d1-140">COM client</span></span>|<span data-ttu-id="e44d1-141">Serwer .NET</span><span class="sxs-lookup"><span data-stu-id="e44d1-141">.NET server</span></span>|<span data-ttu-id="e44d1-142">Wymagania dotyczące organizowania</span><span class="sxs-lookup"><span data-stu-id="e44d1-142">Marshaling requirements</span></span>|  
|----------------|-----------------|-----------------------------|  
|<span data-ttu-id="e44d1-143">STA</span><span class="sxs-lookup"><span data-stu-id="e44d1-143">STA</span></span>|<span data-ttu-id="e44d1-144">`Both`zmieni się na STA.</span><span class="sxs-lookup"><span data-stu-id="e44d1-144">`Both` becomes STA.</span></span>|<span data-ttu-id="e44d1-145">Kierowanie między komórkami.</span><span class="sxs-lookup"><span data-stu-id="e44d1-145">Same-apartment marshaling.</span></span>|  
|<span data-ttu-id="e44d1-146">MTA</span><span class="sxs-lookup"><span data-stu-id="e44d1-146">MTA</span></span>|<span data-ttu-id="e44d1-147">`Both`przechodzi do MTA.</span><span class="sxs-lookup"><span data-stu-id="e44d1-147">`Both` becomes MTA.</span></span>|<span data-ttu-id="e44d1-148">Kierowanie między komórkami.</span><span class="sxs-lookup"><span data-stu-id="e44d1-148">Same-apartment marshaling.</span></span>|  
  
 <span data-ttu-id="e44d1-149">Ponieważ klient i serwer znajdują się w tej samej apartamentie, usługa Marshaling Interop automatycznie obsługuje wszystkie kierowanie danych.</span><span class="sxs-lookup"><span data-stu-id="e44d1-149">Because the client and server are in the same apartment, the interop marshaling service automatically handles all data marshaling.</span></span> <span data-ttu-id="e44d1-150">Na poniższej ilustracji przedstawiono usługę Marshaling Interop działającą między stertami zarządzanymi i niezarządzanymi w ramach tego samego apartamentu COM.</span><span class="sxs-lookup"><span data-stu-id="e44d1-150">The following illustration shows the interop marshaling service operating between managed and unmanaged heaps within the same COM-style apartment.</span></span>  
  
 <span data-ttu-id="e44d1-151">![Organizowanie międzyoperacyjnego między stertami zarządzanymi i] niezarządzanymi (./media/interop-marshaling/interop-heaps-managed-and-unmanaged.gif "Proces organizowania tego samego typu Apartment")</span><span class="sxs-lookup"><span data-stu-id="e44d1-151">![Interop marshaling between managed and unmanaged heaps](./media/interop-marshaling/interop-heaps-managed-and-unmanaged.gif "Same-apartment marshaling process")</span></span>  
  
 <span data-ttu-id="e44d1-152">Jeśli planujesz wyeksportować serwer zarządzany, należy pamiętać, że klient COM określa Apartament serwera.</span><span class="sxs-lookup"><span data-stu-id="e44d1-152">If you plan to export a managed server, be aware that the COM client determines the apartment of the server.</span></span> <span data-ttu-id="e44d1-153">Zarządzany serwer wywoływany przez klienta COM zainicjowany w MTA musi zapewnić bezpieczeństwo wątku.</span><span class="sxs-lookup"><span data-stu-id="e44d1-153">A managed server called by a COM client initialized in an MTA must ensure thread safety.</span></span>  
  
### <a name="managed-clients-and-com-servers"></a><span data-ttu-id="e44d1-154">Zarządzani klienci i serwery COM</span><span class="sxs-lookup"><span data-stu-id="e44d1-154">Managed Clients and COM Servers</span></span>  
 <span data-ttu-id="e44d1-155">Ustawieniem domyślnym dla zarządzanego klienta apartamentach jest MTA; Jednak typ aplikacji klienta .NET może zmienić ustawienie domyślne.</span><span class="sxs-lookup"><span data-stu-id="e44d1-155">The default setting for managed client apartments is MTA; however, the application type of the .NET client can change the default setting.</span></span> <span data-ttu-id="e44d1-156">Na przykład ustawienie Apartment Visual Basic Client to STA.</span><span class="sxs-lookup"><span data-stu-id="e44d1-156">For example, a Visual Basic client apartment setting is STA.</span></span> <span data-ttu-id="e44d1-157">Aby przejrzeć i zmienić <xref:System.STAThreadAttribute?displayProperty=nameWithType>ustawienie apartamentu zarządzanego <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> klienta <xref:System.MTAThreadAttribute?displayProperty=nameWithType>, można użyć <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> właściwości,, lub właściwości.</span><span class="sxs-lookup"><span data-stu-id="e44d1-157">You can use the <xref:System.STAThreadAttribute?displayProperty=nameWithType>, the <xref:System.MTAThreadAttribute?displayProperty=nameWithType>, the <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> property, or the <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> property to examine and change the apartment setting of a managed client.</span></span>  
  
 <span data-ttu-id="e44d1-158">Autor składnika ustawia koligację wątku serwera COM.</span><span class="sxs-lookup"><span data-stu-id="e44d1-158">The author of the component sets the thread affinity of a COM server.</span></span> <span data-ttu-id="e44d1-159">W poniższej tabeli przedstawiono kombinacje ustawień Apartment dla klientów .NET i serwerów COM.</span><span class="sxs-lookup"><span data-stu-id="e44d1-159">The following table shows the combinations of apartment settings for .NET clients and COM servers.</span></span> <span data-ttu-id="e44d1-160">Przedstawiono w nim również wyniki związane z kierowaniem dla kombinacji.</span><span class="sxs-lookup"><span data-stu-id="e44d1-160">It also shows the resulting marshaling requirements for the combinations.</span></span>  
  
|<span data-ttu-id="e44d1-161">Klient .NET</span><span class="sxs-lookup"><span data-stu-id="e44d1-161">.NET client</span></span>|<span data-ttu-id="e44d1-162">Serwer COM</span><span class="sxs-lookup"><span data-stu-id="e44d1-162">COM server</span></span>|<span data-ttu-id="e44d1-163">Wymagania dotyczące organizowania</span><span class="sxs-lookup"><span data-stu-id="e44d1-163">Marshaling requirements</span></span>|  
|-----------------|----------------|-----------------------------|  
|<span data-ttu-id="e44d1-164">MTA (domyślnie)</span><span class="sxs-lookup"><span data-stu-id="e44d1-164">MTA (default)</span></span>|<span data-ttu-id="e44d1-165">MTA</span><span class="sxs-lookup"><span data-stu-id="e44d1-165">MTA</span></span><br /><br /> <span data-ttu-id="e44d1-166">STA</span><span class="sxs-lookup"><span data-stu-id="e44d1-166">STA</span></span>|<span data-ttu-id="e44d1-167">Organizowanie międzyoperacyjnych.</span><span class="sxs-lookup"><span data-stu-id="e44d1-167">Interop marshaling.</span></span><br /><br /> <span data-ttu-id="e44d1-168">Współdziałanie i kierowanie modelu COM.</span><span class="sxs-lookup"><span data-stu-id="e44d1-168">Interop and COM marshaling.</span></span>|  
|<span data-ttu-id="e44d1-169">STA</span><span class="sxs-lookup"><span data-stu-id="e44d1-169">STA</span></span>|<span data-ttu-id="e44d1-170">MTA</span><span class="sxs-lookup"><span data-stu-id="e44d1-170">MTA</span></span><br /><br /> <span data-ttu-id="e44d1-171">STA</span><span class="sxs-lookup"><span data-stu-id="e44d1-171">STA</span></span>|<span data-ttu-id="e44d1-172">Współdziałanie i kierowanie modelu COM.</span><span class="sxs-lookup"><span data-stu-id="e44d1-172">Interop and COM marshaling.</span></span><br /><br /> <span data-ttu-id="e44d1-173">Organizowanie międzyoperacyjnych.</span><span class="sxs-lookup"><span data-stu-id="e44d1-173">Interop marshaling.</span></span>|  
  
 <span data-ttu-id="e44d1-174">Gdy zarządzany klient i serwer niezarządzany znajdują się w tym samym elemencie Apartment, usługa Marshaling Interop obsługuje wszystkie dane dotyczące organizowania.</span><span class="sxs-lookup"><span data-stu-id="e44d1-174">When a managed client and unmanaged server are in the same apartment, the interop marshaling service handles all data marshaling.</span></span> <span data-ttu-id="e44d1-175">Jednak po zainicjowaniu klienta i serwera w różnych apartamentach jest również wymagane kierowanie modelu COM.</span><span class="sxs-lookup"><span data-stu-id="e44d1-175">However, when client and server are initialized in different apartments, COM marshaling is also required.</span></span> <span data-ttu-id="e44d1-176">Na poniższej ilustracji przedstawiono elementy wywołania między komórkami.</span><span class="sxs-lookup"><span data-stu-id="e44d1-176">The following illustration shows the elements of a cross-apartment call.</span></span>  
  
 <span data-ttu-id="e44d1-177">![Kierowanie modelu COM](./media/interop-marshaling/single-process-across-multi-apartment.gif "Wywołanie między komórkami między klientem .net a obiektem com")</span><span class="sxs-lookup"><span data-stu-id="e44d1-177">![COM marshaling](./media/interop-marshaling/single-process-across-multi-apartment.gif "Cross-apartment call between a .NET client and COM object")</span></span>  
  
 <span data-ttu-id="e44d1-178">W przypadku organizowania między komórkami można wykonać następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="e44d1-178">For cross-apartment marshaling, you can do the following:</span></span>  
  
- <span data-ttu-id="e44d1-179">Zaakceptuj obciążenie związane z kierowaniem między komórkami, co jest zauważalne tylko wtedy, gdy na granicy występuje wiele wywołań.</span><span class="sxs-lookup"><span data-stu-id="e44d1-179">Accept the overhead of the cross-apartment marshaling, which is noticeable only when there are many calls across the boundary.</span></span> <span data-ttu-id="e44d1-180">Należy zarejestrować bibliotekę typów składnika COM dla wywołań, aby pomyślnie przekroczyć granicę apartamentu.</span><span class="sxs-lookup"><span data-stu-id="e44d1-180">You must register the type library of the COM component for calls to successfully cross the apartment boundary.</span></span>  
  
- <span data-ttu-id="e44d1-181">Zmień główny wątek przez ustawienie wątku klienta na STA lub MTA.</span><span class="sxs-lookup"><span data-stu-id="e44d1-181">Alter the main thread by setting the client thread to STA or MTA.</span></span> <span data-ttu-id="e44d1-182">Na przykład jeśli C# klient wywołuje wiele składników com sta, można uniknąć organizowania między komórkami, ustawiając wątek główny na sta.</span><span class="sxs-lookup"><span data-stu-id="e44d1-182">For example, if your C# client calls many STA COM components, you can avoid cross-apartment marshaling by setting the main thread to STA.</span></span>  
  
    > [!NOTE]
    > <span data-ttu-id="e44d1-183">Gdy wątek C# klienta ma ustawioną wartość sta, wywołania do składników com MTA będą wymagały organizowania między komórkami.</span><span class="sxs-lookup"><span data-stu-id="e44d1-183">Once the thread of a C# client is set to STA, calls to MTA COM components will require cross-apartment marshaling.</span></span>  
  
 <span data-ttu-id="e44d1-184">Aby uzyskać instrukcje dotyczące jawnego wybierania modelu Apartment, zobacz [wątki zarządzane i niezarządzane](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/5s8ee185(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="e44d1-184">For instructions on explicitly selecting an apartment model, see [Managed and Unmanaged Threading](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/5s8ee185(v=vs.100)).</span></span>  
  
 [<span data-ttu-id="e44d1-185">Powrót do początku</span><span class="sxs-lookup"><span data-stu-id="e44d1-185">Back to top</span></span>](#top)  
  
<a name="marshaling_remote_calls"></a>   
## <a name="marshaling-remote-calls"></a><span data-ttu-id="e44d1-186">Kierowanie zdalnych wywołań</span><span class="sxs-lookup"><span data-stu-id="e44d1-186">Marshaling Remote Calls</span></span>  
 <span data-ttu-id="e44d1-187">Podobnie jak w przypadku organizowania między komórkami, kierowanie odbywa się w każdym wywołaniu między kodem zarządzanym i niezarządzanym za każdym razem, gdy obiekty znajdują się w osobnych procesach.</span><span class="sxs-lookup"><span data-stu-id="e44d1-187">As with cross-apartment marshaling, COM marshaling is involved in each call between managed and unmanaged code whenever the objects reside in separate processes.</span></span> <span data-ttu-id="e44d1-188">Na przykład:</span><span class="sxs-lookup"><span data-stu-id="e44d1-188">For example:</span></span>  
  
- <span data-ttu-id="e44d1-189">Klient COM, który wywołuje serwer zarządzany na hoście zdalnym, używa rozproszonego modelu COM (DCOM).</span><span class="sxs-lookup"><span data-stu-id="e44d1-189">A COM client that invokes a managed server on a remote host uses distributed COM (DCOM).</span></span>  
  
- <span data-ttu-id="e44d1-190">Zarządzany klient, który wywołuje serwer COM na hoście zdalnym, korzysta z modelu DCOM.</span><span class="sxs-lookup"><span data-stu-id="e44d1-190">A managed client that invokes a COM server on a remote host uses DCOM.</span></span>  
  
 <span data-ttu-id="e44d1-191">Na poniższej ilustracji przedstawiono, jak kierowanie międzyoperacyjności i kierowanie modelu COM zapewniają kanały komunikacji między procesami i granicami hosta.</span><span class="sxs-lookup"><span data-stu-id="e44d1-191">The following illustration shows how interop marshaling and COM marshaling provide communications channels across process and host boundaries.</span></span>  
  
 <span data-ttu-id="e44d1-192">![Kierowanie modelu COM](./media/interop-marshaling/interop-and-com-marshaling.gif "Kierowanie między procesami")</span><span class="sxs-lookup"><span data-stu-id="e44d1-192">![COM marshaling](./media/interop-marshaling/interop-and-com-marshaling.gif "Cross-process marshaling")</span></span>  
  
### <a name="preserving-identity"></a><span data-ttu-id="e44d1-193">Zachowanie tożsamości</span><span class="sxs-lookup"><span data-stu-id="e44d1-193">Preserving Identity</span></span>  
 <span data-ttu-id="e44d1-194">Środowisko uruchomieniowe języka wspólnego zachowuje tożsamość odwołań zarządzanych i niezarządzanych.</span><span class="sxs-lookup"><span data-stu-id="e44d1-194">The common language runtime preserves the identity of managed and unmanaged references.</span></span> <span data-ttu-id="e44d1-195">Na poniższej ilustracji przedstawiono przepływ bezpośrednich odwołań niezarządzanych (górny wiersz) i bezpośrednie zarządzane odwołania (ostatni wiersz) między procesem i granicami hosta.</span><span class="sxs-lookup"><span data-stu-id="e44d1-195">The following illustration shows the flow of direct unmanaged references (top row) and direct managed references (bottom row) across process and host boundaries.</span></span>  
  
 <span data-ttu-id="e44d1-196">Otoka, która umożliwia wywoływanie ![com](./media/interop-marshaling/interop-direct-ref-across-process.gif "Przekazywanie odwołań między procesami i granicami hosta")</span><span class="sxs-lookup"><span data-stu-id="e44d1-196">![COM callable wrapper and runtime callable wrapper](./media/interop-marshaling/interop-direct-ref-across-process.gif "Reference passing across process and host boundaries")</span></span>  
  
 <span data-ttu-id="e44d1-197">Na tej ilustracji:</span><span class="sxs-lookup"><span data-stu-id="e44d1-197">In this illustration:</span></span>  
  
- <span data-ttu-id="e44d1-198">Niezarządzany Klient pobiera odwołanie do obiektu COM z zarządzanego obiektu, który pobiera to odwołanie z hosta zdalnego.</span><span class="sxs-lookup"><span data-stu-id="e44d1-198">An unmanaged client gets a reference to a COM object from a managed object that gets this reference from a remote host.</span></span> <span data-ttu-id="e44d1-199">Mechanizm komunikacji zdalnej jest modelem DCOM.</span><span class="sxs-lookup"><span data-stu-id="e44d1-199">The remoting mechanism is DCOM.</span></span>  
  
- <span data-ttu-id="e44d1-200">Zarządzany Klient pobiera odwołanie do obiektu zarządzanego z obiektu COM, który pobiera to odwołanie z hosta zdalnego.</span><span class="sxs-lookup"><span data-stu-id="e44d1-200">A managed client gets a reference to a managed object from a COM object that gets this reference from a remote host.</span></span> <span data-ttu-id="e44d1-201">Mechanizm komunikacji zdalnej jest modelem DCOM.</span><span class="sxs-lookup"><span data-stu-id="e44d1-201">The remoting mechanism is DCOM.</span></span>  
  
    > [!NOTE]
    > <span data-ttu-id="e44d1-202">Eksportowana biblioteka typów serwera zarządzanego musi być zarejestrowana.</span><span class="sxs-lookup"><span data-stu-id="e44d1-202">The exported type library of the managed server must be registered.</span></span>  
  
 <span data-ttu-id="e44d1-203">Liczba granic procesów między obiektem wywołującym i wywoływanym jest istotna; ten sam bezpośredni odwołujący występuje dla wywołań przetwarzanych i pozaprocesowych.</span><span class="sxs-lookup"><span data-stu-id="e44d1-203">The number of process boundaries between caller and callee is irrelevant; the same direct referencing occurs for in-process and out-of-process calls.</span></span>  
  
### <a name="managed-remoting"></a><span data-ttu-id="e44d1-204">Zarządzane komunikacja zdalna</span><span class="sxs-lookup"><span data-stu-id="e44d1-204">Managed Remoting</span></span>  
 <span data-ttu-id="e44d1-205">Środowisko uruchomieniowe zapewnia również zarządzane połączenia zdalne, których można użyć do ustanowienia kanału komunikacyjnego między obiektami zarządzanymi w granicach procesu i hosta.</span><span class="sxs-lookup"><span data-stu-id="e44d1-205">The runtime also provides managed remoting, which you can use to establish a communications channel between managed objects across process and host boundaries.</span></span> <span data-ttu-id="e44d1-206">Zarządzane komunikacja zdalna może obsługiwać zaporę między składnikami komunikacji, jak pokazano na poniższej ilustracji.</span><span class="sxs-lookup"><span data-stu-id="e44d1-206">Managed remoting can accommodate a firewall between the communicating components, as the following illustration shows.</span></span>  
  
 <span data-ttu-id="e44d1-207">![Protokół SOAP lub TcpChannel](./media/interop-marshaling/interop-remote-soap-or-tcp.gif "Zdalne wywołania między zaporami przy użyciu protokołu SOAP lub klasy TcpChannel")</span><span class="sxs-lookup"><span data-stu-id="e44d1-207">![SOAP or TcpChannel](./media/interop-marshaling/interop-remote-soap-or-tcp.gif "Remote calls across firewalls using SOAP or the TcpChannel class")</span></span>  
<span data-ttu-id="e44d1-208">Zdalne wywołania między zaporami przy użyciu protokołu SOAP lub klasy TcpChannel</span><span class="sxs-lookup"><span data-stu-id="e44d1-208">Remote calls across firewalls using SOAP or the TcpChannel class</span></span>  
  
 <span data-ttu-id="e44d1-209">Niektóre niezarządzane wywołania można obsłużyć za pośrednictwem protokołu SOAP, takiego jak wywołania między składnikami usług i COM.</span><span class="sxs-lookup"><span data-stu-id="e44d1-209">Some unmanaged calls can be channeled through SOAP, such as the calls between serviced components and COM.</span></span>  
  
 [<span data-ttu-id="e44d1-210">Powrót do początku</span><span class="sxs-lookup"><span data-stu-id="e44d1-210">Back to top</span></span>](#top)  
  
<a name="related_topics"></a>   
## <a name="related-topics"></a><span data-ttu-id="e44d1-211">Tematy pokrewne</span><span class="sxs-lookup"><span data-stu-id="e44d1-211">Related Topics</span></span>  
  
|<span data-ttu-id="e44d1-212">Tytuł</span><span class="sxs-lookup"><span data-stu-id="e44d1-212">Title</span></span>|<span data-ttu-id="e44d1-213">Opis</span><span class="sxs-lookup"><span data-stu-id="e44d1-213">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="e44d1-214">Domyślne zachowanie marshalingu</span><span class="sxs-lookup"><span data-stu-id="e44d1-214">Default Marshaling Behavior</span></span>](default-marshaling-behavior.md)|<span data-ttu-id="e44d1-215">Opisuje reguły, których usługa Marshaling Interop używa do organizowania danych.</span><span class="sxs-lookup"><span data-stu-id="e44d1-215">Describes the rules that the interop marshaling service uses to marshal data.</span></span>|  
|[<span data-ttu-id="e44d1-216">Marshaling danych w wywołaniu platformy</span><span class="sxs-lookup"><span data-stu-id="e44d1-216">Marshaling Data with Platform Invoke</span></span>](marshaling-data-with-platform-invoke.md)|<span data-ttu-id="e44d1-217">Opisuje sposób deklarowania parametrów metody i przekazywania argumentów do funkcji wyeksportowanych przez niezarządzane biblioteki.</span><span class="sxs-lookup"><span data-stu-id="e44d1-217">Describes how to declare method parameters and pass arguments to functions exported by unmanaged libraries.</span></span>|  
|[<span data-ttu-id="e44d1-218">Marshaling danych za pomocą modelu COM</span><span class="sxs-lookup"><span data-stu-id="e44d1-218">Marshaling Data with COM Interop</span></span>](marshaling-data-with-com-interop.md)|<span data-ttu-id="e44d1-219">Opisuje sposób dostosowywania otok COM w celu zmiany sposobu organizowania zachowań.</span><span class="sxs-lookup"><span data-stu-id="e44d1-219">Describes how to customize COM wrappers to alter marshaling behavior.</span></span>|  
|[<span data-ttu-id="e44d1-220">Instrukcje: Migrowanie kodu zarządzanego DCOM do programu WCF</span><span class="sxs-lookup"><span data-stu-id="e44d1-220">How to: Migrate Managed-Code DCOM to WCF</span></span>](how-to-migrate-managed-code-dcom-to-wcf.md)|<span data-ttu-id="e44d1-221">Opisuje sposób migrowania z modelu DCOM do programu WCF.</span><span class="sxs-lookup"><span data-stu-id="e44d1-221">Describes how to migrate from DCOM to WCF.</span></span>|  
|[<span data-ttu-id="e44d1-222">Instrukcje: Mapuj HRESULTs i Exceptions</span><span class="sxs-lookup"><span data-stu-id="e44d1-222">How to: Map HRESULTs and Exceptions</span></span>](how-to-map-hresults-and-exceptions.md)|<span data-ttu-id="e44d1-223">Opisuje sposób mapowania niestandardowych wyjątków na HRESULTs i zapewnia pełne mapowanie z każdego HRESULT do jego porównywalnej klasy wyjątku w .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="e44d1-223">Describes how to map custom exceptions to HRESULTs and provides the complete mapping from each HRESULT to its comparable exception class in the .NET Framework.</span></span>|  
|<span data-ttu-id="e44d1-224">[Współdziałanie przy użyciu typów ogólnych](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms229590(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="e44d1-224">[Interoperating Using Generic Types](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms229590(v=vs.100))</span></span>|<span data-ttu-id="e44d1-225">Opisuje, które akcje są obsługiwane w przypadku używania typów ogólnych do współdziałania z modelem COM.</span><span class="sxs-lookup"><span data-stu-id="e44d1-225">Describes which actions are supported when using generic types for COM interoperability.</span></span>|  
|[<span data-ttu-id="e44d1-226">Współdziałanie z kodem niezarządzanym</span><span class="sxs-lookup"><span data-stu-id="e44d1-226">Interoperating with Unmanaged Code</span></span>](index.md)|<span data-ttu-id="e44d1-227">Opisuje usługi współdziałania udostępniane przez środowisko uruchomieniowe języka wspólnego.</span><span class="sxs-lookup"><span data-stu-id="e44d1-227">Describes interoperability services provided by the common language runtime.</span></span>|  
|<span data-ttu-id="e44d1-228">[Zaawansowana współdziałanie COM](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bd9cdfyx(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="e44d1-228">[Advanced COM Interoperability](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bd9cdfyx(v=vs.100))</span></span>|<span data-ttu-id="e44d1-229">Zawiera łącza do dodatkowych informacji na temat dołączania składników COM do aplikacji .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="e44d1-229">Provides links to more information about incorporating COM components into your .NET Framework application.</span></span>|  
|<span data-ttu-id="e44d1-230">[Zagadnienia dotyczące projektowania operacji międzyoperacyjnych](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/61aax4kh(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="e44d1-230">[Design Considerations for Interoperation](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/61aax4kh(v=vs.100))</span></span>|<span data-ttu-id="e44d1-231">Zawiera wskazówki dotyczące pisania zintegrowanych składników COM.</span><span class="sxs-lookup"><span data-stu-id="e44d1-231">Provides tips for writing integrated COM components.</span></span>|  
  
 [<span data-ttu-id="e44d1-232">Powrót do początku</span><span class="sxs-lookup"><span data-stu-id="e44d1-232">Back to top</span></span>](#top)  
  
<a name="reference"></a>   
## <a name="reference"></a><span data-ttu-id="e44d1-233">Tematy pomocy</span><span class="sxs-lookup"><span data-stu-id="e44d1-233">Reference</span></span>  
 <xref:System.Runtime.InteropServices?displayProperty=nameWithType>  
  
 [<span data-ttu-id="e44d1-234">Powrót do początku</span><span class="sxs-lookup"><span data-stu-id="e44d1-234">Back to top</span></span>](#top)
