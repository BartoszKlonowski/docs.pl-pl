---
title: Organizowanie międzyoperacyjne
ms.date: 03/30/2017
helpviewer_keywords:
- marshaling, COM interop
- interop marshaling
- interop marshaling, about interop marshaling
ms.assetid: 115f7a2f-d422-4605-ab36-13a8dd28142a
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: b7dbba5161c1eeecef41e93c908752410acbd956
ms.sourcegitcommit: 30e2fe5cc4165aa6dde7218ec80a13def3255e98
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 02/13/2019
ms.locfileid: "56221254"
---
# <a name="interop-marshaling"></a><span data-ttu-id="cd491-102">Organizowanie międzyoperacyjne</span><span class="sxs-lookup"><span data-stu-id="cd491-102">Interop Marshaling</span></span>
<a name="top"></a> <span data-ttu-id="cd491-103">Marshaling międzyoperacyjny decyduje o tym, jak dane są przekazywane w metodzie argumentów i zwracanych wartości między zarządzanymi i niezarządzanymi pamięci podczas wywołania.</span><span class="sxs-lookup"><span data-stu-id="cd491-103">Interop marshaling governs how data is passed in method arguments and return values between managed and unmanaged memory during calls.</span></span> <span data-ttu-id="cd491-104">Marshaling międzyoperacyjny jest czynnością środowiska wykonawczego, wykonywane przez usługę organizowania wykonywalnych języka wspólnego.</span><span class="sxs-lookup"><span data-stu-id="cd491-104">Interop marshaling is a run-time activity performed by the common language runtime's marshaling service.</span></span>  
  
 <span data-ttu-id="cd491-105">Większość typów danych mają wspólne reprezentacji w pamięci zarządzanych i niezarządzanych.</span><span class="sxs-lookup"><span data-stu-id="cd491-105">Most data types have common representations in both managed and unmanaged memory.</span></span> <span data-ttu-id="cd491-106">Organizator międzyoperacyjny obsługuje następujące typy dla Ciebie.</span><span class="sxs-lookup"><span data-stu-id="cd491-106">The interop marshaler handles these types for you.</span></span> <span data-ttu-id="cd491-107">Inne typy może być niejednoznaczne lub nie jest reprezentowana w ogóle w pamięci zarządzanej.</span><span class="sxs-lookup"><span data-stu-id="cd491-107">Other types can be ambiguous or not represented at all in managed memory.</span></span>  
  
 <span data-ttu-id="cd491-108">Niejednoznaczny typ może mieć wiele reprezentacji niezarządzanych, mapowane na jeden typ zarządzany, albo brakuje informacji o typie, takich jak rozmiar tablicy.</span><span class="sxs-lookup"><span data-stu-id="cd491-108">An ambiguous type can have either multiple unmanaged representations that map to a single managed type, or missing type information, such as the size of an array.</span></span> <span data-ttu-id="cd491-109">Niejednoznacznych typów Organizator zawiera reprezentację domyślne i Reprezentacje alternatywne, w których istnieje wiele reprezentacji.</span><span class="sxs-lookup"><span data-stu-id="cd491-109">For ambiguous types, the marshaler provides a default representation and alternative representations where multiple representations exist.</span></span> <span data-ttu-id="cd491-110">Możesz podać jawne instrukcje można organizatora, w jaki jest do organizowania niejednoznaczny typ.</span><span class="sxs-lookup"><span data-stu-id="cd491-110">You can supply explicit instructions to the marshaler on how it is to marshal an ambiguous type.</span></span>  
  
 <span data-ttu-id="cd491-111">Ten przegląd zawiera następujące sekcje:</span><span class="sxs-lookup"><span data-stu-id="cd491-111">This overview contains the following sections:</span></span>  
  
-   [<span data-ttu-id="cd491-112">Wywołanie platformy i modele międzyoperacyjnego modelu COM</span><span class="sxs-lookup"><span data-stu-id="cd491-112">Platform Invoke and COM Interop Models</span></span>](#platform_invoke_and_com_interop_models)  
  
-   [<span data-ttu-id="cd491-113">Marshaling i Apartamentach COM</span><span class="sxs-lookup"><span data-stu-id="cd491-113">Marshaling and COM Apartments</span></span>](#marshaling_and_com_apartments)  
  
-   [<span data-ttu-id="cd491-114">Kierowanie wywołań zdalnych</span><span class="sxs-lookup"><span data-stu-id="cd491-114">Marshaling Remote Calls</span></span>](#marshaling_remote_calls)  
  
-   [<span data-ttu-id="cd491-115">Tematy pokrewne</span><span class="sxs-lookup"><span data-stu-id="cd491-115">Related Topics</span></span>](#related_topics)  
  
-   [<span data-ttu-id="cd491-116">Dokumentacja</span><span class="sxs-lookup"><span data-stu-id="cd491-116">Reference</span></span>](#reference)  
  
<a name="platform_invoke_and_com_interop_models"></a>   
## <a name="platform-invoke-and-com-interop-models"></a><span data-ttu-id="cd491-117">Wywołanie platformy i modele międzyoperacyjnego modelu COM</span><span class="sxs-lookup"><span data-stu-id="cd491-117">Platform Invoke and COM Interop Models</span></span>  
 <span data-ttu-id="cd491-118">Środowisko uruchomieniowe języka wspólnego zawiera dwa mechanizmy współdziałanie z kodem niezarządzanym:</span><span class="sxs-lookup"><span data-stu-id="cd491-118">The common language runtime provides two mechanisms for interoperating with unmanaged code:</span></span>  
  
-   <span data-ttu-id="cd491-119">Wywołanie platformy, które umożliwia kodowi zarządzanemu wywoływania funkcji wyeksportowanych z biblioteką niezarządzaną.</span><span class="sxs-lookup"><span data-stu-id="cd491-119">Platform invoke, which enables managed code to call functions exported from an unmanaged library.</span></span>  
  
-   <span data-ttu-id="cd491-120">Usługa międzyoperacyjna modelu COM, który umożliwia interakcję z obiektami Component Object Model (COM) za pośrednictwem interfejsów kodu zarządzanego.</span><span class="sxs-lookup"><span data-stu-id="cd491-120">COM interop, which enables managed code to interact with Component Object Model (COM) objects through interfaces.</span></span>  
  
 <span data-ttu-id="cd491-121">Wywołanie obie platformy i COM międzyoperacyjny Użyj marshaling międzyoperacyjny dokładnie przenoszenie argumenty metody między obiekt wywołujący i obiekt wywoływany i z powrotem, jeśli wymagane.</span><span class="sxs-lookup"><span data-stu-id="cd491-121">Both platform invoke and COM interop use interop marshaling to accurately move method arguments between caller and callee and back, if required.</span></span> <span data-ttu-id="cd491-122">Jak pokazano na poniższej ilustracji, wywołania platformy przepływy wywołanie metody z kodu zarządzanego do kodu niezarządzanego i nigdy nie inny sposób, chyba że [funkcji wywołania zwrotnego](callback-functions.md) są zaangażowani.</span><span class="sxs-lookup"><span data-stu-id="cd491-122">As the following illustration shows, a platform invoke method call flows from managed to unmanaged code and never the other way, except when [callback functions](callback-functions.md) are involved.</span></span> <span data-ttu-id="cd491-123">Mimo że wywołanie platformy wywołania mogą przepływać tylko z kodu zarządzanego do kodu niezarządzanego, dane mogą przepływać w obu kierunkach, jako parametry wejściowe i wyjściowe.</span><span class="sxs-lookup"><span data-stu-id="cd491-123">Even though platform invoke calls can flow only from managed to unmanaged code, data can flow in both directions as input or output parameters.</span></span> <span data-ttu-id="cd491-124">Wywołań metod międzyoperacyjnego modelu COM może przepływać w obu kierunkach.</span><span class="sxs-lookup"><span data-stu-id="cd491-124">COM interop method calls can flow in either direction.</span></span>  
  
 <span data-ttu-id="cd491-125">![Wywołanie platformy](./media/interopmarshaling.png "interopmarshaling")</span><span class="sxs-lookup"><span data-stu-id="cd491-125">![Platform invoke](./media/interopmarshaling.png "interopmarshaling")</span></span>  
<span data-ttu-id="cd491-126">Wywołanie platformy i przepływ wywołań międzyoperacyjnych COM</span><span class="sxs-lookup"><span data-stu-id="cd491-126">Platform invoke and COM interop call flow</span></span>  
  
 <span data-ttu-id="cd491-127">Na najniższym poziomie zarówno mechanizmów używać tego samego międzyoperacyjnego organizowanie usług. Jednak niektóre typy danych są obsługiwane wyłącznie przez COM interop lub wywołania platformy.</span><span class="sxs-lookup"><span data-stu-id="cd491-127">At the lowest level, both mechanisms use the same interop marshaling service; however, certain data types are supported exclusively by COM interop or platform invoke.</span></span> <span data-ttu-id="cd491-128">Aby uzyskać więcej informacji, zobacz [domyślne zachowanie Marshalingu](default-marshaling-behavior.md).</span><span class="sxs-lookup"><span data-stu-id="cd491-128">For details, see [Default Marshaling Behavior](default-marshaling-behavior.md).</span></span>  
  
 [<span data-ttu-id="cd491-129">Powrót do początku</span><span class="sxs-lookup"><span data-stu-id="cd491-129">Back to top</span></span>](#top)  
  
<a name="marshaling_and_com_apartments"></a>   
## <a name="marshaling-and-com-apartments"></a><span data-ttu-id="cd491-130">Marshaling i Apartamentach COM</span><span class="sxs-lookup"><span data-stu-id="cd491-130">Marshaling and COM Apartments</span></span>  
 <span data-ttu-id="cd491-131">Organizator międzyoperacyjny kieruje dane między stosie uruchomieniowym wspólnego języka i niezarządzanym stosu.</span><span class="sxs-lookup"><span data-stu-id="cd491-131">The interop marshaler marshals data between the common language runtime heap and the unmanaged heap.</span></span> <span data-ttu-id="cd491-132">Marshaling występuje zawsze, gdy obiektami wywołującym i wywoływanym nie może działać na tym samym wystąpieniu danych.</span><span class="sxs-lookup"><span data-stu-id="cd491-132">Marshaling occurs whenever the caller and callee cannot operate on the same instance of data.</span></span> <span data-ttu-id="cd491-133">Organizator międzyoperacyjny umożliwia obiektami wywołującym i wywoływanym były widoczne dla działających na tych samych danych, nawet jeśli mają własne kopię danych.</span><span class="sxs-lookup"><span data-stu-id="cd491-133">The interop marshaler makes it possible for the caller and callee to appear to be operating on the same data even if they have their own copy of the data.</span></span>  
  
 <span data-ttu-id="cd491-134">COM ma również organizatora, który kieruje dane między apartamentach COM lub różnych procesów COM.</span><span class="sxs-lookup"><span data-stu-id="cd491-134">COM also has a marshaler that marshals data between COM apartments or different COM processes.</span></span> <span data-ttu-id="cd491-135">Przy wywoływaniu między kodem zarządzanym i niezarządzanym w obrębie tego samego apartamentu COM, organizator międzyoperacyjny jest tylko organizatora zaangażowane.</span><span class="sxs-lookup"><span data-stu-id="cd491-135">When calling between managed and unmanaged code within the same COM apartment, the interop marshaler is the only marshaler involved.</span></span> <span data-ttu-id="cd491-136">Przy wywoływaniu między kodem zarządzanym i kodu niezarządzanego w różnych apartamentu COM lub innego procesu, organizator międzyoperacyjny i Organizator modelu COM są zaangażowane.</span><span class="sxs-lookup"><span data-stu-id="cd491-136">When calling between managed code and unmanaged code in a different COM apartment or a different process, both the interop marshaler and the COM marshaler are involved.</span></span>  
  
### <a name="com-clients-and-managed-servers"></a><span data-ttu-id="cd491-137">Klienci COM i serwerów zarządzanych</span><span class="sxs-lookup"><span data-stu-id="cd491-137">COM Clients and Managed Servers</span></span>  
 <span data-ttu-id="cd491-138">Wyeksportowane serwera zarządzanego z biblioteki typów są rejestrowane przez [Regasm.exe (narzędzie rejestracji zestawów)](../tools/regasm-exe-assembly-registration-tool.md) ma `ThreadingModel` wpis rejestru równa `Both`.</span><span class="sxs-lookup"><span data-stu-id="cd491-138">An exported managed server with a type library registered by the [Regasm.exe (Assembly Registration Tool)](../tools/regasm-exe-assembly-registration-tool.md) has a `ThreadingModel` registry entry set to `Both`.</span></span> <span data-ttu-id="cd491-139">Ta wartość wskazuje, że serwer można aktywować apartamentem jednowątkowym (przedziale STA) lub wielowątkowe apartamentu (MTA).</span><span class="sxs-lookup"><span data-stu-id="cd491-139">This value indicates that the server can be activated in a single-threaded apartment (STA) or a multithreaded apartment (MTA).</span></span> <span data-ttu-id="cd491-140">Obiekt serwera jest tworzony w tej samej apartamentu jako obiektu wywołującego, jak pokazano w poniższej tabeli.</span><span class="sxs-lookup"><span data-stu-id="cd491-140">The server object is created in the same apartment as its caller, as shown in the following table.</span></span>  
  
|<span data-ttu-id="cd491-141">Klient modelu COM</span><span class="sxs-lookup"><span data-stu-id="cd491-141">COM client</span></span>|<span data-ttu-id="cd491-142">Serwer .NET</span><span class="sxs-lookup"><span data-stu-id="cd491-142">.NET server</span></span>|<span data-ttu-id="cd491-143">Charakteryzuje się wymaganiami</span><span class="sxs-lookup"><span data-stu-id="cd491-143">Marshaling requirements</span></span>|  
|----------------|-----------------|-----------------------------|  
|<span data-ttu-id="cd491-144">STA</span><span class="sxs-lookup"><span data-stu-id="cd491-144">STA</span></span>|<span data-ttu-id="cd491-145">`Both` becomes STA.</span><span class="sxs-lookup"><span data-stu-id="cd491-145">`Both` becomes STA.</span></span>|<span data-ttu-id="cd491-146">Marshaling tego samego typu apartment.</span><span class="sxs-lookup"><span data-stu-id="cd491-146">Same-apartment marshaling.</span></span>|  
|<span data-ttu-id="cd491-147">MTA</span><span class="sxs-lookup"><span data-stu-id="cd491-147">MTA</span></span>|<span data-ttu-id="cd491-148">`Both` becomes MTA.</span><span class="sxs-lookup"><span data-stu-id="cd491-148">`Both` becomes MTA.</span></span>|<span data-ttu-id="cd491-149">Marshaling tego samego typu apartment.</span><span class="sxs-lookup"><span data-stu-id="cd491-149">Same-apartment marshaling.</span></span>|  
  
 <span data-ttu-id="cd491-150">Ponieważ klient i serwer znajdują się w tej samej typu apartment, interop marshaling usługi automatycznie obsługuje marshaling wszystkich danych.</span><span class="sxs-lookup"><span data-stu-id="cd491-150">Because the client and server are in the same apartment, the interop marshaling service automatically handles all data marshaling.</span></span> <span data-ttu-id="cd491-151">Poniższa ilustracja przedstawia międzyoperacyjny usługi organizowania działające między zarządzanymi i niezarządzanymi stosów w ramach tego samego typu apartment styl modelu COM.</span><span class="sxs-lookup"><span data-stu-id="cd491-151">The following illustration shows the interop marshaling service operating between managed and unmanaged heaps within the same COM-style apartment.</span></span>  
  
 <span data-ttu-id="cd491-152">![Marshaling międzyoperacyjny](./media/interopheap.gif "interopheap")</span><span class="sxs-lookup"><span data-stu-id="cd491-152">![Interop marshaling](./media/interopheap.gif "interopheap")</span></span>  
<span data-ttu-id="cd491-153">Tego samego typu apartment organizowania procesu</span><span class="sxs-lookup"><span data-stu-id="cd491-153">Same-apartment marshaling process</span></span>  
  
 <span data-ttu-id="cd491-154">Jeśli planujesz eksportu serwera zarządzanego, należy pamiętać, określa, czy klient modelu COM apartamentu serwera.</span><span class="sxs-lookup"><span data-stu-id="cd491-154">If you plan to export a managed server, be aware that the COM client determines the apartment of the server.</span></span> <span data-ttu-id="cd491-155">Serwerów zarządzanych, wywoływany przez klient modelu COM, zainicjować w MTA musi zapewnić bezpieczeństwo wątkowe.</span><span class="sxs-lookup"><span data-stu-id="cd491-155">A managed server called by a COM client initialized in an MTA must ensure thread safety.</span></span>  
  
### <a name="managed-clients-and-com-servers"></a><span data-ttu-id="cd491-156">Zarządzanych klientów i serwerów COM</span><span class="sxs-lookup"><span data-stu-id="cd491-156">Managed Clients and COM Servers</span></span>  
 <span data-ttu-id="cd491-157">Ustawieniem domyślnym dla klientów zarządzanych apartamentach jest MTA; Typ aplikacji klient modelu .NET można jednak zmienić domyślne ustawienie.</span><span class="sxs-lookup"><span data-stu-id="cd491-157">The default setting for managed client apartments is MTA; however, the application type of the .NET client can change the default setting.</span></span> <span data-ttu-id="cd491-158">Na przykład [!INCLUDE[vbprvblong](../../../includes/vbprvblong-md.md)] ustawienie typu apartment klienta jest komórce jednowątkowej</span><span class="sxs-lookup"><span data-stu-id="cd491-158">For example, a [!INCLUDE[vbprvblong](../../../includes/vbprvblong-md.md)] client apartment setting is STA.</span></span> <span data-ttu-id="cd491-159">Możesz użyć <xref:System.STAThreadAttribute?displayProperty=nameWithType>, <xref:System.MTAThreadAttribute?displayProperty=nameWithType>, <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> właściwości lub <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> właściwość, aby sprawdzić i zmienić ustawienia typu apartment klient zarządzany.</span><span class="sxs-lookup"><span data-stu-id="cd491-159">You can use the <xref:System.STAThreadAttribute?displayProperty=nameWithType>, the <xref:System.MTAThreadAttribute?displayProperty=nameWithType>, the <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> property, or the <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> property to examine and change the apartment setting of a managed client.</span></span>  
  
 <span data-ttu-id="cd491-160">Tworzenie składnika ustawienie koligacji wątku serwera COM.</span><span class="sxs-lookup"><span data-stu-id="cd491-160">The author of the component sets the thread affinity of a COM server.</span></span> <span data-ttu-id="cd491-161">W poniższej tabeli przedstawiono kombinacje ustawień apartamentu dla klientów programu .NET i serwerów COM.</span><span class="sxs-lookup"><span data-stu-id="cd491-161">The following table shows the combinations of apartment settings for .NET clients and COM servers.</span></span> <span data-ttu-id="cd491-162">Pokazuje również, wynikowy marshaling wymagania dotyczące kombinacje.</span><span class="sxs-lookup"><span data-stu-id="cd491-162">It also shows the resulting marshaling requirements for the combinations.</span></span>  
  
|<span data-ttu-id="cd491-163">Klient .NET</span><span class="sxs-lookup"><span data-stu-id="cd491-163">.NET client</span></span>|<span data-ttu-id="cd491-164">Serwer COM</span><span class="sxs-lookup"><span data-stu-id="cd491-164">COM server</span></span>|<span data-ttu-id="cd491-165">Charakteryzuje się wymaganiami</span><span class="sxs-lookup"><span data-stu-id="cd491-165">Marshaling requirements</span></span>|  
|-----------------|----------------|-----------------------------|  
|<span data-ttu-id="cd491-166">MTA (ustawienie domyślne)</span><span class="sxs-lookup"><span data-stu-id="cd491-166">MTA (default)</span></span>|<span data-ttu-id="cd491-167">MTA</span><span class="sxs-lookup"><span data-stu-id="cd491-167">MTA</span></span><br /><br /> <span data-ttu-id="cd491-168">STA</span><span class="sxs-lookup"><span data-stu-id="cd491-168">STA</span></span>|<span data-ttu-id="cd491-169">Marshaling międzyoperacyjny.</span><span class="sxs-lookup"><span data-stu-id="cd491-169">Interop marshaling.</span></span><br /><br /> <span data-ttu-id="cd491-170">Współdziałanie i organizowanie COM.</span><span class="sxs-lookup"><span data-stu-id="cd491-170">Interop and COM marshaling.</span></span>|  
|<span data-ttu-id="cd491-171">STA</span><span class="sxs-lookup"><span data-stu-id="cd491-171">STA</span></span>|<span data-ttu-id="cd491-172">MTA</span><span class="sxs-lookup"><span data-stu-id="cd491-172">MTA</span></span><br /><br /> <span data-ttu-id="cd491-173">STA</span><span class="sxs-lookup"><span data-stu-id="cd491-173">STA</span></span>|<span data-ttu-id="cd491-174">Współdziałanie i organizowanie COM.</span><span class="sxs-lookup"><span data-stu-id="cd491-174">Interop and COM marshaling.</span></span><br /><br /> <span data-ttu-id="cd491-175">Marshaling międzyoperacyjny.</span><span class="sxs-lookup"><span data-stu-id="cd491-175">Interop marshaling.</span></span>|  
  
 <span data-ttu-id="cd491-176">Gdy klienta zarządzanego i niezarządzanego serwera są tego samego typu apartment, współdziałanie marshaling usługi obsługuje kierowanie wszystkich danych.</span><span class="sxs-lookup"><span data-stu-id="cd491-176">When a managed client and unmanaged server are in the same apartment, the interop marshaling service handles all data marshaling.</span></span> <span data-ttu-id="cd491-177">Jednak jeśli klienta i serwera są inicjowane w apartamentach różnych, kierowanie modelu COM jest również wymagane.</span><span class="sxs-lookup"><span data-stu-id="cd491-177">However, when client and server are initialized in different apartments, COM marshaling is also required.</span></span> <span data-ttu-id="cd491-178">Na poniższej ilustracji pokazano elementy wywołania typu apartment krzyżowe.</span><span class="sxs-lookup"><span data-stu-id="cd491-178">The following illustration shows the elements of a cross-apartment call.</span></span>  
  
 <span data-ttu-id="cd491-179">![COM marshaling](./media/singleprocessmultapt.gif "singleprocessmultapt")</span><span class="sxs-lookup"><span data-stu-id="cd491-179">![COM marshaling](./media/singleprocessmultapt.gif "singleprocessmultapt")</span></span>  
<span data-ttu-id="cd491-180">Wywołania między apartamentu między klient modelu .NET i obiektu COM</span><span class="sxs-lookup"><span data-stu-id="cd491-180">Cross-apartment call between a .NET client and COM object</span></span>  
  
 <span data-ttu-id="cd491-181">Dla typu apartment między organizowanie, należy wykonać następujące:</span><span class="sxs-lookup"><span data-stu-id="cd491-181">For cross-apartment marshaling, you can do the following:</span></span>  
  
-   <span data-ttu-id="cd491-182">Zaakceptuj obciążenie szeregowanie między apartamentu, który jest widoczne tylko wtedy, gdy istnieje wiele wywołań przez granicę.</span><span class="sxs-lookup"><span data-stu-id="cd491-182">Accept the overhead of the cross-apartment marshaling, which is noticeable only when there are many calls across the boundary.</span></span> <span data-ttu-id="cd491-183">Należy zarejestrować biblioteki typów składnika modelu COM dla wywołań do pomyślnie przekroczenia granic typu apartment.</span><span class="sxs-lookup"><span data-stu-id="cd491-183">You must register the type library of the COM component for calls to successfully cross the apartment boundary.</span></span>  
  
-   <span data-ttu-id="cd491-184">Zmiany głównego wątku, ustawiając wątku klienta STA i MTA.</span><span class="sxs-lookup"><span data-stu-id="cd491-184">Alter the main thread by setting the client thread to STA or MTA.</span></span> <span data-ttu-id="cd491-185">Na przykład jeśli Twoja C# klient wywołuje wiele składników STA COM, możesz uniknąć apartamentu między organizowanie, ustawiając wątku głównego w komórce jednowątkowej</span><span class="sxs-lookup"><span data-stu-id="cd491-185">For example, if your C# client calls many STA COM components, you can avoid cross-apartment marshaling by setting the main thread to STA.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="cd491-186">Gdy wątek C# klienta jest ustawiona na STA, wywołania składników MTA COM będzie wymagać między apartamentu marshaling.</span><span class="sxs-lookup"><span data-stu-id="cd491-186">Once the thread of a C# client is set to STA, calls to MTA COM components will require cross-apartment marshaling.</span></span>  
  
 <span data-ttu-id="cd491-187">Aby uzyskać instrukcje dotyczące jawne wybranie ustawienia modelu typu apartment, zobacz [zarządzane i niezarządzane wątkowości](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/5s8ee185(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="cd491-187">For instructions on explicitly selecting an apartment model, see [Managed and Unmanaged Threading](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/5s8ee185(v=vs.100)).</span></span>  
  
 [<span data-ttu-id="cd491-188">Powrót do początku</span><span class="sxs-lookup"><span data-stu-id="cd491-188">Back to top</span></span>](#top)  
  
<a name="marshaling_remote_calls"></a>   
## <a name="marshaling-remote-calls"></a><span data-ttu-id="cd491-189">Kierowanie wywołań zdalnych</span><span class="sxs-lookup"><span data-stu-id="cd491-189">Marshaling Remote Calls</span></span>  
 <span data-ttu-id="cd491-190">Podobnie jak w przypadku wielu apartamentu organizowanie, kierowanie modelu COM jest zaangażowana w każdym wywołaniu między kodem zarządzanym i niezarządzanym zawsze wtedy, gdy obiekty znajdują się w osobnych procesach.</span><span class="sxs-lookup"><span data-stu-id="cd491-190">As with cross-apartment marshaling, COM marshaling is involved in each call between managed and unmanaged code whenever the objects reside in separate processes.</span></span> <span data-ttu-id="cd491-191">Na przykład:</span><span class="sxs-lookup"><span data-stu-id="cd491-191">For example:</span></span>  
  
-   <span data-ttu-id="cd491-192">Klient modelu COM, który wywołuje serwerów zarządzanych na zdalnym hoście używa rozproszonych (DCOM).</span><span class="sxs-lookup"><span data-stu-id="cd491-192">A COM client that invokes a managed server on a remote host uses distributed COM (DCOM).</span></span>  
  
-   <span data-ttu-id="cd491-193">Klient zarządzany, który wywołuje serwer COM, na zdalnym hoście używa protokołu DCOM.</span><span class="sxs-lookup"><span data-stu-id="cd491-193">A managed client that invokes a COM server on a remote host uses DCOM.</span></span>  
  
 <span data-ttu-id="cd491-194">Na poniższej ilustracji przedstawiono marshaling międzyoperacyjny jak i kierowanie modelu COM zapewniają kanałów komunikacyjnych granice procesu i hosta.</span><span class="sxs-lookup"><span data-stu-id="cd491-194">The following illustration shows how interop marshaling and COM marshaling provide communications channels across process and host boundaries.</span></span>  
  
 <span data-ttu-id="cd491-195">![COM marshaling](./media/interophost.gif "interophost")</span><span class="sxs-lookup"><span data-stu-id="cd491-195">![COM marshaling](./media/interophost.gif "interophost")</span></span>  
<span data-ttu-id="cd491-196">Szeregowanie między procesami</span><span class="sxs-lookup"><span data-stu-id="cd491-196">Cross-process marshaling</span></span>  
  
### <a name="preserving-identity"></a><span data-ttu-id="cd491-197">Zachowywanie tożsamości</span><span class="sxs-lookup"><span data-stu-id="cd491-197">Preserving Identity</span></span>  
 <span data-ttu-id="cd491-198">Środowisko uruchomieniowe języka wspólnego zachowuje tożsamość odwołania zarządzane i niezarządzane.</span><span class="sxs-lookup"><span data-stu-id="cd491-198">The common language runtime preserves the identity of managed and unmanaged references.</span></span> <span data-ttu-id="cd491-199">Poniższa ilustracja przedstawia przepływ bezpośrednimi odwołaniami niezarządzane (górny wiersz) i bezpośredniego zarządzanych odwołania (dolny wiersz) granice procesu i hosta.</span><span class="sxs-lookup"><span data-stu-id="cd491-199">The following illustration shows the flow of direct unmanaged references (top row) and direct managed references (bottom row) across process and host boundaries.</span></span>  
  
 <span data-ttu-id="cd491-200">![Wywoływana otoka COM i wywoływana otoka środowiska uruchomieniowego](./media/interopdirectref.gif "interopdirectref")</span><span class="sxs-lookup"><span data-stu-id="cd491-200">![COM callable wrapper and runtime callable wrapper](./media/interopdirectref.gif "interopdirectref")</span></span>  
<span data-ttu-id="cd491-201">Dokumentacja przechodzi przez granice procesu i hosta</span><span class="sxs-lookup"><span data-stu-id="cd491-201">Reference passing across process and host boundaries</span></span>  
  
 <span data-ttu-id="cd491-202">Na tej ilustracji:</span><span class="sxs-lookup"><span data-stu-id="cd491-202">In this illustration:</span></span>  
  
-   <span data-ttu-id="cd491-203">Niezarządzany klient pobiera odwołanie do obiektu COM z obiektu zarządzanego, która pobiera odwołanie z hosta zdalnego.</span><span class="sxs-lookup"><span data-stu-id="cd491-203">An unmanaged client gets a reference to a COM object from a managed object that gets this reference from a remote host.</span></span> <span data-ttu-id="cd491-204">Mechanizm komunikacji zdalnej jest model DCOM.</span><span class="sxs-lookup"><span data-stu-id="cd491-204">The remoting mechanism is DCOM.</span></span>  
  
-   <span data-ttu-id="cd491-205">Klient zarządzany pobiera odwołanie do zarządzanego obiektu z obiektu COM, który pobiera odwołanie z hosta zdalnego.</span><span class="sxs-lookup"><span data-stu-id="cd491-205">A managed client gets a reference to a managed object from a COM object that gets this reference from a remote host.</span></span> <span data-ttu-id="cd491-206">Mechanizm komunikacji zdalnej jest model DCOM.</span><span class="sxs-lookup"><span data-stu-id="cd491-206">The remoting mechanism is DCOM.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="cd491-207">Musi być zarejestrowana wyeksportowanej biblioteki typów z serwerów zarządzanych.</span><span class="sxs-lookup"><span data-stu-id="cd491-207">The exported type library of the managed server must be registered.</span></span>  
  
 <span data-ttu-id="cd491-208">Liczba procesów granic między obiektami wywołującym i wywoływanym nie ma znaczenia; Ten sam bezpośredniego odwołuje się do występuje wywołań w procesie i spoza procesu.</span><span class="sxs-lookup"><span data-stu-id="cd491-208">The number of process boundaries between caller and callee is irrelevant; the same direct referencing occurs for in-process and out-of-process calls.</span></span>  
  
### <a name="managed-remoting"></a><span data-ttu-id="cd491-209">Zarządzanych usług zdalnych</span><span class="sxs-lookup"><span data-stu-id="cd491-209">Managed Remoting</span></span>  
 <span data-ttu-id="cd491-210">Środowisko wykonawcze zapewnia również zarządzanych usług zdalnych, używane do ustanawiania kanału komunikacyjnego między obiektami zarządzanej granice procesu i hosta.</span><span class="sxs-lookup"><span data-stu-id="cd491-210">The runtime also provides managed remoting, which you can use to establish a communications channel between managed objects across process and host boundaries.</span></span> <span data-ttu-id="cd491-211">Zarządzane komunikacji zdalnej może obsłużyć zapory między składnikami komunikujące się, jak pokazano na następującym rysunku.</span><span class="sxs-lookup"><span data-stu-id="cd491-211">Managed remoting can accommodate a firewall between the communicating components, as the following illustration shows.</span></span>  
  
 <span data-ttu-id="cd491-212">![Protokół SOAP lub TcpChannel](./media/interopremotesoap.gif "interopremotesoap")</span><span class="sxs-lookup"><span data-stu-id="cd491-212">![SOAP or TcpChannel](./media/interopremotesoap.gif "interopremotesoap")</span></span>  
<span data-ttu-id="cd491-213">Zdalne wywołania przez zapory za pomocą protokołu SOAP lub klasy TcpChannel</span><span class="sxs-lookup"><span data-stu-id="cd491-213">Remote calls across firewalls using SOAP or the TcpChannel class</span></span>  
  
 <span data-ttu-id="cd491-214">Niektóre wywołania niezarządzanych może channeled za pośrednictwem protokołu SOAP, takie jak wywołania między obsługiwanych składników i modelu COM.</span><span class="sxs-lookup"><span data-stu-id="cd491-214">Some unmanaged calls can be channeled through SOAP, such as the calls between serviced components and COM.</span></span>  
  
 [<span data-ttu-id="cd491-215">Powrót do początku</span><span class="sxs-lookup"><span data-stu-id="cd491-215">Back to top</span></span>](#top)  
  
<a name="related_topics"></a>   
## <a name="related-topics"></a><span data-ttu-id="cd491-216">Tematy pokrewne</span><span class="sxs-lookup"><span data-stu-id="cd491-216">Related Topics</span></span>  
  
|<span data-ttu-id="cd491-217">Tytuł</span><span class="sxs-lookup"><span data-stu-id="cd491-217">Title</span></span>|<span data-ttu-id="cd491-218">Opis</span><span class="sxs-lookup"><span data-stu-id="cd491-218">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="cd491-219">Domyślne zachowanie marshalingu</span><span class="sxs-lookup"><span data-stu-id="cd491-219">Default Marshaling Behavior</span></span>](default-marshaling-behavior.md)|<span data-ttu-id="cd491-220">W tym artykule opisano reguły, które międzyoperacyjny usługa kierowania używa do organizowania danych.</span><span class="sxs-lookup"><span data-stu-id="cd491-220">Describes the rules that the interop marshaling service uses to marshal data.</span></span>|  
|[<span data-ttu-id="cd491-221">Marshaling danych w wywołaniu platformy</span><span class="sxs-lookup"><span data-stu-id="cd491-221">Marshaling Data with Platform Invoke</span></span>](marshaling-data-with-platform-invoke.md)|<span data-ttu-id="cd491-222">W tym artykule opisano, jak deklarować parametrów metod i przekazywać argumenty do funkcji eksportowanych przez niezarządzanych bibliotek.</span><span class="sxs-lookup"><span data-stu-id="cd491-222">Describes how to declare method parameters and pass arguments to functions exported by unmanaged libraries.</span></span>|  
|[<span data-ttu-id="cd491-223">Marshaling danych za pomocą modelu COM</span><span class="sxs-lookup"><span data-stu-id="cd491-223">Marshaling Data with COM Interop</span></span>](marshaling-data-with-com-interop.md)|<span data-ttu-id="cd491-224">Opisuje sposób dostosowywania otoki COM, aby zmienić zachowanie organizowania.</span><span class="sxs-lookup"><span data-stu-id="cd491-224">Describes how to customize COM wrappers to alter marshaling behavior.</span></span>|  
|[<span data-ttu-id="cd491-225">Instrukcje: Migrowanie zarządzanego kodu DCOM do WCF</span><span class="sxs-lookup"><span data-stu-id="cd491-225">How to: Migrate Managed-Code DCOM to WCF</span></span>](how-to-migrate-managed-code-dcom-to-wcf.md)|<span data-ttu-id="cd491-226">W tym artykule opisano, jak przeprowadzić migrację z modelu DCOM do WCF.</span><span class="sxs-lookup"><span data-stu-id="cd491-226">Describes how to migrate from DCOM to WCF.</span></span>|  
|[<span data-ttu-id="cd491-227">Instrukcje: Mapa wyników HRESULT i wyjątków</span><span class="sxs-lookup"><span data-stu-id="cd491-227">How to: Map HRESULTs and Exceptions</span></span>](how-to-map-hresults-and-exceptions.md)|<span data-ttu-id="cd491-228">W tym artykule opisano sposób mapowania niestandardowej wyjątków na wartości HRESULT i zapewnia pełną mapowania od każdego HRESULT do jej klasy porównywalne wyjątków w programie .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="cd491-228">Describes how to map custom exceptions to HRESULTs and provides the complete mapping from each HRESULT to its comparable exception class in the .NET Framework.</span></span>|  
|<span data-ttu-id="cd491-229">[Międzyoperacyjne używanie typów ogólnych](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms229590(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="cd491-229">[Interoperating Using Generic Types](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms229590(v=vs.100))</span></span>|<span data-ttu-id="cd491-230">W tym artykule opisano akcje, które są obsługiwane w przypadku współdziałania COM za pomocą typów ogólnych.</span><span class="sxs-lookup"><span data-stu-id="cd491-230">Describes which actions are supported when using generic types for COM interoperability.</span></span>|  
|[<span data-ttu-id="cd491-231">Współdziałanie z kodem niezarządzanym</span><span class="sxs-lookup"><span data-stu-id="cd491-231">Interoperating with Unmanaged Code</span></span>](index.md)|<span data-ttu-id="cd491-232">Opisuje współdziałanie usługi udostępniane przez środowisko uruchomieniowe języka wspólnego.</span><span class="sxs-lookup"><span data-stu-id="cd491-232">Describes interoperability services provided by the common language runtime.</span></span>|  
|<span data-ttu-id="cd491-233">[Zaawansowane współdziałanie modeli COM](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bd9cdfyx(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="cd491-233">[Advanced COM Interoperability](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bd9cdfyx(v=vs.100))</span></span>|<span data-ttu-id="cd491-234">Zawiera łącza do dodatkowych informacji o dołączaniu składników COM do aplikacji środowiska .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="cd491-234">Provides links to more information about incorporating COM components into your .NET Framework application.</span></span>|  
|<span data-ttu-id="cd491-235">[Zagadnienia dotyczące projektowania do celów międzyoperacyjności](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/61aax4kh(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="cd491-235">[Design Considerations for Interoperation](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/61aax4kh(v=vs.100))</span></span>|<span data-ttu-id="cd491-236">Zawiera wskazówki dotyczące pisania zintegrowane składników COM.</span><span class="sxs-lookup"><span data-stu-id="cd491-236">Provides tips for writing integrated COM components.</span></span>|  
  
 [<span data-ttu-id="cd491-237">Powrót do początku</span><span class="sxs-lookup"><span data-stu-id="cd491-237">Back to top</span></span>](#top)  
  
<a name="reference"></a>   
## <a name="reference"></a><span data-ttu-id="cd491-238">Tematy pomocy</span><span class="sxs-lookup"><span data-stu-id="cd491-238">Reference</span></span>  
 <xref:System.Runtime.InteropServices?displayProperty=nameWithType>  
  
 [<span data-ttu-id="cd491-239">Powrót do początku</span><span class="sxs-lookup"><span data-stu-id="cd491-239">Back to top</span></span>](#top)
