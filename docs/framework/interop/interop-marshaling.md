---
title: "Marshaling międzyoperacyjny"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- marshaling, COM interop
- interop marshaling
- interop marshaling, about interop marshaling
ms.assetid: 115f7a2f-d422-4605-ab36-13a8dd28142a
caps.latest.revision: "22"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 5bfd5ca9d42c654882c77efafed82aec7e4f0c9b
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 12/22/2017
---
# <a name="interop-marshaling"></a><span data-ttu-id="4fba8-102">Marshaling międzyoperacyjny</span><span class="sxs-lookup"><span data-stu-id="4fba8-102">Interop Marshaling</span></span>
<a name="top"></a><span data-ttu-id="4fba8-103">Przekazywanie międzyoperacyjne decyduje o tym, jak dane są przekazywane w metody argumentów i zwracanych wartości między zarządzanymi i niezarządzanymi pamięci podczas wywołania.</span><span class="sxs-lookup"><span data-stu-id="4fba8-103">Interop marshaling governs how data is passed in method arguments and return values between managed and unmanaged memory during calls.</span></span> <span data-ttu-id="4fba8-104">Przekazywanie międzyoperacyjne jest wykonywane przez usługę kierowania środowisko uruchomieniowe języka wspólnego firmy działalnością czasu wykonywania.</span><span class="sxs-lookup"><span data-stu-id="4fba8-104">Interop marshaling is a run-time activity performed by the common language runtime's marshaling service.</span></span>  
  
 <span data-ttu-id="4fba8-105">Większość typów danych mają wspólne reprezentacje w pamięci zarządzane i niezarządzane.</span><span class="sxs-lookup"><span data-stu-id="4fba8-105">Most data types have common representations in both managed and unmanaged memory.</span></span> <span data-ttu-id="4fba8-106">Organizator międzyoperacyjnego obsługuje te typy dla Ciebie.</span><span class="sxs-lookup"><span data-stu-id="4fba8-106">The interop marshaler handles these types for you.</span></span> <span data-ttu-id="4fba8-107">Inne typy może być niejednoznaczna lub nie jest reprezentowana przez cały w pamięci zarządzanej.</span><span class="sxs-lookup"><span data-stu-id="4fba8-107">Other types can be ambiguous or not represented at all in managed memory.</span></span>  
  
 <span data-ttu-id="4fba8-108">Niejednoznaczne typ może mieć wielu reprezentacje niezarządzane, mapowane na jeden typ zarządzany lub Brak informacji o typie, takich jak rozmiar tablicy.</span><span class="sxs-lookup"><span data-stu-id="4fba8-108">An ambiguous type can have either multiple unmanaged representations that map to a single managed type, or missing type information, such as the size of an array.</span></span> <span data-ttu-id="4fba8-109">Niejednoznacznych typów organizatora udostępnia reprezentację domyślne i Reprezentacje alternatywne, w których istnieje wiele oświadczeń.</span><span class="sxs-lookup"><span data-stu-id="4fba8-109">For ambiguous types, the marshaler provides a default representation and alternative representations where multiple representations exist.</span></span> <span data-ttu-id="4fba8-110">Możesz podać jawne instrukcje organizatora, w jaki jest do organizowania niejednoznaczne typu.</span><span class="sxs-lookup"><span data-stu-id="4fba8-110">You can supply explicit instructions to the marshaler on how it is to marshal an ambiguous type.</span></span>  
  
 <span data-ttu-id="4fba8-111">Ten przegląd zawiera następujące sekcje:</span><span class="sxs-lookup"><span data-stu-id="4fba8-111">This overview contains the following sections:</span></span>  
  
-   [<span data-ttu-id="4fba8-112">Wywołanie platformy i modele międzyoperacyjnego modelu COM</span><span class="sxs-lookup"><span data-stu-id="4fba8-112">Platform Invoke and COM Interop Models</span></span>](#platform_invoke_and_com_interop_models)  
  
-   [<span data-ttu-id="4fba8-113">Kierowanie parametrów i Apartamentach COM</span><span class="sxs-lookup"><span data-stu-id="4fba8-113">Marshaling and COM Apartments</span></span>](#marshaling_and_com_apartments)  
  
-   [<span data-ttu-id="4fba8-114">Kierowanie wywołań zdalnych</span><span class="sxs-lookup"><span data-stu-id="4fba8-114">Marshaling Remote Calls</span></span>](#marshaling_remote_calls)  
  
-   [<span data-ttu-id="4fba8-115">Tematy pokrewne</span><span class="sxs-lookup"><span data-stu-id="4fba8-115">Related Topics</span></span>](#related_topics)  
  
-   [<span data-ttu-id="4fba8-116">Dokumentacja</span><span class="sxs-lookup"><span data-stu-id="4fba8-116">Reference</span></span>](#reference)  
  
<a name="platform_invoke_and_com_interop_models"></a>   
## <a name="platform-invoke-and-com-interop-models"></a><span data-ttu-id="4fba8-117">Wywołanie platformy i modele międzyoperacyjnego modelu COM</span><span class="sxs-lookup"><span data-stu-id="4fba8-117">Platform Invoke and COM Interop Models</span></span>  
 <span data-ttu-id="4fba8-118">Środowisko uruchomieniowe języka wspólnego udostępnia dwa mechanizmy współdziałanie z kodem niezarządzanym:</span><span class="sxs-lookup"><span data-stu-id="4fba8-118">The common language runtime provides two mechanisms for interoperating with unmanaged code:</span></span>  
  
-   <span data-ttu-id="4fba8-119">Wywołanie platformy, co pozwala kodu zarządzanego do wywołania funkcji wyeksportowanych z biblioteki niezarządzane.</span><span class="sxs-lookup"><span data-stu-id="4fba8-119">Platform invoke, which enables managed code to call functions exported from an unmanaged library.</span></span>  
  
-   <span data-ttu-id="4fba8-120">Współdziałanie z COM, który umożliwia kodu zarządzanego do interakcji z obiektami składnika modelu COM (Object) za pośrednictwem interfejsów.</span><span class="sxs-lookup"><span data-stu-id="4fba8-120">COM interop, which enables managed code to interact with Component Object Model (COM) objects through interfaces.</span></span>  
  
 <span data-ttu-id="4fba8-121">Wywołanie zarówno platformy i COM interop Użyj przekazywanie międzyoperacyjne dokładnie zmieniać argumenty metody wywołującego i wywoływany i z powrotem, jeśli to konieczne.</span><span class="sxs-lookup"><span data-stu-id="4fba8-121">Both platform invoke and COM interop use interop marshaling to accurately move method arguments between caller and callee and back, if required.</span></span> <span data-ttu-id="4fba8-122">Jak pokazano na poniższej ilustracji, wywołanie platformy przepływy wywołanie metody z kodu zarządzanego do kodu niezarządzanego i nigdy nie inny sposób, chyba że [funkcje wywołania zwrotnego](../../../docs/framework/interop/callback-functions.md) obejmuje.</span><span class="sxs-lookup"><span data-stu-id="4fba8-122">As the following illustration shows, a platform invoke method call flows from managed to unmanaged code and never the other way, except when [callback functions](../../../docs/framework/interop/callback-functions.md) are involved.</span></span> <span data-ttu-id="4fba8-123">Mimo że wywołanie platformy wywołania mogą przepływać tylko z kodu zarządzanego do kodu niezarządzanego, dane mogą przepływać w obu kierunkach jako parametrów wejściowych lub wyjściowych.</span><span class="sxs-lookup"><span data-stu-id="4fba8-123">Even though platform invoke calls can flow only from managed to unmanaged code, data can flow in both directions as input or output parameters.</span></span> <span data-ttu-id="4fba8-124">Wywołania metody międzyoperacyjnego COM może przepływać w obu kierunkach.</span><span class="sxs-lookup"><span data-stu-id="4fba8-124">COM interop method calls can flow in either direction.</span></span>  
  
 <span data-ttu-id="4fba8-125">![Wywołanie platformy](../../../docs/framework/interop/media/interopmarshaling.png "interopmarshaling")</span><span class="sxs-lookup"><span data-stu-id="4fba8-125">![Platform invoke](../../../docs/framework/interop/media/interopmarshaling.png "interopmarshaling")</span></span>  
<span data-ttu-id="4fba8-126">Wywołanie platformy i przepływu wywołania międzyoperacyjnego modelu COM</span><span class="sxs-lookup"><span data-stu-id="4fba8-126">Platform invoke and COM interop call flow</span></span>  
  
 <span data-ttu-id="4fba8-127">Na najniższym poziomie zarówno mechanizmów używać tego samego interop, organizowanie usługi; Jednak niektóre typy danych są obsługiwane wyłącznie przez współdziałanie z COM lub wywołanie platformy.</span><span class="sxs-lookup"><span data-stu-id="4fba8-127">At the lowest level, both mechanisms use the same interop marshaling service; however, certain data types are supported exclusively by COM interop or platform invoke.</span></span> <span data-ttu-id="4fba8-128">Aby uzyskać więcej informacji, zobacz [domyślne zachowanie Marshalingu](../../../docs/framework/interop/default-marshaling-behavior.md).</span><span class="sxs-lookup"><span data-stu-id="4fba8-128">For details, see [Default Marshaling Behavior](../../../docs/framework/interop/default-marshaling-behavior.md).</span></span>  
  
 [<span data-ttu-id="4fba8-129">Powrót do początku</span><span class="sxs-lookup"><span data-stu-id="4fba8-129">Back to top</span></span>](#top)  
  
<a name="marshaling_and_com_apartments"></a>   
## <a name="marshaling-and-com-apartments"></a><span data-ttu-id="4fba8-130">Kierowanie parametrów i Apartamentach COM</span><span class="sxs-lookup"><span data-stu-id="4fba8-130">Marshaling and COM Apartments</span></span>  
 <span data-ttu-id="4fba8-131">Organizator międzyoperacyjnego marshals danych między stercie środowiska uruchomieniowego języka wspólnego i niezarządzane stosu.</span><span class="sxs-lookup"><span data-stu-id="4fba8-131">The interop marshaler marshals data between the common language runtime heap and the unmanaged heap.</span></span> <span data-ttu-id="4fba8-132">Przekazywanie występuje, gdy obiekt wywołujący i wywoływanego nie może działać na tym samym wystąpieniu danych.</span><span class="sxs-lookup"><span data-stu-id="4fba8-132">Marshaling occurs whenever the caller and callee cannot operate on the same instance of data.</span></span> <span data-ttu-id="4fba8-133">Organizator międzyoperacyjnego umożliwia dla obiekt wywołujący i wywoływany wydaje się działających na tych samych danych, nawet jeśli ma swoje własne kopię danych.</span><span class="sxs-lookup"><span data-stu-id="4fba8-133">The interop marshaler makes it possible for the caller and callee to appear to be operating on the same data even if they have their own copy of the data.</span></span>  
  
 <span data-ttu-id="4fba8-134">COM ma również organizatora, który marshals danych między apartamentach COM lub różnych procesów COM.</span><span class="sxs-lookup"><span data-stu-id="4fba8-134">COM also has a marshaler that marshals data between COM apartments or different COM processes.</span></span> <span data-ttu-id="4fba8-135">Podczas wywoływania metody między zarządzanymi i niezarządzanymi kodu w tej samej apartamentu COM, organizator międzyoperacyjny jest tylko organizatora, związane.</span><span class="sxs-lookup"><span data-stu-id="4fba8-135">When calling between managed and unmanaged code within the same COM apartment, the interop marshaler is the only marshaler involved.</span></span> <span data-ttu-id="4fba8-136">Podczas wywoływania metody między kodu zarządzanego i kodu niezarządzanego innego apartamentu COM lub innego procesu, zarówno międzyoperacyjne organizatora i Organizator COM są wykorzystywane.</span><span class="sxs-lookup"><span data-stu-id="4fba8-136">When calling between managed code and unmanaged code in a different COM apartment or a different process, both the interop marshaler and the COM marshaler are involved.</span></span>  
  
### <a name="com-clients-and-managed-servers"></a><span data-ttu-id="4fba8-137">Klienci COM i serwerów zarządzanych</span><span class="sxs-lookup"><span data-stu-id="4fba8-137">COM Clients and Managed Servers</span></span>  
 <span data-ttu-id="4fba8-138">Wyeksportowane serwera zarządzanego z biblioteki typów zarejestrowany przez [Regasm.exe (narzędzie rejestracji zestawów)](../../../docs/framework/tools/regasm-exe-assembly-registration-tool.md) ma `ThreadingModel` wpis rejestru ustawioną `Both`.</span><span class="sxs-lookup"><span data-stu-id="4fba8-138">An exported managed server with a type library registered by the [Regasm.exe (Assembly Registration Tool)](../../../docs/framework/tools/regasm-exe-assembly-registration-tool.md) has a `ThreadingModel` registry entry set to `Both`.</span></span> <span data-ttu-id="4fba8-139">Ta wartość wskazuje, że serwer można aktywować jednowątkowego apartamentu (STA) lub wielowątkowe apartamentu (MTA).</span><span class="sxs-lookup"><span data-stu-id="4fba8-139">This value indicates that the server can be activated in a single-threaded apartment (STA) or a multithreaded apartment (MTA).</span></span> <span data-ttu-id="4fba8-140">Obiekt serwera jest tworzony w tym samym apartamencie jako swojego obiektu wywołującego, jak pokazano w poniższej tabeli.</span><span class="sxs-lookup"><span data-stu-id="4fba8-140">The server object is created in the same apartment as its caller, as shown in the following table.</span></span>  
  
|<span data-ttu-id="4fba8-141">Klient modelu COM</span><span class="sxs-lookup"><span data-stu-id="4fba8-141">COM client</span></span>|<span data-ttu-id="4fba8-142">Serwer .NET</span><span class="sxs-lookup"><span data-stu-id="4fba8-142">.NET server</span></span>|<span data-ttu-id="4fba8-143">Organizowanie wymagania</span><span class="sxs-lookup"><span data-stu-id="4fba8-143">Marshaling requirements</span></span>|  
|----------------|-----------------|-----------------------------|  
|<span data-ttu-id="4fba8-144">STA.</span><span class="sxs-lookup"><span data-stu-id="4fba8-144">STA</span></span>|<span data-ttu-id="4fba8-145">`Both`staje się pozostaje tryb komórek jednowątkowych</span><span class="sxs-lookup"><span data-stu-id="4fba8-145">`Both` becomes STA.</span></span>|<span data-ttu-id="4fba8-146">Przekazywanie tego samego typu apartment.</span><span class="sxs-lookup"><span data-stu-id="4fba8-146">Same-apartment marshaling.</span></span>|  
|<span data-ttu-id="4fba8-147">MTA</span><span class="sxs-lookup"><span data-stu-id="4fba8-147">MTA</span></span>|<span data-ttu-id="4fba8-148">`Both`staje się MTA.</span><span class="sxs-lookup"><span data-stu-id="4fba8-148">`Both` becomes MTA.</span></span>|<span data-ttu-id="4fba8-149">Przekazywanie tego samego typu apartment.</span><span class="sxs-lookup"><span data-stu-id="4fba8-149">Same-apartment marshaling.</span></span>|  
  
 <span data-ttu-id="4fba8-150">Ponieważ klienta i serwera znajdują się w tym samym apartamencie, interop automatycznie przekazywanie usługi obsługuje przekazywanie wszystkich danych.</span><span class="sxs-lookup"><span data-stu-id="4fba8-150">Because the client and server are in the same apartment, the interop marshaling service automatically handles all data marshaling.</span></span> <span data-ttu-id="4fba8-151">Na poniższej ilustracji przedstawiono funkcjonowania między zarządzanymi i niezarządzanymi stosów w ramach tego samego typu apartment styl modelu COM interop usług kierowania.</span><span class="sxs-lookup"><span data-stu-id="4fba8-151">The following illustration shows the interop marshaling service operating between managed and unmanaged heaps within the same COM-style apartment.</span></span>  
  
 <span data-ttu-id="4fba8-152">![Przekazywanie międzyoperacyjne](../../../docs/framework/interop/media/interopheap.gif "interopheap")</span><span class="sxs-lookup"><span data-stu-id="4fba8-152">![Interop marshaling](../../../docs/framework/interop/media/interopheap.gif "interopheap")</span></span>  
<span data-ttu-id="4fba8-153">Proces kierowania tego samego typu apartment</span><span class="sxs-lookup"><span data-stu-id="4fba8-153">Same-apartment marshaling process</span></span>  
  
 <span data-ttu-id="4fba8-154">Jeśli planujesz zarządzany serwer eksportu, należy pamiętać, określa, czy klient modelu COM typu apartment serwera.</span><span class="sxs-lookup"><span data-stu-id="4fba8-154">If you plan to export a managed server, be aware that the COM client determines the apartment of the server.</span></span> <span data-ttu-id="4fba8-155">Serwer zarządzany wywoływane przez klient modelu COM w MTA zainicjować musi zapewniać bezpieczeństwo wątków.</span><span class="sxs-lookup"><span data-stu-id="4fba8-155">A managed server called by a COM client initialized in an MTA must ensure thread safety.</span></span>  
  
### <a name="managed-clients-and-com-servers"></a><span data-ttu-id="4fba8-156">Zarządzanych klientów i serwerów COM</span><span class="sxs-lookup"><span data-stu-id="4fba8-156">Managed Clients and COM Servers</span></span>  
 <span data-ttu-id="4fba8-157">Ustawieniem domyślnym dla apartamentach zarządzanego klienta jest MTA; Typ aplikacji klienta .NET można jednak zmienić ustawienie domyślne.</span><span class="sxs-lookup"><span data-stu-id="4fba8-157">The default setting for managed client apartments is MTA; however, the application type of the .NET client can change the default setting.</span></span> <span data-ttu-id="4fba8-158">Na przykład [!INCLUDE[vbprvblong](../../../includes/vbprvblong-md.md)] ustawienia komórkowy klienta jest pozostaje tryb komórek jednowątkowych</span><span class="sxs-lookup"><span data-stu-id="4fba8-158">For example, a [!INCLUDE[vbprvblong](../../../includes/vbprvblong-md.md)] client apartment setting is STA.</span></span> <span data-ttu-id="4fba8-159">Można użyć <xref:System.STAThreadAttribute?displayProperty=nameWithType>, <xref:System.MTAThreadAttribute?displayProperty=nameWithType>, <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> właściwości, lub <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> właściwość, aby sprawdzić i zmienić ustawienia typu apartment klient zarządzany.</span><span class="sxs-lookup"><span data-stu-id="4fba8-159">You can use the <xref:System.STAThreadAttribute?displayProperty=nameWithType>, the <xref:System.MTAThreadAttribute?displayProperty=nameWithType>, the <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> property, or the <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> property to examine and change the apartment setting of a managed client.</span></span>  
  
 <span data-ttu-id="4fba8-160">Autor składnika ustawia koligacji wątku serwera COM.</span><span class="sxs-lookup"><span data-stu-id="4fba8-160">The author of the component sets the thread affinity of a COM server.</span></span> <span data-ttu-id="4fba8-161">W poniższej tabeli przedstawiono kombinacje ustawienia komórkowy .NET klientów i serwerów COM.</span><span class="sxs-lookup"><span data-stu-id="4fba8-161">The following table shows the combinations of apartment settings for .NET clients and COM servers.</span></span> <span data-ttu-id="4fba8-162">Pokazuje też, powstałe w ten sposób organizowanie wymagania dla kombinacji.</span><span class="sxs-lookup"><span data-stu-id="4fba8-162">It also shows the resulting marshaling requirements for the combinations.</span></span>  
  
|<span data-ttu-id="4fba8-163">Klient .NET</span><span class="sxs-lookup"><span data-stu-id="4fba8-163">.NET client</span></span>|<span data-ttu-id="4fba8-164">Serwer COM</span><span class="sxs-lookup"><span data-stu-id="4fba8-164">COM server</span></span>|<span data-ttu-id="4fba8-165">Organizowanie wymagania</span><span class="sxs-lookup"><span data-stu-id="4fba8-165">Marshaling requirements</span></span>|  
|-----------------|----------------|-----------------------------|  
|<span data-ttu-id="4fba8-166">MTA (ustawienie domyślne)</span><span class="sxs-lookup"><span data-stu-id="4fba8-166">MTA (default)</span></span>|<span data-ttu-id="4fba8-167">MTA</span><span class="sxs-lookup"><span data-stu-id="4fba8-167">MTA</span></span><br /><br /> <span data-ttu-id="4fba8-168">STA.</span><span class="sxs-lookup"><span data-stu-id="4fba8-168">STA</span></span>|<span data-ttu-id="4fba8-169">Przekazywanie międzyoperacyjne.</span><span class="sxs-lookup"><span data-stu-id="4fba8-169">Interop marshaling.</span></span><br /><br /> <span data-ttu-id="4fba8-170">I organizowanie COM Interop.</span><span class="sxs-lookup"><span data-stu-id="4fba8-170">Interop and COM marshaling.</span></span>|  
|<span data-ttu-id="4fba8-171">STA.</span><span class="sxs-lookup"><span data-stu-id="4fba8-171">STA</span></span>|<span data-ttu-id="4fba8-172">MTA</span><span class="sxs-lookup"><span data-stu-id="4fba8-172">MTA</span></span><br /><br /> <span data-ttu-id="4fba8-173">STA.</span><span class="sxs-lookup"><span data-stu-id="4fba8-173">STA</span></span>|<span data-ttu-id="4fba8-174">I organizowanie COM Interop.</span><span class="sxs-lookup"><span data-stu-id="4fba8-174">Interop and COM marshaling.</span></span><br /><br /> <span data-ttu-id="4fba8-175">Przekazywanie międzyoperacyjne.</span><span class="sxs-lookup"><span data-stu-id="4fba8-175">Interop marshaling.</span></span>|  
  
 <span data-ttu-id="4fba8-176">Gdy klientów zarządzanych i niezarządzanych serwera są tego samego typu apartment, interop organizowanie usługi obsługuje przekazywanie wszystkich danych.</span><span class="sxs-lookup"><span data-stu-id="4fba8-176">When a managed client and unmanaged server are in the same apartment, the interop marshaling service handles all data marshaling.</span></span> <span data-ttu-id="4fba8-177">Jednak jeśli klienta i serwera są inicjowane w różnych apartamentach, kierowanie modelu COM wymagany jest również.</span><span class="sxs-lookup"><span data-stu-id="4fba8-177">However, when client and server are initialized in different apartments, COM marshaling is also required.</span></span> <span data-ttu-id="4fba8-178">Na poniższej ilustracji przedstawiono elementy rozmowę między apartamentu.</span><span class="sxs-lookup"><span data-stu-id="4fba8-178">The following illustration shows the elements of a cross-apartment call.</span></span>  
  
 <span data-ttu-id="4fba8-179">![Organizowanie COM](../../../docs/framework/interop/media/singleprocessmultapt.gif "singleprocessmultapt")</span><span class="sxs-lookup"><span data-stu-id="4fba8-179">![COM marshaling](../../../docs/framework/interop/media/singleprocessmultapt.gif "singleprocessmultapt")</span></span>  
<span data-ttu-id="4fba8-180">Wywołanie typu apartment między między klientem .NET a obiektu modelu COM</span><span class="sxs-lookup"><span data-stu-id="4fba8-180">Cross-apartment call between a .NET client and COM object</span></span>  
  
 <span data-ttu-id="4fba8-181">Dla typu apartment między przekazywanie, należy wykonać następujące:</span><span class="sxs-lookup"><span data-stu-id="4fba8-181">For cross-apartment marshaling, you can do the following:</span></span>  
  
-   <span data-ttu-id="4fba8-182">Zaakceptuj obciążenie organizowanie między apartamentu, który jest widoczny tylko wtedy, gdy istnieje wiele wywołań granicy.</span><span class="sxs-lookup"><span data-stu-id="4fba8-182">Accept the overhead of the cross-apartment marshaling, which is noticeable only when there are many calls across the boundary.</span></span> <span data-ttu-id="4fba8-183">Należy zarejestrować biblioteki typów dla wywołań pomyślnie przekroczenia granic apartamentu składnika modelu COM.</span><span class="sxs-lookup"><span data-stu-id="4fba8-183">You must register the type library of the COM component for calls to successfully cross the apartment boundary.</span></span>  
  
-   <span data-ttu-id="4fba8-184">Zmiany głównego wątku przez ustawienie klienta wątku STA i MTA.</span><span class="sxs-lookup"><span data-stu-id="4fba8-184">Alter the main thread by setting the client thread to STA or MTA.</span></span> <span data-ttu-id="4fba8-185">Na przykład jeśli klient C# wywołuje wiele składników STA COM, można uniknąć apartamentu między przekazywanie przez ustawienie pozostaje tryb komórek jednowątkowych wątku głównego</span><span class="sxs-lookup"><span data-stu-id="4fba8-185">For example, if your C# client calls many STA COM components, you can avoid cross-apartment marshaling by setting the main thread to STA.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="4fba8-186">Po ustawieniu wątek klienta C# STA wywołania składników MTA COM będzie wymagać przekazywanie typu apartment między.</span><span class="sxs-lookup"><span data-stu-id="4fba8-186">Once the thread of a C# client is set to STA, calls to MTA COM components will require cross-apartment marshaling.</span></span>  
  
 <span data-ttu-id="4fba8-187">Aby uzyskać instrukcje dotyczące wybierania jawnie z modelem typu apartment, zobacz [zarządzane i niezarządzane wątkowość](http://msdn.microsoft.com/en-us/db425c20-4b2f-4433-bf96-76071c7881e5).</span><span class="sxs-lookup"><span data-stu-id="4fba8-187">For instructions on explicitly selecting an apartment model, see [Managed and Unmanaged Threading](http://msdn.microsoft.com/en-us/db425c20-4b2f-4433-bf96-76071c7881e5).</span></span>  
  
 [<span data-ttu-id="4fba8-188">Powrót do początku</span><span class="sxs-lookup"><span data-stu-id="4fba8-188">Back to top</span></span>](#top)  
  
<a name="marshaling_remote_calls"></a>   
## <a name="marshaling-remote-calls"></a><span data-ttu-id="4fba8-189">Kierowanie wywołań zdalnych</span><span class="sxs-lookup"><span data-stu-id="4fba8-189">Marshaling Remote Calls</span></span>  
 <span data-ttu-id="4fba8-190">Podobnie jak w przypadku typu apartment między przekazywanie, organizowanie COM uczestniczy w każdym wywołaniu między zarządzanymi i niezarządzanymi kod zawsze, gdy obiekty znajdują się w osobnych procesach.</span><span class="sxs-lookup"><span data-stu-id="4fba8-190">As with cross-apartment marshaling, COM marshaling is involved in each call between managed and unmanaged code whenever the objects reside in separate processes.</span></span> <span data-ttu-id="4fba8-191">Na przykład:</span><span class="sxs-lookup"><span data-stu-id="4fba8-191">For example:</span></span>  
  
-   <span data-ttu-id="4fba8-192">Klient modelu COM, który wywołuje serwer zarządzany na zdalnym hoście używa rozproszonych (DCOM).</span><span class="sxs-lookup"><span data-stu-id="4fba8-192">A COM client that invokes a managed server on a remote host uses distributed COM (DCOM).</span></span>  
  
-   <span data-ttu-id="4fba8-193">Klient zarządzany wywołująca serwera COM na zdalnym hoście używa modelu DCOM.</span><span class="sxs-lookup"><span data-stu-id="4fba8-193">A managed client that invokes a COM server on a remote host uses DCOM.</span></span>  
  
 <span data-ttu-id="4fba8-194">Na poniższej ilustracji pokazano, jak międzyoperacyjnego organizowanie i organizowanie COM Podaj kanały komunikacyjne bariery procesu i hosta.</span><span class="sxs-lookup"><span data-stu-id="4fba8-194">The following illustration shows how interop marshaling and COM marshaling provide communications channels across process and host boundaries.</span></span>  
  
 <span data-ttu-id="4fba8-195">![Organizowanie COM](../../../docs/framework/interop/media/interophost.gif "interophost")</span><span class="sxs-lookup"><span data-stu-id="4fba8-195">![COM marshaling](../../../docs/framework/interop/media/interophost.gif "interophost")</span></span>  
<span data-ttu-id="4fba8-196">Organizowanie międzyprocesowa</span><span class="sxs-lookup"><span data-stu-id="4fba8-196">Cross-process marshaling</span></span>  
  
### <a name="preserving-identity"></a><span data-ttu-id="4fba8-197">Zachowywanie tożsamości</span><span class="sxs-lookup"><span data-stu-id="4fba8-197">Preserving Identity</span></span>  
 <span data-ttu-id="4fba8-198">Środowisko uruchomieniowe języka wspólnego zachowuje tożsamość odwołania zarządzane i niezarządzane.</span><span class="sxs-lookup"><span data-stu-id="4fba8-198">The common language runtime preserves the identity of managed and unmanaged references.</span></span> <span data-ttu-id="4fba8-199">Na poniższej ilustracji przedstawiono przepływ bezpośrednie odwołania niezarządzane (górnym wierszu) i bezpośredniego odwołania zarządzane (wiersz w dół) poza granicami procesu i hosta.</span><span class="sxs-lookup"><span data-stu-id="4fba8-199">The following illustration shows the flow of direct unmanaged references (top row) and direct managed references (bottom row) across process and host boundaries.</span></span>  
  
 <span data-ttu-id="4fba8-200">![Wywoływana otoka COM i wywoływana otoka środowiska uruchomieniowego](../../../docs/framework/interop/media/interopdirectref.gif "interopdirectref")</span><span class="sxs-lookup"><span data-stu-id="4fba8-200">![COM callable wrapper and runtime callable wrapper](../../../docs/framework/interop/media/interopdirectref.gif "interopdirectref")</span></span>  
<span data-ttu-id="4fba8-201">Odwołanie za pośrednictwem procesu i hosta</span><span class="sxs-lookup"><span data-stu-id="4fba8-201">Reference passing across process and host boundaries</span></span>  
  
 <span data-ttu-id="4fba8-202">Na tej ilustracji:</span><span class="sxs-lookup"><span data-stu-id="4fba8-202">In this illustration:</span></span>  
  
-   <span data-ttu-id="4fba8-203">Klient niezarządzany pobiera odwołanie do obiektu modelu COM z obiektu zarządzanego, który pobiera to odwołanie z hosta zdalnego.</span><span class="sxs-lookup"><span data-stu-id="4fba8-203">An unmanaged client gets a reference to a COM object from a managed object that gets this reference from a remote host.</span></span> <span data-ttu-id="4fba8-204">Mechanizm komunikacji zdalnej jest modelu DCOM.</span><span class="sxs-lookup"><span data-stu-id="4fba8-204">The remoting mechanism is DCOM.</span></span>  
  
-   <span data-ttu-id="4fba8-205">Klient zarządzany pobiera odwołanie do zarządzanego obiektu z obiektu COM, który pobiera to odwołanie z hosta zdalnego.</span><span class="sxs-lookup"><span data-stu-id="4fba8-205">A managed client gets a reference to a managed object from a COM object that gets this reference from a remote host.</span></span> <span data-ttu-id="4fba8-206">Mechanizm komunikacji zdalnej jest modelu DCOM.</span><span class="sxs-lookup"><span data-stu-id="4fba8-206">The remoting mechanism is DCOM.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="4fba8-207">Musi być zarejestrowana wyeksportowanej biblioteki typów serwera zarządzanego.</span><span class="sxs-lookup"><span data-stu-id="4fba8-207">The exported type library of the managed server must be registered.</span></span>  
  
 <span data-ttu-id="4fba8-208">Liczba granic procesów między wywołującego i wywoływany nie ma znaczenia; tym samym bezpośrednie odwołanie do występuje wywołań w trakcie i poza procesem.</span><span class="sxs-lookup"><span data-stu-id="4fba8-208">The number of process boundaries between caller and callee is irrelevant; the same direct referencing occurs for in-process and out-of-process calls.</span></span>  
  
### <a name="managed-remoting"></a><span data-ttu-id="4fba8-209">Zarządzane usługi zdalne</span><span class="sxs-lookup"><span data-stu-id="4fba8-209">Managed Remoting</span></span>  
 <span data-ttu-id="4fba8-210">Środowisko uruchomieniowe są także zarządzane remoting, którym można ustanowić kanał komunikacji między obiektami zarządzanymi granicami procesu i hosta.</span><span class="sxs-lookup"><span data-stu-id="4fba8-210">The runtime also provides managed remoting, which you can use to establish a communications channel between managed objects across process and host boundaries.</span></span> <span data-ttu-id="4fba8-211">Zarządzanych usług zdalnych może obsłużyć zapory między składnikami komunikacji, jak przedstawiono na poniższej ilustracji.</span><span class="sxs-lookup"><span data-stu-id="4fba8-211">Managed remoting can accommodate a firewall between the communicating components, as the following illustration shows.</span></span>  
  
 <span data-ttu-id="4fba8-212">![Protokół SOAP lub TcpChannel](../../../docs/framework/interop/media/interopremotesoap.gif "interopremotesoap")</span><span class="sxs-lookup"><span data-stu-id="4fba8-212">![SOAP or TcpChannel](../../../docs/framework/interop/media/interopremotesoap.gif "interopremotesoap")</span></span>  
<span data-ttu-id="4fba8-213">Zdalne wywołania przez zapory przy użyciu protokołu SOAP lub klasy TcpChannel</span><span class="sxs-lookup"><span data-stu-id="4fba8-213">Remote calls across firewalls using SOAP or the TcpChannel class</span></span>  
  
 <span data-ttu-id="4fba8-214">Niektóre połączenia niezarządzane można channeled za pośrednictwem protokołu SOAP, takie jak wywołania między [obsługiwanych składników](http://msdn.microsoft.com/en-us/f109ee24-81ad-4d99-9892-51ac6f34978c) i modelu COM.</span><span class="sxs-lookup"><span data-stu-id="4fba8-214">Some unmanaged calls can be channeled through SOAP, such as the calls between [serviced components](http://msdn.microsoft.com/en-us/f109ee24-81ad-4d99-9892-51ac6f34978c) and COM.</span></span>  
  
 [<span data-ttu-id="4fba8-215">Powrót do początku</span><span class="sxs-lookup"><span data-stu-id="4fba8-215">Back to top</span></span>](#top)  
  
<a name="related_topics"></a>   
## <a name="related-topics"></a><span data-ttu-id="4fba8-216">Tematy pokrewne</span><span class="sxs-lookup"><span data-stu-id="4fba8-216">Related Topics</span></span>  
  
|<span data-ttu-id="4fba8-217">Tytuł</span><span class="sxs-lookup"><span data-stu-id="4fba8-217">Title</span></span>|<span data-ttu-id="4fba8-218">Opis</span><span class="sxs-lookup"><span data-stu-id="4fba8-218">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="4fba8-219">Domyślne zachowanie marshalingu</span><span class="sxs-lookup"><span data-stu-id="4fba8-219">Default Marshaling Behavior</span></span>](../../../docs/framework/interop/default-marshaling-behavior.md)|<span data-ttu-id="4fba8-220">Opisuje reguły, które usługa kierowania międzyoperacyjnego używa do organizowania danych.</span><span class="sxs-lookup"><span data-stu-id="4fba8-220">Describes the rules that the interop marshaling service uses to marshal data.</span></span>|  
|[<span data-ttu-id="4fba8-221">Marshaling danych w wywołaniu platformy</span><span class="sxs-lookup"><span data-stu-id="4fba8-221">Marshaling Data with Platform Invoke</span></span>](../../../docs/framework/interop/marshaling-data-with-platform-invoke.md)|<span data-ttu-id="4fba8-222">Opisuje sposób deklarowanie parametrów metod i przekazywanie argumentów do funkcji wyeksportowane przez niezarządzanych bibliotek.</span><span class="sxs-lookup"><span data-stu-id="4fba8-222">Describes how to declare method parameters and pass arguments to functions exported by unmanaged libraries.</span></span>|  
|[<span data-ttu-id="4fba8-223">Marshaling danych za pomocą modelu COM</span><span class="sxs-lookup"><span data-stu-id="4fba8-223">Marshaling Data with COM Interop</span></span>](../../../docs/framework/interop/marshaling-data-with-com-interop.md)|<span data-ttu-id="4fba8-224">Opisuje sposób dostosowywania otoki COM, aby zmienić zachowanie marshalingu.</span><span class="sxs-lookup"><span data-stu-id="4fba8-224">Describes how to customize COM wrappers to alter marshaling behavior.</span></span>|  
|[<span data-ttu-id="4fba8-225">Instrukcje: Migrowanie zarządzanego kodu DCOM do WCF</span><span class="sxs-lookup"><span data-stu-id="4fba8-225">How to: Migrate Managed-Code DCOM to WCF</span></span>](../../../docs/framework/interop/how-to-migrate-managed-code-dcom-to-wcf.md)|<span data-ttu-id="4fba8-226">W tym artykule opisano sposób migracji z modelu DCOM do WCF.</span><span class="sxs-lookup"><span data-stu-id="4fba8-226">Describes how to migrate from DCOM to WCF.</span></span>|  
|[<span data-ttu-id="4fba8-227">Instrukcje: Mapowanie wyników HRESULT i wyjątków</span><span class="sxs-lookup"><span data-stu-id="4fba8-227">How to: Map HRESULTs and Exceptions</span></span>](../../../docs/framework/interop/how-to-map-hresults-and-exceptions.md)|<span data-ttu-id="4fba8-228">Opisuje sposób odwzorowywania niestandardowymi wyjątkami wyników HRESULT i zapewnia pełną mapowania z każdego HRESULT do jej klasy można porównywać pod względem wyjątek w programie .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="4fba8-228">Describes how to map custom exceptions to HRESULTs and provides the complete mapping from each HRESULT to its comparable exception class in the .NET Framework.</span></span>|  
|[<span data-ttu-id="4fba8-229">Współdziałanie za pomocą typów ogólnych</span><span class="sxs-lookup"><span data-stu-id="4fba8-229">Interoperating Using Generic Types</span></span>](http://msdn.microsoft.com/en-us/26b88e03-085b-4b53-94ba-a5a9c709ce58)|<span data-ttu-id="4fba8-230">Opisuje akcje, które są obsługiwane w przypadku współdziałania COM za pomocą typów ogólnych.</span><span class="sxs-lookup"><span data-stu-id="4fba8-230">Describes which actions are supported when using generic types for COM interoperability.</span></span>|  
|[<span data-ttu-id="4fba8-231">Współdziałanie z kodem niezarządzanym</span><span class="sxs-lookup"><span data-stu-id="4fba8-231">Interoperating with Unmanaged Code</span></span>](../../../docs/framework/interop/index.md)|<span data-ttu-id="4fba8-232">Opisuje współdziałanie usług świadczonych przez środowisko uruchomieniowe języka wspólnego.</span><span class="sxs-lookup"><span data-stu-id="4fba8-232">Describes interoperability services provided by the common language runtime.</span></span>|  
|[<span data-ttu-id="4fba8-233">Współdziałanie COM zaawansowane</span><span class="sxs-lookup"><span data-stu-id="4fba8-233">Advanced COM Interoperability</span></span>](http://msdn.microsoft.com/en-us/3ada36e5-2390-4d70-b490-6ad8de92f2fb)|<span data-ttu-id="4fba8-234">Zawiera łącza do dodatkowych informacji o włączenie składniki modelu COM aplikacji .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="4fba8-234">Provides links to more information about incorporating COM components into your .NET Framework application.</span></span>|  
|[<span data-ttu-id="4fba8-235">Zagadnienia dotyczące projektowania dla współdziałanie</span><span class="sxs-lookup"><span data-stu-id="4fba8-235">Design Considerations for Interoperation</span></span>](http://msdn.microsoft.com/en-us/b59637f6-fe35-40d6-ae72-901e7a707689)|<span data-ttu-id="4fba8-236">Porady dotyczące pisania zintegrowane składników COM.</span><span class="sxs-lookup"><span data-stu-id="4fba8-236">Provides tips for writing integrated COM components.</span></span>|  
  
 [<span data-ttu-id="4fba8-237">Powrót do początku</span><span class="sxs-lookup"><span data-stu-id="4fba8-237">Back to top</span></span>](#top)  
  
<a name="reference"></a>   
## <a name="reference"></a><span data-ttu-id="4fba8-238">Tematy pomocy</span><span class="sxs-lookup"><span data-stu-id="4fba8-238">Reference</span></span>  
 <xref:System.Runtime.InteropServices?displayProperty=nameWithType>  
  
 [<span data-ttu-id="4fba8-239">Powrót do początku</span><span class="sxs-lookup"><span data-stu-id="4fba8-239">Back to top</span></span>](#top)
