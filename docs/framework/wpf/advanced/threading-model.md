---
title: "Model wątkowości"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-wpf
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- text on buttons [WPF], updating
- message processing [WPF], nested
- blocking operations [WPF]
- Common Language Runtime (CLR), locking mechanism
- locking mechanism of Common Language Runtime (CLR)
- threading model [WPF]
- Word [WPF], spelling checking
- button text [WPF], updating
- spelling checking in Word [WPF]
- asynchronous behavior [WPF], exposing
- nested message processing [WPF]
- reentrancy [WPF]
ms.assetid: 02d8fd00-8d7c-4604-874c-58e40786770b
caps.latest.revision: "33"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: f598cecef2d0994692f197df09e9befc39a58723
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 12/22/2017
---
# <a name="threading-model"></a><span data-ttu-id="dfbdf-102">Model wątkowości</span><span class="sxs-lookup"><span data-stu-id="dfbdf-102">Threading Model</span></span>
[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)]<span data-ttu-id="dfbdf-103">Służy do zapisywania deweloperzy trudności z wątków.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-103"> is designed to save developers from the difficulties of threading.</span></span> <span data-ttu-id="dfbdf-104">W rezultacie, większość [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] programiści nie muszą zapisu interfejs, który korzysta z więcej niż jeden wątek.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-104">As a result, the majority of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] developers won't have to write an interface that uses more than one thread.</span></span> <span data-ttu-id="dfbdf-105">Ponieważ programy wielowątkowe są złożone i trudne do debugowania, ich należy unikać gdy istnieją jednowątkowe rozwiązania.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-105">Because multithreaded programs are complex and difficult to debug, they should be avoided when single-threaded solutions exist.</span></span>  
  
 <span data-ttu-id="dfbdf-106">Niezależnie od tego, jak również zaprojektowana, jednak nie [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] framework kiedykolwiek będą mogli stanowią rozwiązanie jednowątkowe dla każdego rodzaju problem.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-106">No matter how well architected, however, no [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] framework will ever be able to provide a single-threaded solution for every sort of problem.</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="dfbdf-107">pochodzi zamknięcia, ale nadal istnieją sytuacje, w którym wiele wątków poprawy [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] wydajności czasu odpowiedzi lub aplikacji.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-107"> comes close, but there are still situations where multiple threads improve [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] responsiveness or application performance.</span></span> <span data-ttu-id="dfbdf-108">Po omówieniu niektórych materiałów tła, w tym dokumencie Eksploruje niektóre z tych sytuacji i stwierdza, z omówieniem niektórych szczegółów niskiego poziomu.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-108">After discussing some background material, this paper explores some of these situations and then concludes with a discussion of some lower-level details.</span></span>  
  

  
> [!NOTE]
>  <span data-ttu-id="dfbdf-109">W tym temacie omówiono wątkowość przy użyciu <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> metodę wywołania asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-109">This topic discusses threading by using the <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> method for asynchronous calls.</span></span> <span data-ttu-id="dfbdf-110">Asynchroniczne wywołania można również ustawić, wywołując <xref:System.Windows.Threading.Dispatcher.InvokeAsync%2A> metodę, która zająć <xref:System.Action> lub <xref:System.Func%601> jako parametr.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-110">You can also make asynchronous calls by calling the <xref:System.Windows.Threading.Dispatcher.InvokeAsync%2A> method, which take an <xref:System.Action> or <xref:System.Func%601> as a parameter.</span></span>  <span data-ttu-id="dfbdf-111"><xref:System.Windows.Threading.Dispatcher.InvokeAsync%2A> Metoda zwraca <xref:System.Windows.Threading.DispatcherOperation> lub <xref:System.Windows.Threading.DispatcherOperation%601>, który ma <xref:System.Windows.Threading.DispatcherOperation.Task%2A> właściwości.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-111">The <xref:System.Windows.Threading.Dispatcher.InvokeAsync%2A> method returns a <xref:System.Windows.Threading.DispatcherOperation> or <xref:System.Windows.Threading.DispatcherOperation%601>, which has a <xref:System.Windows.Threading.DispatcherOperation.Task%2A> property.</span></span> <span data-ttu-id="dfbdf-112">Można użyć `await` — słowo kluczowe przy użyciu jednej <xref:System.Windows.Threading.DispatcherOperation> lub skojarzony <xref:System.Threading.Tasks.Task>.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-112">You can use the `await` keyword with either the <xref:System.Windows.Threading.DispatcherOperation> or the associated <xref:System.Threading.Tasks.Task>.</span></span> <span data-ttu-id="dfbdf-113">Jeśli musisz poczekać synchronicznie <xref:System.Threading.Tasks.Task> zwróconego przez <xref:System.Windows.Threading.DispatcherOperation> lub <xref:System.Windows.Threading.DispatcherOperation%601>, wywołaj <xref:System.Windows.Threading.TaskExtensions.DispatcherOperationWait%2A> — metoda rozszerzenia.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-113">If you need to wait synchronously for the <xref:System.Threading.Tasks.Task> that is returned by a <xref:System.Windows.Threading.DispatcherOperation> or <xref:System.Windows.Threading.DispatcherOperation%601>, call the <xref:System.Windows.Threading.TaskExtensions.DispatcherOperationWait%2A> extension method.</span></span>  <span data-ttu-id="dfbdf-114">Wywoływanie <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> będzie doprowadzić do zakleszczenia.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-114">Calling <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> will result in a deadlock.</span></span> <span data-ttu-id="dfbdf-115">Aby uzyskać więcej informacji o korzystaniu z <xref:System.Threading.Tasks.Task> do wykonywania asynchronicznych operacji, zobacz równoległość zadań.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-115">For more information about using a <xref:System.Threading.Tasks.Task> to perform asynchronous operations, see Task Parallelism.</span></span>  <span data-ttu-id="dfbdf-116"><xref:System.Windows.Threading.Dispatcher.Invoke%2A> Metoda ma również przeciążeń, które przyjmują <xref:System.Action> lub <xref:System.Func%601> jako parametr.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-116">The <xref:System.Windows.Threading.Dispatcher.Invoke%2A> method also has overloads that take an <xref:System.Action> or <xref:System.Func%601> as a parameter.</span></span>  <span data-ttu-id="dfbdf-117">Można użyć <xref:System.Windows.Threading.Dispatcher.Invoke%2A> wywołuje metodę, aby wprowadzić synchroniczne przez przekazywanie delegata, <xref:System.Action> lub <xref:System.Func%601>.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-117">You can use the <xref:System.Windows.Threading.Dispatcher.Invoke%2A> method to make synchronous calls by passing in a delegate, <xref:System.Action> or <xref:System.Func%601>.</span></span>  
  
<a name="threading_overview"></a>   
## <a name="overview-and-the-dispatcher"></a><span data-ttu-id="dfbdf-118">Omówienie i Dyspozytor</span><span class="sxs-lookup"><span data-stu-id="dfbdf-118">Overview and the Dispatcher</span></span>  
 <span data-ttu-id="dfbdf-119">Zazwyczaj [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] aplikacje są uruchamiane z dwoma wątkami: jeden do obsługi renderowania i drugi dla zarządzania [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span><span class="sxs-lookup"><span data-stu-id="dfbdf-119">Typically, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] applications start with two threads: one for handling rendering and another for managing the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span></span> <span data-ttu-id="dfbdf-120">Wątek renderowania skutecznie uruchamia ukryte w tle podczas [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku odbiera dane wejściowe, obsługuje zdarzenia rysują ekranu i uruchamia kod aplikacji.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-120">The rendering thread effectively runs hidden in the background while the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread receives input, handles events, paints the screen, and runs application code.</span></span> <span data-ttu-id="dfbdf-121">Większość aplikacji używa pojedynczego [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku, chociaż w niektórych sytuacjach warto użyć kilku.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-121">Most applications use a single [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread, although in some situations it is best to use several.</span></span> <span data-ttu-id="dfbdf-122">Omówiono to przykład później.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-122">We’ll discuss this with an example later.</span></span>  
  
 <span data-ttu-id="dfbdf-123">[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Kolejek wątku roboczego elementy wewnątrz obiektu o nazwie <xref:System.Windows.Threading.Dispatcher>.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-123">The [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread queues work items inside an object called a <xref:System.Windows.Threading.Dispatcher>.</span></span> <span data-ttu-id="dfbdf-124"><xref:System.Windows.Threading.Dispatcher> Wybiera elementów roboczych w pierwszej kolejności i uruchamia do ukończenia każdej z nich.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-124">The <xref:System.Windows.Threading.Dispatcher> selects work items on a priority basis and runs each one to completion.</span></span>  <span data-ttu-id="dfbdf-125">Każdy [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku musi mieć co najmniej jeden <xref:System.Windows.Threading.Dispatcher>i każdego <xref:System.Windows.Threading.Dispatcher> można wykonać elementów roboczych w dokładnie jeden wątek.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-125">Every [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread must have at least one <xref:System.Windows.Threading.Dispatcher>, and each <xref:System.Windows.Threading.Dispatcher> can execute work items in exactly one thread.</span></span>  
  
 <span data-ttu-id="dfbdf-126">Do tworzenia aplikacji reakcji i przyjazny dla użytkownika jest aby zmaksymalizować <xref:System.Windows.Threading.Dispatcher> przepływność przy zachowaniu małych elementów roboczych.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-126">The trick to building responsive, user-friendly applications is to maximize the <xref:System.Windows.Threading.Dispatcher> throughput by keeping the work items small.</span></span> <span data-ttu-id="dfbdf-127">Nigdy nie elementów w ten sposób uzyskać starych oczekuje w <xref:System.Windows.Threading.Dispatcher> kolejki oczekiwanie na przetwarzanie.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-127">This way items never get stale sitting in the <xref:System.Windows.Threading.Dispatcher> queue waiting for processing.</span></span> <span data-ttu-id="dfbdf-128">Wszelkie odczytywane opóźnienia między dane wejściowe i odpowiedzi może frustrować użytkownika.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-128">Any perceivable delay between input and response can frustrate a user.</span></span>  
  
 <span data-ttu-id="dfbdf-129">Jak to [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] aplikacji powinien obsługiwać operacje duży?</span><span class="sxs-lookup"><span data-stu-id="dfbdf-129">How then are [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] applications supposed to handle big operations?</span></span> <span data-ttu-id="dfbdf-130">Co zrobić, jeśli kod obejmuje dużą obliczeń lub wymaga kwerendy bazy danych na niektórych serwera zdalnego?</span><span class="sxs-lookup"><span data-stu-id="dfbdf-130">What if your code involves a large calculation or needs to query a database on some remote server?</span></span> <span data-ttu-id="dfbdf-131">Zazwyczaj odpowiedzi jest duży operację w oddzielnym wątku, pozostawiając [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] zająć się zazwyczaj do elementów w wątku <xref:System.Windows.Threading.Dispatcher> kolejki.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-131">Usually, the answer is to handle the big operation in a separate thread, leaving the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread free to tend to items in the <xref:System.Windows.Threading.Dispatcher> queue.</span></span> <span data-ttu-id="dfbdf-132">Po zakończeniu operacji duży może raportować jego wynik do [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku do wyświetlenia.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-132">When the big operation is complete, it can report its result back to the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread for display.</span></span>  
  
 <span data-ttu-id="dfbdf-133">W przeszłości [!INCLUDE[TLA#tla_mswin](../../../../includes/tlasharptla-mswin-md.md)] umożliwia [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] elementów, aby były dostępne tylko dla wątku, który je utworzył.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-133">Historically, [!INCLUDE[TLA#tla_mswin](../../../../includes/tlasharptla-mswin-md.md)] allows [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] elements to be accessed only by the thread that created them.</span></span> <span data-ttu-id="dfbdf-134">Oznacza to, że wątku w tle odpowiedzialnym za niektóre długotrwałe zadanie nie można zaktualizować pola tekstowego po zakończeniu.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-134">This means that a background thread in charge of some long-running task cannot update a text box when it is finished.</span></span> [!INCLUDE[TLA#tla_mswin](../../../../includes/tlasharptla-mswin-md.md)]<span data-ttu-id="dfbdf-135">Dzieje się tak, aby zapewnić integralność [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] składników.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-135"> does this to ensure the integrity of [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] components.</span></span> <span data-ttu-id="dfbdf-136">Pole listy może wyglądać dziwne, jeśli jego zawartość zostały zaktualizowane przez wątek w tle podczas rysowania.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-136">A list box could look strange if its contents were updated by a background thread during painting.</span></span>  
  
 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="dfbdf-137">zawiera wbudowane wzajemne wykluczenie mechanizm, który wymusza koordynacja.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-137"> has a built-in mutual exclusion mechanism that enforces this coordination.</span></span> <span data-ttu-id="dfbdf-138">Większość klas w [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] pochodzi od <xref:System.Windows.Threading.DispatcherObject>.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-138">Most classes in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] derive from <xref:System.Windows.Threading.DispatcherObject>.</span></span> <span data-ttu-id="dfbdf-139">W konstrukcji <xref:System.Windows.Threading.DispatcherObject> zawiera odwołanie do <xref:System.Windows.Threading.Dispatcher> połączone z aktualnie uruchomiony.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-139">At construction, a <xref:System.Windows.Threading.DispatcherObject> stores a reference to the <xref:System.Windows.Threading.Dispatcher> linked to the currently running thread.</span></span> <span data-ttu-id="dfbdf-140">W efekcie <xref:System.Windows.Threading.DispatcherObject> kojarzy z wątku, który go utworzył.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-140">In effect, the <xref:System.Windows.Threading.DispatcherObject> associates with the thread that creates it.</span></span> <span data-ttu-id="dfbdf-141">Podczas wykonywania programu <xref:System.Windows.Threading.DispatcherObject> można wywołać jej publicznego <xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-141">During program execution, a <xref:System.Windows.Threading.DispatcherObject> can call its public <xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A> method.</span></span> <span data-ttu-id="dfbdf-142"><xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A>sprawdza, czy <xref:System.Windows.Threading.Dispatcher> skojarzone z bieżącym wątku i porównuje go do <xref:System.Windows.Threading.Dispatcher> odwołanie podczas konstruowania przechowywane.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-142"><xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A> examines the <xref:System.Windows.Threading.Dispatcher> associated with the current thread and compares it to the <xref:System.Windows.Threading.Dispatcher> reference stored during construction.</span></span> <span data-ttu-id="dfbdf-143">Jeśli nie są zgodne, <xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A> zgłasza wyjątek.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-143">If they don’t match, <xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A> throws an exception.</span></span> <span data-ttu-id="dfbdf-144"><xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A>jest przeznaczona do wywoływania na początku każdej metody należących do <xref:System.Windows.Threading.DispatcherObject>.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-144"><xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A> is intended to be called at the beginning of every method belonging to a <xref:System.Windows.Threading.DispatcherObject>.</span></span>  
  
 <span data-ttu-id="dfbdf-145">Jeśli tylko jeden wątek można zmodyfikować [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)], wątki w tle interakcji z użytkownikiem?</span><span class="sxs-lookup"><span data-stu-id="dfbdf-145">If only one thread can modify the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)], how do background threads interact with the user?</span></span> <span data-ttu-id="dfbdf-146">Poproś wątku w tle [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku do wykonania operacji w jej imieniu.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-146">A background thread can ask the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread to perform an operation on its behalf.</span></span> <span data-ttu-id="dfbdf-147">Robi to poprzez zarejestrowanie elementu roboczego z <xref:System.Windows.Threading.Dispatcher> z [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-147">It does this by registering a work item with the <xref:System.Windows.Threading.Dispatcher> of the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="dfbdf-148"><xref:System.Windows.Threading.Dispatcher> Klasy udostępnia dwie metody rejestrowania elementów roboczych: <xref:System.Windows.Threading.Dispatcher.Invoke%2A> i <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A>.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-148">The <xref:System.Windows.Threading.Dispatcher> class provides two methods for registering work items: <xref:System.Windows.Threading.Dispatcher.Invoke%2A> and <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A>.</span></span> <span data-ttu-id="dfbdf-149">Obie metody zaplanować delegata do wykonania.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-149">Both methods schedule a delegate for execution.</span></span> <span data-ttu-id="dfbdf-150"><xref:System.Windows.Threading.Dispatcher.Invoke%2A>to wywołanie synchroniczne — to znaczy nie zwraca do [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku rzeczywiście ukończeniem wykonywania delegata.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-150"><xref:System.Windows.Threading.Dispatcher.Invoke%2A> is a synchronous call – that is, it doesn’t return until the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread actually finishes executing the delegate.</span></span> <span data-ttu-id="dfbdf-151"><xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A>jest asynchroniczne i zwraca natychmiast.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-151"><xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> is asynchronous and returns immediately.</span></span>  
  
 <span data-ttu-id="dfbdf-152"><xref:System.Windows.Threading.Dispatcher> Porządkuje elementy w swojej kolejki według priorytetu.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-152">The <xref:System.Windows.Threading.Dispatcher> orders the elements in its queue by priority.</span></span> <span data-ttu-id="dfbdf-153">Istnieją dziesięć poziomy, które można określić podczas dodawania elementu <xref:System.Windows.Threading.Dispatcher> kolejki.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-153">There are ten levels that may be specified when adding an element to the <xref:System.Windows.Threading.Dispatcher> queue.</span></span> <span data-ttu-id="dfbdf-154">Priorytety te są obsługiwane w <xref:System.Windows.Threading.DispatcherPriority> wyliczenia.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-154">These priorities are maintained in the <xref:System.Windows.Threading.DispatcherPriority> enumeration.</span></span> <span data-ttu-id="dfbdf-155">Szczegółowe informacje na temat <xref:System.Windows.Threading.DispatcherPriority> poziomy znajdują się w [!INCLUDE[TLA2#tla_winfxsdk](../../../../includes/tla2sharptla-winfxsdk-md.md)] dokumentacji.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-155">Detailed information about <xref:System.Windows.Threading.DispatcherPriority> levels can be found in the [!INCLUDE[TLA2#tla_winfxsdk](../../../../includes/tla2sharptla-winfxsdk-md.md)] documentation.</span></span>  
  
<a name="samples"></a>   
## <a name="threads-in-action-the-samples"></a><span data-ttu-id="dfbdf-156">Wątki w działaniu: przykłady</span><span class="sxs-lookup"><span data-stu-id="dfbdf-156">Threads in Action: The Samples</span></span>  
  
<a name="prime_number"></a>   
### <a name="a-single-threaded-application-with-a-long-running-calculation"></a><span data-ttu-id="dfbdf-157">Jednowątkowe aplikacja o obliczenie długotrwałe</span><span class="sxs-lookup"><span data-stu-id="dfbdf-157">A Single-Threaded Application with a Long-Running Calculation</span></span>  
 <span data-ttu-id="dfbdf-158">Większość [!INCLUDE[TLA#tla_gui#plural](../../../../includes/tlasharptla-guisharpplural-md.md)] poświęcać dużo czasu bezczynności podczas oczekiwania na zdarzenia, które są generowane w odpowiedzi na interakcję użytkownika.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-158">Most [!INCLUDE[TLA#tla_gui#plural](../../../../includes/tlasharptla-guisharpplural-md.md)] spend a large portion of their time idle while waiting for events that are generated in response to user interactions.</span></span> <span data-ttu-id="dfbdf-159">Dokładne programowania tego czasu bezczynności można konstruktywnie, bez wywierania wpływu na czas odpowiedzi z [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span><span class="sxs-lookup"><span data-stu-id="dfbdf-159">With careful programming this idle time can be used constructively, without affecting the responsiveness of the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span></span> <span data-ttu-id="dfbdf-160">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] Model wątkowości nie zezwala na dane wejściowe, aby przerwać operację wykonywane w [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-160">The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] threading model doesn’t allow input to interrupt an operation happening in the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="dfbdf-161">Oznacza to, należy upewnić się powrócić do <xref:System.Windows.Threading.Dispatcher> okresowo do przetworzenia oczekujących zdarzeń wejściowych, zanim uzyskają przestarzałe.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-161">This means you must be sure to return to the <xref:System.Windows.Threading.Dispatcher> periodically to process pending input events before they get stale.</span></span>  
  
 <span data-ttu-id="dfbdf-162">Rozważmy następujący przykład:</span><span class="sxs-lookup"><span data-stu-id="dfbdf-162">Consider the following example:</span></span>  
  
 <span data-ttu-id="dfbdf-163">![Zrzut ekranu przedstawiający liczb pierwszych](../../../../docs/framework/wpf/advanced/media/threadingprimenumberscreenshot.PNG "ThreadingPrimeNumberScreenShot")</span><span class="sxs-lookup"><span data-stu-id="dfbdf-163">![Prime numbers screen shot](../../../../docs/framework/wpf/advanced/media/threadingprimenumberscreenshot.PNG "ThreadingPrimeNumberScreenShot")</span></span>  
  
 <span data-ttu-id="dfbdf-164">Ta prosta aplikacja większej liczby z trzech, wyszukiwanie liczb pierwszych.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-164">This simple application counts upwards from three, searching for prime numbers.</span></span> <span data-ttu-id="dfbdf-165">Po kliknięciu przez użytkownika **Start** przycisku, wyszukiwanie rozpoczyna się.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-165">When the user clicks the **Start** button, the search begins.</span></span> <span data-ttu-id="dfbdf-166">Gdy wyszukiwany Zapora aktualizacje interfejsu użytkownika z jego odnajdywania.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-166">When the program finds a prime, it updates the user interface with its discovery.</span></span> <span data-ttu-id="dfbdf-167">W dowolnym momencie użytkownik może zatrzymać wyszukiwania.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-167">At any point, the user can stop the search.</span></span>  
  
 <span data-ttu-id="dfbdf-168">Chociaż tyle prosta, liczba pierwsza wyszukiwania można umieścić w nieskończoność, który przedstawia niektóre problemy.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-168">Although simple enough, the prime number search could go on forever, which presents some difficulties.</span></span>  <span data-ttu-id="dfbdf-169">Firma Microsoft obsługi całego wyszukiwania wewnątrz obsługi zdarzenia kliknięcia przycisku, firma Microsoft może nigdy nie udzielają żadnych [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku możliwość obsługi innych zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-169">If we handled the entire search inside of the click event handler of the button, we would never give the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread a chance to handle other events.</span></span> <span data-ttu-id="dfbdf-170">[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Nie może odpowiadać na dane wejściowe lub proces wiadomości.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-170">The [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] would be unable to respond to input or process messages.</span></span> <span data-ttu-id="dfbdf-171">Będzie on nigdy nie odświeżenia i nigdy nie odpowiadanie na kliknięcia przycisku.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-171">It would never repaint and never respond to button clicks.</span></span>  
  
 <span data-ttu-id="dfbdf-172">Firma Microsoft może przeprowadzić wyszukiwania liczba pierwsza w oddzielnym wątku, ale będzie trzeba postępowania w przypadku problemów z synchronizacją.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-172">We could conduct the prime number search in a separate thread, but then we would need to deal with synchronization issues.</span></span> <span data-ttu-id="dfbdf-173">Jednowątkowe podejście możemy bezpośrednio zaktualizować etykietę, którą zawiera największy priorytetowe znaleziono.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-173">With a single-threaded approach, we can directly update the label that lists the largest prime found.</span></span>  
  
 <span data-ttu-id="dfbdf-174">Jeśli zadanie obliczeń w partiach łatwych do możemy podzielić, możemy okresowo powrócić do <xref:System.Windows.Threading.Dispatcher> i przetwarzania zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-174">If we break up the task of calculation into manageable chunks, we can periodically return to the <xref:System.Windows.Threading.Dispatcher> and process events.</span></span> <span data-ttu-id="dfbdf-175">Firma Microsoft może zapewnić [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] możliwość odświeżenia i przetwarzania danych wejściowych.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-175">We can give [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] an opportunity to repaint and process input.</span></span>  
  
 <span data-ttu-id="dfbdf-176">Najlepszym sposobem podział czasu przetwarzania między obliczania i obsługa zdarzeń ma zarządzać obliczeń z <xref:System.Windows.Threading.Dispatcher>.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-176">The best way to split processing time between calculation and event handling is to manage calculation from the <xref:System.Windows.Threading.Dispatcher>.</span></span> <span data-ttu-id="dfbdf-177">Za pomocą <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> metody, można zaplanować liczba pierwsza kontroli w taki sam kolejki, która [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] zdarzenia są pobierane z.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-177">By using the <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> method, we can schedule prime number checks in the same queue that [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] events are drawn from.</span></span> <span data-ttu-id="dfbdf-178">W naszym przykładzie zaplanować tylko sprawdzanie jeden numer prime naraz.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-178">In our example, we schedule only a single prime number check at a time.</span></span> <span data-ttu-id="dfbdf-179">Po zakończeniu wyboru liczba pierwsza zaplanować dalej wyboru natychmiast.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-179">After the prime number check is complete, we schedule the next check immediately.</span></span> <span data-ttu-id="dfbdf-180">Ten test tylko po będzie kontynuowane do czasu [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] zdarzeń zostały obsłużone.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-180">This check proceeds only after pending [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] events have been handled.</span></span>  
  
 <span data-ttu-id="dfbdf-181">![Ilustracja przedstawiająca kolejkę dyspozytora](../../../../docs/framework/wpf/advanced/media/threadingdispatcherqueue.PNG "ThreadingDispatcherQueue")</span><span class="sxs-lookup"><span data-stu-id="dfbdf-181">![Dispatcher queue illustration](../../../../docs/framework/wpf/advanced/media/threadingdispatcherqueue.PNG "ThreadingDispatcherQueue")</span></span>  
  
 [!INCLUDE[TLA#tla_word](../../../../includes/tlasharptla-word-md.md)]<span data-ttu-id="dfbdf-182">wykonuje sprawdzanie pisowni przy użyciu tego mechanizmu.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-182"> accomplishes spell checking using this mechanism.</span></span> <span data-ttu-id="dfbdf-183">Sprawdzanie pisowni jest wykonywane w tle, na podstawie czasu bezczynności [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-183">Spell checking is done in the background using the idle time of the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="dfbdf-184">Spójrzmy na kod.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-184">Let's take a look at the code.</span></span>  
  
 <span data-ttu-id="dfbdf-185">W poniższym przykładzie przedstawiono XAML, która tworzy interfejs użytkownika.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-185">The following example shows the XAML that creates the user interface.</span></span>  
  
 [!code-xaml[ThreadingPrimeNumbers#ThreadingPrimeNumberXAML](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingPrimeNumbers/CSharp/Window1.xaml#threadingprimenumberxaml)]  
  
 <span data-ttu-id="dfbdf-186">W poniższym przykładzie przedstawiono CodeBehind.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-186">The following example shows the code-behind.</span></span>  
  
 [!code-csharp[ThreadingPrimeNumbers#ThreadingPrimeNumberCodeBehind](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingPrimeNumbers/CSharp/Window1.xaml.cs#threadingprimenumbercodebehind)]
 [!code-vb[ThreadingPrimeNumbers#ThreadingPrimeNumberCodeBehind](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingPrimeNumbers/visualbasic/mainwindow.xaml.vb#threadingprimenumbercodebehind)]  
  
 <span data-ttu-id="dfbdf-187">W poniższym przykładzie pokazano programu obsługi zdarzeń dla <xref:System.Windows.Controls.Button>.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-187">The following example shows the event handler for the <xref:System.Windows.Controls.Button>.</span></span>  
  
 [!code-csharp[ThreadingPrimeNumbers#ThreadingPrimeNumberStartOrStop](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingPrimeNumbers/CSharp/Window1.xaml.cs#threadingprimenumberstartorstop)]
 [!code-vb[ThreadingPrimeNumbers#ThreadingPrimeNumberStartOrStop](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingPrimeNumbers/visualbasic/mainwindow.xaml.vb#threadingprimenumberstartorstop)]  
  
 <span data-ttu-id="dfbdf-188">Oprócz Aktualizowanie tekstu w <xref:System.Windows.Controls.Button>, ten program obsługi jest odpowiedzialny za planowanie pierwszy wyboru liczba pierwsza przez dodanie pełnomocnika, aby <xref:System.Windows.Threading.Dispatcher> kolejki.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-188">Besides updating the text on the <xref:System.Windows.Controls.Button>, this handler is responsible for scheduling the first prime number check by adding a delegate to the <xref:System.Windows.Threading.Dispatcher> queue.</span></span> <span data-ttu-id="dfbdf-189">Pewnym czasie, po zakończeniu pracy, ten program obsługi zdarzeń <xref:System.Windows.Threading.Dispatcher> wybierze ten delegat do wykonania.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-189">Sometime after this event handler has completed its work, the <xref:System.Windows.Threading.Dispatcher> will select this delegate for execution.</span></span>  
  
 <span data-ttu-id="dfbdf-190">Jak wspomniano wcześniej, <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> jest <xref:System.Windows.Threading.Dispatcher> Członkowskie zaplanowano delegata do wykonania.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-190">As we mentioned earlier, <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> is the <xref:System.Windows.Threading.Dispatcher> member used to schedule a delegate for execution.</span></span> <span data-ttu-id="dfbdf-191">W takim przypadku wybieramy opcję <xref:System.Windows.Threading.DispatcherPriority.SystemIdle> priorytet.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-191">In this case, we choose the <xref:System.Windows.Threading.DispatcherPriority.SystemIdle> priority.</span></span> <span data-ttu-id="dfbdf-192"><xref:System.Windows.Threading.Dispatcher> Wykona ten delegat tylko wtedy, gdy Brak ważnych zdarzeń do przetwarzania.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-192">The <xref:System.Windows.Threading.Dispatcher> will execute this delegate only when there are no important events to process.</span></span> [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]<span data-ttu-id="dfbdf-193">czas odpowiedzi jest ważniejsze niż liczba sprawdzania.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-193"> responsiveness is more important than number checking.</span></span> <span data-ttu-id="dfbdf-194">Możemy również przekazać nowe delegowanie reprezentujący sprawdzanie numer procedury.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-194">We also pass a new delegate representing the number-checking routine.</span></span>  
  
 [!code-csharp[ThreadingPrimeNumbers#ThreadingPrimeNumberCheckNextNumber](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingPrimeNumbers/CSharp/Window1.xaml.cs#threadingprimenumberchecknextnumber)]
 [!code-vb[ThreadingPrimeNumbers#ThreadingPrimeNumberCheckNextNumber](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingPrimeNumbers/visualbasic/mainwindow.xaml.vb#threadingprimenumberchecknextnumber)]  
  
 <span data-ttu-id="dfbdf-195">Ta metoda sprawdza, czy dalej nieparzystą liczbą jest pierwsze.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-195">This method checks if the next odd number is prime.</span></span> <span data-ttu-id="dfbdf-196">Jeśli tak jest, zapisują, metoda bezpośrednio aktualizacji `bigPrime` <xref:System.Windows.Controls.TextBlock> do uwzględnienia jego odnajdywania.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-196">If it is prime, the method directly updates the `bigPrime`<xref:System.Windows.Controls.TextBlock> to reflect its discovery.</span></span> <span data-ttu-id="dfbdf-197">Firma Microsoft może to zrobić, ponieważ obliczenie jest wykonywana w tym samym wątku, który został użyty do utworzenia składnika.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-197">We can do this because the calculation is occurring in the same thread that was used to create the component.</span></span> <span data-ttu-id="dfbdf-198">Firma Microsoft wybierze oddzielnym wątku na potrzeby obliczania, firma Microsoft będzie musiał używać bardziej skomplikowanych mechanizmu synchronizacji i wykonać aktualizację w [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-198">Had we chosen to use a separate thread for the calculation, we would have to use a more complicated synchronization mechanism and execute the update in the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="dfbdf-199">Zostanie przedstawiony obok tej sytuacji.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-199">We’ll demonstrate this situation next.</span></span>  
  
 <span data-ttu-id="dfbdf-200">Kod źródłowy pełną dla tego przykładu, aby zapoznać [aplikacji Single-Threaded długotrwałe obliczania próbki](http://go.microsoft.com/fwlink/?LinkID=160038)</span><span class="sxs-lookup"><span data-stu-id="dfbdf-200">For the complete source code for this sample, see the [Single-Threaded Application with Long-Running Calculation Sample](http://go.microsoft.com/fwlink/?LinkID=160038)</span></span>  
  
<a name="weather_sim"></a>   
### <a name="handling-a-blocking-operation-with-a-background-thread"></a><span data-ttu-id="dfbdf-201">Obsługa operacji blokowania z wątku w tle</span><span class="sxs-lookup"><span data-stu-id="dfbdf-201">Handling a Blocking Operation with a Background Thread</span></span>  
 <span data-ttu-id="dfbdf-202">Obsługa operacji blokowania w graficznym aplikacji może być trudne.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-202">Handling blocking operations in a graphical application can be difficult.</span></span> <span data-ttu-id="dfbdf-203">Nie chcemy wywoływać metod blokowania z obsługi zdarzeń, ponieważ aplikacja pojawi się zawiesza.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-203">We don’t want to call blocking methods from event handlers because the application will appear to freeze up.</span></span> <span data-ttu-id="dfbdf-204">Możemy użyć oddzielnym wątku do obsługi tych operacji, ale gdy skończymy, konieczne jest synchronizowana [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku, ponieważ firma Microsoft nie można bezpośrednio modyfikować [!INCLUDE[TLA2#tla_gui](../../../../includes/tla2sharptla-gui-md.md)] z naszych wątku roboczego.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-204">We can use a separate thread to handle these operations, but when we’re done, we have to synchronize with the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread because we can’t directly modify the [!INCLUDE[TLA2#tla_gui](../../../../includes/tla2sharptla-gui-md.md)] from our worker thread.</span></span> <span data-ttu-id="dfbdf-205">Możemy użyć <xref:System.Windows.Threading.Dispatcher.Invoke%2A> lub <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> do wstawienia delegatów w <xref:System.Windows.Threading.Dispatcher> z [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-205">We can use <xref:System.Windows.Threading.Dispatcher.Invoke%2A> or <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> to insert delegates into the <xref:System.Windows.Threading.Dispatcher> of the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="dfbdf-206">Po pewnym czasie zostaną wykonane tych obiektów delegowanych z uprawnień do modyfikowania [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] elementów.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-206">Eventually, these delegates will be executed with permission to modify [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] elements.</span></span>  
  
 <span data-ttu-id="dfbdf-207">W tym przykładzie mamy naśladować wywołanie procedury zdalnej, która pobiera prognozie pogody.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-207">In this example, we mimic a remote procedure call that retrieves a weather forecast.</span></span> <span data-ttu-id="dfbdf-208">Używamy oddzielnym wątku do wykonania tego wywołania, a zaplanować metody aktualizacji w <xref:System.Windows.Threading.Dispatcher> z [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku, gdy jest gotowe.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-208">We use a separate worker thread to execute this call, and we schedule an update method in the <xref:System.Windows.Threading.Dispatcher> of the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread when we’re finished.</span></span>  
  
 <span data-ttu-id="dfbdf-209">![Zrzut ekranu interfejsu użytkownika pogodowe](../../../../docs/framework/wpf/advanced/media/threadingweatheruiscreenshot.PNG "ThreadingWeatherUIScreenShot")</span><span class="sxs-lookup"><span data-stu-id="dfbdf-209">![Weather UI screen shot](../../../../docs/framework/wpf/advanced/media/threadingweatheruiscreenshot.PNG "ThreadingWeatherUIScreenShot")</span></span>  
  
 [!code-csharp[ThreadingWeatherForecast#ThreadingWeatherCodeBehind](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingWeatherForecast/CSharp/Window1.xaml.cs#threadingweathercodebehind)]
 [!code-vb[ThreadingWeatherForecast#ThreadingWeatherCodeBehind](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingWeatherForecast/visualbasic/window1.xaml.vb#threadingweathercodebehind)]  
  
 <span data-ttu-id="dfbdf-210">Poniżej przedstawiono niektóre szczegóły można zauważyć.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-210">The following are some of the details to be noted.</span></span>  
  
-   <span data-ttu-id="dfbdf-211">Tworzenie obsługi przycisku</span><span class="sxs-lookup"><span data-stu-id="dfbdf-211">Creating the Button Handler</span></span>  
  
     [!code-csharp[ThreadingWeatherForecast#ThreadingWeatherButtonHandler](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingWeatherForecast/CSharp/Window1.xaml.cs#threadingweatherbuttonhandler)]
     [!code-vb[ThreadingWeatherForecast#ThreadingWeatherButtonHandler](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingWeatherForecast/visualbasic/window1.xaml.vb#threadingweatherbuttonhandler)]  
  
 <span data-ttu-id="dfbdf-212">Po kliknięciu przycisku nasz Wyświetl rysunek zegara i uruchomić go animacji.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-212">When the button is clicked, we display the clock drawing and start animating it.</span></span> <span data-ttu-id="dfbdf-213">Możemy wyłączyć przycisku.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-213">We disable the button.</span></span> <span data-ttu-id="dfbdf-214">Firma Microsoft wywołania `FetchWeatherFromServer` metoda nowego wątku, a następnie usuniemy zwracany, dzięki czemu <xref:System.Windows.Threading.Dispatcher> przetwarzania zdarzeń podczas oczekiwania na zbieranie prognozie pogody.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-214">We invoke the `FetchWeatherFromServer` method in a new thread, and then we return, allowing the <xref:System.Windows.Threading.Dispatcher> to process events while we wait to collect the weather forecast.</span></span>  
  
-   <span data-ttu-id="dfbdf-215">Pobieranie pogody</span><span class="sxs-lookup"><span data-stu-id="dfbdf-215">Fetching the Weather</span></span>  
  
     [!code-csharp[ThreadingWeatherForecast#ThreadingWeatherFetchWeather](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingWeatherForecast/CSharp/Window1.xaml.cs#threadingweatherfetchweather)]
     [!code-vb[ThreadingWeatherForecast#ThreadingWeatherFetchWeather](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingWeatherForecast/visualbasic/window1.xaml.vb#threadingweatherfetchweather)]  
  
 <span data-ttu-id="dfbdf-216">Aby zachować proste rzeczy, nie faktycznie mamy sieci kodu w tym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-216">To keep things simple, we don’t actually have any networking code in this example.</span></span> <span data-ttu-id="dfbdf-217">Zamiast tego firma Microsoft symulowania opóźnienia dostępu do sieci przez umieszczenie naszego nowego wątku w stan uśpienia przez cztery sekundy.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-217">Instead, we simulate the delay of network access by putting our new thread to sleep for four seconds.</span></span> <span data-ttu-id="dfbdf-218">W tej chwili oryginalnej [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku jest nadal uruchomiona i reagowanie na zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-218">In this time, the original [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread is still running and responding to events.</span></span> <span data-ttu-id="dfbdf-219">Pokaż, firma Microsoft już pozostanie uruchomiona Animacja i Minimalizuj i zmaksymalizować przycisków również kontynuować pracę.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-219">To show this, we’ve left an animation running, and the minimize and maximize buttons also continue to work.</span></span>  
  
 <span data-ttu-id="dfbdf-220">Po zakończeniu opóźnienie, losowo Wybraliśmy naszych prognozie pogody, nadszedł czas na raportowane [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-220">When the delay is finished, and we’ve randomly selected our weather forecast, it’s time to report back to the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="dfbdf-221">Firma Microsoft w tym celu planowania wywołanie `UpdateUserInterface` w [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku przy użyciu tego wątku <xref:System.Windows.Threading.Dispatcher>.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-221">We do this by scheduling a call to `UpdateUserInterface` in the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread using that thread’s <xref:System.Windows.Threading.Dispatcher>.</span></span> <span data-ttu-id="dfbdf-222">Ciąg opisujący pogody do wywołania tej metody zaplanowane jest przekazywana.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-222">We pass a string describing the weather to this scheduled method call.</span></span>  
  
-   <span data-ttu-id="dfbdf-223">Aktualizowanie[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]</span><span class="sxs-lookup"><span data-stu-id="dfbdf-223">Updating the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]</span></span>  
  
     [!code-csharp[ThreadingWeatherForecast#ThreadingWeatherUpdateUI](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingWeatherForecast/CSharp/Window1.xaml.cs#threadingweatherupdateui)]
     [!code-vb[ThreadingWeatherForecast#ThreadingWeatherUpdateUI](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingWeatherForecast/visualbasic/window1.xaml.vb#threadingweatherupdateui)]  
  
 <span data-ttu-id="dfbdf-224">Gdy <xref:System.Windows.Threading.Dispatcher> w [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku jest czas, wykonywania zaplanowanych wywołanie `UpdateUserInterface`.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-224">When the <xref:System.Windows.Threading.Dispatcher> in the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread has time, it executes the scheduled call to `UpdateUserInterface`.</span></span> <span data-ttu-id="dfbdf-225">Ta metoda zatrzymuje animacji zegara i wybiera obrazu do opisywania pogody.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-225">This method stops the clock animation and chooses an image to describe the weather.</span></span> <span data-ttu-id="dfbdf-226">On wyświetla ten obraz i przywraca przycisk "pobieranie forecast".</span><span class="sxs-lookup"><span data-stu-id="dfbdf-226">It displays this image and restores the "fetch forecast" button.</span></span>  
  
<a name="multi_browser"></a>   
### <a name="multiple-windows-multiple-threads"></a><span data-ttu-id="dfbdf-227">Wiele okien, wiele wątków</span><span class="sxs-lookup"><span data-stu-id="dfbdf-227">Multiple Windows, Multiple Threads</span></span>  
 <span data-ttu-id="dfbdf-228">Niektóre [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] aplikacje wymagają wielu okien najwyższego poziomu.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-228">Some [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] applications require multiple top-level windows.</span></span> <span data-ttu-id="dfbdf-229">Dopuszczalne dokładnie jeden wątek są /<xref:System.Windows.Threading.Dispatcher> kombinacja do zarządzania wiele okien, ale czasami kilka wątków czy lepiej zadania.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-229">It is perfectly acceptable for one Thread/<xref:System.Windows.Threading.Dispatcher> combination to manage multiple windows, but sometimes several threads do a better job.</span></span> <span data-ttu-id="dfbdf-230">Jest to szczególnie istotne, jeśli wysłanej co systemu windows będzie zająć całych wątku.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-230">This is especially true if there is any chance that one of the windows will monopolize the thread.</span></span>  
  
 [!INCLUDE[TLA#tla_mswin](../../../../includes/tlasharptla-mswin-md.md)]<span data-ttu-id="dfbdf-231">Eksplorator działa w ten sposób.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-231"> Explorer works in this fashion.</span></span> <span data-ttu-id="dfbdf-232">Każde nowe okno Eksploratora należy do oryginalnej proces, ale jest tworzony poza kontrolą niezależnie od wątku.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-232">Each new Explorer window belongs to the original process, but it is created under the control of an independent thread.</span></span>  
  
 <span data-ttu-id="dfbdf-233">Za pomocą [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Controls.Frame> kontroli, można wyświetlić strony sieci Web.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-233">By using a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<xref:System.Windows.Controls.Frame> control, we can display Web pages.</span></span> <span data-ttu-id="dfbdf-234">Można łatwo utworzyć prostą [!INCLUDE[TLA2#tla_ie](../../../../includes/tla2sharptla-ie-md.md)] podstaw.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-234">We can easily create a simple [!INCLUDE[TLA2#tla_ie](../../../../includes/tla2sharptla-ie-md.md)] substitute.</span></span> <span data-ttu-id="dfbdf-235">Możemy zaczynać ważna cecha: możliwość Otwórz nowe okno Eksploratora.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-235">We start with an important feature: the ability to open a new explorer window.</span></span> <span data-ttu-id="dfbdf-236">Gdy użytkownik kliknie przycisk "nowe okno" przycisku, możemy uruchomić kopię naszych okna w oddzielnym wątku.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-236">When the user clicks the "new window" button, we launch a copy of our window in a separate thread.</span></span> <span data-ttu-id="dfbdf-237">W ten sposób długotrwałe lub blokowania operacji w jednym z systemu windows nie będzie blokować wszystkich innych okien.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-237">This way, long-running or blocking operations in one of the windows won’t lock all the other windows.</span></span>  
  
 <span data-ttu-id="dfbdf-238">W rzeczywistości modelu przeglądarki sieci Web ma własną skomplikowane modelu wątkowości.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-238">In reality, the Web browser model has its own complicated threading model.</span></span> <span data-ttu-id="dfbdf-239">Firma Microsoft został wybrany, ponieważ powinna być znana większości czytelników.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-239">We’ve chosen it because it should be familiar to most readers.</span></span>  
  
 <span data-ttu-id="dfbdf-240">Poniższy przykład przedstawia kod.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-240">The following example shows the code.</span></span>  
  
 [!code-xaml[ThreadingMultipleBrowsers#ThreadingMultiBrowserXAML](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingMultipleBrowsers/CSharp/Window1.xaml#threadingmultibrowserxaml)]  
  
 [!code-csharp[ThreadingMultipleBrowsers#ThreadingMultiBrowserCodeBehind](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingMultipleBrowsers/CSharp/Window1.xaml.cs#threadingmultibrowsercodebehind)]
 [!code-vb[ThreadingMultipleBrowsers#ThreadingMultiBrowserCodeBehind](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingMultipleBrowsers/VisualBasic/Window1.xaml.vb#threadingmultibrowsercodebehind)]  
  
 <span data-ttu-id="dfbdf-241">Następujące segmenty wątków tego kodu jest najbardziej interesujące nam w tym kontekście:</span><span class="sxs-lookup"><span data-stu-id="dfbdf-241">The following threading segments of this code are the most interesting to us in this context:</span></span>  
  
 [!code-csharp[ThreadingMultipleBrowsers#ThreadingMultiBrowserNewWindow](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingMultipleBrowsers/CSharp/Window1.xaml.cs#threadingmultibrowsernewwindow)]
 [!code-vb[ThreadingMultipleBrowsers#ThreadingMultiBrowserNewWindow](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingMultipleBrowsers/VisualBasic/Window1.xaml.vb#threadingmultibrowsernewwindow)]  
  
 <span data-ttu-id="dfbdf-242">Ta metoda jest wywoływana, gdy "nowe okno" przycisk zostanie kliknięty.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-242">This method is called when the "new window" button is clicked.</span></span> <span data-ttu-id="dfbdf-243">Tworzy nowego wątku i uruchamia go asynchronicznie.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-243">It creates a new thread and starts it asynchronously.</span></span>  
  
 [!code-csharp[ThreadingMultipleBrowsers#ThreadingMultiBrowserThreadStart](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingMultipleBrowsers/CSharp/Window1.xaml.cs#threadingmultibrowserthreadstart)]
 [!code-vb[ThreadingMultipleBrowsers#ThreadingMultiBrowserThreadStart](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingMultipleBrowsers/VisualBasic/Window1.xaml.vb#threadingmultibrowserthreadstart)]  
  
 <span data-ttu-id="dfbdf-244">Ta metoda jest punkt początkowy dla nowego wątku.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-244">This method is the starting point for the new thread.</span></span> <span data-ttu-id="dfbdf-245">Utworzymy nowe okno pod kontrolą tego wątku.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-245">We create a new window under the control of this thread.</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="dfbdf-246">automatycznie tworzy nową <xref:System.Windows.Threading.Dispatcher> do zarządzania nowego wątku.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-246"> automatically creates a new <xref:System.Windows.Threading.Dispatcher> to manage the new thread.</span></span> <span data-ttu-id="dfbdf-247">Wszystkie mamy zrobić, aby wyświetlić okno funkcjonalności jest uruchomienie <xref:System.Windows.Threading.Dispatcher>.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-247">All we have to do to make the window functional is to start the <xref:System.Windows.Threading.Dispatcher>.</span></span>  
  
<a name="stumbling_points"></a>   
## <a name="technical-details-and-stumbling-points"></a><span data-ttu-id="dfbdf-248">Szczegółowe informacje techniczne i Stumbling punkty</span><span class="sxs-lookup"><span data-stu-id="dfbdf-248">Technical Details and Stumbling Points</span></span>  
  
### <a name="writing-components-using-threading"></a><span data-ttu-id="dfbdf-249">Składniki zapisywania za pomocą wątków</span><span class="sxs-lookup"><span data-stu-id="dfbdf-249">Writing Components Using Threading</span></span>  
 <span data-ttu-id="dfbdf-250">[!INCLUDE[TLA#tla_netframewk](../../../../includes/tlasharptla-netframewk-md.md)] Przewodnik dewelopera opisuje szablon dla jak składnika mogą uwidaczniać asynchroniczne zachowanie klientom (zobacz [oparty na zdarzeniach asynchroniczny wzorzec — Przegląd](../../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md)).</span><span class="sxs-lookup"><span data-stu-id="dfbdf-250">The [!INCLUDE[TLA#tla_netframewk](../../../../includes/tlasharptla-netframewk-md.md)] Developer's Guide describes a pattern for how a component can expose asynchronous behavior to its clients (see [Event-based Asynchronous Pattern Overview](../../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md)).</span></span> <span data-ttu-id="dfbdf-251">Na przykład, załóżmy, że trzeba pakietu `FetchWeatherFromServer` metody do wielokrotnego użytku, które składnika.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-251">For instance, suppose we wanted to package the `FetchWeatherFromServer` method into a reusable, nongraphical component.</span></span> <span data-ttu-id="dfbdf-252">Następujące standardowego [!INCLUDE[TLA#tla_netframewk](../../../../includes/tlasharptla-netframewk-md.md)] wzorzec, to będzie wyglądać podobnie do poniższego.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-252">Following the standard [!INCLUDE[TLA#tla_netframewk](../../../../includes/tlasharptla-netframewk-md.md)] pattern, this would look something like the following.</span></span>  
  
 [!code-csharp[CommandingOverviewSnippets#ThreadingArticleWeatherComponent1](../../../../samples/snippets/csharp/VS_Snippets_Wpf/CommandingOverviewSnippets/CSharp/Window1.xaml.cs#threadingarticleweathercomponent1)]
 [!code-vb[CommandingOverviewSnippets#ThreadingArticleWeatherComponent1](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/CommandingOverviewSnippets/visualbasic/window1.xaml.vb#threadingarticleweathercomponent1)]  
  
 <span data-ttu-id="dfbdf-253">`GetWeatherAsync`użyje jednej z metod opisanych wcześniej, takich jak tworzenie wątku w tle, które wykonają tę pracę asynchronicznie, nie blokuje wątek wywołujący.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-253">`GetWeatherAsync` would use one of the techniques described earlier, such as creating a background thread, to do the work asynchronously, not blocking the calling thread.</span></span>  
  
 <span data-ttu-id="dfbdf-254">Jedną z najważniejszych części tego wzorca wywołuje *MethodName* `Completed` metody w tym samym wątku, który wywołał *MethodName* `Async` rozpoczynać się od metody.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-254">One of the most important parts of this pattern is calling the *MethodName*`Completed` method on the same thread that called the *MethodName*`Async` method to begin with.</span></span> <span data-ttu-id="dfbdf-255">Użytkownik może to zrobić przy użyciu [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] dość łatwe, przechowując <xref:System.Windows.Threading.Dispatcher.CurrentDispatcher%2A>—, ale następnie składnika, które mogą być używane tylko w [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] aplikacji, nie znajduje się w [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] lub [!INCLUDE[TLA#tla_aspnet](../../../../includes/tlasharptla-aspnet-md.md)] programów.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-255">You could do this using [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] fairly easily, by storing <xref:System.Windows.Threading.Dispatcher.CurrentDispatcher%2A>—but then the nongraphical component could only be used in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] applications, not in [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] or [!INCLUDE[TLA#tla_aspnet](../../../../includes/tlasharptla-aspnet-md.md)] programs.</span></span>  
  
 <span data-ttu-id="dfbdf-256"><xref:System.Windows.Threading.DispatcherSynchronizationContext> Klasy adresów tę potrzebę — Pomyśl o tym jako uproszczonej wersji <xref:System.Windows.Threading.Dispatcher> który współpracuje z innymi [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] również struktury.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-256">The <xref:System.Windows.Threading.DispatcherSynchronizationContext> class addresses this need—think of it as a simplified version of <xref:System.Windows.Threading.Dispatcher> that works with other [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] frameworks as well.</span></span>  
  
 [!code-csharp[CommandingOverviewSnippets#ThreadingArticleWeatherComponent2](../../../../samples/snippets/csharp/VS_Snippets_Wpf/CommandingOverviewSnippets/CSharp/Window1.xaml.cs#threadingarticleweathercomponent2)]
 [!code-vb[CommandingOverviewSnippets#ThreadingArticleWeatherComponent2](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/CommandingOverviewSnippets/visualbasic/window1.xaml.vb#threadingarticleweathercomponent2)]  
  
### <a name="nested-pumping"></a><span data-ttu-id="dfbdf-257">Zagnieżdżone przekazywania</span><span class="sxs-lookup"><span data-stu-id="dfbdf-257">Nested Pumping</span></span>  
 <span data-ttu-id="dfbdf-258">Czasami nie jest to wykonalne całkowicie blokowanie [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-258">Sometimes it is not feasible to completely lock up the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="dfbdf-259">Zastanówmy <xref:System.Windows.MessageBox.Show%2A> metody <xref:System.Windows.MessageBox> klasy.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-259">Let’s consider the <xref:System.Windows.MessageBox.Show%2A> method of the <xref:System.Windows.MessageBox> class.</span></span> <span data-ttu-id="dfbdf-260"><xref:System.Windows.MessageBox.Show%2A>nie zwraca, dopóki użytkownik kliknie przycisk OK.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-260"><xref:System.Windows.MessageBox.Show%2A> doesn’t return until the user clicks the OK button.</span></span> <span data-ttu-id="dfbdf-261">Utworzone jednak okna, którą muszą dysponować Pętla wiadomości, aby interakcyjne.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-261">It does, however, create a window that must have a message loop in order to be interactive.</span></span> <span data-ttu-id="dfbdf-262">Gdy firma Microsoft oczekujące dla użytkownika kliknij przycisk OK, oryginalnego okna aplikacji nie odpowiada na dane wejściowe użytkownika.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-262">While we are waiting for the user to click OK, the original application window does not respond to user input.</span></span> <span data-ttu-id="dfbdf-263">Jednakże nadal przetwarzać komunikaty dotyczące malowania.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-263">It does, however, continue to process paint messages.</span></span> <span data-ttu-id="dfbdf-264">Oryginalnego okna ponownie rysuje samego w sobie podczas objętych usługą i ujawniony.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-264">The original window redraws itself when covered and revealed.</span></span>  
  
 <span data-ttu-id="dfbdf-265">![Element MessageBox z przycisk "OK"](../../../../docs/framework/wpf/advanced/media/threadingnestedpumping.png "ThreadingNestedPumping")</span><span class="sxs-lookup"><span data-stu-id="dfbdf-265">![MessageBox with an "OK" button](../../../../docs/framework/wpf/advanced/media/threadingnestedpumping.png "ThreadingNestedPumping")</span></span>  
  
 <span data-ttu-id="dfbdf-266">Niektóre wątek musi być odpowiedzialnym za okno komunikatu.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-266">Some thread must be in charge of the message box window.</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="dfbdf-267">można utworzyć nowego wątku do okno komunikatu, ale ten wątek można malować wyłączonych elementów w oknie oryginalnego (należy pamiętać o wcześniejszych omówienie wzajemne wykluczenie).</span><span class="sxs-lookup"><span data-stu-id="dfbdf-267"> could create a new thread just for the message box window, but this thread would be unable to paint the disabled elements in the original window (remember the earlier discussion of mutual exclusion).</span></span> <span data-ttu-id="dfbdf-268">Zamiast tego [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] używa zagnieżdżonych komunikat przetwarzania systemu.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-268">Instead, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] uses a nested message processing system.</span></span> <span data-ttu-id="dfbdf-269"><xref:System.Windows.Threading.Dispatcher> Klasa zawiera specjalne metody o nazwie <xref:System.Windows.Threading.Dispatcher.PushFrame%2A>, bieżącego punktu wykonywania aplikacji której przechowywana jest następnie rozpoczyna się nowych pętli komunikatów.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-269">The <xref:System.Windows.Threading.Dispatcher> class includes a special method called <xref:System.Windows.Threading.Dispatcher.PushFrame%2A>, which stores an application’s current execution point then begins a new message loop.</span></span> <span data-ttu-id="dfbdf-270">Po zakończeniu pracy pętli komunikatów zagnieżdżonych wykonywania wznawia działanie po oryginalnej <xref:System.Windows.Threading.Dispatcher.PushFrame%2A> wywołania.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-270">When the nested message loop finishes, execution resumes after the original <xref:System.Windows.Threading.Dispatcher.PushFrame%2A> call.</span></span>  
  
 <span data-ttu-id="dfbdf-271">W takim przypadku <xref:System.Windows.Threading.Dispatcher.PushFrame%2A> przechowuje kontekście program w wywołaniu <xref:System.Windows.MessageBox>.<xref:System.Windows.MessageBox.Show%2A>, i jest on uruchamiany nowy pętli komunikatów do odświeżenia okna tła i obsługi danych wejściowych okno komunikatu.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-271">In this case, <xref:System.Windows.Threading.Dispatcher.PushFrame%2A> maintains the program context at the call to <xref:System.Windows.MessageBox>.<xref:System.Windows.MessageBox.Show%2A>, and it starts a new message loop to repaint the background window and handle input to the message box window.</span></span> <span data-ttu-id="dfbdf-272">Gdy użytkownik kliknie przycisk OK i czyści okno podręczne, zamyka zagnieżdżonych pętli i sterowania zostanie wznowione po wywołaniu <xref:System.Windows.MessageBox.Show%2A>.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-272">When the user clicks OK and clears the pop-up window, the nested loop exits and control resumes after the call to <xref:System.Windows.MessageBox.Show%2A>.</span></span>  
  
### <a name="stale-routed-events"></a><span data-ttu-id="dfbdf-273">Zdarzenia rozsyłane przestarzały</span><span class="sxs-lookup"><span data-stu-id="dfbdf-273">Stale Routed Events</span></span>  
 <span data-ttu-id="dfbdf-274">System kierowanego zdarzenia w [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] powiadamia całego drzewa w momencie pojawienia się zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-274">The routed event system in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] notifies entire trees when events are raised.</span></span>  
  
 [!code-xaml[InputOvw#ThreadingArticleStaticRoutedEvent](../../../../samples/snippets/csharp/VS_Snippets_Wpf/InputOvw/CSharp/Page1.xaml#threadingarticlestaticroutedevent)]  
  
 <span data-ttu-id="dfbdf-275">Po naciśnięciu lewego przycisku myszy nad elipsy, `handler2` jest wykonywana.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-275">When the left mouse button is pressed over the ellipse, `handler2` is executed.</span></span> <span data-ttu-id="dfbdf-276">Po `handler2` zakończeniu zdarzenia są przekazywane do wzdłuż <xref:System.Windows.Controls.Canvas> obiektu, który używa `handler1` go przetworzyć.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-276">After `handler2` finishes, the event is passed along to the <xref:System.Windows.Controls.Canvas> object, which uses `handler1` to process it.</span></span> <span data-ttu-id="dfbdf-277">Dzieje się tak tylko wtedy, gdy `handler2` jest nie jawnie znacznik obiekt zdarzenia jako obsłużone.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-277">This happens only if `handler2` does not explicitly mark the event object as handled.</span></span>  
  
 <span data-ttu-id="dfbdf-278">Istnieje możliwość, że `handler2` potrwa dużą ilość czasu na przetwarzanie tego zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-278">It’s possible that `handler2` will take a great deal of time processing this event.</span></span> <span data-ttu-id="dfbdf-279">`handler2`może używać <xref:System.Windows.Threading.Dispatcher.PushFrame%2A> pętli zagnieżdżonych wiadomości, która nie zwraca godziny rozpoczęcia.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-279">`handler2` might use <xref:System.Windows.Threading.Dispatcher.PushFrame%2A> to begin a nested message loop that doesn’t return for hours.</span></span> <span data-ttu-id="dfbdf-280">Jeśli `handler2` nie nie znacznika zdarzenia jako obsługiwany, gdy ta pętla wiadomości jest zakończenie, zdarzenie jest przekazywany górę drzewa, mimo że jest to bardzo starych.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-280">If `handler2` does not mark the event as handled when this message loop is complete, the event is passed up the tree even though it is very old.</span></span>  
  
### <a name="reentrancy-and-locking"></a><span data-ttu-id="dfbdf-281">Wielobieżność i blokowanie</span><span class="sxs-lookup"><span data-stu-id="dfbdf-281">Reentrancy and Locking</span></span>  
 <span data-ttu-id="dfbdf-282">Mechanizm blokowania [!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)] nie zachowywać się dokładnie jako jeden oczywiście; jedną może spodziewać się wątek całkowicie przestaną operacji podczas żądania blokady.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-282">The locking mechanism of the [!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)] doesn’t behave exactly as one might imagine; one might expect a thread to cease operation completely when requesting a lock.</span></span> <span data-ttu-id="dfbdf-283">W rzeczywistości wątku w dalszym ciągu otrzymywać i przetwarzania komunikatów o wysokim priorytecie.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-283">In actuality, the thread continues to receive and process high-priority messages.</span></span> <span data-ttu-id="dfbdf-284">Pomaga to zapobiec zakleszczenie i utworzyć co najmniej odpowiadać interfejsów, jednak wprowadza możliwość subtelnych błędów.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-284">This helps prevent deadlocks and make interfaces minimally responsive, but it introduces the possibility for subtle bugs.</span></span>  <span data-ttu-id="dfbdf-285">Większość czasu nie trzeba niczego wiedzieć o tym, ale w rzadkich przypadkach (zwykle obejmujące [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] komunikatów okien i składników COM STA) może to być wartość uzyskiwanie informacji.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-285">The vast majority of the time you don’t need to know anything about this, but under rare circumstances (usually involving [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window messages or COM STA components) this can be worth knowing.</span></span>  
  
 <span data-ttu-id="dfbdf-286">Większość interfejsów nie są tworzone za bezpieczeństwo wątków na uwadze, ponieważ deweloperzy pracować przy założeniu, że [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] nigdy nie jest dostępny więcej niż jednego wątku.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-286">Most interfaces are not built with thread safety in mind because developers work under the assumption that a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] is never accessed by more than one thread.</span></span> <span data-ttu-id="dfbdf-287">W tym przypadku pojedynczego wątku mogą mieć wpływ zmiany w nieoczekiwanym czasie, powodując tych źle wpływ który <xref:System.Windows.Threading.DispatcherObject> mechanizmu wzajemne wykluczenie powinien rozwiązać.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-287">In this case, that single thread may make environmental changes at unexpected times, causing those ill effects that the <xref:System.Windows.Threading.DispatcherObject> mutual exclusion mechanism is supposed to solve.</span></span> <span data-ttu-id="dfbdf-288">Należy wziąć pod uwagę następujące pseudocode:</span><span class="sxs-lookup"><span data-stu-id="dfbdf-288">Consider the following pseudocode:</span></span>  
  
 <span data-ttu-id="dfbdf-289">![Diagram współużytkowania wątkowości](../../../../docs/framework/wpf/advanced/media/threadingreentrancy.png "ThreadingReentrancy")</span><span class="sxs-lookup"><span data-stu-id="dfbdf-289">![Threading reentrancy diagram](../../../../docs/framework/wpf/advanced/media/threadingreentrancy.png "ThreadingReentrancy")</span></span>  
  
 <span data-ttu-id="dfbdf-290">W większości przypadków, który jest co, ale czasami w [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] gdzie takie nieoczekiwane ponowne wejście naprawdę mogą powodować problemy.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-290">Most of the time that’s the right thing, but there are times in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] where such unexpected reentrancy can really cause problems.</span></span> <span data-ttu-id="dfbdf-291">Tak, w pewnych porach klucza, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] wywołania <xref:System.Windows.Threading.Dispatcher.DisableProcessing%2A>, który zmienia instrukcji lock dla tego wątku do użycia [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] bez ponownego rozpoczęcia blokady, zamiast standardowego [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] blokady.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-291">So, at certain key times, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] calls <xref:System.Windows.Threading.Dispatcher.DisableProcessing%2A>, which changes the lock instruction for that thread to use the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] reentrancy-free lock, instead of the usual [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] lock.</span></span>  
  
 <span data-ttu-id="dfbdf-292">Dlaczego tak czy [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] zespołu wybierz takie zachowanie?</span><span class="sxs-lookup"><span data-stu-id="dfbdf-292">So why did the [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] team choose this behavior?</span></span> <span data-ttu-id="dfbdf-293">Miał z obiektami COM STA i finalizacji wątku.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-293">It had to do with COM STA objects and the finalization thread.</span></span> <span data-ttu-id="dfbdf-294">Gdy obiekt jest bezużytecznych, jego `Finalize` metody jest uruchamiane na wątek finalizatora dedykowanych nie [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-294">When an object is garbage collected, its `Finalize` method is run on the dedicated finalizer thread, not the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="dfbdf-295">I tam leży problem, ponieważ obiekt COM STA, który został utworzony na [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku mogą zostać usunięte tylko na [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-295">And therein lies the problem, because a COM STA object that was created on the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread can only be disposed on the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="dfbdf-296">[!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] Jest odpowiednikiem <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> (w tym przypadku przy użyciu jego Win32 `SendMessage`).</span><span class="sxs-lookup"><span data-stu-id="dfbdf-296">The [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] does the equivalent of a <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> (in this case using Win32’s `SendMessage`).</span></span> <span data-ttu-id="dfbdf-297">Jeśli jednak [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wątku jest zajęty, został wstrzymany wątku finalizatora i obiektu COM STA nie można usunąć, co powoduje przeciek pamięci poważne.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-297">But if the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread is busy, the finalizer thread is stalled and the COM STA object can’t be disposed, which creates a serious memory leak.</span></span> <span data-ttu-id="dfbdf-298">Dlatego [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] zespołu wprowadzone trudnych wywołania blokad działa w sposób, aby je.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-298">So the [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] team made the tough call to make locks work the way they do.</span></span>  
  
 <span data-ttu-id="dfbdf-299">Zadanie [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] jest uniknięcie nieoczekiwany wielobieżność bez ponownym wprowadzeniem przeciek pamięci, dlatego nie zostanie zablokowany wielobieżność wszędzie.</span><span class="sxs-lookup"><span data-stu-id="dfbdf-299">The task for [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] is to avoid unexpected reentrancy without reintroducing the memory leak, which is why we don’t block reentrancy everywhere.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="dfbdf-300">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="dfbdf-300">See Also</span></span>  
 [<span data-ttu-id="dfbdf-301">Jednowątkowe aplikacji długotrwałe obliczania próbki</span><span class="sxs-lookup"><span data-stu-id="dfbdf-301">Single-Threaded Application with Long-Running Calculation Sample</span></span>](http://go.microsoft.com/fwlink/?LinkID=160038)
