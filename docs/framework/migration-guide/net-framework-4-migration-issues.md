---
title: Problemy podczas migracji programu .NET Framework 4
ms.date: 05/02/2017
helpviewer_keywords:
- .NET Framework 4, migration
- application compatibility
ms.assetid: df478548-8c05-4de2-8ba7-adcdbe1c2a60
ms.openlocfilehash: d3966ff15e06baf293ea02dad031bd5849b4a20f
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/30/2019
ms.locfileid: "73126045"
---
# <a name="net-framework-4-migration-issues"></a>Problemy podczas migracji programu .NET Framework 4

W tym temacie opisano problemy dotyczące migracji między .NET Framework wersja 3,5 z dodatkiem Service Pack 1 i .NET Framework wersja 4, w tym poprawki, zmiany zgodności ze standardami i zabezpieczenia oraz zmiany na podstawie opinii klientów. Większość tych zmian nie wymaga żadnych modyfikacji programistycznych w aplikacjach. Dla tych, które mogą zawierać modyfikacje, zobacz kolumnę zalecane zmiany w tabeli.

W tym temacie opisano znaczące zmiany w następujących obszarach:

- [ASP.NET i sieci Web](#aspnet-and-web)

- [Funkcje podstawowe](#core)

- [Dane](#data)

- [Windows Communication Foundation (WCF)](#windows-communication-foundation-wcf)

- [Windows Presentation Foundation (WPF)](#windows-presentation-foundation-wpf)

- [XML](#xml)

Więcej informacji o problemach w tym temacie znajduje się w [przewodniku migracji do .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff657133%28v=vs.100%29).

Aby uzyskać informacje o nowych funkcjach, zobacz [co nowego w .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms171868%28v=vs.100%29).

## <a name="aspnet-and-web"></a>ASP.NET i Internet

Przestrzenie nazw: <xref:System.Web>, <xref:System.Web.Mobile>, <xref:System.Web.Security>, <xref:System.Web.UI.WebControls>; Zestaw: System. Web (w System. Web. dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Pliki definicji przeglądarki** | Pliki definicji przeglądarki zostały zaktualizowane w celu uwzględnienia informacji o nowych i zaktualizowanych przeglądarkach i urządzeniach. Zostały usunięte starsze przeglądarki i urządzenia, takie jak Netscape Navigator, i dodano nowsze przeglądarki i urządzenia, takie jak Google Chrome i Apple iPhone.<br><br>Jeśli aplikacja zawiera niestandardowe definicje przeglądarki dziedziczące z jednej z definicji przeglądarki, które zostały usunięte, zostanie wyświetlony komunikat o błędzie.<br><br>Obiekt <xref:System.Web.HttpBrowserCapabilities> (który jest udostępniany przez właściwość `Request.Browse` strony) jest oparty na plikach definicji przeglądarki. W związku z tym informacje zwracane przez uzyskanie dostępu do właściwości tego obiektu w ASP.NET 4 mogą różnić się od informacji, które zostały zwrócone we wcześniejszej wersji ASP.NET. | Jeśli aplikacja korzysta ze starych plików definicji przeglądarki, można je skopiować z następującego folderu:<br><br>*Windows\\Microsoft.NET\\Framework\\2.0.50727\\CONFIG\\*<br><br>Skopiuj pliki do odpowiedniego folderu *\\CONFIG\\browsers* for ASP.NET 4. Po skopiowaniu plików uruchom narzędzie wiersza polecenia [Aspnet_regbrowsers. exe](https://docs.microsoft.com/previous-versions/dotnet/netframework-3.5/ms229858(v=vs.90)) . Aby uzyskać więcej informacji, zobacz witrynę sieci Web [https://www.asp.net/mobile](/aspnet/mobile/overview) . |
| **Aplikacje podrzędne działające w ramach mieszanych wersji programu ASP.NET** | Nie można uruchomić aplikacji ASP.NET 4, które są skonfigurowane jako elementy podrzędne aplikacji, które działają we wcześniejszych wersjach programu ASP.NET z powodu błędów konfiguracji lub kompilacji. Konkretny błąd zależy od tego, czy aplikacja działa w ramach usług IIS 6,0, czy w ramach usług IIS 7 lub IIS 7,5. | Można wprowadzać zmiany w plikach konfiguracji odpowiednich aplikacji, aby system konfiguracji prawidłowo rozpoznawał aplikację ASP.NET 4. Aby uzyskać informacje o zmianach, które należy wykonać, zobacz sekcję "aplikacje podrzędne ASP.NET 4 nie mogą zostać uruchomione, gdy w obszarze ASP.NET 2,0 lub ASP.NET 3,5 aplikacje" w dokumencie [ASP.NET 4 zmiany](/aspnet/whitepapers/aspnet4/breaking-changes) w witrynie sieci Web ASP.NET. |
| **ClientID zmiany** | Nowe ustawienie `clientIDMode` w ASP.NET 4 pozwala określić sposób, w jaki ASP.NET generuje atrybut `id` dla elementów HTML. W poprzednich wersjach ASP.NET zachowanie domyślne było równoważne ustawieniem `AutoID` `clientIDMode`. Ustawienie domyślne jest teraz `Predictable`. Aby uzyskać więcej informacji, zobacz [Identyfikacja kontrolki serwera sieci Web ASP.NET](https://docs.microsoft.com/previous-versions/aspnet/1d04y8ss%28v=vs.100%29). | Jeśli używasz programu Visual Studio do uaktualnienia aplikacji z ASP.NET 2,0 lub ASP.NET 3,5, narzędzie automatycznie dodaje ustawienie do pliku Web. config, który zachowuje zachowanie wcześniejszych wersji .NET Framework. Jednak w przypadku uaktualniania aplikacji przez zmianę puli aplikacji w programie IIS na wartość docelową .NET Framework 4, ASP.NET domyślnie używa trybu nowy. Aby wyłączyć nowy tryb identyfikatora klienta, Dodaj następujące ustawienie do pliku Web. config:<br><br>`<pages clientIDMode="AutoID" />` |
| **Zabezpieczenia dostępu kodu (CAS)** | Funkcje sieci ASP.NET 2,0, które zostały dodane w ASP.NET 3,5, korzystają z modelu .NET Framework 1,1 i .NET Framework 2,0 zabezpieczenia dostępu kodu (CAS). Jednakże implementacja urzędów certyfikacji w ASP.NET 4 została znacząco przestawiona. Z tego powodu aplikacje ASP.NET częściowo zaufane, które opierają się na zaufanym kodzie uruchomionym w globalnej pamięci podręcznej zestawów, mogą zakończyć się niepowodzeniem z różnymi wyjątkami zabezpieczeń. Aplikacje częściowej relacji zaufania, które opierają się na rozległych modyfikacjach zasad CAS komputera, mogą również kończyć się niepowodzeniem i generować wyjątki zabezpieczeń. | Można przywrócić częściowe zaufanie ASP.NET 4 aplikacji do zachowania ASP.NET 1,1 i 2,0 przy użyciu nowego atrybutu `legacyCasModel` w elemencie konfiguracji `trust`, jak pokazano w następującym przykładzie:<br><br>`<trust level= "Medium" legacyCasModel="true" />`<br><br>Ważne: powrót do starszego modelu CAS może reprezentować mniejsze zabezpieczenia.<br><br>Aby uzyskać więcej informacji na temat nowego modelu zabezpieczeń dostępu kodu ASP.NET 4, zobacz [zabezpieczenia dostępu kodu w aplikacjach ASP.NET 4](https://docs.microsoft.com/previous-versions/dd984947(v=vs.100)). |
| **Pliki konfiguracji** | Pliki konfiguracji głównej (plik Machine. config i główny plik Web. config) dla .NET Framework i ASP.NET 4 zostały zaktualizowane w celu uwzględnienia większości standardowych informacji konfiguracyjnych znalezionych w plikach Web. config aplikacji w ASP.NET 3,5. Ze względu na złożoność zarządzanych systemów konfiguracyjnych usług IIS 7 i usług IIS 7,5, na których działają aplikacje ASP.NET 3,5 w ASP.NET 4 i w usługach IIS 7 i IIS 7,5 mogą wystąpić błędy ASP.NET lub błędy usług IIS. | Uaktualnij aplikacje ASP.NET 3,5 do ASP.NET 4 przy użyciu narzędzi uaktualniania projektu w programie Visual Studio. Program Visual Studio 2010 automatycznie modyfikuje plik Web. config aplikacji ASP.NET 3,5 w taki sposób, aby zawierał odpowiednie ustawienia dla ASP.NET 4.<br><br>Można jednak uruchamiać aplikacje ASP.NET 3,5 przy użyciu .NET Framework 4 bez ponownej kompilacji. W takim przypadku może być konieczne ręczne zmodyfikowanie pliku Web. config aplikacji przed uruchomieniem aplikacji w .NET Framework 4 i w usługach IIS 7 lub IIS 7,5. Wymagana zmiana musi być zależna od kombinacji oprogramowania, z którym pracujesz, wraz z wersjami dodatku Service Pack (SP). Aby uzyskać informacje o możliwych kombinacjach oprogramowania, których dotyczy ta zmiana, oraz sposobie rozwiązywania problemów z określonymi kombinacjami, zobacz sekcję "błędy konfiguracji dotyczące nowej konfiguracji głównej ASP.NET 4" w dokumencie [ASP.NET 4 Istotne zmiany](/aspnet/whitepapers/aspnet4/breaking-changes) w witrynie sieci Web ASP.NET. |
| **Renderowanie kontrolki** | W poprzednich wersjach programu ASP.NET niektóre kontrolki emitują adiustację, której nie można wyłączyć. Domyślnie ten typ znaczników nie jest już generowany w ASP.NET 4. Zmiany renderowania mają wpływ na następujące kontrolki:<br><br>* `Image` i `ImageButton` formantów nie renderuje już atrybutu `border="0"`.<br>* Klasa `BaseValidator` i kontrolki walidacji, które pochodzą od niej, nie domyślnie renderują czerwony tekst.<br>* Formant `HtmlForm` nie renderuje atrybutu `name`.<br>* Formant `Table` nie renderuje już atrybutu `border="0"`.<br><br>Kontrolki, które nie są przeznaczone do wprowadzania danych przez użytkownika (na przykład kontrolka `Label`), nie są już renderowane atrybut `disabled="disabled"`, jeśli ich Właściwość `Enabled` jest ustawiona na `false` (lub jeśli dziedziczy to ustawienie z kontrolki kontenera). | Jeśli używasz programu Visual Studio do uaktualnienia aplikacji z wersji ASP.NET 2,0 lub ASP.NET 3,5, narzędzie automatycznie dodaje ustawienie do pliku Web. config, który zachowuje starsze funkcje renderowania. Jednak w przypadku uaktualniania aplikacji przez zmianę puli aplikacji w programie IIS na wartość docelową .NET Framework 4, ASP.NET domyślnie korzysta z nowego trybu renderowania. Aby wyłączyć nowy tryb renderowania, Dodaj następujące ustawienie do pliku Web. config:<br><br>`<pages controlRenderingCompatibilityVersion="3.5" />` |
| **Programy obsługi zdarzeń w dokumentach domyślnych** | ASP.NET 4 renderuje `action` wartość atrybutu w kodzie `form` HTML jako pusty ciąg, gdy zostanie wysłane żądanie do bezwzględnego adresu URL, który ma przypisany do niego dokument domyślny. W starszych wersjach ASP.NET żądanie do `http://contoso.com` mogłoby spowodować żądanie do default. aspx. W tym dokumencie tag `form` otwierającej będzie renderowany jak w poniższym przykładzie:<br><br>`<form action="Default.aspx" />`<br><br>W ASP.NET 4, żądanie do `http://contoso.com` również powoduje żądanie do pliku default. aspx, ale ASP.NET teraz renderuje Tagi HTML otwierającego `form` jak w poniższym przykładzie:<br><br>`<form action="" />`<br><br>Gdy atrybut `action` jest pustym ciągiem, obiekt `DefaultDocumentModule` IIS tworzy żądanie podrzędne do default. aspx. W większości warunków to żądanie podrzędne jest niewidoczne dla kodu aplikacji, a domyślna strona. aspx działa normalnie. Jednak potencjalna interakcja między zarządzanym kodem i usługami IIS 7 lub IIS 7,5 może spowodować, że zarządzane strony. aspx przestaną działać prawidłowo podczas żądania podrzędnego. W przypadku wystąpienia następujących warunków żądanie podrzędne do domyślnego dokumentu. aspx spowoduje błąd lub w nieoczekiwanym zachowaniu:<br><br>* Strona. aspx jest wysyłana do przeglądarki z atrybutem `action` elementu `form` ustawionym na "".<br>* Formularz zostanie opublikowany z powrotem do ASP.NET.<br>* Zarządzany moduł HTTP odczytuje część treści jednostki, na przykład `Request.Form` lub `Request.Params`. Powoduje to, że treść jednostki żądania POST ma zostać odczytana do pamięci zarządzanej. W związku z tym treść jednostki nie jest już dostępna dla żadnych modułów kodu natywnego, które działają w trybie zintegrowanym usług IIS 7 lub IIS 7,5.<br>* `DefaultDocumentModule` obiektu IIS zostanie uruchomiony i utworzy żądanie podrzędne do domyślnego dokumentu. aspx. Jednak ponieważ treść jednostki została już odczytana przez fragment kodu zarządzanego, nie istnieje żadna treść jednostki do wysłania do żądania podrzędnego.<br>* Gdy potok HTTP jest uruchamiany dla żądania podrzędnego, program obsługi plików. aspx jest uruchamiany podczas fazy wykonywania procedury obsługi.<br><br>Ponieważ nie ma treści jednostki, nie ma żadnych zmiennych formularzy i nie ma stanu widoku. W związku z tym nie ma informacji dostępnych dla programu obsługi stron. aspx, aby określić, jakie zdarzenie (jeśli istnieje) powinno zostać zgłoszone. W związku z tym żaden z programów obsługi zdarzeń ogłaszania zwrotnego nie zostanie uruchomiony na stronie, której dotyczy. | Aby uzyskać informacje o sposobach obejścia problemów, które mogą wystąpić w wyniku tej zmiany, zobacz "programy obsługi zdarzeń mogą nie zostać zgłoszone w dokumencie domyślnym w programie IIS 7 lub w trybie zintegrowanym usług IIS 7,5" w dokumencie [ASP.NET 4 zmiany](/aspnet/whitepapers/aspnet4/breaking-changes) w sieci Web ASP.NET lokacji. |
| **Algorytm wyznaczania wartości skrótu** | ASP.NET używa algorytmów szyfrowania i wyznaczania wartości skrótu, aby zabezpieczyć dane, takie jak pliki cookie uwierzytelniania formularzy i stan widoku. Domyślnie ASP.NET 4 używa algorytmu <xref:System.Security.Cryptography.HMACSHA256> dla operacji skrótu dla plików cookie i stanu widoku. We wcześniejszych wersjach ASP.NET użyto starszego algorytmu <xref:System.Security.Cryptography.HMACSHA1>. | Jeśli uruchamiasz aplikacje, które mieszają ASP.NET 2,0 i ASP.NET 4, gdzie dane takie jak pliki cookie uwierzytelniania formularzy muszą działać w różnych wersjach .NET Framework, skonfiguruj aplikację sieci Web ASP.NET 4, aby użyć starszego algorytmu <xref:System.Security.Cryptography.HMACSHA1> przez dodanie następującego ustawienia w Plik Web. config:<br><br>`<machineKey validation="SHA1" />` |
| **Hostowanie formantów w programie Internet Explorer** | W programie Internet Explorer nie można już hostować formantów Windows Forms, ponieważ istnieją lepsze rozwiązania hostingu formantów w sieci Web. W związku z tym zestawy IEHost. dll i IEExec. exe zostały usunięte z .NET Framework. | Możesz użyć następujących technologii do tworzenia niestandardowych kontrolek w aplikacjach sieci Web:<br><br>* Można utworzyć aplikację Silverlight i skonfigurować ją do uruchamiania poza przeglądarką. Aby uzyskać więcej informacji, zobacz [Obsługa braku przeglądarki](https://docs.microsoft.com/previous-versions/windows/silverlight/dotnet-windows-silverlight/dd550721%28v=vs.95%29).<br>* Możesz skompilować aplikację przeglądarki XAML (XBAP), aby korzystać z możliwości platformy WPF (wymaga .NET Framework na komputerach klienckich). Aby uzyskać więcej informacji, zobacz [Omówienie aplikacji w przeglądarce WPF XAML](../wpf/app-development/wpf-xaml-browser-applications-overview.md). |
| **Metody HtmlEncode i UrlEncode** | Metody `HtmlEncode` i `UrlEncode` klas <xref:System.Web.HttpUtility> i <xref:System.Web.HttpServerUtility> zostały zaktualizowane w celu zakodowania znaku pojedynczego cudzysłowu (') w następujący sposób:<br><br>* Metoda `HtmlEncode` koduje wystąpienia pojedynczego cudzysłowu jako `&#39;`<br>* Metoda `UrlEncode` koduje wystąpienia pojedynczego cudzysłowu jako `%27` | Sprawdź swój kod dla miejsc, w których używasz metod `HtmlEncode` i `UrlEncode` i upewnij się, że zmiana kodowania nie powoduje zmiany, która mogłaby mieć wpływ na aplikację. |
| **Błędy HttpException w aplikacjach ASP.NET 2,0** | Po włączeniu ASP.NET 4 w usługach IIS 6, ASP.NET 2,0, które działają w usługach IIS 6 (w systemie Windows Server 2003 lub Windows Server 2003 R2), mogą generować następujące błędy: `System.Web.HttpException: Path '/[yourApplicationRoot]/eurl.axd/[Value]' was not found.` | * Jeśli ASP.NET 4 nie jest wymagany do uruchomienia witryny sieci Web, należy ponownie zamapować lokację, tak aby korzystała z ASP.NET 2,0.<br><br>—lub—<br><br>* Jeśli ASP.NET 4 jest wymagany do uruchomienia witryny sieci Web, Przenieś wszystkie podrzędne katalogi wirtualne ASP.NET 2,0 do innej witryny sieci Web, która jest mapowana na ASP.NET 2,0.<br><br>—lub—<br><br>* Wyłącz adresy URL bezrozszerzenia. Aby uzyskać więcej informacji, zobacz "aplikacje ASP.NET 2,0 mogą generować błędy HttpException odwołujące się do EURL. axd" w dokumencie [ASP.NETe zmiany](/aspnet/whitepapers/aspnet4/breaking-changes) w witrynie sieci Web ASP.NET. |
| **Typy członkostwa** | Niektóre typy (na przykład <xref:System.Web.Security.MembershipProvider>), które są używane w członkostwie ASP.NET, zostały przeniesione z pliku System. Web. dll do zestawu System. Web. ApplicationServices. dll. Typy zostały przeniesione w celu rozwiązania zależności między typami w kliencie a rozszerzonymi jednostkami SKU .NET Framework. | Biblioteki klas, które zostały uaktualnione z wcześniejszych wersji programu ASP.NET i które używają typów członkostwa, które zostały przeniesione, mogą nie zostać skompilowane, gdy są używane w projekcie ASP.NET 4. Jeśli tak, Dodaj odwołanie w projekcie biblioteki klas do System. Web. ApplicationServices. dll. |
| **Zmiany kontrolki menu** | Zmiany w formancie <xref:System.Web.UI.WebControls.Menu> powodują następujące zachowanie:<br><br>* Jeśli <xref:System.Web.UI.WebControls.MenuRenderingMode> jest ustawiona na `List`, lub jeśli <xref:System.Web.UI.WebControls.MenuRenderingMode> jest ustawiona na `Default` i <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> jest ustawiona na `4.0` lub nowszą, właściwość <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> nie ma żadnego wpływu.<br>* Jeśli ścieżka ustawiona w <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> i <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> właściwości zawiera ukośnik odwrotny (\\), obrazy nie są renderowane. (We wcześniejszych wersjach ASP.NET ścieżka może zawierać ukośnik odwrotny). | * Zamiast ustawiania właściwości <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> dla poszczególnych elementów menu, ustaw <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> lub <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> formantu <xref:System.Web.UI.WebControls.Menu> nadrzędnego.<br><br>—lub—<br><br>Ustaw <xref:System.Web.UI.WebControls.MenuRenderingMode> na `Table`lub ustaw <xref:System.Web.UI.WebControls.MenuRenderingMode> na `Default` i ustaw <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> na `3.5`. Te ustawienia powodują, że formant <xref:System.Web.UI.WebControls.Menu> używa układu opartego na tabeli HTML, który był używany we wcześniejszych wersjach ASP.NET.<br>* Jeśli ścieżka we właściwości <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> lub <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> zawiera ukośnik odwrotny (\\), Zastąp znak ukośnika (/). |
| **Zestaw mobilny w pliku Web. config** | W poprzednich wersjach programu ASP.NET odwołanie do zestawu System. Web. Mobile. dll zostało dołączone do głównego pliku Web. config w sekcji `assemblies` w obszarze `system.web`/`compilation`. Aby zwiększyć wydajność, odwołanie do tego zestawu zostało usunięte.<br><br>Uwaga: zestaw system. Web. Mobile. dll i ASP.NET Mobile Controls są zawarte w ASP.NET 4, ale są przestarzałe. | Jeśli chcesz użyć typów z tego zestawu, Dodaj odwołanie do zestawu w głównym pliku Web. config lub w pliku Web. config aplikacji. |
| **Buforowanie danych wyjściowych** | W programie ASP.NET 1,0 usterka spowodowała przeprowadzenie zbuforowanych stron, które zostały określone `Location="ServerAndClient"` jako dane wyjściowe "ustawienia pamięci podręcznej" do emisji `Vary:*` nagłówka HTTP w odpowiedzi. Miało to wpływ na to, że przeglądarki klienta nigdy nie buforują strony lokalnie. W ASP.NET 1,1 Dodano metodę <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A>, która może być wywoływana w celu pomijania nagłówka `Vary:*`. Jednak raporty o usterkach sugerują, że deweloperzy nie znają istniejących zachowań `SetOmitVaryStar`.<br><br>W ASP.NET 4 nagłówek HTTP `Vary:*` nie jest już emitowany z odpowiedzi, które określają następującą dyrektywę:<br><br>`<%@ OutputCache Location="ServerAndClient" %>`<br><br>W związku z tym Metoda <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A> nie jest już wymagana, aby pominąć nagłówek `Vary:*`. W aplikacjach, które określają "ServerAndClient" dla atrybutu `Location`, strony będą buforowane w przeglądarce bez konieczności wywoływania <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A>. | Jeśli strony w aplikacji muszą emitować `Vary:*`, wywołaj metodę <xref:System.Web.HttpResponse.AppendHeader%2A>, jak pokazano w następującym przykładzie:<br><br>`System.Web.HttpResponse.AppendHeader("Vary","*");`<br><br>Alternatywnie można zmienić wartość atrybutu wyjściowej pamięci podręcznej `Location` na "serwer". |
| **Analizowanie strony** | Analizator stron dla stron sieci Web ASP.NET (pliki. aspx) i kontrolki użytkownika (pliki. ascx) są bardziej rygorystyczne w ASP.NET 4 niż we wcześniejszych wersjach ASP.NET, i flaguje więcej znaczników jako nieprawidłowych niż we wcześniejszych wersjach. | Badaj komunikaty o błędach, które są generowane, gdy strona jest uruchamiana i naprawia błędy wynikające z nieprawidłowego oznaczenia. |
| **Typy paszportów** | Obsługa paszportów wbudowana w ASP.NET 2,0 jest przestarzała i nie jest obsługiwana ze względu na zmiany w usłudze Passport (teraz dynamiczny Identyfikator SDK). W związku z tym typy związane z paszportem w <xref:System.Web.Security> są teraz oznaczone atrybutem `ObsoleteAttribute`. | Zmień dowolny kod korzystający z typów paszportów w przestrzeni nazw <xref:System.Web.Security> (na przykład <xref:System.Web.Security.PassportIdentity>), aby użyć [zestawu SDK](https://go.microsoft.com/fwlink/?LinkId=106346). |
| **PathInfo informacje we właściwości FilePath** | ASP.NET 4 nie zawiera już wartości `PathInfo` w wartościach zwracanych z właściwości, takich jak <xref:System.Web.HttpRequest.FilePath>, <xref:System.Web.HttpRequest.AppRelativeCurrentExecutionFilePath>i <xref:System.Web.HttpRequest.CurrentExecutionFilePath>. Zamiast tego informacje `PathInfo` są dostępne w <xref:System.Web.HttpRequest.PathInfo>. Załóżmy na przykład następujący fragment adresu URL:<br><br>`/testapp/Action.mvc/SomeAction`<br><br>We wcześniejszych wersjach ASP.NET <xref:System.Web.HttpRequest> właściwości mają następujące wartości:<br><br>* <xref:System.Web.HttpRequest.FilePath>: `/testapp/Action.mvc/SomeAction`<br>* <xref:System.Web.HttpRequest.PathInfo>: (puste)<br><br>W ASP.NET 4 właściwości <xref:System.Web.HttpRequest> powinny mieć następujące wartości:<br><br>* <xref:System.Web.HttpRequest.FilePath>: `/testapp/Action.mvc`<br>* <xref:System.Web.HttpRequest.PathInfo>: `SomeAction` | Sprawdź swój kod dla miejsc, w których opierasz się na właściwościach klasy <xref:System.Web.HttpRequest>, aby zwracać informacje o ścieżce; Zmień kod, aby odzwierciedlić zmiany w sposobie zwracania informacji o ścieżce. |
| **Żądaj weryfikacji** | Aby poprawić sprawdzanie poprawności żądań, weryfikacja żądania ASP.NET jest wywoływana wcześniej w cyklu życia żądania. W związku z tym sprawdzanie poprawności żądań jest przeprowadzane w przypadku żądań, które nie są przeznaczone dla plików aspx, na przykład dla wywołań usługi sieci Web i niestandardowych programów obsługi. Sprawdzanie poprawności żądań będzie również aktywne, gdy niestandardowe moduły HTTP działają w potoku przetwarzania żądań.<br><br>W wyniku tej zmiany żądania dotyczące zasobów innych niż pliki aspx mogą zgłosić błędy walidacji żądania. Kod niestandardowy, który jest uruchamiany w potoku żądania (na przykład niestandardowe moduły HTTP), może również generować błędy walidacji żądania. | W razie potrzeby można powrócić do starego zachowania dla wszystkich stron aspx wyzwalających weryfikację żądań przy użyciu następującego ustawienia w pliku konfiguracji sieci Web:<br><br>`<httpRuntime requestValidationMode="2.0" />`<br><br>Ostrzeżenie: w przypadku przywrócenia starego zachowania upewnij się, że cały kod istniejących programów obsługi, modułów i innego kodu niestandardowego sprawdza potencjalnie niebezpieczne dane wejściowe HTTP, które mogą być nosicielami ataków typu XSS. |
| **Routing** | W przypadku tworzenia witryny sieci Web systemu plików w programie Visual Studio 2010, a witryna sieci Web znajduje się w folderze zawierającym kropkę (.) w nazwie folderu, routing adresów URL nie działa w sposób niezawodny. W niektórych ścieżkach wirtualnych jest zwracany błąd HTTP 404. Dzieje się tak, ponieważ program Visual Studio 2010 uruchamia serwer programistyczny programu Visual Studio przy użyciu nieprawidłowej ścieżki dla głównego katalogu wirtualnego. | * Na stronie **Właściwości** witryny sieci Web opartej na plikach Zmień wartość atrybutu **ścieżka wirtualna** na "/".<br><br>—lub—<br><br>* Utwórz projekt aplikacji sieci Web, a nie projekt witryny sieci Web. Projekty aplikacji sieci Web nie mają tego problemu, a Routing adresów URL działa nawet wtedy, gdy nazwa folderu projektu jest kropką.<br><br>—lub—<br><br>* Utwórz witrynę sieci Web opartą na protokole HTTP, która jest hostowana w usługach IIS. Witryny sieci Web hostowane przez usługi IIS mogą zawierać kropki w ścieżce wirtualnej, a także w folderze plików projektu. |
| **Witryny programu SharePoint** | Jeśli spróbujesz uruchomić witrynę sieci Web ASP.NET 4, która jest wdrażana jako podrzędna witryna sieci Web programu SharePoint, która zawiera niestandardowy poziom zaufania częściowego o nazwie `WSS_Minimal`, zostanie wyświetlony następujący błąd:<br><br>`Could not find permission set named 'ASP.Net'.` | Obecnie żadna wersja programu SharePoint nie jest zgodna z ASP.NET. W związku z tym nie należy próbować uruchamiać witryny sieci Web ASP.NET 4 jako elementu podrzędnego witryny sieci Web programu SharePoint. |
| **Standardy XHTML 1,1** | Aby włączyć zgodność XHTML 1,1 dla nowych witryn sieci Web, formanty ASP.NET w .NET Framework 4 generują kod HTML zgodny z XHTML 1,1. To renderowanie jest włączone przy użyciu następującej opcji w pliku Web. config wewnątrz elementu `<system.Web>`:<br><br>`<pages controlRenderingCompatibilityVersion="4.0"/>`<br><br>Ta opcja jest domyślnie ustawiona na 4,0. Projekty sieci Web, które są uaktualnione z programu Visual Studio 2008, mają włączone ustawienie 3,5. | Brak. |

## <a name="core"></a>Core

### <a name="general-features"></a>Funkcje ogólne

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **CardSpace** | Windows CardSpace nie jest już uwzględniony w .NET Framework; jest on dostarczany osobno. | Pobierz program Windows CardSpace z [Centrum pobierania Microsoft](https://go.microsoft.com/fwlink/?LinkId=199868). |
| **Pliki konfiguracji** | Wprowadzono poprawki dotyczące sposobu, w jaki .NET Framework uzyskać dostęp do plików konfiguracji aplikacji. | Jeśli plik konfiguracyjny aplikacji ma nazwę *Application-Name. config*, zmień jej nazwę na *Application-Name. exe. config*. Na przykład zmień nazwę *pliku Mojaapl. config* na *MojaApl. exe. config*. |
| **C#kompilator kodu** | Klasy `Compiler`, `CompilerError`i `ErrorLevel`, które znajdowały się w przestrzeni nazw <xref:Microsoft.CSharp>, nie są już dostępne, a ich zestawy (cscompmgd. dll) nie są już uwzględnione w .NET Framework. | Użyj klasy <xref:System.CodeDom.Compiler.CodeDomProvider> i innych klas w przestrzeni nazw <xref:System.CodeDom.Compiler>. Aby uzyskać więcej informacji, zobacz [użycie CodeDOM](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/y2k85ax6%28v=vs.100%29). |
| **Hosting** (Niezarządzany interfejs API) | Aby zwiększyć możliwości hostingu, niektóre interfejsy API aktywacji hostingu są przestarzałe. Wbudowane funkcje wykonywania równoczesnego umożliwiają aplikacji ładowanie i uruchamianie wielu wersji .NET Framework w tym samym procesie. Na przykład można uruchamiać aplikacje, które ładują Dodatki (lub składniki) oparte na .NET Framework 2,0 SP1 i dodatkach, które są oparte na .NET Framework 4 w tym samym procesie. Starsze składniki nadal korzystają ze starszej wersji .NET Framework, a nowe składniki używają nowej wersji .NET Framework. | Użyj konfiguracji opisanych w [procesie wykonywania równoczesnego](../deployment/in-process-side-by-side-execution.md). |
| **Nowy model zabezpieczeń** | Zasady zabezpieczeń dostępu kodu (CAS) zostały wyłączone i zastąpione uproszczonym modelem, zgodnie z opisem w temacie [zmiany zabezpieczeń w .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd233103%28v=vs.100%29). | Zmiany mogą być wymagane, jeśli są zależne od urzędów certyfikacji w aplikacjach. Aby uzyskać więcej informacji, zobacz temat [zgodność i migracja zasad zabezpieczeń dostępu kodu](../misc/code-access-security-policy-compatibility-and-migration.md). |

### <a name="date-and-time"></a>Data i godzina

Przestrzeń nazw: <xref:System>; Zestaw: mscorlib (w bibliotece Mscorlib. dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Oszczędności czasu letniego** | Aby zachować spójność z zegarem systemowym, właściwościami czasu (na przykład <xref:System.TimeZoneInfo.Local> i <xref:System.DateTime.Now>) używają teraz reguł systemu operacyjnego zamiast innych .NET Framework danych dla operacji czasu letniego. | Brak. |
| **Formatowanie ciągów** | Aby zapewnić obsługę formatowania z uwzględnieniem kultur, struktura <xref:System.TimeSpan> obejmuje nowe przeciążenia metod `ToString`, `Parse`i `TryParse` oprócz nowych metod `ParseExact` i `TryParseExact`. | Brak. |

### <a name="globalization"></a>Globalizacja

Aby zapoznać się z listą nowych kultur neutralnych i specyficznych, zobacz [co nowego w globalizacji i lokalizacji](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd997383%28v=vs.100%29).

Przestrzeń nazw: <xref:System.Globalization>; Zestaw: mscorlib (w bibliotece Mscorlib. dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Nazwy kultur** | Następujące zmiany nazw mają wpływ na kulturę niemiecką, malediwski i Afrykańskią:<br><br>* <xref:System.Globalization.CultureAndRegionInfoBuilder.CurrencyEnglishName>: nazwa waluty dla kultury niemieckiej (Switizerland) (de-CH) została zmieniona z "sFr". na "fr".<br>* <xref:System.Globalization.DateTimeFormatInfo.LongDatePattern>: wzorzec daty długiej dla kultury Malediwski (Malediwów) (DV-MV) zmienił się z "dd/MMMM/RRRR" na "DD/MM/RRRR".<br>* <xref:System.Globalization.DateTimeFormatInfo.PMDesignator>: P.M. oznaczenie kultury Afrikaans (Republika Południowej Afryki) (AF-w) zostało zmienione z "nm" na "PM". | Zwróć uwagę na zmiany nazw kultur. |
| **Parametr LCID** | Aby zapewnić spójność z oczekiwanym zachowaniem w ustawieniach serwera automatyzacji, środowisko CLR nie przekazuje już bieżącej kultury dla `LCID` parametru do niezarządzanych aplikacji opartych na modelu COM. Zamiast tego przechodzą 1033 (EN-US) dla kultury. | Nie trzeba modyfikować żadnych modyfikacji z wyjątkiem aplikacji natywnych, które wymagają określonej kultury. |
| **Przestarzałe typy kultur** | Typy kultur <xref:System.Globalization.CultureTypes> i <xref:System.Globalization.CultureTypes> są obecnie przestarzałe.<br><br>W celu zapewnienia zgodności z poprzednimi wersjami <xref:System.Globalization.CultureTypes> teraz zwraca neutralną i charakterystyczną kulturę, które zostały dołączone do poprzedniej .NET Framework, a <xref:System.Globalization.CultureTypes> teraz zwraca pustą listę. | Użyj innych wartości wyliczenia <xref:System.Globalization.CultureTypes>. |
| **Pobieranie kultury** | Począwszy od systemu Windows 7, .NET Framework 4 pobiera informacje o kulturze z systemu operacyjnego, zamiast przechowywać same dane. Ponadto .NET Framework synchronizuje się z systemem Windows w celu sortowania i wielkości liter. | Brak. |
| **Standardy Unicode 5,1** | .NET Framework obsługuje teraz wszystkie znaki Unicode 5,1--dodanie około 1400 znaków. Dodatkowe znaki to nowe symbole, strzałki, znaki diakrytyczne, interpunkcja, symbole matematyczne, pociągnięcia CJK i ideogramy, dodatkowe znaki w języku malajalam i telugu, a także różne Myanmary, łaciński, arabski, grecki, mongolski i cyrylica znaków. Następujące nowe skrypty są obsługiwane w standardzie Unicode 5,1: Sundanese, Lepcha, OL Chiki, Vai, saurashtra, Kayah li, Rejang, Gurmukhi, Odia, | Brak. |

### <a name="exceptions"></a>Wyjątki

Przestrzenie nazw: <xref:System>, <xref:System.Runtime.ExceptionServices>; Zestaw: mscorlib (w bibliotece Mscorlib. dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Wyjątki dotyczące uszkodzonego stanu procesu** | Środowisko CLR nie dostarcza już wyjątków dla uszkodzonego stanu procesu do obsługi wyjątków w kodzie zarządzanym. | Te wyjątki wskazują, że stan procesu został uszkodzony. Nie zalecamy uruchamiania aplikacji w tym stanie.<br><br>Aby uzyskać więcej informacji, zapoznaj się z tematem <xref:System.Runtime.ExceptionServices.HandleProcessCorruptedStateExceptionsAttribute> i wpisy związane z [uszkodzonym stanem](https://go.microsoft.com/fwlink/?LinkID=179681) w środowisku CLR. |
| **Wyjątki aparatu wykonywania** | <xref:System.ExecutionEngineException> jest obecnie przestarzały, ponieważ do przechwycenia wyjątku zostanie uruchomiony niestabilny proces. Ta zmiana poprawia przewidywalność i niezawodność w środowisku uruchomieniowym. | Użyj <xref:System.InvalidOperationException>, aby sygnalizować warunek. |

### <a name="reflection"></a>Odbicie

Przestrzeń nazw: <xref:System.Reflection>; Zestaw: mscorlib (w bibliotece Mscorlib. dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Algorytmy skrótu zestawu** | Właściwość <xref:System.Reflection.AssemblyName.HashAlgorithm> teraz zwraca <xref:System.Configuration.Assemblies.AssemblyHashAlgorithm>, ponieważ środowisko uruchomieniowe nie zna algorytmu wyznaczania wartości skrótu przywoływanego zestawu, gdy zestaw nie jest załadowany. (Dotyczy to użycia właściwości w przywoływanym zestawie, takiej jak zwracany przez metodę <xref:System.Reflection.Assembly.GetReferencedAssemblies%2A>). | Brak. |
| **Ładowanie zestawu** | Aby uniknąć nadmiarowego ładowania zestawów i zapisywania wirtualnej przestrzeni adresowej, środowisko CLR ładuje teraz zestawy za pomocą tylko funkcji Win32 `MapViewOfFile`. Nie jest już również wywoływana funkcja `LoadLibrary`.<br><br>Ta zmiana wpływa na aplikacje diagnostyczne w następujący sposób:<br><br>* <xref:System.Diagnostics.ProcessModuleCollection> nie będzie już zawierał żadnych modułów z biblioteki klas (plik. dll) uzyskanych od wywołania do `Process.GetCurrentProcess().Modules`.<br>* Aplikacje Win32 używające funkcji `EnumProcessModules` nie będą widzieć wszystkich wymienionych modułów zarządzanych. | Brak. |
| **Typ deklarujący** | Właściwość <xref:System.Type.DeclaringType> teraz zwraca wartość null, jeśli typ nie ma typu deklarującego. | Brak. |
| **Delegaci** | Delegat teraz zgłasza <xref:System.ArgumentNullException> zamiast <xref:System.NullReferenceException>, gdy wartość null zostanie przeniesiona do konstruktora delegata. | Upewnij się, że dowolna obsługa wyjątków przechwytuje <xref:System.ArgumentNullException>. |
| **Zmiana lokalizacji globalnej pamięci podręcznej zestawów** | W przypadku zestawów .NET Framework 4 globalna pamięć podręczna zestawów została przeniesiona z katalogu systemu Windows (% WINDIR%) do podkatalogu Microsoft.Net ( *% windir%\\Microsoft.NET*). Zestawy z wcześniejszych wersji pozostają w starszym katalogu.<br><br>Niezarządzana Wyliczenie [ASM_CACHE_FLAGS](../unmanaged-api/fusion/asm-cache-flags-enumeration.md) zawiera nową flagę `ASM_CACHE_ROOT_EX`. Ta flaga Pobiera lokalizację pamięci podręcznej dla zestawów .NET Framework 4, które mogą być uzyskane przez funkcję [GetCachePath —](../unmanaged-api/fusion/getcachepath-function.md) . | Brak, przy założeniu, że aplikacje nie używają jawnych ścieżek do zestawów, które nie są zalecanymi rozwiązaniami. |
| **Narzędzie globalnej pamięci podręcznej zestawów** | [Gacutil. exe (Global Assembly Cache Tool)](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ex0ss12c%28v=vs.100%29) nie obsługuje już podglądu wtyczki powłoki. | Brak. |

### <a name="interoperability"></a>Współdziałanie

Przestrzeń nazw: <xref:System.Runtime.InteropServices>; Zestaw: mscorlib (w bibliotece Mscorlib. dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Długość buforu** (Niezarządzany interfejs API) | Aby zaoszczędzić pamięć, funkcjonalność `pBufferLengthOffset` parametru dla metody [ICorProfilerInfo2:: GetStringLayout —](../unmanaged-api/profiling/icorprofilerinfo2-getstringlayout-method.md) została zmieniona tak, aby pasowała do `pStringLengthOffset` parametru. Oba parametry teraz wskazują lokalizację przesunięcia długości ciągu. Długość buforu została usunięta z reprezentacji klasy String. | Usuń każdą zależność od długości buforu. |
| **Debugowanie JIT** | Aby uprościć rejestrację dla debugowania just-in-Time (JIT), debuger .NET Framework używa teraz tylko klucza rejestru AeDebug, który kontroluje zachowanie debugowania JIT dla kodu natywnego. Spowoduje to następujące zmiany:<br><br>* Nie można już zarejestrować dwóch różnych debugerów dla kodu zarządzanego i natywnego.<br>* Nie można już automatycznie uruchomić debugera dla procesu nieinteraktywnego, ale możesz monitować użytkownika o proces interaktywny.<br>* Nie masz już powiadomienia, gdy uruchomienie debugera nie powiedzie się lub gdy nie ma żadnego zarejestrowanego debugera, który powinien zostać uruchomiony.<br>* Zasady autostartu, które są zależne od interakcji z aplikacją, nie są już obsługiwane. | Dostosuj operacje debugowania zgodnie z potrzebami. |
| **Wywołanie platformy** | Aby zwiększyć wydajność w przypadku współdziałania z kodem niezarządzanym, nieprawidłowe konwencje wywoływania w wywołaniu platformy powodują, że aplikacja nie powiedzie się. W poprzednich wersjach warstwa kierująca rozwiązała te błędy w górę stosu. | Debugowanie aplikacji w programie Microsoft Visual Studio ostrzega o tych błędach, aby można było je poprawić.<br><br>Jeśli masz dane binarne, których nie można zaktualizować, możesz dołączyć element [\<NetFx40_PInvokeStackResilience >](../configure-apps/file-schema/runtime/netfx40-pinvokestackresilience-element.md) w pliku konfiguracji aplikacji, aby umożliwić rozliczenie błędów wywołania w stosie tak, jak w poprzednich wersjach. Może to jednak mieć wpływ na wydajność aplikacji. |
| **Usunięte interfejsy** (Niezarządzany interfejs API) | Aby uniknąć pomylenia deweloperów, następujące interfejsy zostały usunięte, ponieważ nie zapewniały one przydatnych scenariuszy czasu wykonywania, a środowisko CLR nie dostarczyło ani nie akceptuje żadnych implementacji:<br><br>* **INativeImageINativeImageDependency**<br>* **INativeImageInstallInfo**<br>* **INativeImageEvaluate**<br>* **INativeImageConverter**<br>* **ICorModule**<br>* **IMetaDataConverter** | Brak. |

## <a name="data"></a>Dane

W tej sekcji opisano problemy dotyczące migracji dotyczące korzystania z zestawów danych i klientów SQL, serwerów Entity Framework, LINQ to SQL i danych WCF (wcześniej znanych jako ADO.NET Data Services).

### <a name="dataset-and-sql-client"></a>Zestaw danych i klient SQL

W poniższej tabeli opisano ulepszenia dotyczące funkcji, które wcześniej miały ograniczenia lub inne problemy.

Przestrzenie nazw: <xref:System.Data>, <xref:System.Data.Objects.DataClasses>, <xref:System.Data.SqlClient>; Zestawy: System. Data (w System. Data. dll), system. Data. Entity (w System. Data. Entity. dll)

| Funkcja | Różnice od 3,5 SP1 |
| ------- | ------------------------ |
| **Scenariusze POCO** | Interfejs <xref:System.Data.Objects.DataClasses.IRelatedEnd> ma nowe metody zwiększania użyteczności w zwykłych scenariuszach POCO. Te nowe metody przyjmują <xref:System.Object> zamiast jednostki <xref:System.Data.Objects.DataClasses.IEntityWithRelationships> jako parametru. |
| **Edytowanie wierszy** | Metoda <xref:System.Collections.IList.IndexOf%2A>, zaimplementowana przez klasę <xref:System.Data.DataView>, teraz prawidłowo zwraca wartość edytowanego wiersza zamiast zwraca-1. |
| **Zdarzenia** | Zdarzenie <xref:System.Data.DataRowView.PropertyChanged> jest teraz zgłaszane, gdy wiersz jest w stanie zmodyfikowany, a metoda <xref:System.Data.DataRow.RejectChanges%2A> jest wywoływana. Ta zmiana ułatwia tworzenie formantów interfejsu użytkownika, które uwidaczniają zawartość obiektu <xref:System.Data.DataSet>. |
| **Wyjątki** | Metoda <xref:System.Data.SqlClient.SqlCommand.Prepare%2A> teraz zgłasza <xref:System.InvalidOperationException>, gdy połączenie nie zostanie ustawione lub otwarte zamiast <xref:System.NullReferenceException>. |
| **Mapowanie widoków** | Błędy mapowania widoku zapytania są teraz przechwytywane w czasie projektowania zamiast zgłaszać <xref:System.NullReferenceException> w czasie wykonywania.<br><br>Sprawdzanie poprawności mapowania teraz przechwytuje błąd, w którym dwa zestawy skojarzeń w schemacie koncepcyjnym są zamapowane na tę samą kolumnę. |
| **Transakcje** | Jeśli aplikacja próbuje wykonać instrukcję w przypadku połączenia po zakończeniu transakcji (w tym przerwanych lub wycofywanych), zostanie zgłoszony <xref:System.InvalidOperationException>. Poprzednie wersje nie zgłosiły wyjątku i umożliwiają wykonywanie dodatkowych poleceń nawet wtedy, gdy transakcja została przerwana. |

### <a name="entity-framework"></a>Entity Framework

W poniższej tabeli opisano ulepszenia dotyczące funkcji, które wcześniej miały ograniczenia lub inne problemy.

Przestrzenie nazw: <xref:System.Data>, <xref:System.Data.Objects>, <xref:System.Data.Objects.DataClasses>; Zestaw: System. Data. Entity (w System. Data. Entity. dll)

| Funkcja | Różnice od 3,5 SP1 |
| ------- | ------------------------ |
| **Obiekty jednostek** | Teraz występuje parzystość między metodą <xref:System.Data.Objects.ObjectContext.Detach%2A> i stanem obiektu jednostki, gdy wywoływana jest metoda <xref:System.Data.Objects.ObjectContext.SaveChanges%2A>. Ta ulepszona spójność uniemożliwia zgłaszanie nieoczekiwanych wyjątków. |
| **Entity SQL** | Udoskonalono reguły dla rozwiązań identyfikatora w Entity SQL.<br><br>Analizator Entity SQL ma udoskonaloną logikę rozpoznawania wieloczęściowych identyfikatorów. |
| **Adnotacje strukturalne** | Entity Framework teraz rozpoznaje strukturalne adnotacje. |
| **Zapytania** | W zapytaniach wprowadzono następujące ulepszenia:<br><br>* Zapytanie `GroupBy` używające klucza o wartości null za pośrednictwem pustej kolekcji nie zwróci żadnych wierszy, niezależnie od tego, czy w zapytaniu są jakieś dodatkowe.<br>* Wygenerowane SQL w zapytaniach LINQ i Entity-SQL nie traktują teraz parametrów ciągu jako wartości innych niż Unicode. |

### <a name="linq-to-sql"></a>LINQ do SQL

W poniższej tabeli opisano ulepszenia dotyczące funkcji, które wcześniej miały ograniczenia lub inne problemy.

Przestrzeń nazw: <xref:System.Data.Linq>; Zestaw: System. Data. LINQ (w System. Data. LINQ. dll)

| Funkcja | Różnice od 3,5 SP1 |
| ------- | ------------------------ |
| **Zdarzenia** | Kolekcja <xref:System.Data.Linq.EntitySet%601> teraz wywołuje zdarzenie <xref:System.Data.Linq.EntitySet%601.ListChanged> dla operacji dodawania i usuwania, jeśli <xref:System.Data.Linq.EntitySet%601> jest zwolniona, a także do podniesienia zdarzenia podczas ładowania kolekcji. |
| **Zapytania** | `Skip(0)` nie jest już ignorowana w zapytaniach LINQ to SQL. W efekcie zapytania, które mają tę metodę, mogą zachowywać się inaczej. Na przykład w niektórych przypadkach klauzula `OrderBy` jest wymagana z `Skip(0)`i zapytanie spowoduje teraz zgłoszenie wyjątku <xref:System.NotSupportedException>, Jeśli klauzula `OrderBy` nie została uwzględniona. |

### <a name="wcf-data-services"></a>Usługi danych WCF

W poniższej tabeli opisano ulepszenia dotyczące funkcji, które wcześniej miały ograniczenia lub inne problemy.

Przestrzenie nazw: <xref:System.Data.Services>, <xref:System.Data.Services.Client>, <xref:System.Data.Services.Common>, <xref:System.Data.Services.Providers>; Zestawy: System. Data. Services (w System. Data. Services. dll), system. Data. Services. Client (w System. Data. Services. Client. dll)

| Funkcja | Różnice od 3,5 SP1 |
| ------- | ------------------------ |
| **Wsadowa zawartość binarna** | Usługi danych programu WCF teraz obsługuje wsadową zawartość binarną w żądaniach i odpowiedziach. |
| **Przechwycenia zmian** | Przechwycenia zmian są teraz wykonywane dla żądania Delete.<br><br>Interceptor zmian to metoda, która jest uruchamiana za każdym razem, gdy żądanie jest odbierane przez serwer w celu zmodyfikowania jednostki w zestawie jednostek. Jest ono uruchamiane przed wykonaniem żądania przychodzącego. Interceptor zmiany zapewnia dostęp do obiektu, który jest zmieniany, i operacji, która jest wykonywana na nim. |
| **Wyjątki** | Poniższe warunki teraz generują bardziej przydatne wyjątki zamiast <xref:System.NullReferenceException>:<br><br>* <xref:System.ServiceProcess.TimeoutException>, gdy zostanie przeprowadzona próba wywołania usługi danych.<br>* <xref:System.Data.Services.Client.DataServiceRequestException>, gdy zostanie przesłane złe żądanie do usługi danych.<br><br>W aplikacjach należy zmienić obsługę wyjątków, aby przechwytywać nowe wyjątki. |
| **Nagłówka** | W nagłówkach wprowadzono następujące ulepszenia:<br><br>* Usługi danych programu WCF teraz pomyślnie odrzuca nagłówek `eTag`, który ma nieokreśloną wartość.<br>* Usługi danych programu WCF teraz zwraca błąd i nie wykonuje żądania żądania usunięcia do łącza, gdy w żądaniu znajduje się nagłówek `if-*`.<br>* Usługi danych programu WCF teraz zwraca błąd do klienta w formacie (Atom, JSON), który klient jest określony w nagłówku Accept. |
| **Czytnik JSON** | Czytnik JavaScript Object Notation (JSON) teraz pomyślnie zwraca błąd, gdy odczytuje pojedynczy ukośnik odwrotny ("\\") znak ucieczki, gdy przetwarza ładunki JSON wysyłane do usługi danych programu WCF. |
| **Scala** | W wyliczeniu <xref:System.Data.Services.Client.MergeOption> wprowadzono następujące ulepszenia:<br><br>* Opcja scalania <xref:System.Data.Services.Client.MergeOption> nie modyfikuje już jednostki na kliencie w wyniku żadnej kolejnej odpowiedzi z usługi danych.<br>* Opcja <xref:System.Data.Services.Client.MergeOption> jest teraz spójna między dynamicznymi aktualizacjami SQL i przechowywanymi na podstawie procedur. |
| **Żądań** | Metoda <xref:System.Data.Services.DataService%601.OnStartProcessingRequest%2A> jest teraz wywoływana przed przetworzeniem żądania do usług danych. Dzięki temu żądanie poprawnego działania programu <xref:System.Data.Services.Providers.ServiceOperation> Services. |
| **Strumieni** | Usługi danych programu WCF już nie zamyka bazowego strumienia dla operacji odczytu i zapisu. |
| **Identyfikatory URI** | Poprawiono anulowanie identyfikatorów URI według Usługi danych programu WCF klienta. |

## <a name="windows-communication-foundation-wcf"></a>Windows Communication Foundation (WCF)

W poniższej tabeli opisano ulepszenia dotyczące funkcji, które wcześniej miały ograniczenia lub inne problemy.

| Funkcja | Różnice od 3,5 SP1 |
| ------- | ------------------------ |
| **Pliki konfiguracji** | Aby włączyć dziedziczenie zachowań w hierarchii plików konfiguracji, usługa WCF obsługuje teraz scalanie plików konfiguracji.<br><br>Model dziedziczenia konfiguracji jest teraz rozwinięty, aby umożliwić użytkownikom Definiowanie zachowań, które będą stosowane do wszystkich usług uruchomionych na komputerze.<br><br>Mogą wystąpić zmiany behawioralne, jeśli istnieją zachowania o tej samej nazwie na różnych poziomach hierarchii. |
| **Hosting usług** | Nie można już określić `<serviceHostingEnvironment>` elementu konfiguracji na poziomie usługi przez dodanie atrybutu `allowDefinition="MachineToApplication"` do definicji elementu.<br><br>Określenie elementu `<serviceHostingEnvironment>` na poziomie usługi jest technicznie nieprawidłowe i powoduje niespójne zachowanie. |

## <a name="windows-presentation-foundation-wpf"></a>Windows Presentation Foundation (WPF)

### <a name="applications"></a>Aplikacje

Przestrzenie nazw: <xref:System.Windows>, <xref:System.Windows.Controls>; Assembly: platformie docelowej (w platformie docelowej. dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Obsługa wyjątków** | Aby umożliwić wykrycie błędów wcześniej, WPF zgłasza <xref:System.Reflection.TargetInvocationException> i ustawia właściwość <xref:System.Exception.InnerException> na wyjątki krytyczne, takie jak <xref:System.NullReferenceException>, <xref:System.OutOfMemoryException>, <xref:System.StackOverflowException>i <xref:System.Security.SecurityException>, zamiast przechwytywania pierwotnego wyjątku. | Brak. |
| **Połączone zasoby** | Aby ułatwić łączenie, pliki zasobów (takie jak obrazy), które znajdują się w lokalizacji innej niż struktura folderów projektu, używają pełnej ścieżki pliku zasobu zamiast samej nazwy pliku jako identyfikatora zasobu podczas kompilowania aplikacji. Aplikacja będzie mogła lokalizować pliki w czasie wykonywania. | Brak. |
| **Aplikacje częściowej relacji zaufania** | Ze względów bezpieczeństwa aplikacje oparte na systemie Windows, które działają w częściowej relacji zaufania i zawierają formant <xref:System.Windows.Controls.WebBrowser> lub kontrolka <xref:System.Windows.Controls.Frame>, która zawiera kod HTML, zgłosi <xref:System.Security.SecurityException> podczas tworzenia formantu.<br><br>Aplikacje przeglądarki będą zgłaszać wyjątek i wyświetlać komunikat w przypadku spełnienia wszystkich następujących warunków:<br><br>* Aplikacja działa w przeglądarce Firefox.<br>* Aplikacja działa w częściowej relacji zaufania w strefie internetowej z niezaufanych witryn.<br>* Aplikacja zawiera kontrolkę <xref:System.Windows.Controls.WebBrowser> lub kontrolkę <xref:System.Windows.Controls.Frame>, która zawiera kod HTML.<br><br>Należy zauważyć, że nie wpłynie to na aplikacje uruchamiane z zaufanych witryn lub ze strefy intranetowej. | W aplikacjach przeglądarki można uprościć tę zmianę, wykonując jedną z następujących czynności:<br><br>* Uruchom aplikację przeglądarki w trybie pełnego zaufania.<br>* Czy klienci dodają lokację aplikacji do strefy Zaufane witryny.<br>* Czy klienci uruchamiają aplikację w programie Internet Explorer. |
| **Słowniki zasobów** | Aby ulepszyć słowniki zasobów na poziomie motywu i uniemożliwić ich zmianę, Freezable zasoby zdefiniowane w słowniku zasobów i scalone w słowniku na poziomie motywu są teraz zawsze oznaczone jako zamrożone i niezmienne. Jest to oczekiwane zachowanie dla zasobów Freezable. | Aplikacje, które modyfikują zasób zdefiniowany w scalonym słowniku na poziomie motywu, powinny klonować zasób i modyfikować sklonowaną kopię. Alternatywnie można oznaczyć zasób jako `x:Shared="false"` tak, aby <xref:System.Windows.ResourceDictionary> tworzył nową kopię przy każdym zapytaniu zasobu. |
| **System Windows 7** | Aby aplikacje WPF działały lepiej w systemie Windows 7, wprowadzono następujące ulepszenia w celu poprawienia zachowania okna:<br><br>* Stany dokowania i gestu działają teraz zgodnie z oczekiwaniami w oparciu o Interakcje użytkownika.<br>* Polecenia paska zadań **kaskadowo okna, Pokaż w stosie Windows**i **Pokaż okna obok siebie** mają teraz poprawne zachowanie i Aktualizuj odpowiednie właściwości.<br>* Właściwości `Top`, `Left`, `Width`i `Height` dla zmaksymalizowanego lub zminimalizowanego okna zawierają teraz poprawną lokalizację przywracania okna zamiast innych wartości, w zależności od monitora. | Brak. |
| **Styl i przezroczystość systemu Windows** | <xref:System.InvalidOperationException> jest generowany, jeśli spróbujesz ustawić <xref:System.Windows.Window.WindowStyle> wartość inną niż <xref:System.Windows.WindowStyle>, gdy <xref:System.Windows.Window.AllowsTransparency> jest `true` i <xref:System.Windows.WindowState> jest <xref:System.Windows.WindowState>. | Jeśli <xref:System.Windows.Window.WindowStyle> należy zmienić, gdy <xref:System.Windows.Window.AllowsTransparency> jest `true`, można wywołać funkcję `SetWindowLongPtr` Win32. |
| **Przeglądarka plików XPS** | WPF nie zawiera pakietu Microsoft XML Paper Specification Essentials (XPSEP). XPSEP jest dołączany do systemów Windows 7 i Windows Vista.<br><br>Na komputerze z systemem Windows XP bez zainstalowanego .NET Framework 3,5 SP1 Drukowanie przy użyciu interfejsu API WPF innego niż te w <xref:System.Windows.Controls.PrintDialog> będzie zależeć od WINSPOOL. Niektóre możliwości drukarki nie będą raportowane i niektóre ustawienia drukarki nie będą stosowane podczas drukowania. | W razie konieczności zainstaluj [pakiet Microsoft XML Paper Specification Essentials](https://go.microsoft.com/fwlink/?LinkId=178895). |

### <a name="controls"></a>Formanty

Przestrzenie nazw: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; Zestawy: platformie docelowej (w platformie docelowej. dll), 'Presentationcore (w 'Presentationcore. dll), 'Windowsbase (w 'Windowsbase. dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Okna dialogowe** | Aby zwiększyć niezawodność, Metoda <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> jest wywoływana w tym samym wątku, który utworzył formant <xref:Microsoft.Win32.FileDialog>. | Upewnij się, że tworzysz kontrolkę <xref:Microsoft.Win32.FileDialog> i Wywołaj metodę <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> w tym samym wątku. |
| **Okna przestawne** | Aby usunąć logikę przywracania fokusu, która nieprawidłowo utrzymuje ponowne uaktywnianie przepływającego okna (sprawianie, że jest ono widoczne jako modalne okno dialogowe), przywrócenie fokusu jest teraz blokowane, jeśli kandydat nie jest elementem podrzędnym okna. | Brak. |
| **Elementy w kolekcjach** | Gdy element zostanie przeniesiony lub dodany do kolekcji źródłowej, pojawia się w <xref:System.Windows.Data.CollectionView> w tej samej lokalizacji względnej, jeśli <xref:System.Windows.Data.CollectionView> nie jest sortowany. Zapewnia to spójność między pozycją elementu w kolekcji i w skojarzonym <xref:System.Windows.Data.CollectionView>. | Użyj metody <xref:System.Windows.Controls.ItemContainerGenerator.ContainerFromItem%2A> lub <xref:System.Windows.Data.CollectionView.IndexOf%2A>, aby znaleźć lokalizację elementu w <xref:System.Windows.Data.CollectionView> zamiast polegać na ustalonej lokalizacji elementu. |
| **Układy** | Aby wyeliminować zbędne ponowne układy, zmiana <xref:System.Windows.Controls.Page.ShowsNavigationUI> nie unieważnia już układu lub powoduje, że inny układ przebiega. | Jeśli spodziewasz się, że zmiana <xref:System.Windows.Controls.Page.ShowsNavigationUI> spowoduje wystąpienie innego przebiegu układu, wywołaj <xref:System.Windows.UIElement.InvalidateVisual%2A> po ustawieniu właściwości. |
| **Menu** | Aby włączyć ClearType tekst w oknach menu podręcznych, wprowadzono modyfikacje klasy <xref:System.Windows.Controls.ControlTemplate> i kontrolki <xref:System.Windows.Controls.MenuItem> i innych kontrolek. | Aplikacje nie powinny opierać się na strukturze wizualizacji szablonów kontrolek. Tylko nazwane części <xref:System.Windows.Controls.ControlTemplate> są częścią kontraktu publicznego. Jeśli aplikacja musi znaleźć określony obiekt w <xref:System.Windows.Controls.ControlTemplate>, przeszukaj drzewo wizualizacji pod kątem określonego typu zamiast polegania na ustalonej lokalizacji obiektu w drzewie. |
| **Przechodząc** | Jeśli <xref:System.Windows.Controls.Frame> bezpośrednio Nawiguj do lokalizacji, właściwość <xref:System.Windows.Navigation.NavigatingCancelEventArgs.IsNavigationInitiator> zostanie `true` po początkowej nawigacji. Ta zmiana uniemożliwi wywoływanie dodatkowych zdarzeń podczas scenariuszy uruchamiania. | Brak. |
| **Wyskakujące okienka** | Delegat <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> można teraz wywołać wiele razy podczas przebiegu układu, a nie tylko raz. | Jeśli <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> delegat oblicza pozycję <xref:System.Windows.Controls.Primitives.Popup> na podstawie poprzedniej pozycji, należy ponownie obliczyć pozycję tylko wtedy, gdy wartości parametrów `popupSize`, `targetSize`lub `offset`. |
| **Wartości właściwości** | Metoda <xref:System.Windows.DependencyObject.SetCurrentValue%2A> teraz pozwala ustawić właściwość na wartość efektywną, mimo że w dalszym ciągu będzie uwzględniać wszelkie powiązania, style lub wyzwalacze wpływające na właściwość. | Autorzy formantów powinni używać <xref:System.Windows.DependencyObject.SetCurrentValue%2A> za każdym razem, gdy wartość właściwości zmieni się jako efekt uboczny innej akcji, w tym manipulowanie użytkownikami. |
| **Pola tekstowe** | Ze względów bezpieczeństwa <xref:System.Windows.Forms.TextBoxBase.Copy%2A> i <xref:System.Windows.Forms.TextBoxBase.Cut%2A> metody dyskretnie kończą się niepowodzeniem, gdy są wywoływane w częściowej relacji zaufania.<br><br>Ponadto wykonywanie programistyczne właściwości <xref:System.Windows.Input.ApplicationCommands.Copy> lub <xref:System.Windows.Input.ApplicationCommands.Cut> na kontrolce, która dziedziczy po <xref:System.Windows.Controls.Primitives.TextBoxBase>, będzie blokowane w częściowej relacji zaufania. Jednak zainicjowane przez użytkownika polecenia kopiowania i wycinania, takie jak kliknięcie przycisku, którego właściwość <xref:System.Windows.Controls.Primitives.ButtonBase.Command> jest powiązane z jednym z tych poleceń, będą działały. Standardowe kopiowanie i wycinanie za pomocą skrótów klawiaturowych i menu kontekstowego będzie nadal działały tak jak wcześniej w częściowej relacji zaufania. | Powiąż polecenie <xref:System.Windows.Input.ApplicationCommands.Copy> lub <xref:System.Windows.Input.ApplicationCommands.Cut> z akcją zainicjowaną przez użytkownika, taką jak kliknięcie przycisku. |

### <a name="graphics"></a>Grafika

Przestrzenie nazw: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>, <xref:System.Windows.Media.Effects>; Zestawy: platformie docelowej (w platformie docelowej. dll), 'Presentationcore (w 'Presentationcore. dll), 'Windowsbase (w 'Windowsbase. dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Efekty mapy bitowej** | Aby zwiększyć wydajność, Klasa <xref:System.Windows.Media.Effects.BitmapEffect> i klasy dziedziczące z klasy <xref:System.Windows.Media.Effects.BitmapEffect>, mimo że nadal istnieją, są wyłączone. Efekt będzie renderowany przy użyciu potoku renderowania sprzętowego, jeśli spełnione są następujące warunki:<br><br>* Aplikacja używa <xref:System.Windows.Media.Effects.DropShadowBitmapEffect> lub <xref:System.Windows.Media.Effects.BlurBitmapEffect>, który ma właściwość RADIUS o wartości mniejszej niż 100 DIU.<br>* Karta wideo na komputerze, na którym działa aplikacja, obsługuje program cieniowania pikseli 2,0.<br><br>Jeśli te warunki nie są spełnione, obiekt <xref:System.Windows.Media.Effects.BitmapEffect> nie będzie miał żadnego efektu.<br><br>Ponadto program Visual Studio generuje ostrzeżenie kompilatora, gdy napotka obiekt <xref:System.Windows.Media.Effects.BitmapEffect> lub podklasę.<br><br>Metoda <xref:System.Windows.Media.DrawingContext.PushEffect%2A> jest oznaczona jako przestarzała. | Zaprzestanie używania starszych <xref:System.Windows.Media.Effects.BitmapEffect> i klas pochodnych, a zamiast tego użyj nowych klas pochodnych <xref:System.Windows.Media.Effects.Effect>: <xref:System.Windows.Media.Effects.BlurEffect>, <xref:System.Windows.Media.Effects.DropShadowEffect>i <xref:System.Windows.Media.Effects.ShaderEffect>.<br><br>Możesz również utworzyć własne efekty, dziedzicząc z klasy <xref:System.Windows.Media.Effects.ShaderEffect>. |
| **Ramki mapy bitowej** | Sklonowane obiekty <xref:System.Windows.Media.Imaging.BitmapFrame> teraz odbierają zdarzenia <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>, <xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted>i <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed>. Dzięki temu obrazy pobierane z sieci Web i stosowane do kontrolki <xref:System.Windows.Controls.Image> za pośrednictwem <xref:System.Windows.Style> działały prawidłowo.<br><br>Zmienisz zachowanie tylko wtedy, gdy są spełnione wszystkie następujące instrukcje:<br><br>* Zasubskrybujesz zdarzenie <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>, <xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted>lub <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed>.<br>* Źródło <xref:System.Windows.Media.Imaging.BitmapFrame> pochodzi z sieci Web.<br>* <xref:System.Windows.Media.Imaging.BitmapFrame> jest sklonowany, gdy pobieranie jest nadal w toku. | Sprawdź nadawcę w programie obsługi zdarzeń i wykonaj akcję tylko wtedy, gdy nadawca to oryginalny <xref:System.Windows.Media.Imaging.BitmapFrame>. |
| **Dekodowanie obrazów** | Aby zapobiec obsłudze <xref:System.IO.IOException> nie są obsługiwane, gdy obrazy nie mogą dekodować, Klasa <xref:System.Windows.Media.Imaging.BitmapSource> będzie zgłaszać zdarzenie <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed>, gdy nie dekoduje obrazu. | Usuń obsługę wyjątków dla <xref:System.IO.IOException>i użyj zdarzenia <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed>, aby sprawdzić, czy dekodowanie nie powiodło się. |

### <a name="input"></a>Dane wejściowe

Przestrzenie nazw: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; Zestawy: platformie docelowej (w platformie docelowej. dll), 'Presentationcore (w 'Presentationcore. dll), 'Windowsbase (w 'Windowsbase. dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Wystąpienia poleceń powiązań** | Aby zapewnić mechanizm powiązania wystąpień poleceń opartych na modelu widoku w celu wyświetlenia gestów wejścia opartych na danych, Klasa <xref:System.Windows.Input.InputBinding> teraz dziedziczy po <xref:System.Windows.Freezable> zamiast <xref:System.Windows.DependencyObject>. Następujące właściwości są teraz właściwościami zależności:<br><br>* <xref:System.Windows.Input.InputBinding.Command><br>* <xref:System.Windows.Input.InputBinding.CommandParameter><br>* <xref:System.Windows.Input.InputBinding.CommandTarget><br><br>Spowoduje to następujące zmiany:<br><br>* Obiekt <xref:System.Windows.Input.InputBinding> jest teraz zamrożony, gdy jest zarejestrowany, a nie jako pozostałe modyfikowalne.<br>* Nie można uzyskać dostępu do obiektów <xref:System.Windows.Input.InputBinding> na poziomie wystąpienia z wielu wątków ze względu na ograniczenia klasy <xref:System.Windows.DependencyObject>.<br>* Nie można zmodyfikować powiązań wejściowych na poziomie klasy po ich rejestracji ze względu na ograniczenia klasy <xref:System.Windows.Freezable>.<br>* Nie można określić powiązań wejściowych w wystąpieniach poleceń, które są tworzone w modelu widoku. | Utwórz oddzielne wystąpienia klasy <xref:System.Windows.Input.InputBinding> w oddzielnych wątkach, jeśli powiązania mają być modyfikowalne lub Zablokuj je inaczej. Nie należy przetworzyć <xref:System.Windows.Input.InputBinding> statycznego na poziomie klasy po jego zarejestrowaniu. |
| **Aplikacje przeglądarki** | Aplikacje przeglądarki WPF (. Aplikacje XBAP) przetwarzają teraz kluczowe zdarzenia, podobnie jak autonomiczne aplikacje WPF, dzięki czemu obiekty są odbierane z kluczowymi zdarzeniami w odpowiedniej kolejności. | Brak. |
| **Kombinacje utraconych klawiszy** | WPF zasłania niedziałające klucze, które nie generują widocznego znaku, ale zamiast tego wskazują, że klucz ma być połączony z następnym klawiszem litery w celu utworzenia jednego znaku. Zdarzenia wejściowe klucza, takie jak zdarzenie <xref:System.Windows.Input.Keyboard.KeyDownEvent>, raportu, gdy klucz jest martwym kluczem przez ustawienie właściwości <xref:System.Windows.Input.KeyEventArgs.Key> na wartość <xref:System.Windows.Input.Key>. Zwykle jest to oczekiwane zachowanie, ponieważ aplikacje zwykle nie mają odpowiedzi na dane wejściowe z klawiatury, które tworzą połączony znak. | Aplikacje, które oczekują odczytywania kluczy, które były częścią połączonych znaków, mogą uzyskać teraz przysłonięty klucz za pomocą właściwości <xref:System.Windows.Input.KeyEventArgs.DeadCharProcessedKey>. |
| **Menedżer fokusu** | Gdy metoda <xref:System.Windows.Input.FocusManager.GetFocusedElement(System.Windows.DependencyObject)?displayProperty=nameWithType> jest przekazana, element, który ma właściwość dołączona [IsFocusScope](xref:System.Windows.Input.FocusManager.IsFocusScope%2A) do `true`, metoda zwraca element, który jest elementem, który jest ostatni element nakierowany na klawiaturze w tym zakresie fokusu, jeśli i tylko wtedy, gdy zwracany element należy do ten sam <xref:System.Windows.PresentationSource> obiekt jako element, który jest przesyłany do metody. | Brak. |

### <a name="ui-automation"></a>Automatyzacja interfejsu użytkownika

Przestrzeń nazw: <xref:System.Windows>, <xref:System.Windows.Automation.Peers>, <xref:System.Windows.Automation.Provider>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; Zestawy: platformie docelowej (w platformie docelowej. dll), 'Presentationcore (w 'Presentationcore. dll), UIAutomationProvider (w UIAutomationProvider. dll), 'Windowsbase (w 'Windowsbase. dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Hierarchia klas widoków** | Klasy <xref:System.Windows.Automation.Peers.TreeViewAutomationPeer> i <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> dziedziczą z <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer> zamiast <xref:System.Windows.Automation.Peers.FrameworkElementAutomationPeer>. | Jeśli dziedziczysz z klas <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> i zastąpisz metodę <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer.GetChildrenCore%2A>, rozważ zwrócenie obiektu, który dziedziczy z nowej klasy <xref:System.Windows.Automation.Peers.TreeViewDataItemAutomationPeer>. |
| **Kontenery poza ekranem** | Aby naprawić niepoprawną wartość zwracaną, Metoda <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.IsOffscreenCore%2A> teraz poprawnie zwraca `false` dla kontenerów elementów, które są przewijane do wyświetlenia. Ponadto wartość metody nie ma wpływ na zamknięcia przez inne okna lub czy element jest widoczny na określonym monitorze. | Brak. |
| **Menu i obiekty podrzędne** | Aby włączyć automatyzację interfejsu użytkownika menu, które zawiera elementy podrzędne inne niż <xref:System.Windows.Controls.MenuItem> obiektów, Metoda <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer.GetChildrenCore%2A> teraz zwraca obiekt <xref:System.Windows.Automation.Peers.AutomationPeer> podrzędnego obiektu <xref:System.Windows.UIElement>, a nie obiekt <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer>. | Brak. |
| **Nowe interfejsy i zestaw** | Aby włączyć nowe funkcje automatyzacji interfejsu użytkownika, dodano następujące interfejsy:<br><br>* <xref:System.Windows.Automation.Provider.IItemContainerProvider><br>* <xref:System.Windows.Automation.Provider.ISynchronizedInputProvider><br>* <xref:System.Windows.Automation.Provider.IVirtualizedItemProvider> | Każdy projekt, który kompiluje elementy równorzędne automatyzacji programu WPF, musi dodać jawne odwołanie do UIAutomationProvider. dll. |
| **Thumbs** | Metoda <xref:System.Windows.Automation.Peers.ThumbAutomationPeer.GetClassNameCore%2A> zwraca wartość zamiast wartości null. W związku z tym, formanty takie jak <xref:System.Windows.Controls.GridSplitter> dziedziczące z klasy <xref:System.Windows.Controls.Primitives.Thumb> będą zgłaszać nazwę automatyzacji interfejsu użytkownika. | Brak. |
| **Elementy zwirtualizowane** | Aby zwiększyć wydajność, Metoda <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetChildrenCore%2A> zwraca tylko obiekty podrzędne, które faktycznie znajdują się w drzewie wizualnym, a nie wszystkie obiekty podrzędne, niezależnie od tego, czy są one zwirtualizowane. | Użyj <xref:System.Windows.Automation.ItemContainerPattern>, aby wykonać iterację wszystkich elementów <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer>. |

### <a name="xaml"></a>XAML

Przestrzenie nazw: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>, <xref:System.Windows.Markup>; Zestawy: platformie docelowej (w platformie docelowej. dll), 'Presentationcore (w 'Presentationcore. dll), 'Windowsbase (w 'Windowsbase. dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Rozszerzenie znaczników** | WPF teraz zawsze używa wartości z metody <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A> zamiast zwracać obiekt <xref:System.Windows.Markup.MarkupExtension> w niektórych przypadkach, gdy rozszerzenie znaczników jest używane do ustawiania właściwości lub do tworzenia elementu w kolekcji. Rozszerzenie znaczników może zwrócić się w niektórych przypadkach. | Jeśli aplikacja uzyskuje dostęp do zasobu, który zwrócił obiekt <xref:System.Windows.Markup.MarkupExtension> we wcześniejszych wersjach, odwołuje się do obiektu, który jest zwracany z <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A>, a nie obiektu <xref:System.Windows.Markup.MarkupExtension>. |
| **Analizowanie atrybutów** | Atrybuty w języku XAML mogą teraz mieć tylko jeden okres. Na przykład prawidłowe są następujące elementy:<br><br>`<Button Background="Red"/>` (brak kropek)<br><br>`<Button Button.Background = "Red"/>` (jeden okres)<br><br>Następujące elementy nie są już prawidłowe:<br><br>`<Button Control.Button.Background = "Red"/>` (więcej niż jeden okres) | Popraw atrybuty XAML, które mają więcej niż jeden okres. |

## <a name="xml"></a>XML

W wierszach w tej tabeli opisano ulepszenia dotyczące funkcji, które wcześniej miały ograniczenia lub inne problemy.

### <a name="schema-and-transforms"></a>Schemat i przekształcenia

Przestrzenie nazw: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; Zestawy: System. XML (w pliku System. XML. dll), system. XML. LINQ (w pliku System. XML. LINQ. dll)

| Funkcja | Różnice od 3,5 SP1 |
| ------- | ------------------------ |
| **Schematy Chameleon** | Aby zapobiec uszkodzeniu danych, schematy Chameleon są teraz sklonowane prawidłowo, gdy są zawarte w wielu schematach.<br><br>Schematy Chameleon to schematy, które nie mają docelowej przestrzeni nazw i gdy są zawarte w innym pliku XSD, przyjmują przestrzeń nazw Target schematu importowania. Są one często używane do uwzględnienia wspólnych typów w schemacie. |
| **Funkcje identyfikatorów** | [Funkcja identyfikatora](/sql/xquery/functions-on-sequences-id) XSLT zwraca teraz poprawną wartość zamiast wartości null, gdy obiekt <xref:System.Xml.XmlReader> jest przekazaniem do XLST.<br><br>Jeśli użytkownik utworzył obiekt <xref:System.Xml.XmlReader> z klasy LINQ to XML przy użyciu metody <xref:System.Xml.Linq.XNode.CreateReader%2A> i ten obiekt <xref:System.Xml.XmlReader> został przekazano do XSLT, wszystkie wystąpienia funkcji `id` w XSLT wcześniej zwracały wartość null. To nie jest dozwolona wartość zwracana dla funkcji `id`. |
| **Namespace — atrybut** | Aby zapobiec uszkodzeniu danych, obiekt <xref:System.Xml.XPath.XPathNavigator> teraz zwraca lokalną nazwę atrybutu `x:xmlns` poprawnie. |
| **Deklaracje przestrzeni nazw** | Obiekt <xref:System.Xml.XmlReader> w poddrzewie nie tworzy już zduplikowanych deklaracji przestrzeni nazw w obrębie jednego elementu XML. |
| **Sprawdzanie poprawności schematu** | Aby zapobiec błędnej weryfikacji schematu, Klasa <xref:System.Xml.Schema.XmlSchemaSet> umożliwia poprawne Kompilowanie i spójność schematów XSD. Te schematy mogą obejmować inne schematy; Przykładowo `A.xsd` mogą zawierać `B.xsd`, które mogą obejmować `C.xsd`. Kompilowanie dowolnego z nich powoduje, że ten wykres zależności zostanie przesunięty. |
| **Funkcje skryptu** | [Funkcja dostępna funkcja](https://msdn.microsoft.com/library/ms256124(v=vs.110).aspx) nie zwraca już nieprawidłowej `false`, gdy funkcja jest rzeczywiście dostępna. |
| **Identyfikatory URI** | Metoda <xref:System.Xml.Linq.XElement.Load%2A> teraz zwraca poprawne BaseURI w zapytaniach LINQ. |

### <a name="validation"></a>Walidacja

Przestrzenie nazw: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; Zestawy: System. XML (w pliku System. XML. dll), system. XML. LINQ (w pliku System. XML. LINQ. dll)

| Funkcja | Różnice od 3,5 SP1 |
| ------- | ------------------------ |
| **Rozpoznawanie nazw** | Metoda <xref:System.Xml.XmlReader.ReadContentAs%2A> nie ignoruje już <xref:System.Xml.IXmlNamespaceResolver>go programu rozpoznawania nazw.<br><br>W poprzednich wersjach został zignorowany określony program rozpoznawania nazw, a w zamian użyto <xref:System.Xml.XmlReader>. |
| **Biały znak** | Aby zapobiec utracie danych podczas tworzenia czytnika, Metoda <xref:System.Xml.XmlReader.Create%2A> nie będzie już odrzucać znaczących białych znaków.<br><br>Sprawdzanie poprawności kodu XML rozpoznaje tryb mieszanej zawartości, gdzie tekst może być mieszany z znacznikiem XML. W trybie mieszanym wszystkie białe miejsca są znaczące i powinny być zgłaszane. |

### <a name="writing"></a>Napisane

Przestrzenie nazw: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; Zestawy: System. XML (w pliku System. XML. dll), system. XML. LINQ (w pliku System. XML. LINQ. dll)

| Funkcja | Różnice od 3,5 SP1 |
| ------- | ------------------------ |
| **Odwołania do jednostek** | Aby zapobiec uszkodzeniu danych, odwołania do jednostek nie są już entitized dwa razy w atrybutach XML.<br><br>Jeśli użytkownik próbował napisać jednostkę w atrybucie `xmlns` lub do atrybutu `xml:lang` lub `xml:space` za pomocą metody <xref:System.Xml.XmlWriter.WriteEntityRef%2A>, jednostka została entitized dwa razy w danych wyjściowych, więc uszkodzenie danych. |
| **Obsługa nowego wiersza** | Aby zapobiec uszkodzeniu danych, <xref:System.Xml.XmlWriter> obiekty respektują opcję <xref:System.Xml.NewLineHandling>. |

## <a name="see-also"></a>Zobacz także

- [Nowe typy i członkowie w .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff641764%28v=vs.100%29)
- [Przewodnik migracji do .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff657133%28v=vs.100%29)
- [Co nowego w .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms171868%28v=vs.100%29)
- [Zgodność wersji w .NET Framework](version-compatibility.md)
- [Migrowanie rozwiązań pakietu Office do .NET Framework 4](/visualstudio/vsto/migrating-office-solutions-to-the-dotnet-framework-4-or-later)
- [Co jest przestarzałe w bibliotece klas .NET Framework](../whats-new/whats-obsolete.md)
