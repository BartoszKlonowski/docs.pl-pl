---
title: Problemy podczas migracji programu .NET Framework 4
ms.date: 05/02/2017
helpviewer_keywords:
- .NET Framework 4, migration
- application compatibility
ms.assetid: df478548-8c05-4de2-8ba7-adcdbe1c2a60
ms.openlocfilehash: c1c3298d87ad0f481fa30182e40cd5edcd535d6a
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/15/2020
ms.locfileid: "73975621"
---
# <a name="net-framework-4-migration-issues"></a>Problemy podczas migracji programu .NET Framework 4

W tym temacie opisano problemy z migracją między programem .NET Framework w wersji 3.5 z dodatkiem Service Pack 1 a programem .NET Framework w wersji 4, w tym poprawki, zmiany dotyczące zgodności ze standardami i zabezpieczeń oraz zmiany oparte na opiniach klientów. Większość tych zmian nie wymaga żadnych modyfikacji programistycznych w aplikacjach. Dla tych, które mogą obejmować modyfikacje, zobacz zalecane zmiany kolumny tabeli. Znaczące zmiany są podzielone według obszaru, na przykład ASP.NET i Windows Presentation Foundation (WPF).

Aby zapoznać się z omówieniem zagadnień na wyższym poziomie w tym temacie, zobacz [Przewodnik po migracji do programu .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff657133%28v=vs.100%29).

Aby uzyskać informacje o nowych funkcjach, zobacz [Co nowego w .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms171868%28v=vs.100%29).

## <a name="aspnet-and-web"></a>ASP.NET i Internet

Przestrzenie <xref:System.Web>nazw: <xref:System.Web.Mobile> <xref:System.Web.Security>, <xref:System.Web.UI.WebControls>, , ; assembly: System.Web (w pliku System.Web.dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Pliki definicji przeglądarki** | Pliki definicji przeglądarki zostały zaktualizowane w celu uwzględnienia informacji o nowych i zaktualizowanych przeglądarkach i urządzeniach. Starsze przeglądarki i urządzenia, takie jak Netscape Navigator, zostały usunięte, a nowsze przeglądarki i urządzenia, takie jak Google Chrome i Apple iPhone zostały dodane.<br><br>Jeśli aplikacja zawiera niestandardowe definicje przeglądarki, które dziedziczą z jednej z definicji przeglądarki, które zostały usunięte, zostanie wyświetlony błąd.<br><br>Obiekt <xref:System.Web.HttpBrowserCapabilities> (który jest narażony `Request.Browse` przez page's property) jest napędzany przez pliki definicji przeglądarki. W związku z tym informacje, które są zwracane przez dostęp do właściwości tego obiektu w ASP.NET 4 może być inny niż informacje, które zostały zwrócone we wcześniejszej wersji ASP.NET. | Jeśli aplikacja opiera się na starych plikach definicji przeglądarki, można je skopiować z następującego folderu:<br><br>*Windows\\\\Microsoft.NET\\Framework w wersji 2.0.50727\\Przeglądarki CONFIG\\*<br><br>Skopiuj * \\\\* pliki do odpowiedniego folderu przeglądarki CONFIG dla ASP.NET 4. Po skopiowaniu plików uruchom narzędzie wiersza polecenia [Aspnet_regbrowsers.exe.](https://docs.microsoft.com/previous-versions/dotnet/netframework-3.5/ms229858(v=vs.90)) Aby uzyskać więcej [https://www.asp.net/mobile](/aspnet/mobile/overview) informacji, zobacz witrynę sieci Web. |
| **Aplikacje podrzędne działające w mieszanych wersjach ASP.NET** | ASP.NET 4 aplikacje, które są skonfigurowane jako elementy podrzędne aplikacji, które uruchamiają starsze wersje ASP.NET może nie zostać uruchomiony z powodu błędów konfiguracji lub kompilacji. Określony błąd, który występuje zależy od tego, czy aplikacja działa w ramach usług IIS 6.0 lub w ramach usług IIS 7 lub IIS 7.5. | Można wprowadzić zmiany w plikach konfiguracyjnych aplikacji, których dotyczy problem, tak aby system konfiguracji poprawnie rozpoznał aplikację ASP.NET 4. Aby uzyskać informacje na temat zmian, które należy wprowadzić, zobacz sekcję "ASP.NET 4 Aplikacje podrzędne nie można uruchomić, gdy w obszarze ASP.NET 2.0 lub ASP.NET 3.5 Aplikacje" w dokumencie [ASP.NET 4 Przełomowe zmiany](/aspnet/whitepapers/aspnet4/breaking-changes) w witrynie sieci Web ASP.NET. |
| **Zmiany identyfikatora klienta** | Nowe `clientIDMode` ustawienie w ASP.NET 4 umożliwia określenie sposobu generowania `id` atrybutu dla elementów HTML przez ASP.NET. W poprzednich wersjach ASP.NET domyślne zachowanie było `AutoID` równoważne `clientIDMode`z ustawieniem programu . Ustawieniem domyślnym `Predictable`jest teraz . Aby uzyskać więcej informacji, zobacz [ASP.NET identyfikację sterowania serwerem sieci Web](https://docs.microsoft.com/previous-versions/aspnet/1d04y8ss%28v=vs.100%29). | Jeśli program Visual Studio jest używany do uaktualniania aplikacji z ASP.NET 2.0 lub ASP.NET 3.5, narzędzie automatycznie dodaje ustawienie do pliku Web.config, który zachowuje zachowanie wcześniejszych wersji programu .NET Framework. Jednak jeśli uaktualnienie aplikacji przez zmianę puli aplikacji w usługach IIS do celu .NET Framework 4, ASP.NET domyślnie używa nowego trybu. Aby wyłączyć nowy tryb identyfikatora klienta, dodaj następujące ustawienie do pliku Web.config:<br><br>`<pages clientIDMode="AutoID" />` |
| **Zabezpieczenia dostępu do kodu (CAS)** | ASP.NET 2.0 NET funkcje, które zostały dodane w ASP.NET 3.5 używać .NET Framework 1.1 i .NET Framework 2.0 kod zabezpieczeń (CAS) modelu. Jednakże wdrożenie CAS w ASP.NET 4 zostało gruntownie zmienione. W rezultacie częściowe zaufanie ASP.NET aplikacje, które opierają się na zaufanym kodzie uruchomionym w globalnej pamięci podręcznej zestawów, mogą zakończyć się niepowodzeniem z różnymi wyjątkami zabezpieczeń. Aplikacje częściowe zaufanie, które opierają się na rozległe modyfikacje do zasad CAS komputera może również zakończyć się niepowodzeniem i zgłaszać wyjątki zabezpieczeń. | Można przywrócić częściowe zaufanie ASP.NET 4 aplikacji do zachowania ASP.NET 1.1 i 2.0 `legacyCasModel` przy użyciu `trust` nowego atrybutu w elemencie konfiguracji, jak pokazano w poniższym przykładzie:<br><br>`<trust level= "Medium" legacyCasModel="true" />`<br><br>Ważne: Powrót do starszego modelu CAS może reprezentować zmniejszone zabezpieczenia.<br><br>Aby uzyskać więcej informacji na temat nowego modelu zabezpieczeń dostępu do kodu ASP.NET 4, zobacz [Zabezpieczenia dostępu do kodu w ASP.NET 4 aplikacje](https://docs.microsoft.com/previous-versions/dd984947(v=vs.100)). |
| **Pliki konfiguracyjne** | Główne pliki konfiguracyjne (plik machine.config i główny plik Web.config) dla programu .NET Framework i ASP.NET 4 zostały zaktualizowane w celu uwzględnienia większości informacji konfiguracyjnych, które zostały znalezione w aplikacji Web.config plików w ASP.NET 3.5. Ze względu na złożoność zarządzanych systemów konfiguracyjnych usług IIS 7 i IIS 7.5 uruchamianie aplikacji ASP.NET 3.5 w ramach ASP.NET 4 i 7 i IIS 7.5 może powodować błędy ASP.NET lub błędy usług IIS. | Uaktualnij ASP.NET 3.5 aplikacji do ASP.NET 4 przy użyciu narzędzi uaktualniania projektu w programie Visual Studio. Visual Studio 2010 automatycznie modyfikuje plik Web.config aplikacji ASP.NET 3.5, aby zawierał odpowiednie ustawienia dla ASP.NET 4.<br><br>Można jednak uruchomić aplikacje ASP.NET 3.5 przy użyciu programu .NET Framework 4 bez ponownej kompilacji. W takim przypadku może być ręczna modyfikacja pliku Web.config aplikacji przed uruchomieniem aplikacji w ramach programu .NET Framework 4 i w ramach usług IIS 7 lub IIS 7.5. Konkretne zmiany, które należy wprowadzić, zależą od kombinacji oprogramowania, z którego pracujesz, w tym wersji dodatku Service Pack (SP). Aby uzyskać informacje na temat możliwych kombinacji oprogramowania, których dotyczy ta zmiana, oraz sposobu rozwiązywania problemów z określonymi kombinacjami, zobacz sekcję "Błędy konfiguracji związane z konfiguracją nowego ASP.NET 4 root" w dokumencie [ASP.NET 4 Przełomowe zmiany](/aspnet/whitepapers/aspnet4/breaking-changes) w witrynie sieci Web ASP.NET. |
| **Sterowanie renderowaniem** | W poprzednich wersjach ASP.NET niektóre formanty emitowane znaczników, które nie można wyłączyć. Domyślnie ten typ znaczników nie jest już generowany w ASP.NET 4. Zmiany renderowania mają wpływ na następujące formanty:<br><br>* `Image` I `ImageButton` formanty `border="0"` nie są już renderowane atrybut.<br>* `BaseValidator` Klasy i sprawdzania poprawności formanty, które pochodzą z niego nie renderowania czerwony tekst domyślnie.<br>* `HtmlForm` Formant nie `name` renderuje atrybutu.<br>* `Table` Formant nie renderuje już atrybutu. `border="0"`<br><br>Formanty, które nie są przeznaczone `Label` do wprowadzania danych `disabled="disabled"` przez użytkownika `Enabled` (na `false` przykład formant) nie są już renderowane atrybut, jeśli ich właściwość jest ustawiona na (lub jeśli dziedziczą to ustawienie z formantu kontenera). | Jeśli program Visual Studio jest używany do uaktualniania aplikacji z ASP.NET 2.0 lub ASP.NET 3.5, narzędzie automatycznie dodaje ustawienie do pliku Web.config, który zachowuje renderowania starszego. Jednak jeśli uaktualnienie aplikacji przez zmianę puli aplikacji w usługach IIS do celu .NET Framework 4, ASP.NET domyślnie używa nowego trybu renderowania. Aby wyłączyć nowy tryb renderowania, dodaj następujące ustawienie do pliku Web.config:<br><br>`<pages controlRenderingCompatibilityVersion="3.5" />` |
| **Programy obsługi zdarzeń w dokumentach domyślnych** | ASP.NET 4 renderuje wartość `form` `action` atrybutu elementu HTML jako pusty ciąg, gdy żądanie jest składane do adresu URL bez rozszerzenia, który ma domyślny dokument mapowany do niego. We wcześniejszych wersjach ASP.NET żądanie `http://contoso.com` spowodowałoby żądanie default.aspx. W tym dokumencie `form` znacznik otwierający będzie renderowany tak, jak w poniższym przykładzie:<br><br>`<form action="Default.aspx" />`<br><br>W ASP.NET 4 żądanie `http://contoso.com` również powoduje żądanie default.aspx, ale ASP.NET teraz renderuje tag `form` otwierający HTML, jak w poniższym przykładzie:<br><br>`<form action="" />`<br><br>Gdy `action` atrybut jest pustym ciągiem, `DefaultDocumentModule` obiekt IIS tworzy żądanie podrzędne do pliku Default.aspx. W większości warunków to żądanie podrzędne jest niewidoczny do kodu aplikacji, a default.aspx strona działa normalnie. Jednak potencjalna interakcja między kodem zarządzanym a trybem zintegrowanym usług IIS 7 lub IIS 7.5 może spowodować, że zarządzane strony .aspx przestaną działać poprawnie podczas żądania podrzędnego. Jeśli wystąpią następujące warunki, żądanie podrzędne do domyślnego dokumentu .aspx spowoduje błąd lub nieoczekiwane zachowanie:<br><br>* Strona .aspx jest wysyłana `form` do przeglądarki `action` z atrybutem elementu ustawionym na "".<br>* Formularz jest księgowane z powrotem do ASP.NET.<br>* Zarządzany moduł HTTP odczytuje część treści `Request.Form` jednostki, na przykład lub `Request.Params`. Powoduje to, że treść jednostki żądania POST do odczytu w pamięci zarządzanej. W rezultacie treść jednostki nie jest już dostępna dla wszystkich modułów kodu macierzystego, które są uruchomione w trybie zintegrowanym IIS 7 lub IIS 7.5.<br>* Obiekt IIS `DefaultDocumentModule` po pewnym czasie uruchamia i tworzy żądanie podrzędne do dokumentu Default.aspx. Jednak ponieważ treść jednostki została już odczytana przez fragment kodu zarządzanego, nie ma żadnej jednostki dostępnej do wysłania do żądania podrzędnego.<br>* Gdy potok HTTP jest uruchamiany dla żądania podrzędnego, program obsługi plików .aspx jest uruchamiany podczas fazy wykonywania programu handler.*<br><br>Ponieważ nie ma treści jednostki, nie ma żadnych zmiennych formularza i nie ma stanu widoku. W związku z tym nie ma żadnych informacji dostępnych dla .aspx obsługi strony, aby określić, jakie zdarzenie (jeśli istnieje) powinny być wywoływane. W rezultacie żaden z programów obsługi zdarzeń postback dla strony .aspx, którego dotyczy problem, jest uruchamiany. | Aby uzyskać informacje na temat sposobów obejścia problemów, które mogą pojawić się w wyniku tej zmiany, zobacz "Programy obsługi zdarzeń nie mogą być wywoływane w dokumencie domyślnym w trybie zintegrowanym usług IIS 7 lub IIS 7.5" w dokumencie [ASP.NET 4 przełomowe zmiany](/aspnet/whitepapers/aspnet4/breaking-changes) w ASP.NET witrynie sieci Web. |
| **Algorytm mieszania** | ASP.NET używa algorytmów szyfrowania i mieszania, aby zabezpieczyć dane, takie jak pliki cookie uwierzytelniania formularzy i stan wyświetlania. Domyślnie ASP.NET 4 używa algorytmu <xref:System.Security.Cryptography.HMACSHA256> dla operacji mieszania w plikach cookie i stanu widoku. Starsze wersje ASP.NET używane starszy <xref:System.Security.Cryptography.HMACSHA1> algorytm. | Jeśli uruchamiasz aplikacje, które łączą ASP.NET 2.0 i ASP.NET 4, gdzie dane, takie jak pliki cookie uwierzytelniania formularzy, muszą działać <xref:System.Security.Cryptography.HMACSHA1> w wersjach programu .NET Framework, skonfiguruj aplikację sieci Web ASP.NET 4, aby używała starszego algorytmu, dodając następujące ustawienie w pliku Web.config:<br><br>`<machineKey validation="SHA1" />` |
| **Kontrolki hostingu w programie Internet Explorer** | Formanty formularzy systemu Windows nie mogą być już hostować w programie Internet Explorer, ponieważ istnieją lepsze rozwiązania dla formantów hostingu w sieci Web. W związku z tym zestawy IEHost.dll i IEExec.exe zostały usunięte z programu .NET Framework. | Do tworzenia formantów niestandardowych w aplikacjach sieci Web można używać następujących technologii:<br><br>* Można utworzyć aplikację Silverlight i skonfigurować ją tak, aby działała poza przeglądarką. Aby uzyskać więcej informacji, zobacz [Obsługa poza przeglądarką](https://docs.microsoft.com/previous-versions/windows/silverlight/dotnet-windows-silverlight/dd550721%28v=vs.95%29).<br>* Można utworzyć aplikację przeglądarki XAML (XBAP), aby skorzystać z możliwości WPF (wymaga .NET Framework na komputerach klienckich). Aby uzyskać więcej informacji, zobacz [Omówienie aplikacji przeglądarki WPF XAML](../wpf/app-development/wpf-xaml-browser-applications-overview.md). |
| **Metody HtmlEncode i UrlEncode** | Metody `HtmlEncode` `UrlEncode` i <xref:System.Web.HttpServerUtility> klasy <xref:System.Web.HttpUtility> zostały zaktualizowane w celu zakodowania pojedynczego znaku cudzysłowu (') w następujący sposób:<br><br>* `HtmlEncode` Metoda koduje wystąpienia pojedynczego cudzysłowu jako`&#39;`<br>* `UrlEncode` Metoda koduje wystąpienia pojedynczego cudzysłowu jako`%27` | Sprawdź kod dla miejsc, `HtmlEncode` w `UrlEncode` których używasz i metody i upewnij się, że zmiana w kodowaniu nie powoduje zmiany, które mogłyby mieć wpływ na aplikację. |
| **Błędy httpException w aplikacjach ASP.NET 2.0** | Po włączeniu ASP.NET 4 w usługach IIS 6 ASP.NET aplikacje 2.0 uruchamiane w systemie IIS 6 (w systemie Windows Server 2003 lub Windows Server 2003 R2) mogą generować następujące błędy:`System.Web.HttpException: Path '/[yourApplicationRoot]/eurl.axd/[Value]' was not found.` | * Jeśli ASP.NET 4 nie jest wymagane do uruchomienia witryny sieci Web, ponownie zamapuj witrynę, aby zamiast tego użyć ASP.NET 2.0.<br><br>— lub —<br><br>* Jeśli do uruchomienia witryny sieci Web wymagany jest ASP.NET 4, przenieś wszystkie katalogi wirtualne ASP.NET 2.0 dla dzieci do innej witryny sieci Web, która jest mapowana na ASP.NET 2.0.<br><br>— lub —<br><br>* Wyłącz adresy URL bez rozszerzenia. Aby uzyskać więcej informacji, zobacz "ASP.NET 2.0 Aplikacje mogą generować błędy httpException, które odwołują się do eurl.axd" w dokumencie [ASP.NET 4 Przełomowe zmiany](/aspnet/whitepapers/aspnet4/breaking-changes) w witrynie sieci Web ASP.NET. |
| **Typy członkostwa** | Niektóre typy (na przykład <xref:System.Web.Security.MembershipProvider>), które są używane w ASP.NET członkostwie zostały przeniesione z pliku System.Web.dll do zestawu System.Web.ApplicationServices.dll. Typy zostały przeniesione w celu rozwiązania zależności warstw architektonicznych między typami w kliencie i w rozszerzonych jednostek SKU .NET Framework. | Biblioteki klas, które zostały uaktualnione z wcześniejszych wersji ASP.NET i które używają typów członkostwa, które zostały przeniesione, mogą nie zostać skompilowane, gdy są używane w projekcie ASP.NET 4. Jeśli tak, dodaj odwołanie w projekcie biblioteki klas do pliku System.Web.ApplicationServices.dll. |
| **Zmiany w formancie menu** | Zmiany w <xref:System.Web.UI.WebControls.Menu> formancie powodują następujące zachowanie:<br><br>* <xref:System.Web.UI.WebControls.MenuRenderingMode> Jeśli jest `List`ustawiona <xref:System.Web.UI.WebControls.MenuRenderingMode> na `Default` , <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> lub `4.0` jeśli jest <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> ustawiona na i jest ustawiona na lub później, właściwość nie ma wpływu.<br>* Jeśli ścieżka ustawiona <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> we <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> właściwościach i zawiera\\ukośnik odwrotny ( ), obrazy nie są renderowane. (We wcześniejszych wersjach ASP.NET ścieżka może zawierać ukośnik odwrotny). | * Zamiast ustawiać <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> właściwość dla poszczególnych <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> elementów <xref:System.Web.UI.WebControls.Menu> menu, ustaw lub formantu nadrzędnego.<br><br>— lub —<br><br>Ustaw <xref:System.Web.UI.WebControls.MenuRenderingMode> `Table`na , <xref:System.Web.UI.WebControls.MenuRenderingMode> `Default` lub <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> ustawić `3.5`na . Te ustawienia <xref:System.Web.UI.WebControls.Menu> powodują, że formant używa układu opartego na tabeli HTML, który był używany we wcześniejszych wersjach ASP.NET.<br>* Jeśli ścieżka <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> w <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> lub właściwość zawiera\\ukośnik odwrotny ( ), zastąpić ukośnik znak (/). |
| **Zestaw mobilny w pliku Web.config** | W poprzednich wersjach ASP.NET odwołanie do zestawu System.Web.Mobile.dll zostało zawarte w głównym pliku `assemblies` Web.config w sekcji w obszarze `system.web` / `compilation`. Aby zwiększyć wydajność, odwołanie do tego zestawu zostało usunięte.<br><br>Uwaga: Zestaw System.Web.Mobile.dll i ASP.NET kontrolki mobilne są zawarte w ASP.NET 4, ale są przestarzałe. | Jeśli chcesz używać typów z tego zestawu, dodaj odwołanie do zestawu w głównym pliku Web.config lub w pliku Web.config aplikacji. |
| **Buforowanie danych wyjściowych** | W ASP.NET 1.0 błąd spowodował buforowane strony, które określono `Location="ServerAndClient"` jako ustawienie `Vary:*` pamięci podręcznej danych wyjściowych€", aby emitować nagłówek HTTP w odpowiedzi. Miało to wpływ na poinformowanie przeglądarek klienckich, aby nigdy nie buforować strony lokalnie. W ASP.NET 1.1 dodano <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A> metodę, która może być wywoływana `Vary:*` w celu wygaszenia nagłówka. Jednak raporty o błędach sugerują, `SetOmitVaryStar` że deweloperzy nie są świadomi istniejącego zachowania.<br><br>W ASP.NET 4 nagłówek `Vary:*` HTTP nie jest już emitowany z odpowiedzi, które określają następującą dyrektywę:<br><br>`<%@ OutputCache Location="ServerAndClient" %>`<br><br>W rezultacie <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A> metoda nie jest już potrzebna `Vary:*` w celu wygaszenia nagłówka. W aplikacjach, które określają "ServerAndClient" dla atrybutu, `Location` strony będą buforowane <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A>w przeglądarce bez konieczności wywoływania . | Jeśli strony w aplikacji `Vary:*`muszą <xref:System.Web.HttpResponse.AppendHeader%2A> emitować, wywołaj metodę, jak pokazano w poniższym przykładzie:<br><br>`System.Web.HttpResponse.AppendHeader("Vary","*");`<br><br>Alternatywnie można zmienić wartość wyjściowego atrybutu buforowania `Location` na "Serwer". |
| **Analizowanie stron** | Analizator stron dla ASP.NET stron sieci Web (pliki aspx) i formantów użytkownika (pliki ascx) jest bardziej rygorystyczny w ASP.NET 4 niż we wcześniejszych wersjach ASP.NET i oznacza więcej znaczników jako nieprawidłowych niż we wcześniejszych wersjach. | Sprawdź komunikaty o błędach, które są tworzone podczas pracy strony i naprawić błędy, które wynikają z nieprawidłowego znaczników. |
| **Typy paszportów** | Obsługa usługi Passport wbudowana w ASP.NET 2.0 jest przestarzała i nie jest obsługiwana ze względu na zmiany w ucho. W rezultacie typy związane z <xref:System.Web.Security> passport in `ObsoleteAttribute` są teraz oznaczone atrybutem. | Zmień dowolny kod, który używa typów <xref:System.Web.Security> usługi Passport w <xref:System.Web.Security.PassportIdentity>obszarze nazw (na przykład ) do używania sdk windows live IDK. |
| **Informacje PathInfo we właściwości FilePath** | ASP.NET 4 nie zawiera `PathInfo` już wartości zwracanej z właściwości <xref:System.Web.HttpRequest.FilePath> <xref:System.Web.HttpRequest.AppRelativeCurrentExecutionFilePath>takich <xref:System.Web.HttpRequest.CurrentExecutionFilePath>jak , i . Zamiast tego `PathInfo` informacje są <xref:System.Web.HttpRequest.PathInfo>dostępne w pliku . Załóżmy na przykład następujący fragment adresu URL:<br><br>`/testapp/Action.mvc/SomeAction`<br><br>We wcześniejszych wersjach ASP.NET <xref:System.Web.HttpRequest> właściwości mają następujące wartości:<br><br>* <xref:System.Web.HttpRequest.FilePath>: `/testapp/Action.mvc/SomeAction`<br>* <xref:System.Web.HttpRequest.PathInfo>: (pusty)<br><br>W ASP.NET 4 <xref:System.Web.HttpRequest> właściwości mają zamiast tego następujące wartości:<br><br>* <xref:System.Web.HttpRequest.FilePath>: `/testapp/Action.mvc`<br>* <xref:System.Web.HttpRequest.PathInfo>: `SomeAction` | Sprawdź swój kod dla miejsc, w <xref:System.Web.HttpRequest> których można polegać na właściwości klasy, aby zwrócić informacje o ścieżce; zmienić kod, aby odzwierciedlić zmiany w sposobie zwracania informacji o ścieżce. |
| **Sprawdzanie poprawności żądania** | Aby poprawić sprawdzanie poprawności żądania, sprawdzanie poprawności żądania ASP.NET jest wywoływana wcześniej w cyklu życia żądania. W rezultacie sprawdzanie poprawności żądań jest uruchamiane dla żądań, które nie są dla plików .aspx, takich jak wywołania usługi sieci Web i niestandardowych programów obsługi. Sprawdzanie poprawności żądania będzie również aktywne, gdy niestandardowe moduły HTTP są uruchomione w potoku przetwarzania żądań.<br><br>W wyniku tej zmiany żądania dotyczące zasobów innych niż pliki aspx mogą powodować błędy sprawdzania poprawności żądania. Kod niestandardowy, który działa w potoku żądań (na przykład niestandardowe moduły HTTP) może również zgłaszać błędy sprawdzania poprawności żądania. | W razie potrzeby można przywrócić stare zachowanie, że tylko strony .aspx wyzwalają sprawdzanie poprawności żądania, używając następującego ustawienia w pliku konfiguracji sieci Web:<br><br>`<httpRuntime requestValidationMode="2.0" />`<br><br>Ostrzeżenie: Jeśli powrócisz do starego zachowania, upewnij się, że cały kod w istniejących programach obsługi, modułów i innego kodu niestandardowego wykonuje kontrole potencjalnie niebezpiecznych danych wejściowych HTTP, które mogą być wektorami ataku XSS. |
| **Routing** | Jeśli w programie Visual Studio 2010 utworzysz witrynę sieci Web systemu plików, a witryna sieci Web znajduje się w folderze zawierającym kropkę (.) w nazwie folderu, routing adresów URL nie będzie działać niezawodnie. Błąd HTTP 404 jest zwracany z niektórych ścieżek wirtualnych. Dzieje się tak, ponieważ program Visual Studio 2010 uruchamia program Visual Studio Development Server przy użyciu niepoprawnej ścieżki dla głównego katalogu wirtualnego. | * Na stronie **Właściwości witryny** sieci Web opartej na plikach zmień atrybut **Ścieżka wirtualna** na "/".<br><br>— lub —<br><br>* Utwórz projekt aplikacji sieci Web zamiast projektu witryny sieci Web. Projekty aplikacji sieci Web nie mają tego problemu, a routing adresów URL działa, nawet jeśli folder projektu ma kropkę w nazwie.<br><br>— lub —<br><br>* Utwórz witrynę sieci Web opartą na protokoście z protokołem HTTP, która jest hostowana w serwisach IIS. Witryny sieci Web hostowane przez usługi IIS mogą mieć kropki w ścieżce wirtualnej, a także w folderze plików projektu. |
| **Witryny programu SharePoint** | W przypadku próby uruchomienia witryny sieci Web ASP.NET 4, która jest wdrażana jako element podrzędny witryny sieci Web programu SharePoint zawierającej niestandardowy poziom częściowego zaufania o nazwie `WSS_Minimal`, zostanie wyświetlony następujący błąd:<br><br>`Could not find permission set named 'ASP.Net'.` | Obecnie żadne wersje programu SharePoint nie są zgodne z ASP.NET. W związku z tym nie należy podejmować prób uruchamiania witryny sieci Web ASP.NET 4 jako element podrzędny witryny sieci Web programu SharePoint. |
| **Normy XHTML 1.1** | Aby włączyć zgodność z programem XHTML 1.1 dla nowych witryn sieci Web, ASP.NET formantów w programie .NET Framework 4 wygeneruje kod HTML zgodny ze standardem XHTML 1.1. Renderowanie to jest włączone przy użyciu następującej opcji w `<system.Web>` pliku Web.config wewnątrz elementu:<br><br>`<pages controlRenderingCompatibilityVersion="4.0"/>`<br><br>Ta opcja jest domyślnie ustawiona na 4.0. Projekty sieci Web uaktualnione z programu Visual Studio 2008 mają włączone ustawienie 3.5 dla zgodności. | Brak. |

## <a name="core"></a>Podstawowe

### <a name="general-features"></a>Funkcje ogólne

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **CardSpace** | Program Windows CardSpace nie jest już uwzględniony w programie .NET Framework; jest dostarczany oddzielnie. | Pobierz program Windows CardSpace z [Centrum pobierania Microsoft](https://go.microsoft.com/fwlink/?LinkId=199868). |
| **Pliki konfiguracyjne** | Wprowadzono poprawki w sposobie uzyskiwania dostępu do plików konfiguracyjnych aplikacji przez platformę .NET Framework. | Jeśli plik konfiguracji aplikacji nosi nazwę *application-name.config*, zmień jego nazwę na *application-name.exe.config*. Na przykład zmień nazwę *myapp.config* na *MyApp.exe.config*. |
| **Kompilator kodu języka C#** | Klasy `Compiler` `CompilerError`, `ErrorLevel` i klasy, <xref:Microsoft.CSharp> które znajdowały się w obszarze nazw, nie są już dostępne, a ich zestaw (cscompmgd.dll) nie jest już uwzględniony w programie .NET Framework. | Użyj <xref:System.CodeDom.Compiler.CodeDomProvider> klasy i innych <xref:System.CodeDom.Compiler> klas w obszarze nazw. Aby uzyskać więcej informacji, zobacz [Korzystanie z codedom](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/y2k85ax6%28v=vs.100%29). |
| **Hosting** (niezarządzany interfejs API) | Aby poprawić możliwości hostingu, niektóre interfejsy API aktywacji hostingu zostały przestarzałe. Funkcje wykonywania w trakcie procesu umożliwiają aplikacji ładowanie i uruchamianie wielu wersji programu .NET Framework w tym samym procesie. Na przykład można uruchamiać aplikacje, które ładują dodatki (lub składniki), które są oparte na .NET Framework 2.0 SP1 i dodatki, które są oparte na programie .NET Framework 4 w tym samym procesie. Starsze składniki nadal używają starszej wersji programu .NET Framework, a nowe składniki używają nowej wersji programu .NET Framework. | Użyj konfiguracji opisanych [w wykonaniu w procesie side-by-side](../deployment/in-process-side-by-side-execution.md). |
| **Nowy model zabezpieczeń** | Zasady zabezpieczeń dostępu do kodu (CAS) zostały wyłączone i zastąpione uproszczonym modelem, zgodnie z opisem w [obszarze Zmiany zabezpieczeń w programie .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd233103%28v=vs.100%29). | Modyfikacje mogą być wymagane, jeśli zależy od cas w aplikacjach. Aby uzyskać więcej informacji, zobacz [Zgodność zasad zabezpieczeń dostępu do kodu i migracja](../misc/code-access-security-policy-compatibility-and-migration.md). |

### <a name="date-and-time"></a>Data i godzina

Przestrzeń nazw: <xref:System>; montaż: mscorlib (w mscorlib.dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Czasu letniego** | Aby być zgodne z zegarem systemowym, <xref:System.TimeZoneInfo.Local> <xref:System.DateTime.Now>właściwości czasu (takie jak i ) używają teraz reguł systemu operacyjnego zamiast innych danych programu .NET Framework dla operacji czasu letniego. | Brak. |
| **Ciągi formatowania** | Aby obsługiwać formatowanie uwzględniające kulturę, <xref:System.TimeSpan> struktura zawiera `ToString` `Parse`nowe `TryParse` przeciążenia , `ParseExact` `TryParseExact` i metody oprócz nowych i metod. | Brak. |

### <a name="globalization"></a>Globalizacja

Aby uzyskać listę nowych neutralnych i konkretnych kultur, zobacz [Co nowego w globalizacji i lokalizacji](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd997383%28v=vs.100%29).

Przestrzeń nazw: <xref:System.Globalization>; montaż: mscorlib (w mscorlib.dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Nazwy kultury** | Następujące zmiany nazwy wpływają na kultury niemieckie, Divehi i afryki:<br><br>* <xref:System.Globalization.CultureAndRegionInfoBuilder.CurrencyEnglishName>: Nazwa waluty kultury niemieckiej (Switizerland) (de-CH) zmieniła się z "sFr". "Fr.".<br>* <xref:System.Globalization.DateTimeFormatInfo.LongDatePattern>: Długi wzór daty dla kultury Divehi (Malediwy) (dv-MV) zmienił się z "dd/MMMM/yyyy" na "dd/MM/yyyy".<br>* <xref:System.Globalization.DateTimeFormatInfo.PMDesignator>: P.M. projektator afrikaans (Republika Południowej Afryki) (af-ZA) kultury zmienił się z "nm" na "PM". | Uwaga zmiany nazwy kultury. |
| **Parametr LCID** | Aby być zgodne z oczekiwanym zachowaniem w ustawieniach serwera automatyzacji, CLR nie przekazuje bieżącej kultury dla parametru `LCID` do niezarządzanych aplikacji opartych na COM. Zamiast tego przechodzi 1033 (en-us) dla kultury. | Nie konieczne modyfikacje z wyjątkiem aplikacji natywnych, które wymagają określonej kultury. |
| **Przestarzałe typy kultury** | <xref:System.Globalization.CultureTypes> Typy <xref:System.Globalization.CultureTypes> i kultury są teraz przestarzałe.<br><br>W celu zapewnienia zgodności <xref:System.Globalization.CultureTypes> z poprzednimi wersjami, teraz zwraca neutralne i <xref:System.Globalization.CultureTypes> określone kultury, które zostały uwzględnione w poprzednim .NET Framework, a teraz zwraca pustą listę. | Użyj innych wartości <xref:System.Globalization.CultureTypes> wyliczenia. |
| **Pobieranie kultury** | Począwszy od systemu Windows 7, .NET Framework 4 pobiera informacje o kulturze z systemu operacyjnego zamiast przechowywania danych. Ponadto program .NET Framework synchronizuje się z systemem Windows w celu sortowania i tworzenia danych dotyczących wielkości liter. | Brak. |
| **Standardy Unicode 5.1** | .NET Framework obsługuje teraz wszystkie znaki Unicode 5.1 — dodanie około 1400 znaków. Dodatkowe znaki obejmują nowe symbole, strzałki, znaki diakrytyczne, znaki interpunkcyjne, symbole matematyczne, obrysy II CJK i ideografy, dodatkowe znaki numeryczne malajalam i telugu oraz różne znaki birmańskie, łacińskie, arabskie, greckie, mongolskie i cyrylicy Znaków. Następujące nowe skrypty są obsługiwane przez Unicode 5.1: Sundanese, Lepcha, Ol Chiki, Vai, Saurashtra, Kayah Li, Rejang, Gurmukhi, Odia, Tamil, Telugu i Malayalam znaków i Cham. | Brak. |

### <a name="exceptions"></a>Wyjątki

Przestrzenie <xref:System>nazw: <xref:System.Runtime.ExceptionServices>, ; montaż: mscorlib (w mscorlib.dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Wyjątki dla uszkodzonego stanu procesu** | Program CLR nie zapewnia już wyjątków dla stanu uszkodzonego procesu dla obsługi wyjątków w kodzie zarządzanym. | Wyjątki te wskazują, że stan procesu został uszkodzony. Nie zaleca się uruchamiania aplikacji w tym stanie.<br><br>Aby uzyskać więcej <xref:System.Runtime.ExceptionServices.HandleProcessCorruptedStateExceptionsAttribute> informacji, zobacz i wpis [Obsługa wyjątków uszkodzonych stanów](https://docs.microsoft.com/archive/msdn-magazine/2009/february/clr-inside-out-handling-corrupted-state-exceptions) w magazynie MSDN. |
| **Wyjątki aparatu wykonania** | <xref:System.ExecutionEngineException>jest teraz przestarzały, ponieważ catchable wyjątek pozwoli na proces niestabilny, aby kontynuować uruchamianie. Ta zmiana zwiększa przewidywalność i niezawodność w czasie wykonywania. | Użyj, <xref:System.InvalidOperationException> aby zasygnalizować stan. |

### <a name="reflection"></a>Odbicie

Przestrzeń nazw: <xref:System.Reflection>; montaż: mscorlib (w mscorlib.dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Algorytmy mieszania zestawu** | Właściwość <xref:System.Reflection.AssemblyName.HashAlgorithm> zwraca <xref:System.Configuration.Assemblies.AssemblyHashAlgorithm>teraz, ponieważ środowisko wykonawcze nie zna algorytmu mieszania zestawu, do którego istnieje odwołanie, gdy zestaw nie jest ładowany. (Odnosi się to do używania właściwości w zestawie, <xref:System.Reflection.Assembly.GetReferencedAssemblies%2A> do którego istnieje odwołanie, takiej jak zwracana przez metodę). | Brak. |
| **Obciążenie zespołu** | Aby zapobiec nadmiarowemu obciążeniu złożeń i zaoszczędzić wirtualną przestrzeń adresową, środowisko `MapViewOfFile` CLR ładuje teraz zestawy przy użyciu tylko funkcji Win32. Nie wywołuje już `LoadLibrary` również funkcji.<br><br>Ta zmiana wpływa na aplikacje diagnostyczne w następujący sposób:<br><br>* <xref:System.Diagnostics.ProcessModuleCollection> A nie będzie już zawierać żadnych modułów z biblioteki klas (plik dll), otrzymanych z połączenia do `Process.GetCurrentProcess().Modules`.<br>* Aplikacje Win32, które korzystają z `EnumProcessModules` funkcji, nie zobaczą wszystkich zarządzanych modułów na liście. | Brak. |
| **Deklarowanie typu** | Właściwość <xref:System.Type.DeclaringType> teraz poprawnie zwraca wartość null, gdy typ nie ma typu deklarowania. | Brak. |
| **Delegaty** | Delegat teraz zgłasza <xref:System.ArgumentNullException> zamiast, <xref:System.NullReferenceException> gdy wartość null jest przekazywana do konstruktora delegata. | Upewnij się, że <xref:System.ArgumentNullException>wszelkie wyjątki obsługi połowów . |
| **Zmiana lokalizacji globalnej pamięci podręcznej zestawów** | W przypadku zestawów programu .NET Framework 4 globalna pamięć podręczna zestawów została przeniesiona z katalogu systemu Windows (%WINDIR%) do podkatalogu Microsoft.Net (*%WINDIR%\\Microsoft.Net*). Zestawy z wcześniejszych wersji pozostają w starszym katalogu.<br><br>Niezarządzane wyliczenie [ASM_CACHE_FLAGS](../unmanaged-api/fusion/asm-cache-flags-enumeration.md) zawiera nową `ASM_CACHE_ROOT_EX` flagę. Ta flaga pobiera lokalizację pamięci podręcznej dla .NET Framework 4 zestawów, które można uzyskać za pomocą funkcji [GetCachePath.](../unmanaged-api/fusion/getcachepath-function.md) | Brak, przy założeniu, że aplikacje nie używają jawnych ścieżek do zestawów, co nie jest zalecaną praktyką. |
| **Narzędzie globalnej pamięci podręcznej zestawów** | [Gacutil.exe (Global Assembly Cache Tool)](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ex0ss12c%28v=vs.100%29) nie obsługuje już przeglądarki wtyczek powłoki. | Brak. |

### <a name="interoperability"></a>Współdziałanie

Przestrzeń nazw: <xref:System.Runtime.InteropServices>; montaż: mscorlib (w mscorlib.dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Długość buforu** (niezarządzany interfejs API) | Aby zapisać pamięć, funkcja `pBufferLengthOffset` parametru [dla metody ICorProfilerInfo2::GetStringLayout](../unmanaged-api/profiling/icorprofilerinfo2-getstringlayout-method.md) została `pStringLengthOffset` zmieniona w celu dopasowania do parametru. Oba parametry wskazują teraz położenie odsunięcia długości ciągu. Długość buforu została usunięta z reprezentacji klasy ciągu. | Usuń wszelkie zależności od długości buforu. |
| **Debugowanie JIT** | Aby uprościć rejestrację debugowania just-in-time (JIT), debuger .NET Framework używa teraz tylko klucza rejestru AeDebug, który kontroluje zachowanie debugowania JIT dla kodu macierzystego. Ta zmiana powoduje, że:<br><br>* Nie można już zarejestrować dwa różne debugery dla kodu zarządzanego i natywnego.<br>* Nie można już automatycznie uruchomić debugera dla procesu nieinteraktywnego, ale można monitować użytkownika o interaktywny proces.<br>* Nie są już powiadamiane, gdy debuger nie można uruchomić lub gdy nie ma zarejestrowanego debugera, który powinien zostać uruchomiony.<br>* Zasady automatycznego uruchamiania, które zależą od interaktywności aplikacji, nie są już obsługiwane. | Dostosuj operacje debugowania zgodnie z wymaganiami. |
| **Wywołanie platformy** | Aby zwiększyć wydajność w współdziałanie z kodem niezarządzanym, niepoprawne konwencje wywoływania w platformie wywołać teraz spowodować niepowodzenie aplikacji. W poprzednich wersjach warstwy organizowania rozwiązać te błędy w górę stosu. | Debugowanie aplikacji w programie Microsoft Visual Studio ostrzega o tych błędach, dzięki czemu można je poprawić.<br><br>Jeśli masz pliki binarne, które nie mogą być aktualizowane, można dołączyć [ \<NetFx40_PInvokeStackResilience>](../configure-apps/file-schema/runtime/netfx40-pinvokestackresilience-element.md) element w pliku konfiguracji aplikacji, aby umożliwić wywoływanie błędów, które mają być rozwiązane stosu, jak we wcześniejszych wersjach. Może to jednak wpłynąć na wydajność aplikacji. |
| **Usunięto interfejsy** (niezarządzany interfejs API) | Aby uniknąć nieporozumień dewelopera, następujące interfejsy zostały usunięte, ponieważ nie dostarczyły żadnych przydatnych scenariuszy w czasie wykonywania, a program CLR nie dostarczył ani nie zaakceptował żadnych implementacji:<br><br>* **INativeImageINativeImageZależność**<br>* **INativeImageInstallInfo**<br>* **INativeImageEwartuate**<br>* **INativeImageKonwerter**<br>* **ICorModule**<br>* **IMetaDataKonwerter** | Brak. |

## <a name="data"></a>Dane

W tej sekcji opisano problemy z migracją przy użyciu zestawów danych i klientów SQL, entity framework, LINQ do SQL i WCF Serwery danych (dawniej znany jako ADO.NET usług danych).

### <a name="dataset-and-sql-client"></a>Zestaw danych i klient SQL

W poniższej tabeli opisano ulepszenia funkcji, które wcześniej miały ograniczenia lub inne problemy.

Przestrzenie <xref:System.Data>nazw: <xref:System.Data.Objects.DataClasses> <xref:System.Data.SqlClient>, , ; zestawy: System.Data (w System.Data.dll), System.Data.Entity (w System.Data.Entity.dll)

| Funkcja | Różnice od 3,5 SP1 |
| ------- | ------------------------ |
| **Scenariusze POCO** | Interfejs <xref:System.Data.Objects.DataClasses.IRelatedEnd> ma nowe metody, aby poprawić jego użyteczność w zwykły stary obiekt CLR (POCO) scenariusze. Te nowe metody <xref:System.Object> wziąć zamiast <xref:System.Data.Objects.DataClasses.IEntityWithRelationships> jednostki jako parametr. |
| **Edytowanie wierszy** | Metoda, <xref:System.Collections.IList.IndexOf%2A> zaimplementowana <xref:System.Data.DataView> przez klasę, teraz poprawnie zwraca wartość wiersza, który jest edytowany, zamiast zwracać -1. |
| **Zdarzenia** | Zdarzenie <xref:System.Data.DataRowView.PropertyChanged> jest teraz wywoływane, gdy wiersz jest <xref:System.Data.DataRow.RejectChanges%2A> w stanie zmodyfikowanym i metoda jest wywoływana. Ta zmiana ułatwia tworzenie formantów interfejsu użytkownika, <xref:System.Data.DataSet> które ujawniają zawartość obiektu. |
| **Wyjątki** | Metoda <xref:System.Data.SqlClient.SqlCommand.Prepare%2A> teraz <xref:System.InvalidOperationException> zgłasza, gdy połączenie nie jest ustawione lub <xref:System.NullReferenceException>otwarte zamiast . |
| **Widoki mapowania** | Błędy mapowania widoku kwerendy są teraz przechwytywanie <xref:System.NullReferenceException> w czasie projektowania zamiast rzucania w czasie wykonywania.<br><br>Sprawdzanie poprawności mapowania teraz przechwytuje błąd, w którym dwa zestawy skojarzeń w schemacie koncepcyjnym (CSDL) są mapowane do tej samej kolumny. |
| **Transakcje** | Jeśli aplikacja próbuje wykonać instrukcję na połączenie po zakończeniu transakcji (w tym przerwane lub wycofane), jest <xref:System.InvalidOperationException> teraz generowany. Poprzednie wersje nie zgłaszały wyjątku i umożliwiają wykonywanie dodatkowych poleceń, nawet jeśli transakcja została przerwana. |

### <a name="entity-framework"></a>Entity Framework

W poniższej tabeli opisano ulepszenia funkcji, które wcześniej miały ograniczenia lub inne problemy.

Przestrzenie <xref:System.Data>nazw: <xref:System.Data.Objects> <xref:System.Data.Objects.DataClasses>, , ; assembly: System.Data.Entity (w system.Data.Entity.dll)

| Funkcja | Różnice od 3,5 SP1 |
| ------- | ------------------------ |
| **Obiekty encji** | Istnieje teraz parzystość między <xref:System.Data.Objects.ObjectContext.Detach%2A> metodą a stanem obiektu jednostki, gdy <xref:System.Data.Objects.ObjectContext.SaveChanges%2A> wywoływana jest metoda. Ta ulepszona spójność zapobiega zgłaszaniu nieoczekiwanych wyjątków. |
| **Entity SQL** | Udoskonalono reguły rozpoznawania identyfikatorów w programie Entity SQL.<br><br>Analizator SQL jednostki udoskonalił logikę rozpoznawania identyfikatorów wieloczęściowych. |
| **Adnotacje strukturalne** | Entity Framework rozpoznaje teraz adnotacje strukturalne. |
| **Zapytania** | Następujące ulepszenia zostały wprowadzone w zapytaniach:<br><br>* `GroupBy` Kwerenda używająca klucza zerowego nad pustą kolekcją nie zwróci żadnych wierszy, niezależnie od tego, czy w kwerendzie znajdują się dodatkowe zaznaczenia.<br>* Wygenerowane SQL w LINQ i Entity-SQL kwerendy teraz traktować parametry ciągu jako wartości innych niż Unicode domyślnie. |

### <a name="linq-to-sql"></a>LINQ to SQL

W poniższej tabeli opisano ulepszenia funkcji, które wcześniej miały ograniczenia lub inne problemy.

Przestrzeń nazw: <xref:System.Data.Linq>; montaż: System.Data.Linq (w System.Data.Linq.dll)

| Funkcja | Różnice od 3,5 SP1 |
| ------- | ------------------------ |
| **Zdarzenia** | Kolekcja <xref:System.Data.Linq.EntitySet%601> teraz wywołuje <xref:System.Data.Linq.EntitySet%601.ListChanged> zdarzenie do dodawania i <xref:System.Data.Linq.EntitySet%601> usuwania operacji, jeśli jest zwolniony, oprócz podnoszenia zdarzenia podczas ładowania kolekcji. |
| **Zapytania** | `Skip(0)`nie jest już ignorowana w LINQ do zapytań SQL. W rezultacie kwerendy, które mają tę metodę może zachowywać się inaczej. Na `OrderBy` przykład w niektórych przypadkach klauzula jest wymagana z `Skip(0)` <xref:System.NotSupportedException> , a `OrderBy` kwerenda będzie teraz zgłaszać wyjątek, jeśli klauzula nie została uwzględniona. |

### <a name="wcf-data-services"></a>Usługi danych WCF

W poniższej tabeli opisano ulepszenia funkcji, które wcześniej miały ograniczenia lub inne problemy.

Przestrzenie <xref:System.Data.Services>nazw: <xref:System.Data.Services.Client> <xref:System.Data.Services.Common>, <xref:System.Data.Services.Providers>, , ; zespoły: System.Data.Services (w System.Data.Services.dll), System.Data.Services.Client (w System.Data.Services.Client.dll)

| Funkcja | Różnice od 3,5 SP1 |
| ------- | ------------------------ |
| **Wsadowe treści binarne** | Usługi danych WCF obsługuje teraz wsadowej zawartości binarnej w żądaniach i odpowiedziach. |
| **Zmienianie myśliwców przechwytujących** | Zmieniaj interceptory są teraz wykonywane dla żądania usunięcia.<br><br>Interceptor zmiany jest metodą, która jest uruchamiana za każdym razem, gdy żądanie jest odbierane przez serwer, aby zmodyfikować jednostkę w zestawie jednostek. Jest uruchamiany przed wykonaniem żądania przychodzącego. Interceptor zmiany zapewnia dostęp do jednostki, która jest zmieniana i operacji, która jest wykonywana na nim. |
| **Wyjątki** | Następujące warunki zgłaszają teraz bardziej przydatne wyjątki <xref:System.NullReferenceException>zamiast:<br><br>* <xref:System.ServiceProcess.TimeoutException> A po przesiądeniu czasu połączenia z usługą danych.<br>* <xref:System.Data.Services.Client.DataServiceRequestException> A, gdy złe żądanie jest dokonywane do usługi danych.<br><br>W aplikacjach należy zmienić obsługę wyjątków, aby przechwyć nowe wyjątki. |
| **Nagłówki** | W nagłówkach wprowadzono następujące ulepszenia:<br><br>* Usługi danych WCF teraz `eTag` poprawnie odrzuca nagłówek, który ma nieokreśloną wartość.<br>* Usługi danych WCF zwraca teraz błąd i nie wykonuje żądania usunięcia `if-*` żądania do łącza, gdy nagłówek jest w żądaniu.<br>* Usługi danych WCF zwraca teraz błąd do klienta w formacie (Atom, JSON), który klient określony w nagłówku Akceptuj. |
| **Czytnik JSON** | Czytnik notacji obiektu JavaScript (JSON) zwraca teraz poprawnie błąd podczas odczytywania pojedynczego znaku ucieczki ukośnika odwrotnego ("\\") podczas przetwarzania ładunków JSON wysyłanych do usługi danych WCF. |
| **Scala** | Następujące ulepszenia zostały wprowadzone <xref:System.Data.Services.Client.MergeOption> do wyliczenia:<br><br>* <xref:System.Data.Services.Client.MergeOption> Opcja scalania nie modyfikuje już jednostki na kliencie w wyniku późniejszej odpowiedzi z usługi danych.<br>* <xref:System.Data.Services.Client.MergeOption> Opcja jest teraz spójna między dynamicznymi aktualizacjami SQL i opartymi na procedurach składowanych. |
| **Żądania** | Metoda <xref:System.Data.Services.DataService%601.OnStartProcessingRequest%2A> jest teraz wywoływana przed przetworzeniem żądania do usług danych. Dzięki temu żądanie działa <xref:System.Data.Services.Providers.ServiceOperation> poprawnie dla usług. |
| **Strumienie** | Usługi WCF Data Services nie zamyka już podstawowy strumień dla operacji odczytu i zapisu. |
| **Identyfikatory URI** | Poprawiono ucieczkę identyfikatorów URI przez klienta usług danych WCF. |

## <a name="windows-communication-foundation-wcf"></a>Windows Communication Foundation (WCF)

W poniższej tabeli opisano ulepszenia funkcji, które wcześniej miały ograniczenia lub inne problemy.

| Funkcja | Różnice od 3,5 SP1 |
| ------- | ------------------------ |
| **Pliki konfiguracyjne** | Aby włączyć dziedziczenie zachowań za pośrednictwem hierarchii plików konfiguracji, WCF obsługuje teraz scalanie między plikami konfiguracyjnymi.<br><br>Model dziedziczenia konfiguracji jest teraz rozwinięty, aby umożliwić użytkownikom definiowanie zachowań, które zostaną zastosowane do wszystkich usług, które są uruchomione na komputerze.<br><br>Zmiany w zachowaniu mogą wystąpić, jeśli istnieją zachowania o tej samej nazwie na różnych poziomach hierarchii. |
| **Hosting usług** | Nie można już `<serviceHostingEnvironment>` określić elementu konfiguracji na poziomie `allowDefinition="MachineToApplication"` usługi, dodając atrybut do definicji elementu.<br><br>Określanie `<serviceHostingEnvironment>` elementu na poziomie usługi jest technicznie niepoprawne i powoduje niespójne zachowanie. |

## <a name="windows-presentation-foundation-wpf"></a>Windows Presentation Foundation (WPF)

### <a name="applications"></a>Aplikacje

Przestrzenie <xref:System.Windows>nazw: <xref:System.Windows.Controls>, ; montaż: PresentationFramework (w PresentationFramework.dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Obsługa wyjątków** | Aby włączyć błędy, które mają być wykryte <xref:System.Reflection.TargetInvocationException> wcześniej, <xref:System.Exception.InnerException> WPF zgłasza i <xref:System.NullReferenceException>ustawia <xref:System.OutOfMemoryException> <xref:System.StackOverflowException>właściwość <xref:System.Security.SecurityException>na wyjątki krytyczne, takie jak , , i , zamiast przechwytywania oryginalnego wyjątku. | Brak. |
| **Połączone zasoby** | Aby ułatwić łączenie, pliki zasobów (takie jak obrazy), które znajdują się w lokalizacji innej niż struktura folderów projektu, użyj pełnej ścieżki pliku zasobów, a nie tylko jego nazwy pliku jako identyfikatora zasobu podczas tworzenia aplikacji. Aplikacja będzie mogła zlokalizować pliki w czasie wykonywania. | Brak. |
| **Aplikacje częściowego zaufania** | Ze względów bezpieczeństwa aplikacje oparte na systemie <xref:System.Windows.Controls.WebBrowser> Windows, <xref:System.Windows.Controls.Frame> które są uruchamiane <xref:System.Security.SecurityException> w częściowym zaufaniu i zawierają formant lub formant zawierający kod HTML, będą zgłaszać podczas tworzenia formantu.<br><br>Aplikacje przeglądarki zda wyjątek i wyświetli komunikat, jeśli spełnione są wszystkie następujące warunki:<br><br>* Aplikacja działa w Firefoksie.<br>* Aplikacja działa w częściowym zaufaniu do strefy Internet z niezaufanych witryn.<br>* Aplikacja zawiera <xref:System.Windows.Controls.WebBrowser> formant <xref:System.Windows.Controls.Frame> lub formant, który zawiera kod HTML.<br><br>Należy zauważyć, że nie będzie to miało wpływu na aplikacje uruchamiane z zaufanych witryn lub ze strefy intranetu. | W aplikacjach przeglądarki można ułatwić tę zmianę, wykonując jedną z następujących czynności:<br><br>* Uruchom aplikację przeglądarki w pełnym zaufaniu.<br>* Niech klienci dodadzą witrynę aplikacji do strefy zaufanych witryn.<br>* Czy klienci uruchamiają aplikację w programie Internet Explorer. |
| **Słowniki zasobów** | Aby poprawić słowniki zasobów na poziomie motywu i zapobiec ich zmianie, zasoby, które są zdefiniowane w słowniku zasobów i scalone w słownik na poziomie motywu, są teraz zawsze oznaczane jako zamrożone i niezmienne. Jest to oczekiwane zachowanie dla zasobów freezable. | Aplikacje modyfikując zasób, który jest zdefiniowany w słowniku scalonym na poziomie motywu należy sklonować zasób i zmodyfikować sklonowaną kopię. Alternatywnie zasób można `x:Shared="false"` oznaczyć tak, aby <xref:System.Windows.ResourceDictionary> tworzy nową kopię za każdym razem, gdy zasób jest wyszukiwany. |
| **Windows 7** | Aby aplikacje WPF działały lepiej w systemie Windows 7, wprowadzono następujące ulepszenia w celu skorygowania zachowania okna:<br><br>* Stany dokującej i gestów działają teraz zgodnie z oczekiwaniami na podstawie interakcji użytkownika.<br>* Polecenia paska zadań **Kaskada okna, Pokaż okna ułożone**i **Pokaż okna obok siebie** mają teraz poprawne zachowanie i zaktualizować odpowiednie właściwości.<br>* `Top`Właściwości `Left` `Width` `Height` okna zmaksymalizowanego lub zminimalizowanego zawierają teraz prawidłową lokalizację przywracania okna zamiast innych wartości, w zależności od monitora. | Brak. |
| **Styl i przezroczystość systemu Windows** | An <xref:System.InvalidOperationException> jest generowany, jeśli <xref:System.Windows.Window.WindowStyle> spróbujesz <xref:System.Windows.WindowStyle> ustawić <xref:System.Windows.Window.AllowsTransparency> `true` wartość <xref:System.Windows.WindowState> <xref:System.Windows.WindowState>inną niż kiedy jest i jest . | Jeśli musisz <xref:System.Windows.Window.WindowStyle> zmienić <xref:System.Windows.Window.AllowsTransparency> `true`kiedy jest , można `SetWindowLongPtr` wywołać funkcję Win32. |
| **Przeglądarka plików XPS** | WPF WPF nie zawiera pakietu Essentials Pack (XPSEP) specyfikacji papieru Microsoft XML. XpSEP jest dołączony do systemów Windows 7 i Windows Vista.<br><br>Na komputerze z systemem Windows XP bez zainstalowanego dodatku SP1 programu .NET Framework 3.5 drukowanie przy użyciu interfejsu API WPF innego niż te, które są dostępne, <xref:System.Windows.Controls.PrintDialog> będzie zależeć od usługi WINSPOOL. Niektóre funkcje drukarki nie zostaną zgłoszone, a niektóre ustawienia drukarki nie zostaną zastosowane podczas drukowania. | W razie potrzeby zainstaluj pakiet [Essentials Pack specyfikacji papieru XML firmy Microsoft](https://go.microsoft.com/fwlink/?LinkId=178895). |

### <a name="controls"></a>Kontrolki

Przestrzenie <xref:System.Windows>nazw: <xref:System.Windows.Controls> <xref:System.Windows.Data>, <xref:System.Windows.Input>, , ; zestawy: PresentationFramework (w PresentationFramework.dll), PresentationCore (w PresentationCore.dll), WindowsBase (w pliku WindowsBase.dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Okien dialogowych** | Aby zwiększyć niezawodność, <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> metoda jest wywoływana w <xref:Microsoft.Win32.FileDialog> tym samym wątku, który utworzył formant. | Pamiętaj, aby <xref:Microsoft.Win32.FileDialog> utworzyć formant <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> i wywołać metodę w tym samym wątku. |
| **Okna pływające** | Aby naprawić logikę przywracania fokusu, która niepoprawnie utrzymuje ponowne aktywowanie okna przestawnego (dzięki czemu wygląda jak modalne okno dialogowe), przywrócenie fokusu jest teraz zapobiegane, jeśli kandydat nie jest dziewiętnaskiem okna. | Brak. |
| **Przedmioty w kolekcjach** | Gdy element jest przenoszony lub dodawany do <xref:System.Windows.Data.CollectionView> podstawowej kolekcji, <xref:System.Windows.Data.CollectionView> pojawia się w tej samej lokalizacji względnej, jeśli nie jest sortowany. Zapewnia to spójność między położeniem elementu w kolekcji i w skojarzonym <xref:System.Windows.Data.CollectionView>. | Użyj <xref:System.Windows.Controls.ItemContainerGenerator.ContainerFromItem%2A> metody <xref:System.Windows.Data.CollectionView.IndexOf%2A> lub, aby znaleźć lokalizację <xref:System.Windows.Data.CollectionView> elementu w zamiast polegać na stałej lokalizacji towaru. |
| **Układy** | Aby wyeliminować niepotrzebne ponowne układy, zmiana <xref:System.Windows.Controls.Page.ShowsNavigationUI> nie unieważnia już układu lub powoduje inny przebieg układu. | Jeśli oczekujesz, <xref:System.Windows.Controls.Page.ShowsNavigationUI> że zmiana spowoduje <xref:System.Windows.UIElement.InvalidateVisual%2A> inny przebieg układu, wywołać po ustawieniu właściwości. |
| **Menu** | Aby włączyć ClearType tekst w menu pop-upy, <xref:System.Windows.Controls.ControlTemplate> modyfikacje <xref:System.Windows.Controls.MenuItem> zostały wprowadzone do klasy i formantu i innych formantów. | Aplikacje nie powinny polegać na strukturze wizualnej szablonów kontroli. Tylko wymienione części <xref:System.Windows.Controls.ControlTemplate> a są częścią zamówienia publicznego. Jeśli aplikacja musi znaleźć określony <xref:System.Windows.Controls.ControlTemplate>obiekt w , przeszukaj drzewo wizualne dla określonego typu zamiast polegać na stałej lokalizacji obiektu w drzewie. |
| **Nawigacja** | Jeśli <xref:System.Windows.Controls.Frame> bezpośrednio przechodzi do lokalizacji, <xref:System.Windows.Navigation.NavigatingCancelEventArgs.IsNavigationInitiator> właściwość `true` jest po początkowej nawigacji. Ta zmiana zapobiega wywoływania dodatkowych zdarzeń podczas scenariuszy uruchamiania. | Brak. |
| **Pop-upy** | Pełnomocnik <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> może być teraz wywoływany wiele razy podczas przebiegu układu, a nie tylko raz. | Jeśli <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> pełnomocnik oblicza położenie <xref:System.Windows.Controls.Primitives.Popup> na podstawie jego poprzedniego stanowiska, przelicz pozycję tylko `popupSize`wtedy, gdy zmienią się wartości `targetSize`, lub `offset` parametry. |
| **Wartości właściwości** | Metoda <xref:System.Windows.DependencyObject.SetCurrentValue%2A> umożliwia teraz ustawienie właściwości na wartość efektywną, chociaż nadal respektuje wszelkie powiązania, styl lub wyzwalacz, który wpływa na właściwość. | Autorzy kontroli <xref:System.Windows.DependencyObject.SetCurrentValue%2A> należy używać za każdym razem, gdy wartość właściwości zmienia się jako efekt uboczny niektórych innych akcji, w tym manipulacji użytkownika. |
| **Pola tekstowe** | Ze względów <xref:System.Windows.Forms.TextBoxBase.Copy%2A> bezpieczeństwa <xref:System.Windows.Forms.TextBoxBase.Cut%2A> i metody dyskretnie nie powiedzie się, gdy są one wywoływane w częściowym zaufaniu.<br><br>Ponadto programowe wykonanie <xref:System.Windows.Input.ApplicationCommands.Copy> lub <xref:System.Windows.Input.ApplicationCommands.Cut> właściwości na formancie, <xref:System.Windows.Controls.Primitives.TextBoxBase> który dziedziczy z zostaną zablokowane w częściowym zaufaniu. Jednak zainicjowane przez użytkownika polecenia kopiowania i wycinania, takie jak kliknięcie przycisku, którego <xref:System.Windows.Controls.Primitives.ButtonBase.Command> właściwość jest powiązana z jednym z tych poleceń, będą działać. Standardowe kopiowanie i przecinanie skrótów klawiaturowych i menu kontekstowego będzie nadal działać tak jak poprzednio w częściowym zaufaniu. | Powiąż <xref:System.Windows.Input.ApplicationCommands.Copy> polecenie lub <xref:System.Windows.Input.ApplicationCommands.Cut> z akcją inicjującą przez użytkownika, taką jak kliknięcie przycisku. |

### <a name="graphics"></a>Grafika

Przestrzenie <xref:System.Windows>nazw: <xref:System.Windows.Controls> <xref:System.Windows.Data>, <xref:System.Windows.Input> <xref:System.Windows.Media.Effects>, , , ; zestawy: PresentationFramework (w PresentationFramework.dll), PresentationCore (w PresentationCore.dll), WindowsBase (w pliku WindowsBase.dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Efekty mapy bitowej** | Aby zwiększyć wydajność, <xref:System.Windows.Media.Effects.BitmapEffect> klasy i klasy, <xref:System.Windows.Media.Effects.BitmapEffect> które dziedziczą z klasy, chociaż nadal obecne, są wyłączone. Efekt zostanie renderowany przy użyciu potoku renderowania przyspieszającego sprzętowo, jeśli spełnione są następujące warunki:<br><br>* Aplikacja używa <xref:System.Windows.Media.Effects.DropShadowBitmapEffect> lub <xref:System.Windows.Media.Effects.BlurBitmapEffect> a, który ma właściwość promień ustawiony mniej niż 100 DIU.<br>* Karta graficzna na komputerze z uruchomioną aplikacją obsługuje moduł cieniujący pikseli 2.0.<br><br>Jeśli te warunki nie <xref:System.Windows.Media.Effects.BitmapEffect> są spełnione, obiekt nie będzie miał wpływu.<br><br>Ponadto visual studio generuje ostrzeżenie kompilatora, <xref:System.Windows.Media.Effects.BitmapEffect> gdy napotka obiekt lub podklasę.<br><br>Metoda <xref:System.Windows.Media.DrawingContext.PushEffect%2A> jest oznaczona jako przestarzała. | Zaprzestać używania <xref:System.Windows.Media.Effects.BitmapEffect> starszych i pochodnych klas i zamiast <xref:System.Windows.Media.Effects.Effect> <xref:System.Windows.Media.Effects.BlurEffect>tego <xref:System.Windows.Media.Effects.DropShadowEffect>użyć <xref:System.Windows.Media.Effects.ShaderEffect>nowych klas pochodzących z : , i .<br><br>Można również utworzyć własne efekty, dziedzicząc z <xref:System.Windows.Media.Effects.ShaderEffect> klasy. |
| **Ramki bitmapowe** | Sklonowane <xref:System.Windows.Media.Imaging.BitmapFrame> obiekty otrzymują <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress> <xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted>teraz <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed> program , i zdarzenia. Dzięki temu obrazy, które są pobierane z <xref:System.Windows.Controls.Image> sieci <xref:System.Windows.Style> Web i stosowane do formantu za pośrednictwem a do poprawnego działania.<br><br>Nastąpi zmiana zachowania tylko wtedy, gdy wszystkie następujące instrukcje są spełnione:<br><br>* Subskrybujesz <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>, <xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted>, <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed> lub zdarzenia.<br>* Źródło <xref:System.Windows.Media.Imaging.BitmapFrame> jest z sieci Web.<br>* <xref:System.Windows.Media.Imaging.BitmapFrame> Jest sklonowany, gdy pobieranie jest nadal w toku. | Sprawdź nadawcę w programie obsługi zdarzeń i podejmij <xref:System.Windows.Media.Imaging.BitmapFrame>działania tylko wtedy, gdy nadawcą jest oryginalny . |
| **Dekodowanie obrazów** | Aby zapobiec <xref:System.IO.IOException> nie jest obsługiwany, gdy obrazy mogą <xref:System.Windows.Media.Imaging.BitmapSource> nie dekodować, klasa spowoduje podniesienie <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed> zdarzenia, gdy nie dekoduje obrazu. | Usuń wszelkie obsługi <xref:System.IO.IOException>wyjątków <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed> dla programu i użyj zdarzenia, aby sprawdzić, czy błąd dekodowania. |

### <a name="input"></a>Dane wejściowe

Przestrzenie <xref:System.Windows>nazw: <xref:System.Windows.Controls> <xref:System.Windows.Data>, <xref:System.Windows.Input>, , ; zestawy: PresentationFramework (w PresentationFramework.dll), PresentationCore (w PresentationCore.dll), WindowsBase (w pliku WindowsBase.dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Powiązania wystąpienia poleceń** | Aby zapewnić mechanizm powiązania wystąpień poleceń opartych na widoku modelu <xref:System.Windows.Input.InputBinding> z gestami <xref:System.Windows.Freezable> wejściowymi <xref:System.Windows.DependencyObject>opartymi na widoku, klasa dziedziczy teraz zamiast . Następujące właściwości są teraz właściwości zależności:<br><br>* <xref:System.Windows.Input.InputBinding.Command><br>* <xref:System.Windows.Input.InputBinding.CommandParameter><br>* <xref:System.Windows.Input.InputBinding.CommandTarget><br><br>Ta zmiana powoduje, że:<br><br>* <xref:System.Windows.Input.InputBinding> Obiekt jest teraz zamrożony, gdy jest zarejestrowany, a nie pozostaje modyfikowalny.<br>* Nie można uzyskać <xref:System.Windows.Input.InputBinding> dostępu do obiektów na poziomie wystąpienia <xref:System.Windows.DependencyObject> z wielu wątków, ze względu na ograniczenia klasy.<br>* Nie można mutować powiązania wejściowe na poziomie klasy po <xref:System.Windows.Freezable> ich rejestracji, ze względu na ograniczenia klasy.<br>* Nie można określić powiązania wejściowe dla wystąpień poleceń, które są tworzone w view-model. | Tworzenie oddzielnych wystąpień <xref:System.Windows.Input.InputBinding> klasy na oddzielnych wątków, jeśli powiązania mają być modyfikowalne lub zamrozić je w inny sposób. Nie mutuj statycznego poziomu <xref:System.Windows.Input.InputBinding> klasy po jej zarejestrowaniu. |
| **Aplikacje przeglądarki** | Aplikacje przeglądarki WPF (. XBAP) teraz przetwarzać kluczowe zdarzenia, podobnie jak autonomiczne aplikacje WPF, tak aby obiekty odbierały kierowane zdarzenia kluczy w odpowiedniej kolejności. | Brak. |
| **Martwe kombinacje klawiszy** | WPF zaciemnia martwe klucze, które nie dają żadnego widocznego znaku, ale zamiast tego wskazuje, że klucz ma być połączony z następnym kluczem letter, aby uzyskać jeden znak. Zdarzenia wejściowe klucza, <xref:System.Windows.Input.Keyboard.KeyDownEvent> takie jak zdarzenie, raport, gdy <xref:System.Windows.Input.KeyEventArgs.Key> klucz jest <xref:System.Windows.Input.Key> kluczem martwym, ustawiając właściwość na wartość. Jest to zwykle oczekiwane zachowanie, ponieważ aplikacje zwykle nie mają na celu odpowiedzieć na dane wejściowe klawiatury, która tworzy połączony znak. | Aplikacje, które oczekują, aby odczytać klucze, które były częścią połączonych <xref:System.Windows.Input.KeyEventArgs.DeadCharProcessedKey> znaków można uzyskać teraz zaciemnione klucz przy użyciu właściwości. |
| **Menedżer fokusu** | Gdy <xref:System.Windows.Input.FocusManager.GetFocusedElement(System.Windows.DependencyObject)?displayProperty=nameWithType> metoda jest przekazywana element, który ma [IsFocusScope](xref:System.Windows.Input.FocusManager.IsFocusScope%2A) dołączone właściwość ustawiona do `true`, metoda zwraca element, który jest ostatnim elementem <xref:System.Windows.PresentationSource> skoncentrowanym na klawiaturze w tym zakresie fokusu, jeśli i tylko wtedy, gdy zwrócony element należy do tego samego obiektu jako element, który jest przekazywany do metody. | Brak. |

### <a name="ui-automation"></a>Automatyzacja interfejsu użytkownika

Przestrzeń <xref:System.Windows>nazw: <xref:System.Windows.Automation.Peers> <xref:System.Windows.Automation.Provider>, <xref:System.Windows.Controls> <xref:System.Windows.Data>, <xref:System.Windows.Input>, , , ; zestawy: PresentationFramework (w PresentationFramework.dll), PresentationCore (w PresentationCore.dll), UIAutomationProvider (w UIAutomationProvider.dll), WindowsBase (w pliku WindowsBase.dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Hierarchia klas widoków** | I <xref:System.Windows.Automation.Peers.TreeViewAutomationPeer> <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> klasy dziedziczą <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer> zamiast <xref:System.Windows.Automation.Peers.FrameworkElementAutomationPeer>. | Jeśli dziedziczysz <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> z klas i <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer.GetChildrenCore%2A> zastąpić metodę, należy rozważyć zwrócenie obiektu, który dziedziczy z nowej <xref:System.Windows.Automation.Peers.TreeViewDataItemAutomationPeer> klasy. |
| **Kontenery poza ekranem** | Aby naprawić niepoprawną wartość <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.IsOffscreenCore%2A> zwracaną, `false` metoda teraz poprawnie zwraca dla kontenerów towarów, które są przewijane poza widok. Ponadto wartość metody nie ma wpływu na okluzję przez inne okna lub czy element jest widoczny na określonym monitorze. | Brak. |
| **Menu i obiekty podrzędne** | Aby włączyć automatyzację interfejsu użytkownika menu, <xref:System.Windows.Controls.MenuItem> które <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer.GetChildrenCore%2A> zawierają elementy <xref:System.Windows.Automation.Peers.AutomationPeer> podrzędne inne <xref:System.Windows.UIElement> niż obiekty, <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer> metoda zwraca teraz obiekt obiektu podrzędnego, zamiast obiektu. | Brak. |
| **Nowe interfejsy i montaż** | Aby włączyć nowe funkcje automatyzacji interfejsu użytkownika, dodano następujące interfejsy:<br><br>* <xref:System.Windows.Automation.Provider.IItemContainerProvider><br>* <xref:System.Windows.Automation.Provider.ISynchronizedInputProvider><br>* <xref:System.Windows.Automation.Provider.IVirtualizedItemProvider> | Każdy projekt, który tworzy w programie WPF automation peers należy dodać jawne odwołanie do UIAutomationProvider.dll. |
| **Kciuki** | Metoda <xref:System.Windows.Automation.Peers.ThumbAutomationPeer.GetClassNameCore%2A> zwraca wartość zamiast null. W związku z <xref:System.Windows.Controls.GridSplitter> tym formanty, takie jak dziedziczenie z <xref:System.Windows.Controls.Primitives.Thumb> klasy zgłosi nazwę do automatyzacji interfejsu użytkownika. | Brak. |
| **Elementy zwirtualizowane** | Aby zwiększyć wydajność, <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetChildrenCore%2A> metoda zwraca tylko obiekty podrzędne, które są faktycznie w drzewie wizualnym, zamiast wszystkich obiektów podrzędnych, niezależnie od tego, czy są one zwirtualizowane. | Służy <xref:System.Windows.Automation.ItemContainerPattern> do iteracji wszystkich <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer>elementów programu . |

### <a name="xaml"></a>XAML

Przestrzenie <xref:System.Windows>nazw: <xref:System.Windows.Controls> <xref:System.Windows.Data>, <xref:System.Windows.Input> <xref:System.Windows.Markup>, , , ; zestawy: PresentationFramework (w PresentationFramework.dll), PresentationCore (w PresentationCore.dll), WindowsBase (w pliku WindowsBase.dll)

| Funkcja | Różnice od 3,5 SP1 | Zalecane zmiany |
| ------- | ------------------------ | ------------------- |
| **Rozszerzenie znaczników** | WPF WPF teraz poprawnie zawsze <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A> używa wartości z <xref:System.Windows.Markup.MarkupExtension> metody zamiast zwracania obiektu w niektórych przypadkach, gdy rozszerzenie znaczników jest używany do ustawiania właściwości lub do tworzenia elementu w kolekcji. Rozszerzenie znaczników może zwrócić się w niektórych przypadkach. | Jeśli aplikacja uzyskuje dostęp do <xref:System.Windows.Markup.MarkupExtension> zasobu, który zwrócił obiekt we <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A>wcześniejszych wersjach, <xref:System.Windows.Markup.MarkupExtension> odwołaj się do obiektu, który jest zwracany z obiektu, a nie do obiektu. |
| **Analizowanie atrybutów** | Atrybuty w języku XAML mogą teraz mieć tylko jeden okres. Na przykład prawidłowe są następujące elementy:<br><br>`<Button Background="Red"/>`(bez okresów)<br><br>`<Button Button.Background = "Red"/>`(jeden okres)<br><br>Następujące elementy nie są już prawidłowe:<br><br>`<Button Control.Button.Background = "Red"/>`(więcej niż jeden okres) | Popraw atrybuty XAML, które mają więcej niż jeden okres. |

## <a name="xml"></a>XML

Wiersze w tej tabeli opisują ulepszenia funkcji, które wcześniej miały ograniczenia lub inne problemy.

### <a name="schema-and-transforms"></a>Schemat i przekształcenia

Przestrzenie nazw: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; zestawy: System.Xml (w pliku System.Xml.dll), System.Xml.Linq (w pliku System.Xml.Linq.dll)

| Funkcja | Różnice od 3,5 SP1 |
| ------- | ------------------------ |
| **Schematy kameleona** | Aby zapobiec uszkodzeniu danych, schematy kameleona są teraz poprawnie klonowane, gdy są dołączone do wielu schematów.<br><br>Schematy kameleona są schematami, które nie mają docelowego obszaru nazw, a gdy są zawarte w innym XSD, przyjmują docelową przestrzeń nazw schematu importowania. Są one często używane do uwzględnienia typowych typów w schemacie. |
| **Funkcje identyfikatora** | [Funkcja identyfikatora](/sql/xquery/functions-on-sequences-id) XSLT zwraca teraz prawidłową wartość <xref:System.Xml.XmlReader> zamiast wartości null, gdy obiekt jest przekazywany do XLST.<br><br>Jeśli użytkownik utworzył <xref:System.Xml.XmlReader> obiekt z klasy LINQ do <xref:System.Xml.Linq.XNode.CreateReader%2A> XML przy <xref:System.Xml.XmlReader> użyciu metody, a ten obiekt został `id` przekazany do XSLT, wszystkie wystąpienia funkcji w XSLT wcześniej zwrócone null. Nie jest to dozwolona wartość `id` zwracana dla funkcji. |
| **Atrybut obszaru nazw** | Aby zapobiec uszkodzeniu <xref:System.Xml.XPath.XPathNavigator> danych, obiekt zwraca `x:xmlns` teraz poprawnie lokalną nazwę atrybutu. |
| **Deklaracje obszaru nazw** | Obiekt <xref:System.Xml.XmlReader> w poddrzewie nie tworzy już zduplikowanych deklaracji obszaru nazw w ramach jednego elementu XML. |
| **Sprawdzanie poprawności schematu** | Aby zapobiec błędnej weryfikacji schematu, <xref:System.Xml.Schema.XmlSchemaSet> klasa umożliwia XSD schematy mają być kompilowane poprawnie i konsekwentnie. Schematy te mogą zawierać inne schematy; na przykład, `A.xsd` `B.xsd`może zawierać `C.xsd`, które mogą zawierać . Kompilowanie jednego z tych powoduje, że ten wykres zależności, które mają być przesunięty. |
| **Funkcje skryptów** | [Funkcja dostępna dla funkcji](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms256124(v=vs.100)) nie `false` zwraca już niepoprawnie, gdy funkcja jest faktycznie dostępna. |
| **Identyfikatory URI** | Metoda <xref:System.Xml.Linq.XElement.Load%2A> zwraca teraz poprawny BaseURI w zapytaniach LINQ. |

### <a name="validation"></a>Sprawdzanie poprawności

Przestrzenie nazw: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; zestawy: System.Xml (w pliku System.Xml.dll), System.Xml.Linq (w pliku System.Xml.Linq.dll)

| Funkcja | Różnice od 3,5 SP1 |
| ------- | ------------------------ |
| **Program rozpoznawania nazw** | Metoda <xref:System.Xml.XmlReader.ReadContentAs%2A> nie ignoruje <xref:System.Xml.IXmlNamespaceResolver> już rozpoznawania nazw przekazanych do niego.<br><br>W poprzednich wersjach określony program rozpoznawania nazw został <xref:System.Xml.XmlReader> zignorowany, a zamiast tego został użyty. |
| **Odstępu** | Aby zapobiec utracie danych podczas tworzenia <xref:System.Xml.XmlReader.Create%2A> czytnika, metoda nie odrzuca już znacznych odstępów.<br><br>Sprawdzanie poprawności XML rozpoznaje tryb zawartości mieszanej, w którym tekst można mieszać z znacznikami XML. W trybie mieszanym wszystkie białe spościcie są znaczące i powinny być zgłaszane. |

### <a name="writing"></a>Pisania

Przestrzenie nazw: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; zestawy: System.Xml (w pliku System.Xml.dll), System.Xml.Linq (w pliku System.Xml.Linq.dll)

| Funkcja | Różnice od 3,5 SP1 |
| ------- | ------------------------ |
| **Odwołania do encji** | Aby zapobiec uszkodzeniu danych, odwołania do jednostek nie są już dwukrotnie powiązane w atrybutach XML.<br><br>Jeśli użytkownik próbował zapisać jednostki `xmlns` do atrybutu `xml:lang` `xml:space` lub do lub <xref:System.Xml.XmlWriter.WriteEntityRef%2A> atrybutu przy użyciu metody, jednostka została entityzed dwa razy w danych wyjściowych, w związku z tym uszkodzenia danych. |
| **Nowa obsługa linii** | Aby zapobiec uszkodzeniu danych, <xref:System.Xml.XmlWriter> obiekty są zgodne z <xref:System.Xml.NewLineHandling> opcją. |

## <a name="see-also"></a>Zobacz też

- [Nowe typy i elementy członkowskie w ramach .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff641764%28v=vs.100%29)
- [Przewodnik po migracji do programu .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff657133%28v=vs.100%29)
- [Co nowego w platformie .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms171868%28v=vs.100%29)
- [Zgodność wersji w programie .NET Framework](version-compatibility.md)
- [Migrowanie rozwiązań pakietu Office do programu .NET Framework 4](/visualstudio/vsto/migrating-office-solutions-to-the-dotnet-framework-4-or-later)
- [Przestarzałe elementy w bibliotece klas programu .NET Framework](../whats-new/whats-obsolete.md)
