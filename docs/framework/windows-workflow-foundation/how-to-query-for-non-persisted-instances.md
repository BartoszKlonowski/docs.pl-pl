---
title: 'Instrukcje: Zapytanie dotyczące wystąpień nietrwałych'
ms.date: 03/30/2017
ms.assetid: 294019b1-c1a7-4b81-a14f-b47c106cd723
ms.openlocfilehash: cbc3ec59bc0fbd8c39d351c248a664dc9231044c
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/28/2019
ms.locfileid: "64584944"
---
# <a name="how-to-query-for-non-persisted-instances"></a><span data-ttu-id="53eac-102">Instrukcje: Zapytanie dotyczące wystąpień nietrwałych</span><span class="sxs-lookup"><span data-stu-id="53eac-102">How to: Query for Non-persisted Instances</span></span>
<span data-ttu-id="53eac-103">Gdy tworzone jest nowe wystąpienie usługi, a usługa ma zachowanie Store wystąpienia przepływu pracy SQL zdefiniowane, host usługi tworzy wpis określający początkowej dla tego wystąpienia usługi w magazynie wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="53eac-103">When a new instance of a service is created and the service has the SQL Workflow Instance Store behavior defined, the service host creates a initial entry for that service instance in the instance store.</span></span> <span data-ttu-id="53eac-104">Później, gdy wystąpienie usługi będzie nadal występować po raz pierwszy, zachowanie Store wystąpienia przepływu pracy SQL przechowuje bieżące wystąpienie przechodzi w stan wraz z dodatkowych danych, która jest wymagana aktywacja, odzyskiwania i kontroli.</span><span class="sxs-lookup"><span data-stu-id="53eac-104">Subsequently when the service instance persists for the first time, the SQL Workflow Instance Store behavior stores the current instance state together with additional data that is required for activation, recovery, and control.</span></span>  
  
 <span data-ttu-id="53eac-105">Jeśli wystąpienie nie jest trwały, po utworzeniu początkowego wpis dla wystąpienia, wystąpienie usługi jest nazywany będzie w stanie nietrwałe.</span><span class="sxs-lookup"><span data-stu-id="53eac-105">If an instance is not persisted after the initial entry for the instance is created, the service instance is said to be in the non-persisted state.</span></span> <span data-ttu-id="53eac-106">Wszystkie wystąpienia usług utrwalonych można można tworzyć zapytania i kontrolowany.</span><span class="sxs-lookup"><span data-stu-id="53eac-106">All the persisted service instances can be queried and controlled.</span></span> <span data-ttu-id="53eac-107">Wystąpienia utrwalone spoza usługi nie można zapytań ani kontrolowany.</span><span class="sxs-lookup"><span data-stu-id="53eac-107">Non-persisted service instances can neither be queried nor controlled.</span></span> <span data-ttu-id="53eac-108">Jeśli wystąpienie programu nieutrwaloną zostanie wstrzymany z powodu nieobsługiwanego wyjątku może być badane ale nie jest kontrolowany.</span><span class="sxs-lookup"><span data-stu-id="53eac-108">If a non-persisted instance is suspended due to an unhandled exception it can be queried but not controlled.</span></span>  
  
 <span data-ttu-id="53eac-109">Wystąpień trwałych usług, które nie zostaną jeszcze utrwalone pozostają w stanie nieutrwaloną w następujących scenariuszach:</span><span class="sxs-lookup"><span data-stu-id="53eac-109">Durable service instances that are not yet persisted remain in a non-persisted state in the following scenarios:</span></span>  
  
- <span data-ttu-id="53eac-110">Host usługi ulegnie awarii, przed wystąpienie utrwalone po raz pierwszy.</span><span class="sxs-lookup"><span data-stu-id="53eac-110">The service host crashes before the instance persisted for the first time.</span></span> <span data-ttu-id="53eac-111">Początkowa wpis dla wystąpienia pozostaje w magazynie wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="53eac-111">The initial entry for the instance remains in the instance store.</span></span> <span data-ttu-id="53eac-112">Wystąpienie nie jest możliwe do odzyskania.</span><span class="sxs-lookup"><span data-stu-id="53eac-112">The instance is not recoverable.</span></span> <span data-ttu-id="53eac-113">Jeśli zostanie odebrana wiadomość skorelowane, wystąpienie stanie się aktywny ponownie.</span><span class="sxs-lookup"><span data-stu-id="53eac-113">If a correlated message arrives, the instance becomes active again.</span></span>  
  
- <span data-ttu-id="53eac-114">Wystąpienie środowisk nieobsługiwany wyjątek, zanim ją utrwalone po raz pierwszy.</span><span class="sxs-lookup"><span data-stu-id="53eac-114">The instance experiences an unhandled exception before it persisted for the first time.</span></span> <span data-ttu-id="53eac-115">Wystąpić w następujących scenariuszach</span><span class="sxs-lookup"><span data-stu-id="53eac-115">The following scenarios arise</span></span>  
  
    - <span data-ttu-id="53eac-116">Jeśli wartość **UnhandledExceptionAction** właściwość jest ustawiona na **Abandon**, informacje na temat wdrażania usługi są zapisywane do magazynu wystąpienia i wystąpienie jest usuwane z pamięci.</span><span class="sxs-lookup"><span data-stu-id="53eac-116">If the value of the **UnhandledExceptionAction** property is set to **Abandon**, the service deployment information is written to the instance store and the instance is unloaded from memory.</span></span> <span data-ttu-id="53eac-117">Wystąpienie pozostaje w nieutrwaloną stan w bazie danych trwałości.</span><span class="sxs-lookup"><span data-stu-id="53eac-117">The instance remains in non-persisted state in the persistence database.</span></span>  
  
    - <span data-ttu-id="53eac-118">Jeśli wartość **UnhandledExceptionAction** właściwość jest ustawiona na **AbandonAndSuspsend**, informacje na temat wdrażania usługi są zapisywane w bazie danych trwałości i stan wystąpienia jest równa  **Zawieszone**.</span><span class="sxs-lookup"><span data-stu-id="53eac-118">If the value of the **UnhandledExceptionAction** property is set to **AbandonAndSuspsend**, the service deployment information is written to the persistence database and the instance state is set to **Suspended**.</span></span> <span data-ttu-id="53eac-119">Wystąpienie nie może zostać wznowione, anulowania lub zakończenia.</span><span class="sxs-lookup"><span data-stu-id="53eac-119">The instance cannot be resumed, canceled, or terminated.</span></span> <span data-ttu-id="53eac-120">Host usługi nie można załadować wystąpienia, ponieważ wystąpienie nie zostało jeszcze utrwalone, a więc wpis w bazie danych dla tego wystąpienia nie zostało zakończone.</span><span class="sxs-lookup"><span data-stu-id="53eac-120">The service host cannot load the instance because the instance hasn't persisted yet and, hence the database entry for the instance is not complete.</span></span>  
  
    - <span data-ttu-id="53eac-121">Jeśli wartość **UnhandledExceptionAction** właściwość jest ustawiona na **anulować** lub **Zakończ**, informacje na temat wdrażania usługi są zapisywane do magazynu wystąpienia i stan wystąpienia jest równa **Ukończono**.</span><span class="sxs-lookup"><span data-stu-id="53eac-121">If the value of the **UnhandledExceptionAction** property is set to **Cancel** or **Terminate**, the service deployment information is written to the instance store and the instance state is set to **Completed**.</span></span>  
  
 <span data-ttu-id="53eac-122">Przykładowe zapytania, aby znaleźć wystąpień nietrwałych w bazie danych stanów trwałych programu SQL i usuń te wystąpienia z bazy danych można znaleźć w poniższych sekcjach.</span><span class="sxs-lookup"><span data-stu-id="53eac-122">The following sections provide sample queries to find non-persisted instances in the SQL persistence database and to delete these instances from the database.</span></span>  
  
## <a name="to-find-all-instances-not-persisted-yet"></a><span data-ttu-id="53eac-123">Aby znaleźć wszystkie wystąpienia nie jeszcze utrwalone</span><span class="sxs-lookup"><span data-stu-id="53eac-123">To find all instances not persisted yet</span></span>  
 <span data-ttu-id="53eac-124">Następujące zapytanie SQL zwraca identyfikator i tworzenia czasu dla wszystkich wystąpień, które nie są zachowywane w jeszcze do bazy danych trwałości.</span><span class="sxs-lookup"><span data-stu-id="53eac-124">The following SQL query returns the ID and creation time for all instances that are not persisted in to the persistence database yet.</span></span>  
  
```  
select InstanceId, CreationTime from [System.Activities.DurableInstancing].[Instances] where IsInitialized = 0;  
```  
  
## <a name="to-find-all-instances-not-persisted-yet-and-also-not-loaded"></a><span data-ttu-id="53eac-125">Aby znaleźć wszystkie wystąpienia nie jest jeszcze utrwalone i również nie załadowany</span><span class="sxs-lookup"><span data-stu-id="53eac-125">To find all instances not persisted yet and also not loaded</span></span>  
 <span data-ttu-id="53eac-126">Następujące zapytanie SQL zwraca identyfikator i tworzenia czasu dla wszystkich wystąpień, które nie są zachowywane i również nie są ładowane.</span><span class="sxs-lookup"><span data-stu-id="53eac-126">The following SQL query returns ID and creation time for all instances that are not persisted and also are not loaded.</span></span>  
  
```  
select InstanceId, CreationTime from [System.Activities.DurableInstancing].[Instances] where IsInitialized = 0 and CurrentMachine is NULL;  
```  
  
## <a name="to-find-all-suspended-instances-not-persisted-yet"></a><span data-ttu-id="53eac-127">Aby znaleźć wszystkie wstrzymane wystąpienia nie jeszcze utrwalone</span><span class="sxs-lookup"><span data-stu-id="53eac-127">To find all suspended instances not persisted yet</span></span>  
 <span data-ttu-id="53eac-128">Następujące zapytanie SQL zwraca identyfikator, czas utworzenia, powodem zawieszenia i zawieszenia nazwa wyjątku dla wszystkich wystąpień, które nie są zachowywane, a także w stanie wstrzymania.</span><span class="sxs-lookup"><span data-stu-id="53eac-128">The following SQL query returns ID, creation time, suspension reason, and suspension exception name for all instances that are not persisted and also in a suspended state.</span></span>  
  
```  
select InstanceId, CreationTime, SuspensionReason, SuspensionExceptionName from [System.Activities.DurableInstancing].[Instances] where IsInitialized = 0 and IsSuspended = 1;  
```  
  
## <a name="to-delete-non-persisted-instances-from-the-persistence-database"></a><span data-ttu-id="53eac-129">Można usunąć wystąpień nietrwałych z bazy danych stanów trwałych</span><span class="sxs-lookup"><span data-stu-id="53eac-129">To delete non-persisted instances from the persistence database</span></span>  
 <span data-ttu-id="53eac-130">Należy okresowo Sprawdź magazyn wystąpień do wystąpień nietrwałych i usuwania wystąpień z magazyn wystąpienia, jeśli masz pewności, czy wystąpienie nie zostanie wyświetlony komunikat z skorelowane.</span><span class="sxs-lookup"><span data-stu-id="53eac-130">You should periodically check the instance store for non-persisted instances and remove instances from the instance store if you are sure that the instance will not receive a correlated message.</span></span> <span data-ttu-id="53eac-131">Na przykład jeśli wystąpienie było w bazie danych przez kilka miesięcy, a wiadomo, że przepływ pracy ma zazwyczaj ważności przez kilka dni, będzie można bezpiecznie przyjąć założenie, że to wystąpienie niezainicjowanej, które miały wystąpiła awaria.</span><span class="sxs-lookup"><span data-stu-id="53eac-131">For example, if the instance has been in the database for several months and you know that the workflow typically has a lifetime of a few days, it would be safe to assume that this is an uninitialized instance that had crashed.</span></span>  
  
 <span data-ttu-id="53eac-132">Ogólnie rzecz biorąc jest bezpieczne usuwanie wystąpień nietrwałych, które nie jest wstrzymana lub nie załadowano.</span><span class="sxs-lookup"><span data-stu-id="53eac-132">In general, it is safe to delete non-persisted instances that are not suspended or not loaded.</span></span> <span data-ttu-id="53eac-133">Nie należy usuwać **wszystkich** wystąpień nietrwałych, ponieważ ten zestaw instancji zawiera wystąpienia, które są właśnie utworzony, ale nie są jeszcze utrwalone.</span><span class="sxs-lookup"><span data-stu-id="53eac-133">You should not delete **all** the non-persisted instances because this instance set includes instances that are just created but are not persisted yet.</span></span> <span data-ttu-id="53eac-134">Należy usunąć tylko wystąpień nietrwałych, które są pozostawione przez, ponieważ hosta usługi przepływu pracy, który miał załadować wystąpienia spowodowała wyjątek lub samego spowodowała wyjątek wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="53eac-134">You should only delete non-persisted instances that are left over because the workflow service host that had the instance loaded caused an exception or the instance itself caused an exception.</span></span>  
  
> [!WARNING]
>  <span data-ttu-id="53eac-135">Usuwanie wystąpień nietrwałych sklepie wystąpienia zmniejszenie rozmiaru magazynu i może zwiększyć wydajność operacji magazynu.</span><span class="sxs-lookup"><span data-stu-id="53eac-135">Deleting non-persisted instances from the instance store decreases the size of the store and may improve the performance of store operations.</span></span>
