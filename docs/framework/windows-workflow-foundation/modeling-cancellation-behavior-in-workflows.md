---
title: "Zachowanie anulowania modelowania w przepływach pracy"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: d48f6cf3-cdde-4dd3-8265-a665acf32a03
caps.latest.revision: "11"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 94a3cb69e2e897e992a05a19325630ca9bb1ae3a
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 12/22/2017
---
# <a name="modeling-cancellation-behavior-in-workflows"></a><span data-ttu-id="5587c-102">Zachowanie anulowania modelowania w przepływach pracy</span><span class="sxs-lookup"><span data-stu-id="5587c-102">Modeling Cancellation Behavior in Workflows</span></span>
<span data-ttu-id="5587c-103">Działania mogą zostać anulowane w przepływie pracy, na przykład przez <xref:System.Activities.Statements.Parallel> działania anulowanie niekompletne gałęzie po jego <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> daje w wyniku `true`, lub z poza przepływu pracy, jeśli host wywołuje <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span><span class="sxs-lookup"><span data-stu-id="5587c-103">Activities can be canceled inside a workflow, for example by a <xref:System.Activities.Statements.Parallel> activity canceling incomplete branches when its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> evaluates to `true`, or from outside the workflow, if the host calls <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span></span> <span data-ttu-id="5587c-104">Aby zapewnić anulowania obsługi, przepływ pracy autorzy mogą używać <xref:System.Activities.Statements.CancellationScope> działania, <xref:System.Activities.Statements.CompensableActivity> działania, lub tworzenia niestandardowych działań, które zapewniają logiki anulowania.</span><span class="sxs-lookup"><span data-stu-id="5587c-104">To provide cancellation handling, workflow authors can use the <xref:System.Activities.Statements.CancellationScope> activity, the <xref:System.Activities.Statements.CompensableActivity> activity, or create custom activities that provide cancellation logic.</span></span> <span data-ttu-id="5587c-105">Ten temat zawiera omówienie anulowania w przepływach pracy.</span><span class="sxs-lookup"><span data-stu-id="5587c-105">This topic provides an overview of cancellation in workflows.</span></span>  
  
## <a name="cancellation-compensation-and-transactions"></a><span data-ttu-id="5587c-106">Anulowanie, kompensacji i transakcji</span><span class="sxs-lookup"><span data-stu-id="5587c-106">Cancellation, Compensation, and Transactions</span></span>  
 <span data-ttu-id="5587c-107">Transakcje dać aplikacji możliwość do przerwania (wycofywania). wszystkie zmiany wykonane w obrębie transakcji, jeśli wystąpią błędy podczas dowolną część procesu transakcji.</span><span class="sxs-lookup"><span data-stu-id="5587c-107">Transactions give your application the ability to abort (roll back) all changes executed within the transaction if any errors occur during any part of the transaction process.</span></span> <span data-ttu-id="5587c-108">Jednak nie wszystkie pracy, który może być konieczne może być anulowana lub cofnąć jest odpowiednia dla transakcji, takie jak pracy długotrwałe lub pracy, który nie obejmuje zasoby transakcyjne.</span><span class="sxs-lookup"><span data-stu-id="5587c-108">However, not all work that may need to be canceled or undone is appropriate for transactions, such as long-running work or work that does not involve transactional resources.</span></span> <span data-ttu-id="5587c-109">Kompensacji udostępnia model cofanie poprzednio ukończoną nietransakcyjnej pracy w przypadku awarii kolejnych w przepływie pracy.</span><span class="sxs-lookup"><span data-stu-id="5587c-109">Compensation provides a model for undoing previously completed non-transactional work if there is a subsequent failure in the workflow.</span></span> <span data-ttu-id="5587c-110">Anulowanie udostępnia model dla przepływu pracy i autorom działania obsługi nietransakcyjnej pracy, które nie zostało zakończone.</span><span class="sxs-lookup"><span data-stu-id="5587c-110">Cancellation provides a model for workflow and activity authors to handle non-transactional work that was not completed.</span></span> <span data-ttu-id="5587c-111">Jeśli działanie nie zostało ukończone działania, anulowaniu jej logiki anulowania zostanie wywołany, jeśli jest dostępny.</span><span class="sxs-lookup"><span data-stu-id="5587c-111">If an activity has not completed its execution and it is canceled, its cancellation logic will be invoked if it is available.</span></span>  
  
> [!NOTE]
>  [!INCLUDE[crabout](../../../includes/crabout-md.md)]<span data-ttu-id="5587c-112">transakcje i kompensacji, zobacz [transakcji](../../../docs/framework/windows-workflow-foundation/workflow-transactions.md) i [kompensacji](../../../docs/framework/windows-workflow-foundation/compensation.md).</span><span class="sxs-lookup"><span data-stu-id="5587c-112"> transactions and compensation, see [Transactions](../../../docs/framework/windows-workflow-foundation/workflow-transactions.md) and [Compensation](../../../docs/framework/windows-workflow-foundation/compensation.md).</span></span>  
  
## <a name="using-cancellationscope"></a><span data-ttu-id="5587c-113">Przy użyciu CancellationScope</span><span class="sxs-lookup"><span data-stu-id="5587c-113">Using CancellationScope</span></span>  
 <span data-ttu-id="5587c-114"><xref:System.Activities.Statements.CancellationScope> Działanie ma dwie sekcje, które mogą zawierać działań podrzędnych: <xref:System.Activities.Statements.CancellationScope.Body%2A> i <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>.</span><span class="sxs-lookup"><span data-stu-id="5587c-114">The <xref:System.Activities.Statements.CancellationScope> activity has two sections that can contain child activities: <xref:System.Activities.Statements.CancellationScope.Body%2A> and <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>.</span></span> <span data-ttu-id="5587c-115"><xref:System.Activities.Statements.CancellationScope.Body%2A> Jest rozmieszczenia działania, które tworzą logiki działania, a <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> jest rozmieszczenia działań, które zapewniają logiki anulowania działania.</span><span class="sxs-lookup"><span data-stu-id="5587c-115">The <xref:System.Activities.Statements.CancellationScope.Body%2A> is where the activities that make up the logic of the activity are placed, and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> is where the activities that provide cancellation logic for the activity are placed.</span></span> <span data-ttu-id="5587c-116">Działania mogą zostać anulowane tylko wtedy, gdy nie zostało ukończone.</span><span class="sxs-lookup"><span data-stu-id="5587c-116">An activity can be canceled only if it has not completed.</span></span> <span data-ttu-id="5587c-117">W przypadku liczby <xref:System.Activities.Statements.CancellationScope> działania, ukończenia odwołuje się do zakończenia działania w <xref:System.Activities.Statements.CancellationScope.Body%2A>.</span><span class="sxs-lookup"><span data-stu-id="5587c-117">In the case of the <xref:System.Activities.Statements.CancellationScope> activity, completion refers to the completion of the activities in the <xref:System.Activities.Statements.CancellationScope.Body%2A>.</span></span> <span data-ttu-id="5587c-118">Jeśli żądanie anulowania zostało zaplanowane i działań w <xref:System.Activities.Statements.CancellationScope.Body%2A> nie zostały wykonane, a następnie <xref:System.Activities.Statements.CancellationScope> zostaną oznaczone jako <xref:System.Activities.ActivityInstanceState.Canceled> i <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> działań zostanie wykonane.</span><span class="sxs-lookup"><span data-stu-id="5587c-118">If a cancellation request is scheduled and the activities in the <xref:System.Activities.Statements.CancellationScope.Body%2A> have not completed, then the <xref:System.Activities.Statements.CancellationScope> will be marked as <xref:System.Activities.ActivityInstanceState.Canceled> and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> activities will be executed.</span></span>  
  
### <a name="canceling-a-workflow-from-the-host"></a><span data-ttu-id="5587c-119">Anulowanie przepływu pracy z hosta</span><span class="sxs-lookup"><span data-stu-id="5587c-119">Canceling a Workflow from the Host</span></span>  
 <span data-ttu-id="5587c-120">Hosta można anulować przepływu pracy, wywołując <xref:System.Activities.WorkflowApplication.Cancel%2A> metody <xref:System.Activities.WorkflowApplication> wystąpienia obsługującego przepływ pracy.</span><span class="sxs-lookup"><span data-stu-id="5587c-120">A host can cancel a workflow by calling the <xref:System.Activities.WorkflowApplication.Cancel%2A> method of the <xref:System.Activities.WorkflowApplication> instance that is hosting the workflow.</span></span> <span data-ttu-id="5587c-121">W poniższym przykładzie jest tworzony przepływu pracy mającej <xref:System.Activities.Statements.CancellationScope>.</span><span class="sxs-lookup"><span data-stu-id="5587c-121">In the following example a workflow is created that has a <xref:System.Activities.Statements.CancellationScope>.</span></span> <span data-ttu-id="5587c-122">Przepływ pracy jest wywoływany, a następnie nawiązuje połączenie przez hosta <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span><span class="sxs-lookup"><span data-stu-id="5587c-122">The workflow is invoked, and then the host makes a call to <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span></span> <span data-ttu-id="5587c-123">Główne wykonywania przepływu pracy jest zatrzymana, <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> z <xref:System.Activities.Statements.CancellationScope> jest wywoływany, a następnie kończy przepływu pracy ze stanem <xref:System.Activities.ActivityInstanceState.Canceled>.</span><span class="sxs-lookup"><span data-stu-id="5587c-123">The main execution of the workflow is stopped, the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of the <xref:System.Activities.Statements.CancellationScope> is invoked, and then the workflow completes with a status of <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#35](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#35)]  
  
 <span data-ttu-id="5587c-124">Po wywołaniu tego przepływu pracy następujące dane wyjściowe są wyświetlane w konsoli.</span><span class="sxs-lookup"><span data-stu-id="5587c-124">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="5587c-125">**Uruchamianie przepływu pracy.**</span><span class="sxs-lookup"><span data-stu-id="5587c-125">**Starting the workflow.**</span></span>  
<span data-ttu-id="5587c-126">**CancellationHandler wywołany.** </span><span class="sxs-lookup"><span data-stu-id="5587c-126">**CancellationHandler invoked.** </span></span>  
<span data-ttu-id="5587c-127">**Anulowane b30ebb30-df46-4d90-a211-e31c38d8db3c przepływu pracy.**</span><span class="sxs-lookup"><span data-stu-id="5587c-127">**Workflow b30ebb30-df46-4d90-a211-e31c38d8db3c Canceled.**</span></span>    
> [!NOTE]
>  <span data-ttu-id="5587c-128">Gdy <xref:System.Activities.Statements.CancellationScope> działania zostanie anulowane i <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> wywołany, jest odpowiedzialny za Autor przepływu pracy, aby określić, czy zapewnić logiki anulowania odpowiednie Anulowano anulowane działania przed jego postęp.</span><span class="sxs-lookup"><span data-stu-id="5587c-128">When a <xref:System.Activities.Statements.CancellationScope> activity is canceled and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> invoked, it is the responsibility of the workflow author to determine the progress that the canceled activity made before it was canceled in order to provide the appropriate cancellation logic.</span></span> <span data-ttu-id="5587c-129"><xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> Nie zawierają żadnych informacji o postępie anulowane działania.</span><span class="sxs-lookup"><span data-stu-id="5587c-129">The <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> does not provide any information about the progress of the canceled activity.</span></span>  
  
 <span data-ttu-id="5587c-130">Przepływ pracy również mogą zostać anulowane z hosta, jeśli wystąpił nieobsługiwany wyjątek propaguje zapasowej późniejsza pierwiastek przepływu pracy i <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> obsługi zwraca <xref:System.Activities.UnhandledExceptionAction.Cancel>.</span><span class="sxs-lookup"><span data-stu-id="5587c-130">A workflow can also be canceled from the host if an unhandled exception bubbles up past the root of the workflow and the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler returns <xref:System.Activities.UnhandledExceptionAction.Cancel>.</span></span> <span data-ttu-id="5587c-131">W tym przykładzie rozpoczyna się przepływu pracy, a następnie generuje <xref:System.ApplicationException>.</span><span class="sxs-lookup"><span data-stu-id="5587c-131">In this example the workflow starts and then throws an <xref:System.ApplicationException>.</span></span> <span data-ttu-id="5587c-132">Ten wyjątek jest nieobsługiwany przez przepływ pracy i dlatego element <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> obsługi jest wywoływany.</span><span class="sxs-lookup"><span data-stu-id="5587c-132">This exception is unhandled by the workflow and so the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler is invoked.</span></span> <span data-ttu-id="5587c-133">Program obsługi nakazuje środowiska uruchomieniowego przepływu pracy, Anuluj i <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> aktualnie wykonywanych <xref:System.Activities.Statements.CancellationScope> działania jest wywoływany.</span><span class="sxs-lookup"><span data-stu-id="5587c-133">The handler instructs the runtime to cancel the workflow, and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of the currently executing <xref:System.Activities.Statements.CancellationScope> activity is invoked.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#36](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#36)]  
  
 <span data-ttu-id="5587c-134">Po wywołaniu tego przepływu pracy następujące dane wyjściowe są wyświetlane w konsoli.</span><span class="sxs-lookup"><span data-stu-id="5587c-134">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="5587c-135">**Uruchamianie przepływu pracy.**</span><span class="sxs-lookup"><span data-stu-id="5587c-135">**Starting the workflow.**</span></span>  
<span data-ttu-id="5587c-136">**OnUnhandledException w 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9 przepływu pracy** </span><span class="sxs-lookup"><span data-stu-id="5587c-136">**OnUnhandledException in Workflow 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9** </span></span>  
<span data-ttu-id="5587c-137">**ApplicationException został zgłoszony.** </span><span class="sxs-lookup"><span data-stu-id="5587c-137">**An ApplicationException was thrown.** </span></span>  
<span data-ttu-id="5587c-138">**CancellationHandler wywołany.** </span><span class="sxs-lookup"><span data-stu-id="5587c-138">**CancellationHandler invoked.** </span></span>  
<span data-ttu-id="5587c-139">**Anulowane 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9 przepływu pracy.**</span><span class="sxs-lookup"><span data-stu-id="5587c-139">**Workflow 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9 Canceled.**</span></span>    
### <a name="canceling-an-activity-from-inside-a-workflow"></a><span data-ttu-id="5587c-140">Anulowanie działania z wewnątrz przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="5587c-140">Canceling an Activity from Inside a Workflow</span></span>  
 <span data-ttu-id="5587c-141">Działanie również mogą zostać anulowane przez jego elementu nadrzędnego.</span><span class="sxs-lookup"><span data-stu-id="5587c-141">An activity can also be canceled by its parent.</span></span> <span data-ttu-id="5587c-142">Na przykład jeśli <xref:System.Activities.Statements.Parallel> działanie ma kilka gałęzi wykonywania i jego <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> daje w wyniku `true` , a następnie jego niekompletne oddziałów zostanie anulowane.</span><span class="sxs-lookup"><span data-stu-id="5587c-142">For example, if a <xref:System.Activities.Statements.Parallel> activity has multiple executing branches and its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> evaluates to `true` then its incomplete branches will be canceled.</span></span> <span data-ttu-id="5587c-143">W tym przykładzie <xref:System.Activities.Statements.Parallel> utworzeniu działania, która ma dwa oddziały.</span><span class="sxs-lookup"><span data-stu-id="5587c-143">In this example a <xref:System.Activities.Statements.Parallel> activity is created that has two branches.</span></span> <span data-ttu-id="5587c-144">Jego <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> ustawiono `true` więc <xref:System.Activities.Statements.Parallel> zakończeniu zaraz po zakończeniu jednego z jego oddziałów.</span><span class="sxs-lookup"><span data-stu-id="5587c-144">Its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> is set to `true` so the <xref:System.Activities.Statements.Parallel> completes as soon as any one of its branches is completed.</span></span> <span data-ttu-id="5587c-145">W tym przykładzie kończy gałęzi 2, a więc gałęzi 1 zostało anulowane.</span><span class="sxs-lookup"><span data-stu-id="5587c-145">In this example branch 2 completes, and so branch 1 is canceled.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#37](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#37)]  
  
 <span data-ttu-id="5587c-146">Po wywołaniu tego przepływu pracy następujące dane wyjściowe są wyświetlane w konsoli.</span><span class="sxs-lookup"><span data-stu-id="5587c-146">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="5587c-147">**Rozgałęzienie uruchamianie 1.**</span><span class="sxs-lookup"><span data-stu-id="5587c-147">**Branch 1 starting.**</span></span>  
<span data-ttu-id="5587c-148">**Rozgałęzienie 2 ukończone.** </span><span class="sxs-lookup"><span data-stu-id="5587c-148">**Branch 2 complete.** </span></span>  
<span data-ttu-id="5587c-149">**Rozgałęzienie 1 anulowane.** </span><span class="sxs-lookup"><span data-stu-id="5587c-149">**Branch 1 canceled.** </span></span>  
<span data-ttu-id="5587c-150">**Ukończono e0685e24-18ef-4a47-acf3-5c638732f3be przepływu pracy.**</span><span class="sxs-lookup"><span data-stu-id="5587c-150">**Workflow e0685e24-18ef-4a47-acf3-5c638732f3be Completed.**</span></span>  <span data-ttu-id="5587c-151">Jeśli wyjątek propaguje zapasowej późniejsza pierwiastek działania, ale odbywa się na wyższym poziomie w przepływie pracy, również zostaną anulowane działania.</span><span class="sxs-lookup"><span data-stu-id="5587c-151">Activities are also canceled if an exception bubbles up past the root of the activity but is handled at a higher level in the workflow.</span></span> <span data-ttu-id="5587c-152">W tym przykładzie logiki główny przepływ pracy składa się z <xref:System.Activities.Statements.Sequence> działania.</span><span class="sxs-lookup"><span data-stu-id="5587c-152">In this example, the main logic of the workflow consists of a <xref:System.Activities.Statements.Sequence> activity.</span></span> <span data-ttu-id="5587c-153"><xref:System.Activities.Statements.Sequence> Jest określony jako <xref:System.Activities.Statements.CancellationScope.Body%2A> z <xref:System.Activities.Statements.CancellationScope> działania, który jest zawarty w <xref:System.Activities.Statements.TryCatch> działania.</span><span class="sxs-lookup"><span data-stu-id="5587c-153">The <xref:System.Activities.Statements.Sequence> is specified as the <xref:System.Activities.Statements.CancellationScope.Body%2A> of a <xref:System.Activities.Statements.CancellationScope> activity which is contained by a <xref:System.Activities.Statements.TryCatch> activity.</span></span> <span data-ttu-id="5587c-154">Wyjątek z treści <xref:System.Activities.Statements.Sequence>, jest obsługiwane przez element nadrzędny <xref:System.Activities.Statements.TryCatch> działania i <xref:System.Activities.Statements.Sequence> zostało anulowane.</span><span class="sxs-lookup"><span data-stu-id="5587c-154">An exception is thrown from the body of the <xref:System.Activities.Statements.Sequence>, is handled by the parent <xref:System.Activities.Statements.TryCatch> activity, and the <xref:System.Activities.Statements.Sequence> is canceled.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#39](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#39)]  
  
 <span data-ttu-id="5587c-155">Po wywołaniu tego przepływu pracy następujące dane wyjściowe są wyświetlane w konsoli.</span><span class="sxs-lookup"><span data-stu-id="5587c-155">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="5587c-156">**Sekwencja uruchamiania.**</span><span class="sxs-lookup"><span data-stu-id="5587c-156">**Sequence starting.**</span></span>  
<span data-ttu-id="5587c-157">**Sekwencja anulowane.** </span><span class="sxs-lookup"><span data-stu-id="5587c-157">**Sequence canceled.** </span></span>  
<span data-ttu-id="5587c-158">**Wystąpił wyjątek.** </span><span class="sxs-lookup"><span data-stu-id="5587c-158">**Exception caught.** </span></span>  
<span data-ttu-id="5587c-159">**Ukończono e3c18939-121e-4c43-af1c-ba1ce977ce55 przepływu pracy.**</span><span class="sxs-lookup"><span data-stu-id="5587c-159">**Workflow e3c18939-121e-4c43-af1c-ba1ce977ce55 Completed.**</span></span>   
### <a name="throwing-exceptions-from-a-cancellationhandler"></a><span data-ttu-id="5587c-160">Zgłaszanie wyjątków z CancellationHandler</span><span class="sxs-lookup"><span data-stu-id="5587c-160">Throwing Exceptions from a CancellationHandler</span></span>  
 <span data-ttu-id="5587c-161">Wszelkie wyjątki zgłaszane z <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> z <xref:System.Activities.Statements.CancellationScope> są krytyczny w przepływie pracy.</span><span class="sxs-lookup"><span data-stu-id="5587c-161">Any exceptions thrown from the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of a <xref:System.Activities.Statements.CancellationScope> are fatal to the workflow.</span></span> <span data-ttu-id="5587c-162">Jeśli istnieje możliwość anulowania z wyjątków <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>, użyj <xref:System.Activities.Statements.TryCatch> w <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> zdołały wychwycić i obsłużyć te wyjątki.</span><span class="sxs-lookup"><span data-stu-id="5587c-162">If there is a possibility of exceptions escaping from a <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>, use a <xref:System.Activities.Statements.TryCatch> in the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> to catch and handle these exceptions.</span></span>  
  
### <a name="cancellation-using-compensableactivity"></a><span data-ttu-id="5587c-163">Za pomocą działania CompensableActivity anulowania</span><span class="sxs-lookup"><span data-stu-id="5587c-163">Cancellation using CompensableActivity</span></span>  
 <span data-ttu-id="5587c-164">Podobnie jak <xref:System.Activities.Statements.CancellationScope> działania, <xref:System.Activities.Statements.CompensableActivity> ma <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A>.</span><span class="sxs-lookup"><span data-stu-id="5587c-164">Like the <xref:System.Activities.Statements.CancellationScope> activity, the <xref:System.Activities.Statements.CompensableActivity> has a <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A>.</span></span> <span data-ttu-id="5587c-165">Jeśli <xref:System.Activities.Statements.CompensableActivity> zostaną anulowane wszystkie działania w jego <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> są wywoływane.</span><span class="sxs-lookup"><span data-stu-id="5587c-165">If a <xref:System.Activities.Statements.CompensableActivity> is canceled, any activities in its <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> are invoked.</span></span> <span data-ttu-id="5587c-166">Może to być przydatne w przypadku cofanie częściowo ukończona Praca compensable.</span><span class="sxs-lookup"><span data-stu-id="5587c-166">This can be useful for undoing partially completed compensable work.</span></span> <span data-ttu-id="5587c-167">Aby uzyskać informacje o sposobie używania <xref:System.Activities.Statements.CompensableActivity> kompensacji i anulowania, zobacz [kompensacji](../../../docs/framework/windows-workflow-foundation/compensation.md).</span><span class="sxs-lookup"><span data-stu-id="5587c-167">For information about how to use <xref:System.Activities.Statements.CompensableActivity> for compensation and cancellation, see [Compensation](../../../docs/framework/windows-workflow-foundation/compensation.md).</span></span>  
  
## <a name="cancellation-using-custom-activities"></a><span data-ttu-id="5587c-168">Anulowanie przy użyciu działań niestandardowych</span><span class="sxs-lookup"><span data-stu-id="5587c-168">Cancellation using Custom Activities</span></span>  
 <span data-ttu-id="5587c-169">Autorzy działania niestandardowego można zaimplementować logiki anulowania ich niestandardowe działania programu na kilka różnych sposobów.</span><span class="sxs-lookup"><span data-stu-id="5587c-169">Custom activity authors can implement cancellation logic into their custom activities in several different ways.</span></span> <span data-ttu-id="5587c-170">Działania niestandardowe, które pochodzą z <xref:System.Activities.Activity> można zaimplementować logiki anulowania przez umieszczenie <xref:System.Activities.Statements.CancellationScope> lub innych działań niestandardowych, zawierający logiki anulowania w treści działania.</span><span class="sxs-lookup"><span data-stu-id="5587c-170">Custom activities that derive from <xref:System.Activities.Activity> can implement cancellation logic by placing a <xref:System.Activities.Statements.CancellationScope> or other custom activity that contains cancellation logic in the body of the activity.</span></span> <span data-ttu-id="5587c-171"><xref:System.Activities.AsyncCodeActivity>i <xref:System.Activities.NativeActivity> pochodzące od działania można zmienić ich odpowiednich <xref:System.Activities.NativeActivity.Cancel%2A> — metoda i podaj logiki anulowania.</span><span class="sxs-lookup"><span data-stu-id="5587c-171"><xref:System.Activities.AsyncCodeActivity> and <xref:System.Activities.NativeActivity> derived activities can override their respective <xref:System.Activities.NativeActivity.Cancel%2A> method and provide cancellation logic there.</span></span> <span data-ttu-id="5587c-172"><xref:System.Activities.CodeActivity>pochodzące od działania nie udostępniają udostępniania żadnego anulowania ich pracy jest wykonywana w pojedynczej serii wykonywania, gdy środowisko urchomieniowe wywołuje <xref:System.Activities.CodeActivity.Execute%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="5587c-172"><xref:System.Activities.CodeActivity> derived activities do not provide any provision for cancellation because all their work is performed in a single burst of execution when the runtime calls the <xref:System.Activities.CodeActivity.Execute%2A> method.</span></span> <span data-ttu-id="5587c-173">Jeśli nie ma jeszcze wywoływać metody execute oraz <xref:System.Activities.CodeActivity> oparte na działanie zostało anulowane, zamyka działanie ze stanem <xref:System.Activities.ActivityInstanceState.Canceled> i <xref:System.Activities.CodeActivity.Execute%2A> nie jest wywoływana metoda.</span><span class="sxs-lookup"><span data-stu-id="5587c-173">If the execute method has not yet been called and a <xref:System.Activities.CodeActivity> based activity is canceled, the activity closes with a status of <xref:System.Activities.ActivityInstanceState.Canceled> and the <xref:System.Activities.CodeActivity.Execute%2A> method is not called.</span></span>  
  
### <a name="cancellation-using-nativeactivity"></a><span data-ttu-id="5587c-174">Za pomocą działania NativeActivity anulowania</span><span class="sxs-lookup"><span data-stu-id="5587c-174">Cancellation using NativeActivity</span></span>  
 <span data-ttu-id="5587c-175"><xref:System.Activities.NativeActivity>można zastąpić pochodzące od działania <xref:System.Activities.NativeActivity.Cancel%2A> metodę w celu zapewnienia logiki anulowania niestandardowych.</span><span class="sxs-lookup"><span data-stu-id="5587c-175"><xref:System.Activities.NativeActivity> derived activities can override the <xref:System.Activities.NativeActivity.Cancel%2A> method to provide custom cancellation logic.</span></span> <span data-ttu-id="5587c-176">Jeśli ta metoda nie jest zastępowany, domyślna logika anulowania przepływu pracy została zastosowana.</span><span class="sxs-lookup"><span data-stu-id="5587c-176">If this method is not overridden, then the default workflow cancellation logic is applied.</span></span> <span data-ttu-id="5587c-177">Anulowanie domyślny jest proces wykonywany dla <xref:System.Activities.NativeActivity> nie powoduje zastąpienia <xref:System.Activities.NativeActivity.Cancel%2A> metody lub których <xref:System.Activities.NativeActivity.Cancel%2A> metoda wywołuje podstawowym <xref:System.Activities.NativeActivity> <xref:System.Activities.NativeActivity.Cancel%2A> — metoda.</span><span class="sxs-lookup"><span data-stu-id="5587c-177">Default cancellation is the process that occurs for a <xref:System.Activities.NativeActivity> that does not override the <xref:System.Activities.NativeActivity.Cancel%2A> method or whose <xref:System.Activities.NativeActivity.Cancel%2A> method calls the base <xref:System.Activities.NativeActivity> <xref:System.Activities.NativeActivity.Cancel%2A> method.</span></span> <span data-ttu-id="5587c-178">Po anulowaniu działania środowiska uruchomieniowego flagi działania dotyczące anulowania i automatycznie obsługuje niektórych oczyszczania.</span><span class="sxs-lookup"><span data-stu-id="5587c-178">When an activity is canceled, the runtime flags the activity for cancellation and automatically handles certain cleanup.</span></span> <span data-ttu-id="5587c-179">Jeśli działanie ma tylko zakładki oczekujące, zakładki zostaną usunięte i działania zostaną oznaczone jako <xref:System.Activities.ActivityInstanceState.Canceled>.</span><span class="sxs-lookup"><span data-stu-id="5587c-179">If the activity only has outstanding bookmarks, the bookmarks will be removed and the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="5587c-180">Wszystkie działania podrzędne oczekujących anulowane działania z kolei zostaną anulowane.</span><span class="sxs-lookup"><span data-stu-id="5587c-180">Any outstanding child activities of the canceled activity will in turn be canceled.</span></span> <span data-ttu-id="5587c-181">Każda próba planować działań podrzędnych dodatkowe spowoduje próbę są ignorowane i działania zostaną oznaczone jako <xref:System.Activities.ActivityInstanceState.Canceled>.</span><span class="sxs-lookup"><span data-stu-id="5587c-181">Any attempt to schedule additional child activities will result in the attempt being ignored and the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="5587c-182">Po zakończeniu działania żadnych oczekujących podrzędnego w <xref:System.Activities.ActivityInstanceState.Canceled> lub <xref:System.Activities.ActivityInstanceState.Faulted> stanu, a następnie działania zostaną oznaczone jako <xref:System.Activities.ActivityInstanceState.Canceled>.</span><span class="sxs-lookup"><span data-stu-id="5587c-182">If any outstanding child activity completes in the <xref:System.Activities.ActivityInstanceState.Canceled> or <xref:System.Activities.ActivityInstanceState.Faulted> state, then the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="5587c-183">Należy pamiętać, że żądanie anulowania można zignorować.</span><span class="sxs-lookup"><span data-stu-id="5587c-183">Note that a cancellation request can be ignored.</span></span> <span data-ttu-id="5587c-184">Jeśli działanie nie ma żadnych oczekujących zakładki lub wykonywania działań podrzędnych i nie zaplanować dowolne elementy pracy dodatkowe po oznaczona flagą anulowania, zostanie wykonane pomyślnie.</span><span class="sxs-lookup"><span data-stu-id="5587c-184">If an activity does not have any outstanding bookmarks or executing child activities and does not schedule any additional work items after being flagged for cancellation, it will complete successfully.</span></span> <span data-ttu-id="5587c-185">Anulowanie to domyślne sufiksy w różnych scenariuszach, ale w razie potrzeby logiki anulowania dodatkowe następnie działania anulowania wbudowanych lub niestandardowych działań może być używany.</span><span class="sxs-lookup"><span data-stu-id="5587c-185">This default cancellation suffices for many scenarios, but if additional cancellation logic is needed, then the built-in cancellation activities or custom activities can be used.</span></span>  
  
 <span data-ttu-id="5587c-186">W poniższym przykładzie <xref:System.Activities.NativeActivity.Cancel%2A> zastąpienie <xref:System.Activities.NativeActivity> na podstawie niestandardowych `ParallelForEach` zdefiniowano działania.</span><span class="sxs-lookup"><span data-stu-id="5587c-186">In the following example, the <xref:System.Activities.NativeActivity.Cancel%2A> override of a <xref:System.Activities.NativeActivity> based custom `ParallelForEach` activity is defined.</span></span> <span data-ttu-id="5587c-187">Gdy działanie zostało anulowane, to zastąpienie obsługuje logiki anulowania działania.</span><span class="sxs-lookup"><span data-stu-id="5587c-187">When the activity is canceled, this override handles the cancellation logic for the activity.</span></span> <span data-ttu-id="5587c-188">Ten przykład jest częścią [inne niż ogólne działania ParallelForEach](../../../docs/framework/windows-workflow-foundation/samples/non-generic-parallelforeach.md) próbki.</span><span class="sxs-lookup"><span data-stu-id="5587c-188">This example is part of the [Non-Generic ParallelForEach](../../../docs/framework/windows-workflow-foundation/samples/non-generic-parallelforeach.md) sample.</span></span>  
  
```csharp  
protected override void Cancel(NativeActivityContext context)  
{  
    // If we do not have a completion condition then we can just  
    // use default logic.  
    if (this.CompletionCondition == null)  
    {  
        base.Cancel(context);  
    }  
    else  
    {  
        context.CancelChildren();  
    }  
}  
```  
  
 <span data-ttu-id="5587c-189"><xref:System.Activities.NativeActivity>pochodzące od działania można określić, czy zażądano anulowania, sprawdzając <xref:System.Activities.NativeActivityContext.IsCancellationRequested%2A> właściwości oraz się zostać oznaczone jako anulowane przez wywołanie metody <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> — metoda.</span><span class="sxs-lookup"><span data-stu-id="5587c-189"><xref:System.Activities.NativeActivity> derived activities can determine if cancellation has been requested by inspecting the <xref:System.Activities.NativeActivityContext.IsCancellationRequested%2A> property, and mark themselves as canceled by calling the <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> method.</span></span> <span data-ttu-id="5587c-190">Wywoływanie <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> nie zostanie od razu zakończone działania.</span><span class="sxs-lookup"><span data-stu-id="5587c-190">Calling <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> does not immediately complete the activity.</span></span> <span data-ttu-id="5587c-191">W zwykły sposób, środowisko wykonawcze będzie kończyć działanie, jeśli nie ma już zaległe pracy, ale jeśli <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> jest nazywany ostatni stan zostanie <xref:System.Activities.ActivityInstanceState.Canceled> zamiast <xref:System.Activities.ActivityInstanceState.Closed>.</span><span class="sxs-lookup"><span data-stu-id="5587c-191">As usual, the runtime will complete the activity when it has no more outstanding work, but if <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> is called the final state will be <xref:System.Activities.ActivityInstanceState.Canceled> instead of <xref:System.Activities.ActivityInstanceState.Closed>.</span></span>  
  
### <a name="cancellation-using-asynccodeactivity"></a><span data-ttu-id="5587c-192">Przy użyciu AsyncCodeActivity anulowania</span><span class="sxs-lookup"><span data-stu-id="5587c-192">Cancellation using AsyncCodeActivity</span></span>  
 <span data-ttu-id="5587c-193"><xref:System.Activities.AsyncCodeActivity>na podstawie działań można też podać logiki anulowania niestandardowych przez zastąpienie <xref:System.Activities.AsyncCodeActivity.Cancel%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="5587c-193"><xref:System.Activities.AsyncCodeActivity> based activities can also provide custom cancellation logic by overriding the <xref:System.Activities.AsyncCodeActivity.Cancel%2A> method.</span></span> <span data-ttu-id="5587c-194">Jeśli ta metoda nie jest zastępowany, nie obsługi anulowania jest wykonywana, jeśli działanie zostało anulowane.</span><span class="sxs-lookup"><span data-stu-id="5587c-194">If this method is not overridden, then no cancellation handling is performed if the activity is canceled.</span></span> <span data-ttu-id="5587c-195">W poniższym przykładzie <xref:System.Activities.AsyncCodeActivity.Cancel%2A> zastąpienie <xref:System.Activities.AsyncCodeActivity> na podstawie niestandardowych `ExecutePowerShell` zdefiniowano działania.</span><span class="sxs-lookup"><span data-stu-id="5587c-195">In the following example, the <xref:System.Activities.AsyncCodeActivity.Cancel%2A> override of an <xref:System.Activities.AsyncCodeActivity> based custom `ExecutePowerShell` activity is defined.</span></span> <span data-ttu-id="5587c-196">Gdy działanie zostało anulowane, wykonuje zachowanie żądaną anulowania.</span><span class="sxs-lookup"><span data-stu-id="5587c-196">When the activity is canceled, it performs the desired cancellation behavior.</span></span> <span data-ttu-id="5587c-197">Ten przykład jest częścią [za pomocą działania InvokePowerShell](../../../docs/framework/windows-workflow-foundation/samples/using-the-invokepowershell-activity.md) próbki.</span><span class="sxs-lookup"><span data-stu-id="5587c-197">This example is part of the [Using the InvokePowerShell Activity](../../../docs/framework/windows-workflow-foundation/samples/using-the-invokepowershell-activity.md) sample.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#1020](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#1020)]  
  
 <span data-ttu-id="5587c-198"><xref:System.Activities.AsyncCodeActivity>pochodzące od działania można określić, czy zażądano anulowania, sprawdzając <xref:System.Activities.AsyncCodeActivityContext.IsCancellationRequested%2A> właściwości oraz się zostać oznaczone jako anulowane przez wywołanie metody <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A> — metoda.</span><span class="sxs-lookup"><span data-stu-id="5587c-198"><xref:System.Activities.AsyncCodeActivity> derived activities can determine if cancellation has been requested by inspecting the <xref:System.Activities.AsyncCodeActivityContext.IsCancellationRequested%2A> property, and mark themselves as canceled by calling the <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A> method.</span></span>
