---
title: Zachowanie anulowania modelowania w przepływach pracy
ms.date: 03/30/2017
ms.assetid: d48f6cf3-cdde-4dd3-8265-a665acf32a03
ms.openlocfilehash: 157bff0d24b00f293fd551dd52fe693d36dfad61
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/26/2020
ms.locfileid: "96242061"
---
# <a name="modeling-cancellation-behavior-in-workflows"></a><span data-ttu-id="411f4-102">Zachowanie anulowania modelowania w przepływach pracy</span><span class="sxs-lookup"><span data-stu-id="411f4-102">Modeling Cancellation Behavior in Workflows</span></span>

<span data-ttu-id="411f4-103">Działania mogą być anulowane w przepływie pracy, na przykład przez <xref:System.Activities.Statements.Parallel> działanie anulowania niekompletnych gałęzi <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> , gdy jego wynikiem jest wartość `true` lub spoza przepływu pracy, jeśli jest on wywoływany przez hosta <xref:System.Activities.WorkflowApplication.Cancel%2A> .</span><span class="sxs-lookup"><span data-stu-id="411f4-103">Activities can be canceled inside a workflow, for example by a <xref:System.Activities.Statements.Parallel> activity canceling incomplete branches when its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> evaluates to `true`, or from outside the workflow, if the host calls <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span></span> <span data-ttu-id="411f4-104">Aby zapewnić obsługę anulowania, autorzy przepływu pracy mogą korzystać z <xref:System.Activities.Statements.CancellationScope> działania, <xref:System.Activities.Statements.CompensableActivity> działania lub tworzyć niestandardowe działania, które udostępniają logikę anulowania.</span><span class="sxs-lookup"><span data-stu-id="411f4-104">To provide cancellation handling, workflow authors can use the <xref:System.Activities.Statements.CancellationScope> activity, the <xref:System.Activities.Statements.CompensableActivity> activity, or create custom activities that provide cancellation logic.</span></span> <span data-ttu-id="411f4-105">Ten temat zawiera omówienie anulowania w przepływach pracy.</span><span class="sxs-lookup"><span data-stu-id="411f4-105">This topic provides an overview of cancellation in workflows.</span></span>  
  
## <a name="cancellation-compensation-and-transactions"></a><span data-ttu-id="411f4-106">Anulowanie, kompensacja i transakcje</span><span class="sxs-lookup"><span data-stu-id="411f4-106">Cancellation, Compensation, and Transactions</span></span>  

 <span data-ttu-id="411f4-107">Transakcje umożliwiają aplikacji przerwanie (wycofywanie) wszystkich zmian wykonywanych w ramach transakcji w przypadku wystąpienia błędów występujących w ramach procesu transakcji.</span><span class="sxs-lookup"><span data-stu-id="411f4-107">Transactions give your application the ability to abort (roll back) all changes executed within the transaction if any errors occur during any part of the transaction process.</span></span> <span data-ttu-id="411f4-108">Jednak nie wszystkie zadania, które mogą wymagać anulowania lub cofania, są odpowiednie dla transakcji, takich jak długotrwałe działanie lub pracy, które nie obejmują zasobów transakcyjnych.</span><span class="sxs-lookup"><span data-stu-id="411f4-108">However, not all work that may need to be canceled or undone is appropriate for transactions, such as long-running work or work that does not involve transactional resources.</span></span> <span data-ttu-id="411f4-109">Kompensacja zapewnia model wycofywania ukończonych wcześniej zadań nietransakcyjnych, jeśli wystąpi kolejny błąd w przepływie pracy.</span><span class="sxs-lookup"><span data-stu-id="411f4-109">Compensation provides a model for undoing previously completed non-transactional work if there is a subsequent failure in the workflow.</span></span> <span data-ttu-id="411f4-110">Anulowanie zapewnia model przepływu pracy i autorów działań do obsługi nietransakcyjnej pracy, która nie została ukończona.</span><span class="sxs-lookup"><span data-stu-id="411f4-110">Cancellation provides a model for workflow and activity authors to handle non-transactional work that was not completed.</span></span> <span data-ttu-id="411f4-111">Jeśli działanie nie zakończyło wykonywania i zostało anulowane, jego logika anulowania zostanie wywołana, jeśli jest dostępna.</span><span class="sxs-lookup"><span data-stu-id="411f4-111">If an activity has not completed its execution and it is canceled, its cancellation logic will be invoked if it is available.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="411f4-112">Aby uzyskać więcej informacji na temat transakcji i kompensacji, zobacz [transakcje](workflow-transactions.md) i [kompensacja](compensation.md).</span><span class="sxs-lookup"><span data-stu-id="411f4-112">For more information about transactions and compensation, see [Transactions](workflow-transactions.md) and [Compensation](compensation.md).</span></span>  
  
## <a name="using-cancellationscope"></a><span data-ttu-id="411f4-113">Używanie działania CancellationScope</span><span class="sxs-lookup"><span data-stu-id="411f4-113">Using CancellationScope</span></span>  

 <span data-ttu-id="411f4-114"><xref:System.Activities.Statements.CancellationScope>Działanie ma dwie sekcje, które mogą zawierać działania podrzędne: <xref:System.Activities.Statements.CancellationScope.Body%2A> i <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> .</span><span class="sxs-lookup"><span data-stu-id="411f4-114">The <xref:System.Activities.Statements.CancellationScope> activity has two sections that can contain child activities: <xref:System.Activities.Statements.CancellationScope.Body%2A> and <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>.</span></span> <span data-ttu-id="411f4-115"><xref:System.Activities.Statements.CancellationScope.Body%2A>Jest to miejsce, w którym są umieszczane działania wchodzące w skład logiki działania, a <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> to miejsce, w którym są umieszczane działania, które zapewniają logikę anulowania działania.</span><span class="sxs-lookup"><span data-stu-id="411f4-115">The <xref:System.Activities.Statements.CancellationScope.Body%2A> is where the activities that make up the logic of the activity are placed, and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> is where the activities that provide cancellation logic for the activity are placed.</span></span> <span data-ttu-id="411f4-116">Działanie można anulować tylko wtedy, gdy nie zostało ukończone.</span><span class="sxs-lookup"><span data-stu-id="411f4-116">An activity can be canceled only if it has not completed.</span></span> <span data-ttu-id="411f4-117">W przypadku <xref:System.Activities.Statements.CancellationScope> działania, uzupełnianie odnosi się do ukończenia działań w <xref:System.Activities.Statements.CancellationScope.Body%2A> .</span><span class="sxs-lookup"><span data-stu-id="411f4-117">In the case of the <xref:System.Activities.Statements.CancellationScope> activity, completion refers to the completion of the activities in the <xref:System.Activities.Statements.CancellationScope.Body%2A>.</span></span> <span data-ttu-id="411f4-118">Jeśli zaplanowano żądanie anulowania, a działania w <xref:System.Activities.Statements.CancellationScope.Body%2A> nie zostały ukończone, <xref:System.Activities.Statements.CancellationScope> zostanie oznaczone jako <xref:System.Activities.ActivityInstanceState.Canceled> i <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> działania zostaną wykonane.</span><span class="sxs-lookup"><span data-stu-id="411f4-118">If a cancellation request is scheduled and the activities in the <xref:System.Activities.Statements.CancellationScope.Body%2A> have not completed, then the <xref:System.Activities.Statements.CancellationScope> will be marked as <xref:System.Activities.ActivityInstanceState.Canceled> and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> activities will be executed.</span></span>  
  
### <a name="canceling-a-workflow-from-the-host"></a><span data-ttu-id="411f4-119">Anulowanie przepływu pracy z hosta</span><span class="sxs-lookup"><span data-stu-id="411f4-119">Canceling a Workflow from the Host</span></span>  

 <span data-ttu-id="411f4-120">Host może anulować przepływ pracy, wywołując <xref:System.Activities.WorkflowApplication.Cancel%2A> metodę <xref:System.Activities.WorkflowApplication> wystąpienia, które obsługuje przepływ pracy.</span><span class="sxs-lookup"><span data-stu-id="411f4-120">A host can cancel a workflow by calling the <xref:System.Activities.WorkflowApplication.Cancel%2A> method of the <xref:System.Activities.WorkflowApplication> instance that is hosting the workflow.</span></span> <span data-ttu-id="411f4-121">W poniższym przykładzie jest tworzony przepływ pracy, który ma <xref:System.Activities.Statements.CancellationScope> .</span><span class="sxs-lookup"><span data-stu-id="411f4-121">In the following example a workflow is created that has a <xref:System.Activities.Statements.CancellationScope>.</span></span> <span data-ttu-id="411f4-122">Przepływ pracy jest wywoływany, a następnie Host wykonuje wywołanie <xref:System.Activities.WorkflowApplication.Cancel%2A> .</span><span class="sxs-lookup"><span data-stu-id="411f4-122">The workflow is invoked, and then the host makes a call to <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span></span> <span data-ttu-id="411f4-123">Główne wykonywanie przepływu pracy zostanie zatrzymane, <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> <xref:System.Activities.Statements.CancellationScope> zostanie wywołane, a następnie przepływ pracy zostanie ukończony ze stanem <xref:System.Activities.ActivityInstanceState.Canceled> .</span><span class="sxs-lookup"><span data-stu-id="411f4-123">The main execution of the workflow is stopped, the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of the <xref:System.Activities.Statements.CancellationScope> is invoked, and then the workflow completes with a status of <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#35](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#35)]  
  
 <span data-ttu-id="411f4-124">Po wywołaniu tego przepływu pracy następujące dane wyjściowe są wyświetlane w konsoli programu.</span><span class="sxs-lookup"><span data-stu-id="411f4-124">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="411f4-125">**Uruchamianie przepływu pracy.**</span><span class="sxs-lookup"><span data-stu-id="411f4-125">**Starting the workflow.**</span></span>  
<span data-ttu-id="411f4-126">**CancellationHandler wywołana.** 
 **Anulowano przepływ pracy b30ebb30-df46-4d90-a211-e31c38d8db3c.**</span><span class="sxs-lookup"><span data-stu-id="411f4-126">**CancellationHandler invoked.**
**Workflow b30ebb30-df46-4d90-a211-e31c38d8db3c Canceled.**</span></span>
> [!NOTE]
> <span data-ttu-id="411f4-127">Gdy <xref:System.Activities.Statements.CancellationScope> działanie zostało anulowane i <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> wywołane, odpowiada autorowi przepływu pracy, aby określić postęp anulowania działania anulowanego przed jego anulowaniem w celu zapewnienia odpowiedniej logiki anulowania.</span><span class="sxs-lookup"><span data-stu-id="411f4-127">When a <xref:System.Activities.Statements.CancellationScope> activity is canceled and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> invoked, it is the responsibility of the workflow author to determine the progress that the canceled activity made before it was canceled in order to provide the appropriate cancellation logic.</span></span> <span data-ttu-id="411f4-128">Nie <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> zawiera żadnych informacji o postępie anulowanych działań.</span><span class="sxs-lookup"><span data-stu-id="411f4-128">The <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> does not provide any information about the progress of the canceled activity.</span></span>  
  
 <span data-ttu-id="411f4-129">Przepływ pracy można również anulować z hosta, jeśli wystąpił nieobsługiwany wyjątek, który znajduje się poza katalogiem głównym przepływu pracy, a <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> procedura obsługi zwraca wartość <xref:System.Activities.UnhandledExceptionAction.Cancel> .</span><span class="sxs-lookup"><span data-stu-id="411f4-129">A workflow can also be canceled from the host if an unhandled exception bubbles up past the root of the workflow and the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler returns <xref:System.Activities.UnhandledExceptionAction.Cancel>.</span></span> <span data-ttu-id="411f4-130">W tym przykładzie przepływ pracy zostanie uruchomiony, a następnie wygeneruje <xref:System.ApplicationException> .</span><span class="sxs-lookup"><span data-stu-id="411f4-130">In this example the workflow starts and then throws an <xref:System.ApplicationException>.</span></span> <span data-ttu-id="411f4-131">Ten wyjątek jest nieobsługiwany przez przepływ pracy i dlatego <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> jest wywoływany program obsługi.</span><span class="sxs-lookup"><span data-stu-id="411f4-131">This exception is unhandled by the workflow and so the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler is invoked.</span></span> <span data-ttu-id="411f4-132">Program obsługi instruuje środowisko uruchomieniowe, aby anulował przepływ pracy, a <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> aktualnie wykonywane <xref:System.Activities.Statements.CancellationScope> działanie jest wywoływane.</span><span class="sxs-lookup"><span data-stu-id="411f4-132">The handler instructs the runtime to cancel the workflow, and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of the currently executing <xref:System.Activities.Statements.CancellationScope> activity is invoked.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#36](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#36)]  
  
 <span data-ttu-id="411f4-133">Po wywołaniu tego przepływu pracy następujące dane wyjściowe są wyświetlane w konsoli programu.</span><span class="sxs-lookup"><span data-stu-id="411f4-133">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="411f4-134">**Uruchamianie przepływu pracy.**</span><span class="sxs-lookup"><span data-stu-id="411f4-134">**Starting the workflow.**</span></span>  
<span data-ttu-id="411f4-135">**OnUnhandledException w przepływie pracy 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9** 
 **Zgłoszono wyjątek ApplicationException.** 
 **CancellationHandler wywołana.** 
 **Anulowano przepływ pracy 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9.**</span><span class="sxs-lookup"><span data-stu-id="411f4-135">**OnUnhandledException in Workflow 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9**
**An ApplicationException was thrown.**
**CancellationHandler invoked.**
**Workflow 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9 Canceled.**</span></span>

### <a name="canceling-an-activity-from-inside-a-workflow"></a><span data-ttu-id="411f4-136">Anulowanie działania z wewnątrz przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="411f4-136">Canceling an Activity from Inside a Workflow</span></span>  

 <span data-ttu-id="411f4-137">Działanie może być również anulowane przez jego element nadrzędny.</span><span class="sxs-lookup"><span data-stu-id="411f4-137">An activity can also be canceled by its parent.</span></span> <span data-ttu-id="411f4-138">Jeśli na przykład <xref:System.Activities.Statements.Parallel> działanie ma wiele wykonanych gałęzi, a jego <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> wartość zostanie wyznaczona, `true` jego niekompletne gałęzie zostaną anulowane.</span><span class="sxs-lookup"><span data-stu-id="411f4-138">For example, if a <xref:System.Activities.Statements.Parallel> activity has multiple executing branches and its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> evaluates to `true` then its incomplete branches will be canceled.</span></span> <span data-ttu-id="411f4-139">W tym przykładzie <xref:System.Activities.Statements.Parallel> tworzone jest działanie, które ma dwie gałęzie.</span><span class="sxs-lookup"><span data-stu-id="411f4-139">In this example a <xref:System.Activities.Statements.Parallel> activity is created that has two branches.</span></span> <span data-ttu-id="411f4-140"><xref:System.Activities.Statements.Parallel.CompletionCondition%2A>Jest ustawiona na tak, aby zakończyć `true` <xref:System.Activities.Statements.Parallel> działanie zaraz po zakończeniu jednego z jego gałęzi.</span><span class="sxs-lookup"><span data-stu-id="411f4-140">Its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> is set to `true` so the <xref:System.Activities.Statements.Parallel> completes as soon as any one of its branches is completed.</span></span> <span data-ttu-id="411f4-141">W tym przykładzie rozgałęzienie 2 kończy działanie, a gałąź 1 została anulowana.</span><span class="sxs-lookup"><span data-stu-id="411f4-141">In this example branch 2 completes, and so branch 1 is canceled.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#37](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#37)]  
  
 <span data-ttu-id="411f4-142">Po wywołaniu tego przepływu pracy następujące dane wyjściowe są wyświetlane w konsoli programu.</span><span class="sxs-lookup"><span data-stu-id="411f4-142">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="411f4-143">**Początek gałęzi 1.**</span><span class="sxs-lookup"><span data-stu-id="411f4-143">**Branch 1 starting.**</span></span>  
<span data-ttu-id="411f4-144">**Ukończono rozgałęzienie 2.** 
 **Anulowano rozgałęzienie 1.** 
 **Ukończono E0685e24-18ef-4a47-acf3-5c638732f3be przepływu pracy.**</span><span class="sxs-lookup"><span data-stu-id="411f4-144">**Branch 2 complete.**
**Branch 1 canceled.**
**Workflow e0685e24-18ef-4a47-acf3-5c638732f3be Completed.**</span></span>  <span data-ttu-id="411f4-145">Działania są również anulowane, jeśli wyjątek występuje w górę od elementu głównego działania, ale jest obsługiwany na wyższym poziomie w przepływie pracy.</span><span class="sxs-lookup"><span data-stu-id="411f4-145">Activities are also canceled if an exception bubbles up past the root of the activity but is handled at a higher level in the workflow.</span></span> <span data-ttu-id="411f4-146">W tym przykładzie główna logika przepływu pracy składa się z <xref:System.Activities.Statements.Sequence> działania.</span><span class="sxs-lookup"><span data-stu-id="411f4-146">In this example, the main logic of the workflow consists of a <xref:System.Activities.Statements.Sequence> activity.</span></span> <span data-ttu-id="411f4-147"><xref:System.Activities.Statements.Sequence>Jest określony jako działanie, <xref:System.Activities.Statements.CancellationScope.Body%2A> <xref:System.Activities.Statements.CancellationScope> które jest zawarte w <xref:System.Activities.Statements.TryCatch> działaniu.</span><span class="sxs-lookup"><span data-stu-id="411f4-147">The <xref:System.Activities.Statements.Sequence> is specified as the <xref:System.Activities.Statements.CancellationScope.Body%2A> of a <xref:System.Activities.Statements.CancellationScope> activity which is contained by a <xref:System.Activities.Statements.TryCatch> activity.</span></span> <span data-ttu-id="411f4-148">Wyjątek jest generowany z treści <xref:System.Activities.Statements.Sequence> , jest obsługiwany przez działanie nadrzędne <xref:System.Activities.Statements.TryCatch> i <xref:System.Activities.Statements.Sequence> jest anulowany.</span><span class="sxs-lookup"><span data-stu-id="411f4-148">An exception is thrown from the body of the <xref:System.Activities.Statements.Sequence>, is handled by the parent <xref:System.Activities.Statements.TryCatch> activity, and the <xref:System.Activities.Statements.Sequence> is canceled.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#39](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#39)]  
  
 <span data-ttu-id="411f4-149">Po wywołaniu tego przepływu pracy następujące dane wyjściowe są wyświetlane w konsoli programu.</span><span class="sxs-lookup"><span data-stu-id="411f4-149">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="411f4-150">**Rozpoczynanie sekwencji.**</span><span class="sxs-lookup"><span data-stu-id="411f4-150">**Sequence starting.**</span></span>  
<span data-ttu-id="411f4-151">**Anulowano sekwencję.** 
 **Przechwycono wyjątek.** 
 **Ukończono E3c18939-121e-4c43-af1c-ba1ce977ce55 przepływu pracy.**</span><span class="sxs-lookup"><span data-stu-id="411f4-151">**Sequence canceled.**
**Exception caught.**
**Workflow e3c18939-121e-4c43-af1c-ba1ce977ce55 Completed.**</span></span>

### <a name="throwing-exceptions-from-a-cancellationhandler"></a><span data-ttu-id="411f4-152">Zgłaszanie wyjątków z CancellationHandler</span><span class="sxs-lookup"><span data-stu-id="411f4-152">Throwing Exceptions from a CancellationHandler</span></span>  

 <span data-ttu-id="411f4-153">Wszystkie wyjątki zgłoszone z elementu <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> <xref:System.Activities.Statements.CancellationScope> są krytyczne dla przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="411f4-153">Any exceptions thrown from the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of a <xref:System.Activities.Statements.CancellationScope> are fatal to the workflow.</span></span> <span data-ttu-id="411f4-154">Jeśli istnieje możliwość występowania wyjątków ucieczki z <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> , należy użyć instrukcji <xref:System.Activities.Statements.TryCatch> w <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> celu przechwycenia i obsłużenia tych wyjątków.</span><span class="sxs-lookup"><span data-stu-id="411f4-154">If there is a possibility of exceptions escaping from a <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>, use a <xref:System.Activities.Statements.TryCatch> in the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> to catch and handle these exceptions.</span></span>  
  
### <a name="cancellation-using-compensableactivity"></a><span data-ttu-id="411f4-155">Anulowanie przy użyciu działanie CompensableActivity</span><span class="sxs-lookup"><span data-stu-id="411f4-155">Cancellation using CompensableActivity</span></span>  

 <span data-ttu-id="411f4-156">Podobnie jak w przypadku <xref:System.Activities.Statements.CancellationScope> działania, <xref:System.Activities.Statements.CompensableActivity> ma <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> .</span><span class="sxs-lookup"><span data-stu-id="411f4-156">Like the <xref:System.Activities.Statements.CancellationScope> activity, the <xref:System.Activities.Statements.CompensableActivity> has a <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A>.</span></span> <span data-ttu-id="411f4-157">Jeśli element <xref:System.Activities.Statements.CompensableActivity> zostanie anulowany, wszystkie działania w nim <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> są wywoływane.</span><span class="sxs-lookup"><span data-stu-id="411f4-157">If a <xref:System.Activities.Statements.CompensableActivity> is canceled, any activities in its <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> are invoked.</span></span> <span data-ttu-id="411f4-158">Może to być przydatne do cofania pracy częściowo ukończonej kompensacyjne.</span><span class="sxs-lookup"><span data-stu-id="411f4-158">This can be useful for undoing partially completed compensable work.</span></span> <span data-ttu-id="411f4-159">Aby uzyskać informacje o sposobach korzystania z <xref:System.Activities.Statements.CompensableActivity> kompensacji i anulowania, zobacz [kompensacja](compensation.md).</span><span class="sxs-lookup"><span data-stu-id="411f4-159">For information about how to use <xref:System.Activities.Statements.CompensableActivity> for compensation and cancellation, see [Compensation](compensation.md).</span></span>  
  
## <a name="cancellation-using-custom-activities"></a><span data-ttu-id="411f4-160">Anulowanie przy użyciu działań niestandardowych</span><span class="sxs-lookup"><span data-stu-id="411f4-160">Cancellation using Custom Activities</span></span>  

 <span data-ttu-id="411f4-161">Autorzy działań niestandardowych mogą implementować logikę anulowania w swoich działaniach niestandardowych na kilka różnych sposobów.</span><span class="sxs-lookup"><span data-stu-id="411f4-161">Custom activity authors can implement cancellation logic into their custom activities in several different ways.</span></span> <span data-ttu-id="411f4-162">Działania niestandardowe, które pochodzą od <xref:System.Activities.Activity> mogą implementować logikę anulowania przez umieszczenie <xref:System.Activities.Statements.CancellationScope> lub inne niestandardowe działanie, które zawiera logikę anulowania w treści działania.</span><span class="sxs-lookup"><span data-stu-id="411f4-162">Custom activities that derive from <xref:System.Activities.Activity> can implement cancellation logic by placing a <xref:System.Activities.Statements.CancellationScope> or other custom activity that contains cancellation logic in the body of the activity.</span></span> <span data-ttu-id="411f4-163"><xref:System.Activities.AsyncCodeActivity> i <xref:System.Activities.NativeActivity> działania pochodne mogą przesłonić odpowiednią <xref:System.Activities.NativeActivity.Cancel%2A> metodę i zapewnić logikę anulowania.</span><span class="sxs-lookup"><span data-stu-id="411f4-163"><xref:System.Activities.AsyncCodeActivity> and <xref:System.Activities.NativeActivity> derived activities can override their respective <xref:System.Activities.NativeActivity.Cancel%2A> method and provide cancellation logic there.</span></span> <span data-ttu-id="411f4-164"><xref:System.Activities.CodeActivity> działania pochodne nie zapewniają żadnych prowizji do anulowania, ponieważ cała ich praca odbywa się w ramach jednej serii wykonywania, gdy środowisko uruchomieniowe wywołuje <xref:System.Activities.CodeActivity.Execute%2A> metodę.</span><span class="sxs-lookup"><span data-stu-id="411f4-164"><xref:System.Activities.CodeActivity> derived activities do not provide any provision for cancellation because all their work is performed in a single burst of execution when the runtime calls the <xref:System.Activities.CodeActivity.Execute%2A> method.</span></span> <span data-ttu-id="411f4-165">Jeśli metoda EXECUTE nie została jeszcze wywołana <xref:System.Activities.CodeActivity> , a działanie na podstawie zostało anulowane, działanie zostanie zamknięte ze stanem <xref:System.Activities.ActivityInstanceState.Canceled> i <xref:System.Activities.CodeActivity.Execute%2A> Metoda nie jest wywoływana.</span><span class="sxs-lookup"><span data-stu-id="411f4-165">If the execute method has not yet been called and a <xref:System.Activities.CodeActivity> based activity is canceled, the activity closes with a status of <xref:System.Activities.ActivityInstanceState.Canceled> and the <xref:System.Activities.CodeActivity.Execute%2A> method is not called.</span></span>  
  
### <a name="cancellation-using-nativeactivity"></a><span data-ttu-id="411f4-166">Anulowanie przy użyciu natywnego</span><span class="sxs-lookup"><span data-stu-id="411f4-166">Cancellation using NativeActivity</span></span>  

 <span data-ttu-id="411f4-167"><xref:System.Activities.NativeActivity> działania pochodne mogą przesłonić <xref:System.Activities.NativeActivity.Cancel%2A> metodę, aby zapewnić niestandardową logikę anulowania.</span><span class="sxs-lookup"><span data-stu-id="411f4-167"><xref:System.Activities.NativeActivity> derived activities can override the <xref:System.Activities.NativeActivity.Cancel%2A> method to provide custom cancellation logic.</span></span> <span data-ttu-id="411f4-168">Jeśli ta metoda nie zostanie zastąpiona, zostanie zastosowana domyślna logika anulowania przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="411f4-168">If this method is not overridden, then the default workflow cancellation logic is applied.</span></span> <span data-ttu-id="411f4-169">Domyślne anulowanie to proces, który występuje dla elementu <xref:System.Activities.NativeActivity> , który nie przesłania <xref:System.Activities.NativeActivity.Cancel%2A> metody lub którego <xref:System.Activities.NativeActivity.Cancel%2A> Metoda wywołuje metodę bazową <xref:System.Activities.NativeActivity> <xref:System.Activities.NativeActivity.Cancel%2A> .</span><span class="sxs-lookup"><span data-stu-id="411f4-169">Default cancellation is the process that occurs for a <xref:System.Activities.NativeActivity> that does not override the <xref:System.Activities.NativeActivity.Cancel%2A> method or whose <xref:System.Activities.NativeActivity.Cancel%2A> method calls the base <xref:System.Activities.NativeActivity> <xref:System.Activities.NativeActivity.Cancel%2A> method.</span></span> <span data-ttu-id="411f4-170">Gdy działanie zostanie anulowane, środowisko uruchomieniowe flaguje działanie anulowania i automatycznie obsługuje określone czyszczenie.</span><span class="sxs-lookup"><span data-stu-id="411f4-170">When an activity is canceled, the runtime flags the activity for cancellation and automatically handles certain cleanup.</span></span> <span data-ttu-id="411f4-171">Jeśli działanie zawiera tylko zakładki oczekujące, zakładki zostaną usunięte, a działanie zostanie oznaczone jako <xref:System.Activities.ActivityInstanceState.Canceled> .</span><span class="sxs-lookup"><span data-stu-id="411f4-171">If the activity only has outstanding bookmarks, the bookmarks will be removed and the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="411f4-172">Wszystkie zaległe działania podrzędne anulowanego działania zostaną anulowane.</span><span class="sxs-lookup"><span data-stu-id="411f4-172">Any outstanding child activities of the canceled activity will in turn be canceled.</span></span> <span data-ttu-id="411f4-173">Każda próba zaplanowania dodatkowych działań podrzędnych spowoduje zignorowanie próby, a działanie zostanie oznaczone jako <xref:System.Activities.ActivityInstanceState.Canceled> .</span><span class="sxs-lookup"><span data-stu-id="411f4-173">Any attempt to schedule additional child activities will result in the attempt being ignored and the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="411f4-174">Jeśli wszystkie zaległe działania podrzędne zostaną zakończone <xref:System.Activities.ActivityInstanceState.Canceled> w <xref:System.Activities.ActivityInstanceState.Faulted> stanie lub, działanie zostanie oznaczone jako <xref:System.Activities.ActivityInstanceState.Canceled> .</span><span class="sxs-lookup"><span data-stu-id="411f4-174">If any outstanding child activity completes in the <xref:System.Activities.ActivityInstanceState.Canceled> or <xref:System.Activities.ActivityInstanceState.Faulted> state, then the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="411f4-175">Zwróć uwagę, że można zignorować żądanie anulowania.</span><span class="sxs-lookup"><span data-stu-id="411f4-175">Note that a cancellation request can be ignored.</span></span> <span data-ttu-id="411f4-176">Jeśli działanie nie zawiera żadnych zaległych zakładek lub wykonuje działania podrzędne i nie planuje żadnych dodatkowych elementów roboczych po oflagowaniu do anulowania, zakończy się pomyślnie.</span><span class="sxs-lookup"><span data-stu-id="411f4-176">If an activity does not have any outstanding bookmarks or executing child activities and does not schedule any additional work items after being flagged for cancellation, it will complete successfully.</span></span> <span data-ttu-id="411f4-177">To domyślne anulowanie jest wystarczające dla wielu scenariuszy, ale jeśli jest wymagana dodatkowa logika anulowania, można użyć wbudowanych działań anulowania lub działań niestandardowych.</span><span class="sxs-lookup"><span data-stu-id="411f4-177">This default cancellation suffices for many scenarios, but if additional cancellation logic is needed, then the built-in cancellation activities or custom activities can be used.</span></span>  
  
 <span data-ttu-id="411f4-178">W poniższym przykładzie <xref:System.Activities.NativeActivity.Cancel%2A> zdefiniowano przesłonięcie <xref:System.Activities.NativeActivity> działania niestandardowego opartego na elemencie `ParallelForEach` .</span><span class="sxs-lookup"><span data-stu-id="411f4-178">In the following example, the <xref:System.Activities.NativeActivity.Cancel%2A> override of a <xref:System.Activities.NativeActivity> based custom `ParallelForEach` activity is defined.</span></span> <span data-ttu-id="411f4-179">Gdy działanie zostanie anulowane, to przesłonięcie obsługuje logikę anulowania działania.</span><span class="sxs-lookup"><span data-stu-id="411f4-179">When the activity is canceled, this override handles the cancellation logic for the activity.</span></span> <span data-ttu-id="411f4-180">Ten przykład jest częścią [nieogólnego](./samples/non-generic-parallelforeach.md) przykładu ParallelForEach.</span><span class="sxs-lookup"><span data-stu-id="411f4-180">This example is part of the [Non-Generic ParallelForEach](./samples/non-generic-parallelforeach.md) sample.</span></span>  
  
```csharp  
protected override void Cancel(NativeActivityContext context)  
{  
    // If we do not have a completion condition then we can just  
    // use default logic.  
    if (this.CompletionCondition == null)  
    {  
        base.Cancel(context);  
    }  
    else  
    {  
        context.CancelChildren();  
    }  
}  
```  
  
 <span data-ttu-id="411f4-181"><xref:System.Activities.NativeActivity> działania pochodne mogą określić, czy żądanie anulowania zostało zażądane, sprawdzając <xref:System.Activities.NativeActivityContext.IsCancellationRequested%2A> Właściwość i Oznacz jako anulowane przez wywołanie <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="411f4-181"><xref:System.Activities.NativeActivity> derived activities can determine if cancellation has been requested by inspecting the <xref:System.Activities.NativeActivityContext.IsCancellationRequested%2A> property, and mark themselves as canceled by calling the <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> method.</span></span> <span data-ttu-id="411f4-182">Wywołanie nie <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> powoduje natychmiastowego wykonania działania.</span><span class="sxs-lookup"><span data-stu-id="411f4-182">Calling <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> does not immediately complete the activity.</span></span> <span data-ttu-id="411f4-183">Jak zwykle, środowisko uruchomieniowe ukończy działanie, gdy nie będzie więcej zaległych zadań, ale jeśli <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> jest wywoływana, <xref:System.Activities.ActivityInstanceState.Canceled> zamiast <xref:System.Activities.ActivityInstanceState.Closed> .</span><span class="sxs-lookup"><span data-stu-id="411f4-183">As usual, the runtime will complete the activity when it has no more outstanding work, but if <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> is called the final state will be <xref:System.Activities.ActivityInstanceState.Canceled> instead of <xref:System.Activities.ActivityInstanceState.Closed>.</span></span>  
  
### <a name="cancellation-using-asynccodeactivity"></a><span data-ttu-id="411f4-184">Anulowanie przy użyciu metoda AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="411f4-184">Cancellation using AsyncCodeActivity</span></span>  

 <span data-ttu-id="411f4-185"><xref:System.Activities.AsyncCodeActivity> działania bazujące mogą również dostarczyć niestandardowe logike anulowania, zastępując <xref:System.Activities.AsyncCodeActivity.Cancel%2A> metodę.</span><span class="sxs-lookup"><span data-stu-id="411f4-185"><xref:System.Activities.AsyncCodeActivity> based activities can also provide custom cancellation logic by overriding the <xref:System.Activities.AsyncCodeActivity.Cancel%2A> method.</span></span> <span data-ttu-id="411f4-186">Jeśli ta metoda nie zostanie przesłonięta, obsługa anulowania nie zostanie wykonana, jeśli działanie zostało anulowane.</span><span class="sxs-lookup"><span data-stu-id="411f4-186">If this method is not overridden, then no cancellation handling is performed if the activity is canceled.</span></span> <span data-ttu-id="411f4-187">W poniższym przykładzie <xref:System.Activities.AsyncCodeActivity.Cancel%2A> zdefiniowano przesłonięcie <xref:System.Activities.AsyncCodeActivity> działania niestandardowego opartego na elemencie `ExecutePowerShell` .</span><span class="sxs-lookup"><span data-stu-id="411f4-187">In the following example, the <xref:System.Activities.AsyncCodeActivity.Cancel%2A> override of an <xref:System.Activities.AsyncCodeActivity> based custom `ExecutePowerShell` activity is defined.</span></span> <span data-ttu-id="411f4-188">Gdy działanie zostanie anulowane, wykonuje żądane zachowanie anulowania.</span><span class="sxs-lookup"><span data-stu-id="411f4-188">When the activity is canceled, it performs the desired cancellation behavior.</span></span>
  
 [!code-csharp[CFX_WorkflowApplicationExample#1020](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#1020)]  
  
 <span data-ttu-id="411f4-189"><xref:System.Activities.AsyncCodeActivity> działania pochodne mogą określić, czy żądanie anulowania zostało zażądane, sprawdzając <xref:System.Activities.AsyncCodeActivityContext.IsCancellationRequested%2A> Właściwość i Oznacz jako anulowane przez wywołanie <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="411f4-189"><xref:System.Activities.AsyncCodeActivity> derived activities can determine if cancellation has been requested by inspecting the <xref:System.Activities.AsyncCodeActivityContext.IsCancellationRequested%2A> property, and mark themselves as canceled by calling the <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A> method.</span></span>
