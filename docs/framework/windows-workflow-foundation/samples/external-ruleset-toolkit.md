---
title: Zewnętrzne przybornik zestawu reguł
ms.date: 03/30/2017
ms.assetid: a306d283-a031-475e-aa01-9ae86e7adcb0
ms.openlocfilehash: eb59b02d469788b23126f4e02c5b7ae5a63081f0
ms.sourcegitcommit: 011314e0c8eb4cf4a11d92078f58176c8c3efd2d
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 02/09/2020
ms.locfileid: "77094673"
---
# <a name="external-ruleset-toolkit"></a><span data-ttu-id="ad6ea-102">Zewnętrzne przybornik zestawu reguł</span><span class="sxs-lookup"><span data-stu-id="ad6ea-102">External Ruleset Toolkit</span></span>

<span data-ttu-id="ad6ea-103">Zwykle gdy reguły są używane w aplikacji przepływu pracy, reguły są częścią zestawu.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-103">Normally when rules are used within a workflow application, the rules are part of the assembly.</span></span> <span data-ttu-id="ad6ea-104">W niektórych scenariuszach warto zachować zestawy reguł niezależnie od zestawu, aby można je było aktualizować bez konieczności ponownego kompilowania i wdrażania zestawu przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-104">In some scenarios, you may want to maintain the RuleSets separately from the assembly so that they can be updated without rebuilding and deploying the workflow assembly.</span></span> <span data-ttu-id="ad6ea-105">Ten przykład umożliwia zarządzanie zestawami reguł w bazie danych i ich edytowanie oraz uzyskiwanie dostępu do tych zestawów reguł z przepływu pracy w czasie wykonywania.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-105">This sample allows you to manage and edit RuleSets in a database and access those RuleSets from a workflow at runtime.</span></span> <span data-ttu-id="ad6ea-106">Dzięki temu uruchomione wystąpienia przepływu pracy mogą automatycznie uwzględniać zmiany zestawu reguł.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-106">This enables running workflow instances to automatically incorporate RuleSet changes.</span></span>

<span data-ttu-id="ad6ea-107">Zewnętrzny zestaw narzędzi Toolkit zawiera narzędzie oparte na Windows Forms, które służy do zarządzania wersjami zestawów reguł w bazie danych i ich edytowania.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-107">The External RuleSet Toolkit sample contains a Windows Forms-based tool that you can use to manage and edit RuleSet versions in a database.</span></span> <span data-ttu-id="ad6ea-108">Obejmuje ona również działanie i usługę hosta do wykonywania tych reguł.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-108">It also includes an activity and a host service for executing those rules.</span></span>

> [!NOTE]
> <span data-ttu-id="ad6ea-109">Ten przykład wymaga [Microsoft SQL Server](/sql).</span><span class="sxs-lookup"><span data-stu-id="ad6ea-109">This sample requires [Microsoft SQL Server](/sql).</span></span>

<span data-ttu-id="ad6ea-110">Program Visual Studio udostępnia Edytor zestawu reguł w ramach Windows Workflow Foundation (WF).</span><span class="sxs-lookup"><span data-stu-id="ad6ea-110">Visual Studio provides a RuleSet editor as part of the Windows Workflow Foundation (WF).</span></span> <span data-ttu-id="ad6ea-111">Możesz uruchomić tego edytora przez dwukrotne kliknięcie działania `Policy` w przepływie pracy; deserializacji zdefiniowanego obiektu zestawu reguł do pliku reguł skojarzonego z przepływem pracy (działanie `Policy` uruchamia wystąpienie zestawu reguł dla przepływu pracy).</span><span class="sxs-lookup"><span data-stu-id="ad6ea-111">You can start this editor by double-clicking the `Policy` activity in a workflow; it serializes the defined RuleSet object to the .rules file associated with the workflow (a `Policy` activity runs a RuleSet instance against the workflow).</span></span> <span data-ttu-id="ad6ea-112">Plik. Rules jest kompilowany do zestawu jako zasób podczas budowania projektu przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-112">The .rules file is compiled into the assembly as a resource when you build the workflow project.</span></span>

<span data-ttu-id="ad6ea-113">Składniki tego przykładu obejmują:</span><span class="sxs-lookup"><span data-stu-id="ad6ea-113">The components of this sample include:</span></span>

- <span data-ttu-id="ad6ea-114">Graficzny interfejs użytkownika zestawu reguł, za pomocą którego można edytować wersje zestawu reguł i zarządzać nimi w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-114">A RuleSet graphical user interface tool that you can use to edit and manage RuleSet versions in the database.</span></span>

- <span data-ttu-id="ad6ea-115">Usługa zestawu reguł, która jest skonfigurowana dla aplikacji hosta i uzyskuje dostęp do zestawów reguł z bazy danych.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-115">A RuleSet service that is configured on the host application and accesses RuleSets from the database.</span></span>

- <span data-ttu-id="ad6ea-116">Działanie `ExternalPolicy`, które żąda zestawu reguł z usługi zestawu reguł i uruchamia zestaw reguł dla przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-116">An `ExternalPolicy` activity that requests a RuleSet from the RuleSet service and runs the RuleSet against the workflow.</span></span>

<span data-ttu-id="ad6ea-117">Interakcje składników są pokazane na poniższej ilustracji.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-117">The interaction of the components is shown in the following image.</span></span> <span data-ttu-id="ad6ea-118">Poniższe sekcje opisują każdy składnik.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-118">The sections that follow describe each component.</span></span>

![Diagram przedstawiający przykładowe Omówienie zestawu narzędzi zewnętrznych zestawów reguł.](./media/external-ruleset-toolkit/ruleset-toolkit-overview.gif)

> [!IMPORTANT]
> <span data-ttu-id="ad6ea-120">Przykłady mogą być już zainstalowane na komputerze.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-120">The samples may already be installed on your machine.</span></span> <span data-ttu-id="ad6ea-121">Przed kontynuowaniem Wyszukaj następujący katalog (domyślny).</span><span class="sxs-lookup"><span data-stu-id="ad6ea-121">Check for the following (default) directory before continuing.</span></span>
>
> `<InstallDrive>:\WF_WCF_Samples`
>
> <span data-ttu-id="ad6ea-122">Jeśli ten katalog nie istnieje, przejdź do [przykładów Windows Communication Foundation (WCF) i Windows Workflow Foundation (WF) dla .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) , aby pobrać wszystkie próbki Windows Communication Foundation (WCF) i [!INCLUDE[wf1](../../../../includes/wf1-md.md)].</span><span class="sxs-lookup"><span data-stu-id="ad6ea-122">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="ad6ea-123">Ten przykład znajduje się w następującym katalogu.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-123">This sample is located in the following directory.</span></span>
>
> `<InstallDrive>:\WF_WCF_Samples\WF\Scenario\ExternalRuleSetToolKit`

## <a name="ruleset-tool"></a><span data-ttu-id="ad6ea-124">Narzędzie zestawu reguł</span><span class="sxs-lookup"><span data-stu-id="ad6ea-124">RuleSet Tool</span></span>

<span data-ttu-id="ad6ea-125">Poniższy obraz przedstawia zrzut ekranu narzędzia zestawu reguł.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-125">The following image is a screenshot of the RuleSet tool.</span></span> <span data-ttu-id="ad6ea-126">Z menu **Magazyn reguł** można załadować dostępne zestaw reguł z bazy danych i zapisać zmodyfikowane zestaw reguł z powrotem do sklepu.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-126">From the **Rule Store** menu, you can load the available RuleSets from the database and save modified RuleSets back to the store.</span></span> <span data-ttu-id="ad6ea-127">Plik konfiguracji aplikacji zawiera parametry połączenia bazy danych dla bazy danych zestawu reguł.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-127">An application configuration file provides a database connection string for the RuleSet database.</span></span> <span data-ttu-id="ad6ea-128">Po uruchomieniu narzędzia automatycznie ładuje zestaw reguł ze skonfigurowanej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-128">When you start the tool, it automatically loads the RuleSets from the configured database.</span></span>

![Zrzut ekranu przedstawiający przeglądarkę zestawów reguł.](./media/external-ruleset-toolkit/ruleset-browser-dialog.gif)

<span data-ttu-id="ad6ea-130">Narzędzie zestawu reguł stosuje do zestawów reguł główne i pomocnicze numery wersji, co pozwala na równoczesne przechowywanie i zapisywanie wielu wersji (Narzędzie to nie zapewnia blokowania ani innych funkcji zarządzania konfiguracją oprócz możliwości obsługi wersji).</span><span class="sxs-lookup"><span data-stu-id="ad6ea-130">The RuleSet tool applies major and minor version numbers to the RuleSets, allowing you to simultaneously maintain and store multiple versions (the tool provides no locking or other configuration management features in addition to the versioning capability).</span></span> <span data-ttu-id="ad6ea-131">Za pomocą narzędzia można tworzyć nowe wersje zestawu reguł lub usuwać istniejące.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-131">Using the tool, you can create new RuleSet versions or delete existing versions.</span></span> <span data-ttu-id="ad6ea-132">Po kliknięciu przycisku **Nowy**Narzędzie utworzy nową nazwę zestawu reguł i zastosuje wersję 1,0.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-132">When you click **New**, the tool creates a new RuleSet name and applies version 1.0.</span></span> <span data-ttu-id="ad6ea-133">Podczas kopiowania wersji narzędzie tworzy kopię wybranej wersji zestawu reguł, łącznie z zawartymi regułami i przypisuje nowe, unikatowe numery wersji.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-133">When you copy a version, the tool creates a copy of the selected RuleSet version, including the contained rules, and assigns new, unique version numbers.</span></span> <span data-ttu-id="ad6ea-134">Numery wersji są oparte na numerach wersji istniejących zestawów reguł.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-134">These version numbers are based on the version numbers of existing RuleSets.</span></span> <span data-ttu-id="ad6ea-135">Można zmienić nazwę zestawu reguł i numery wersji przy użyciu skojarzonych pól w formularzu.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-135">You can change the RuleSet name and version numbers using the associated fields on the form.</span></span>

<span data-ttu-id="ad6ea-136">Po kliknięciu przycisku **Edytuj reguły**zostanie uruchomiony Edytor zestawów reguł, jak pokazano na poniższej ilustracji:</span><span class="sxs-lookup"><span data-stu-id="ad6ea-136">When you click **Edit Rules**, the RuleSet editor starts, as shown in the following image:</span></span>

![Zrzut ekranu przedstawiający Edytor zestawu reguł.](./media/external-ruleset-toolkit/ruleset-editor-dialog.gif)

<span data-ttu-id="ad6ea-138">Jest to ponowne hosting okna dialogowego edytora, które jest częścią dodatku Windows Workflow Foundation Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-138">This is a re-hosting of the editor dialog that is part of the Windows Workflow Foundation Visual Studio add-in.</span></span> <span data-ttu-id="ad6ea-139">Zapewnia ona te same funkcje, w tym obsługę technologii IntelliSense.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-139">It provides the same functionality, including Intellisense support.</span></span> <span data-ttu-id="ad6ea-140">Reguły są tworzone względem typu docelowego (takiego jak przepływ pracy), który jest skojarzony z zestawem reguł w narzędziu; Po kliknięciu przycisku **Przeglądaj** w oknie dialogowym Narzędzia główne zostanie wyświetlone okno dialogowe **selektora przepływu pracy/typu** , jak pokazano na rysunku 4.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-140">The rules are authored against a target type (such as a workflow) that is associated with the RuleSet in the tool; when you click **Browse** in the main tool dialog, the **Workflow/Type Selector** dialog appears, as shown in Figure 4.</span></span>

<span data-ttu-id="ad6ea-141">![Wybór &#47;typu przepływu pracy](./media/71f08d57-e8f2-499e-8151-ece2cbdcabfd.gif "71f08d57-e8f2-499e-8151-ece2cbdcabfd")</span><span class="sxs-lookup"><span data-stu-id="ad6ea-141">![Workflow &#47;Type Selection](./media/71f08d57-e8f2-499e-8151-ece2cbdcabfd.gif "71f08d57-e8f2-499e-8151-ece2cbdcabfd")</span></span>

<span data-ttu-id="ad6ea-142">Rysunek 4. selektor przepływu pracy/typu</span><span class="sxs-lookup"><span data-stu-id="ad6ea-142">Figure 4: Workflow/Type Selector</span></span>

<span data-ttu-id="ad6ea-143">Za pomocą okna dialogowego **selektora przepływu pracy/typu** można określić zestaw i określony typ w tym zestawie.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-143">You can use the **Workflow/Type Selector** dialog to specify an assembly and a specific type within that assembly.</span></span> <span data-ttu-id="ad6ea-144">Ten typ jest typem docelowym, względem którego zostały utworzone reguły (i uruchom).</span><span class="sxs-lookup"><span data-stu-id="ad6ea-144">This type is the target type against which the rules are authored (and run).</span></span> <span data-ttu-id="ad6ea-145">W wielu przypadkach typ docelowy to przepływ pracy lub inny typ działania.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-145">In many cases, the target type is a workflow or some other activity type.</span></span> <span data-ttu-id="ad6ea-146">Można jednak uruchomić zestaw reguł dla dowolnego typu .NET.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-146">However, you can run a RuleSet against any .NET type.</span></span>

<span data-ttu-id="ad6ea-147">Ścieżka do pliku zestawu i typ `name are stored with the` zestaw reguł w bazie danych, dzięki czemu po pobraniu zestawu reguł z bazy danych Narzędzie próbuje automatycznie załadować typ docelowy.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-147">The path to the assembly file and the type `name are stored with the` RuleSet in the database, so that when the RuleSet is retrieved from the database, the tool attempts to automatically load the target type.</span></span>

<span data-ttu-id="ad6ea-148">Po kliknięciu przycisku **OK** w oknie dialogowym **selektora przepływu pracy i typu** sprawdzana jest Walidacja wybranego typu względem zestawu reguł, aby upewnić się, że typ docelowy ma wszystkie elementy członkowskie, do których odwołują się reguły.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-148">When you click **OK** in the **Workflow/Type Selector** dialog, it validates the selected type against the RuleSet, to ensure that the target type has all the members referenced by the rules.</span></span> <span data-ttu-id="ad6ea-149">Błędy są wyświetlane w oknie dialogowym **błędy walidacji** .</span><span class="sxs-lookup"><span data-stu-id="ad6ea-149">Errors are shown in a **Validation Errors** dialog.</span></span> <span data-ttu-id="ad6ea-150">Możesz wybrać opcję kontynuowania zmiany pomimo błędów lub kliknąć przycisk **Anuluj**.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-150">You can choose to continue with the change despite the errors, or click **Cancel**.</span></span> <span data-ttu-id="ad6ea-151">W menu **Narzędzia** w oknie dialogowym Narzędzia główne możesz kliknąć przycisk **Weryfikuj** , aby ponownie sprawdzić wersję zestawu reguł względem działania docelowego.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-151">From the **Tools** menu in the main tool dialog, you can click **Validate** to re-validate the RuleSet version against the target activity.</span></span>

![Zrzut ekranu przedstawiający okno dialogowe błędy walidacji.](./media/external-ruleset-toolkit/validation-errors-dialog.png)

<span data-ttu-id="ad6ea-153">Z menu **dane** w narzędziu można importować i eksportować zestaw reguł.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-153">From the **Data** menu in the tool, you can import and export RuleSets.</span></span> <span data-ttu-id="ad6ea-154">Po kliknięciu przycisku **Importuj**zostanie wyświetlone okno dialogowe Wybieranie plików, w którym można wybrać plik. rules.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-154">When you click **Import**, a file-chooser dialog appears, from which you can select a .rules file.</span></span> <span data-ttu-id="ad6ea-155">Może to być lub nie jest to plik początkowo utworzony w programie Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-155">This may or may not be a file initially created in Visual Studio.</span></span> <span data-ttu-id="ad6ea-156">Plik. rules powinien zawierać serializowane wystąpienie `RuleDefinitions`, które zawiera kolekcję warunków i kolekcję zestawów reguł.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-156">The .rules file should contain a serialized `RuleDefinitions` instance that contains a collection of conditions and a collection of RuleSets.</span></span> <span data-ttu-id="ad6ea-157">Narzędzie nie używa kolekcji warunków, ale używa formatu `RuleDefinitions`. rules, aby zezwolić na interakcję ze środowiskiem programu Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-157">The tool does not use the conditions collection, but it does use the `RuleDefinitions` .rules format to allow interaction with the Visual Studio environment.</span></span>

<span data-ttu-id="ad6ea-158">Po wybraniu pliku reguł zostanie wyświetlone okno dialogowe **Selektor zestawu reguł** .</span><span class="sxs-lookup"><span data-stu-id="ad6ea-158">After selecting a .rules file, a **RuleSet Selector** dialog appears.</span></span> <span data-ttu-id="ad6ea-159">Możesz użyć okna dialogowego, aby wybrać zestaw reguł z pliku, który ma zostać zaimportowany (domyślnie określa wszystkie zestaw reguł).</span><span class="sxs-lookup"><span data-stu-id="ad6ea-159">You can use the dialog to select the RuleSets from the file that you want to import (the default specifies all RuleSets).</span></span> <span data-ttu-id="ad6ea-160">Zestawy reguł w pliku reguł nie mają numerów wersji, ponieważ ich przechowywanie wersji w projekcie WF jest takie samo jak wersja zestawu.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-160">RuleSets in the .rules file do not have version numbers, because their versioning within a WF project is the same as the version of the assembly.</span></span> <span data-ttu-id="ad6ea-161">W trakcie procesu importowania narzędzie automatycznie przypisuje następny dostępny numer wersji głównej (który można zmienić po zaimportowaniu). numery przypisanych wersji są widoczne na liście **selektora zestawów reguł** .</span><span class="sxs-lookup"><span data-stu-id="ad6ea-161">During the importing process, the tool automatically assigns the next available major version number (which you can change after importing); you can see the assigned version numbers in the **RuleSet Selector** list.</span></span>

<span data-ttu-id="ad6ea-162">Dla każdego importowanego zestawu reguł Narzędzie próbuje zlokalizować skojarzony typ z folderu bin\Debug w lokalizacji pliku. rules (jeśli istnieje), na podstawie elementów członkowskich użytych w zestawie reguł.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-162">For each RuleSet it imports, the tool attempts to locate the associated type from the bin\Debug folder under the location of the .rules file (if it exists), based on the members used in the RuleSet.</span></span> <span data-ttu-id="ad6ea-163">Jeśli narzędzie znajdzie wiele pasujących typów, próbuje wybrać typ na podstawie dopasowania między nazwą pliku reguł a nazwą typu (na przykład typ `Workflow1` odpowiada Workflow1. Rules).</span><span class="sxs-lookup"><span data-stu-id="ad6ea-163">If the tool finds multiple matching types, it attempts to choose a type based on a match between the .rules file name and the type name (for example, the `Workflow1` type corresponds to Workflow1.rules).</span></span> <span data-ttu-id="ad6ea-164">W przypadku istnienia wielu dopasowań zostanie wyświetlony monit o wybranie typu.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-164">If multiple matches exist, you are prompted to select the type.</span></span> <span data-ttu-id="ad6ea-165">Jeśli ten mechanizm autoidentyfikacji nie będzie mógł zlokalizować zgodnego zestawu lub typu, po zaimportowaniu można kliknąć przycisk **Przeglądaj** w oknie dialogowym głównym narzędzia, aby przejść do odpowiedniego typu.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-165">If this auto-identification mechanism fails to locate a matching assembly or type, then after importing you can click **Browse** on the main tool dialog to navigate to the associated type.</span></span> <span data-ttu-id="ad6ea-166">Na poniższej ilustracji przedstawiono selektor zestawu reguł:</span><span class="sxs-lookup"><span data-stu-id="ad6ea-166">The following image shows the RuleSet Selector:</span></span>

![Zrzut ekranu przedstawiający okno dialogowe selektora zestawu reguł.](./media/external-ruleset-toolkit/ruleset-selector-dialog.gif)

<span data-ttu-id="ad6ea-168">Po kliknięciu przycisku **Eksportuj dane** z menu głównego narzędzia zostanie wyświetlone okno dialogowe **Selektor zestawu reguł** , w którym można określić zestaw reguł z bazy danych, która ma zostać wyeksportowana.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-168">When you click **Data-Export** from the main tool menu, the **RuleSet Selector** dialog appears again, from which you can determine the RuleSets from the database that should be exported.</span></span> <span data-ttu-id="ad6ea-169">Kliknięcie przycisku **OK**spowoduje wyświetlenie okna dialogowego **Zapisz plik** , w którym można określić nazwę i lokalizację pliku. reguł.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-169">When you click **OK**, a **Save File** dialog appears, in which you can specify the name and location of the resulting .rules file.</span></span> <span data-ttu-id="ad6ea-170">Ponieważ plik. rules nie zawiera informacji o wersji, można wybrać tylko jedną wersję zestawu reguł o danej nazwie.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-170">Because the .rules file does not contain version information, you can only select one RuleSet version with a given RuleSet name.</span></span>

## <a name="policyfromservice-activity"></a><span data-ttu-id="ad6ea-171">Działanie PolicyFromService</span><span class="sxs-lookup"><span data-stu-id="ad6ea-171">PolicyFromService Activity</span></span>

<span data-ttu-id="ad6ea-172">Kod działania `PolicyFromService` jest prosty.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-172">The code for the `PolicyFromService` activity is straightforward.</span></span> <span data-ttu-id="ad6ea-173">Działa podobnie jak działanie `Policy` dostarczone z WF, ale zamiast pobierania zestawu reguł docelowych z pliku reguł wywołuje usługę hosta, aby uzyskać wystąpienie zestawu reguł.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-173">It works much like the `Policy` activity provided with WF, but instead of retrieving the target RuleSet from the .rules file, it calls a host service to obtain the RuleSet instance.</span></span> <span data-ttu-id="ad6ea-174">Następnie uruchamia zestaw reguł w odniesieniu do głównego wystąpienia działania przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-174">It then runs the RuleSet against the root workflow activity instance.</span></span>

<span data-ttu-id="ad6ea-175">Aby użyć działania w przepływie pracy, Dodaj odwołanie do `PolicyActivities` i `RuleSetService` zestawów z projektu przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-175">To use the activity in a workflow, add a reference to the `PolicyActivities` and `RuleSetService` assemblies from your workflow project.</span></span> <span data-ttu-id="ad6ea-176">Zapoznaj się z procedurą na końcu tego tematu, aby zapoznać się z omówieniem dodawania działania do przybornika.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-176">See the procedure at the end of this topic for a discussion of how to add the activity to the toolbox.</span></span>

<span data-ttu-id="ad6ea-177">Po umieszczeniu działania w przepływie pracy należy podać nazwę zestawu reguł, który ma zostać uruchomiony.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-177">After placing the activity in your workflow, you must provide the name of the RuleSet to be run.</span></span> <span data-ttu-id="ad6ea-178">Możesz wprowadzić nazwę jako wartość literału lub powiązać ją z zmienną lub właściwością przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-178">You can enter the name as a literal value, or bind to a workflow variable or property of another activity.</span></span> <span data-ttu-id="ad6ea-179">Opcjonalnie możesz wprowadzić numery wersji dla określonego zestawu reguł, który ma zostać uruchomiony.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-179">Optionally, you can enter version numbers for the specific RuleSet that should be run.</span></span> <span data-ttu-id="ad6ea-180">Jeśli pozostawisz wartość domyślną 0 dla numerów wersji głównych i pomocniczych, numer najnowszej wersji w bazie danych zostanie automatycznie udostępniony dla działania.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-180">If you leave the default value of 0 for the major and minor version numbers, the latest version number in the database is automatically provided for the activity.</span></span>

## <a name="ruleset-service"></a><span data-ttu-id="ad6ea-181">Usługa zestawu reguł</span><span class="sxs-lookup"><span data-stu-id="ad6ea-181">RuleSet Service</span></span>

<span data-ttu-id="ad6ea-182">Usługa jest odpowiedzialna za pobranie określonej wersji zestawu reguł z bazy danych i zwrócenie jej do działania wywołującego.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-182">The service is responsible for retrieving the specified RuleSet version from the database and returning it to the calling activity.</span></span> <span data-ttu-id="ad6ea-183">Jak wspomniano wcześniej, jeśli wartości głównej i pomocniczej wersji przesłane w wywołaniu `GetRuleSet` są równe 0, usługa Pobiera najnowszą wersję.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-183">As previously discussed, if the major and minor version values passed in the `GetRuleSet` call are both 0, the service retrieves the latest version.</span></span> <span data-ttu-id="ad6ea-184">W tym momencie nie istnieje buforowanie definicji zestawu reguł ani wystąpień; Podobnie nie ma żadnych funkcji do oznaczania wersji zestawu reguł jako "wdrożone", aby odróżnić je od zestawów reguł w toku.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-184">At this point, there is no caching of RuleSet definitions or instances; similarly, there are no features for marking RuleSet versions as "deployed" to differentiate them from in-progress RuleSets.</span></span>

<span data-ttu-id="ad6ea-185">Baza danych, do której ma dostęp usługa, powinna być skonfigurowana na hoście przy użyciu pliku konfiguracji aplikacji.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-185">The database to be accessed by the service should be configured on the host using an application configuration file.</span></span>

#### <a name="to-run-the-tool"></a><span data-ttu-id="ad6ea-186">Aby uruchomić narzędzie</span><span class="sxs-lookup"><span data-stu-id="ad6ea-186">To run the tool</span></span>

1. <span data-ttu-id="ad6ea-187">Folder, który konfiguruje tabelę zestawu reguł użytą przez narzędzie, a usługa zawiera plik Setup. SQL.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-187">The folder that sets up the RuleSet table used by the tool and the service contains a Setup.sql file.</span></span> <span data-ttu-id="ad6ea-188">Można uruchomić plik wsadowy Setup. cmd, aby utworzyć bazę danych reguł w programie SQL Express i skonfigurować tabelę zestawu reguł.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-188">You can run the Setup.cmd batch file to create the Rules database on SQL Express and to set up the RuleSet table.</span></span>

2. <span data-ttu-id="ad6ea-189">Jeśli edytujesz plik wsadowy lub Setup. SQL i określisz, że nie użyjesz programu SQL Express lub umieścisz tabelę w bazie danych o nazwie innej niż `Rules`, pliki konfiguracyjne aplikacji w narzędziu zestawu reguł i projekty `UsageSample` powinny być edytowane przy użyciu tych samych informacji.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-189">If you edit the batch file or Setup.sql and specify not to use SQL Express or to place the table in a database named something other than `Rules`, the application configuration files in the RuleSet tool and `UsageSample` projects should be edited with the same information.</span></span>

3. <span data-ttu-id="ad6ea-190">Po uruchomieniu skryptu Setup. SQL można skompilować `ExternalRuleSetToolkit` rozwiązanie, a następnie uruchomić narzędzie zestawu reguł z projektu ExternalRuleSetTool.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-190">After you run the Setup.sql script, you can build the `ExternalRuleSetToolkit` solution and then launch the RuleSet tool from the ExternalRuleSetTool project.</span></span>

4. <span data-ttu-id="ad6ea-191">`RuleSetToolkitUsageSample` rozwiązanie aplikacji konsolowej sekwencyjnego przepływu pracy zawiera przykładowy przepływ pracy.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-191">The `RuleSetToolkitUsageSample` Sequential Workflow Console Application solution includes a sample workflow.</span></span> <span data-ttu-id="ad6ea-192">Przepływ pracy składa się z działania `PolicyFromService` i dwóch zmiennych, `orderValue` i `discount`, względem których jest uruchamiany docelowy zestaw reguł.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-192">The workflow consists of a `PolicyFromService` activity and two variables, `orderValue` and `discount`, against which the target RuleSet runs.</span></span>

5. <span data-ttu-id="ad6ea-193">Aby użyć przykładu, skompiluj rozwiązanie `RuleSetToolkitUsageSample`.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-193">To use the sample, build the `RuleSetToolkitUsageSample` solution.</span></span> <span data-ttu-id="ad6ea-194">Następnie w menu głównym narzędzia zestawu reguł kliknij pozycję **dane — Importuj** i wskaż plik DiscountRuleSet. rules w folderze RuleSetToolkitUsageSample.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-194">Then from the RuleSet tool main menu, click **Data-Import** and point to the DiscountRuleSet.rules file in the RuleSetToolkitUsageSample folder.</span></span> <span data-ttu-id="ad6ea-195">Kliknij opcję **Magazyn reguł — Zapisz** , aby zapisać zaimportowany zestaw reguł do bazy danych programu.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-195">Click the **Rule Store-Save** menu option to save the imported RuleSet to the database.</span></span>

6. <span data-ttu-id="ad6ea-196">Ponieważ zestaw `PolicyActivities` jest przywoływany z przykładowego projektu przepływu pracy, działanie `PolicyFromService` pojawia się w przepływie pracy.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-196">Because the `PolicyActivities` assembly is referenced from the sample workflow project, the `PolicyFromService` activity appears in the workflow.</span></span> <span data-ttu-id="ad6ea-197">Nie jest jednak domyślnie wyświetlana w przyborniku.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-197">It does not, however, appear in the toolbox by default.</span></span> <span data-ttu-id="ad6ea-198">Aby dodać go do przybornika, wykonaj następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="ad6ea-198">To add it to the toolbox, do the following:</span></span>

    - <span data-ttu-id="ad6ea-199">Kliknij prawym przyciskiem myszy Przybornik i wybierz pozycję **Wybierz elementy** (może to chwilę potrwać).</span><span class="sxs-lookup"><span data-stu-id="ad6ea-199">Right-click the toolbox and select **Choose Items** (this may take a while).</span></span>

    - <span data-ttu-id="ad6ea-200">Gdy zostanie wyświetlone okno dialogowe **Wybierz elementy przybornika** , kliknij kartę **działania** .</span><span class="sxs-lookup"><span data-stu-id="ad6ea-200">When the **Choose Toolbox Items** dialog appears, click the **Activities** tab.</span></span>

    - <span data-ttu-id="ad6ea-201">Przejdź do zestawu `PolicyActivities` w rozwiązaniu `ExternalRuleSetToolkit` i kliknij przycisk **Otwórz**.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-201">Browse to the `PolicyActivities` assembly in the `ExternalRuleSetToolkit` solution and click **Open**.</span></span>

    - <span data-ttu-id="ad6ea-202">Upewnij się, że działanie `PolicyFromService` zostało zaznaczone w oknie dialogowym **Wybierz elementy przybornika** , a następnie kliknij przycisk **OK**.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-202">Ensure that the `PolicyFromService` activity is selected in the **Choose Toolbox Items** dialog and then click **OK**.</span></span>

    - <span data-ttu-id="ad6ea-203">Działanie powinno teraz pojawić się w przyborniku w kategorii **składniki RuleSetToolkitUsageSample** .</span><span class="sxs-lookup"><span data-stu-id="ad6ea-203">The activity should now appear in the toolbox in the **RuleSetToolkitUsageSample Components** category.</span></span>

7. <span data-ttu-id="ad6ea-204">Usługa zestawu reguł jest już skonfigurowana na hoście aplikacji konsoli za pomocą następującej instrukcji w Program.cs.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-204">The RuleSet service is already configured on the console application host using the following statement in Program.cs.</span></span>

    ```csharp
    workflowRuntime.AddService(new RuleSetService());
    ```

8. <span data-ttu-id="ad6ea-205">Możesz również skonfigurować usługę na hoście przy użyciu pliku konfiguracji; Szczegółowe informacje znajdują się w dokumentacji zestawu SDK.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-205">You can also configure the service on the host using a configuration file; see the SDK documentation for details.</span></span>

9. <span data-ttu-id="ad6ea-206">Plik konfiguracji aplikacji zostanie dodany do projektu przepływu pracy, aby określić parametry połączenia dla bazy danych, która ma być używana przez usługę.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-206">An application configuration file is added to the workflow project to specify the connection string for the database to be used by the service.</span></span> <span data-ttu-id="ad6ea-207">Powinny to być te same parametry połączenia, które są używane przez narzędzie zestawu reguł, które wskazuje na bazę danych, która zawiera tabelę zestawu reguł.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-207">This should be the same connection string used by the RuleSet tool, which points to the database that contains the RuleSet table.</span></span>

10. <span data-ttu-id="ad6ea-208">Teraz można uruchomić projekt `RuleSetToolkitUsageSample` tak samo jak w przypadku każdej innej aplikacji konsolowej przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-208">You can now run the `RuleSetToolkitUsageSample` project as you would any other workflow console application.</span></span> <span data-ttu-id="ad6ea-209">Naciśnij klawisz F5 lub CTRL + F5 w programie Visual Studio lub Uruchom bezpośrednio plik RuleSetToolkitUsageSample. exe.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-209">Press F5 or Ctrl+F5 within Visual Studio or run the RuleSetToolkitUsageSample.exe file directly.</span></span>

    > [!NOTE]
    > <span data-ttu-id="ad6ea-210">Należy zamknąć narzędzie zestawu reguł, aby ponownie skompilować przykład użycia, ponieważ narzędzie ładuje przykładowy zestaw użycia.</span><span class="sxs-lookup"><span data-stu-id="ad6ea-210">You must close the RuleSet tool to recompile the usage sample, because the tool loads the usage sample assembly.</span></span>
