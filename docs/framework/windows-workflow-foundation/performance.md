---
title: Wydajność programu Windows Workflow Foundation 4
ms.date: 03/30/2017
ms.assetid: 67d2b3e8-3777-49f8-9084-abbb33b5a766
ms.openlocfilehash: 5fec41baacca0f35618dd5bc409b88ac792ad125
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/12/2020
ms.locfileid: "79182976"
---
# <a name="windows-workflow-foundation-4-performance"></a><span data-ttu-id="0ea63-102">Wydajność programu Windows Workflow Foundation 4</span><span class="sxs-lookup"><span data-stu-id="0ea63-102">Windows Workflow Foundation 4 Performance</span></span>

 <span data-ttu-id="0ea63-103">Program .NET Framework 4 zawiera dużą wersję programu Windows Workflow Foundation (WF) z dużymi inwestycjami w wydajność.</span><span class="sxs-lookup"><span data-stu-id="0ea63-103">.NET Framework 4 includes a major revision of the Windows Workflow Foundation (WF) with heavy investments in performance.</span></span> <span data-ttu-id="0ea63-104">Ta nowa wersja wprowadza istotne zmiany w [!INCLUDE[wf1](../../../includes/wf1-md.md)] projekcie z poprzednich wersji, które zostały dostarczone w ramach .NET Framework 3.0 i .NET Framework 3.5.</span><span class="sxs-lookup"><span data-stu-id="0ea63-104">This new revision introduces significant design changes from the previous versions of [!INCLUDE[wf1](../../../includes/wf1-md.md)] that shipped as part of .NET Framework 3.0 and .NET Framework 3.5.</span></span> <span data-ttu-id="0ea63-105">Został on ponownie zaprojektowany z rdzenia modelu programowania, środowiska uruchomieniowego i narzędzi, aby znacznie poprawić wydajność i użyteczność.</span><span class="sxs-lookup"><span data-stu-id="0ea63-105">It has been re-architected from the core of the programming model, runtime, and tooling to greatly improve performance and usability.</span></span> <span data-ttu-id="0ea63-106">W tym temacie przedstawiono ważne charakterystyki wydajności tych poprawek i porównuje je z tymi z poprzedniej wersji.</span><span class="sxs-lookup"><span data-stu-id="0ea63-106">This topic shows the important performance characteristics of these revisions and compares them against those of the previous version.</span></span>

 <span data-ttu-id="0ea63-107">Wydajność poszczególnych składników przepływu pracy wzrosła o rzędy wielkości między WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="0ea63-107">Individual workflow component performance has increased by orders of magnitude between WF3 and WF4.</span></span>  <span data-ttu-id="0ea63-108">Pozostawia to lukę między ręcznie kodowane usługi Windows Communication Foundation (WCF) i WCF usług przepływu pracy być dość małe.</span><span class="sxs-lookup"><span data-stu-id="0ea63-108">This leaves the gap between hand-coded Windows Communication Foundation (WCF) services and WCF workflow services to be quite small.</span></span>  <span data-ttu-id="0ea63-109">Opóźnienie przepływu pracy zostało znacznie zmniejszone w WF4.</span><span class="sxs-lookup"><span data-stu-id="0ea63-109">Workflow latency has been significantly reduced in WF4.</span></span>  <span data-ttu-id="0ea63-110">Wydajność trwałości wzrosła o współczynnik 2,5 - 3,0.</span><span class="sxs-lookup"><span data-stu-id="0ea63-110">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="0ea63-111">Monitorowanie kondycji za pomocą śledzenia przepływu pracy ma znacznie mniej narzutów.</span><span class="sxs-lookup"><span data-stu-id="0ea63-111">Health monitoring by means of workflow tracking has significantly less overhead.</span></span>  <span data-ttu-id="0ea63-112">Są to ważne powody, aby przeprowadzić migrację do lub przyjąć WF4 w aplikacjach.</span><span class="sxs-lookup"><span data-stu-id="0ea63-112">These are compelling reasons to migrate to or adopt WF4 in your applications.</span></span>

## <a name="terminology"></a><span data-ttu-id="0ea63-113">Terminologia</span><span class="sxs-lookup"><span data-stu-id="0ea63-113">Terminology</span></span>

 <span data-ttu-id="0ea63-114">Wersja [!INCLUDE[wf1](../../../includes/wf1-md.md)] wprowadzone w .NET Framework 4 będą określane jako WF4 dla pozostałej części tego tematu.</span><span class="sxs-lookup"><span data-stu-id="0ea63-114">The version of [!INCLUDE[wf1](../../../includes/wf1-md.md)] introduced in .NET Framework 4 will be referred to as WF4 for the rest of this topic.</span></span> [!INCLUDE[wf1](../../../includes/wf1-md.md)]<span data-ttu-id="0ea63-115">został wprowadzony w .NET Framework 3.0 i miał kilka drobnych wersji za pośrednictwem programu .NET Framework 3.5 SP1.</span><span class="sxs-lookup"><span data-stu-id="0ea63-115">was introduced in .NET Framework 3.0 and had a few minor revisions through .NET Framework 3.5 SP1.</span></span> <span data-ttu-id="0ea63-116">.NET Framework 3.5 wersja Workflow Foundation będzie określana jako WF3 dla pozostałej części tego tematu.</span><span class="sxs-lookup"><span data-stu-id="0ea63-116">The .NET Framework 3.5 version of Workflow Foundation will be referred to as WF3 for the rest of this topic.</span></span> <span data-ttu-id="0ea63-117">WF3 jest dostarczany w .NET Framework 4 side-by-side with WF4.</span><span class="sxs-lookup"><span data-stu-id="0ea63-117">WF3 is shipped in .NET Framework 4 side-by-side with WF4.</span></span> <span data-ttu-id="0ea63-118">Aby uzyskać więcej informacji na temat migracji artefaktów WF3 do WF4, zobacz: [Przewodnik migracji programu Windows Workflow Foundation 4](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="0ea63-118">For more information about migrating WF3 artifacts to WF4 see: [Windows Workflow Foundation 4 Migration Guide](migration-guidance.md).</span></span>

 <span data-ttu-id="0ea63-119">Windows Communication Foundation (WCF) to ujednolicony model programowania firmy Microsoft do tworzenia aplikacji zorientowanych na usługi.</span><span class="sxs-lookup"><span data-stu-id="0ea63-119">Windows Communication Foundation (WCF) is Microsoft’s unified programming model for building service-oriented applications.</span></span> <span data-ttu-id="0ea63-120">Po raz pierwszy został wprowadzony jako część .NET 3.0 wraz z WF3 i teraz jest jednym z kluczowych składników programu .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="0ea63-120">It was first introduced as part of .NET 3.0 together with WF3 and now is one of the key components of the .NET Framework.</span></span>

 <span data-ttu-id="0ea63-121">Windows Server AppFabric to zestaw zintegrowanych technologii, które ułatwiają tworzenie, skalowanie i zarządzanie aplikacjami sieci Web i złożonymi działającymi na usługach IIS.</span><span class="sxs-lookup"><span data-stu-id="0ea63-121">Windows Server AppFabric is a set of integrated technologies that make it easier to build, scale and manage Web and composite applications that run on IIS.</span></span> <span data-ttu-id="0ea63-122">Zapewnia narzędzia do monitorowania i zarządzania usługami i przepływami pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-122">It provides tools for monitoring and managing services and workflows.</span></span> <span data-ttu-id="0ea63-123">Aby uzyskać więcej informacji, zobacz [System Windows Server AppFabric 1.0](https://docs.microsoft.com/previous-versions/appfabric/ff384253(v=azure.10)).</span><span class="sxs-lookup"><span data-stu-id="0ea63-123">For more information, see [Windows Server AppFabric 1.0](https://docs.microsoft.com/previous-versions/appfabric/ff384253(v=azure.10)).</span></span>

## <a name="goals"></a><span data-ttu-id="0ea63-124">Cele</span><span class="sxs-lookup"><span data-stu-id="0ea63-124">Goals</span></span>
 <span data-ttu-id="0ea63-125">Celem tego tematu jest pokazanie charakterystyki wydajności WF4 z danymi mierzonymi dla różnych scenariuszy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-125">The goal of this topic is to show the performance characteristics of WF4 with data measured for different scenarios.</span></span> <span data-ttu-id="0ea63-126">Zapewnia również szczegółowe porównania między WF4 i WF3, a tym samym pokazuje wielkie ulepszenia, które zostały wprowadzone w tej nowej wersji.</span><span class="sxs-lookup"><span data-stu-id="0ea63-126">It also provides detailed comparisons between WF4 and WF3, and thus shows the great improvements that have been made in this new revision.</span></span> <span data-ttu-id="0ea63-127">Scenariusze i dane przedstawione w tym artykule kwantyfikują podstawowy koszt różnych aspektów WF4 i WF3.</span><span class="sxs-lookup"><span data-stu-id="0ea63-127">The scenarios and data presented in this article quantify the underlying cost of different aspects of WF4 and WF3.</span></span> <span data-ttu-id="0ea63-128">Te dane są przydatne w zrozumieniu charakterystyki wydajności WF4 i mogą być pomocne w planowaniu migracji z WF3 do WF4 lub przy użyciu WF4 w tworzeniu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="0ea63-128">This data is useful in understanding the performance characteristics of WF4 and can be helpful in planning migrations from WF3 to WF4 or using WF4 in application development.</span></span> <span data-ttu-id="0ea63-129">Należy jednak zwrócić uwagę na wnioski wyciągnięte z danych przedstawionych w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="0ea63-129">However, care should be taken in the conclusions drawn from the data presented in this article.</span></span> <span data-ttu-id="0ea63-130">Wydajność złożonej aplikacji przepływu pracy jest w dużym stopniu zależna od sposobu implementacji przepływu pracy i sposobu integracji różnych składników.</span><span class="sxs-lookup"><span data-stu-id="0ea63-130">The performance of a composite workflow application is highly dependent on how the workflow is implemented and how different components are integrated.</span></span> <span data-ttu-id="0ea63-131">Należy zmierzyć każdą aplikację w celu określenia właściwości wydajności tej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="0ea63-131">One must measure each application to determine the performance characteristics of that application.</span></span>

## <a name="overview-of-wf4-performance-enhancements"></a><span data-ttu-id="0ea63-132">Omówienie ulepszeń wydajności WF4</span><span class="sxs-lookup"><span data-stu-id="0ea63-132">Overview of WF4 Performance Enhancements</span></span>
 <span data-ttu-id="0ea63-133">WF4 został starannie zaprojektowany i wdrożony z wysoką wydajnością i skalowalnością, które są opisane w poniższych sekcjach.</span><span class="sxs-lookup"><span data-stu-id="0ea63-133">WF4 was carefully designed and implemented with high performance and scalability which are described in the following sections.</span></span>

### <a name="wf-runtime"></a><span data-ttu-id="0ea63-134">WF Środowisko uruchomieniowe</span><span class="sxs-lookup"><span data-stu-id="0ea63-134">WF Runtime</span></span>
 <span data-ttu-id="0ea63-135">W rdzeniu [!INCLUDE[wf1](../../../includes/wf1-md.md)] środowiska wykonawczego jest harmonogram asynchroniczne, który napędza wykonywanie działań w przepływie pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-135">At the core of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime is an asynchronous scheduler that drives the execution of the activities in a workflow.</span></span> <span data-ttu-id="0ea63-136">Zapewnia wydajne, przewidywalne środowisko wykonywania dla działań.</span><span class="sxs-lookup"><span data-stu-id="0ea63-136">It provides a performant, predictable execution environment for activities.</span></span> <span data-ttu-id="0ea63-137">Środowisko ma dobrze zdefiniowany kontrakt na wykonanie, kontynuację, ukończenie, anulowanie, wyjątki i przewidywalny model wątków.</span><span class="sxs-lookup"><span data-stu-id="0ea63-137">The environment has a well-defined contract for execution, continuation, completion, cancellation, exceptions, and a predictable threading model.</span></span>

 <span data-ttu-id="0ea63-138">W porównaniu do WF3 środowiska uruchomieniowego WF4 ma bardziej wydajny harmonogram.</span><span class="sxs-lookup"><span data-stu-id="0ea63-138">In comparison to WF3, the WF4 runtime has a more efficient scheduler.</span></span> <span data-ttu-id="0ea63-139">Wykorzystuje tę samą pulę wątków we/wy, która jest używana dla WCF, która jest bardzo wydajna w wykonywaniu wsadowych elementów roboczych.</span><span class="sxs-lookup"><span data-stu-id="0ea63-139">It leverages the same I/O thread pool that is used for WCF, which is very efficient at executing batched work items.</span></span> <span data-ttu-id="0ea63-140">Wewnętrzna kolejka harmonogramu elementów roboczych jest zoptymalizowana pod kątem większości typowych wzorców użycia.</span><span class="sxs-lookup"><span data-stu-id="0ea63-140">The internal work item scheduler queue is optimized for most common usage patterns.</span></span> <span data-ttu-id="0ea63-141">Środowisko uruchomieniowe WF4 zarządza również stany wykonywania w sposób bardzo lekki z minimalną synchronizacji i logiki obsługi zdarzeń, podczas gdy WF3 zależy od rejestracji zdarzeń wagi wagi i wywołania do wykonywania złożonej synchronizacji dla przejść stanu.</span><span class="sxs-lookup"><span data-stu-id="0ea63-141">The WF4 runtime also manages the execution states in a very lightweight way with minimal synchronization and event handling logic, while WF3 depends on heavy-weight event registration and invocation to perform complex synchronization for state transitions.</span></span>

### <a name="data-storage-and-flow"></a><span data-ttu-id="0ea63-142">Przechowywanie i przepływ danych</span><span class="sxs-lookup"><span data-stu-id="0ea63-142">Data Storage and Flow</span></span>
 <span data-ttu-id="0ea63-143">W WF3 dane skojarzone z działaniem są modelowane za pomocą <xref:System.Windows.DependencyProperty>właściwości zależności implementowanych przez typ .</span><span class="sxs-lookup"><span data-stu-id="0ea63-143">In WF3, data associated with an activity is modeled through dependency properties implemented by the type <xref:System.Windows.DependencyProperty>.</span></span> <span data-ttu-id="0ea63-144">Wzorzec właściwości zależności został wprowadzony w programie Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="0ea63-144">The dependency property pattern was introduced in Windows Presentation Foundation (WPF).</span></span> <span data-ttu-id="0ea63-145">Ogólnie rzecz biorąc ten wzorzec jest bardzo elastyczny do obsługi łatwego wiązania danych i innych funkcji interfejsu użytkownika.</span><span class="sxs-lookup"><span data-stu-id="0ea63-145">In general, this pattern is very flexible to support easy data binding and other UI features.</span></span> <span data-ttu-id="0ea63-146">Jednak wzorzec wymaga właściwości, które mają być zdefiniowane jako pola statyczne w definicji przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-146">However, the pattern requires the properties to be defined as static fields in the workflow definition.</span></span> <span data-ttu-id="0ea63-147">Ilekroć [!INCLUDE[wf1](../../../includes/wf1-md.md)] środowisko uruchomieniowe ustawia lub pobiera wartości właściwości, obejmuje mocno ważone logiki wyszukiwania.</span><span class="sxs-lookup"><span data-stu-id="0ea63-147">Whenever the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime sets or gets the property values, it involves heavily-weighted look-up logic.</span></span>

 <span data-ttu-id="0ea63-148">WF4 używa logiki określania zakresu danych, aby znacznie poprawić sposób obsługi danych w przepływie pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-148">WF4 uses clear data scoping logic to greatly improve how data is handled in a workflow.</span></span> <span data-ttu-id="0ea63-149">Oddziela dane przechowywane w działaniu od danych, które przepływa przez granice działania przy użyciu dwóch różnych pojęć: zmienne i argumenty.</span><span class="sxs-lookup"><span data-stu-id="0ea63-149">It separates the data stored in an activity from the data that is flowing across the activity boundaries by using two different concepts: variables and arguments.</span></span> <span data-ttu-id="0ea63-150">Za pomocą jasnego zakresu hierarchicznego dla zmiennych i "W/Out/InOut" argumenty, złożoność użycia danych dla działań jest znacznie zmniejszona i okres istnienia danych jest również automatycznie zakres.</span><span class="sxs-lookup"><span data-stu-id="0ea63-150">By using a clear hierarchical scope for variables and "In/Out/InOut" arguments, the data usage complexity for activities is dramatically reduced and the lifetime of the data is also automatically scoped.</span></span> <span data-ttu-id="0ea63-151">Działania mają dobrze zdefiniowany podpis opisany przez jego argumenty.</span><span class="sxs-lookup"><span data-stu-id="0ea63-151">Activities have a well-defined signature described by its arguments.</span></span> <span data-ttu-id="0ea63-152">Po prostu sprawdzając działanie można określić, jakie dane oczekuje się otrzymać i jakie dane będą produkowane przez niego w wyniku jego wykonania.</span><span class="sxs-lookup"><span data-stu-id="0ea63-152">By simply inspecting an activity you can determine what data it expects to receive and what data will be produced by it as the result of its execution.</span></span>

 <span data-ttu-id="0ea63-153">W WF3 działania zostały zainicjowane podczas tworzenia przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-153">In WF3 activities were initialized when a workflow was created.</span></span> <span data-ttu-id="0ea63-154">W WF 4 działania są inicjowane tylko wtedy, gdy wykonywane są odpowiednie działania.</span><span class="sxs-lookup"><span data-stu-id="0ea63-154">In WF 4 activities are initialized only when the corresponding activities are executing.</span></span> <span data-ttu-id="0ea63-155">Pozwala to na prostszy cykl życia działania bez wykonywania operacji Inicjowanie/Uninitialize podczas tworzenia nowego wystąpienia przepływu pracy, a tym samym osiągnięto większą wydajność</span><span class="sxs-lookup"><span data-stu-id="0ea63-155">This allows a simpler activity lifecycle without performing Initialize/Uninitialize operations when a new workflow instance is created, and thus has achieved more efficiency</span></span>

### <a name="control-flow"></a><span data-ttu-id="0ea63-156">Przepływ sterowania</span><span class="sxs-lookup"><span data-stu-id="0ea63-156">Control Flow</span></span>
 <span data-ttu-id="0ea63-157">Podobnie jak w każdym [!INCLUDE[wf1](../../../includes/wf1-md.md)] języku programowania, zapewnia obsługę przepływów sterowania dla definicji przepływu pracy, wprowadzając zestaw działań przepływu sterowania do sekwencjonowania, pętli, rozgałęzienia i innych wzorców.</span><span class="sxs-lookup"><span data-stu-id="0ea63-157">Just as in any programming language, [!INCLUDE[wf1](../../../includes/wf1-md.md)] provides support for control flows for workflow definitions by introducing a set of control flow activities for sequencing, looping, branching and other patterns.</span></span> <span data-ttu-id="0ea63-158">W WF3, gdy to samo działanie musi zostać <xref:System.Workflow.ComponentModel.ActivityExecutionContext> ponownie wykonane, tworzona jest nowa, a działanie jest klonowane za pomocą logiki serializacji i deserializacji o dużej wadze opartej na <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>.</span><span class="sxs-lookup"><span data-stu-id="0ea63-158">In WF3, when the same activity needs to be re-executed, a new <xref:System.Workflow.ComponentModel.ActivityExecutionContext> is created and the activity is cloned through a heavy-weight serialization and deserialization logic based on <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>.</span></span> <span data-ttu-id="0ea63-159">Zazwyczaj wydajność przepływów kontroli iteracyjnej jest znacznie wolniejszy niż wykonywanie sekwencji działań.</span><span class="sxs-lookup"><span data-stu-id="0ea63-159">Usually the performance for iterative control flows is much slower than executing a sequence of activities.</span></span>

 <span data-ttu-id="0ea63-160">WF4 radzi sobie z tym zupełnie inaczej.</span><span class="sxs-lookup"><span data-stu-id="0ea63-160">WF4 handles this quite differently.</span></span> <span data-ttu-id="0ea63-161">Przyjmuje szablon działania, tworzy nowy obiekt ActivityInstance i dodaje go do kolejki harmonogramu.</span><span class="sxs-lookup"><span data-stu-id="0ea63-161">It takes the activity template, creates a new ActivityInstance object, and adds it to the scheduler queue.</span></span> <span data-ttu-id="0ea63-162">Cały ten proces obejmuje tylko jawne tworzenie obiektów i jest bardzo lekki.</span><span class="sxs-lookup"><span data-stu-id="0ea63-162">This whole process only involves explicit object creation and is very lightweight.</span></span>

### <a name="asynchronous-programming"></a><span data-ttu-id="0ea63-163">Programowanie asynchroniczne</span><span class="sxs-lookup"><span data-stu-id="0ea63-163">Asynchronous Programming</span></span>
 <span data-ttu-id="0ea63-164">Aplikacje mają zwykle lepszą wydajność i skalowalność dzięki programowaniu asynchroniiowemu dla długotrwałych operacji blokowania, takich jak operacje we/wy lub rozproszone operacje obliczeniowe.</span><span class="sxs-lookup"><span data-stu-id="0ea63-164">Applications usually have better performance and scalability with asynchronous programming for long running blocking operations such as I/O or distributed computing operations.</span></span> <span data-ttu-id="0ea63-165">WF4 zapewnia asynchroniiową obsługę <xref:System.Activities.AsyncCodeActivity> <xref:System.Activities.AsyncCodeActivity%601>za pośrednictwem podstawowych typów aktywności , .</span><span class="sxs-lookup"><span data-stu-id="0ea63-165">WF4 provides asynchronous support through base activity types <xref:System.Activities.AsyncCodeActivity>, <xref:System.Activities.AsyncCodeActivity%601>.</span></span> <span data-ttu-id="0ea63-166">Środowisko uruchomieniowe natywnie rozumie działania asynchroniczne i dlatego można automatycznie umieścić wystąpienie w strefie no-persist, gdy praca asynchronicznie jest zaległe.</span><span class="sxs-lookup"><span data-stu-id="0ea63-166">The runtime natively understands asynchronous activities and therefore can automatically put the instance in a no-persist zone while the asynchronous work is outstanding.</span></span> <span data-ttu-id="0ea63-167">Działania niestandardowe mogą pochodzić z tych typów do wykonywania pracy asynchroniiowej bez przytrzymywać wątku harmonogramu przepływu pracy i blokowanie wszelkich działań, które mogą być w stanie uruchomić równolegle.</span><span class="sxs-lookup"><span data-stu-id="0ea63-167">Custom activities can derive from these types to perform asynchronous work without holding the workflow scheduler thread and blocking any activities that may be able to run in parallel.</span></span>

### <a name="messaging"></a><span data-ttu-id="0ea63-168">Obsługa komunikatów</span><span class="sxs-lookup"><span data-stu-id="0ea63-168">Messaging</span></span>
 <span data-ttu-id="0ea63-169">Początkowo WF3 miał bardzo ograniczoną obsługę obsługi wiadomości za pośrednictwem zdarzeń zewnętrznych lub wywołań usług sieci web.</span><span class="sxs-lookup"><span data-stu-id="0ea63-169">Initially WF3 had very limited messaging support through external events or web services invocations.</span></span> <span data-ttu-id="0ea63-170">W .NET 3.5 przepływy pracy mogą być implementowane jako klienci WCF lub udostępniane jako usługi WCF za pośrednictwem <xref:System.Workflow.Activities.SendActivity> i <xref:System.Workflow.Activities.ReceiveActivity>.</span><span class="sxs-lookup"><span data-stu-id="0ea63-170">In .NET 3.5, workflows could be implemented as WCF clients or exposed as WCF services through <xref:System.Workflow.Activities.SendActivity> and <xref:System.Workflow.Activities.ReceiveActivity>.</span></span> <span data-ttu-id="0ea63-171">W WF4 koncepcja programowania wiadomości opartych na przepływie pracy została dodatkowo wzmocniona poprzez ścisłą integrację logiki obsługi wiadomości WCF z WF.</span><span class="sxs-lookup"><span data-stu-id="0ea63-171">In WF4, the concept of workflow-based messaging programming has been further strengthened through the tight integration of WCF messaging logic into WF.</span></span>

 <span data-ttu-id="0ea63-172">Ujednolicony potok przetwarzania wiadomości dostarczony w WCF w .NET 4 pomaga usługom WF4 mieć znacznie lepszą wydajność i skalowalność niż WF3.</span><span class="sxs-lookup"><span data-stu-id="0ea63-172">The unified message processing pipeline provided in WCF in .NET 4 helps WF4 services to have significantly better performance and scalability than WF3.</span></span> <span data-ttu-id="0ea63-173">WF4 also provides richer messaging programming support that can model complex Message Exchange Patterns (MEPs).</span><span class="sxs-lookup"><span data-stu-id="0ea63-173">WF4 also provides richer messaging programming support that can model complex Message Exchange Patterns (MEPs).</span></span> <span data-ttu-id="0ea63-174">Deweloperzy mogą używać wpisanych umów serwisowych w celu uzyskania łatwego programowania lub nieokreślonych umów serwisowych w celu uzyskania lepszej wydajności bez płacenia kosztów serializacji.</span><span class="sxs-lookup"><span data-stu-id="0ea63-174">Developers can use either typed service contracts to achieve easy programming or un-typed service contracts to achieve better performance without paying serialization costs.</span></span> <span data-ttu-id="0ea63-175">Obsługa buforowania kanału po stronie <xref:System.ServiceModel.Activities.SendMessageChannelCache> klienta za pośrednictwem klasy w WF4 pomaga deweloperom tworzyć szybkie aplikacje przy minimalnym wysiłku.</span><span class="sxs-lookup"><span data-stu-id="0ea63-175">The client-side channel caching support through the <xref:System.ServiceModel.Activities.SendMessageChannelCache> class in WF4 helps developers build fast applications with minimal effort.</span></span> <span data-ttu-id="0ea63-176">Aby uzyskać więcej informacji, zobacz [Zmienianie poziomów udostępniania pamięci podręcznej dla działań wysyłania](../wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span><span class="sxs-lookup"><span data-stu-id="0ea63-176">For more information, see [Changing the Cache Sharing Levels for Send Activities](../wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span></span>

### <a name="declarative-programming"></a><span data-ttu-id="0ea63-177">Programowanie deklaratywne</span><span class="sxs-lookup"><span data-stu-id="0ea63-177">Declarative Programming</span></span>
 <span data-ttu-id="0ea63-178">WF4 zapewnia czyste i proste deklaratywne ramy programowania do modelowania procesów biznesowych i usług.</span><span class="sxs-lookup"><span data-stu-id="0ea63-178">WF4 provides a clean and simple declarative programming framework to model business processes and services.</span></span> <span data-ttu-id="0ea63-179">Model programowania obsługuje w pełni deklaratywny skład działań, bez kodu obok, znacznie upraszczając tworzenie przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-179">The programming model supports fully declarative composition of activities, with no code-beside, greatly simplifying workflow authoring.</span></span> <span data-ttu-id="0ea63-180">W programie .NET Framework 4 deklaratywna struktura programowania oparta na języku XAML została zunifikowana w pojedynczym zestawie System.Xaml.dll w celu obsługi zarówno WPF, jak i WF.</span><span class="sxs-lookup"><span data-stu-id="0ea63-180">In .NET Framework 4, the XAML-based declarative programming framework has been unified into the single assembly System.Xaml.dll to support both WPF and WF.</span></span>

 <span data-ttu-id="0ea63-181">W WF4 XAML zapewnia prawdziwie deklaratywne środowisko i umożliwia zdefiniowanie całej definicji przepływu pracy w znacznikach XML, odwołując się do działań i typów utworzonych przy użyciu platformy .NET.</span><span class="sxs-lookup"><span data-stu-id="0ea63-181">In WF4, XAML provides a truly declarative experience and allows for the entire definition of the workflow to be defined in XML markup, referencing activities and types built using .NET.</span></span> <span data-ttu-id="0ea63-182">Było to trudne do zrobienia w WF3 w formacie XOML bez angażowania niestandardowej logiki związanej z kodem.</span><span class="sxs-lookup"><span data-stu-id="0ea63-182">This was difficult to do in WF3 with XOML format without involving custom code-behind logic.</span></span> <span data-ttu-id="0ea63-183">Nowy stos XAML w .NET 4 ma znacznie lepszą wydajność w serializacji/deserializacji artefaktów przepływu pracy i sprawia, że programowanie deklaratywne jest bardziej atrakcyjne i stałe.</span><span class="sxs-lookup"><span data-stu-id="0ea63-183">The new XAML-stack in .NET 4 has much better performance in serializing/deserializing workflow artifacts and makes declarative programming more attractive and solid.</span></span>

### <a name="workflow-designer"></a><span data-ttu-id="0ea63-184">Projektant przepływów pracy</span><span class="sxs-lookup"><span data-stu-id="0ea63-184">Workflow Designer</span></span>
 <span data-ttu-id="0ea63-185">W pełni deklaratywna obsługa programowania dla WF4 jawnie nakłada wyższe wymagania dotyczące wydajności czasu projektowania dla dużych przepływów pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-185">Fully declarative programming support for WF4 explicitly imposes higher requirements for design time performance for large workflows.</span></span> <span data-ttu-id="0ea63-186">Projektant przepływu pracy w WF4 ma znacznie lepszą skalowalność dla dużych przepływów pracy niż dla WF3.</span><span class="sxs-lookup"><span data-stu-id="0ea63-186">The Workflow designer in WF4 has much better scalability for large workflows than that for WF3.</span></span> <span data-ttu-id="0ea63-187">Dzięki obsłudze wirtualizacji interfejsu użytkownika projektant może łatwo załadować duży przepływ pracy 1000 działań w ciągu kilku sekund, podczas gdy prawie niemożliwe jest załadowanie przepływu pracy kilkuset działań z projektantem WF3.</span><span class="sxs-lookup"><span data-stu-id="0ea63-187">With UI virtualization support, the designer can easily load a large workflow of 1000 activities in a few seconds, while it is almost impossible to load a workflow of a few hundred activities with the WF3 designer.</span></span>

## <a name="component-level-performance-comparisons"></a><span data-ttu-id="0ea63-188">Porównania wydajności na poziomie komponentu</span><span class="sxs-lookup"><span data-stu-id="0ea63-188">Component-level Performance Comparisons</span></span>
 <span data-ttu-id="0ea63-189">Ta sekcja zawiera dane dotyczące bezpośrednich porównań między poszczególnymi działaniami w przepływach pracy WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="0ea63-189">This section contains data on direct comparisons between individual activities in WF3 and WF4 workflows.</span></span>  <span data-ttu-id="0ea63-190">Kluczowe obszary, takie jak trwałość mają głębszy wpływ na wydajność niż poszczególne składniki działania.</span><span class="sxs-lookup"><span data-stu-id="0ea63-190">Key areas like persistence have a more profound impact on performance than the individual activity components.</span></span>  <span data-ttu-id="0ea63-191">Ulepszenia wydajności w poszczególnych składników w WF4 są jednak ważne, ponieważ składniki są teraz wystarczająco szybko, aby można porównać z ręcznie kodowane logiki aranżacji.</span><span class="sxs-lookup"><span data-stu-id="0ea63-191">The performance improvements in individual components in WF4 are important though because the components are now fast enough to be compared against hand-coded orchestration logic.</span></span>  <span data-ttu-id="0ea63-192">Przykład, który jest omówiony w następnej sekcji: "Scenariusz składu usługi."</span><span class="sxs-lookup"><span data-stu-id="0ea63-192">An example of which is covered in the next section: "Service Composition Scenario."</span></span>

### <a name="environment-setup"></a><span data-ttu-id="0ea63-193">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="0ea63-193">Environment Setup</span></span>
 ![Konfiguracja środowiska do pomiaru wydajności przepływu pracy](./media/performance/performance-test-environment.gif)

 <span data-ttu-id="0ea63-195">Powyższy rysunek przedstawia konfigurację maszyny używaną do pomiaru wydajności na poziomie komponentu.</span><span class="sxs-lookup"><span data-stu-id="0ea63-195">The above figure shows the machine configuration used for component-level performance measurement.</span></span> <span data-ttu-id="0ea63-196">Jeden serwer i pięciu klientów połączonych za pośrednictwem jednego interfejsu sieciowego Ethernet 1 Gb/s.</span><span class="sxs-lookup"><span data-stu-id="0ea63-196">A single server and five clients connected over one 1-Gbps Ethernet network interface.</span></span> <span data-ttu-id="0ea63-197">W celu łatwego pomiaru serwer jest skonfigurowany do używania pojedynczego rdzenia serwera dwu-proc/czterordzeniowego z systemem Windows Server 2008 x86.</span><span class="sxs-lookup"><span data-stu-id="0ea63-197">For easy measurements, the server is configured to use a single core of a dual-proc/quad-core server  running Windows Server 2008 x86.</span></span> <span data-ttu-id="0ea63-198">Wykorzystanie procesora systemowego jest utrzymywane na poziomie prawie 100%.</span><span class="sxs-lookup"><span data-stu-id="0ea63-198">The system CPU utilization is maintained at nearly 100%.</span></span>

### <a name="test-details"></a><span data-ttu-id="0ea63-199">Szczegóły testu</span><span class="sxs-lookup"><span data-stu-id="0ea63-199">Test Details</span></span>
 <span data-ttu-id="0ea63-200">WF3 <xref:System.Workflow.Activities.CodeActivity> jest prawdopodobnie najprostszym działaniem, które mogą być używane w przepływie pracy WF3.</span><span class="sxs-lookup"><span data-stu-id="0ea63-200">The WF3 <xref:System.Workflow.Activities.CodeActivity> is likely the simplest activity that can be used in a WF3 workflow.</span></span>  <span data-ttu-id="0ea63-201">Działanie wywołuje metodę w kodzie, do których programista przepływu pracy może umieścić kod niestandardowy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-201">The activity calls a method in the code-behind that the workflow programmer can put custom code into.</span></span>  <span data-ttu-id="0ea63-202">W WF4 nie ma bezpośredniego analogu <xref:System.Workflow.Activities.CodeActivity> do WF3, który zapewnia taką samą funkcjonalność.</span><span class="sxs-lookup"><span data-stu-id="0ea63-202">In WF4, there is no direct analog to the WF3 <xref:System.Workflow.Activities.CodeActivity> that provides the same functionality.</span></span>  <span data-ttu-id="0ea63-203">Należy zauważyć, <xref:System.Activities.CodeActivity> że istnieje klasa podstawowa w WF4, <xref:System.Workflow.Activities.CodeActivity>która nie jest związana z WF3 .</span><span class="sxs-lookup"><span data-stu-id="0ea63-203">Note that there is a <xref:System.Activities.CodeActivity> base class in WF4 that is not related to the WF3 <xref:System.Workflow.Activities.CodeActivity>.</span></span>  <span data-ttu-id="0ea63-204">Autorzy przepływu pracy są zachęcani do tworzenia działań niestandardowych i tworzenia przepływów pracy tylko XAML.</span><span class="sxs-lookup"><span data-stu-id="0ea63-204">Workflow authors are encouraged to create custom activities and build XAML-only workflows.</span></span>  <span data-ttu-id="0ea63-205">W poniższych testach `Comment` działanie wywoływane jest <xref:System.Workflow.Activities.CodeActivity> używane zamiast pustego w przepływach pracy WF4.</span><span class="sxs-lookup"><span data-stu-id="0ea63-205">In the tests below, an activity called `Comment` is used in place of an empty <xref:System.Workflow.Activities.CodeActivity> in WF4 workflows.</span></span>  <span data-ttu-id="0ea63-206">Kod w `Comment` działaniu jest następujący:</span><span class="sxs-lookup"><span data-stu-id="0ea63-206">The code in the `Comment` activity is as follows:</span></span>

```csharp
[ContentProperty("Body")]
    public sealed class Comment : CodeActivity
    {
        public Comment()
            : base()
        {
        }

        [DefaultValue(null)]
        public Activity Body
        {
            get;
            set;
        }

        protected override void Execute(CodeActivityContext context)
        {
        }
    }
```

### <a name="empty-workflow"></a><span data-ttu-id="0ea63-207">Pusty przepływ pracy</span><span class="sxs-lookup"><span data-stu-id="0ea63-207">Empty Workflow</span></span>
 <span data-ttu-id="0ea63-208">Ten test używa przepływu pracy sekwencji bez działań podrzędnych.</span><span class="sxs-lookup"><span data-stu-id="0ea63-208">This test uses a sequence workflow with no child activities.</span></span>

### <a name="single-activity"></a><span data-ttu-id="0ea63-209">Pojedyncze działanie</span><span class="sxs-lookup"><span data-stu-id="0ea63-209">Single Activity</span></span>
 <span data-ttu-id="0ea63-210">Przepływ pracy jest przepływem pracy sekwencji zawierającym jedno działanie podrzędne.</span><span class="sxs-lookup"><span data-stu-id="0ea63-210">The workflow is a sequence workflow containing one child activity.</span></span>  <span data-ttu-id="0ea63-211">Działanie jest <xref:System.Workflow.Activities.CodeActivity> bez kodu w przypadku WF3 `Comment` i działania w przypadku WF4.</span><span class="sxs-lookup"><span data-stu-id="0ea63-211">The activity is a <xref:System.Workflow.Activities.CodeActivity> with no code in the WF3 case and a `Comment` activity in the WF4 case.</span></span>

### <a name="while-with-1000-iterations"></a><span data-ttu-id="0ea63-212">Podczas gdy z 1000 iteracje</span><span class="sxs-lookup"><span data-stu-id="0ea63-212">While with 1000 Iterations</span></span>
 <span data-ttu-id="0ea63-213">Przepływ pracy sekwencji <xref:System.Activities.Statements.While> zawiera jedno działanie z jednym działaniem podrzędnym w pętli, która nie wykonuje żadnej pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-213">The sequence workflow contains one <xref:System.Activities.Statements.While> activity with one child activity in the loop that does not perform any work.</span></span>

### <a name="replicator-compared-to-parallelforeach"></a><span data-ttu-id="0ea63-214">Replikator w porównaniu z ParallelForEach</span><span class="sxs-lookup"><span data-stu-id="0ea63-214">Replicator compared to ParallelForEach</span></span>
 <span data-ttu-id="0ea63-215"><xref:System.Workflow.Activities.ReplicatorActivity>w WF3 ma tryby wykonywania sekwencyjnego i równoległego.</span><span class="sxs-lookup"><span data-stu-id="0ea63-215"><xref:System.Workflow.Activities.ReplicatorActivity> in WF3 has sequential and parallel execution modes.</span></span>  <span data-ttu-id="0ea63-216">W trybie sekwencyjnym wydajność działania jest <xref:System.Workflow.Activities.WhileActivity>podobna do .</span><span class="sxs-lookup"><span data-stu-id="0ea63-216">In sequential mode, the activity’s performance is similar to the <xref:System.Workflow.Activities.WhileActivity>.</span></span>  <span data-ttu-id="0ea63-217">Jest <xref:System.Workflow.Activities.ReplicatorActivity> najbardziej przydatne do wykonywania równoległego.</span><span class="sxs-lookup"><span data-stu-id="0ea63-217">The <xref:System.Workflow.Activities.ReplicatorActivity> is most useful for parallel execution.</span></span>  <span data-ttu-id="0ea63-218">Analog WF4 do tego <xref:System.Activities.Statements.ParallelForEach%601> jest działanie.</span><span class="sxs-lookup"><span data-stu-id="0ea63-218">The WF4 analog for this is the <xref:System.Activities.Statements.ParallelForEach%601> activity.</span></span>

 <span data-ttu-id="0ea63-219">Na poniższym diagramie przedstawiono przepływy pracy używane dla tego testu.</span><span class="sxs-lookup"><span data-stu-id="0ea63-219">The following diagram shows the workflows used for this test.</span></span> <span data-ttu-id="0ea63-220">Przepływ pracy WF3 znajduje się po lewej stronie, a przepływ pracy WF4 znajduje się po prawej stronie.</span><span class="sxs-lookup"><span data-stu-id="0ea63-220">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>

 ![WF3 ReplicatorActivity i WF4 ParallelForEach](./media/performance/replicator-parallel-wf3-wf4.gif)

### <a name="sequential-workflow-with-five-activities"></a><span data-ttu-id="0ea63-222">Sekwencyjny przepływ pracy z pięcioma działaniami</span><span class="sxs-lookup"><span data-stu-id="0ea63-222">Sequential Workflow with Five Activities</span></span>
 <span data-ttu-id="0ea63-223">Ten test ma na celu pokazanie efektu wykonywania kilku działań w sekwencji.</span><span class="sxs-lookup"><span data-stu-id="0ea63-223">This test is meant to show the effect of having several activities execute in sequence.</span></span>  <span data-ttu-id="0ea63-224">Istnieje pięć działań w sekwencji.</span><span class="sxs-lookup"><span data-stu-id="0ea63-224">There are five activities in the sequence.</span></span>

### <a name="transaction-scope"></a><span data-ttu-id="0ea63-225">Zakres transakcji</span><span class="sxs-lookup"><span data-stu-id="0ea63-225">Transaction Scope</span></span>
 <span data-ttu-id="0ea63-226">Test zakresu transakcji różni się nieco od innych testów tym, że nowe wystąpienie przepływu pracy nie jest tworzone dla każdej iteracji.</span><span class="sxs-lookup"><span data-stu-id="0ea63-226">The transaction scope test differs from the other tests slightly in that a new workflow instance is not created for every iteration.</span></span>  <span data-ttu-id="0ea63-227">Zamiast tego przepływ pracy jest skonstruowany z while <xref:System.Activities.Statements.TransactionScope> pętli zawierającej działanie zawierające pojedyncze działanie, które nie działa.</span><span class="sxs-lookup"><span data-stu-id="0ea63-227">Instead, the workflow is structured with a while loop containing a <xref:System.Activities.Statements.TransactionScope> activity containing a single activity that does no work.</span></span>  <span data-ttu-id="0ea63-228">Każde uruchomienie partii 50 iteracji za pośrednictwem while pętli jest liczony jako pojedyncza operacja.</span><span class="sxs-lookup"><span data-stu-id="0ea63-228">Each run of a batch of 50 iterations through the while loop is counted as a single operation.</span></span>

### <a name="compensation"></a><span data-ttu-id="0ea63-229">Kompensacja</span><span class="sxs-lookup"><span data-stu-id="0ea63-229">Compensation</span></span>
 <span data-ttu-id="0ea63-230">Przepływ pracy WF3 ma jedno działanie compensatable o nazwie `WorkScope`.</span><span class="sxs-lookup"><span data-stu-id="0ea63-230">The WF3 workflow has a single compensatable activity named `WorkScope`.</span></span>  <span data-ttu-id="0ea63-231">Działanie po prostu <xref:System.Workflow.ComponentModel.ICompensatableActivity> implementuje interfejs:</span><span class="sxs-lookup"><span data-stu-id="0ea63-231">The activity simply implements the <xref:System.Workflow.ComponentModel.ICompensatableActivity> interface:</span></span>

```csharp
class WorkScope :
        CompositeActivity, ICompensatableActivity
    {
        public WorkScope() : base() { }

        public WorkScope(string name)
        {
            this.Name = name;
        }

        public ActivityExecutionStatus Compensate(
            ActivityExecutionContext executionContext)
        {
            return ActivityExecutionStatus.Closed;
        }
    }
```

 <span data-ttu-id="0ea63-232">Program obsługi błędów jest przeznaczony dla `WorkScope` działania.</span><span class="sxs-lookup"><span data-stu-id="0ea63-232">The fault handler targets the `WorkScope` activity.</span></span> <span data-ttu-id="0ea63-233">Przepływ pracy WF4 jest równie uproszczony.</span><span class="sxs-lookup"><span data-stu-id="0ea63-233">The WF4 workflow is equally simplistic.</span></span>  <span data-ttu-id="0ea63-234">A <xref:System.Activities.Statements.CompensableActivity> ma treść i program obsługi wynagrodzeń.</span><span class="sxs-lookup"><span data-stu-id="0ea63-234">A <xref:System.Activities.Statements.CompensableActivity> has a body and a compensation handler.</span></span>  <span data-ttu-id="0ea63-235">Jawne kompensacji jest następny w sekwencji.</span><span class="sxs-lookup"><span data-stu-id="0ea63-235">An explicit compensate is next in the sequence.</span></span>  <span data-ttu-id="0ea63-236">Działanie treści i działanie obsługi wynagrodzeń są zarówno puste implementacje:</span><span class="sxs-lookup"><span data-stu-id="0ea63-236">The body activity and compensation handler activity are both empty implementations:</span></span>

```csharp
public sealed class CompensableActivityEmptyCompensation : CodeActivity
    {
        public CompensableActivityEmptyCompensation()
            : base() { }

        public Activity Body { get; set; }

        protected override void Execute(CodeActivityContext context) { }
    }
    public sealed class CompensableActivityEmptyBody : CodeActivity
    {
        public CompensableActivityEmptyBody()
            : base() { }

        public Activity Body { get; set; }

        protected override void Execute(CodeActivityContext context) { }
    }
```

<span data-ttu-id="0ea63-237">Na poniższym diagramie przedstawiono podstawowy przepływ pracy wynagrodzeń.</span><span class="sxs-lookup"><span data-stu-id="0ea63-237">The following diagram shows the basic compensation workflow.</span></span> <span data-ttu-id="0ea63-238">Przepływ pracy WF3 znajduje się po lewej stronie, a przepływ pracy WF4 znajduje się po prawej stronie.</span><span class="sxs-lookup"><span data-stu-id="0ea63-238">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>

![Podstawowe przepływy wynagrodzeń WF3 i WF4](./media/performance/basic-compensation-workflows-wf3-wf4.gif)

### <a name="performance-test-results"></a><span data-ttu-id="0ea63-240">Wyniki testu wydajności</span><span class="sxs-lookup"><span data-stu-id="0ea63-240">Performance Test Results</span></span>

 ![Tabela przedstawiająca dane wyników testów wydajności](./media/performance/performance-test-data.gif)

 ![Wykres kolumnowy porównujący dane z testu wydajności WF3 i WF4](./media/performance/performance-test-chart.gif)

 <span data-ttu-id="0ea63-243">Wszystkie testy są mierzone w przepływach pracy na sekundę, z wyjątkiem testu zakresu transakcji.</span><span class="sxs-lookup"><span data-stu-id="0ea63-243">All tests are measured in workflows per second with the exception of the transaction scope test.</span></span>  <span data-ttu-id="0ea63-244">Jak widać powyżej, [!INCLUDE[wf1](../../../includes/wf1-md.md)] wydajność środowiska uruchomieniowego poprawiła się we wszystkich dziedzinach, szczególnie w obszarach, które wymagają wielu wykonań tego samego działania, takich jak while pętli.</span><span class="sxs-lookup"><span data-stu-id="0ea63-244">As can be seen above, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime performance has improved across the board, especially in areas that require multiple executions of the same activity like the while loop.</span></span>

## <a name="service-composition-scenario"></a><span data-ttu-id="0ea63-245">Scenariusz składu usługi</span><span class="sxs-lookup"><span data-stu-id="0ea63-245">Service Composition Scenario</span></span>
 <span data-ttu-id="0ea63-246">Jak pokazano w poprzedniej sekcji "Porównania wydajności na poziomie składnika", nastąpiło znaczne zmniejszenie narzutów między WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="0ea63-246">As is shown in the previous section, "Component-level Performance Comparisons," there has been a significant reduction in overhead between WF3 and WF4.</span></span>  <span data-ttu-id="0ea63-247">Usługi przepływu pracy WCF można teraz prawie dopasować wydajność ręcznie kodowane usługi WCF, ale nadal mają wszystkie zalety środowiska [!INCLUDE[wf1](../../../includes/wf1-md.md)] wykonawczego.</span><span class="sxs-lookup"><span data-stu-id="0ea63-247">WCF workflow services can now almost match the performance of hand-coded WCF services but still have all the benefits of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="0ea63-248">W tym scenariuszu testowym porównuje usługę WCF z usługą przepływu pracy WCF w WF4.</span><span class="sxs-lookup"><span data-stu-id="0ea63-248">This test scenario compares a WCF service against a WCF workflow service in WF4.</span></span>

### <a name="online-store-service"></a><span data-ttu-id="0ea63-249">Serwis sklepu internetowego</span><span class="sxs-lookup"><span data-stu-id="0ea63-249">Online Store Service</span></span>
 <span data-ttu-id="0ea63-250">Jedną z mocnych stron programu Windows Workflow Foundation jest możliwość tworzenia procesów przy użyciu kilku usług.</span><span class="sxs-lookup"><span data-stu-id="0ea63-250">One of the strengths of Windows Workflow Foundation is the ability to compose processes using several services.</span></span>  <span data-ttu-id="0ea63-251">W tym przykładzie istnieje usługa sklepu internetowego, która organizuje dwa wywołania usługi w celu zakupu zamówienia.</span><span class="sxs-lookup"><span data-stu-id="0ea63-251">For this example, there is an online store service that orchestrates two service calls to purchase an order.</span></span>  <span data-ttu-id="0ea63-252">Pierwszym krokiem jest sprawdzenie poprawności zamówienia przy użyciu usługi sprawdzania poprawności zamówień.</span><span class="sxs-lookup"><span data-stu-id="0ea63-252">The first step is to validate the order using an Order Validating Service.</span></span>  <span data-ttu-id="0ea63-253">Drugim krokiem jest wypełnienie zamówienia za pomocą usługi magazynowej.</span><span class="sxs-lookup"><span data-stu-id="0ea63-253">The second step is to fill the order using a Warehouse Service.</span></span>

 <span data-ttu-id="0ea63-254">Dwie usługi wewnętrznej bazy danych, Usługa sprawdzania poprawności zamówień i usługa magazynu, pozostają takie same dla obu testów.</span><span class="sxs-lookup"><span data-stu-id="0ea63-254">The two backend services, Order Validating Service and Warehouse Service, remain the same for both tests.</span></span>  <span data-ttu-id="0ea63-255">Część, która się zmienia, to usługa sklepu internetowego, która wykonuje aranżację.</span><span class="sxs-lookup"><span data-stu-id="0ea63-255">The part that changes is the Online Store Service that performs the orchestration.</span></span>  <span data-ttu-id="0ea63-256">W jednym przypadku usługa jest ręcznie kodowane jako usługa WCF.</span><span class="sxs-lookup"><span data-stu-id="0ea63-256">In one case, the service is hand-coded as a WCF service.</span></span>  <span data-ttu-id="0ea63-257">W innym przypadku usługa jest zapisywana jako usługa przepływu pracy WCF w WF4.</span><span class="sxs-lookup"><span data-stu-id="0ea63-257">For the other case, the service is written as a WCF workflow service in WF4.</span></span> [!INCLUDE[wf1](../../../includes/wf1-md.md)]<span data-ttu-id="0ea63-258">-specyficzne funkcje, takie jak śledzenie i trwałość są wyłączone dla tego testu.</span><span class="sxs-lookup"><span data-stu-id="0ea63-258">-specific features like tracking and persistence are turned off for this test.</span></span>

### <a name="environment"></a><span data-ttu-id="0ea63-259">Środowisko</span><span class="sxs-lookup"><span data-stu-id="0ea63-259">Environment</span></span>
![Konfiguracja środowiska do pomiaru wydajności](./media/performance/performance-test-environment.gif)

 <span data-ttu-id="0ea63-261">Żądania klientów są przesyłane do usługi sklepu internetowego za pośrednictwem protokołu HTTP z wielu komputerów.</span><span class="sxs-lookup"><span data-stu-id="0ea63-261">Client requests are made to the Online Store Service via HTTP from multiple computers.</span></span>  <span data-ttu-id="0ea63-262">Jeden komputer obsługuje wszystkie trzy usługi.</span><span class="sxs-lookup"><span data-stu-id="0ea63-262">A single computer hosts all three services.</span></span>  <span data-ttu-id="0ea63-263">Warstwa transportu między usługą sklepu internetowego a usługami zaplecza to TCP lub HTTP.</span><span class="sxs-lookup"><span data-stu-id="0ea63-263">The transport layer between the Online Store Service and the backend services is TCP or HTTP.</span></span>  <span data-ttu-id="0ea63-264">Pomiar operacji/sekundy jest oparty na `PurchaseOrder` liczbie zakończonych połączeń wykonanych do Serwisu Sklepu Internetowego.</span><span class="sxs-lookup"><span data-stu-id="0ea63-264">The measurement of operations/second is based on the number of completed `PurchaseOrder` calls made to the Online Store Service.</span></span>  <span data-ttu-id="0ea63-265">Buforowanie kanałów to nowa funkcja dostępna w WF4.</span><span class="sxs-lookup"><span data-stu-id="0ea63-265">Channel pooling is a new feature available in WF4.</span></span>  <span data-ttu-id="0ea63-266">W części WCF tego kanału testowego buforowania nie jest dostarczany po wyjęciu z pudełka, więc ręcznie kodowane implementacji techniki prostego buforowania został użyty w usłudze sklepu internetowego.</span><span class="sxs-lookup"><span data-stu-id="0ea63-266">In the WCF portion of this test channel pooling is not provided out of the box so a hand-coded implementation of a simple pooling technique was used in the Online Store Service.</span></span>

### <a name="performance"></a><span data-ttu-id="0ea63-267">Wydajność</span><span class="sxs-lookup"><span data-stu-id="0ea63-267">Performance</span></span>
![Wykres kolumnowy przedstawiający wydajność usługi sklepu internetowego](./media/performance/online-store-performance-graph.gif)

 <span data-ttu-id="0ea63-269">Łączenie się z usługami TCP wewnętrznej [!INCLUDE[wf1](../../../includes/wf1-md.md)] bazy danych bez buforowania kanałów, usługa ma 17,2% wpływ na przepływność.</span><span class="sxs-lookup"><span data-stu-id="0ea63-269">Connecting to backend TCP services without channel pooling, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] service has a 17.2% impact on throughput.</span></span>  <span data-ttu-id="0ea63-270">W przypadku łączenia kanałów kara wynosi około 23,8%.</span><span class="sxs-lookup"><span data-stu-id="0ea63-270">With channel pooling, the penalty is about 23.8%.</span></span>  <span data-ttu-id="0ea63-271">W przypadku protokołu HTTP wpływ jest znacznie mniejszy: 4,3% bez łączenia i 8,1% z pulą.</span><span class="sxs-lookup"><span data-stu-id="0ea63-271">For HTTP, the impact is much less: 4.3% without pooling and 8.1% with pooling.</span></span>  <span data-ttu-id="0ea63-272">Należy również pamiętać, że buforowanie kanałów zapewnia bardzo niewielkie korzyści podczas korzystania z protokołu HTTP.</span><span class="sxs-lookup"><span data-stu-id="0ea63-272">It is also important to note that the channel pooling provides very little benefit when using HTTP.</span></span>

 <span data-ttu-id="0ea63-273">Chociaż istnieje obciążenie ze środowiska wykonawczego WF4 w porównaniu z ręcznie kodowane WCF usługi w tym teście, można uznać za najgorszy scenariusz.</span><span class="sxs-lookup"><span data-stu-id="0ea63-273">While there is overhead from the WF4 runtime compared with a hand-coded WCF service in this test, it could be considered a worst-case scenario.</span></span>  <span data-ttu-id="0ea63-274">Dwie usługi wewnętrznej bazy danych w tym teście wykonują bardzo mało pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-274">The two backend services in this test do very little work.</span></span>  <span data-ttu-id="0ea63-275">W rzeczywistym scenariuszu end-to-end te usługi będą wykonywać droższe operacje, takie jak wywołania bazy danych, dzięki czemu wpływ na wydajność warstwy transportu mniej ważne.</span><span class="sxs-lookup"><span data-stu-id="0ea63-275">In a real end-to-end scenario, these services would perform more expensive operations like database calls, making the performance impact of the transport layer less important.</span></span>  <span data-ttu-id="0ea63-276">To plus korzyści z funkcji dostępnych w WF4 sprawia, że Workflow Foundation realnym wyborem do tworzenia usług aranżacji.</span><span class="sxs-lookup"><span data-stu-id="0ea63-276">This plus the benefits of the features available in WF4 makes Workflow Foundation a viable choice for creating orchestration services.</span></span>

## <a name="key-performance-considerations"></a><span data-ttu-id="0ea63-277">Najważniejsze zagadnienia dotyczące wydajności</span><span class="sxs-lookup"><span data-stu-id="0ea63-277">Key Performance Considerations</span></span>
 <span data-ttu-id="0ea63-278">Obszary charakterystyczne w tej sekcji, z wyjątkiem interop, zostały radykalnie zmienione między WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="0ea63-278">The feature areas in this section, with the exception of interop, have dramatically changed between WF3 and WF4.</span></span>  <span data-ttu-id="0ea63-279">Wpływa to na projektowanie aplikacji przepływu pracy, a także na wydajność.</span><span class="sxs-lookup"><span data-stu-id="0ea63-279">This affects the design of workflow applications as well as the performance.</span></span>

#### <a name="workflow-activation-latency"></a><span data-ttu-id="0ea63-280">Opóźnienie aktywacji przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="0ea63-280">Workflow Activation Latency</span></span>
 <span data-ttu-id="0ea63-281">W aplikacji usługi przepływu pracy WCF opóźnienie uruchamiania nowego przepływu pracy lub ładowania istniejącego przepływu pracy jest ważne, ponieważ może być blokowanie.</span><span class="sxs-lookup"><span data-stu-id="0ea63-281">In a WCF workflow service application, the latency for starting a new workflow or loading an existing workflow is important as it can be blocking.</span></span>  <span data-ttu-id="0ea63-282">Ten przypadek testowy mierzy hostA XOML WF3 względem hosta WF4 XAMLX w typowym scenariuszu.</span><span class="sxs-lookup"><span data-stu-id="0ea63-282">This test case measures a WF3 XOML host against a WF4 XAMLX host in a typical scenario.</span></span>

##### <a name="environment-setup"></a><span data-ttu-id="0ea63-283">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="0ea63-283">Environment Setup</span></span>
 ![Konfiguracja środowiska dla testów opóźnienia i przepływności](./media/performance/latency-throughput-environment-setup.gif)

##### <a name="test-setup"></a><span data-ttu-id="0ea63-285">Ustawienia testu</span><span class="sxs-lookup"><span data-stu-id="0ea63-285">Test Setup</span></span>
 <span data-ttu-id="0ea63-286">W scenariuszu komputer kliencki kontaktuje się z usługą przepływu pracy WCF przy użyciu korelacji opartej na kontekście.</span><span class="sxs-lookup"><span data-stu-id="0ea63-286">In the scenario, a client computer contacts a WCF workflow service using context-based correlation.</span></span>  <span data-ttu-id="0ea63-287">Korelacja kontekstu wymaga specjalnego powiązania kontekstu i używa nagłówka kontekstu lub pliku cookie do powiązania wiadomości z wystąpieniem poprawnego przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-287">Context correlation requires a special context binding and uses a context header or cookie to relate messages to the correct workflow instance.</span></span>  <span data-ttu-id="0ea63-288">Ma korzyści wydajności, ponieważ identyfikator korelacji znajduje się w nagłówku wiadomości, więc treść wiadomości nie musi być analizowana.</span><span class="sxs-lookup"><span data-stu-id="0ea63-288">It has a performance benefit in that the correlation Id is located in the message header so the message body does not need to be parsed.</span></span>

 <span data-ttu-id="0ea63-289">Usługa utworzy nowy przepływ pracy z żądaniem i wyśle natychmiastową odpowiedź, aby pomiar opóźnienia nie uwzględniał czasu poświęconego na uruchomienie przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-289">The service will create a new workflow with the request and send an immediate response so that the measurement of latency does not include the time spent running the workflow.</span></span>  <span data-ttu-id="0ea63-290">Przepływ pracy WF3 to XOML z kodem, a przepływ pracy WF4 to całkowicie XAML.</span><span class="sxs-lookup"><span data-stu-id="0ea63-290">The WF3 workflow is XOML with a code-behind and the WF4 workflow is entirely XAML.</span></span>  <span data-ttu-id="0ea63-291">Przepływ pracy WF4 wygląda następująco:</span><span class="sxs-lookup"><span data-stu-id="0ea63-291">The WF4 workflow looks like this:</span></span>

 ![Przepływ pracy zakresu korelacji WF4](./media/performance/wf4-correlationscope-workflow.gif)

 <span data-ttu-id="0ea63-293">Działanie <xref:System.ServiceModel.Activities.Receive> tworzy wystąpienie przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-293">The <xref:System.ServiceModel.Activities.Receive> activity creates the workflow instance.</span></span>  <span data-ttu-id="0ea63-294">Wartość przekazana w odebranej wiadomości jest powtarzana w wiadomości odpowiedzi.</span><span class="sxs-lookup"><span data-stu-id="0ea63-294">A value passed in the received message is echoed in the reply message.</span></span>  <span data-ttu-id="0ea63-295">Sekwencja po odpowiedzi zawiera pozostałą część przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-295">A sequence following the reply contains the rest of the workflow.</span></span>  <span data-ttu-id="0ea63-296">W powyższym przypadku wyświetlane jest tylko jedno działanie komentarza.</span><span class="sxs-lookup"><span data-stu-id="0ea63-296">In the above case, only one comment activity is shown.</span></span>  <span data-ttu-id="0ea63-297">Liczba działań komentarzy zostanie zmieniona w celu symulacji złożoności przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-297">The number of comment activities is changed to simulate workflow complexity.</span></span>  <span data-ttu-id="0ea63-298">Działanie komentarza jest odpowiednikiem WF3, <xref:System.Workflow.Activities.CodeActivity> który wykonuje żadnej pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-298">A comment activity is equivalent to a WF3 <xref:System.Workflow.Activities.CodeActivity> that performs no work.</span></span> <span data-ttu-id="0ea63-299">Aby uzyskać więcej informacji na temat działania komentarz, zobacz sekcję "Porównanie wydajności na poziomie składnika" wcześniej w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="0ea63-299">For more information about the comment activity, see the "Component-level Performance Comparison" section earlier in this article.</span></span>

##### <a name="test-results"></a><span data-ttu-id="0ea63-300">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="0ea63-300">Test Results</span></span>

 <span data-ttu-id="0ea63-301">Zimne i ciepłe opóźnienie usług przepływu pracy WCF:</span><span class="sxs-lookup"><span data-stu-id="0ea63-301">Cold and warm latency for WCF workflow services:</span></span>

 ![Wykres kolumnowy przedstawiający zimne i ciepłe opóźnienie dla usług przepływu pracy WCF przy użyciu WF3 i WF4](./media/performance/latency-results-graph.gif)

 <span data-ttu-id="0ea63-303">Na poprzednim wykresie cold odnosi się do przypadku, <xref:System.ServiceModel.WorkflowServiceHost> gdy nie istnieje istniejący dla danego przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-303">In the previous chart, cold refers to the case where there is not an existing <xref:System.ServiceModel.WorkflowServiceHost> for the given workflow.</span></span>  <span data-ttu-id="0ea63-304">Innymi słowy opóźnienie zimna jest, gdy przepływ pracy jest używany po raz pierwszy i XOML lub XAML musi zostać skompilowany.</span><span class="sxs-lookup"><span data-stu-id="0ea63-304">In other words, cold latency is when the workflow is being used for the first time and the XOML or XAML needs to be compiled.</span></span>  <span data-ttu-id="0ea63-305">Ogrzanie opóźnienie to czas, aby utworzyć nowe wystąpienie przepływu pracy, gdy typ przepływu pracy został już skompilowany.</span><span class="sxs-lookup"><span data-stu-id="0ea63-305">Warm latency is the time to create a new workflow instance when the workflow type has already been compiled.</span></span>  <span data-ttu-id="0ea63-306">Złożoność przepływu pracy sprawia, że bardzo niewiele różnicy w przypadku WF4, ale ma liniowy postęp w przypadku WF3.</span><span class="sxs-lookup"><span data-stu-id="0ea63-306">The complexity of the workflow makes very little difference in the WF4 case but has a linear progression in the WF3 case.</span></span>

#### <a name="correlation-throughput"></a><span data-ttu-id="0ea63-307">Przepływność korelacji</span><span class="sxs-lookup"><span data-stu-id="0ea63-307">Correlation Throughput</span></span>
 <span data-ttu-id="0ea63-308">WF4 wprowadza nową funkcję korelacji opartą na zawartości.</span><span class="sxs-lookup"><span data-stu-id="0ea63-308">WF4 introduces a new content-based correlation feature.</span></span>  <span data-ttu-id="0ea63-309">WF3 pod warunkiem tylko korelacji kontekstowej.</span><span class="sxs-lookup"><span data-stu-id="0ea63-309">WF3 provided only context-based correlation.</span></span>  <span data-ttu-id="0ea63-310">Korelacji opartej na kontekście można wykonać tylko za pomocą określonych powiązań kanału WCF.</span><span class="sxs-lookup"><span data-stu-id="0ea63-310">Context-based correlation could only be done over specific WCF channel bindings.</span></span>  <span data-ttu-id="0ea63-311">Identyfikator przepływu pracy jest wstawiany do nagłówka wiadomości podczas korzystania z tych powiązań.</span><span class="sxs-lookup"><span data-stu-id="0ea63-311">The workflow Id is inserted into the message header when using these bindings.</span></span>  <span data-ttu-id="0ea63-312">Środowisko uruchomieniowe WF3 może identyfikować przepływ pracy tylko przez jego identyfikator.  W połączeniu opartym na zawartości autor przepływu pracy może utworzyć klucz korelacji z odpowiedniego fragmentu danych, takiego jak numer konta lub identyfikator klienta.</span><span class="sxs-lookup"><span data-stu-id="0ea63-312">The WF3 runtime could only identify a workflow by its Id.  With content-based correlation, the workflow author can create a correlation key out of a relevant piece of data like an account number or customer Id.</span></span>

 <span data-ttu-id="0ea63-313">Korelacja oparta na kontekście ma przewagę wydajności, ponieważ klucz korelacji znajduje się w nagłówku wiadomości.</span><span class="sxs-lookup"><span data-stu-id="0ea63-313">Context-based correlation has a performance advantage in that the correlation key is located in the message header.</span></span>  <span data-ttu-id="0ea63-314">Klucz można odczytać z wiadomości bez de-serializacji/kopiowania wiadomości.</span><span class="sxs-lookup"><span data-stu-id="0ea63-314">The key can be read from the message without de-serialization/message-copying.</span></span>  <span data-ttu-id="0ea63-315">W korelacji opartej na zawartości klucz korelacji jest przechowywany w treści wiadomości.</span><span class="sxs-lookup"><span data-stu-id="0ea63-315">In content-based correlation, the correlation key is stored in the message body.</span></span>  <span data-ttu-id="0ea63-316">Wyrażenie XPath jest używane do lokalizowania klucza.</span><span class="sxs-lookup"><span data-stu-id="0ea63-316">An XPath expression is used to locate the key.</span></span>  <span data-ttu-id="0ea63-317">Koszt tego dodatkowego przetwarzania zależy od rozmiaru wiadomości, głębokości klucza w treści i liczby kluczy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-317">The cost of this extra processing depends on the size of the message, depth of the key in the body, and the number of keys.</span></span>  <span data-ttu-id="0ea63-318">Ten test porównuje korelacji kontekstu i zawartości, a także pokazuje spadek wydajności podczas korzystania z wielu kluczy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-318">This test compares context- and content-based correlation and also shows the performance degradation when using multiple keys.</span></span>

#### <a name="environment-setup"></a><span data-ttu-id="0ea63-319">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="0ea63-319">Environment Setup</span></span>
![Konfiguracja środowiska do testu wydajności przepływu pracy](./media/performance/performance-test-environment.gif)

#### <a name="test-setup"></a><span data-ttu-id="0ea63-321">Ustawienia testu</span><span class="sxs-lookup"><span data-stu-id="0ea63-321">Test Setup</span></span>
<span data-ttu-id="0ea63-322">![Test przepływu przepływności korelacji](./media/performance/correlation-throughput-workflow.gif "Konfiguracja testu przepływu przepływności korelacji")</span><span class="sxs-lookup"><span data-stu-id="0ea63-322">![Correlation Throughput Workflow Test](./media/performance/correlation-throughput-workflow.gif "Correlation throughput workflow test setup")</span></span>

 <span data-ttu-id="0ea63-323">Poprzedni przepływ pracy jest taki sam, który jest używany w sekcji [Trwałość.](#persistence)</span><span class="sxs-lookup"><span data-stu-id="0ea63-323">The previous workflow is the same one used in the [Persistence](#persistence) section.</span></span> <span data-ttu-id="0ea63-324">Dla testów korelacji bez trwałości, nie ma dostawcy trwałości zainstalowane w czasie wykonywania.</span><span class="sxs-lookup"><span data-stu-id="0ea63-324">For the correlation tests without persistence, there is no persistence provider installed in the runtime.</span></span> <span data-ttu-id="0ea63-325">Korelacja występuje w dwóch miejscach: CreateOrder i CompleteOrder.</span><span class="sxs-lookup"><span data-stu-id="0ea63-325">Correlation occurs in two places: CreateOrder and CompleteOrder.</span></span>

#### <a name="test-results"></a><span data-ttu-id="0ea63-326">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="0ea63-326">Test Results</span></span>
<span data-ttu-id="0ea63-327">![Przepływność korelacji](./media/performance/correlation-throughput-graph.gif "Wykres przepływności korelacji")</span><span class="sxs-lookup"><span data-stu-id="0ea63-327">![Correlation Throughput](./media/performance/correlation-throughput-graph.gif "Correlation throughput graph")</span></span>

 <span data-ttu-id="0ea63-328">Ten wykres pokazuje spadek wydajności w miarę zwiększania liczby kluczy używanych w korelacji opartej na zawartości.</span><span class="sxs-lookup"><span data-stu-id="0ea63-328">This graph shows a decrease in performance as the number of keys used in content-based correlation increases.</span></span>  <span data-ttu-id="0ea63-329">Podobieństwo w krzywych między TCP i HTTP wskazuje obciążenie związane z tymi protokołami.</span><span class="sxs-lookup"><span data-stu-id="0ea63-329">The similarity in the curves between TCP and HTTP indicates the overhead associated with these protocols.</span></span>

#### <a name="correlation-with-persistence"></a><span data-ttu-id="0ea63-330">Korelacja z trwałością</span><span class="sxs-lookup"><span data-stu-id="0ea63-330">Correlation with Persistence</span></span>
 <span data-ttu-id="0ea63-331">W przypadku utrwalonego przepływu pracy ciśnienie procesora CPU z korelacji opartej na zawartości przesuwa się ze środowiska wykonawczego przepływu pracy do bazy danych SQL.</span><span class="sxs-lookup"><span data-stu-id="0ea63-331">With a persisted workflow, the CPU pressure from content-based correlation shifts from the workflow runtime to the SQL database.</span></span>  <span data-ttu-id="0ea63-332">Procedury przechowywane w dostawcy trwałości SQL wykonać pracę dopasowania kluczy, aby zlokalizować odpowiedni przepływ pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-332">The stored procedures in the SQL persistence provider do the work of matching the keys to locate the appropriate workflow.</span></span>

 ![Wykres liniowy przedstawiający wyniki korelacji i trwałości](./media/performance/correlation-persistence-graph.gif)

 <span data-ttu-id="0ea63-334">Korelacja oparta na kontekście jest nadal szybsza niż korelacja oparta na zawartości.</span><span class="sxs-lookup"><span data-stu-id="0ea63-334">Context-based correlation is still faster than content-based correlation.</span></span>  <span data-ttu-id="0ea63-335">Jednak różnica jest mniej wyraźna, ponieważ trwałość ma większy wpływ na wydajność niż korelacja.</span><span class="sxs-lookup"><span data-stu-id="0ea63-335">However, the difference is less pronounced as persistence has more impact on performance than correlation.</span></span>

### <a name="complex-workflow-throughput"></a><span data-ttu-id="0ea63-336">Przepływność złożonego przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="0ea63-336">Complex Workflow Throughput</span></span>
 <span data-ttu-id="0ea63-337">Złożoność przepływu pracy nie jest mierzona tylko przez liczbę działań.</span><span class="sxs-lookup"><span data-stu-id="0ea63-337">The complexity of a workflow is not measured only by the number of activities.</span></span>  <span data-ttu-id="0ea63-338">Zajęcia kompozytowe mogą zawierać wiele dzieci, a te dzieci mogą być również zajęciami złożonymi.</span><span class="sxs-lookup"><span data-stu-id="0ea63-338">Composite activities can contain many children and those children can also be composite activities.</span></span>  <span data-ttu-id="0ea63-339">Wraz ze wzrostem liczby poziomów zagnieżdżania zwiększa się liczba działań, które mogą być obecnie w stanie wykonywania i liczba zmiennych, które mogą być w stanie.</span><span class="sxs-lookup"><span data-stu-id="0ea63-339">As the number of levels of nesting increases, so does the number of activities that can be currently in the executing state and the number of variables that can be in state.</span></span>  <span data-ttu-id="0ea63-340">Ten test porównuje przepływność między WF3 i WF4 podczas wykonywania złożonych przepływów pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-340">This test compares throughput between WF3 and WF4 when executing complex workflows.</span></span>

### <a name="test-setup"></a><span data-ttu-id="0ea63-341">Ustawienia testu</span><span class="sxs-lookup"><span data-stu-id="0ea63-341">Test Setup</span></span>
 <span data-ttu-id="0ea63-342">Testy te zostały przeprowadzone na komputerze 4-krotnym Intel Xeon X5355 @ 2.66GHz z 4 GB pamięci RAM z systemem Windows Server 2008 x64.</span><span class="sxs-lookup"><span data-stu-id="0ea63-342">These tests were executed on an Intel Xeon X5355 @ 2.66GHz 4-way computer with 4GB RAM running Windows Server 2008 x64.</span></span>  <span data-ttu-id="0ea63-343">Kod testowy jest uruchamiany w jednym procesie z jednym wątkiem na rdzeń, aby osiągnąć 100% wykorzystania procesora CPU.</span><span class="sxs-lookup"><span data-stu-id="0ea63-343">The test code runs in a single process with one thread per core to reach 100% CPU utilization.</span></span>

 <span data-ttu-id="0ea63-344">Przepływy pracy generowane dla tego testu mają dwie główne zmienne: głębokość i liczbę działań w każdej sekwencji.</span><span class="sxs-lookup"><span data-stu-id="0ea63-344">The workflows generated for this test have two main variables: depth and number of activities in each sequence.</span></span>  <span data-ttu-id="0ea63-345">Każdy poziom głębokości zawiera działanie równoległe, podczas gdy pętla, decyzje, przypisania i sekwencje.</span><span class="sxs-lookup"><span data-stu-id="0ea63-345">Each depth level includes a parallel activity, while loop, decisions, assignments, and sequences.</span></span>  <span data-ttu-id="0ea63-346">W projektancie WF4 na zdjęciu poniżej, wykres blokowy najwyższego poziomu jest na zdjęciu.</span><span class="sxs-lookup"><span data-stu-id="0ea63-346">In the WF4 designer pictured below, the top-level flow chart is pictured.</span></span>  <span data-ttu-id="0ea63-347">Każde działanie schematu blokowego przypomina główny schemat blokowy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-347">Each flowchart activity resembles the main flowchart.</span></span>  <span data-ttu-id="0ea63-348">Może być pomocne, aby myśleć o fraktalne podczas picturing tego przepływu pracy, gdzie głębokość jest ograniczona do parametrów testu.</span><span class="sxs-lookup"><span data-stu-id="0ea63-348">It may be helpful to think of a fractal when picturing this workflow, where the depth is limited to the parameters of the test.</span></span>

 <span data-ttu-id="0ea63-349">Liczba działań w danym teście jest określana przez głębokość i liczbę działań na sekwencję.</span><span class="sxs-lookup"><span data-stu-id="0ea63-349">The number of activities in a given test is determined by the depth and number of activities per sequence.</span></span>  <span data-ttu-id="0ea63-350">Następujące równanie oblicza liczbę działań w teście WF4:</span><span class="sxs-lookup"><span data-stu-id="0ea63-350">The following equation computes the number of activities in the WF4 test:</span></span>

 ![Równanie do obliczania liczby działań](./media/performance/number-activities-equation.gif)

 <span data-ttu-id="0ea63-352">Liczba aktywności testu WF3 może być obliczona przy nieznacznie innym równaniu ze względu na dodatkową sekwencję:</span><span class="sxs-lookup"><span data-stu-id="0ea63-352">The WF3 test’s activity count can be computed with a slightly different equation due to an extra sequence:</span></span>

 ![Równanie do obliczania liczby działań WF3](./media/performance/wf3-number-activities-equation.gif)

 <span data-ttu-id="0ea63-354">Gdzie d jest głębokość i a jest liczba działań na sekwencję.</span><span class="sxs-lookup"><span data-stu-id="0ea63-354">Where d is the depth and a is the number of activities per sequence.</span></span>  <span data-ttu-id="0ea63-355">Logika leżąca u podstaw tych równań polega na tym, że pierwsza stała, pomnożona przez a, jest liczbą sekwencji, a drugą stałą jest statyczną liczbą działań na bieżącym poziomie.</span><span class="sxs-lookup"><span data-stu-id="0ea63-355">The logic behind these equations is that the first constant, multiplied by a, is the number of sequences and the second constant is the static number of activities in the current level.</span></span>  <span data-ttu-id="0ea63-356">Istnieją trzy działania podrzędne schematu blokowego w każdym schematze blokowym.</span><span class="sxs-lookup"><span data-stu-id="0ea63-356">There are three flowchart child activities in each flowchart.</span></span>  <span data-ttu-id="0ea63-357">Na dolnym poziomie głębokości te schematy blokowe są puste, ale na innych poziomach są kopiami głównego schematu blokowego.</span><span class="sxs-lookup"><span data-stu-id="0ea63-357">At the bottom depth level, these flowcharts are empty but at the other levels they are copies of the main flowchart.</span></span>  <span data-ttu-id="0ea63-358">Liczba działań w definicji przepływu pracy każdej odmiany testu jest wskazana w poniższej tabeli:</span><span class="sxs-lookup"><span data-stu-id="0ea63-358">The number of activities in each test variation’s workflow definition is indicated in the following table:</span></span>

 ![Tabela, która pokazuje liczbę działań używanych w każdym teście](./media/performance/workflow-variation-compare-table.gif)

 <span data-ttu-id="0ea63-360">Liczba działań w definicji przepływu pracy gwałtownie wzrasta z każdym poziomem głębokości.</span><span class="sxs-lookup"><span data-stu-id="0ea63-360">The number of activities in the workflow definition increases sharply with each depth level.</span></span>  <span data-ttu-id="0ea63-361">Ale tylko jedna ścieżka na punkt decyzji jest wykonywana w danym wystąpieniu przepływu pracy, więc wykonywany jest tylko niewielki podzbiór rzeczywistych działań.</span><span class="sxs-lookup"><span data-stu-id="0ea63-361">But only one path per decision point is executed in a given workflow instance, so only a small subset of the actual activities are executed.</span></span>

 ![Schemat blokowy złożonego przepływu pracy przepływności](./media/performance/complex-workflow-throughput-workflow.gif)

 <span data-ttu-id="0ea63-363">Dla WF3 utworzono równoważny przepływ pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-363">An equivalent workflow was created for WF3.</span></span> <span data-ttu-id="0ea63-364">Projektant WF3 pokazuje cały przepływ pracy w obszarze projektowania zamiast zagnieżdżania, dlatego jest zbyt duży, aby wyświetlić w tym temacie.</span><span class="sxs-lookup"><span data-stu-id="0ea63-364">The WF3 designer shows the entire workflow in the design area instead of nesting, therefore it is too big to display in this topic.</span></span> <span data-ttu-id="0ea63-365">Fragment kodu przepływu pracy jest pokazany poniżej.</span><span class="sxs-lookup"><span data-stu-id="0ea63-365">A snippet of the workflow is shown below.</span></span>

 ![Fragment schematu blokowego przepływu pracy WF3](./media/performance/wf3-workflow-snippet.gif)

 <span data-ttu-id="0ea63-367">Aby wykonywać zagnieżdżanie w skrajnym przypadku, inny przepływ pracy, który jest częścią tego testu używa 100 sekwencji zagnieżdżonych.</span><span class="sxs-lookup"><span data-stu-id="0ea63-367">To exercise nesting in an extreme case, another workflow that is part of this test uses 100 nested sequences.</span></span>  <span data-ttu-id="0ea63-368">W najbardziej wewnętrznej sekwencji `Comment` <xref:System.Workflow.Activities.CodeActivity>jest pojedynczy lub .</span><span class="sxs-lookup"><span data-stu-id="0ea63-368">In the innermost sequence is a single `Comment` or <xref:System.Workflow.Activities.CodeActivity>.</span></span>

 ![Schemat blokowy sekwencji zagnieżdżonej](./media/performance/nested-sequence-workflow.gif)

 <span data-ttu-id="0ea63-370">Śledzenie i trwałość nie są używane jako część tego testu.</span><span class="sxs-lookup"><span data-stu-id="0ea63-370">Tracking and persistence are not used as part of this test.</span></span>

### <a name="test-results"></a><span data-ttu-id="0ea63-371">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="0ea63-371">Test Results</span></span>
 ![Wykres kolumnowy z wynikami wydajności przepływności](./media/performance/throughput-performance-results.gif)

 <span data-ttu-id="0ea63-373">Nawet w przypadku złożonych przepływów pracy z dużą głębią i dużą liczbą działań wyniki wydajności są zgodne z innymi liczbami przepływności pokazanymi wcześniej w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="0ea63-373">Even with complex workflows with lots of depth and a high number of activities, the performance results are consistent with other throughput numbers shown earlier in this article.</span></span>  <span data-ttu-id="0ea63-374">Przepustowość WF4 jest rzędy wielkości szybciej i musi być porównywany w skali logarytmicznej.</span><span class="sxs-lookup"><span data-stu-id="0ea63-374">WF4’s throughput is orders of magnitude faster and has to be compared on a logarithmic scale.</span></span>

### <a name="memory"></a><span data-ttu-id="0ea63-375">Memory (Pamięć)</span><span class="sxs-lookup"><span data-stu-id="0ea63-375">Memory</span></span>
 <span data-ttu-id="0ea63-376">Obciążenie pamięcią programu Windows Workflow Foundation jest mierzone w dwóch kluczowych obszarach: złożoności przepływu pracy i liczbie definicji przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-376">The memory overhead of Windows Workflow Foundation is measured in two key areas: workflow complexity and number of workflow definitions.</span></span>  <span data-ttu-id="0ea63-377">Pomiary pamięci zostały wykonane na 64-bitowej stacji roboczej systemu Windows 7.</span><span class="sxs-lookup"><span data-stu-id="0ea63-377">Memory measurements were taken on a Windows 7 64-bit workstation.</span></span>  <span data-ttu-id="0ea63-378">Istnieje wiele sposobów uzyskania pomiaru rozmiaru zestawu roboczego, takiego jak monitorowanie liczników wydajności, sondowanie Environment.WorkingSet lub użycie narzędzia takiego jak VMMap dostępnego w [VMMap](/sysinternals/downloads/vmmap).</span><span class="sxs-lookup"><span data-stu-id="0ea63-378">There are many ways to obtain the measurement of working set size such as monitoring performance counters, polling Environment.WorkingSet, or using a tool like VMMap available from [VMMap](/sysinternals/downloads/vmmap).</span></span> <span data-ttu-id="0ea63-379">W celu uzyskania i weryfikacji wyników każdego testu wykorzystano kombinację metod.</span><span class="sxs-lookup"><span data-stu-id="0ea63-379">A combination of methods was used to obtain and verify the results of each test.</span></span>

### <a name="workflow-complexity-test"></a><span data-ttu-id="0ea63-380">Test złożoności przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="0ea63-380">Workflow Complexity Test</span></span>
 <span data-ttu-id="0ea63-381">Test złożoności przepływu pracy mierzy różnicę zestawu roboczego na podstawie złożoności przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-381">The workflow complexity test measures the working set difference based on the complexity of the workflow.</span></span>  <span data-ttu-id="0ea63-382">Oprócz złożonych przepływów pracy używanych w poprzedniej sekcji, nowe odmiany są dodawane w celu uwzględnienia dwóch podstawowych przypadków: pojedynczego przepływu pracy działania i sekwencji z 1000 działań.</span><span class="sxs-lookup"><span data-stu-id="0ea63-382">In addition to the complex workflows used in the previous section, new variations are added to cover two basic cases: a single activity workflow and a sequence with 1000 activities.</span></span>  <span data-ttu-id="0ea63-383">W przypadku tych testów przepływy pracy są inicjowane i wykonywane do zakończenia w pojedynczej pętli szeregowej przez okres jednej minuty.</span><span class="sxs-lookup"><span data-stu-id="0ea63-383">For these tests the workflows are initialized and executed to completion in a single serial loop for a period of one minute.</span></span>  <span data-ttu-id="0ea63-384">Każda odmiana testu jest uruchamiana trzy razy, a zarejestrowane dane są średnią z tych trzech przebiegów.</span><span class="sxs-lookup"><span data-stu-id="0ea63-384">Each test variation is run three times and the data recorded is the average of those three runs.</span></span>

 <span data-ttu-id="0ea63-385">Dwa nowe testy podstawowe mają przepływy pracy, które wyglądają jak te pokazane poniżej:</span><span class="sxs-lookup"><span data-stu-id="0ea63-385">The two new basic tests have workflows that look like those shown below:</span></span>

 ![Złożony przepływ pracy zarówno dla WF3, jak i WF4](./media/performance/complex-workflow-wf3-wf4.gif)

 <span data-ttu-id="0ea63-387">W przepływie pracy WF3 <xref:System.Workflow.Activities.CodeActivity> pokazano powyżej, puste działania są używane.</span><span class="sxs-lookup"><span data-stu-id="0ea63-387">In the WF3 workflow shown above, empty <xref:System.Workflow.Activities.CodeActivity> activities are used.</span></span>  <span data-ttu-id="0ea63-388">Przepływ pracy WF4 powyżej `Comment` używa działań.</span><span class="sxs-lookup"><span data-stu-id="0ea63-388">The WF4 workflow above uses `Comment` activities.</span></span>  <span data-ttu-id="0ea63-389">Działanie `Comment` zostało opisane w sekcji Porównania wydajności na poziomie składnika wcześniej w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="0ea63-389">The `Comment` activity was described in the Component-level Performance Comparisons section earlier in this article.</span></span>

 ![Wykres kolumnowy przedstawiający złożone użycie pamięci przepływu pracy dla przepływów pracy WF3 i WF4](./media/performance/complex-memory-usage-wf3-wf4.gif)

 <span data-ttu-id="0ea63-391">Jednym z wyraźnych trendów, które należy zauważyć na tym wykresie jest to, że zagnieżdżanie ma stosunkowo minimalny wpływ na użycie pamięci w WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="0ea63-391">One of the clear trends to notice in this graph is that nesting has relatively minimal impact on memory usage in both WF3 and WF4.</span></span>  <span data-ttu-id="0ea63-392">Najbardziej znaczący wpływ na pamięć pochodzi z liczby działań w danym przepływie pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-392">The most significant memory impact comes from the number of activities in a given workflow.</span></span>  <span data-ttu-id="0ea63-393">Biorąc pod uwagę dane z sekwencji 1000, złożonej głębokości 5 sekwencji 5 i złożonej głębokości 7 sekwencji 1 odmian, jest oczywiste, że jak liczba działań wchodzi w tysiące, wzrost użycia pamięci staje się bardziej zauważalne.</span><span class="sxs-lookup"><span data-stu-id="0ea63-393">Given the data from the sequence 1000, complex depth 5 sequence 5, and complex depth 7 sequence 1 variations, it is clear that as the number of activities enters the thousands, the memory usage increase becomes more noticeable.</span></span>  <span data-ttu-id="0ea63-394">W skrajnym przypadku (głębokość 7 sekwencji 1), gdzie istnieją ~ 29K działań, WF4 używa prawie 79% mniej pamięci niż WF3.</span><span class="sxs-lookup"><span data-stu-id="0ea63-394">In the extreme case (depth 7 sequence 1) where there are ~29K activities, WF4 is using almost 79% less memory than WF3.</span></span>

### <a name="multiple-workflow-definitions-test"></a><span data-ttu-id="0ea63-395">Test wielu definicji przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="0ea63-395">Multiple Workflow Definitions Test</span></span>
 <span data-ttu-id="0ea63-396">Pomiar pamięci na definicję przepływu pracy jest podzielony na dwa różne testy ze względu na dostępne opcje hostingu przepływów pracy w WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="0ea63-396">Measuring memory per workflow definition is divided into two different tests because of the available options for hosting workflows in WF3 and WF4.</span></span>  <span data-ttu-id="0ea63-397">Testy są uruchamiane w inny sposób niż test złożoności przepływu pracy, w tym danego przepływu pracy jest wystąpienie i wykonywane tylko raz na definicję.</span><span class="sxs-lookup"><span data-stu-id="0ea63-397">The tests are run in a different manner than the workflow complexity test in that a given workflow is instanced and executed only once per definition.</span></span>  <span data-ttu-id="0ea63-398">Jest to spowodowane definicją przepływu pracy i jego hosta pozostają w pamięci przez cały okres istnienia AppDomain.</span><span class="sxs-lookup"><span data-stu-id="0ea63-398">This is because the workflow definition and its host remain in memory for the lifetime of the AppDomain.</span></span>  <span data-ttu-id="0ea63-399">Pamięć używana przez uruchomienie danego wystąpienia przepływu pracy powinny być czyszczone podczas wyrzucania elementów bezużytecznych.</span><span class="sxs-lookup"><span data-stu-id="0ea63-399">The memory used by running a given workflow instance should be cleaned up during garbage collection.</span></span>  <span data-ttu-id="0ea63-400">Wskazówki dotyczące migracji dla WF4 zawiera bardziej szczegółowe informacje na temat opcji hostingu.</span><span class="sxs-lookup"><span data-stu-id="0ea63-400">The migration guidance for WF4 contains more detailed information on the hosting options.</span></span> <span data-ttu-id="0ea63-401">Aby uzyskać więcej informacji, zobacz [WF Migration Cookbook: Workflow Hosting](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="0ea63-401">For more information, see [WF Migration Cookbook: Workflow Hosting](migration-guidance.md).</span></span>

 <span data-ttu-id="0ea63-402">Tworzenie wielu definicji przepływu pracy dla testu definicji przepływu pracy można wykonać na kilka sposobów.</span><span class="sxs-lookup"><span data-stu-id="0ea63-402">Creating many workflow definitions for a workflow definition test can be done in several ways.</span></span>  <span data-ttu-id="0ea63-403">Na przykład można użyć generowania kodu, aby utworzyć zestaw 1000 przepływów pracy, które są identyczne, z wyjątkiem nazwy i zapisać każdy z tych przepływów pracy w oddzielnych plikach.</span><span class="sxs-lookup"><span data-stu-id="0ea63-403">For instance, one could use code generation to create a set of 1000 workflows that are identical except in name and save each of those workflows into separate files.</span></span>  <span data-ttu-id="0ea63-404">Takie podejście zostało podjęte w przypadku testu hostowanego przez konsolę.</span><span class="sxs-lookup"><span data-stu-id="0ea63-404">This approach was taken for the console-hosted test.</span></span>  <span data-ttu-id="0ea63-405">W WF3 <xref:System.Workflow.Runtime.WorkflowRuntime> klasa została użyta do uruchomienia definicji przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-405">In WF3, the <xref:System.Workflow.Runtime.WorkflowRuntime> class was used to run the workflow definitions.</span></span>  <span data-ttu-id="0ea63-406">WF4 można użyć <xref:System.Activities.WorkflowApplication> do utworzenia wystąpienia pojedynczego <xref:System.Activities.WorkflowInvoker> przepływu pracy lub bezpośrednio użyć do uruchomienia działania, tak jakby było wywołanie metody.</span><span class="sxs-lookup"><span data-stu-id="0ea63-406">WF4 can either use <xref:System.Activities.WorkflowApplication> to create a single workflow instance or directly use <xref:System.Activities.WorkflowInvoker> to run the activity as if it were a method call.</span></span>  <span data-ttu-id="0ea63-407"><xref:System.Activities.WorkflowApplication>jest gospodarzem pojedynczego wystąpienia przepływu pracy i <xref:System.Workflow.Runtime.WorkflowRuntime> ma bliższą parzystość funkcji, aby była używana w tym teście.</span><span class="sxs-lookup"><span data-stu-id="0ea63-407"><xref:System.Activities.WorkflowApplication> is a host of a single workflow instance and has closer feature parity to <xref:System.Workflow.Runtime.WorkflowRuntime> so that was used in this test.</span></span>

 <span data-ttu-id="0ea63-408">Podczas hostingu przepływów pracy w iis <xref:System.Web.Hosting.VirtualPathProvider> można użyć <xref:System.ServiceModel.WorkflowServiceHost> a, aby utworzyć nowy zamiast generowania wszystkich plików XAMLX lub XOML.</span><span class="sxs-lookup"><span data-stu-id="0ea63-408">When hosting workflows in IIS it is possible to use a <xref:System.Web.Hosting.VirtualPathProvider> to create a new <xref:System.ServiceModel.WorkflowServiceHost> instead of generating all of the XAMLX or XOML files.</span></span>  <span data-ttu-id="0ea63-409">Obsługuje <xref:System.Web.Hosting.VirtualPathProvider> żądanie przychodzące i odpowiada za pomocą "pliku wirtualnego", który można załadować z bazy danych lub, w tym przypadku, generowane na bieżąco.</span><span class="sxs-lookup"><span data-stu-id="0ea63-409">The <xref:System.Web.Hosting.VirtualPathProvider> handles the incoming request and responds with a "virtual file" that can be loaded from a database or, in this case, generated on the fly.</span></span>  <span data-ttu-id="0ea63-410">Dlatego nie jest konieczne tworzenie 1000 plików fizycznych.</span><span class="sxs-lookup"><span data-stu-id="0ea63-410">It is therefore unnecessary to create 1000 physical files.</span></span>

 <span data-ttu-id="0ea63-411">Definicje przepływu pracy używane w teście konsoli były prostymi sekwencyjnymi przepływami pracy z pojedynczym działaniem.</span><span class="sxs-lookup"><span data-stu-id="0ea63-411">The workflow definitions used in the console test were simple sequential workflows with a single activity.</span></span>  <span data-ttu-id="0ea63-412">Pojedyncze działanie było <xref:System.Workflow.Activities.CodeActivity> puste dla sprawy WF3 i `Comment` działania dla sprawy WF4.</span><span class="sxs-lookup"><span data-stu-id="0ea63-412">The single activity was an empty <xref:System.Workflow.Activities.CodeActivity> for the WF3 case and a `Comment` activity for the WF4 case.</span></span>  <span data-ttu-id="0ea63-413">Przypadek hostowany przez usługi IIS używał przepływów pracy, które rozpoczynają się od otrzymania wiadomości, a kończą od wysłania odpowiedzi:</span><span class="sxs-lookup"><span data-stu-id="0ea63-413">The IIS-hosted case used workflows that start on receiving a message and end on sending a reply:</span></span>

<span data-ttu-id="0ea63-414">Na poniższej ilustracji przedstawiono przepływ pracy WF3 z receiveactivity i przepływ pracy WF4 ze wzorcem żądania/odpowiedzi:</span><span class="sxs-lookup"><span data-stu-id="0ea63-414">The following image shows a WF3 workflow with ReceiveActivity and a WF4 workflow with request/response pattern:</span></span>

 ![Usługi przepływu pracy w WF3 i WF4](./media/performance/workflow-receive-activity.gif)

 <span data-ttu-id="0ea63-416">W poniższej tabeli przedstawiono różnicę w zestawie roboczym między definicją pojedynczego przepływu pracy a definicjami 1001:</span><span class="sxs-lookup"><span data-stu-id="0ea63-416">The following table shows the delta in working set between a single workflow definition and 1001 definitions:</span></span>

|<span data-ttu-id="0ea63-417">Opcje hostingu</span><span class="sxs-lookup"><span data-stu-id="0ea63-417">Hosting Options</span></span>|<span data-ttu-id="0ea63-418">WF3 Zestaw roboczy Delta</span><span class="sxs-lookup"><span data-stu-id="0ea63-418">WF3 Working Set Delta</span></span>|<span data-ttu-id="0ea63-419">Zestaw roboczy WF4 Delta</span><span class="sxs-lookup"><span data-stu-id="0ea63-419">WF4 Working Set Delta</span></span>|
|---------------------|---------------------------|---------------------------|
|<span data-ttu-id="0ea63-420">Przepływy pracy hostowane w aplikacji konsoli</span><span class="sxs-lookup"><span data-stu-id="0ea63-420">Console Application Hosted Workflows</span></span>|<span data-ttu-id="0ea63-421">18 MB</span><span class="sxs-lookup"><span data-stu-id="0ea63-421">18 MB</span></span>|<span data-ttu-id="0ea63-422">9 MB</span><span class="sxs-lookup"><span data-stu-id="0ea63-422">9 MB</span></span>|
|<span data-ttu-id="0ea63-423">Usługi hostowanego przepływu pracy usług IIS</span><span class="sxs-lookup"><span data-stu-id="0ea63-423">IIS Hosted Workflow Services</span></span>|<span data-ttu-id="0ea63-424">446 MB</span><span class="sxs-lookup"><span data-stu-id="0ea63-424">446 MB</span></span>|<span data-ttu-id="0ea63-425">364 MB</span><span class="sxs-lookup"><span data-stu-id="0ea63-425">364 MB</span></span>|

 <span data-ttu-id="0ea63-426">Hosting definicji przepływu pracy w usługach IIS <xref:System.ServiceModel.WorkflowServiceHost>zużywa znacznie więcej pamięci ze względu na , szczegółowe artefakty usługi WCF i logiki przetwarzania wiadomości skojarzone z hostem.</span><span class="sxs-lookup"><span data-stu-id="0ea63-426">Hosting workflow definitions in IIS consumes much more memory due to the <xref:System.ServiceModel.WorkflowServiceHost>, detailed WCF service artifacts, and the message processing logic associated with the host.</span></span>

 <span data-ttu-id="0ea63-427">W przypadku hostingu konsoli w WF3 przepływy pracy zostały zaimplementowane w kodzie zamiast XOML.</span><span class="sxs-lookup"><span data-stu-id="0ea63-427">For console hosting in WF3 the workflows were implemented in code instead of XOML.</span></span>  <span data-ttu-id="0ea63-428">W WF4 domyślnym ustawieniem jest użycie xaml.</span><span class="sxs-lookup"><span data-stu-id="0ea63-428">In WF4 the default is to use XAML.</span></span>  <span data-ttu-id="0ea63-429">Kod XAML jest przechowywany jako osadzony zasób w zestawie i kompilowany w czasie wykonywania w celu zapewnienia implementacji przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-429">The XAML is stored as an embedded resource in the assembly and compiled during runtime to provide the implementation of the workflow.</span></span>  <span data-ttu-id="0ea63-430">Istnieje pewne obciążenie związane z tym procesem.</span><span class="sxs-lookup"><span data-stu-id="0ea63-430">There is some overhead associated with this process.</span></span>  <span data-ttu-id="0ea63-431">Aby dokonać uczciwego porównania między WF3 i WF4, zamiast XAML użyto zakodowanych przepływów pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-431">In order to make a fair comparison between WF3 and WF4, coded workflows were used instead of XAML.</span></span>  <span data-ttu-id="0ea63-432">Poniżej przedstawiono przykład jednego z przepływów pracy WF4:</span><span class="sxs-lookup"><span data-stu-id="0ea63-432">An example of one of the WF4 workflows is shown below:</span></span>

```csharp
public class Workflow1 : Activity
{
    protected override Func<Activity> Implementation
    {
        get
        {
            return new Func<Activity>(() =>
            {
                return new Sequence
                {
                    Activities = {
                        new Comment()
                    }
                };
            });
        }
        set
        {
            base.Implementation = value;
        }
    }
}
```

 <span data-ttu-id="0ea63-433">Istnieje wiele innych czynników, które mogą mieć wpływ na zużycie pamięci.</span><span class="sxs-lookup"><span data-stu-id="0ea63-433">There are many other factors that can affect memory consumption.</span></span> <span data-ttu-id="0ea63-434">Ta sama rada dla wszystkich zarządzanych programów nadal ma zastosowanie.</span><span class="sxs-lookup"><span data-stu-id="0ea63-434">The same advice for all managed programs still applies.</span></span>  <span data-ttu-id="0ea63-435">W środowiskach hostowanych usługami <xref:System.ServiceModel.WorkflowServiceHost> IIS obiekt utworzony dla definicji przepływu pracy pozostaje w pamięci do momentu odtworzenia puli aplikacji.</span><span class="sxs-lookup"><span data-stu-id="0ea63-435">In IIS-hosted environments, the <xref:System.ServiceModel.WorkflowServiceHost> object created for a workflow definition stays in memory until the application pool is recycled.</span></span>  <span data-ttu-id="0ea63-436">Należy o tym pamiętać podczas pisania rozszerzeń.</span><span class="sxs-lookup"><span data-stu-id="0ea63-436">This should be kept in mind when writing extensions.</span></span>  <span data-ttu-id="0ea63-437">Ponadto najlepiej jest unikać zmiennych "globalnych" (zmiennych o zakresie do całego przepływu pracy) i ograniczać zakres zmiennych tam, gdzie to możliwe.</span><span class="sxs-lookup"><span data-stu-id="0ea63-437">Also, it is best to avoid "global" variables (variables scoped to the whole workflow) and limit the scope of variables wherever possible.</span></span>

## <a name="workflow-runtime-services"></a><span data-ttu-id="0ea63-438">Usługi przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="0ea63-438">Workflow Runtime Services</span></span>

### <a name="persistence"></a><span data-ttu-id="0ea63-439">Trwałość</span><span class="sxs-lookup"><span data-stu-id="0ea63-439">Persistence</span></span>
 <span data-ttu-id="0ea63-440">WF3 i WF4 zarówno statek z dostawcą trwałości SQL.</span><span class="sxs-lookup"><span data-stu-id="0ea63-440">WF3 and WF4 both ship with a SQL persistence provider.</span></span>  <span data-ttu-id="0ea63-441">Dostawca trwałości SQL WF3 jest prostą implementacją, która serializuje wystąpienie przepływu pracy i przechowuje je w obiekcie blob.</span><span class="sxs-lookup"><span data-stu-id="0ea63-441">The WF3 SQL persistence provider is a simple implementation that serializes the workflow instance and stores it in a blob.</span></span>  <span data-ttu-id="0ea63-442">Z tego powodu wydajność tego dostawcy zależy w dużej mierze od rozmiaru wystąpienia przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-442">For this reason, the performance of this provider depends heavily on the size of the workflow instance.</span></span>  <span data-ttu-id="0ea63-443">W WF3 rozmiar wystąpienia może wzrosnąć z wielu powodów, jak zostało omówione wcześniej w tym dokumencie.</span><span class="sxs-lookup"><span data-stu-id="0ea63-443">In WF3, the instance size could increase for many reasons, as is discussed previously in this paper.</span></span>  <span data-ttu-id="0ea63-444">Wielu klientów nie chce używać domyślnego dostawcy trwałości SQL, ponieważ przechowywanie wystąpienia szeregowego w bazie danych nie daje wglądu w stan przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-444">Many customers choose not to use the default SQL persistence provider because storing a serialized instance in a database gives no visibility into the state of the workflow.</span></span>  <span data-ttu-id="0ea63-445">Aby znaleźć określonego przepływu pracy bez znajomości identyfikator przepływu pracy, trzeba by deserialize każdego utrwalonego wystąpienia i zbadać zawartość.</span><span class="sxs-lookup"><span data-stu-id="0ea63-445">In order to find a particular workflow without knowing the workflow id, one would have to deserialize each persisted instance and examine the contents.</span></span>  <span data-ttu-id="0ea63-446">Wielu programistów woli pisać własne dostawców trwałości, aby pokonać tę przeszkodę.</span><span class="sxs-lookup"><span data-stu-id="0ea63-446">Many developers prefer to write their own persistence providers to overcome this obstacle.</span></span>

 <span data-ttu-id="0ea63-447">Dostawca trwałości SQL WF4 próbował rozwiązać niektóre z tych problemów.</span><span class="sxs-lookup"><span data-stu-id="0ea63-447">The WF4 SQL persistence provider has tried to address some of these concerns.</span></span>  <span data-ttu-id="0ea63-448">Tabele trwałości uwidaczniają pewne informacje, takie jak aktywne zakładki i właściwości, które można promować.</span><span class="sxs-lookup"><span data-stu-id="0ea63-448">The persistence tables expose certain information such as the active bookmarks and promotable properties.</span></span>  <span data-ttu-id="0ea63-449">Nowa funkcja korelacji oparta na zawartości w WF4 nie będzie działać dobrze przy użyciu metody trwałości SQL WF3, co spowodowało pewne zmiany w organizacji wystąpienia utrwalonego przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-449">The new content-based correlation feature in WF4 would not perform well using the WF3 SQL persistence approach, which has driven some change in the organization of the persisted workflow instance.</span></span>  <span data-ttu-id="0ea63-450">To sprawia, że zadanie dostawcy trwałości bardziej złożone i stawia dodatkowy nacisk na bazie danych.</span><span class="sxs-lookup"><span data-stu-id="0ea63-450">This makes the job of the persistence provider more complex and puts extra stress on the database.</span></span>

### <a name="environment-setup"></a><span data-ttu-id="0ea63-451">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="0ea63-451">Environment Setup</span></span>
![Konfiguracja środowiska do testu wydajności przepływu pracy](./media/performance/performance-test-environment.gif)

### <a name="test-setup"></a><span data-ttu-id="0ea63-453">Ustawienia testu</span><span class="sxs-lookup"><span data-stu-id="0ea63-453">Test Setup</span></span>
 <span data-ttu-id="0ea63-454">Nawet z ulepszonym zestawem funkcji i lepszą obsługą współbieżności dostawca trwałości SQL w WF4 jest szybszy niż dostawca w WF3.</span><span class="sxs-lookup"><span data-stu-id="0ea63-454">Even with an improved feature set and better concurrency handling, the SQL persistence provider in WF4 is faster than the provider in WF3.</span></span>  <span data-ttu-id="0ea63-455">Aby to zaprezentować, dwa przepływy pracy, które wykonują zasadniczo te same operacje w WF3 i WF4 są porównywane poniżej.</span><span class="sxs-lookup"><span data-stu-id="0ea63-455">To showcase this, two workflows that perform essentially the same operations in WF3 and WF4 are compared below.</span></span>

 ![Przepływ pracy trwałości w WF3 po lewej i WF4 po prawej](./media/performance/persist-workflow-wf3-wf4.gif)

 <span data-ttu-id="0ea63-457">Oba przepływy pracy są tworzone przez odebraną wiadomość.</span><span class="sxs-lookup"><span data-stu-id="0ea63-457">The two workflows are both created by a received message.</span></span>  <span data-ttu-id="0ea63-458">Po wysłaniu początkowej odpowiedzi przepływ pracy jest utrwalony.</span><span class="sxs-lookup"><span data-stu-id="0ea63-458">After sending an initial reply, the workflow is persisted.</span></span>  <span data-ttu-id="0ea63-459">W przypadku WF3 puste <xref:System.Workflow.ComponentModel.TransactionScopeActivity> jest używany do inicjowania trwałości.</span><span class="sxs-lookup"><span data-stu-id="0ea63-459">In the WF3 case, an empty <xref:System.Workflow.ComponentModel.TransactionScopeActivity> is used to initiate the persistence.</span></span>  <span data-ttu-id="0ea63-460">To samo można osiągnąć w WF3, oznaczając działanie jako "utrzymują się na zamknięciu".</span><span class="sxs-lookup"><span data-stu-id="0ea63-460">The same could be achieved in WF3 by marking an activity as "persist on close."</span></span>  <span data-ttu-id="0ea63-461">Drugi, skorelowany komunikat kończy przepływ pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-461">A second, correlated message completes the workflow.</span></span>  <span data-ttu-id="0ea63-462">Przepływy pracy są utrwalone, ale nie zwalniane.</span><span class="sxs-lookup"><span data-stu-id="0ea63-462">The workflows are persisted but not unloaded.</span></span>

### <a name="test-results"></a><span data-ttu-id="0ea63-463">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="0ea63-463">Test Results</span></span>
 ![Wykres kolumnowy przedstawiający trwałość przepływności](./media/performance/throughput-persistence-graph.gif)

 <span data-ttu-id="0ea63-465">Gdy transport między warstwą klienta i środkowej jest HTTP, trwałość w WF4 pokazuje poprawę 2,6 razy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-465">When the transport between client and middle tier is HTTP, persistence in WF4 shows an improvement of 2.6 times.</span></span>  <span data-ttu-id="0ea63-466">Transport TCP zwiększa ten współczynnik do 3,0 razy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-466">The TCP transport increases that factor to 3.0 times.</span></span>  <span data-ttu-id="0ea63-467">We wszystkich przypadkach wykorzystanie procesora CPU w warstwie środkowej wynosi 98% lub więcej.</span><span class="sxs-lookup"><span data-stu-id="0ea63-467">In all cases, CPU utilization on the middle tier is 98% or higher.</span></span>  <span data-ttu-id="0ea63-468">Powodem, dla którego przepływność WF4 jest większa, jest szybsze środowisko wykonawcze przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-468">The reason that WF4 throughput is greater is due to the faster workflow runtime.</span></span>  <span data-ttu-id="0ea63-469">Rozmiar wystąpienia serializowanego jest niski dla obu przypadków i nie jest głównym elementem przyczyniającym się w tej sytuacji.</span><span class="sxs-lookup"><span data-stu-id="0ea63-469">The size of the serialized instance is low for both cases and is not a major contributing element in this situation.</span></span>

 <span data-ttu-id="0ea63-470">Przepływy pracy WF3 i WF4 w tym teście używają działania, aby jawnie wskazać, kiedy powinna wystąpić trwałość.</span><span class="sxs-lookup"><span data-stu-id="0ea63-470">Both the WF3 and WF4 workflows in this test use an activity to explicitly indicate when persistence should occur.</span></span>  <span data-ttu-id="0ea63-471">Ma to zaletę utrwalania przepływu pracy bez zwalniania go.</span><span class="sxs-lookup"><span data-stu-id="0ea63-471">This has the benefit of persisting the workflow without unloading it.</span></span>  <span data-ttu-id="0ea63-472">W WF3 jest również możliwe do <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> utrwalenia przy użyciu funkcji, ale to zwalnia wystąpienie przepływu pracy z pamięci.</span><span class="sxs-lookup"><span data-stu-id="0ea63-472">In WF3, it is also possible to persist using the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> feature, but this unloads the workflow instance from memory.</span></span>  <span data-ttu-id="0ea63-473">Jeśli deweloper przy użyciu WF3 chce upewnić się, że przepływ pracy utrzymuje się w niektórych punktach, muszą zmienić definicję przepływu pracy lub zapłacić koszt zwalniania i ponownego ładowania wystąpienia przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-473">If a developer using WF3 wants to make sure a workflow persists at certain points, they either have to alter the workflow definition or pay the cost for unloading and re-loading the workflow instance.</span></span>  <span data-ttu-id="0ea63-474">Nowa funkcja w WF4 umożliwia utrzymywanie się <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>bez rozładunku: .</span><span class="sxs-lookup"><span data-stu-id="0ea63-474">A new feature in WF4 makes it possible to persist without unloading: <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>.</span></span>  <span data-ttu-id="0ea63-475">Ta funkcja umożliwia wystąpienie przepływu pracy do utrwalenia na <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> bezczynności, ale pozostanie w pamięci, dopóki próg zostanie osiągnięty lub wykonanie zostanie wznowione.</span><span class="sxs-lookup"><span data-stu-id="0ea63-475">This feature allows the workflow instance to be persisted on idle but stay in memory until the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> threshold is met or execution is resumed.</span></span>

 <span data-ttu-id="0ea63-476">Należy zauważyć, że dostawca trwałości SQL WF4 wykonuje więcej pracy w warstwie bazy danych.</span><span class="sxs-lookup"><span data-stu-id="0ea63-476">Note that the WF4 SQL persistence provider performs more work in the database tier.</span></span>  <span data-ttu-id="0ea63-477">Baza danych SQL może stać się wąskim gardłem, dlatego ważne jest, aby monitorować użycie procesora i dysku.</span><span class="sxs-lookup"><span data-stu-id="0ea63-477">The SQL database can become a bottleneck so it is important to monitor the CPU and disk usage there.</span></span>  <span data-ttu-id="0ea63-478">Podczas testowania wydajności aplikacji przepływu pracy należy dołączyć następujące liczniki wydajności z bazy danych SQL:</span><span class="sxs-lookup"><span data-stu-id="0ea63-478">Be sure to include the following performance counters from the SQL database when performance testing workflow applications:</span></span>

- <span data-ttu-id="0ea63-479">Fizyczny\\dysk twardy %Czas odczytu dysku</span><span class="sxs-lookup"><span data-stu-id="0ea63-479">PhysicalDisk\\%Disk Read Time</span></span>

- <span data-ttu-id="0ea63-480">Fizyczny\\dysk % czasu dysku</span><span class="sxs-lookup"><span data-stu-id="0ea63-480">PhysicalDisk\\% Disk Time</span></span>

- <span data-ttu-id="0ea63-481">Fizyczny\\dysk procentowy czas zapisu dysku</span><span class="sxs-lookup"><span data-stu-id="0ea63-481">PhysicalDisk\\% Disk Write Time</span></span>

- <span data-ttu-id="0ea63-482">PhysicalDisk\\% Średnia długość kolejki dysku</span><span class="sxs-lookup"><span data-stu-id="0ea63-482">PhysicalDisk\\% Avg. Disk Queue Length</span></span>

- <span data-ttu-id="0ea63-483">PhysicalDisk\Średnia długość kolejki odczytu dysku</span><span class="sxs-lookup"><span data-stu-id="0ea63-483">PhysicalDisk\Avg. Disk Read Queue Length</span></span>

- <span data-ttu-id="0ea63-484">PhysicalDisk\Średnia długość kolejki zapisu dysku</span><span class="sxs-lookup"><span data-stu-id="0ea63-484">PhysicalDisk\Avg. Disk Write Queue Length</span></span>

- <span data-ttu-id="0ea63-485">Dysk fizyczny\Bieżąca długość kolejki dysku</span><span class="sxs-lookup"><span data-stu-id="0ea63-485">PhysicalDisk\Current Disk Queue Length</span></span>

- <span data-ttu-id="0ea63-486">Procesor\\— % czasu procesora</span><span class="sxs-lookup"><span data-stu-id="0ea63-486">Processor Information\\% Processor Time</span></span>

- <span data-ttu-id="0ea63-487">SERWER SQL: Zatrzaski\Średni czas oczekiwania na zatrzask (ms)</span><span class="sxs-lookup"><span data-stu-id="0ea63-487">SQLServer:Latches\Average Latch Wait Time (ms)</span></span>

- <span data-ttu-id="0ea63-488">SERWER SQL: Zatrzaski\Zatrzask oczekiwania/s</span><span class="sxs-lookup"><span data-stu-id="0ea63-488">SQLServer:Latches\Latch Waits/sec</span></span>

### <a name="tracking"></a><span data-ttu-id="0ea63-489">Śledzenie</span><span class="sxs-lookup"><span data-stu-id="0ea63-489">Tracking</span></span>
 <span data-ttu-id="0ea63-490">Śledzenie przepływu pracy może służyć do śledzenia postępu przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-490">Workflow tracking can be used to track the progress of a workflow.</span></span>  <span data-ttu-id="0ea63-491">Informacje zawarte w zdarzeniach śledzenia są określane przez profil śledzenia.</span><span class="sxs-lookup"><span data-stu-id="0ea63-491">The information that is included in the tracking events is determined by a tracking profile.</span></span>  <span data-ttu-id="0ea63-492">Im bardziej złożony jest profil śledzenia, tym droższe staje się śledzenie.</span><span class="sxs-lookup"><span data-stu-id="0ea63-492">The more complex the tracking profile, the more expensive tracking becomes.</span></span>

 <span data-ttu-id="0ea63-493">WF3 dostarczane z usługą śledzenia opartą na języku SQL.</span><span class="sxs-lookup"><span data-stu-id="0ea63-493">WF3 shipped with a SQL-based tracking service.</span></span>  <span data-ttu-id="0ea63-494">Ta usługa może działać w trybach wsadowych i nieprzemierowanych.</span><span class="sxs-lookup"><span data-stu-id="0ea63-494">This service could work in batched and non-batched modes.</span></span>  <span data-ttu-id="0ea63-495">W trybie niewymiernym zdarzenia śledzenia są zapisywane bezpośrednio do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="0ea63-495">In non-batched mode, tracking events are written directly to the database.</span></span>  <span data-ttu-id="0ea63-496">W trybie wsadowym zdarzenia śledzenia są zbierane w tej samej partii co stan wystąpienia przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-496">In batched mode, tracking events are collected into the same batch as the workflow instance state.</span></span>  <span data-ttu-id="0ea63-497">Tryb wsadowy ma najlepszą wydajność dla najszerszego zakresu projektów przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="0ea63-497">The batched mode has the best performance for the widest range of workflow designs.</span></span>  <span data-ttu-id="0ea63-498">Jednak przetwarzanie wsadowe może mieć negatywny wpływ na wydajność, jeśli przepływ pracy uruchamia wiele działań bez utrwalania i te działania są śledzone.</span><span class="sxs-lookup"><span data-stu-id="0ea63-498">However, batching can have a negative performance impact if the workflow runs many activities without persisting and those activities are tracked.</span></span>  <span data-ttu-id="0ea63-499">Często zdarza się to w pętli i najlepszym sposobem uniknięcia tego scenariusza jest zaprojektowanie dużych pętli, aby zawierały punkt trwałości.</span><span class="sxs-lookup"><span data-stu-id="0ea63-499">This would commonly happen in loops and the best way to avoid this scenario is to design large loops to contain a persistence point.</span></span>  <span data-ttu-id="0ea63-500">Wprowadzenie punktu trwałości do pętli może negatywnie wpłynąć na wydajność, więc ważne jest, aby zmierzyć koszty każdego z nich i wymyślić równowagę.</span><span class="sxs-lookup"><span data-stu-id="0ea63-500">Introducing a persistence point into a loop can negatively affect performance as well so it is important to measure the costs of each and come up with a balance.</span></span>

 <span data-ttu-id="0ea63-501">WF4 nie jest dostarczany z usługą śledzenia SQL.</span><span class="sxs-lookup"><span data-stu-id="0ea63-501">WF4 is not shipped with a SQL tracking service.</span></span>  <span data-ttu-id="0ea63-502">Rejestrowanie informacji śledzenia do bazy danych SQL mogą być obsługiwane lepiej z serwera aplikacji, a nie wbudowane w programie .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="0ea63-502">Recording tracking information to a SQL database can be handled better from an application server rather than built into the .NET Framework.</span></span> <span data-ttu-id="0ea63-503">W związku z tym śledzenie SQL jest teraz obsługiwane przez AppFabric.</span><span class="sxs-lookup"><span data-stu-id="0ea63-503">Therefore SQL tracking is now handled by AppFabric.</span></span>  <span data-ttu-id="0ea63-504">Dostawca śledzenia out-of-the-box w WF4 jest oparty na śledzenie zdarzeń dla systemu Windows (ETW).</span><span class="sxs-lookup"><span data-stu-id="0ea63-504">The out-of-the-box tracking provider in WF4 is based on Event Tracing for Windows (ETW).</span></span>

 <span data-ttu-id="0ea63-505">ETW to system zdarzeń na poziomie jądra o małym opóźnieniu wbudowany w system Windows.</span><span class="sxs-lookup"><span data-stu-id="0ea63-505">ETW is a kernel-level, low-latency event system built into Windows.</span></span>  <span data-ttu-id="0ea63-506">Używa modelu dostawcy/konsumenta, który umożliwia poniesienie kary za śledzenie zdarzeń tylko wtedy, gdy faktycznie istnieje konsument.</span><span class="sxs-lookup"><span data-stu-id="0ea63-506">It uses a provider/consumer model that makes it possible to only incur the penalty for event tracing when there is actually a consumer.</span></span>  <span data-ttu-id="0ea63-507">Oprócz zdarzeń jądra, takich jak procesor, dysk, pamięć i użycie sieci, wiele aplikacji wykorzystuje również ETW.</span><span class="sxs-lookup"><span data-stu-id="0ea63-507">In addition to kernel events such as processor, disk, memory, and network usage, many applications leverage ETW as well.</span></span>  <span data-ttu-id="0ea63-508">Zdarzenia ETW są bardziej wydajne niż liczniki wydajności, w tym zdarzenia można dostosować do aplikacji.</span><span class="sxs-lookup"><span data-stu-id="0ea63-508">ETW events are more powerful than performance counters in that events can be customized to the application.</span></span>  <span data-ttu-id="0ea63-509">Zdarzenie może zawierać tekst, taki jak identyfikator przepływu pracy lub komunikat informacyjny.</span><span class="sxs-lookup"><span data-stu-id="0ea63-509">An event can contain text such as a workflow ID or an informational message.</span></span>  <span data-ttu-id="0ea63-510">Ponadto zdarzenia są klasyfikowane za pomocą masek bitowych, dzięki czemu użycie określonego podzbioru zdarzeń będzie miało mniejszy wpływ na wydajność niż przechwytywanie wszystkich zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="0ea63-510">Also, events are categorized with bitmasks so that consuming a certain subset of events will have less performance impact than capturing all events.</span></span>

 <span data-ttu-id="0ea63-511">Korzyści z podejścia przy użyciu ETW do śledzenia zamiast SQL obejmują:</span><span class="sxs-lookup"><span data-stu-id="0ea63-511">Benefits to the approach of using ETW for tracking instead of SQL include:</span></span>

- <span data-ttu-id="0ea63-512">Zbieranie zdarzeń śledzenia można podzielić na inny proces.</span><span class="sxs-lookup"><span data-stu-id="0ea63-512">Collection of tracking events can be separated to another process.</span></span>  <span data-ttu-id="0ea63-513">Daje to większą elastyczność w sposobie rejestrowania zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="0ea63-513">This gives greater flexibility in how the events are recorded.</span></span>

- <span data-ttu-id="0ea63-514">Zdarzenia śledzenia ETW są łatwo łączone ze zdarzeniami WCF ETW lub innymi dostawcami ETW, takimi jak SQL Server lub dostawca jądra.</span><span class="sxs-lookup"><span data-stu-id="0ea63-514">ETW tracking events are easily combined with the WCF ETW events or other ETW providers such as a SQL Server or kernel provider.</span></span>

- <span data-ttu-id="0ea63-515">Autorzy przepływu pracy nie trzeba zmieniać przepływu pracy, aby lepiej działać z określonej implementacji śledzenia, takich jak WF3 SQL śledzenia usługi wsadowego trybu.</span><span class="sxs-lookup"><span data-stu-id="0ea63-515">Workflow authors do not need to alter a workflow to work better with a particular tracking implementation, such as the WF3 SQL tracking service’s batch mode.</span></span>

- <span data-ttu-id="0ea63-516">Administrator może włączyć lub wyłączyć śledzenie bez recyklingu procesu hosta.</span><span class="sxs-lookup"><span data-stu-id="0ea63-516">An administrator can turn tracking on or off without recycling the host process.</span></span>

 <span data-ttu-id="0ea63-517">Korzyści z wydajności śledzenia ETW są wadą.</span><span class="sxs-lookup"><span data-stu-id="0ea63-517">The performance benefits to ETW tracking come with a drawback.</span></span>  <span data-ttu-id="0ea63-518">Zdarzenia ETW mogą zostać utracone, jeśli system znajduje się pod silną presją zasobów.</span><span class="sxs-lookup"><span data-stu-id="0ea63-518">ETW events can be lost if the system is under intense resource pressure.</span></span>  <span data-ttu-id="0ea63-519">Przetwarzanie zdarzeń nie ma na celu zablokowania normalnego wykonywania programu i dlatego nie ma gwarancji, że wszystkie zdarzenia ETW będą transmitowane do ich subskrybentów.</span><span class="sxs-lookup"><span data-stu-id="0ea63-519">The processing of events is not meant to block normal program execution and therefore it is not guaranteed that all ETW events will be broadcast to their subscribers.</span></span>  <span data-ttu-id="0ea63-520">To sprawia, że śledzenie ETW doskonale nadaje się do monitorowania kondycji, ale nie nadaje się do inspekcji.</span><span class="sxs-lookup"><span data-stu-id="0ea63-520">This makes ETW tracking great for health monitoring but not suitable for auditing.</span></span>

 <span data-ttu-id="0ea63-521">Chociaż WF4 nie ma dostawcy śledzenia SQL, AppFabric nie.</span><span class="sxs-lookup"><span data-stu-id="0ea63-521">While WF4 does not have a SQL tracking provider, AppFabric does.</span></span>  <span data-ttu-id="0ea63-522">AppFabric's SQL tracking podejście jest subskrybować zdarzenia ETW z usługi systemu Windows, która partii zdarzeń i zapisuje je do tabeli SQL przeznaczone do szybkiego wstawienia.</span><span class="sxs-lookup"><span data-stu-id="0ea63-522">AppFabric’s SQL tracking approach is to subscribe to ETW events with a Windows Service that batches the events and writes them to a SQL table designed for quick inserts.</span></span>  <span data-ttu-id="0ea63-523">Oddzielne zadanie opróżnia dane z tej tabeli i przekształca je w tabele raportowania, które można wyświetlić na pulpicie nawigacyjnym AppFabric.</span><span class="sxs-lookup"><span data-stu-id="0ea63-523">A separate job drains the data from this table and reforms it into reporting tables that can be viewed on the AppFabric dashboard.</span></span>  <span data-ttu-id="0ea63-524">Oznacza to, że partia zdarzeń śledzenia jest obsługiwana niezależnie od przepływu pracy, z których pochodzi i dlatego nie musi czekać na punkt trwałości przed zarejestrowaniem.</span><span class="sxs-lookup"><span data-stu-id="0ea63-524">This means that a batch of tracking events is handled independent of the workflow it came from and therefore does not have to wait for a persistence point before being recorded.</span></span>

 <span data-ttu-id="0ea63-525">Zdarzenia ETW mogą być rejestrowane za pomocą narzędzi, takich jak logman lub xperf.</span><span class="sxs-lookup"><span data-stu-id="0ea63-525">ETW events can be recorded with tools such as logman or xperf.</span></span>  <span data-ttu-id="0ea63-526">Kompaktowy plik ETL można przeglądać za pomocą narzędzia, takiego jak xperfview lub konwertować na bardziej czytelny format, taki jak XML, z tracerpt.</span><span class="sxs-lookup"><span data-stu-id="0ea63-526">The compact ETL file can be viewed with a tool like xperfview or converted to a more readable format, such as XML, with tracerpt.</span></span>  <span data-ttu-id="0ea63-527">W WF3 jedyną opcją pobierania śledzenia zdarzeń bez bazy danych SQL jest utworzenie niestandardowej usługi śledzenia.</span><span class="sxs-lookup"><span data-stu-id="0ea63-527">In WF3, the only option for getting tracking events without a SQL database is to create a custom tracking service.</span></span> <span data-ttu-id="0ea63-528">Aby uzyskać więcej informacji na temat ETW, zobacz [Usługi WCF i śledzenie zdarzeń dla systemu Windows](../wcf/samples/wcf-services-and-event-tracing-for-windows.md) i śledzenie zdarzeń — [aplikacje systemu Windows](/windows/desktop/etw/event-tracing-portal).</span><span class="sxs-lookup"><span data-stu-id="0ea63-528">For more information about ETW, see [WCF Services and Event Tracing for Windows](../wcf/samples/wcf-services-and-event-tracing-for-windows.md) and [Event Tracing - Windows applications](/windows/desktop/etw/event-tracing-portal).</span></span>

 <span data-ttu-id="0ea63-529">Włączenie śledzenia przepływu pracy wpłynie na wydajność w różnym stopniu.</span><span class="sxs-lookup"><span data-stu-id="0ea63-529">Enabling workflow tracking will impact performance in varying degrees.</span></span>  <span data-ttu-id="0ea63-530">Poniższy benchmark używa narzędzia logman do korzystania ze zdarzeń śledzenia ETW i rejestrowania ich w pliku ETL.</span><span class="sxs-lookup"><span data-stu-id="0ea63-530">The benchmark below uses the logman tool to consume the ETW tracking events and record them to an ETL file.</span></span>  <span data-ttu-id="0ea63-531">Koszt śledzenia SQL w AppFabric nie jest w zakresie tego artykułu.</span><span class="sxs-lookup"><span data-stu-id="0ea63-531">The cost of the SQL tracking in AppFabric is not in the scope of this article.</span></span>  <span data-ttu-id="0ea63-532">Podstawowy profil śledzenia, również używany w AppFabric, jest pokazany w tym benchmarku.</span><span class="sxs-lookup"><span data-stu-id="0ea63-532">The basic tracking profile, also used in AppFabric, is shown in this benchmark.</span></span>  <span data-ttu-id="0ea63-533">Uwzględniono również koszt śledzenia tylko zdarzeń monitorowania kondycji.</span><span class="sxs-lookup"><span data-stu-id="0ea63-533">Also included is the cost of tracking only health monitoring events.</span></span>  <span data-ttu-id="0ea63-534">Zdarzenia te są przydatne do rozwiązywania problemów i określania średniej przepływności systemu.</span><span class="sxs-lookup"><span data-stu-id="0ea63-534">These events are useful for troubleshooting problems and determining the average throughput of the system.</span></span>

### <a name="environment-setup"></a><span data-ttu-id="0ea63-535">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="0ea63-535">Environment Setup</span></span>
 ![Konfiguracja środowiska do testu wydajności przepływu pracy](./media/performance/performance-test-environment.gif)

### <a name="test-results"></a><span data-ttu-id="0ea63-537">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="0ea63-537">Test Results</span></span>

 ![Wykres kolumnowy przedstawiający koszty śledzenia przepływu pracy](./media/performance/workflow-tracking-costs.gif)

 <span data-ttu-id="0ea63-539">Monitorowanie kondycji ma około 3% wpływ na przepustowość.</span><span class="sxs-lookup"><span data-stu-id="0ea63-539">Health monitoring has roughly a 3% impact on throughput.</span></span>  <span data-ttu-id="0ea63-540">Koszt profilu podstawowego wynosi około 8%.</span><span class="sxs-lookup"><span data-stu-id="0ea63-540">The basic profile’s cost is around 8%.</span></span>

## <a name="interop"></a><span data-ttu-id="0ea63-541">Interop</span><span class="sxs-lookup"><span data-stu-id="0ea63-541">Interop</span></span>
 <span data-ttu-id="0ea63-542">WF4 jest prawie pełne [!INCLUDE[wf1](../../../includes/wf1-md.md)] przepisanie i dlatego WF3 przepływów pracy i działań nie są bezpośrednio zgodne z WF4.</span><span class="sxs-lookup"><span data-stu-id="0ea63-542">WF4 is almost a complete rewrite of [!INCLUDE[wf1](../../../includes/wf1-md.md)] and therefore WF3 workflows and activities are not directly compatible with WF4.</span></span>  <span data-ttu-id="0ea63-543">Wielu klientów, którzy przyjęli Windows Workflow Foundation wcześnie będzie miał w domu lub innych firm definicji przepływu pracy i działań niestandardowych dla WF3.</span><span class="sxs-lookup"><span data-stu-id="0ea63-543">Many customers that adopted Windows Workflow Foundation early will have in-house or third-party workflow definitions and custom activities for WF3.</span></span>  <span data-ttu-id="0ea63-544">Jednym ze sposobów ułatwienia przejścia do WF4 jest użycie działania Interop, które można wykonywać działania WF3 z poziomu przepływu pracy WF4.</span><span class="sxs-lookup"><span data-stu-id="0ea63-544">One way to ease the transition to WF4 is to use the Interop activity, which can execute WF3 activities from within a WF4 workflow.</span></span>  <span data-ttu-id="0ea63-545">Zaleca się, <xref:System.Activities.Statements.Interop> aby działanie było używane tylko wtedy, gdy jest to konieczne.</span><span class="sxs-lookup"><span data-stu-id="0ea63-545">It is recommended that the <xref:System.Activities.Statements.Interop> activity only be used when necessary.</span></span> <span data-ttu-id="0ea63-546">Aby uzyskać więcej informacji na temat migracji do WF4, zapoznaj się z [wytycznymi dotyczącymi migracji WF4](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="0ea63-546">For more information about migrating to WF4 check out the [WF4 Migration Guidance](migration-guidance.md).</span></span>

### <a name="environment-setup"></a><span data-ttu-id="0ea63-547">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="0ea63-547">Environment Setup</span></span>
 ![Konfiguracja środowiska do testu wydajności przepływu pracy](./media/performance/performance-test-environment.gif)

### <a name="test-results"></a><span data-ttu-id="0ea63-549">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="0ea63-549">Test Results</span></span>

<span data-ttu-id="0ea63-550">W poniższej tabeli przedstawiono wyniki uruchamiania przepływu pracy zawierającego pięć działań w sekwencji w różnych konfiguracjach.</span><span class="sxs-lookup"><span data-stu-id="0ea63-550">The following table shows the results of running a workflow containing five activities in a sequence in various configurations.</span></span>

|<span data-ttu-id="0ea63-551">Testowanie</span><span class="sxs-lookup"><span data-stu-id="0ea63-551">Test</span></span>|<span data-ttu-id="0ea63-552">Przepływność (przepływy pracy/s)</span><span class="sxs-lookup"><span data-stu-id="0ea63-552">Throughput (workflows/sec)</span></span>|
|----------|-----------------------------------|
|<span data-ttu-id="0ea63-553">Sekwencja WF3 w czasie wykonywania WF3</span><span class="sxs-lookup"><span data-stu-id="0ea63-553">WF3 Sequence in WF3 runtime</span></span>|<span data-ttu-id="0ea63-554">1,576</span><span class="sxs-lookup"><span data-stu-id="0ea63-554">1,576</span></span>|
|<span data-ttu-id="0ea63-555">Sekwencja WF3 w czasie wykonywania WF4 przy użyciu interop</span><span class="sxs-lookup"><span data-stu-id="0ea63-555">WF3 Sequence in WF4 runtime using Interop</span></span>|<span data-ttu-id="0ea63-556">2,745</span><span class="sxs-lookup"><span data-stu-id="0ea63-556">2,745</span></span>|
|<span data-ttu-id="0ea63-557">Sekwencja WF4</span><span class="sxs-lookup"><span data-stu-id="0ea63-557">WF4 Sequence</span></span>|<span data-ttu-id="0ea63-558">153,582</span><span class="sxs-lookup"><span data-stu-id="0ea63-558">153,582</span></span>|

 <span data-ttu-id="0ea63-559">Istnieje znaczny wzrost wydajności przy użyciu Interop na prostej WF3.</span><span class="sxs-lookup"><span data-stu-id="0ea63-559">There is a notable performance increase to using Interop over straight WF3.</span></span>  <span data-ttu-id="0ea63-560">Jednak w porównaniu z działalnością WF4 wzrost ten jest nieznaczny.</span><span class="sxs-lookup"><span data-stu-id="0ea63-560">However, when compared against WF4 activities, the increase is negligible.</span></span>

## <a name="summary"></a><span data-ttu-id="0ea63-561">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="0ea63-561">Summary</span></span>
 <span data-ttu-id="0ea63-562">Duże inwestycje w wyniki dla WF4 opłaciły się w wielu kluczowych obszarach.</span><span class="sxs-lookup"><span data-stu-id="0ea63-562">Heavy investments in performance for WF4 have paid off in many crucial areas.</span></span>  <span data-ttu-id="0ea63-563">Wydajność poszczególnych składników przepływu pracy jest w niektórych przypadkach setki razy szybsza w [!INCLUDE[wf1](../../../includes/wf1-md.md)] WF4 w porównaniu do WF3 ze względu na szczuplejsze środowisko uruchomieniowe.</span><span class="sxs-lookup"><span data-stu-id="0ea63-563">Individual workflow component performance is in some cases hundreds of times faster in WF4 compared to WF3 due to a leaner [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="0ea63-564">Numery opóźnień są znacznie lepsze, jak również.</span><span class="sxs-lookup"><span data-stu-id="0ea63-564">Latency numbers are significantly better as well.</span></span>  <span data-ttu-id="0ea63-565">Oznacza to, że [!INCLUDE[wf1](../../../includes/wf1-md.md)] kara za wykonanie za pomocą, w przeciwieństwie do ręcznego kodowania [!INCLUDE[wf1](../../../includes/wf1-md.md)]usług Aranżacji WCF jest bardzo mała, biorąc pod uwagę dodatkowe korzyści z używania .</span><span class="sxs-lookup"><span data-stu-id="0ea63-565">This means the performance penalty for using [!INCLUDE[wf1](../../../includes/wf1-md.md)] as opposed to hand-coding WCF orchestration services is very small considering the added benefits of using [!INCLUDE[wf1](../../../includes/wf1-md.md)].</span></span>  <span data-ttu-id="0ea63-566">Wydajność trwałości wzrosła o współczynnik 2,5 - 3,0.</span><span class="sxs-lookup"><span data-stu-id="0ea63-566">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="0ea63-567">Monitorowanie kondycji za pomocą śledzenia przepływu pracy ma teraz bardzo mało narzutów.</span><span class="sxs-lookup"><span data-stu-id="0ea63-567">Health monitoring by means of workflow tracking now has very little overhead.</span></span>  <span data-ttu-id="0ea63-568">Kompleksowy zestaw przewodników migracji są dostępne dla tych, którzy rozważają przejście z WF3 do WF4.</span><span class="sxs-lookup"><span data-stu-id="0ea63-568">A comprehensive set of migration guides are available for those that are considering moving from WF3 to WF4.</span></span>  <span data-ttu-id="0ea63-569">Wszystko to powinno sprawić, że WF4 będzie atrakcyjną opcją do pisania złożonych aplikacji.</span><span class="sxs-lookup"><span data-stu-id="0ea63-569">All of this should make WF4 an attractive option for writing complex applications.</span></span>
