---
title: Windows Workflow Foundation 4 wydajności
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: 67d2b3e8-3777-49f8-9084-abbb33b5a766
caps.latest.revision: 9
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload:
- dotnet
ms.openlocfilehash: ae5bf1088ec03229eb996b0e43b3d3395497571a
ms.sourcegitcommit: 03ee570f6f528a7d23a4221dcb26a9498edbdf8c
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/28/2018
---
# <a name="windows-workflow-foundation-4-performance"></a><span data-ttu-id="e7a7a-102">Windows Workflow Foundation 4 wydajności</span><span class="sxs-lookup"><span data-stu-id="e7a7a-102">Windows Workflow Foundation 4 Performance</span></span>
<span data-ttu-id="e7a7a-103">Dustin Metzgar</span><span class="sxs-lookup"><span data-stu-id="e7a7a-103">Dustin Metzgar</span></span>  
  
 <span data-ttu-id="e7a7a-104">Wenlong Dong</span><span class="sxs-lookup"><span data-stu-id="e7a7a-104">Wenlong Dong</span></span>  
  
 <span data-ttu-id="e7a7a-105">We wrześniu 2010 Microsoft Corporation</span><span class="sxs-lookup"><span data-stu-id="e7a7a-105">Microsoft Corporation, September 2010</span></span>  
  
 <span data-ttu-id="e7a7a-106">Microsoft [!INCLUDE[netfx40_long](../../../includes/netfx40-long-md.md)] zawiera znaczne zmiany z systemu Windows Workflow Foundation (WF) z dużych inwestycji w wydajności.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-106">Microsoft [!INCLUDE[netfx40_long](../../../includes/netfx40-long-md.md)] includes a major revision of the Windows Workflow Foundation (WF) with heavy investments in performance.</span></span>  <span data-ttu-id="e7a7a-107">Ta nowa wersja wprowadza znaczących zmian z poprzednich wersji [!INCLUDE[wf1](../../../includes/wf1-md.md)] dostarczonego w ramach programu .NET Framework 3.0 i [!INCLUDE[netfx35_short](../../../includes/netfx35-short-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e7a7a-107">This new revision introduces significant design changes from the previous versions of [!INCLUDE[wf1](../../../includes/wf1-md.md)] that shipped as part of .NET Framework 3.0 and [!INCLUDE[netfx35_short](../../../includes/netfx35-short-md.md)].</span></span> <span data-ttu-id="e7a7a-108">Została zmieniona z rdzenia modelu programowania, środowiska uruchomieniowego i narzędzi, aby znacznie zwiększyć wydajność i użyteczność.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-108">It has been re-architected from the core of the programming model, runtime, and tooling to greatly improve performance and usability.</span></span> <span data-ttu-id="e7a7a-109">W tym temacie przedstawiono ważne charakterystyki tych zmian i porównuje je z tych funkcji w poprzedniej wersji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-109">This topic shows the important performance characteristics of these revisions and compares them against those of the previous version.</span></span>  
  
 <span data-ttu-id="e7a7a-110">Zwiększa wydajność składników przepływu pracy o rzędów między WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-110">Individual workflow component performance has increased by orders of magnitude between WF3 and WF4.</span></span>  <span data-ttu-id="e7a7a-111">To pozostawia odstęp między kodowane ręcznie [!INCLUDE[indigo1](../../../includes/indigo1-md.md)] usług i [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] usług przepływu pracy będzie bardzo mała.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-111">This leaves the gap between hand-coded [!INCLUDE[indigo1](../../../includes/indigo1-md.md)] services and [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] workflow services to be quite small.</span></span>  <span data-ttu-id="e7a7a-112">Opóźnienie przepływu pracy została znacząco zmniejszona w WF4.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-112">Workflow latency has been significantly reduced in WF4.</span></span>  <span data-ttu-id="e7a7a-113">Zwiększa wydajność trwałości przez współczynnik 2.5 3.0.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-113">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="e7a7a-114">Monitorowanie kondycji za pomocą śledzenia przepływu pracy ma znacznie mniejsze koszty.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-114">Health monitoring by means of workflow tracking has significantly less overhead.</span></span>  <span data-ttu-id="e7a7a-115">Są one istotne powody migrację do lub przyjąć WF4 w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-115">These are compelling reasons to migrate to or adopt WF4 in your applications.</span></span>  
  
## <a name="terminology"></a><span data-ttu-id="e7a7a-116">Terminologia</span><span class="sxs-lookup"><span data-stu-id="e7a7a-116">Terminology</span></span>  
 <span data-ttu-id="e7a7a-117">Wersja [!INCLUDE[wf1](../../../includes/wf1-md.md)] wprowadzone w systemie [!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)] zostaną określone jako WF4 w pozostałej części tego tematu.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-117">The version of [!INCLUDE[wf1](../../../includes/wf1-md.md)] introduced in [!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)] will be referred to as WF4 for the rest of this topic.</span></span>  [!INCLUDE[wf1](../../../includes/wf1-md.md)]<span data-ttu-id="e7a7a-118"> został wprowadzony w .net 3.0 i ma kilka drobne poprawki za pośrednictwem [!INCLUDE[netfx35_short](../../../includes/netfx35-short-md.md)] z dodatkiem SP1.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-118"> was introduced in .Net 3.0 and had a few minor revisions through [!INCLUDE[netfx35_short](../../../includes/netfx35-short-md.md)] SP1.</span></span> <span data-ttu-id="e7a7a-119">[!INCLUDE[netfx35_short](../../../includes/netfx35-short-md.md)] Wersji programu Workflow Foundation zostaną określone jako WF3 w pozostałej części tego tematu.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-119">The [!INCLUDE[netfx35_short](../../../includes/netfx35-short-md.md)] version of Workflow Foundation will be referred to as WF3 for the rest of this topic.</span></span> <span data-ttu-id="e7a7a-120">WF3 jest dostarczany w [!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)] side-by-side z WF4.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-120">WF3 is shipped in [!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)] side-by-side with WF4.</span></span> [!INCLUDE[crabout](../../../includes/crabout-md.md)]<span data-ttu-id="e7a7a-121"> Zobacz Migrowanie artefakty WF3 do WF4: [Przewodnik migracji systemu Windows Workflow Foundation 4](http://go.microsoft.com/fwlink/?LinkID=153313)</span><span class="sxs-lookup"><span data-stu-id="e7a7a-121"> migrating WF3 artifacts to WF4 see: [Windows Workflow Foundation 4 Migration Guide](http://go.microsoft.com/fwlink/?LinkID=153313)</span></span>  
  
 [!INCLUDE[indigo1](../../../includes/indigo1-md.md)]<span data-ttu-id="e7a7a-122"> jest firmy Microsoft ujednolicony model programowania do tworzenia aplikacji korzystających z usług.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-122"> is Microsoft’s unified programming model for building service-oriented applications.</span></span> <span data-ttu-id="e7a7a-123">Została wprowadzona jako część .net 3.0 oraz WF3, a teraz jest jednym z kluczowych składników [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e7a7a-123">It was first introduced as part of .Net 3.0 together with WF3 and now is one of the key components of the [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)].</span></span>  
  
 <span data-ttu-id="e7a7a-124">Windows Server AppFabric to zestaw zintegrowanych technologii, które ułatwiają tworzenie, skalowanie i zarządzanie nimi w sieci Web i aplikacji złożonych, które w środowisku usług IIS.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-124">Windows Server AppFabric is a set of integrated technologies that make it easier to build, scale and manage Web and composite applications that run on IIS.</span></span> <span data-ttu-id="e7a7a-125">Udostępnia narzędzia do monitorowania i zarządzania usługami i przepływami pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-125">It provides tools for monitoring and managing services and workflows.</span></span> <span data-ttu-id="e7a7a-126">Aby uzyskać więcej informacji, zobacz [systemu Windows Server AppFabric](http://msdn.microsoft.com/windowsserver/ee695849.aspx)</span><span class="sxs-lookup"><span data-stu-id="e7a7a-126">For more information, see [Windows Server AppFabric](http://msdn.microsoft.com/windowsserver/ee695849.aspx)</span></span>  
  
## <a name="goals"></a><span data-ttu-id="e7a7a-127">Cele</span><span class="sxs-lookup"><span data-stu-id="e7a7a-127">Goals</span></span>  
 <span data-ttu-id="e7a7a-128">Celem tego tematu jest pokazanie charakterystyki wydajności WF4 z danymi mierzone dla różnych scenariuszy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-128">The goal of this topic is to show the performance characteristics of WF4 with data measured for different scenarios.</span></span> <span data-ttu-id="e7a7a-129">Dostępne są także szczegółowe porównanie WF4 WF3 i zawiera doskonały ulepszeń, które zostały wprowadzone w tej nowej wersji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-129">It also provides detailed comparisons between WF4 and WF3, and thus shows the great improvements that have been made in this new revision.</span></span> <span data-ttu-id="e7a7a-130">Scenariusze i dane podane w tym artykule określenie podstawowego koszt różnych aspektów WF4 i WF3.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-130">The scenarios and data presented in this article quantify the underlying cost of different aspects of WF4 and WF3.</span></span> <span data-ttu-id="e7a7a-131">Te dane są przydatne w zrozumienia charakterystyki wydajności WF4 i mogą być pomocne w planowanie migracji z WF3 do WF4 lub przy użyciu WF4 w projektowanie aplikacji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-131">This data is useful in understanding the performance characteristics of WF4 and can be helpful in planning migrations from WF3 to WF4 or using WF4 in application development.</span></span> <span data-ttu-id="e7a7a-132">Jednak należy zachować ostrożność w wnioski wyciągnięte z danych przedstawionych w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-132">However, care should be taken in the conclusions drawn from the data presented in this article.</span></span> <span data-ttu-id="e7a7a-133">Wydajność aplikacji złożonych przepływu pracy jest wysoce zależne implementowania przepływu pracy i różnych składników są zintegrowane.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-133">The performance of a composite workflow application is highly dependent on how the workflow is implemented and how different components are integrated.</span></span> <span data-ttu-id="e7a7a-134">Jeden musi pomiarów każdej aplikacji, aby określić charakterystyki wydajności tej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-134">One must measure each application to determine the performance characteristics of that application.</span></span>  
  
## <a name="overview-of-wf4-performance-enhancements"></a><span data-ttu-id="e7a7a-135">Omówienie WF4 ulepszenia wydajności</span><span class="sxs-lookup"><span data-stu-id="e7a7a-135">Overview of WF4 Performance Enhancements</span></span>  
 <span data-ttu-id="e7a7a-136">WF4 dokładnie został opracowany i jest implementowana przy użyciu wysokiej wydajności i skalowalności, które są opisane w poniższych sekcjach.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-136">WF4 was carefully designed and implemented with high performance and scalability which are described in the following sections.</span></span>  
  
### <a name="wf-runtime"></a><span data-ttu-id="e7a7a-137">Środowisko uruchomieniowe WF</span><span class="sxs-lookup"><span data-stu-id="e7a7a-137">WF Runtime</span></span>  
 <span data-ttu-id="e7a7a-138">Stanowiącej podstawę [!INCLUDE[wf1](../../../includes/wf1-md.md)] środowisko wykonawcze jest asynchroniczne harmonogramu, którego wykonanie działań w przepływie pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-138">At the core of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime is an asynchronous scheduler that drives the execution of the activities in a workflow.</span></span> <span data-ttu-id="e7a7a-139">Zapewnia wydajność, środowisku przewidywalną wykonywania działań.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-139">It provides a performant, predictable execution environment for activities.</span></span> <span data-ttu-id="e7a7a-140">Środowisko zawiera kontrakt dobrze zdefiniowany dla wykonywania, kontynuacji ukończenia, anulowania, wyjątków i przewidywalne modelu wątkowości.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-140">The environment has a well-defined contract for execution, continuation, completion, cancellation, exceptions, and a predictable threading model.</span></span>  
  
 <span data-ttu-id="e7a7a-141">W odróżnieniu od WF3 WF4 runtime ma efektywniejsze harmonogramu.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-141">In comparison to WF3, the WF4 runtime has a more efficient scheduler.</span></span> <span data-ttu-id="e7a7a-142">Go korzysta z tej samej puli wątków We/Wy używanego do [!INCLUDE[indigo2](../../../includes/indigo2-md.md)], który jest bardzo wydajny w wykonywania umieścić w zadaniu wsadowym elementów roboczych.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-142">It leverages the same I/O thread pool that is used for [!INCLUDE[indigo2](../../../includes/indigo2-md.md)], which is very efficient at executing batched work items.</span></span> <span data-ttu-id="e7a7a-143">Kolejki harmonogramu elementu wewnętrznego pracy jest zoptymalizowana pod kątem typowych wzorców użycia.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-143">The internal work item scheduler queue is optimized for most common usage patterns.</span></span> <span data-ttu-id="e7a7a-144">Środowisko uruchomieniowe WF4 zarządza także stanów wykonania w sposób bardzo lekki z minimalnym synchronizacji i obsługi logiki, podczas gdy WF3 zależy od rejestracji ciężki zdarzenia i wywołanie do przeprowadzenia synchronizacji złożonych przejść stanu zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-144">The WF4 runtime also manages the execution states in a very light-weight way with minimal synchronization and event handling logic, while WF3 depends on heavy-weight event registration and invocation to perform complex synchronization for state transitions.</span></span>  
  
### <a name="data-storage-and-flow"></a><span data-ttu-id="e7a7a-145">Magazyn danych i przepływu</span><span class="sxs-lookup"><span data-stu-id="e7a7a-145">Data Storage and Flow</span></span>  
 <span data-ttu-id="e7a7a-146">W WF3, dane skojarzone z działaniem jest modelowana za pośrednictwem właściwości zależności zaimplementowany przez typ <xref:System.Windows.DependencyProperty>.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-146">In WF3, data associated with an activity is modeled through dependency properties implemented by the type <xref:System.Windows.DependencyProperty>.</span></span> <span data-ttu-id="e7a7a-147">Wzorzec właściwości zależności została wprowadzona w systemie Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="e7a7a-147">The dependency property pattern was introduced in Windows Presentation Foundation (WPF).</span></span> <span data-ttu-id="e7a7a-148">Ogólnie rzecz biorąc ten wzorzec jest bardzo elastyczne obsługuje powiązanie danych łatwe i inne funkcje interfejsu użytkownika.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-148">In general, this pattern is very flexible to support easy data binding and other UI features.</span></span> <span data-ttu-id="e7a7a-149">Wzorzec wymaga jednak właściwości określone jako pola statyczne w definicji przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-149">However, the pattern requires the properties to be defined as static fields in the workflow definition.</span></span> <span data-ttu-id="e7a7a-150">Zawsze, gdy [!INCLUDE[wf1](../../../includes/wf1-md.md)] środowiska uruchomieniowego Ustawia lub pobiera wartość właściwości, obejmuje ona logiki silnie ważone wyszukiwania.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-150">Whenever the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime sets or gets the property values, it involves heavily-weighted look-up logic.</span></span>  
  
 <span data-ttu-id="e7a7a-151">WF4 używa Wyczyść dane zakresu logikę do znacznie zwiększyć sposobu obsługi danych w przepływie pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-151">WF4 uses clear data scoping logic to greatly improve how data is handled in a workflow.</span></span> <span data-ttu-id="e7a7a-152">Umożliwia oddzielenie od danych przechowywanych w działaniu ze źródła danych, który jest przechodzenia przez granice działania za pomocą dwóch różnych pojęcia: zmienne i argumenty.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-152">It separates the data stored in an activity from the data that is flowing across the activity boundaries by using two different concepts: variables and arguments.</span></span> <span data-ttu-id="e7a7a-153">Przy użyciu wyczyść hierarchiczna zakres dla zmiennych i argumenty "W/Out/InOut", złożoność danych użycia dla działania jest znacznie zmniejszyć i okres istnienia danych jest automatycznie zakres.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-153">By using a clear hierarchical scope for variables and "In/Out/InOut" arguments, the data usage complexity for activities is dramatically reduced and the lifetime of the data is also automatically scoped.</span></span> <span data-ttu-id="e7a7a-154">Działania mają dobrze zdefiniowanego podpisu opisanego przez argumenty.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-154">Activities have a well-defined signature described by its arguments.</span></span> <span data-ttu-id="e7a7a-155">Sprawdzając, czy po prostu działanie można określić oczekuje na odbieranie danych i jakie dane zostaną utworzone przez nią w wyniku działania.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-155">By simply inspecting an activity you can determine what data it expects to receive and what data will be produced by it as the result of its execution.</span></span>  
  
 <span data-ttu-id="e7a7a-156">W WF3 działania zostały zainicjowane, gdy przepływ pracy został utworzony.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-156">In WF3 activities were initialized when a workflow was created.</span></span> <span data-ttu-id="e7a7a-157">W przypadku WF 4 działania są inicjowane tylko wtedy, gdy odpowiednie działania są wykonywane.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-157">In WF 4 activities are initialized only when the corresponding activities are executing.</span></span> <span data-ttu-id="e7a7a-158">Dzięki temu prostsze cykl działania bez wykonywania operacji inicjowania/Uninitialize po utworzeniu nowego wystąpienia przepływu pracy i w związku z tym osiągnął więcej wydajności</span><span class="sxs-lookup"><span data-stu-id="e7a7a-158">This allows a simpler activity lifecycle without performing Initialize/Uninitialize operations when a new workflow instance is created, and thus has achieved more efficiency</span></span>  
  
### <a name="control-flow"></a><span data-ttu-id="e7a7a-159">Przepływ sterowania</span><span class="sxs-lookup"><span data-stu-id="e7a7a-159">Control Flow</span></span>  
 <span data-ttu-id="e7a7a-160">Tak jak w przypadku dowolnego języka programowania [!INCLUDE[wf1](../../../includes/wf1-md.md)] zapewnia obsługę przepływami sterowania dla definicji przepływu pracy dzięki zastosowaniu zbiór działań przepływu sterowania do sekwencjonowania, pętle, wzorce rozgałęziania i innych.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-160">Just as in any programming language, [!INCLUDE[wf1](../../../includes/wf1-md.md)] provides support for control flows for workflow definitions by introducing a set of control flow activities for sequencing, looping, branching and other patterns.</span></span> <span data-ttu-id="e7a7a-161">W WF3, gdy to samo działanie musi ponownie uruchomić nowy <xref:System.Workflow.ComponentModel.ActivityExecutionContext> jest tworzony i działania został sklonowany za pośrednictwem ciężki serializacji i deserializacji logiki na podstawie <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-161">In WF3, when the same activity needs to be re-executed, a new <xref:System.Workflow.ComponentModel.ActivityExecutionContext> is created and the activity is cloned through a heavy-weight serialization and deserialization logic based on <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>.</span></span> <span data-ttu-id="e7a7a-162">Zwykle wydajność iteracyjny kontroli przepływów jest znacznie mniejsza niż wykonywania sekwencję działań.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-162">Usually the performance for iterative control flows is much slower than executing a sequence of activities.</span></span>  
  
 <span data-ttu-id="e7a7a-163">WF4 obsługuje to odbywa się zupełnie inaczej.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-163">WF4 handles this quite differently.</span></span> <span data-ttu-id="e7a7a-164">Go przyjmuje szablon działania, tworzy nowy obiekt ActivityInstance i dodaje go do kolejki harmonogramu.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-164">It takes the activity template, creates a new ActivityInstance object, and adds it to the scheduler queue.</span></span> <span data-ttu-id="e7a7a-165">Tylko całego tego procesu obejmuje tworzenie obiektów jawne i jest bardzo lekki.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-165">This whole process only involves explicit object creation and is very light-weight.</span></span>  
  
### <a name="asynchronous-programming"></a><span data-ttu-id="e7a7a-166">Programowanie asynchroniczne</span><span class="sxs-lookup"><span data-stu-id="e7a7a-166">Asynchronous Programming</span></span>  
 <span data-ttu-id="e7a7a-167">Aplikacje zazwyczaj mają lepszą wydajność i skalowalność programowania asynchronicznego długotrwałej operacji blokowania, takich jak We/Wy lub operacji przetwarzania rozproszonego.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-167">Applications usually have better performance and scalability with asynchronous programming for long running blocking operations such as I/O or distributed computing operations.</span></span> <span data-ttu-id="e7a7a-168">WF4 zapewnia obsługę asynchroniczną za pośrednictwem podstawowego elementu activity typów <xref:System.Activities.AsyncCodeActivity>, <xref:System.Activities.AsyncCodeActivity%601>.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-168">WF4 provides asynchronous support through base activity types <xref:System.Activities.AsyncCodeActivity>, <xref:System.Activities.AsyncCodeActivity%601>.</span></span> <span data-ttu-id="e7a7a-169">Środowiska uruchomieniowego natywnie obsługuje usługę asynchroniczne działań i w związku z tym można automatycznie umieszcza wystąpienia w strefie no-persist zablokowaniu zaległe asynchroniczne.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-169">The runtime natively understands asynchronous activities and therefore can automatically put the instance in a no-persist zone while the asynchronous work is outstanding.</span></span> <span data-ttu-id="e7a7a-170">Niestandardowe działania może pochodzić od tych typów do wykonywania asynchronicznych pracy bez zawierający wątku harmonogramu przepływu pracy i blokuje żadnych działań, które można uruchomić równolegle.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-170">Custom activities can derive from these types to perform asynchronous work without holding the workflow scheduler thread and blocking any activities that may be able to run in parallel.</span></span>  
  
### <a name="messaging"></a><span data-ttu-id="e7a7a-171">Obsługa wiadomości</span><span class="sxs-lookup"><span data-stu-id="e7a7a-171">Messaging</span></span>  
 <span data-ttu-id="e7a7a-172">Początkowo zawierała WF3 bardzo ograniczone komunikatów za pomocą zewnętrznego zdarzenia lub sieci web pomocy technicznej wywołań.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-172">Initially WF3 had very limited messaging support through external events or web services invocations.</span></span> <span data-ttu-id="e7a7a-173">W środowisku .net 3.5, przepływy pracy można zaimplementowane jako [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] klientów lub narażonych jako [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] usług za pośrednictwem <xref:System.Workflow.Activities.SendActivity> i <xref:System.Workflow.Activities.ReceiveActivity>.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-173">In .Net 3.5, workflows could be implemented as [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] clients or exposed as [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] services through <xref:System.Workflow.Activities.SendActivity> and <xref:System.Workflow.Activities.ReceiveActivity>.</span></span> <span data-ttu-id="e7a7a-174">W WF4, pojęcie opartym na przepływie pracy programowania wiadomości ma zostały wzmocnione za pośrednictwem ścisłej integracji z [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] wiadomości logikę do WF.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-174">In WF4, the concept of workflow-based messaging programming has been further strengthened through the tight integration of [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] messaging logic into WF.</span></span>  
  
 <span data-ttu-id="e7a7a-175">W potoku przetwarzania komunikatów ujednoliconego [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] w .net 4 pomaga WF4 usług mają znacznie lepszą wydajność i skalowalność niż WF3.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-175">The unified message processing pipeline provided in [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] in .Net 4 helps WF4 services to have significantly better performance and scalability than WF3.</span></span> <span data-ttu-id="e7a7a-176">WF4 zapewnia także bardziej zaawansowane funkcje obsługi wiadomości obsługę programowania, który modelu złożonego wzorce wymiany wiadomości (MEPs).</span><span class="sxs-lookup"><span data-stu-id="e7a7a-176">WF4 also provides richer messaging programming support that can model complex Message Exchange Patterns (MEPs).</span></span> <span data-ttu-id="e7a7a-177">Deweloperzy mogą używać albo kontraktów typu usługi umożliwia łatwe programowanie lub kontraktów usług wyrażeniami bez typu, aby osiągnąć lepszą wydajność bez płatności kosztów serializacji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-177">Developers can use either typed service contracts to achieve easy programming or un-typed service contracts to achieve better performance without paying serialization costs.</span></span> <span data-ttu-id="e7a7a-178">Obsługa buforowania za pośrednictwem kanału po stronie klienta <xref:System.ServiceModel.Activities.SendMessageChannelCache> klasy w WF4 ułatwia deweloperom tworzenie aplikacji szybki przy minimalnym wysiłku.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-178">The client-side channel caching support through the <xref:System.ServiceModel.Activities.SendMessageChannelCache> class in WF4 helps developers build fast applications with minimal effort.</span></span> <span data-ttu-id="e7a7a-179">Aby uzyskać więcej informacji, zobacz [Zmienianie poziomów współużytkowania pamięci podręcznej dla działań wysyłania](../../../docs/framework/wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span><span class="sxs-lookup"><span data-stu-id="e7a7a-179">For more information, see [Changing the Cache Sharing Levels for Send Activities](../../../docs/framework/wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span></span>  
  
### <a name="declarative-programming"></a><span data-ttu-id="e7a7a-180">Programowanie deklaratywne</span><span class="sxs-lookup"><span data-stu-id="e7a7a-180">Declarative Programming</span></span>  
 <span data-ttu-id="e7a7a-181">WF4 zapewnia czyste i proste deklaratywne programowania platformę do modelu procesów biznesowych i usług.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-181">WF4 provides a clean and simple declarative programming framework to model business processes and services.</span></span> <span data-ttu-id="e7a7a-182">Model programowania obsługuje w pełni deklaracyjnego kompozycji działań z nie kodu obok, co znacznie upraszcza tworzenie przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-182">The programming model supports fully declarative composition of activities, with no code-beside, greatly simplifying workflow authoring.</span></span> <span data-ttu-id="e7a7a-183">W [!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)], opartych na języku XAML deklaratywne struktury programistycznej używanej ma zostać unified w jednym zestawie System.Xaml.dll do obsługi WPF i WF.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-183">In [!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)], the XAML-based declarative programming framework has been unified into the single assembly System.Xaml.dll to support both WPF and WF.</span></span>  
  
 <span data-ttu-id="e7a7a-184">W WF4 XAML zapewnia obsługę naprawdę deklaratywne i umożliwia całej definicji przepływu pracy należy zdefiniować w znaczniku XML odwołuje się do działań i typy skompilowane przy użyciu platformy .NET.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-184">In WF4, XAML provides a truly declarative experience and allows for the entire definition of the workflow to be defined in XML markup, referencing activities and types built using .NET.</span></span> <span data-ttu-id="e7a7a-185">To było trudne do wykonania w WF3 formatu XOML nie angażując kodem niestandardowej logiki.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-185">This was difficult to do in WF3 with XOML format without involving custom code-behind logic.</span></span> <span data-ttu-id="e7a7a-186">Nowego stosu XAML w programie .net 4 ma znacznie większą wydajność w serializacji/deserializacji artefaktów przepływu pracy i sprawia, że programowanie deklaratywne bardziej atrakcyjne i stałe.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-186">The new XAML-stack in .Net 4 has much better performance in serializing/deserializing workflow artifacts and makes declarative programming more attractive and solid.</span></span>  
  
### <a name="workflow-designer"></a><span data-ttu-id="e7a7a-187">Projektant przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="e7a7a-187">Workflow Designer</span></span>  
 <span data-ttu-id="e7a7a-188">Pełni deklaracyjnego obsługę programowania WF4 nakłada jawnie wyższe wymagania dotyczące wydajności w czasie projektowania dla dużych przepływów pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-188">Fully declarative programming support for WF4 explicitly imposes higher requirements for design time performance for large workflows.</span></span> <span data-ttu-id="e7a7a-189">Projektant przepływu pracy w WF4 ma znacznie lepszą skalowalność dla dużych przepływów pracy niż WF3.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-189">The Workflow designer in WF4 has much better scalability for large workflows than that for WF3.</span></span> <span data-ttu-id="e7a7a-190">Z obsługą wirtualizacji interfejsu użytkownika Projektant można łatwo załadować dużych przepływu pracy 1000 działań w ciągu kilku sekund jest praktycznie niemożliwe załadować kilka kilkuset działań przepływu pracy przy użyciu projektanta WF3.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-190">With UI virtualization support, the designer can easily load a large workflow of 1000 activities in a few seconds, while it is almost impossible to load a workflow of a few hundred activities with the WF3 designer.</span></span>  
  
## <a name="component-level-performance-comparisons"></a><span data-ttu-id="e7a7a-191">Porównanie wydajności na poziomie składników</span><span class="sxs-lookup"><span data-stu-id="e7a7a-191">Component-level Performance Comparisons</span></span>  
 <span data-ttu-id="e7a7a-192">Ta sekcja zawiera dane na bezpośrednie porównanie poszczególne działania w przepływach pracy WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-192">This section contains data on direct comparisons between individual activities in WF3 and WF4 workflows.</span></span>  <span data-ttu-id="e7a7a-193">Kluczowych obszarach, takich jak trwałości ma więcej poważny wpływ na wydajność niż składniki poszczególnych działań.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-193">Key areas like persistence have a more profound impact on performance than the individual activity components.</span></span>  <span data-ttu-id="e7a7a-194">Lepsza wydajność programu poszczególnymi składnikami w programie WF4 są ważne, jednak ponieważ składniki programu są teraz szybkie, aby porównać z logiki aranżacji kodowane ręcznie.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-194">The performance improvements in individual components in WF4 are important though because the components are now fast enough to be compared against hand-coded orchestration logic.</span></span>  <span data-ttu-id="e7a7a-195">Przykładem jest omówiona w następnej sekcji: "Usługa kompozycji scenariusz".</span><span class="sxs-lookup"><span data-stu-id="e7a7a-195">An example of which is covered in the next section: "Service Composition Scenario."</span></span>  
  
### <a name="environment-setup"></a><span data-ttu-id="e7a7a-196">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="e7a7a-196">Environment Setup</span></span>  
 <span data-ttu-id="e7a7a-197">![Środowisko testowania wydajności przepływu pracy](../../../docs/framework/windows-workflow-foundation/media/wfperfenvironment.gif "WFPerfEnvironment")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-197">![Workflow Performance Test Environment](../../../docs/framework/windows-workflow-foundation/media/wfperfenvironment.gif "WFPerfEnvironment")</span></span>  
  
 <span data-ttu-id="e7a7a-198">Rysunku powyżej przedstawiono konfigurację maszyny, używany do pomiaru wydajności na poziomie składników.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-198">The above figure shows the machine configuration used for component-level performance measurement.</span></span> <span data-ttu-id="e7a7a-199">Pojedynczy serwer i klienci pięć połączone ponad jeden interfejs sieciowy Ethernet 1 GB.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-199">A single server and five clients connected over one 1-Gbps Ethernet network interface.</span></span> <span data-ttu-id="e7a7a-200">Łatwe pomiarów serwer jest skonfigurowany do użycia pojedynczego rdzenia proc/quad dwurdzeniowy serwera z systemem Windows Server 2008 x86.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-200">For easy measurements, the server is configured to use a single core of a dual-proc/quad-core server  running Windows Server 2008 x86.</span></span> <span data-ttu-id="e7a7a-201">Użycie procesora CPU systemu utrzymywana jest prawie 100%.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-201">The system CPU utilization is maintained at nearly 100%.</span></span>  
  
### <a name="test-details"></a><span data-ttu-id="e7a7a-202">Szczegóły testu</span><span class="sxs-lookup"><span data-stu-id="e7a7a-202">Test Details</span></span>  
 <span data-ttu-id="e7a7a-203">WF3 <xref:System.Workflow.Activities.CodeActivity> prawdopodobnie jest najprostsza działanie, które mogą być używane w przepływie pracy WF3.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-203">The WF3 <xref:System.Workflow.Activities.CodeActivity> is likely the simplest activity that can be used in a WF3 workflow.</span></span>  <span data-ttu-id="e7a7a-204">Działanie wywołuje metodę w CodeBehind który programisty przepływu pracy można wprowadzić kod niestandardowy do.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-204">The activity calls a method in the code-behind that the workflow programmer can put custom code into.</span></span>  <span data-ttu-id="e7a7a-205">W WF4, nie ma żadnych bezpośrednich analogowy do WF3 <xref:System.Workflow.Activities.CodeActivity> zapewnia te same funkcje.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-205">In WF4, there is no direct analog to the WF3 <xref:System.Workflow.Activities.CodeActivity> that provides the same functionality.</span></span>  <span data-ttu-id="e7a7a-206">Należy pamiętać, że istnieje <xref:System.Activities.CodeActivity> podstawowa klasa w WF4, który nie jest powiązana z WF3 <xref:System.Workflow.Activities.CodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-206">Note that there is a <xref:System.Activities.CodeActivity> base class in WF4 that is not related to the WF3 <xref:System.Workflow.Activities.CodeActivity>.</span></span>  <span data-ttu-id="e7a7a-207">Autorzy przepływu pracy są zachęcani do tworzenia niestandardowych działań i tworzenia przepływów pracy XAML — tylko do.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-207">Workflow authors are encouraged to create custom activities and build XAML-only workflows.</span></span>  <span data-ttu-id="e7a7a-208">W przypadku testów działania o nazwie `Comment` używany zamiast pustą <xref:System.Workflow.Activities.CodeActivity> w przepływach pracy WF4.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-208">In the tests below, an activity called `Comment` is used in place of an empty <xref:System.Workflow.Activities.CodeActivity> in WF4 workflows.</span></span>  <span data-ttu-id="e7a7a-209">Kod w `Comment` działania ma następującą składnię:</span><span class="sxs-lookup"><span data-stu-id="e7a7a-209">The code in the `Comment` activity is as follows:</span></span>  
  
```  
[ContentProperty("Body")]  
    public sealed class Comment : CodeActivity  
    {  
        public Comment()  
            : base()  
        {  
        }  
  
        [DefaultValue(null)]  
        public Activity Body  
        {  
            get;  
            set;  
        }  
  
        protected override void Execute(CodeActivityContext context)  
        {  
        }  
    }  
```  
  
### <a name="empty-workflow"></a><span data-ttu-id="e7a7a-210">Pusty przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="e7a7a-210">Empty Workflow</span></span>  
 <span data-ttu-id="e7a7a-211">Ten test używa sekwencji przepływu pracy z żadne działania podrzędne.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-211">This test uses a sequence workflow with no child activities.</span></span>  
  
### <a name="single-activity"></a><span data-ttu-id="e7a7a-212">Pojedyncze działanie</span><span class="sxs-lookup"><span data-stu-id="e7a7a-212">Single Activity</span></span>  
 <span data-ttu-id="e7a7a-213">Przepływ pracy jest przepływ pracy sekwencji zawierających jedno działanie podrzędne.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-213">The workflow is a sequence workflow containing one child activity.</span></span>  <span data-ttu-id="e7a7a-214">Działanie jest <xref:System.Workflow.Activities.CodeActivity> z żadnego kodu w przypadku WF3 i `Comment` działanie w przypadku WF4.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-214">The activity is a <xref:System.Workflow.Activities.CodeActivity> with no code in the WF3 case and a `Comment` activity in the WF4 case.</span></span>  
  
### <a name="while-with-1000-iterations"></a><span data-ttu-id="e7a7a-215">Podczas z 1000 iteracji</span><span class="sxs-lookup"><span data-stu-id="e7a7a-215">While with 1000 Iterations</span></span>  
 <span data-ttu-id="e7a7a-216">Sekwencyjny przepływ pracy zawiera jeden <xref:System.Activities.Statements.While> działania o jeden element podrzędny działania w pętli, które wykonuje pracę.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-216">The sequence workflow contains one <xref:System.Activities.Statements.While> activity with one child activity in the loop that does not perform any work.</span></span>  
  
### <a name="replicator-compared-to-parallelforeach"></a><span data-ttu-id="e7a7a-217">W porównaniu do działania ParallelForEach replikatora</span><span class="sxs-lookup"><span data-stu-id="e7a7a-217">Replicator compared to ParallelForEach</span></span>  
 <span data-ttu-id="e7a7a-218"><xref:System.Workflow.Activities.ReplicatorActivity> w WF3 wykonywanie równoległe i sekwencyjny trybach.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-218"><xref:System.Workflow.Activities.ReplicatorActivity> in WF3 has sequential and parallel execution modes.</span></span>  <span data-ttu-id="e7a7a-219">W trybie sekwencyjnych wydajności działania jest podobny do <xref:System.Workflow.Activities.WhileActivity>.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-219">In sequential mode, the activity’s performance is similar to the <xref:System.Workflow.Activities.WhileActivity>.</span></span>  <span data-ttu-id="e7a7a-220"><xref:System.Workflow.Activities.ReplicatorActivity> Jest najbardziej przydatny w przypadku przetwarzania równoległego.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-220">The <xref:System.Workflow.Activities.ReplicatorActivity> is most useful for parallel execution.</span></span>  <span data-ttu-id="e7a7a-221">Analogowy WF4 tego jest <xref:System.Activities.Statements.ParallelForEach%601> działania.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-221">The WF4 analog for this is the <xref:System.Activities.Statements.ParallelForEach%601> activity.</span></span>  
  
 <span data-ttu-id="e7a7a-222">Na poniższym diagramie przedstawiono przepływ używany dla tego testu.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-222">The following diagram shows the workflows used for this test.</span></span> <span data-ttu-id="e7a7a-223">Przepływ pracy WF3 jest po lewej stronie i WF4 przepływu pracy jest po prawej stronie.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-223">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>  
  
 <span data-ttu-id="e7a7a-224">![WF3 Działanie ReplicatorActivity i działania ParallelForEach WF4](../../../docs/framework/windows-workflow-foundation/media/replicatorandparallelforeach.gif "ReplicatorAndParallelForEach")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-224">![WF3 ReplicatorActivity and WF4 ParallelForEach](../../../docs/framework/windows-workflow-foundation/media/replicatorandparallelforeach.gif "ReplicatorAndParallelForEach")</span></span>  
  
### <a name="sequential-workflow-with-five-activities"></a><span data-ttu-id="e7a7a-225">Sekwencyjny przepływ pracy z pięciu działań</span><span class="sxs-lookup"><span data-stu-id="e7a7a-225">Sequential Workflow with Five Activities</span></span>  
 <span data-ttu-id="e7a7a-226">Ten test jest przeznaczona do Pokaż efekt o kilka działania wykonywane w sekwencji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-226">This test is meant to show the effect of having several activities execute in sequence.</span></span>  <span data-ttu-id="e7a7a-227">Ma pięć działań w sekwencji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-227">There are five activities in the sequence.</span></span>  
  
### <a name="transaction-scope"></a><span data-ttu-id="e7a7a-228">Zakresu transakcji</span><span class="sxs-lookup"><span data-stu-id="e7a7a-228">Transaction Scope</span></span>  
 <span data-ttu-id="e7a7a-229">Test zakresu transakcji różni się od innych testów w tym nowe wystąpienie przepływu pracy nie został utworzony dla każdej iteracji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-229">The transaction scope test differs from the other tests slightly in that a new workflow instance is not created for every iteration.</span></span>  <span data-ttu-id="e7a7a-230">Zamiast tego przepływu pracy składa się z chwilę zawierający pętli <xref:System.Activities.Statements.TransactionScope> działania, które zawiera pojedyncze działanie, które nie działa.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-230">Instead, the workflow is structured with a while loop containing a <xref:System.Activities.Statements.TransactionScope> activity containing a single activity that does no work.</span></span>  <span data-ttu-id="e7a7a-231">Uruchom każdej partii 50 iteracji za pośrednictwem while pętli jest liczone jako jedna operacja.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-231">Each run of a batch of 50 iterations through the while loop is counted as a single operation.</span></span>  
  
### <a name="compensation"></a><span data-ttu-id="e7a7a-232">kompensacji</span><span class="sxs-lookup"><span data-stu-id="e7a7a-232">Compensation</span></span>  
 <span data-ttu-id="e7a7a-233">Przepływ pracy WF3 ma jednego możliwy do kompensacji działania o nazwie `WorkScope`.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-233">The WF3 workflow has a single compensatable activity named `WorkScope`.</span></span>  <span data-ttu-id="e7a7a-234">Działanie po prostu implementuje <xref:System.Workflow.ComponentModel.ICompensatableActivity> interfejsu:</span><span class="sxs-lookup"><span data-stu-id="e7a7a-234">The activity simply implements the <xref:System.Workflow.ComponentModel.ICompensatableActivity> interface:</span></span>  
  
```  
class WorkScope :   
        CompositeActivity, ICompensatableActivity  
    {  
        public WorkScope() : base() { }  
  
        public WorkScope(string name)  
        {  
            this.Name = name;  
        }  
  
        public ActivityExecutionStatus Compensate(  
            ActivityExecutionContext executionContext)  
        {  
            return ActivityExecutionStatus.Closed;  
        }  
    }  
```  
  
 <span data-ttu-id="e7a7a-235">Obiekty docelowe obsługi błędów `WorkScope` działania. Przepływ pracy WF4 jest równie simplistic.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-235">The fault handler targets the `WorkScope` activity.The WF4 workflow is equally simplistic.</span></span>  <span data-ttu-id="e7a7a-236">A <xref:System.Activities.Statements.CompensableActivity> ma treści i obsługi kompensacji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-236">A <xref:System.Activities.Statements.CompensableActivity> has a body and a compensation handler.</span></span>  <span data-ttu-id="e7a7a-237">Jawne compensate jest dalej w sekwencji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-237">An explicit compensate is next in the sequence.</span></span>  <span data-ttu-id="e7a7a-238">Działanie dotyczące treści i działanie procedury obsługi kompensacji są oba pusty implementacji:</span><span class="sxs-lookup"><span data-stu-id="e7a7a-238">The body activity and compensation handler activity are both empty implementations:</span></span>  
  
```  
public sealed class CompensableActivityEmptyCompensation : CodeActivity  
    {  
        public CompensableActivityEmptyCompensation()  
            : base() { }  
  
        public Activity Body { get; set; }  
  
        protected override void Execute(CodeActivityContext context) { }  
    }  
    public sealed class CompensableActivityEmptyBody : CodeActivity  
    {  
        public CompensableActivityEmptyBody()  
            : base() { }  
  
        public Activity Body { get; set; }  
  
        protected override void Execute(CodeActivityContext context) { }  
    }  
```  
  
 <span data-ttu-id="e7a7a-239">![Przepływy pracy podstawowe kompensacji WF3 i WF](../../../docs/framework/windows-workflow-foundation/media/basiccompensationworkflows.gif "BasicCompensationWorkflows")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-239">![WF3 and WF basic compensation workflows](../../../docs/framework/windows-workflow-foundation/media/basiccompensationworkflows.gif "BasicCompensationWorkflows")</span></span>  
  
 <span data-ttu-id="e7a7a-240">Rysunek 2 — WF3 (po lewej) i przepływów pracy (po prawej) podstawowych kompensacji WF4</span><span class="sxs-lookup"><span data-stu-id="e7a7a-240">Figure 2 – WF3 (left) and WF4 (right) basic compensation workflows</span></span>  
  
### <a name="performance-test-results"></a><span data-ttu-id="e7a7a-241">Wyniki testów wydajności</span><span class="sxs-lookup"><span data-stu-id="e7a7a-241">Performance Test Results</span></span>  
 <span data-ttu-id="e7a7a-242">![Wyniki testów wydajności](../../../docs/framework/windows-workflow-foundation/media/performancedata.gif "elementu PerformanceData")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-242">![Performance Test Results](../../../docs/framework/windows-workflow-foundation/media/performancedata.gif "PerformanceData")</span></span>  
  
 <span data-ttu-id="e7a7a-243">![Wykres danych testu wydajności](../../../docs/framework/windows-workflow-foundation/media/performancetestchart.gif "PerformanceTestChart")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-243">![Performance Test Data Graph](../../../docs/framework/windows-workflow-foundation/media/performancetestchart.gif "PerformanceTestChart")</span></span>  
  
 <span data-ttu-id="e7a7a-244">Wszystkie testy są mierzone w przepływach pracy na sekundę, z wyjątkiem testu zakresu transakcji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-244">All tests are measured in workflows per second with the exception of the transaction scope test.</span></span>  <span data-ttu-id="e7a7a-245">Jak podano powyżej, [!INCLUDE[wf1](../../../includes/wf1-md.md)] wydajność środowiska uruchomieniowego uległa poprawie w tablicy, zwłaszcza w obszarach, które wymagają wykonania wielu to samo działanie jak while pętli.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-245">As can be seen above, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime performance has improved across the board, especially in areas that require multiple executions of the same activity like the while loop.</span></span>  
  
## <a name="service-composition-scenario"></a><span data-ttu-id="e7a7a-246">Usługa kompozycji scenariusza</span><span class="sxs-lookup"><span data-stu-id="e7a7a-246">Service Composition Scenario</span></span>  
 <span data-ttu-id="e7a7a-247">Opisane w poprzedniej sekcji "składnika poziom wydajności porównania" wprowadzono znaczące zmniejszenie obciążenia między WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-247">As is shown in the previous section, "Component-level Performance Comparisons," there has been a significant reduction in overhead between WF3 and WF4.</span></span>  [!INCLUDE[indigo2](../../../includes/indigo2-md.md)]<span data-ttu-id="e7a7a-248"> usługi przepływu pracy teraz może dopasować prawie wydajność kodowane ręcznie [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] usługi, ale nadal mają korzystać z [!INCLUDE[wf1](../../../includes/wf1-md.md)] środowiska wykonawczego.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-248"> workflow services can now almost match the performance of hand-coded [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] services but still have all the benefits of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="e7a7a-249">Ten scenariusz testu porównuje [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] usługi przed [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] usługi przepływu pracy w WF4.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-249">This test scenario compares a [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] service against a [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] workflow service in WF4.</span></span>  
  
### <a name="online-store-service"></a><span data-ttu-id="e7a7a-250">Usługi online magazynu</span><span class="sxs-lookup"><span data-stu-id="e7a7a-250">Online Store Service</span></span>  
 <span data-ttu-id="e7a7a-251">Jedną z możliwości programu Windows Workflow Foundation jest możliwość tworzenia procesy korzystające z kilku usług.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-251">One of the strengths of Windows Workflow Foundation is the ability to compose processes using several services.</span></span>  <span data-ttu-id="e7a7a-252">W tym przykładzie jest usługą sklepu, która organizuje zakup dwóch wywołania usługi.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-252">For this example, there is an online store service that orchestrates two service calls to purchase an order.</span></span>  <span data-ttu-id="e7a7a-253">Pierwszym krokiem jest do sprawdzania poprawności kolejności przy użyciu usługi sprawdzania poprawności zamówienia.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-253">The first step is to validate the order using an Order Validating Service.</span></span>  <span data-ttu-id="e7a7a-254">Drugim krokiem jest do wypełnienia kolejności przy użyciu usługi magazynu.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-254">The second step is to fill the order using a Warehouse Service.</span></span>  
  
 <span data-ttu-id="e7a7a-255">Te dwie usługi wewnętrznej bazy danych usługi sprawdzania poprawności kolejności i magazynu, pozostają takie same, w obu.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-255">The two backend services, Order Validating Service and Warehouse Service, remain the same for both tests.</span></span>  <span data-ttu-id="e7a7a-256">Element, który zmienia jest Online usługi magazynu, który wykonuje orchestration.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-256">The part that changes is the Online Store Service that performs the orchestration.</span></span>  <span data-ttu-id="e7a7a-257">W przypadku jednego, usługa jest ręcznie zakodowane jako [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] usługi.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-257">In one case, the service is hand-coded as a [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] service.</span></span>  <span data-ttu-id="e7a7a-258">W przypadku usługi są zapisywane jako [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] usługi przepływu pracy w WF4.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-258">For the other case, the service is written as a [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] workflow service in WF4.</span></span> [!INCLUDE[wf1](../../../includes/wf1-md.md)]<span data-ttu-id="e7a7a-259">-określone funkcje, takie jak śledzenie i trwałości są wyłączone dla tego testu.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-259">-specific features like tracking and persistence are turned off for this test.</span></span>  
  
### <a name="environment"></a><span data-ttu-id="e7a7a-260">Środowisko</span><span class="sxs-lookup"><span data-stu-id="e7a7a-260">Environment</span></span>  
 <span data-ttu-id="e7a7a-261">![Środowisko testowania wydajności przepływu pracy](../../../docs/framework/windows-workflow-foundation/media/wfperfenvironment.gif "WFPerfEnvironment")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-261">![Workflow Performance Test Environment](../../../docs/framework/windows-workflow-foundation/media/wfperfenvironment.gif "WFPerfEnvironment")</span></span>  
  
 <span data-ttu-id="e7a7a-262">Żądania klienta są kierowane do usługi Online magazynu za pośrednictwem protokołu HTTP z wielu komputerów.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-262">Client requests are made to the Online Store Service via HTTP from multiple computers.</span></span>  <span data-ttu-id="e7a7a-263">Pojedynczy komputer obsługuje wszystkie trzy usługi.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-263">A single computer hosts all three services.</span></span>  <span data-ttu-id="e7a7a-264">Warstwa transportu między Online usługi magazynu i usługi wewnętrznej bazy danych jest TCP lub HTTP.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-264">The transport layer between the Online Store Service and the backend services is TCP or HTTP.</span></span>  <span data-ttu-id="e7a7a-265">Pomiar operacji na sekundę jest oparta na liczbę ukończone `PurchaseOrder` wywołania Online usługi magazynu.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-265">The measurement of operations/second is based on the number of completed `PurchaseOrder` calls made to the Online Store Service.</span></span>  <span data-ttu-id="e7a7a-266">Korzystanie z puli kanału to nowa funkcja dostępna w WF4.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-266">Channel pooling is a new feature available in WF4.</span></span>  <span data-ttu-id="e7a7a-267">W [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] fabrycznej nie podano część tego testu kanału korzystanie z puli, więc kodowane ręcznie wykonania prostego technika buforowania został użyty w Online usługi magazynu.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-267">In the [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] portion of this test channel pooling is not provided out of the box so a hand-coded implementation of a simple pooling technique was used in the Online Store Service.</span></span>  
  
### <a name="performance"></a><span data-ttu-id="e7a7a-268">Wydajność</span><span class="sxs-lookup"><span data-stu-id="e7a7a-268">Performance</span></span>  
 <span data-ttu-id="e7a7a-269">![Wykres wydajności usługi Sklep internetowy](../../../docs/framework/windows-workflow-foundation/media/onlinestoreperfgraph.gif "OnlineStorePerfGraph")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-269">![Online Store Service Performance Graph](../../../docs/framework/windows-workflow-foundation/media/onlinestoreperfgraph.gif "OnlineStorePerfGraph")</span></span>  
  
 <span data-ttu-id="e7a7a-270">Łączenie z usługami TCP wewnętrznej bazy danych bez puli kanału [!INCLUDE[wf1](../../../includes/wf1-md.md)] usługi ma wpływ 17.2% przepływności.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-270">Connecting to backend TCP services without channel pooling, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] service has a 17.2% impact on throughput.</span></span>  <span data-ttu-id="e7a7a-271">Z puli kanału kary wynosi około 23,8%.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-271">With channel pooling, the penalty is about 23.8%.</span></span>  <span data-ttu-id="e7a7a-272">W przypadku protokołu HTTP wpływ jest znacznie mniej: % 4.3 bez buforowania i % 8.1 z puli.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-272">For HTTP, the impact is much less: 4.3% without pooling and 8.1% with pooling.</span></span>  <span data-ttu-id="e7a7a-273">Jest również należy pamiętać, że buforowanie kanału zapewnia korzyści bardzo mało przy użyciu protokołu HTTP.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-273">It is also important to note that the channel pooling provides very little benefit when using HTTP.</span></span>  
  
 <span data-ttu-id="e7a7a-274">Gdy istnieje nakłady pracy związane z WF4 środowiska uruchomieniowego w porównaniu z kodowane ręcznie [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] usługi w tym teście należy uważać najgorszym przypadku.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-274">While there is overhead from the WF4 runtime compared with a hand-coded [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] service in this test, it could be considered a worst-case scenario.</span></span>  <span data-ttu-id="e7a7a-275">Te dwie usługi wewnętrznej bazy danych, w tym teście zrobić bardzo małego wysiłku.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-275">The two backend services in this test do very little work.</span></span>  <span data-ttu-id="e7a7a-276">W przypadku rzeczywistych end-to-end te usługi przeprowadza się bardziej kosztowne operacje, takie jak wywołania bazy danych, co mniej istotny wpływ na wydajność warstwy transportowej.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-276">In a real end-to-end scenario, these services would perform more expensive operations like database calls, making the performance impact of the transport layer less important.</span></span>  <span data-ttu-id="e7a7a-277">To plus z zalet funkcji dostępnych w WF4 sprawia, że Workflow Foundation działało wyboru do tworzenia usług aranżacji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-277">This plus the benefits of the features available in WF4 makes Workflow Foundation a viable choice for creating orchestration services.</span></span>  
  
## <a name="key-performance-considerations"></a><span data-ttu-id="e7a7a-278">Kluczowe zagadnienia dotyczące wydajności</span><span class="sxs-lookup"><span data-stu-id="e7a7a-278">Key Performance Considerations</span></span>  
 <span data-ttu-id="e7a7a-279">Obszary funkcji w tej sekcji, z wyjątkiem interop, zmieniły się znacznie między WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-279">The feature areas in this section, with the exception of interop, have dramatically changed between WF3 and WF4.</span></span>  <span data-ttu-id="e7a7a-280">Ma to wpływ na projekt aplikacji przepływu pracy, a także wydajności.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-280">This affects the design of workflow applications as well as the performance.</span></span>  
  
#### <a name="workflow-activation-latency"></a><span data-ttu-id="e7a7a-281">Opóźnienie aktywacji przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="e7a7a-281">Workflow Activation Latency</span></span>  
 <span data-ttu-id="e7a7a-282">W [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] aplikacja usługi przepływu pracy, czas oczekiwania na uruchomienie nowego przepływu pracy lub ładowania istniejącego przepływu pracy jest ważne, jak mogą być blokowane.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-282">In a [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] workflow service application, the latency for starting a new workflow or loading an existing workflow is important as it can be blocking.</span></span>  <span data-ttu-id="e7a7a-283">Przypadek testowy środków hosta WF3 XOML przed WF4 XAMLX hosta w typowy scenariusz.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-283">This test case measures a WF3 XOML host against a WF4 XAMLX host in a typical scenario.</span></span>  
  
##### <a name="environment-setup"></a><span data-ttu-id="e7a7a-284">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="e7a7a-284">Environment Setup</span></span>  
 <span data-ttu-id="e7a7a-285">![Konfigurowanie środowiska testów opóźnienia i przepływności](../../../docs/framework/windows-workflow-foundation/media/latencyandthroughputenvironment.gif "LatencyAndThroughputEnvironment")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-285">![Environment setup for latency and throughput tests](../../../docs/framework/windows-workflow-foundation/media/latencyandthroughputenvironment.gif "LatencyAndThroughputEnvironment")</span></span>  
  
##### <a name="test-setup"></a><span data-ttu-id="e7a7a-286">Testuj ustawienia</span><span class="sxs-lookup"><span data-stu-id="e7a7a-286">Test Setup</span></span>  
 <span data-ttu-id="e7a7a-287">W tym scenariuszu, kontakty komputera klienta [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] usługi przepływu pracy przy użyciu kontekstowa korelacji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-287">In the scenario, a client computer contacts a [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] workflow service using context-based correlation.</span></span>  <span data-ttu-id="e7a7a-288">Kontekst korelacji wymaga specjalnych kontekst powiązania i używa nagłówka kontekstu lub plik cookie powiązać wiadomości do wystąpienia przepływu pracy poprawne.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-288">Context correlation requires a special context binding and uses a context header or cookie to relate messages to the correct workflow instance.</span></span>  <span data-ttu-id="e7a7a-289">Ma ona wydajności korzystać w tym korelacji, więc treść komunikatu musi być analizowana identyfikator znajduje się w nagłówku wiadomości.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-289">It has a performance benefit in that the correlation Id is located in the message header so the message body does not need to be parsed.</span></span> [!INCLUDE[crabout](../../../includes/crabout-md.md)]<span data-ttu-id="e7a7a-290"> Zobacz korelacji kontekstu [korelacja wymiany kontekstu](../../../docs/framework/wcf/feature-details/context-exchange-correlation.md)</span><span class="sxs-lookup"><span data-stu-id="e7a7a-290"> context correlation see [Context Exchange Correlation](../../../docs/framework/wcf/feature-details/context-exchange-correlation.md)</span></span>  
  
 <span data-ttu-id="e7a7a-291">Usługa tworzenia nowego przepływu pracy z żądaniem i Przenieś natychmiastowej reakcji, tak aby pomiar opóźnienia nie obejmuje czas uruchamiania przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-291">The service will create a new workflow with the request and send an immediate response so that the measurement of latency does not include the time spent running the workflow.</span></span>  <span data-ttu-id="e7a7a-292">Przepływ pracy WF3 jest XOML z kodem i WF4 przepływu pracy jest całkowicie XAML.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-292">The WF3 workflow is XOML with a code-behind and the WF4 workflow is entirely XAML.</span></span>  <span data-ttu-id="e7a7a-293">Przepływ pracy WF4 wygląda następująco:</span><span class="sxs-lookup"><span data-stu-id="e7a7a-293">The WF4 workflow looks like this:</span></span>  
  
 <span data-ttu-id="e7a7a-294">![Zakresu korelacji 4 WF](../../../docs/framework/windows-workflow-foundation/media/correlationscopeworkflow.gif "CorrelationScopeWorkflow")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-294">![WF 4 Correlation Scope](../../../docs/framework/windows-workflow-foundation/media/correlationscopeworkflow.gif "CorrelationScopeWorkflow")</span></span>  
  
 <span data-ttu-id="e7a7a-295"><xref:System.ServiceModel.Activities.Receive> Działanie tworzy wystąpienie przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-295">The <xref:System.ServiceModel.Activities.Receive> activity creates the workflow instance.</span></span>  <span data-ttu-id="e7a7a-296">Wartość przekazana odebranej wiadomości jest powtarzana w komunikacie odpowiedzi.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-296">A value passed in the received message is echoed in the reply message.</span></span>  <span data-ttu-id="e7a7a-297">Sekwencja po odpowiedzi zawiera pozostałej części przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-297">A sequence following the reply contains the rest of the workflow.</span></span>  <span data-ttu-id="e7a7a-298">W przypadku powyżej jest wyświetlany tylko jeden komentarz działania.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-298">In the above case, only one comment activity is shown.</span></span>  <span data-ttu-id="e7a7a-299">Liczba działań w komentarz zostanie zmieniona do symulowania złożoności przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-299">The number of comment activities is changed to simulate workflow complexity.</span></span>  <span data-ttu-id="e7a7a-300">Działanie komentarz jest odpowiednikiem WF3 <xref:System.Workflow.Activities.CodeActivity> który nie wykonuje żadnych operacji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-300">A comment activity is equivalent to a WF3 <xref:System.Workflow.Activities.CodeActivity> that performs no work.</span></span> [!INCLUDE[crabout](../../../includes/crabout-md.md)]<span data-ttu-id="e7a7a-301"> działanie komentarza, zobacz sekcję "porównanie wydajności poziomie składników" w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-301"> the comment activity, see the "Component-level Performance Comparison" section earlier in this article.</span></span>  
  
##### <a name="test-results"></a><span data-ttu-id="e7a7a-302">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="e7a7a-302">Test Results</span></span>  
 <span data-ttu-id="e7a7a-303">![Wyniki opóźnienia](../../../docs/framework/windows-workflow-foundation/media/latencyresultsgraph.gif "LatencyResultsGraph")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-303">![Latency Results](../../../docs/framework/windows-workflow-foundation/media/latencyresultsgraph.gif "LatencyResultsGraph")</span></span>  
  
 <span data-ttu-id="e7a7a-304">Rysunek 3 – zimnej i ogrzewać opóźnienie dla usług przepływu pracy WCF</span><span class="sxs-lookup"><span data-stu-id="e7a7a-304">Figure 3 – Cold and warm latency for WCF workflow services</span></span>  
  
 <span data-ttu-id="e7a7a-305">Na wykresie powyżej chłodni odwołuje się do sytuacji, gdy nie istnieje <xref:System.ServiceModel.WorkflowServiceHost> dla danego przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-305">In the graph above, cold refers to the case where there is not an existing <xref:System.ServiceModel.WorkflowServiceHost> for the given workflow.</span></span>  <span data-ttu-id="e7a7a-306">Innymi słowy zimnych opóźnienia jest, gdy przepływ pracy jest używany po raz pierwszy i XOML lub XAML musi być kompilowana.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-306">In other words, cold latency is when the workflow is being used for the first time and the XOML or XAML needs to be compiled.</span></span>  <span data-ttu-id="e7a7a-307">Ciepłych opóźnienie to czas do utworzenia nowego wystąpienia przepływu pracy, gdy już została skompilowana typu przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-307">Warm latency is the time to create a new workflow instance when the workflow type has already been compiled.</span></span>  <span data-ttu-id="e7a7a-308">Złożoność przepływu pracy sprawia, że bardzo mała różnica w przypadku WF4, ale ma liniowej postępu w przypadku WF3.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-308">The complexity of the workflow makes very little difference in the WF4 case but has a linear progression in the WF3 case.</span></span>  
  
#### <a name="correlation-throughput"></a><span data-ttu-id="e7a7a-309">Przepływność korelacji</span><span class="sxs-lookup"><span data-stu-id="e7a7a-309">Correlation Throughput</span></span>  
 <span data-ttu-id="e7a7a-310">WF4 wprowadzono nową funkcję korelacji na podstawie zawartości.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-310">WF4 introduces a new content-based correlation feature.</span></span>  <span data-ttu-id="e7a7a-311">WF3 podać tylko na podstawie kontekstu korelacji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-311">WF3 provided only context-based correlation.</span></span>  <span data-ttu-id="e7a7a-312">Korelacja na podstawie kontekstu może być wykonana tylko przez określonych [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] powiązania kanału.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-312">Context-based correlation could only be done over specific [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] channel bindings.</span></span>  <span data-ttu-id="e7a7a-313">Identyfikator przepływu pracy są wstawiane do nagłówka wiadomości, korzystając z tych powiązań.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-313">The workflow Id is inserted into the message header when using these bindings.</span></span>  <span data-ttu-id="e7a7a-314">Środowisko uruchomieniowe WF3 tylko można zidentyfikować przepływu pracy przez jego identyfikator.  Na podstawie zawartości korelacji Autor przepływu pracy umożliwia tworzenie klucza korelacji poza odpowiednich element danych, takich jak numer konta lub identyfikatora klienta [!INCLUDE[crabout](../../../includes/crabout-md.md)] korelacji na podstawie zawartości można znaleźć [zawartości na podstawie korelacji](../../../docs/framework/wcf/feature-details/content-based-correlation.md).</span><span class="sxs-lookup"><span data-stu-id="e7a7a-314">The WF3 runtime could only identify a workflow by its Id.  With content-based correlation, the workflow author can create a correlation key out of a relevant piece of data like an account number or customer Id. [!INCLUDE[crabout](../../../includes/crabout-md.md)] content-based correlation see [Content Based Correlation](../../../docs/framework/wcf/feature-details/content-based-correlation.md).</span></span>  
  
 <span data-ttu-id="e7a7a-315">Kontekstowa korelacji ma korzystać wydajności, w tym klucz korelacji znajduje się w nagłówku wiadomości.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-315">Context-based correlation has a performance advantage in that the correlation key is located in the message header.</span></span>  <span data-ttu-id="e7a7a-316">Klucz można odczytać z wiadomość bez dezaktywuje-serialization/komunikat kopiowania.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-316">The key can be read from the message without de-serialization/message-copying.</span></span>  <span data-ttu-id="e7a7a-317">W zawartości na podstawie korelacji klucz korelacji jest przechowywany w treści wiadomości.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-317">In content-based correlation, the correlation key is stored in the message body.</span></span>  <span data-ttu-id="e7a7a-318">Wyrażenie XPath jest używany do lokalizowania klucza.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-318">An XPath expression is used to locate the key.</span></span>  <span data-ttu-id="e7a7a-319">Koszt tego dodatkowego przetwarzania zależy od rozmiaru komunikatu głębokość klucza w treści i liczba kluczy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-319">The cost of this extra processing depends on the size of the message, depth of the key in the body, and the number of keys.</span></span>  <span data-ttu-id="e7a7a-320">Ten test porównuje korelacji na podstawie kontekstu i zawartości i zawiera także spadek wydajności, korzystając z wielu kluczy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-320">This test compares context- and content-based correlation and also shows the performance degradation when using multiple keys.</span></span>  
  
#### <a name="environment-setup"></a><span data-ttu-id="e7a7a-321">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="e7a7a-321">Environment Setup</span></span>  
 <span data-ttu-id="e7a7a-322">![Środowisko testowania wydajności przepływu pracy](../../../docs/framework/windows-workflow-foundation/media/wfperfenvironment.gif "WFPerfEnvironment")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-322">![Workflow Performance Test Environment](../../../docs/framework/windows-workflow-foundation/media/wfperfenvironment.gif "WFPerfEnvironment")</span></span>  
  
#### <a name="test-setup"></a><span data-ttu-id="e7a7a-323">Testuj ustawienia</span><span class="sxs-lookup"><span data-stu-id="e7a7a-323">Test Setup</span></span>  
 <span data-ttu-id="e7a7a-324">![Korelacji przepływności przepływu pracy Test](../../../docs/framework/windows-workflow-foundation/media/correlationthroughputworkflow.gif "CorrelationThroughputWorkflow")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-324">![Correlation Throughput Workflow Test](../../../docs/framework/windows-workflow-foundation/media/correlationthroughputworkflow.gif "CorrelationThroughputWorkflow")</span></span>  
  
 <span data-ttu-id="e7a7a-325">Powyższy przepływu pracy jest taka sama jak używane w sekcji "Trwałość" poniżej.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-325">The workflow shown above is the same one used in the "Persistence" section below.</span></span>  <span data-ttu-id="e7a7a-326">Dla testów korelacji bez trwałości Brak dostawcy trwałości zainstalowany w środowisku wykonawczym.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-326">For the correlation tests without persistence there is no persistence provider installed in the runtime.</span></span>  <span data-ttu-id="e7a7a-327">Korelacji występuje w dwóch miejscach: CreateOrder i CompleteOrder.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-327">Correlation occurs in two places: CreateOrder and CompleteOrder.</span></span>  
  
#### <a name="test-results"></a><span data-ttu-id="e7a7a-328">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="e7a7a-328">Test Results</span></span>  
 <span data-ttu-id="e7a7a-329">![Przepływność korelacji](../../../docs/framework/windows-workflow-foundation/media/correlationthroughputgraph.gif "CorrelationThroughputGraph")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-329">![Correlation Throughput](../../../docs/framework/windows-workflow-foundation/media/correlationthroughputgraph.gif "CorrelationThroughputGraph")</span></span>  
  
 <span data-ttu-id="e7a7a-330">Ten wykres pokazuje spadek wydajności jako liczba kluczy używanych wzrost na podstawie zawartości korelacji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-330">This graph shows a decrease in performance as the number of keys used in content-based correlation increases.</span></span>  <span data-ttu-id="e7a7a-331">Podobieństwa między TCP i HTTP krzywych wskazuje obciążenia związanego z tych protokołów.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-331">The similarity in the curves between TCP and HTTP indicates the overhead associated with these protocols.</span></span>  
  
#### <a name="correlation-with-persistence"></a><span data-ttu-id="e7a7a-332">Korelacji z trwałości</span><span class="sxs-lookup"><span data-stu-id="e7a7a-332">Correlation with Persistence</span></span>  
 <span data-ttu-id="e7a7a-333">Z utrwalonego przepływu pracy wykorzystanie procesora CPU od na podstawie zawartości korelacji przewiduje ze środowiska uruchomieniowego przepływu pracy z bazą danych SQL.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-333">With a persisted workflow, the CPU pressure from content-based correlation shifts from the workflow runtime to the SQL database.</span></span>  <span data-ttu-id="e7a7a-334">Procedury składowane SQL dostawcy trwałości pracy zgodnymi kluczami można znaleźć odpowiedniego przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-334">The stored procedures in the SQL persistence provider do the work of matching the keys to locate the appropriate workflow.</span></span>  
  
 <span data-ttu-id="e7a7a-335">![Wyniki korelacji i trwałości](../../../docs/framework/windows-workflow-foundation/media/correlationandpersistencegraph.gif "CorrelationAndPersistenceGraph")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-335">![Correlation and persistence results](../../../docs/framework/windows-workflow-foundation/media/correlationandpersistencegraph.gif "CorrelationAndPersistenceGraph")</span></span>  
  
 <span data-ttu-id="e7a7a-336">Kontekstowa korelacji jest nadal szybsze niż korelacji na podstawie zawartości.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-336">Context-based correlation is still faster than content-based correlation.</span></span>  <span data-ttu-id="e7a7a-337">Jednak różnica jest mniejsza Wymowa trwałości, ma więcej wpływ na wydajność niż korelacji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-337">However, the difference is less pronounced as persistence has more impact on performance than correlation.</span></span>  
  
### <a name="complex-workflow-throughput"></a><span data-ttu-id="e7a7a-338">Przepływność złożonych przepływów prac</span><span class="sxs-lookup"><span data-stu-id="e7a7a-338">Complex Workflow Throughput</span></span>  
 <span data-ttu-id="e7a7a-339">Złożoność przepływu pracy nie jest mierzony tylko przez liczbę działań.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-339">The complexity of a workflow is not measured only by the number of activities.</span></span>  <span data-ttu-id="e7a7a-340">Działań złożonych może zawierać wielu elementów podrzędnych i te elementy podrzędne można też działań złożonych.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-340">Composite activities can contain many children and those children can also be composite activities.</span></span>  <span data-ttu-id="e7a7a-341">Jako liczby poziomów zagnieżdżenia rośnie co powoduje liczbę działań, które mogą być obecnie w stanie wykonywania i liczba zmiennych, które mogą być w stanie.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-341">As the number of levels of nesting increases, so does the number of activities that can be currently in the executing state and the number of variables that can be in state.</span></span>  <span data-ttu-id="e7a7a-342">Ten test porównuje przepustowość między WF3 i WF4 podczas wykonywania złożonych przepływów pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-342">This test compares throughput between WF3 and WF4 when executing complex workflows.</span></span>  
  
### <a name="test-setup"></a><span data-ttu-id="e7a7a-343">Testuj ustawienia</span><span class="sxs-lookup"><span data-stu-id="e7a7a-343">Test Setup</span></span>  
 <span data-ttu-id="e7a7a-344">Te testy zostały wykonane na Intel Xeon X5355 @ 2,66 GHz 4 sposób komputera z 4 GB pamięci RAM z systemem Windows Server 2008 x64.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-344">These tests were executed on an Intel Xeon X5355 @ 2.66GHz 4-way computer with 4GB RAM running Windows Server 2008 x64.</span></span>  <span data-ttu-id="e7a7a-345">Kod testu jest uruchamiany w ramach jednego procesu o jeden wątek na każdym core do 100% wykorzystanie Procesora.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-345">The test code runs in a single process with one thread per core to reach 100% CPU utilization.</span></span>  
  
 <span data-ttu-id="e7a7a-346">Przepływy pracy, generowany dla tego testu ma dwa główne zmiennych: głębokość i liczbę aktywności w poszczególnych sekwencji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-346">The workflows generated for this test have two main variables: depth and number of activities in each sequence.</span></span>  <span data-ttu-id="e7a7a-347">Każdy poziom głębokości zawiera działanie równoległe, podczas pętli, decyzji, przydziały i sekwencji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-347">Each depth level includes a parallel activity, while loop, decisions, assignments, and sequences.</span></span>  <span data-ttu-id="e7a7a-348">W Projektancie WF4 przedstawianych poniżej przedstawiono najwyższego poziomu schematu blokowego.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-348">In the WF4 designer pictured below, the top-level flow chart is pictured.</span></span>  <span data-ttu-id="e7a7a-349">Każde działanie flowchart podobny głównego schematu blokowego.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-349">Each flowchart activity resembles the main flowchart.</span></span>  <span data-ttu-id="e7a7a-350">Może to być można wyobrazić sobie fraktalowy podczas picturing ten przepływ pracy, której głębokość jest ograniczona do parametrów testu.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-350">It may be helpful to think of a fractal when picturing this workflow, where the depth is limited to the parameters of the test.</span></span>  
  
 <span data-ttu-id="e7a7a-351">Liczba działań w danym testu zależy od głębokości i liczba działań w sekwencji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-351">The number of activities in a given test is determined by the depth and number of activities per sequence.</span></span>  <span data-ttu-id="e7a7a-352">Następujące równanie oblicza liczbę działań w teście WF4:</span><span class="sxs-lookup"><span data-stu-id="e7a7a-352">The following equation computes the number of activities in the WF4 test:</span></span>  
  
 <span data-ttu-id="e7a7a-353">![Równości można obliczyć liczbę działań](../../../docs/framework/windows-workflow-foundation/media/numberofactivitiesequation.gif "NumberOfActivitiesEquation")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-353">![Equation to compute number of activities](../../../docs/framework/windows-workflow-foundation/media/numberofactivitiesequation.gif "NumberOfActivitiesEquation")</span></span>  
  
 <span data-ttu-id="e7a7a-354">Liczba działań testów WF3 można obliczyć z nieco inne równości z powodu sekwencję dodatkowe:</span><span class="sxs-lookup"><span data-stu-id="e7a7a-354">The WF3 test’s activity count can be computed with a slightly different equation due to an extra sequence:</span></span>  
  
 <span data-ttu-id="e7a7a-355">![Równości można obliczyć liczbę działań](../../../docs/framework/windows-workflow-foundation/media/w3numberofactivitiesequation.gif "W3NumberOfActivitiesEquation")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-355">![Equation to compute number of activities](../../../docs/framework/windows-workflow-foundation/media/w3numberofactivitiesequation.gif "W3NumberOfActivitiesEquation")</span></span>  
  
 <span data-ttu-id="e7a7a-356">W przypadku d głębokość, a co jest liczba działań w sekwencji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-356">Where d is the depth and a is the number of activities per sequence.</span></span>  <span data-ttu-id="e7a7a-357">Logiki stojącej za tymi równania jest, że pierwszej stałej pomnożona przez, jest numer sekwencji, a druga stała jest statyczny liczbę działań zawartych w bieżącym poziomie.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-357">The logic behind these equations is that the first constant, multiplied by a, is the number of sequences and the second constant is the static number of activities in the current level.</span></span>  <span data-ttu-id="e7a7a-358">Istnieją trzy działania podrzędne schemat blokowy w każdym schemacie blokowym.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-358">There are three flowchart child activities in each flowchart.</span></span>  <span data-ttu-id="e7a7a-359">Na dolnym poziomie głębokość zaprezentowane te są puste, ale na innych poziomach są kopie głównego schematu blokowego.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-359">At the bottom depth level, these flowcharts are empty but at the other levels they are copies of the main flowchart.</span></span>  <span data-ttu-id="e7a7a-360">Liczba działań w definicji przepływu pracy odmiany każdego testu podane w poniższej tabeli:</span><span class="sxs-lookup"><span data-stu-id="e7a7a-360">The number of activities in each test variation’s workflow definition is indicated in the following table:</span></span>  
  
 <span data-ttu-id="e7a7a-361">![Porównuje liczbę działań używanych w poszczególnych testów](../../../docs/framework/windows-workflow-foundation/media/comparechart.gif "CompareChart")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-361">![Compares number of activities used in each test](../../../docs/framework/windows-workflow-foundation/media/comparechart.gif "CompareChart")</span></span>  
  
 <span data-ttu-id="e7a7a-362">Liczba działań w definicji przepływu pracy znacznie zwiększa się, każdy poziom głębokości.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-362">The number of activities in the workflow definition increases sharply with each depth level.</span></span>  <span data-ttu-id="e7a7a-363">Ale tylko jedną ścieżkę na podjęcie decyzji, czy jest wykonywane w wystąpieniu przepływu są wykonywane tylko mały podzbiór rzeczywistych działań.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-363">But only one path per decision point is executed in a given workflow instance, so only a small subset of the actual activities are executed.</span></span>  
  
 <span data-ttu-id="e7a7a-364">![Złożonych przepływów prac](../../../docs/framework/windows-workflow-foundation/media/complexworkflowthroughputworkflow.gif "ComplexWorkflowThroughputWorkflow")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-364">![Complex Workflow](../../../docs/framework/windows-workflow-foundation/media/complexworkflowthroughputworkflow.gif "ComplexWorkflowThroughputWorkflow")</span></span>  
  
 <span data-ttu-id="e7a7a-365">Odpowiednik przepływ pracy został utworzony dla WF3.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-365">An equivalent workflow was created for WF3.</span></span> <span data-ttu-id="e7a7a-366">Projektant WF3 pokazuje całego przepływu pracy w obszarze projektu zamiast zagnieżdżenia, dlatego jest zbyt duży do wyświetlenia w tym temacie.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-366">The WF3 designer shows the entire workflow in the design area instead of nesting, therefore it is too big to display in this topic.</span></span> <span data-ttu-id="e7a7a-367">Poniżej przedstawiono fragment przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-367">A snippet of the workflow is shown below.</span></span>  
  
 <span data-ttu-id="e7a7a-368">![WF3 Przepływ pracy](../../../docs/framework/windows-workflow-foundation/media/wf3workflow.gif "WF3Workflow")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-368">![WF3 Workflow](../../../docs/framework/windows-workflow-foundation/media/wf3workflow.gif "WF3Workflow")</span></span>  
  
 <span data-ttu-id="e7a7a-369">Wykonywanie zagnieżdżenia w ekstremalnych przypadkach, innego przepływu pracy, który jest częścią tego testu używa 100 sekwencje zagnieżdżone.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-369">To exercise nesting in an extreme case, another workflow that is part of this test uses 100 nested sequences.</span></span>  <span data-ttu-id="e7a7a-370">Najbardziej sekwencji jest jeden `Comment` lub <xref:System.Workflow.Activities.CodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-370">In the innermost sequence is a single `Comment` or <xref:System.Workflow.Activities.CodeActivity>.</span></span>  
  
 <span data-ttu-id="e7a7a-371">![Zagnieżdżone sekwencje](../../../docs/framework/windows-workflow-foundation/media/nestedsequencewf.gif "NestedSequenceWF")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-371">![Nested sequences](../../../docs/framework/windows-workflow-foundation/media/nestedsequencewf.gif "NestedSequenceWF")</span></span>  
  
 <span data-ttu-id="e7a7a-372">Śledzenie i trwałości nie są używane jako część tego testu.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-372">Tracking and persistence are not used as part of this test.</span></span>  
  
### <a name="test-results"></a><span data-ttu-id="e7a7a-373">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="e7a7a-373">Test Results</span></span>  
 <span data-ttu-id="e7a7a-374">![Wykres przepływności](../../../docs/framework/windows-workflow-foundation/media/testresults1.gif "TestResults1")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-374">![Throughput Graph](../../../docs/framework/windows-workflow-foundation/media/testresults1.gif "TestResults1")</span></span>  
  
 <span data-ttu-id="e7a7a-375">Nawet w przypadku złożonych przepływów pracy z dużą głębokość i dużą liczbę działań wyniki są spójne z innych numerów przepływności przedstawionej w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-375">Even with complex workflows with lots of depth and a high number of activities, the performance results are consistent with other throughput numbers shown earlier in this article.</span></span>  <span data-ttu-id="e7a7a-376">Przepływność w WF4 szybciej jest rzędów i musi zostać porównane na skali logarytmicznej.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-376">WF4’s throughput is orders of magnitude faster and has to be compared on a logarithmic scale.</span></span>  
  
### <a name="memory"></a><span data-ttu-id="e7a7a-377">Pamięć</span><span class="sxs-lookup"><span data-stu-id="e7a7a-377">Memory</span></span>  
 <span data-ttu-id="e7a7a-378">Obciążenie pamięci Windows Workflow Foundation jest mierzony w dwóch podstawowych obszarach: złożoności przepływu pracy i liczbę definicji przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-378">The memory overhead of Windows Workflow Foundation is measured in two key areas: workflow complexity and number of workflow definitions.</span></span>  <span data-ttu-id="e7a7a-379">Pomiary pamięci zostały pobrane na stacji roboczej 64-bitowym systemie Windows 7.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-379">Memory measurements were taken on a Windows 7 64-bit workstation.</span></span>  <span data-ttu-id="e7a7a-380">Istnieje wiele sposobów uzyskiwania pomiaru pracy Ustaw rozmiar, takie jak monitorowanie liczników wydajności, sondowanie Environment.WorkingSet lub przy użyciu narzędzia, takiego jak VMMap dostępnej w sklepie [VMMap](http://technet.microsoft.com/sysinternals/dd535533.aspx).</span><span class="sxs-lookup"><span data-stu-id="e7a7a-380">There are many ways to obtain the measurement of working set size such as monitoring performance counters, polling Environment.WorkingSet, or using a tool like VMMap available from [VMMap](http://technet.microsoft.com/sysinternals/dd535533.aspx).</span></span> <span data-ttu-id="e7a7a-381">Kombinacji metod był używany do uzyskania i sprawdź wyniki każdego z testów.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-381">A combination of methods was used to obtain and verify the results of each test.</span></span>  
  
### <a name="workflow-complexity-test"></a><span data-ttu-id="e7a7a-382">Test złożoności przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="e7a7a-382">Workflow Complexity Test</span></span>  
 <span data-ttu-id="e7a7a-383">Przepływ pracy środki testu złożoności zestaw roboczy różnica zależnie od stopnia złożoności przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-383">The workflow complexity test measures the working set difference based on the complexity of the workflow.</span></span>  <span data-ttu-id="e7a7a-384">Oprócz złożonych przepływów pracy, używane w poprzedniej sekcji, nowych zmian zostaną dodane do obejmuje dwa podstawowe przypadków: pojedynczego działania przepływu pracy i sekwencję działań 1000.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-384">In addition to the complex workflows used in the previous section, new variations are added to cover two basic cases: a single activity workflow and a sequence with 1000 activities.</span></span>  <span data-ttu-id="e7a7a-385">Te testy przepływy pracy są zainicjowany i wykonywany w celu zakończenia w jednej pętli serial okres jednej minuty.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-385">For these tests the workflows are initialized and executed to completion in a single serial loop for a period of one minute.</span></span>  <span data-ttu-id="e7a7a-386">Odmiana każdego testu zostanie uruchomione trzy razy, a dane zarejestrowane jest średnią z tych trzech działa.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-386">Each test variation is run three times and the data recorded is the average of those three runs.</span></span>  
  
 <span data-ttu-id="e7a7a-387">Dwa nowe testy podstawowe są przepływy pracy, które wyglądają jak pokazano poniżej:</span><span class="sxs-lookup"><span data-stu-id="e7a7a-387">The two new basic tests have workflows that look like those shown below:</span></span>  
  
 <span data-ttu-id="e7a7a-388">![Przepływy pracy złożonych](../../../docs/framework/windows-workflow-foundation/media/complexworkflowboth.gif "ComplexWorkflowBoth")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-388">![Complex Workflows](../../../docs/framework/windows-workflow-foundation/media/complexworkflowboth.gif "ComplexWorkflowBoth")</span></span>  
  
 <span data-ttu-id="e7a7a-389">W przepływie pracy WF3 pokazanym powyżej pusta <xref:System.Workflow.Activities.CodeActivity> działania są używane.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-389">In the WF3 workflow shown above, empty <xref:System.Workflow.Activities.CodeActivity> activities are used.</span></span>  <span data-ttu-id="e7a7a-390">Przepływ pracy WF4 powyżej używa `Comment` działań.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-390">The WF4 workflow above uses `Comment` activities.</span></span>  <span data-ttu-id="e7a7a-391">`Comment` Działania został opisany w sekcji porównania wydajności poziomie składnika w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-391">The `Comment` activity was described in the Component-level Performance Comparisons section earlier in this article.</span></span>  
  
 <span data-ttu-id="e7a7a-392">![Wykres użycia pamięci](../../../docs/framework/windows-workflow-foundation/media/complexmemoryusage.gif "ComplexMemoryUsage")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-392">![Memory Usage Graph](../../../docs/framework/windows-workflow-foundation/media/complexmemoryusage.gif "ComplexMemoryUsage")</span></span>  
  
 <span data-ttu-id="e7a7a-393">Jednym z wyczyść trendów można zauważyć na tym wykresie jest czy zagnieżdżenia ma stosunkowo minimalny wpływ na użycie pamięci w WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-393">One of the clear trends to notice in this graph is that nesting has relatively minimal impact on memory usage in both WF3 and WF4.</span></span>  <span data-ttu-id="e7a7a-394">Największy wpływ pamięci pochodzi z liczba działań w danym przepływie pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-394">The most significant memory impact comes from the number of activities in a given workflow.</span></span>  <span data-ttu-id="e7a7a-395">Podane dane z sekwencji 1000, złożonych głębokość 5 sekwencji 5 i głębokość złożonych sekwencji 7 1 zmian, jest jasne, czy podczas liczbę działań tysięcy, wzrost użycia pamięci staje się bardziej zauważalne.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-395">Given the data from the sequence 1000, complex depth 5 sequence 5, and complex depth 7 sequence 1 variations, it is clear that as the number of activities enters the thousands, the memory usage increase becomes more noticeable.</span></span>  <span data-ttu-id="e7a7a-396">W przypadku extreme (głębokość 7 sekwencji 1) w przypadku działań ~ 29K WF4 przy użyciu prawie 79% mniej pamięci niż WF3.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-396">In the extreme case (depth 7 sequence 1) where there are ~29K activities, WF4 is using almost 79% less memory than WF3.</span></span>  
  
### <a name="multiple-workflow-definitions-test"></a><span data-ttu-id="e7a7a-397">Wiele testów definicji przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="e7a7a-397">Multiple Workflow Definitions Test</span></span>  
 <span data-ttu-id="e7a7a-398">Pomiaru pamięci dla definicji przepływu pracy jest podzielona na dwie różne testy z powodu dostępne opcje hostingu przepływów pracy w WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-398">Measuring memory per workflow definition is divided into two different tests because of the available options for hosting workflows in WF3 and WF4.</span></span>  <span data-ttu-id="e7a7a-399">Testy są uruchamiane w inny sposób niż badanie złożoności przepływu pracy, w tym danego przepływu pracy jest instancji i wykonywane tylko raz w każdej definicji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-399">The tests are run in a different manner than the workflow complexity test in that a given workflow is instanced and executed only once per definition.</span></span>  <span data-ttu-id="e7a7a-400">Jest to spowodowane definicji przepływu pracy i jej hosta pozostawać w pamięci przez czas ich istnienia elementu AppDomain.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-400">This is because the workflow definition and its host remain in memory for the lifetime of the AppDomain.</span></span>  <span data-ttu-id="e7a7a-401">Pamięć używana przez uruchomienie wystąpienia danego przepływu pracy należy wyczyścić podczas wyrzucania elementów bezużytecznych.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-401">The memory used by running a given workflow instance should be cleaned up during garbage collection.</span></span>  <span data-ttu-id="e7a7a-402">Wskazówki dotyczące migracji dla WF4 zawiera bardziej szczegółowe informacje na temat opcji obsługi.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-402">The migration guidance for WF4 contains more detailed information on the hosting options.</span></span> <span data-ttu-id="e7a7a-403">Aby uzyskać więcej informacji, zobacz [WF migracji Cookbook: przepływu pracy obsługującego](http://go.microsoft.com/fwlink/?LinkID=153313).</span><span class="sxs-lookup"><span data-stu-id="e7a7a-403">For more information, see [WF Migration Cookbook: Workflow Hosting](http://go.microsoft.com/fwlink/?LinkID=153313).</span></span>  
  
 <span data-ttu-id="e7a7a-404">Tworzenie wielu definicji przepływu pracy dla definicji przepływu pracy test może odbywać się na kilka sposobów.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-404">Creating many workflow definitions for a workflow definition test can be done in several ways.</span></span>  <span data-ttu-id="e7a7a-405">Na przykład jedna Użyj generowania kodu, aby utworzyć zbiór 1000 przepływy pracy, które są identyczne z wyjątkiem w nazwie i zapisać każdy z tych przepływów pracy do oddzielnych plików.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-405">For instance, one could use code generation to create a set of 1000 workflows that are identical except in name and save each of those workflows into separate files.</span></span>  <span data-ttu-id="e7a7a-406">Ta metoda została wykonana dla testu hostowanych w konsoli.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-406">This approach was taken for the console-hosted test.</span></span>  <span data-ttu-id="e7a7a-407">W WF3 <xref:System.Workflow.Runtime.WorkflowRuntime> klasa została użyta do uruchomienia definicji przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-407">In WF3, the <xref:System.Workflow.Runtime.WorkflowRuntime> class was used to run the workflow definitions.</span></span>  <span data-ttu-id="e7a7a-408">WF4 musi <xref:System.Activities.WorkflowApplication> można utworzyć wystąpienia przepływu pracy pojedynczego lub bezpośrednio przy użyciu <xref:System.Activities.WorkflowInvoker> do uruchamiania działania, jak w przypadku wywołania metody.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-408">WF4 can either use <xref:System.Activities.WorkflowApplication> to create a single workflow instance or directly use <xref:System.Activities.WorkflowInvoker> to run the activity as if it were a method call.</span></span>  <span data-ttu-id="e7a7a-409"><xref:System.Activities.WorkflowApplication> host wystąpienia jednego przepływu pracy i ma bliżej parzystość funkcji do <xref:System.Workflow.Runtime.WorkflowRuntime> tak, aby została użyta w tego testu.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-409"><xref:System.Activities.WorkflowApplication> is a host of a single workflow instance and has closer feature parity to <xref:System.Workflow.Runtime.WorkflowRuntime> so that was used in this test.</span></span>  
  
 <span data-ttu-id="e7a7a-410">Odnośnie do hostowania przepływów pracy w usługach IIS jest możliwość użycia <xref:System.Web.Hosting.VirtualPathProvider> do tworzenia nowego <xref:System.ServiceModel.WorkflowServiceHost> zamiast generowania wszystkie pliki XAMLX lub pliku XOML.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-410">When hosting workflows in IIS it is possible to use a <xref:System.Web.Hosting.VirtualPathProvider> to create a new <xref:System.ServiceModel.WorkflowServiceHost> instead of generating all of the XAMLX or XOML files.</span></span>  <span data-ttu-id="e7a7a-411"><xref:System.Web.Hosting.VirtualPathProvider> Obsługuje żądania przychodzącego i odpowiada "wirtualnego plik", które mogą być ładowane z bazy danych lub, w tym przypadku jest generowane w locie.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-411">The <xref:System.Web.Hosting.VirtualPathProvider> handles the incoming request and responds with a "virtual file" that can be loaded from a database or, in this case, generated on the fly.</span></span>  <span data-ttu-id="e7a7a-412">Jest konieczne utworzyć pliki fizyczne 1000.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-412">It is therefore unnecessary to create 1000 physical files.</span></span>  
  
 <span data-ttu-id="e7a7a-413">Definicji przepływu pracy w badaniu konsoli zostały prosty sekwencyjny przepływy pracy z jednego działania.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-413">The workflow definitions used in the console test were simple sequential workflows with a single activity.</span></span>  <span data-ttu-id="e7a7a-414">Pojedyncze działanie była pusta <xref:System.Workflow.Activities.CodeActivity> w przypadku WF3 i `Comment` działanie w przypadku WF4.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-414">The single activity was an empty <xref:System.Workflow.Activities.CodeActivity> for the WF3 case and a `Comment` activity for the WF4 case.</span></span>  <span data-ttu-id="e7a7a-415">W przypadku hostowanych przez usługi IIS używane przepływów pracy uruchamianych na odbieranie komunikatów i końcowych na wysyłanie odpowiedzi:</span><span class="sxs-lookup"><span data-stu-id="e7a7a-415">The IIS-hosted case used workflows that start on receiving a message and end on sending a reply:</span></span>  
  
 <span data-ttu-id="e7a7a-416">![Usługi przepływu pracy w WF3 i WF4](../../../docs/framework/windows-workflow-foundation/media/receiveworkflowboth.gif "ReceiveWorkflowBoth")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-416">![Workflow Services in WF3 and WF4](../../../docs/framework/windows-workflow-foundation/media/receiveworkflowboth.gif "ReceiveWorkflowBoth")</span></span>  
  
 <span data-ttu-id="e7a7a-417">Rysunek 4 — przepływ pracy WF3 z ReceiveActivity i WF4 przepływu pracy z wzorcem żądań i odpowiedzi</span><span class="sxs-lookup"><span data-stu-id="e7a7a-417">Figure 4 – WF3 workflow with ReceiveActivity and WF4 workflow with request/response pattern</span></span>  
  
 <span data-ttu-id="e7a7a-418">W poniższej tabeli przedstawiono różnicowej w zestawie roboczym między definicji jednym przepływie pracy i definicje 1001:</span><span class="sxs-lookup"><span data-stu-id="e7a7a-418">The table below shows the delta in working set between a single workflow definition and 1001 definitions:</span></span>  
  
|<span data-ttu-id="e7a7a-419">Opcje hostingu</span><span class="sxs-lookup"><span data-stu-id="e7a7a-419">Hosting Options</span></span>|<span data-ttu-id="e7a7a-420">WF3 Różnica zestawu roboczego</span><span class="sxs-lookup"><span data-stu-id="e7a7a-420">WF3 Working Set Delta</span></span>|<span data-ttu-id="e7a7a-421">WF4 Różnica zestawu roboczego</span><span class="sxs-lookup"><span data-stu-id="e7a7a-421">WF4 Working Set Delta</span></span>|  
|---------------------|---------------------------|---------------------------|  
|<span data-ttu-id="e7a7a-422">Przepływy pracy hostowanej aplikacji konsoli</span><span class="sxs-lookup"><span data-stu-id="e7a7a-422">Console Application Hosted Workflows</span></span>|<span data-ttu-id="e7a7a-423">18 MB</span><span class="sxs-lookup"><span data-stu-id="e7a7a-423">18 MB</span></span>|<span data-ttu-id="e7a7a-424">9 MB</span><span class="sxs-lookup"><span data-stu-id="e7a7a-424">9 MB</span></span>|  
|<span data-ttu-id="e7a7a-425">Przepływ pracy usług hostowanych w programie IIS</span><span class="sxs-lookup"><span data-stu-id="e7a7a-425">IIS Hosted Workflow Services</span></span>|<span data-ttu-id="e7a7a-426">446 MB</span><span class="sxs-lookup"><span data-stu-id="e7a7a-426">446 MB</span></span>|<span data-ttu-id="e7a7a-427">364 MB</span><span class="sxs-lookup"><span data-stu-id="e7a7a-427">364 MB</span></span>|  
  
 <span data-ttu-id="e7a7a-428">Hosting definicji przepływu pracy w programie IIS wykorzystuje znacznie większej ilości pamięci z powodu <xref:System.ServiceModel.WorkflowServiceHost>, są szczegółowe [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] artefaktów i przetwarzania logiki skojarzonej z hostem wiadomości.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-428">Hosting workflow definitions in IIS consumes much more memory due to the <xref:System.ServiceModel.WorkflowServiceHost>, detailed [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] service artifacts, and the message processing logic associated with the host.</span></span>  
  
 <span data-ttu-id="e7a7a-429">Hosting w WF3 przepływy pracy konsoli zostały wprowadzone w kodzie zamiast pliku XOML.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-429">For console hosting in WF3 the workflows were implemented in code instead of XOML.</span></span>  <span data-ttu-id="e7a7a-430">WF4 wartość domyślna to użyj XAML.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-430">In WF4 the default is to use XAML.</span></span>  <span data-ttu-id="e7a7a-431">XAML jest przechowywana jako osadzonego zasobu w zestawie i kompilowane w czasie wykonywania do implementacji przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-431">The XAML is stored as an embedded resource in the assembly and compiled during runtime to provide the implementation of the workflow.</span></span>  <span data-ttu-id="e7a7a-432">Brak niektórych koszty związane z tym procesem.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-432">There is some overhead associated with this process.</span></span>  <span data-ttu-id="e7a7a-433">W celu odpowiedniego porównanie WF3 WF4, kodowane przepływy pracy zostały użyte zamiast XAML.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-433">In order to make a fair comparison between WF3 and WF4, coded workflows were used instead of XAML.</span></span>  <span data-ttu-id="e7a7a-434">Poniżej przedstawiono przykładową przepływów pracy WF4:</span><span class="sxs-lookup"><span data-stu-id="e7a7a-434">An example of one of the WF4 workflows is shown below:</span></span>  
  
```  
public class Workflow1 : Activity  
{  
    protected override Func<Activity> Implementation  
    {  
        get  
        {  
            return new Func<Activity>(() =>  
            {  
                return new Sequence  
                {  
                    Activities = {  
                        new Comment()  
                    }  
                };  
            });  
        }  
        set  
        {  
            base.Implementation = value;  
        }  
    }  
}  
```  
  
 <span data-ttu-id="e7a7a-435">Istnieje wiele czynników, które mogą wpłynąć na zmniejszenie zużycia pamięci.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-435">There are many other factors that can affect memory consumption.</span></span> <span data-ttu-id="e7a7a-436">Nadal ma zastosowanie tego samego porady dla wszystkich programów zarządzanych.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-436">The same advice for all managed programs still applies.</span></span>  <span data-ttu-id="e7a7a-437">W środowiskach hostowanych przez usługi IIS <xref:System.ServiceModel.WorkflowServiceHost> obiektu utworzonego dla definicji przepływu pracy pozostaje w pamięci, dopóki jest pula aplikacji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-437">In IIS-hosted environments, the <xref:System.ServiceModel.WorkflowServiceHost> object created for a workflow definition stays in memory until the application pool is recycled.</span></span>  <span data-ttu-id="e7a7a-438">Powinny być utrzymywane w uwadze podczas zapisywania rozszerzenia.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-438">This should be kept in mind when writing extensions.</span></span>  <span data-ttu-id="e7a7a-439">Ponadto warto uniknąć zmienne "globalne" (zmienne zakresu do całego przepływu pracy) i ograniczyć zakres zmiennych, gdy jest to możliwe.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-439">Also, it is best to avoid "global" variables (variables scoped to the whole workflow) and limit the scope of variables wherever possible.</span></span>  
  
## <a name="workflow-runtime-services"></a><span data-ttu-id="e7a7a-440">Usługi czasu wykonywania przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="e7a7a-440">Workflow Runtime Services</span></span>  
  
### <a name="persistence"></a><span data-ttu-id="e7a7a-441">Trwałość</span><span class="sxs-lookup"><span data-stu-id="e7a7a-441">Persistence</span></span>  
 <span data-ttu-id="e7a7a-442">WF3 i WF4 zarówno składnikiem dostawca trwałości SQL.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-442">WF3 and WF4 both ship with a SQL persistence provider.</span></span>  <span data-ttu-id="e7a7a-443">Dostawca trwałości WF3 SQL jest prostych implementacji, który serializuje wystąpienia przepływu pracy i zapisuje go w obiekcie blob.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-443">The WF3 SQL persistence provider is a simple implementation that serializes the workflow instance and stores it in a blob.</span></span>  <span data-ttu-id="e7a7a-444">Z tego powodu wydajności dostawcy silnie zależna od rozmiaru wystąpienia przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-444">For this reason, the performance of this provider depends heavily on the size of the workflow instance.</span></span>  <span data-ttu-id="e7a7a-445">W WF3 jak opisano wcześniej w tym dokumencie, wielu powodów, można zwiększyć rozmiar wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-445">In WF3, the instance size could increase for many reasons, as is discussed previously in this paper.</span></span>  <span data-ttu-id="e7a7a-446">Wielu klientów, wybierz nie użyć domyślnego dostawcy trwałości SQL, ponieważ przechowywane w bazie danych serializacji wystąpienia daje nie wgląd w stan przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-446">Many customers choose not to use the default SQL persistence provider because storing a serialized instance in a database gives no visibility into the state of the workflow.</span></span>  <span data-ttu-id="e7a7a-447">Aby można było znaleźć określonego przepływu pracy bez wiedzy o identyfikator przepływu pracy, co musi deserializacji każdego wystąpienia utrwalonego i sprawdź, czy zawartość.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-447">In order to find a particular workflow without knowing the workflow id, one would have to deserialize each persisted instance and examine the contents.</span></span>  <span data-ttu-id="e7a7a-448">Wielu deweloperów wolą pisanie własnych dostawców trwałości, aby obejść ten problem.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-448">Many developers prefer to write their own persistence providers to overcome this obstacle.</span></span>  
  
 <span data-ttu-id="e7a7a-449">Dostawca trwałości WF4 SQL próbował rozwiązać niektóre z tych problemów.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-449">The WF4 SQL persistence provider has tried to address some of these concerns.</span></span>  <span data-ttu-id="e7a7a-450">Tabele trwałości ujawnia niektóre informacje, takie jak active zakładek i Awansowanie właściwości.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-450">The persistence tables expose certain information such as the active bookmarks and promotable properties.</span></span>  <span data-ttu-id="e7a7a-451">Nowa funkcja na podstawie zawartości korelacji w WF4 nie przeprowadza się również za pomocą podejście trwałości WF3 SQL, które ma obsługiwanego niektóre zmiany w organizacji wystąpienia utrwalonego przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-451">The new content-based correlation feature in WF4 would not perform well using the WF3 SQL persistence approach, which has driven some change in the organization of the persisted workflow instance.</span></span>  <span data-ttu-id="e7a7a-452">To sprawia, że dostawca trwałości bardziej złożone i umieszcza dodatkowego obciążenia w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-452">This makes the job of the persistence provider more complex and puts extra stress on the database.</span></span>  
  
### <a name="environment-setup"></a><span data-ttu-id="e7a7a-453">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="e7a7a-453">Environment Setup</span></span>  
 <span data-ttu-id="e7a7a-454">![Środowisko testowania wydajności przepływu pracy](../../../docs/framework/windows-workflow-foundation/media/wfperfenvironment.gif "WFPerfEnvironment")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-454">![Workflow Performance Test Environment](../../../docs/framework/windows-workflow-foundation/media/wfperfenvironment.gif "WFPerfEnvironment")</span></span>  
  
### <a name="test-setup"></a><span data-ttu-id="e7a7a-455">Testuj ustawienia</span><span class="sxs-lookup"><span data-stu-id="e7a7a-455">Test Setup</span></span>  
 <span data-ttu-id="e7a7a-456">Nawet w przypadku zestawu ulepszonych funkcji i lepszą obsługę współbieżności dostawca trwałości SQL w WF4 jest szybsza niż podany w WF3.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-456">Even with an improved feature set and better concurrency handling, the SQL persistence provider in WF4 is faster than the provider in WF3.</span></span>  <span data-ttu-id="e7a7a-457">Aby to pokazują, dwa przepływy pracy wykonujące zasadniczo tych samych operacji w WF3 i WF4 są porównywane poniżej.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-457">To showcase this, two workflows that perform essentially the same operations in WF3 and WF4 are compared below.</span></span>  
  
 <span data-ttu-id="e7a7a-458">![Przepływy pracy trwałości](../../../docs/framework/windows-workflow-foundation/media/persistworkflow.gif "PersistWorkflow")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-458">![Persistence Workflows](../../../docs/framework/windows-workflow-foundation/media/persistworkflow.gif "PersistWorkflow")</span></span>  
  
 <span data-ttu-id="e7a7a-459">Rysunek 5 — przepływ pracy trwałości w WF3 w lewo i WF4 po prawej stronie</span><span class="sxs-lookup"><span data-stu-id="e7a7a-459">Figure 5 – Persistence workflow in WF3 on left and WF4 on right</span></span>  
  
 <span data-ttu-id="e7a7a-460">Dwa przepływy pracy są tworzone przez odebranego komunikatu.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-460">The two workflows are both created by a received message.</span></span>  <span data-ttu-id="e7a7a-461">Po wysłaniu odpowiedzi na wiadomość początkowej, przepływ pracy jest trwały.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-461">After sending an initial reply, the workflow is persisted.</span></span>  <span data-ttu-id="e7a7a-462">W przypadku WF3 pustą <xref:System.Workflow.ComponentModel.TransactionScopeActivity> służy do inicjowania trwałość.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-462">In the WF3 case, an empty <xref:System.Workflow.ComponentModel.TransactionScopeActivity> is used to initiate the persistence.</span></span>  <span data-ttu-id="e7a7a-463">Taki sam może być uzyskane w WF3 przez oznaczenie działania jako "utrwalić Zamknij".</span><span class="sxs-lookup"><span data-stu-id="e7a7a-463">The same could be achieved in WF3 by marking an activity as "persist on close."</span></span>  <span data-ttu-id="e7a7a-464">Drugi skorelowany komunikat zakończeniu przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-464">A second, correlated message completes the workflow.</span></span>  <span data-ttu-id="e7a7a-465">Przepływy pracy są zachowywane, ale nie został zwolniony.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-465">The workflows are persisted but not unloaded.</span></span>  
  
### <a name="test-results"></a><span data-ttu-id="e7a7a-466">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="e7a7a-466">Test Results</span></span>  
 <span data-ttu-id="e7a7a-467">![Przepływność trwałości](../../../docs/framework/windows-workflow-foundation/media/throughputpersistence.gif "ThroughputPersistence")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-467">![Throughput Persistence](../../../docs/framework/windows-workflow-foundation/media/throughputpersistence.gif "ThroughputPersistence")</span></span>  
  
 <span data-ttu-id="e7a7a-468">Podczas transportu między klientem a warstwy środkowej, jest protokół HTTP, trwałość WF4 wykazuje wzrost 2.6 razy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-468">When the transport between client and middle tier is HTTP, persistence in WF4 shows an improvement of 2.6 times.</span></span>  <span data-ttu-id="e7a7a-469">Transportu TCP zwiększa współczynnik godziny 3.0.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-469">The TCP transport increases that factor to 3.0 times.</span></span>  <span data-ttu-id="e7a7a-470">We wszystkich przypadkach, użycie procesora CPU na warstwy środkowej to 98% lub nowszego.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-470">In all cases, CPU utilization on the middle tier is 98% or higher.</span></span>  <span data-ttu-id="e7a7a-471">Przyczyny, że przepływność WF4 jest większa jest spowodowane szybsze środowiska uruchomieniowego przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-471">The reason that WF4 throughput is greater is due to the faster workflow runtime.</span></span>  <span data-ttu-id="e7a7a-472">Rozmiar serializowanym wystąpieniu brakuje w obu przypadkach i nie jest głównym elementem uczestniczących w takiej sytuacji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-472">The size of the serialized instance is low for both cases and is not a major contributing element in this situation.</span></span>  
  
 <span data-ttu-id="e7a7a-473">WF3 i WF4 przepływów pracy w tym teście użyć działania, aby jawnie wskazać podczas utrwalania powinna się odbyć.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-473">Both the WF3 and WF4 workflows in this test use an activity to explicitly indicate when persistence should occur.</span></span>  <span data-ttu-id="e7a7a-474">Zaletą utrwalanie przepływu pracy bez wyładowywanie to ustawienie.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-474">This has the benefit of persisting the workflow without unloading it.</span></span>  <span data-ttu-id="e7a7a-475">W WF3, również jest możliwy do utrwalenia przy użyciu <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> funkcji, ale zwalnia wystąpienie przepływu pracy z pamięci.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-475">In WF3, it is also possible to persist using the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> feature, but this unloads the workflow instance from memory.</span></span>  <span data-ttu-id="e7a7a-476">Jeśli przy użyciu WF3 Deweloper chce upewnij się, że przepływ pracy będzie się powtarzać, w niektórych punktach, albo muszą zmieniać definicji przepływu pracy lub zwrócić koszt zwolnienie i ponowne ładowanie wystąpienia przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-476">If a developer using WF3 wants to make sure a workflow persists at certain points, they either have to alter the workflow definition or pay the cost for unloading and re-loading the workflow instance.</span></span>  <span data-ttu-id="e7a7a-477">Nową funkcją w WF4 umożliwia utrwalić bez zwalnianie: <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-477">A new feature in WF4 makes it possible to persist without unloading: <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>.</span></span>  <span data-ttu-id="e7a7a-478">Ta funkcja umożliwia wystąpienia przepływu pracy utrwalone w stanie bezczynności, ale pozostaje w pamięci do <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> zostały spełnione warunki progowe lub wykonywania zostanie wznowione.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-478">This feature allows the workflow instance to be persisted on idle but stay in memory until the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> threshold is met or execution is resumed.</span></span>  
  
 <span data-ttu-id="e7a7a-479">Należy pamiętać, że dostawca trwałości WF4 SQL wykonuje więcej pracy w warstwie bazy danych.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-479">Note that the WF4 SQL persistence provider performs more work in the database tier.</span></span>  <span data-ttu-id="e7a7a-480">Bazy danych SQL może stać się wąskiego gardła, dlatego ważne jest, aby monitorować wykorzystanie Procesora i dysku.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-480">The SQL database can become a bottleneck so it is important to monitor the CPU and disk usage there.</span></span>  <span data-ttu-id="e7a7a-481">Należy uwzględnić następujące liczniki wydajności z SQL bazy danych podczas testowania aplikacji przepływu pracy:</span><span class="sxs-lookup"><span data-stu-id="e7a7a-481">Be sure to include the following performance counters from the SQL database when performance testing workflow applications:</span></span>  
  
-   <span data-ttu-id="e7a7a-482">Dysk fizyczny\\czas odczytu z dysku %</span><span class="sxs-lookup"><span data-stu-id="e7a7a-482">PhysicalDisk\\%Disk Read Time</span></span>  
  
-   <span data-ttu-id="e7a7a-483">Dysk fizyczny\\czas dysku (%)</span><span class="sxs-lookup"><span data-stu-id="e7a7a-483">PhysicalDisk\\% Disk Time</span></span>  
  
-   <span data-ttu-id="e7a7a-484">Dysk fizyczny\\czas zapisu dysku %</span><span class="sxs-lookup"><span data-stu-id="e7a7a-484">PhysicalDisk\\% Disk Write Time</span></span>  
  
-   <span data-ttu-id="e7a7a-485">Dysk fizyczny\\% średni Długość kolejki dysku</span><span class="sxs-lookup"><span data-stu-id="e7a7a-485">PhysicalDisk\\% Avg. Disk Queue Length</span></span>  
  
-   <span data-ttu-id="e7a7a-486">Dysk Fizyczny\średni Długość kolejki odczytu dysku</span><span class="sxs-lookup"><span data-stu-id="e7a7a-486">PhysicalDisk\Avg. Disk Read Queue Length</span></span>  
  
-   <span data-ttu-id="e7a7a-487">Dysk Fizyczny\średni Długość kolejki dysku zapisu</span><span class="sxs-lookup"><span data-stu-id="e7a7a-487">PhysicalDisk\Avg. Disk Write Queue Length</span></span>  
  
-   <span data-ttu-id="e7a7a-488">Długość kolejki dysku PhysicalDisk\Current</span><span class="sxs-lookup"><span data-stu-id="e7a7a-488">PhysicalDisk\Current Disk Queue Length</span></span>  
  
-   <span data-ttu-id="e7a7a-489">Informacje o procesorze\\czas procesora (%)</span><span class="sxs-lookup"><span data-stu-id="e7a7a-489">Processor Information\\% Processor Time</span></span>  
  
-   <span data-ttu-id="e7a7a-490">Czas oczekiwania zatrzaśnięcia SQLServer:Latches\Average (ms)</span><span class="sxs-lookup"><span data-stu-id="e7a7a-490">SQLServer:Latches\Average Latch Wait Time (ms)</span></span>  
  
-   <span data-ttu-id="e7a7a-491">SQLServer:Latches\Latch czeka na sekundę</span><span class="sxs-lookup"><span data-stu-id="e7a7a-491">SQLServer:Latches\Latch Waits/sec</span></span>  
  
### <a name="tracking"></a><span data-ttu-id="e7a7a-492">Śledzenie</span><span class="sxs-lookup"><span data-stu-id="e7a7a-492">Tracking</span></span>  
 <span data-ttu-id="e7a7a-493">Śledzenia przepływu pracy można śledzić postęp przepływ pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-493">Workflow tracking can be used to track the progress of a workflow.</span></span>  <span data-ttu-id="e7a7a-494">Informacje, które są dołączane do zdarzeń śledzenia jest określana przez profilu śledzenia.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-494">The information that is included in the tracking events is determined by a tracking profile.</span></span>  <span data-ttu-id="e7a7a-495">Im bardziej złożonych staje się profilu śledzenia droższe śledzenia.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-495">The more complex the tracking profile, the more expensive tracking becomes.</span></span>  
  
 <span data-ttu-id="e7a7a-496">WF3 zostały wydane z usługą SQL na podstawie śledzenia.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-496">WF3 shipped with a SQL-based tracking service.</span></span>  <span data-ttu-id="e7a7a-497">Ta usługa może działa w trybach wsadów i niewsadowego.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-497">This service could work in batched and non-batched modes.</span></span>  <span data-ttu-id="e7a7a-498">Trybu niewsadowego zdarzenia śledzenia są zapisywane bezpośrednio w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-498">In non-batched mode, tracking events are written directly to the database.</span></span>  <span data-ttu-id="e7a7a-499">W trybie wsadów zdarzenia śledzenia są zbierane w tej samej partii jako stan wystąpienia przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-499">In batched mode, tracking events are collected into the same batch as the workflow instance state.</span></span>  <span data-ttu-id="e7a7a-500">Tryb wsadów ma najlepszą wydajność dla najszerszego zakresu projektów przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-500">The batched mode has the best performance for the widest range of workflow designs.</span></span>  <span data-ttu-id="e7a7a-501">Jednak przetwarzanie wsadowe może mieć negatywny wpływ na wydajność, jeśli przepływ pracy działa wiele działań bez utrwalanie i te działania są śledzone.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-501">However, batching can have a negative performance impact if the workflow runs many activities without persisting and those activities are tracked.</span></span>  <span data-ttu-id="e7a7a-502">To powszechnie się stanie w pętli i najlepszym sposobem uniknięcia tego scenariusza jest zaprojektować dużych pętli do zawiera punktu trwałości.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-502">This would commonly happen in loops and the best way to avoid this scenario is to design large loops to contain a persistence point.</span></span>  <span data-ttu-id="e7a7a-503">Wprowadzenie punktu trwałości w pętlę może negatywnie wpłynąć na wydajność, a także tak ważne jest, aby zmierzyć kosztów każdego i opracowywane równowagi.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-503">Introducing a persistence point into a loop can negatively affect performance as well so it is important to measure the costs of each and come up with a balance.</span></span>  
  
 <span data-ttu-id="e7a7a-504">WF4 nie jest dostarczany z usługi śledzenia SQL.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-504">WF4 is not shipped with a SQL tracking service.</span></span>  <span data-ttu-id="e7a7a-505">Rejestrowanie śledzenia informacji do bazy danych SQL można być lepiej obsłużone z serwera aplikacji zamiast wbudowanych w [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e7a7a-505">Recording tracking information to a SQL database can be handled better from an application server rather than built into the [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)].</span></span> <span data-ttu-id="e7a7a-506">W związku z tym śledzenia SQL jest teraz obsługiwany przez AppFabric.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-506">Therefore SQL tracking is now handled by AppFabric.</span></span>  <span data-ttu-id="e7a7a-507">Dostawca śledzenia poza pole w WF4 jest oparta na funkcji Śledzenie zdarzeń systemu Windows ().</span><span class="sxs-lookup"><span data-stu-id="e7a7a-507">The out-of-the-box tracking provider in WF4 is based on Event Tracing for Windows (ETW).</span></span>  
  
 <span data-ttu-id="e7a7a-508">ETW jest systemem zdarzeń jądra poziom, małe opóźnienia wbudowanego w systemie Windows.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-508">ETW is a kernel-level, low-latency event system built into Windows.</span></span>  <span data-ttu-id="e7a7a-509">Używa modelu dostawcy/klienta, który umożliwia tylko uniknięcie kary do śledzenia zdarzeń po faktycznie konsumenta.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-509">It uses a provider/consumer model that makes it possible to only incur the penalty for event tracing when there is actually a consumer.</span></span>  <span data-ttu-id="e7a7a-510">Oprócz zdarzeń jądra, np. procesora, dysku, pamięci i obciążenie sieci wiele aplikacji również korzystać z funkcji ETW.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-510">In addition to kernel events such as processor, disk, memory, and network usage, many applications leverage ETW as well.</span></span>  <span data-ttu-id="e7a7a-511">Zdarzenia ETW są bardziej efektywne niż liczniki wydajności, gdyż zdarzenia można dostosować do aplikacji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-511">ETW events are more powerful than performance counters in that events can be customized to the application.</span></span>  <span data-ttu-id="e7a7a-512">Zdarzenie może zawierać tekstu, takiego jak identyfikator przepływu pracy lub komunikat informacyjny.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-512">An event can contain text such as a workflow ID or an informational message.</span></span>  <span data-ttu-id="e7a7a-513">Ponadto zdarzenia są skategoryzowane masek bitowych tak, aby korzystanie z podzbioru zdarzeń będzie miał mniejszą wpływ na wydajność niż przechwytywania wszystkich zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-513">Also, events are categorized with bitmasks so that consuming a certain subset of events will have less performance impact than capturing all events.</span></span>  
  
 <span data-ttu-id="e7a7a-514">Aby podejście za pomocą funkcji ETW śledzenia zamiast SQL korzyści:</span><span class="sxs-lookup"><span data-stu-id="e7a7a-514">Benefits to the approach of using ETW for tracking instead of SQL include:</span></span>  
  
-   <span data-ttu-id="e7a7a-515">Kolekcja śledzenia zdarzeń można podzielić na inny proces.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-515">Collection of tracking events can be separated to another process.</span></span>  <span data-ttu-id="e7a7a-516">Daje to większą elastyczność w jaki sposób są rejestrowane zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-516">This gives greater flexibility in how the events are recorded.</span></span>  
  
-   <span data-ttu-id="e7a7a-517">Zdarzenia ETW śledzenia łatwo są łączone z [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] ETW zdarzeń lub innych dostawców ETW, takiego jak dostawca programu SQL Server lub jądra.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-517">ETW tracking events are easily combined with the [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] ETW events or other ETW providers such as a SQL Server or kernel provider.</span></span>  
  
-   <span data-ttu-id="e7a7a-518">Autorzy przepływu pracy nie trzeba zmieniać przepływu pracy, aby lepiej współpracuje z implementacji programu konkretnego śledzenia, takich jak Usługa śledzenia WF3 SQL trybie wsadowym.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-518">Workflow authors do not need to alter a workflow to work better with a particular tracking implementation, such as the WF3 SQL tracking service’s batch mode.</span></span>  
  
-   <span data-ttu-id="e7a7a-519">Administrator może włączyć śledzenie lub wyłączyć bez odtwarzania procesu hosta.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-519">An administrator can turn tracking on or off without recycling the host process.</span></span>  
  
 <span data-ttu-id="e7a7a-520">Korzyści w zakresie wydajności do śledzenia funkcji ETW są dostarczane z wadą.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-520">The performance benefits to ETW tracking come with a drawback.</span></span>  <span data-ttu-id="e7a7a-521">Zdarzenia ETW mogą zostać utracone, jeśli system jest wykorzystanie zasobów intensywny.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-521">ETW events can be lost if the system is under intense resource pressure.</span></span>  <span data-ttu-id="e7a7a-522">Przetwarzanie zdarzeń nie jest przeznaczone do blokowania normalnego działania programu i w związku z tym nie ma żadnej gwarancji czy wszystkie zdarzenia ETW będzie emisji do subskrybentów.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-522">The processing of events is not meant to block normal program execution and therefore it is not guaranteed that all ETW events will be broadcast to their subscribers.</span></span>  <span data-ttu-id="e7a7a-523">Dzięki temu śledzenia funkcji ETW doskonałe rozwiązanie dla monitorowanie kondycji, ale nie nadaje się do inspekcji.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-523">This makes ETW tracking great for health monitoring but not suitable for auditing.</span></span>  
  
 <span data-ttu-id="e7a7a-524">Gdy WF4 nie ma dostawcy śledzenia SQL, wykonuje AppFabric.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-524">While WF4 does not have a SQL tracking provider, AppFabric does.</span></span>  <span data-ttu-id="e7a7a-525">Podejście śledzenia SQL w AppFabric jest subskrybowanie zdarzeń ETW za pomocą usługi systemu Windows, która partii zdarzeń i zapisuje je w tabeli SQL przeznaczony do wstawienia szybkie.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-525">AppFabric’s SQL tracking approach is to subscribe to ETW events with a Windows Service that batches the events and writes them to a SQL table designed for quick inserts.</span></span>  <span data-ttu-id="e7a7a-526">Osobne zadanie wstrzymanie danych z tej tabeli i reforms go do tabel, które mogą być wyświetlane na pulpicie nawigacyjnym AppFabric raportowania.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-526">A separate job drains the data from this table and reforms it into reporting tables that can be viewed on the AppFabric dashboard.</span></span>  <span data-ttu-id="e7a7a-527">Oznacza to, że partia śledzenia zdarzeń jest obsługiwane niezależnie od przepływu pracy, pochodzi z, a w związku z tym nie ma upłynąć punktu trwałości rejestrowane.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-527">This means that a batch of tracking events is handled independent of the workflow it came from and therefore does not have to wait for a persistence point before being recorded.</span></span>  
  
 <span data-ttu-id="e7a7a-528">Zdarzenia ETW może zostać zarejestrowana przy użyciu narzędzi, takich jak logman lub program xperf.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-528">ETW events can be recorded with tools such as logman or xperf.</span></span>  <span data-ttu-id="e7a7a-529">Można wyświetlić z narzędzia, takiego jak xperfview lub przekonwertować na bardziej czytelnym formacie XML, np. z tracerpt compact pliku ETL.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-529">The compact ETL file can be viewed with a tool like xperfview or converted to a more readable format, such as XML, with tracerpt.</span></span>  <span data-ttu-id="e7a7a-530">W WF3 tylko opcja pobierania śledzenia zdarzeń bez bazy danych SQL jest tworzenie niestandardowych śledzenia usługi.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-530">In WF3, the only option for getting tracking events without a SQL database is to create a custom tracking service.</span></span> [!INCLUDE[crabout](../../../includes/crabout-md.md)]<span data-ttu-id="e7a7a-531"> ETW, zobacz [usługi WCF i śledzenia zdarzeń dla systemu Windows](../../../docs/framework/wcf/samples/wcf-services-and-event-tracing-for-windows.md) i [śledzenia zdarzeń dla systemu Windows](http://msdn.microsoft.com/library/ff190903.aspx\)).</span><span class="sxs-lookup"><span data-stu-id="e7a7a-531"> ETW, see [WCF Services and Event Tracing for Windows](../../../docs/framework/wcf/samples/wcf-services-and-event-tracing-for-windows.md) and [Event Tracing for Windows](http://msdn.microsoft.com/library/ff190903.aspx\)).</span></span>  
  
 <span data-ttu-id="e7a7a-532">Włączanie śledzenia przepływu pracy będzie miało wpływ na wydajność w różnym stopniu.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-532">Enabling workflow tracking will impact performance in varying degrees.</span></span>  <span data-ttu-id="e7a7a-533">Testu porównawczego poniżej używa narzędzia logman do wykorzystania ETW śledzenia zdarzeń i zarejestruj je do pliku ETL.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-533">The benchmark below uses the logman tool to consume the ETW tracking events and record them to an ETL file.</span></span>  <span data-ttu-id="e7a7a-534">Koszt śledzenia w AppFabric SQL nie jest w zakres tego artykułu.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-534">The cost of the SQL tracking in AppFabric is not in the scope of this article.</span></span>  <span data-ttu-id="e7a7a-535">Profil śledzenia podstawowego, również w AppFabric, jest wyświetlana w testu wydajności.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-535">The basic tracking profile, also used in AppFabric, is shown in this benchmark.</span></span>  <span data-ttu-id="e7a7a-536">Dołączone są także koszt tylko kondycji monitorowanie zdarzeń śledzenia.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-536">Also included is the cost of tracking only health monitoring events.</span></span>  <span data-ttu-id="e7a7a-537">Zdarzenia te są przydatne podczas rozwiązywania problemów oraz określania średniej przepływności systemu.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-537">These events are useful for troubleshooting problems and determining the average throughput of the system.</span></span>  
  
### <a name="environment-setup"></a><span data-ttu-id="e7a7a-538">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="e7a7a-538">Environment Setup</span></span>  
 <span data-ttu-id="e7a7a-539">![Środowisko testowania wydajności przepływu pracy](../../../docs/framework/windows-workflow-foundation/media/wfperfenvironment.gif "WFPerfEnvironment")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-539">![Workflow Performance Test Environment](../../../docs/framework/windows-workflow-foundation/media/wfperfenvironment.gif "WFPerfEnvironment")</span></span>  
  
### <a name="test-results"></a><span data-ttu-id="e7a7a-540">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="e7a7a-540">Test Results</span></span>  
 <span data-ttu-id="e7a7a-541">![Przepływ pracy śledzenie kosztów](../../../docs/framework/windows-workflow-foundation/media/workflowtracingcost.gif "WorkflowTracingCost")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-541">![Workflow Tracing Cost](../../../docs/framework/windows-workflow-foundation/media/workflowtracingcost.gif "WorkflowTracingCost")</span></span>  
  
 <span data-ttu-id="e7a7a-542">Monitorowanie kondycji ma około 3% wpływ na wydajność.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-542">Health monitoring has roughly a 3% impact on throughput.</span></span>  <span data-ttu-id="e7a7a-543">Koszt profilu podstawowego wynosi około 8%.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-543">The basic profile’s cost is around 8%.</span></span>  
  
## <a name="interop"></a><span data-ttu-id="e7a7a-544">Współdziałanie</span><span class="sxs-lookup"><span data-stu-id="e7a7a-544">Interop</span></span>  
 <span data-ttu-id="e7a7a-545">WF4 jest prawie pełna poprawione [!INCLUDE[wf1](../../../includes/wf1-md.md)] i w związku z tym WF3 przepływów pracy i działań nie są bezpośrednio zgodne z WF4.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-545">WF4 is almost a complete rewrite of [!INCLUDE[wf1](../../../includes/wf1-md.md)] and therefore WF3 workflows and activities are not directly compatible with WF4.</span></span>  <span data-ttu-id="e7a7a-546">Wielu klientów, które wcześniej przyjęte Windows Workflow Foundation ma wewnętrznych lub innych firm definicji przepływu pracy i działań niestandardowych do WF3.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-546">Many customers that adopted Windows Workflow Foundation early will have in-house or third-party workflow definitions and custom activities for WF3.</span></span>  <span data-ttu-id="e7a7a-547">Jednym ze sposobów ułatwić przejście WF4 ma użyć działania Interop, które można wykonywać działania WF3 z WF4 przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-547">One way to ease the transition to WF4 is to use the Interop activity, which can execute WF3 activities from within a WF4 workflow.</span></span>  <span data-ttu-id="e7a7a-548">Zalecane jest <xref:System.Activities.Statements.Interop> działania można używać tylko gdy jest to konieczne.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-548">It is recommended that the <xref:System.Activities.Statements.Interop> activity only be used when necessary.</span></span> [!INCLUDE[crabout](../../../includes/crabout-md.md)]<span data-ttu-id="e7a7a-549"> Migrowanie do wyewidencjonowania WF4 [wskazówki dotyczące migracji WF4](http://go.microsoft.com/fwlink/?LinkID=153313).</span><span class="sxs-lookup"><span data-stu-id="e7a7a-549"> migrating to WF4 check out the [WF4 Migration Guidance](http://go.microsoft.com/fwlink/?LinkID=153313).</span></span>  
  
### <a name="environment-setup"></a><span data-ttu-id="e7a7a-550">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="e7a7a-550">Environment Setup</span></span>  
 <span data-ttu-id="e7a7a-551">![Środowisko testowania wydajności przepływu pracy](../../../docs/framework/windows-workflow-foundation/media/wfperfenvironment.gif "WFPerfEnvironment")</span><span class="sxs-lookup"><span data-stu-id="e7a7a-551">![Workflow Performance Test Environment](../../../docs/framework/windows-workflow-foundation/media/wfperfenvironment.gif "WFPerfEnvironment")</span></span>  
  
### <a name="test-results"></a><span data-ttu-id="e7a7a-552">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="e7a7a-552">Test Results</span></span>  
 <span data-ttu-id="e7a7a-553">W poniższej tabeli przedstawiono wyniki działania przepływu pracy zawierające pięć działań w sekwencji w różnych konfiguracjach.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-553">The table below shows the results of running a workflow containing five activities in a sequence in various configurations.</span></span>  
  
|<span data-ttu-id="e7a7a-554">Test</span><span class="sxs-lookup"><span data-stu-id="e7a7a-554">Test</span></span>|<span data-ttu-id="e7a7a-555">Przepływność (przepływy pracy/s)</span><span class="sxs-lookup"><span data-stu-id="e7a7a-555">Throughput (workflows/sec)</span></span>|  
|----------|-----------------------------------|  
|<span data-ttu-id="e7a7a-556">Sekwencja WF3 w środowisku uruchomieniowym WF3</span><span class="sxs-lookup"><span data-stu-id="e7a7a-556">WF3 Sequence in WF3 runtime</span></span>|<span data-ttu-id="e7a7a-557">1,576</span><span class="sxs-lookup"><span data-stu-id="e7a7a-557">1,576</span></span>|  
|<span data-ttu-id="e7a7a-558">Sekwencja WF3 w środowisku uruchomieniowym WF4 za pomocą międzyoperacyjności</span><span class="sxs-lookup"><span data-stu-id="e7a7a-558">WF3 Sequence in WF4 runtime using Interop</span></span>|<span data-ttu-id="e7a7a-559">2,745</span><span class="sxs-lookup"><span data-stu-id="e7a7a-559">2,745</span></span>|  
|<span data-ttu-id="e7a7a-560">WF4 sekwencji</span><span class="sxs-lookup"><span data-stu-id="e7a7a-560">WF4 Sequence</span></span>|<span data-ttu-id="e7a7a-561">153,582</span><span class="sxs-lookup"><span data-stu-id="e7a7a-561">153,582</span></span>|  
  
 <span data-ttu-id="e7a7a-562">Zwiększenie wydajności zauważalne za pomocą międzyoperacyjności za pośrednictwem prostych WF3 nie istnieje.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-562">There is a notable performance increase to using Interop over straight WF3.</span></span>  <span data-ttu-id="e7a7a-563">Jednak gdy porównane z działaniami WF4, wzrost jest niewielka.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-563">However, when compared against WF4 activities, the increase is negligible.</span></span>  
  
## <a name="summary"></a><span data-ttu-id="e7a7a-564">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="e7a7a-564">Summary</span></span>  
 <span data-ttu-id="e7a7a-565">Wysokie inwestycje wydajności WF4 zapłacić w wielu obszarach kluczową rolę.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-565">Heavy investments in performance for WF4 have paid off in many crucial areas.</span></span>  <span data-ttu-id="e7a7a-566">Wydajność składników przepływu pracy jest w niektórych przypadkach kilkaset razy szybsze w porównaniu z powodu leaner WF3 WF4 [!INCLUDE[wf1](../../../includes/wf1-md.md)] środowiska wykonawczego.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-566">Individual workflow component performance is in some cases hundreds of times faster in WF4 compared to WF3 due to a leaner [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="e7a7a-567">Znacznie lepszą są również wartościami opóźnień.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-567">Latency numbers are significantly better as well.</span></span>  <span data-ttu-id="e7a7a-568">To oznacza spadek wydajności przy użyciu [!INCLUDE[wf1](../../../includes/wf1-md.md)] przeciwieństwie programowania ręcznego [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] usługi orchestration jest bardzo mała, biorąc pod uwagę przy użyciu dodatkowych zalet [!INCLUDE[wf1](../../../includes/wf1-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e7a7a-568">This means the performance penalty for using [!INCLUDE[wf1](../../../includes/wf1-md.md)] as opposed to hand-coding [!INCLUDE[indigo2](../../../includes/indigo2-md.md)] orchestration services is very small considering the added benefits of using [!INCLUDE[wf1](../../../includes/wf1-md.md)].</span></span>  <span data-ttu-id="e7a7a-569">Zwiększa wydajność trwałości przez współczynnik 2.5 3.0.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-569">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="e7a7a-570">Monitorowanie kondycji za pomocą przepływu pracy śledzenia teraz ma nadmiernego obciążenia.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-570">Health monitoring by means of workflow tracking now has very little overhead.</span></span>  <span data-ttu-id="e7a7a-571">Kompleksowy zestaw przewodniki dotyczące migracji są dostępne dla tych, które są uwzględnieniu przenoszenie z WF3 do WF4.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-571">A comprehensive set of migration guides are available for those that are considering moving from WF3 to WF4.</span></span>  <span data-ttu-id="e7a7a-572">Wszystkie te należy wykonać WF4 atrakcyjną opcję do pisania aplikacji złożonych.</span><span class="sxs-lookup"><span data-stu-id="e7a7a-572">All of this should make WF4 an attractive option for writing complex applications.</span></span>  
  
## <a name="acknowledgements"></a><span data-ttu-id="e7a7a-573">Potwierdzeń</span><span class="sxs-lookup"><span data-stu-id="e7a7a-573">Acknowledgements</span></span>  
 <span data-ttu-id="e7a7a-574">Wiele dzięki użyciu następujące współautorzy i osoby dokonujące przeglądu dla ich wysiłków:</span><span class="sxs-lookup"><span data-stu-id="e7a7a-574">Many thanks to the following contributors and reviewers for their efforts:</span></span>  
  
-   <span data-ttu-id="e7a7a-575">Leon Welicki firma Microsoft Corporation</span><span class="sxs-lookup"><span data-stu-id="e7a7a-575">Leon Welicki, Microsoft Corporation</span></span>  
  
-   <span data-ttu-id="e7a7a-576">Ryszard Kwiecinski firma Microsoft Corporation</span><span class="sxs-lookup"><span data-stu-id="e7a7a-576">Ryszard Kwiecinski, Microsoft Corporation</span></span>  
  
-   <span data-ttu-id="e7a7a-577">Emil Velinov, firma Microsoft Corporation</span><span class="sxs-lookup"><span data-stu-id="e7a7a-577">Emil Velinov, Microsoft Corporation</span></span>  
  
-   <span data-ttu-id="e7a7a-578">Jan Talbert, firma Microsoft Corporation</span><span class="sxs-lookup"><span data-stu-id="e7a7a-578">Nate Talbert, Microsoft Corporation</span></span>  
  
-   <span data-ttu-id="e7a7a-579">Robert Schmidt, firma Microsoft Corporation</span><span class="sxs-lookup"><span data-stu-id="e7a7a-579">Bob Schmidt, Microsoft Corporation</span></span>  
  
-   <span data-ttu-id="e7a7a-580">Stefan Batres, firma Microsoft Corporation</span><span class="sxs-lookup"><span data-stu-id="e7a7a-580">Stefan Batres, Microsoft Corporation</span></span>
