---
title: Wydajność programu Windows Workflow Foundation 4
ms.date: 03/30/2017
ms.assetid: 67d2b3e8-3777-49f8-9084-abbb33b5a766
ms.openlocfilehash: 51cd5b248789c85ab06073f1bb41a83e5f97c139
ms.sourcegitcommit: 127343afce8422bfa944c8b0c4ecc8f79f653255
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 06/25/2019
ms.locfileid: "67348535"
---
# <a name="windows-workflow-foundation-4-performance"></a><span data-ttu-id="af963-102">Wydajność programu Windows Workflow Foundation 4</span><span class="sxs-lookup"><span data-stu-id="af963-102">Windows Workflow Foundation 4 Performance</span></span>

 <span data-ttu-id="af963-103">Microsoft [!INCLUDE[netfx40_long](../../../includes/netfx40-long-md.md)] obejmuje znaczne zmiany programu Windows Workflow Foundation (WF) przy użyciu dużych inwestycji w wydajności.</span><span class="sxs-lookup"><span data-stu-id="af963-103">Microsoft [!INCLUDE[netfx40_long](../../../includes/netfx40-long-md.md)] includes a major revision of the Windows Workflow Foundation (WF) with heavy investments in performance.</span></span>  <span data-ttu-id="af963-104">Ta nowa poprawka wprowadza znaczących zmian z poprzednich wersji [!INCLUDE[wf1](../../../includes/wf1-md.md)] dostarczonego jako część .NET Framework 3.0 i [!INCLUDE[netfx35_short](../../../includes/netfx35-short-md.md)].</span><span class="sxs-lookup"><span data-stu-id="af963-104">This new revision introduces significant design changes from the previous versions of [!INCLUDE[wf1](../../../includes/wf1-md.md)] that shipped as part of .NET Framework 3.0 and [!INCLUDE[netfx35_short](../../../includes/netfx35-short-md.md)].</span></span> <span data-ttu-id="af963-105">Została zmieniona od podstawowej w modelu programowania, środowiska uruchomieniowego i narzędzi znacznie zwiększyć wydajność i użyteczność.</span><span class="sxs-lookup"><span data-stu-id="af963-105">It has been re-architected from the core of the programming model, runtime, and tooling to greatly improve performance and usability.</span></span> <span data-ttu-id="af963-106">W tym temacie przedstawiono ważne właściwości działania tych zmian i porównuje je udostępnianych przez poprzednią wersję.</span><span class="sxs-lookup"><span data-stu-id="af963-106">This topic shows the important performance characteristics of these revisions and compares them against those of the previous version.</span></span>

 <span data-ttu-id="af963-107">O rzędów między WF3 i WF4 zwiększyła się wydajność składników określonego przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-107">Individual workflow component performance has increased by orders of magnitude between WF3 and WF4.</span></span>  <span data-ttu-id="af963-108">Spowoduje to pozostawienie przerwa między kodowane ręcznie usług Windows Communication Foundation (WCF) i usług przepływu pracy WCF być całkiem mały.</span><span class="sxs-lookup"><span data-stu-id="af963-108">This leaves the gap between hand-coded Windows Communication Foundation (WCF) services and WCF workflow services to be quite small.</span></span>  <span data-ttu-id="af963-109">Opóźnienie przepływu pracy został znacznie zmniejszony WF4.</span><span class="sxs-lookup"><span data-stu-id="af963-109">Workflow latency has been significantly reduced in WF4.</span></span>  <span data-ttu-id="af963-110">Trwałość wydajności został zwiększony współczynnik 3.0 2.5.</span><span class="sxs-lookup"><span data-stu-id="af963-110">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="af963-111">Monitorowanie kondycji za pomocą śledzenia przepływu pracy ma znacznie mniejsze obciążenie.</span><span class="sxs-lookup"><span data-stu-id="af963-111">Health monitoring by means of workflow tracking has significantly less overhead.</span></span>  <span data-ttu-id="af963-112">Te są istotne powody do migracji do lub przyjmowania WF4 w swoich aplikacjach.</span><span class="sxs-lookup"><span data-stu-id="af963-112">These are compelling reasons to migrate to or adopt WF4 in your applications.</span></span>

## <a name="terminology"></a><span data-ttu-id="af963-113">Terminologia</span><span class="sxs-lookup"><span data-stu-id="af963-113">Terminology</span></span>
 <span data-ttu-id="af963-114">Wersja [!INCLUDE[wf1](../../../includes/wf1-md.md)] wprowadzona w [!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)] zostanie określone jako WF4 dla pozostałej części tego tematu.</span><span class="sxs-lookup"><span data-stu-id="af963-114">The version of [!INCLUDE[wf1](../../../includes/wf1-md.md)] introduced in [!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)] will be referred to as WF4 for the rest of this topic.</span></span>  [!INCLUDE[wf1](../../../includes/wf1-md.md)] <span data-ttu-id="af963-115">wprowadzono w programie .NET 3.0 i ma kilka drobnych poprawek przy użyciu [!INCLUDE[netfx35_short](../../../includes/netfx35-short-md.md)] z dodatkiem SP1.</span><span class="sxs-lookup"><span data-stu-id="af963-115">was introduced in .NET 3.0 and had a few minor revisions through [!INCLUDE[netfx35_short](../../../includes/netfx35-short-md.md)] SP1.</span></span> <span data-ttu-id="af963-116">[!INCLUDE[netfx35_short](../../../includes/netfx35-short-md.md)] Wersji programu Workflow Foundation będzie wcześniej określano WF3 dla pozostałej części tego tematu.</span><span class="sxs-lookup"><span data-stu-id="af963-116">The [!INCLUDE[netfx35_short](../../../includes/netfx35-short-md.md)] version of Workflow Foundation will be referred to as WF3 for the rest of this topic.</span></span> <span data-ttu-id="af963-117">WF3 jest dostarczany w [!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)] side-by-side przy użyciu WF4.</span><span class="sxs-lookup"><span data-stu-id="af963-117">WF3 is shipped in [!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)] side-by-side with WF4.</span></span> <span data-ttu-id="af963-118">Aby uzyskać więcej informacji na temat migrowania artefaktami WF3 WF4 zobacz: [Przewodnik migracji systemu Windows Workflow Foundation 4](https://go.microsoft.com/fwlink/?LinkID=153313)</span><span class="sxs-lookup"><span data-stu-id="af963-118">For more information about migrating WF3 artifacts to WF4 see: [Windows Workflow Foundation 4 Migration Guide](https://go.microsoft.com/fwlink/?LinkID=153313)</span></span>

 <span data-ttu-id="af963-119">Windows Communication Foundation (WCF) jest jednolity model programowania firmy Microsoft do budowania aplikacji usługowych.</span><span class="sxs-lookup"><span data-stu-id="af963-119">Windows Communication Foundation (WCF) is Microsoft’s unified programming model for building service-oriented applications.</span></span> <span data-ttu-id="af963-120">On został po raz pierwszy wprowadzone jako część .NET 3.0 wraz z WF3 i teraz jest jednym z kluczowych składników programu .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="af963-120">It was first introduced as part of .NET 3.0 together with WF3 and now is one of the key components of the .NET Framework.</span></span>

 <span data-ttu-id="af963-121">Windows Server AppFabric to zestaw zintegrowanych technologii, które ułatwiają tworzenie, skalowanie i zarządzanie nimi w sieci Web i aplikacji złożonych, działających w usługach IIS.</span><span class="sxs-lookup"><span data-stu-id="af963-121">Windows Server AppFabric is a set of integrated technologies that make it easier to build, scale and manage Web and composite applications that run on IIS.</span></span> <span data-ttu-id="af963-122">Udostępnia narzędzia do monitorowania i zarządzania usługami i przepływami pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-122">It provides tools for monitoring and managing services and workflows.</span></span> <span data-ttu-id="af963-123">Aby uzyskać więcej informacji, zobacz [programu Windows Server AppFabric w wersji 1.0](https://docs.microsoft.com/previous-versions/appfabric/ff384253(v=azure.10)).</span><span class="sxs-lookup"><span data-stu-id="af963-123">For more information, see [Windows Server AppFabric 1.0](https://docs.microsoft.com/previous-versions/appfabric/ff384253(v=azure.10)).</span></span>

## <a name="goals"></a><span data-ttu-id="af963-124">Cele</span><span class="sxs-lookup"><span data-stu-id="af963-124">Goals</span></span>
 <span data-ttu-id="af963-125">Celem tego tematu jest pokazanie charakterystyki wydajności WF4 z danymi, mierzone w różnych scenariuszach.</span><span class="sxs-lookup"><span data-stu-id="af963-125">The goal of this topic is to show the performance characteristics of WF4 with data measured for different scenarios.</span></span> <span data-ttu-id="af963-126">Udostępnia również szczegółowe porównanie WF4 WF3 i zawiera doskonałe ulepszeń, które zostały wprowadzone w tej nowej wersji.</span><span class="sxs-lookup"><span data-stu-id="af963-126">It also provides detailed comparisons between WF4 and WF3, and thus shows the great improvements that have been made in this new revision.</span></span> <span data-ttu-id="af963-127">Scenariusze i dane przedstawione w tym artykule określenie podstawowych kosztów różnych aspektów WF4 WF3.</span><span class="sxs-lookup"><span data-stu-id="af963-127">The scenarios and data presented in this article quantify the underlying cost of different aspects of WF4 and WF3.</span></span> <span data-ttu-id="af963-128">Te dane są przydatne do zrozumienia charakterystyki wydajności WF4 i może być pomocny w planowaniu migracji z WF3 do WF4 lub używając WF4 podczas tworzenia aplikacji.</span><span class="sxs-lookup"><span data-stu-id="af963-128">This data is useful in understanding the performance characteristics of WF4 and can be helpful in planning migrations from WF3 to WF4 or using WF4 in application development.</span></span> <span data-ttu-id="af963-129">Jednak należy zachować ostrożność w wyciągnięte wnioski dane znajdujące się w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="af963-129">However, care should be taken in the conclusions drawn from the data presented in this article.</span></span> <span data-ttu-id="af963-130">Wydajność aplikacji złożonych przepływów pracy jest wysoce zależy od implementacji przepływu pracy i jak różne składniki są zintegrowane.</span><span class="sxs-lookup"><span data-stu-id="af963-130">The performance of a composite workflow application is highly dependent on how the workflow is implemented and how different components are integrated.</span></span> <span data-ttu-id="af963-131">Jeden muszą mierzyć każdej aplikacji, aby określić właściwości działania tej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="af963-131">One must measure each application to determine the performance characteristics of that application.</span></span>

## <a name="overview-of-wf4-performance-enhancements"></a><span data-ttu-id="af963-132">Przegląd ulepszeń wydajności WF4</span><span class="sxs-lookup"><span data-stu-id="af963-132">Overview of WF4 Performance Enhancements</span></span>
 <span data-ttu-id="af963-133">WF4 dokładnie został opracowany i jest implementowane za pomocą o wysokiej wydajności i skalowalności, które są opisane w poniższych sekcjach.</span><span class="sxs-lookup"><span data-stu-id="af963-133">WF4 was carefully designed and implemented with high performance and scalability which are described in the following sections.</span></span>

### <a name="wf-runtime"></a><span data-ttu-id="af963-134">Środowisko uruchomieniowe programu WF</span><span class="sxs-lookup"><span data-stu-id="af963-134">WF Runtime</span></span>
 <span data-ttu-id="af963-135">W samym sercu [!INCLUDE[wf1](../../../includes/wf1-md.md)] środowisko uruchomieniowe jest asynchroniczne harmonogramu, która napędza wykonywania działań w przepływie pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-135">At the core of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime is an asynchronous scheduler that drives the execution of the activities in a workflow.</span></span> <span data-ttu-id="af963-136">Zapewnia wydajne, środowiska wykonawczego przewidywalne działań.</span><span class="sxs-lookup"><span data-stu-id="af963-136">It provides a performant, predictable execution environment for activities.</span></span> <span data-ttu-id="af963-137">Środowisko ma dobrze zdefiniowanego kontraktu w celu wykonywania, kontynuacja, zakończenia, anulowania, wyjątki i przewidywalne modelu wątkowości.</span><span class="sxs-lookup"><span data-stu-id="af963-137">The environment has a well-defined contract for execution, continuation, completion, cancellation, exceptions, and a predictable threading model.</span></span>

 <span data-ttu-id="af963-138">Porównaniu WF3 środowisko uruchomieniowe WF4 ma bardziej wydajne harmonogramu.</span><span class="sxs-lookup"><span data-stu-id="af963-138">In comparison to WF3, the WF4 runtime has a more efficient scheduler.</span></span> <span data-ttu-id="af963-139">Korzysta z tej samej puli wątków We/Wy, używany do usługi WCF, który jest bardzo wydajny w wykonywania elementów roboczych wsadowej.</span><span class="sxs-lookup"><span data-stu-id="af963-139">It leverages the same I/O thread pool that is used for WCF, which is very efficient at executing batched work items.</span></span> <span data-ttu-id="af963-140">Wewnętrzny element harmonogramu kolejki jest zoptymalizowany pod kątem najbardziej typowe wzorce użycia.</span><span class="sxs-lookup"><span data-stu-id="af963-140">The internal work item scheduler queue is optimized for most common usage patterns.</span></span> <span data-ttu-id="af963-141">Środowisko uruchomieniowe WF4 zarządza także Stany wykonanie przebiega bardzo z minimalnym synchronizacją i obsługi logiki, podczas gdy WF3 zależy od rejestracji ciężki zdarzenia i wywołania w celu przeprowadzenia synchronizacji złożonych stanami zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="af963-141">The WF4 runtime also manages the execution states in a very lightweight way with minimal synchronization and event handling logic, while WF3 depends on heavy-weight event registration and invocation to perform complex synchronization for state transitions.</span></span>

### <a name="data-storage-and-flow"></a><span data-ttu-id="af963-142">Magazyn danych i przepływu</span><span class="sxs-lookup"><span data-stu-id="af963-142">Data Storage and Flow</span></span>
 <span data-ttu-id="af963-143">W WF3, dane związane z działaniem jest modelowane przy użyciu właściwości zależności implementowany przez typ. <xref:System.Windows.DependencyProperty>.</span><span class="sxs-lookup"><span data-stu-id="af963-143">In WF3, data associated with an activity is modeled through dependency properties implemented by the type <xref:System.Windows.DependencyProperty>.</span></span> <span data-ttu-id="af963-144">Wzorzec właściwość zależności został wprowadzony w Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="af963-144">The dependency property pattern was introduced in Windows Presentation Foundation (WPF).</span></span> <span data-ttu-id="af963-145">Ogólnie rzecz biorąc ten wzorzec jest bardzo elastyczny obsługuje powiązanie danych łatwy i inne funkcje interfejsu użytkownika.</span><span class="sxs-lookup"><span data-stu-id="af963-145">In general, this pattern is very flexible to support easy data binding and other UI features.</span></span> <span data-ttu-id="af963-146">Wzorzec wymaga jednak właściwości można zdefiniować jako statyczne pola w definicji przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-146">However, the pattern requires the properties to be defined as static fields in the workflow definition.</span></span> <span data-ttu-id="af963-147">Zawsze, gdy [!INCLUDE[wf1](../../../includes/wf1-md.md)] środowiska uruchomieniowego, ustawia lub pobiera wartości właściwości, spowodowałoby to logiki intensywnie ważona wyszukiwania.</span><span class="sxs-lookup"><span data-stu-id="af963-147">Whenever the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime sets or gets the property values, it involves heavily-weighted look-up logic.</span></span>

 <span data-ttu-id="af963-148">WF4 używa Wyczyść dane zakresu logiki znacznie zwiększyć sposobu obsługi danych w przepływie pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-148">WF4 uses clear data scoping logic to greatly improve how data is handled in a workflow.</span></span> <span data-ttu-id="af963-149">Rozdziela danych przechowywanych w działaniu z danych, które będą przepływać przez granice działania przy użyciu dwóch różnych pojęć: zmienne i argumenty.</span><span class="sxs-lookup"><span data-stu-id="af963-149">It separates the data stored in an activity from the data that is flowing across the activity boundaries by using two different concepts: variables and arguments.</span></span> <span data-ttu-id="af963-150">Za pomocą czyszczenia hierarchiczne zakres zmienne i argumenty "W/wyjście/wejście-wyjście", złożoność danych użycia dla działania jest znacznie mniejsze i okres istnienia danych również automatycznie o określonym zakresie.</span><span class="sxs-lookup"><span data-stu-id="af963-150">By using a clear hierarchical scope for variables and "In/Out/InOut" arguments, the data usage complexity for activities is dramatically reduced and the lifetime of the data is also automatically scoped.</span></span> <span data-ttu-id="af963-151">Działania mają podpis dobrze zdefiniowanych opisanego przez argumenty.</span><span class="sxs-lookup"><span data-stu-id="af963-151">Activities have a well-defined signature described by its arguments.</span></span> <span data-ttu-id="af963-152">Sprawdzając, czy po prostu działania można określić, jakie dane oczekuje, aby otrzymać i jakie dane zostaną wygenerowane przez nią w wyniku wykonywania.</span><span class="sxs-lookup"><span data-stu-id="af963-152">By simply inspecting an activity you can determine what data it expects to receive and what data will be produced by it as the result of its execution.</span></span>

 <span data-ttu-id="af963-153">W WF3 działania zostały zainicjowane, podczas tworzenia przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-153">In WF3 activities were initialized when a workflow was created.</span></span> <span data-ttu-id="af963-154">W programie WF 4 działań są inicjowane tylko wtedy, gdy są wykonywane odpowiednie działania.</span><span class="sxs-lookup"><span data-stu-id="af963-154">In WF 4 activities are initialized only when the corresponding activities are executing.</span></span> <span data-ttu-id="af963-155">Dzięki temu bez przeprowadzania operacji inicjowania/Uninitialize nowe wystąpienie przepływu pracy jest tworzony, gdy ten sposób zdobyła większe przyspiesza cykl życia aktywności</span><span class="sxs-lookup"><span data-stu-id="af963-155">This allows a simpler activity lifecycle without performing Initialize/Uninitialize operations when a new workflow instance is created, and thus has achieved more efficiency</span></span>

### <a name="control-flow"></a><span data-ttu-id="af963-156">Przepływ sterowania</span><span class="sxs-lookup"><span data-stu-id="af963-156">Control Flow</span></span>
 <span data-ttu-id="af963-157">Podobnie jak w przypadku dowolnego języka programowania [!INCLUDE[wf1](../../../includes/wf1-md.md)] zapewnia obsługę przez wprowadzenie do zestawu działań przepływu sterowania do sekwencjonowania, pętli, rozgałęziania i inne wzorce przepływów sterowania dla definicji przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-157">Just as in any programming language, [!INCLUDE[wf1](../../../includes/wf1-md.md)] provides support for control flows for workflow definitions by introducing a set of control flow activities for sequencing, looping, branching and other patterns.</span></span> <span data-ttu-id="af963-158">W WF3, gdy tego samego działania musi ponownie uruchomić nowej <xref:System.Workflow.ComponentModel.ActivityExecutionContext> jest tworzony i działanie został sklonowany za pośrednictwem ciężki serializacji i deserializacji logiki na podstawie <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>.</span><span class="sxs-lookup"><span data-stu-id="af963-158">In WF3, when the same activity needs to be re-executed, a new <xref:System.Workflow.ComponentModel.ActivityExecutionContext> is created and the activity is cloned through a heavy-weight serialization and deserialization logic based on <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>.</span></span> <span data-ttu-id="af963-159">Zwykle wydajność przepływów sterowania iteracyjne jest znacznie wolniejsze niż wykonywanie sekwencję działań.</span><span class="sxs-lookup"><span data-stu-id="af963-159">Usually the performance for iterative control flows is much slower than executing a sequence of activities.</span></span>

 <span data-ttu-id="af963-160">WF4 obsługuje to dość w inny sposób.</span><span class="sxs-lookup"><span data-stu-id="af963-160">WF4 handles this quite differently.</span></span> <span data-ttu-id="af963-161">Jego przyjmuje szablon działania, tworzy nowy obiekt ActivityInstance i dodaje go do kolejki harmonogramu.</span><span class="sxs-lookup"><span data-stu-id="af963-161">It takes the activity template, creates a new ActivityInstance object, and adds it to the scheduler queue.</span></span> <span data-ttu-id="af963-162">Całego tego procesu obejmuje tworzenie jawnych obiektów i tylko jest bardzo uproszczone.</span><span class="sxs-lookup"><span data-stu-id="af963-162">This whole process only involves explicit object creation and is very lightweight.</span></span>

### <a name="asynchronous-programming"></a><span data-ttu-id="af963-163">Programowanie asynchroniczne</span><span class="sxs-lookup"><span data-stu-id="af963-163">Asynchronous Programming</span></span>
 <span data-ttu-id="af963-164">Aplikacje zazwyczaj mają lepszą wydajność i skalowalność za pomocą programowania asynchronicznego rozproszonych operacje obliczeniowe lub długotrwałe blokowania operacjami We/Wy.</span><span class="sxs-lookup"><span data-stu-id="af963-164">Applications usually have better performance and scalability with asynchronous programming for long running blocking operations such as I/O or distributed computing operations.</span></span> <span data-ttu-id="af963-165">WF4 zapewnia obsługę asynchroniczną za pośrednictwem typów podstawowego elementu activity <xref:System.Activities.AsyncCodeActivity>, <xref:System.Activities.AsyncCodeActivity%601>.</span><span class="sxs-lookup"><span data-stu-id="af963-165">WF4 provides asynchronous support through base activity types <xref:System.Activities.AsyncCodeActivity>, <xref:System.Activities.AsyncCodeActivity%601>.</span></span> <span data-ttu-id="af963-166">Środowisko uruchomieniowe natywną obsługę działań asynchronicznych i w związku z tym można automatycznie umieść wystąpienia w strefie no-persist pracę asynchroniczną jest zaległe.</span><span class="sxs-lookup"><span data-stu-id="af963-166">The runtime natively understands asynchronous activities and therefore can automatically put the instance in a no-persist zone while the asynchronous work is outstanding.</span></span> <span data-ttu-id="af963-167">Niestandardowe działania może pochodzić z tych typów do wykonywania zadań asynchronicznych bez przytrzymując wątku harmonogramu przepływów pracy i zablokowanie wszelkich działań, które można uruchomić równolegle.</span><span class="sxs-lookup"><span data-stu-id="af963-167">Custom activities can derive from these types to perform asynchronous work without holding the workflow scheduler thread and blocking any activities that may be able to run in parallel.</span></span>

### <a name="messaging"></a><span data-ttu-id="af963-168">Obsługa komunikatów</span><span class="sxs-lookup"><span data-stu-id="af963-168">Messaging</span></span>
 <span data-ttu-id="af963-169">Początkowo zawierała WF3 bardzo ograniczona obsługa komunikatów za pośrednictwem sieci web lub zdarzenia zewnętrzne usługi wywołania.</span><span class="sxs-lookup"><span data-stu-id="af963-169">Initially WF3 had very limited messaging support through external events or web services invocations.</span></span> <span data-ttu-id="af963-170">W .NET 3.5 przepływy pracy mogą zostać zaimplementowane jako klienci WCF lub widoczne jako usług WCF za pomocą <xref:System.Workflow.Activities.SendActivity> i <xref:System.Workflow.Activities.ReceiveActivity>.</span><span class="sxs-lookup"><span data-stu-id="af963-170">In .NET 3.5, workflows could be implemented as WCF clients or exposed as WCF services through <xref:System.Workflow.Activities.SendActivity> and <xref:System.Workflow.Activities.ReceiveActivity>.</span></span> <span data-ttu-id="af963-171">W WF4 koncepcji programowania obsługi komunikatów opartego o przepływ pracy ma zostały wzmocnione dzięki ścisłej integracji WCF komunikatów logikę do programu WF.</span><span class="sxs-lookup"><span data-stu-id="af963-171">In WF4, the concept of workflow-based messaging programming has been further strengthened through the tight integration of WCF messaging logic into WF.</span></span>

 <span data-ttu-id="af963-172">Potok przetwarzania komunikatów ujednoliconego dostarczane w programie WCF w programie .NET 4 pomaga WF4 usług znacznie lepszą wydajność i skalowalność niż WF3.</span><span class="sxs-lookup"><span data-stu-id="af963-172">The unified message processing pipeline provided in WCF in .NET 4 helps WF4 services to have significantly better performance and scalability than WF3.</span></span> <span data-ttu-id="af963-173">WF4 udostępnia bogatszy komunikatów obsługę programowania, która umożliwia modelowanie złożonych wzorców wymiany komunikatów (MEPs).</span><span class="sxs-lookup"><span data-stu-id="af963-173">WF4 also provides richer messaging programming support that can model complex Message Exchange Patterns (MEPs).</span></span> <span data-ttu-id="af963-174">Deweloperzy mogą używać obu kontraktów usług wpisane do osiągnięcia łatwego programowania lub kontraktów usług bez osiągnąć większą wydajność bez ponoszenia kosztów serializacji.</span><span class="sxs-lookup"><span data-stu-id="af963-174">Developers can use either typed service contracts to achieve easy programming or un-typed service contracts to achieve better performance without paying serialization costs.</span></span> <span data-ttu-id="af963-175">Po stronie klienta pamięci podręcznej techniczną za pośrednictwem witryny channel <xref:System.ServiceModel.Activities.SendMessageChannelCache> klasy w WF4 pomaga deweloperom wbudowywać szybkie aplikacje przy minimalnym nakładzie pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-175">The client-side channel caching support through the <xref:System.ServiceModel.Activities.SendMessageChannelCache> class in WF4 helps developers build fast applications with minimal effort.</span></span> <span data-ttu-id="af963-176">Aby uzyskać więcej informacji, zobacz [Zmienianie poziomów współużytkowania pamięci podręcznej dla działań wysyłania](../wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span><span class="sxs-lookup"><span data-stu-id="af963-176">For more information, see [Changing the Cache Sharing Levels for Send Activities](../wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span></span>

### <a name="declarative-programming"></a><span data-ttu-id="af963-177">Programowanie deklaratywne</span><span class="sxs-lookup"><span data-stu-id="af963-177">Declarative Programming</span></span>
 <span data-ttu-id="af963-178">WF4 zapewnia prosty i przejrzysty deklaratywne programowania struktura model procesów biznesowych i usług.</span><span class="sxs-lookup"><span data-stu-id="af963-178">WF4 provides a clean and simple declarative programming framework to model business processes and services.</span></span> <span data-ttu-id="af963-179">Model programowania obsługuje w pełni deklaracyjnego kompozycja działań z nie kodu — obok, co znacznie upraszcza tworzenie przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-179">The programming model supports fully declarative composition of activities, with no code-beside, greatly simplifying workflow authoring.</span></span> <span data-ttu-id="af963-180">W [!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)], oparte na XAML deklaratywne struktury programistycznej używanej ma zostały zunifikowane w jednym zestawie System.Xaml.dll do obsługiwania obydwu WPF i WF.</span><span class="sxs-lookup"><span data-stu-id="af963-180">In [!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)], the XAML-based declarative programming framework has been unified into the single assembly System.Xaml.dll to support both WPF and WF.</span></span>

 <span data-ttu-id="af963-181">W WF4 XAML zapewnia obsługę rzeczywiście deklaracyjne i umożliwia całą definicję przepływu pracy zdefiniowanych w znaczników XML odwołuje się do działalności i typy utworzone przy użyciu platformy .NET.</span><span class="sxs-lookup"><span data-stu-id="af963-181">In WF4, XAML provides a truly declarative experience and allows for the entire definition of the workflow to be defined in XML markup, referencing activities and types built using .NET.</span></span> <span data-ttu-id="af963-182">Taka konfiguracja była trudna zrobić w WF3 przy użyciu formatu XOML, nie angażując logiki niestandardowej związanym z kodem.</span><span class="sxs-lookup"><span data-stu-id="af963-182">This was difficult to do in WF3 with XOML format without involving custom code-behind logic.</span></span> <span data-ttu-id="af963-183">Nowy stos XAML w .NET 4 ma znacznie lepszą wydajność podczas serializacji/deserializacji artefaktów przepływu pracy i sprawia, że programowanie deklaratywne bardziej atrakcyjne wizualnie i stałe.</span><span class="sxs-lookup"><span data-stu-id="af963-183">The new XAML-stack in .NET 4 has much better performance in serializing/deserializing workflow artifacts and makes declarative programming more attractive and solid.</span></span>

### <a name="workflow-designer"></a><span data-ttu-id="af963-184">Projektant przepływów pracy</span><span class="sxs-lookup"><span data-stu-id="af963-184">Workflow Designer</span></span>
 <span data-ttu-id="af963-185">Pełni deklaracyjnego programowania obsługę WF4 nakłada jawnie wyższe wymagania dotyczące wydajności w czasie projektowania w przypadku dużych przepływów pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-185">Fully declarative programming support for WF4 explicitly imposes higher requirements for design time performance for large workflows.</span></span> <span data-ttu-id="af963-186">Projektant przepływu pracy w WF4 zapewnia znacznie lepszą skalowalność dla przepływów pracy dużych niż WF3.</span><span class="sxs-lookup"><span data-stu-id="af963-186">The Workflow designer in WF4 has much better scalability for large workflows than that for WF3.</span></span> <span data-ttu-id="af963-187">Obsługa wirtualizacji w interfejsie użytkownika Projektant można łatwo obciążenia dużych przepływu pracy 1000 działań w ciągu kilku sekund, podczas ładowania kilku kilkuset działań przepływu pracy za pomocą projektanta WF3 jest prawie niemożliwe.</span><span class="sxs-lookup"><span data-stu-id="af963-187">With UI virtualization support, the designer can easily load a large workflow of 1000 activities in a few seconds, while it is almost impossible to load a workflow of a few hundred activities with the WF3 designer.</span></span>

## <a name="component-level-performance-comparisons"></a><span data-ttu-id="af963-188">Porównywanie wydajności na poziomie składnika</span><span class="sxs-lookup"><span data-stu-id="af963-188">Component-level Performance Comparisons</span></span>
 <span data-ttu-id="af963-189">Ta sekcja zawiera dane na bezpośrednie porównania między poszczególne działania w przepływach pracy WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="af963-189">This section contains data on direct comparisons between individual activities in WF3 and WF4 workflows.</span></span>  <span data-ttu-id="af963-190">Kluczowych obszarach, takich jak trwałości mieć dokładniejszych wpływ na wydajność niż składniki poszczególnych działań.</span><span class="sxs-lookup"><span data-stu-id="af963-190">Key areas like persistence have a more profound impact on performance than the individual activity components.</span></span>  <span data-ttu-id="af963-191">Ulepszenia wydajności w poszczególnych składnikach w WF4 są jednak ważne składniki są wystarczająco szybko, który będzie porównywany logiki aranżacji kodowane ręcznie.</span><span class="sxs-lookup"><span data-stu-id="af963-191">The performance improvements in individual components in WF4 are important though because the components are now fast enough to be compared against hand-coded orchestration logic.</span></span>  <span data-ttu-id="af963-192">Przykładem jest omówione w następnej sekcji: "Usługa kompozycji scenariusz".</span><span class="sxs-lookup"><span data-stu-id="af963-192">An example of which is covered in the next section: "Service Composition Scenario."</span></span>

### <a name="environment-setup"></a><span data-ttu-id="af963-193">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="af963-193">Environment Setup</span></span>
 ![Konfigurowanie środowiska do pomiaru wydajności przepływu pracy](./media/performance/performance-test-environment.gif)

 <span data-ttu-id="af963-195">Powyższej ilustracji konfiguracji komputera, używany do pomiaru wydajności na poziomie składnika.</span><span class="sxs-lookup"><span data-stu-id="af963-195">The above figure shows the machine configuration used for component-level performance measurement.</span></span> <span data-ttu-id="af963-196">Pojedynczy serwer i klienci pięć połączone jednego interfejsu sieciowego Ethernet 1 GB/s.</span><span class="sxs-lookup"><span data-stu-id="af963-196">A single server and five clients connected over one 1-Gbps Ethernet network interface.</span></span> <span data-ttu-id="af963-197">Łatwe pomiarów serwer jest skonfigurowany do użycia pojedynczego rdzenia proc/quad dwurdzeniowy serwera działającego pod kontrolą systemu Windows Server 2008 x86.</span><span class="sxs-lookup"><span data-stu-id="af963-197">For easy measurements, the server is configured to use a single core of a dual-proc/quad-core server  running Windows Server 2008 x86.</span></span> <span data-ttu-id="af963-198">System wykorzystanie procesora CPU jest zachowywana w prawie 100%.</span><span class="sxs-lookup"><span data-stu-id="af963-198">The system CPU utilization is maintained at nearly 100%.</span></span>

### <a name="test-details"></a><span data-ttu-id="af963-199">Szczegóły testu</span><span class="sxs-lookup"><span data-stu-id="af963-199">Test Details</span></span>
 <span data-ttu-id="af963-200">WF3 <xref:System.Workflow.Activities.CodeActivity> jest prawdopodobnie najprostszą działanie, które mogą być używane w przepływie pracy WF3.</span><span class="sxs-lookup"><span data-stu-id="af963-200">The WF3 <xref:System.Workflow.Activities.CodeActivity> is likely the simplest activity that can be used in a WF3 workflow.</span></span>  <span data-ttu-id="af963-201">Działanie wywołuje metodę w związanym z kodem, programisty przepływu pracy można umieścić kod niestandardowy do.</span><span class="sxs-lookup"><span data-stu-id="af963-201">The activity calls a method in the code-behind that the workflow programmer can put custom code into.</span></span>  <span data-ttu-id="af963-202">W WF4, nie istnieje żadne bezpośrednie analogowy na WF3 <xref:System.Workflow.Activities.CodeActivity> zapewniający taką samą funkcjonalność.</span><span class="sxs-lookup"><span data-stu-id="af963-202">In WF4, there is no direct analog to the WF3 <xref:System.Workflow.Activities.CodeActivity> that provides the same functionality.</span></span>  <span data-ttu-id="af963-203">Należy zauważyć, że istnieje <xref:System.Activities.CodeActivity> podstawowej klasy w WF4, który nie jest powiązana z WF3 <xref:System.Workflow.Activities.CodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="af963-203">Note that there is a <xref:System.Activities.CodeActivity> base class in WF4 that is not related to the WF3 <xref:System.Workflow.Activities.CodeActivity>.</span></span>  <span data-ttu-id="af963-204">Autorzy przepływu pracy są zachęcani do tworzenia niestandardowych działań i tworzenie przepływów pracy XAML — tylko.</span><span class="sxs-lookup"><span data-stu-id="af963-204">Workflow authors are encouraged to create custom activities and build XAML-only workflows.</span></span>  <span data-ttu-id="af963-205">W przypadku testów o nazwie działanie `Comment` jest używany zamiast pustego <xref:System.Workflow.Activities.CodeActivity> w przepływach pracy WF4.</span><span class="sxs-lookup"><span data-stu-id="af963-205">In the tests below, an activity called `Comment` is used in place of an empty <xref:System.Workflow.Activities.CodeActivity> in WF4 workflows.</span></span>  <span data-ttu-id="af963-206">Kod w `Comment` działanie jest w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="af963-206">The code in the `Comment` activity is as follows:</span></span>

```csharp
[ContentProperty("Body")]
    public sealed class Comment : CodeActivity
    {
        public Comment()
            : base()
        {
        }

        [DefaultValue(null)]
        public Activity Body
        {
            get;
            set;
        }

        protected override void Execute(CodeActivityContext context)
        {
        }
    }
```

### <a name="empty-workflow"></a><span data-ttu-id="af963-207">Pusty przepływ pracy</span><span class="sxs-lookup"><span data-stu-id="af963-207">Empty Workflow</span></span>
 <span data-ttu-id="af963-208">Ten test za nie działania podrzędne sekwencyjny przepływ pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-208">This test uses a sequence workflow with no child activities.</span></span>

### <a name="single-activity"></a><span data-ttu-id="af963-209">Pojedyncze działanie</span><span class="sxs-lookup"><span data-stu-id="af963-209">Single Activity</span></span>
 <span data-ttu-id="af963-210">Przepływ pracy jest przepływ pracy sekwencji zawierające jedną działania podrzędnego.</span><span class="sxs-lookup"><span data-stu-id="af963-210">The workflow is a sequence workflow containing one child activity.</span></span>  <span data-ttu-id="af963-211">Działanie jest <xref:System.Workflow.Activities.CodeActivity> bez kodu, w tym przypadku WF3 i `Comment` działanie w przypadku WF4.</span><span class="sxs-lookup"><span data-stu-id="af963-211">The activity is a <xref:System.Workflow.Activities.CodeActivity> with no code in the WF3 case and a `Comment` activity in the WF4 case.</span></span>

### <a name="while-with-1000-iterations"></a><span data-ttu-id="af963-212">Czas z 1000 iteracji</span><span class="sxs-lookup"><span data-stu-id="af963-212">While with 1000 Iterations</span></span>
 <span data-ttu-id="af963-213">Sekwencyjny przepływ pracy zawiera jeden <xref:System.Activities.Statements.While> działania o jeden element podrzędny działania w pętli, która nie wykonuje żadnych działań.</span><span class="sxs-lookup"><span data-stu-id="af963-213">The sequence workflow contains one <xref:System.Activities.Statements.While> activity with one child activity in the loop that does not perform any work.</span></span>

### <a name="replicator-compared-to-parallelforeach"></a><span data-ttu-id="af963-214">Replikator w porównaniu do ParallelForEach</span><span class="sxs-lookup"><span data-stu-id="af963-214">Replicator compared to ParallelForEach</span></span>
 <span data-ttu-id="af963-215"><xref:System.Workflow.Activities.ReplicatorActivity> w WF3 ma tryby wykonywania sekwencyjnego i równoległego.</span><span class="sxs-lookup"><span data-stu-id="af963-215"><xref:System.Workflow.Activities.ReplicatorActivity> in WF3 has sequential and parallel execution modes.</span></span>  <span data-ttu-id="af963-216">W trybie sekwencyjne wydajności działania przypomina <xref:System.Workflow.Activities.WhileActivity>.</span><span class="sxs-lookup"><span data-stu-id="af963-216">In sequential mode, the activity’s performance is similar to the <xref:System.Workflow.Activities.WhileActivity>.</span></span>  <span data-ttu-id="af963-217"><xref:System.Workflow.Activities.ReplicatorActivity> Jest najbardziej przydatne do przetwarzania równoległego.</span><span class="sxs-lookup"><span data-stu-id="af963-217">The <xref:System.Workflow.Activities.ReplicatorActivity> is most useful for parallel execution.</span></span>  <span data-ttu-id="af963-218">Jest analogowy WF4 tego <xref:System.Activities.Statements.ParallelForEach%601> działania.</span><span class="sxs-lookup"><span data-stu-id="af963-218">The WF4 analog for this is the <xref:System.Activities.Statements.ParallelForEach%601> activity.</span></span>

 <span data-ttu-id="af963-219">Na poniższym diagramie przedstawiono przepływów pracy, używane dla tego testu.</span><span class="sxs-lookup"><span data-stu-id="af963-219">The following diagram shows the workflows used for this test.</span></span> <span data-ttu-id="af963-220">Przepływ pracy WF3 znajduje się po lewej stronie i WF4 przepływ pracy znajduje się po prawej stronie.</span><span class="sxs-lookup"><span data-stu-id="af963-220">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>

 ![WF3 ReplicatorActivity i WF4 ParallelForEach](./media/performance/replicator-parallel-wf3-wf4.gif)

### <a name="sequential-workflow-with-five-activities"></a><span data-ttu-id="af963-222">Sekwencyjny przepływ pracy z pięciu działań</span><span class="sxs-lookup"><span data-stu-id="af963-222">Sequential Workflow with Five Activities</span></span>
 <span data-ttu-id="af963-223">Ten test jest przeznaczona do wyświetlenia efekt posiadanie kilku działań wykonywanie było sekwencyjne.</span><span class="sxs-lookup"><span data-stu-id="af963-223">This test is meant to show the effect of having several activities execute in sequence.</span></span>  <span data-ttu-id="af963-224">Ma pięciu działań w sekwencji.</span><span class="sxs-lookup"><span data-stu-id="af963-224">There are five activities in the sequence.</span></span>

### <a name="transaction-scope"></a><span data-ttu-id="af963-225">Zakres transakcji</span><span class="sxs-lookup"><span data-stu-id="af963-225">Transaction Scope</span></span>
 <span data-ttu-id="af963-226">Test zakresu transakcji różni się od innych testów, nowe wystąpienie przepływu pracy nie został utworzony dla każdej iteracji.</span><span class="sxs-lookup"><span data-stu-id="af963-226">The transaction scope test differs from the other tests slightly in that a new workflow instance is not created for every iteration.</span></span>  <span data-ttu-id="af963-227">Zamiast tego przepływu pracy są skonstruowane z chwilę zawierający pętli <xref:System.Activities.Statements.TransactionScope> działania zawierające jedno działanie, które nie działa.</span><span class="sxs-lookup"><span data-stu-id="af963-227">Instead, the workflow is structured with a while loop containing a <xref:System.Activities.Statements.TransactionScope> activity containing a single activity that does no work.</span></span>  <span data-ttu-id="af963-228">Każde uruchomienie partii 50 iteracji za pośrednictwem while pętli są traktowane jako pojedyncza operacja.</span><span class="sxs-lookup"><span data-stu-id="af963-228">Each run of a batch of 50 iterations through the while loop is counted as a single operation.</span></span>

### <a name="compensation"></a><span data-ttu-id="af963-229">Kompensacja</span><span class="sxs-lookup"><span data-stu-id="af963-229">Compensation</span></span>
 <span data-ttu-id="af963-230">Przepływ pracy WF3 ma jedno działanie możliwy do kompensacji o nazwie `WorkScope`.</span><span class="sxs-lookup"><span data-stu-id="af963-230">The WF3 workflow has a single compensatable activity named `WorkScope`.</span></span>  <span data-ttu-id="af963-231">Działania po prostu implementuje <xref:System.Workflow.ComponentModel.ICompensatableActivity> interfejsu:</span><span class="sxs-lookup"><span data-stu-id="af963-231">The activity simply implements the <xref:System.Workflow.ComponentModel.ICompensatableActivity> interface:</span></span>

```csharp
class WorkScope :
        CompositeActivity, ICompensatableActivity
    {
        public WorkScope() : base() { }

        public WorkScope(string name)
        {
            this.Name = name;
        }

        public ActivityExecutionStatus Compensate(
            ActivityExecutionContext executionContext)
        {
            return ActivityExecutionStatus.Closed;
        }
    }
```

 <span data-ttu-id="af963-232">Elementy docelowe programu obsługi błędów `WorkScope` działania. Przepływ pracy WF4 jest równie uproszczony.</span><span class="sxs-lookup"><span data-stu-id="af963-232">The fault handler targets the `WorkScope` activity.The WF4 workflow is equally simplistic.</span></span>  <span data-ttu-id="af963-233">Element <xref:System.Activities.Statements.CompensableActivity> ma treść i procedurę obsługi.</span><span class="sxs-lookup"><span data-stu-id="af963-233">A <xref:System.Activities.Statements.CompensableActivity> has a body and a compensation handler.</span></span>  <span data-ttu-id="af963-234">Jawne compensate jest dalej w sekwencji.</span><span class="sxs-lookup"><span data-stu-id="af963-234">An explicit compensate is next in the sequence.</span></span>  <span data-ttu-id="af963-235">Działanie treści i rekompensaty działanie procedury obsługi są obu implementacjach pusta:</span><span class="sxs-lookup"><span data-stu-id="af963-235">The body activity and compensation handler activity are both empty implementations:</span></span>

```
public sealed class CompensableActivityEmptyCompensation : CodeActivity
    {
        public CompensableActivityEmptyCompensation()
            : base() { }

        public Activity Body { get; set; }

        protected override void Execute(CodeActivityContext context) { }
    }
    public sealed class CompensableActivityEmptyBody : CodeActivity
    {
        public CompensableActivityEmptyBody()
            : base() { }

        public Activity Body { get; set; }

        protected override void Execute(CodeActivityContext context) { }
    }
```

<span data-ttu-id="af963-236">Na poniższym diagramie przedstawiono podstawowe wynagrodzenie przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-236">The following diagram shows the basic compensation workflow.</span></span> <span data-ttu-id="af963-237">Przepływ pracy WF3 znajduje się po lewej stronie i WF4 przepływ pracy znajduje się po prawej stronie.</span><span class="sxs-lookup"><span data-stu-id="af963-237">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>

![WF3 i WF4 wynagrodzenie podstawowych przepływów pracy](./media/performance/basic-compensation-workflows-wf3-wf4.gif)

### <a name="performance-test-results"></a><span data-ttu-id="af963-239">Wyniki testów wydajności</span><span class="sxs-lookup"><span data-stu-id="af963-239">Performance Test Results</span></span>

 ![Tabelę przedstawiającą danych wyników testów wydajności](./media/performance/performance-test-data.gif)

 ![Wykres kolumnowy, porównywanie WF3 i WF4 danych test wydajności](./media/performance/performance-test-chart.gif)

 <span data-ttu-id="af963-242">Wszystkie testy są mierzone w przepływach pracy na sekundę, z wyjątkiem testowych zakresu transakcji.</span><span class="sxs-lookup"><span data-stu-id="af963-242">All tests are measured in workflows per second with the exception of the transaction scope test.</span></span>  <span data-ttu-id="af963-243">Jak widać w przedstawionym powyżej [!INCLUDE[wf1](../../../includes/wf1-md.md)] poprawiła wydajność środowiska uruchomieniowego w tablicy, zwłaszcza w obszarach, które wymagają wiele wykonań tego samego działania, takie jak while pętli.</span><span class="sxs-lookup"><span data-stu-id="af963-243">As can be seen above, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime performance has improved across the board, especially in areas that require multiple executions of the same activity like the while loop.</span></span>

## <a name="service-composition-scenario"></a><span data-ttu-id="af963-244">Scenariusz kompozycji obsługi</span><span class="sxs-lookup"><span data-stu-id="af963-244">Service Composition Scenario</span></span>
 <span data-ttu-id="af963-245">Jak pokazano w poprzedniej sekcji "składnika poziom wydajności porównania" nastąpiła znaczny spadek obciążenie między WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="af963-245">As is shown in the previous section, "Component-level Performance Comparisons," there has been a significant reduction in overhead between WF3 and WF4.</span></span>  <span data-ttu-id="af963-246">Usługi przepływu pracy WCF można teraz prawie pasuje wydajność usług WCF kodowane ręcznie, ale nadal mieć wszystkie zalety [!INCLUDE[wf1](../../../includes/wf1-md.md)] środowiska uruchomieniowego.</span><span class="sxs-lookup"><span data-stu-id="af963-246">WCF workflow services can now almost match the performance of hand-coded WCF services but still have all the benefits of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="af963-247">Ten scenariusz testów porównuje względem usługi przepływu pracy WCF w WF4 usługi WCF.</span><span class="sxs-lookup"><span data-stu-id="af963-247">This test scenario compares a WCF service against a WCF workflow service in WF4.</span></span>

### <a name="online-store-service"></a><span data-ttu-id="af963-248">Usługi online Store</span><span class="sxs-lookup"><span data-stu-id="af963-248">Online Store Service</span></span>
 <span data-ttu-id="af963-249">Jedną z zalet programu Windows Workflow Foundation jest możliwość tworzenia procesów przy użyciu kilku usług.</span><span class="sxs-lookup"><span data-stu-id="af963-249">One of the strengths of Windows Workflow Foundation is the ability to compose processes using several services.</span></span>  <span data-ttu-id="af963-250">W tym przykładzie jest usługą sklep online, która organizuje dwóch wywołań usług na zamówienie zakupu.</span><span class="sxs-lookup"><span data-stu-id="af963-250">For this example, there is an online store service that orchestrates two service calls to purchase an order.</span></span>  <span data-ttu-id="af963-251">Pierwszym krokiem jest Sprawdź poprawność kolejności przy użyciu usługi z weryfikowanie zamówienia.</span><span class="sxs-lookup"><span data-stu-id="af963-251">The first step is to validate the order using an Order Validating Service.</span></span>  <span data-ttu-id="af963-252">Drugim krokiem jest do realizacji zamówienia, korzystając z usługi magazynu.</span><span class="sxs-lookup"><span data-stu-id="af963-252">The second step is to fill the order using a Warehouse Service.</span></span>

 <span data-ttu-id="af963-253">Te dwie usługi wewnętrznej bazy danych usługi weryfikowanie zamówienia i usługi magazynu, pozostają takie same dla obu testów.</span><span class="sxs-lookup"><span data-stu-id="af963-253">The two backend services, Order Validating Service and Warehouse Service, remain the same for both tests.</span></span>  <span data-ttu-id="af963-254">Części, która zmienia się to usługa Online Store, która wykonuje aranżacji.</span><span class="sxs-lookup"><span data-stu-id="af963-254">The part that changes is the Online Store Service that performs the orchestration.</span></span>  <span data-ttu-id="af963-255">W przypadku jednego usługa jest ręcznie zakodowane jako usługa WCF.</span><span class="sxs-lookup"><span data-stu-id="af963-255">In one case, the service is hand-coded as a WCF service.</span></span>  <span data-ttu-id="af963-256">W przypadku usługi są zapisywane jako usługi przepływu pracy WCF w WF4.</span><span class="sxs-lookup"><span data-stu-id="af963-256">For the other case, the service is written as a WCF workflow service in WF4.</span></span> [!INCLUDE[wf1](../../../includes/wf1-md.md)]<span data-ttu-id="af963-257">-określone funkcje, takie jak śledzenie i trwałości są wyłączone dla tego testu.</span><span class="sxs-lookup"><span data-stu-id="af963-257">-specific features like tracking and persistence are turned off for this test.</span></span>

### <a name="environment"></a><span data-ttu-id="af963-258">Środowisko</span><span class="sxs-lookup"><span data-stu-id="af963-258">Environment</span></span>
![Konfigurowanie środowiska do pomiaru wydajności](./media/performance/performance-test-environment.gif)

 <span data-ttu-id="af963-260">Żądania klienta są kierowane do usługi Online Store za pośrednictwem protokołu HTTP z wielu komputerów.</span><span class="sxs-lookup"><span data-stu-id="af963-260">Client requests are made to the Online Store Service via HTTP from multiple computers.</span></span>  <span data-ttu-id="af963-261">Pojedynczy komputer obsługuje wszystkie trzy usługi.</span><span class="sxs-lookup"><span data-stu-id="af963-261">A single computer hosts all three services.</span></span>  <span data-ttu-id="af963-262">Warstwa transportu między Online usługą Store i usługami zaplecza jest TCP lub HTTP.</span><span class="sxs-lookup"><span data-stu-id="af963-262">The transport layer between the Online Store Service and the backend services is TCP or HTTP.</span></span>  <span data-ttu-id="af963-263">Pomiar operacji na sekundę zależy od liczby ukończonych `PurchaseOrder` wywołań do usługi Online Store.</span><span class="sxs-lookup"><span data-stu-id="af963-263">The measurement of operations/second is based on the number of completed `PurchaseOrder` calls made to the Online Store Service.</span></span>  <span data-ttu-id="af963-264">Buforowanie kanału to nowa funkcja dostępna w WF4.</span><span class="sxs-lookup"><span data-stu-id="af963-264">Channel pooling is a new feature available in WF4.</span></span>  <span data-ttu-id="af963-265">W programie WCF część tej buforowanie kanału testu nie zostanie podany gotowych, kodowane ręcznie implementacji proste techniki buforowania został użyty w usłudze Store w trybie Online.</span><span class="sxs-lookup"><span data-stu-id="af963-265">In the WCF portion of this test channel pooling is not provided out of the box so a hand-coded implementation of a simple pooling technique was used in the Online Store Service.</span></span>

### <a name="performance"></a><span data-ttu-id="af963-266">Wydajność</span><span class="sxs-lookup"><span data-stu-id="af963-266">Performance</span></span>
![Wykres kolumnowy przedstawiający wydajność usługi Store w trybie online](./media/performance/online-store-performance-graph.gif)

 <span data-ttu-id="af963-268">Łączenie z usługami TCP wewnętrznej bazy danych, bez buforowania kanału, [!INCLUDE[wf1](../../../includes/wf1-md.md)] usługi ma wpływ 17.2% na przepływności.</span><span class="sxs-lookup"><span data-stu-id="af963-268">Connecting to backend TCP services without channel pooling, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] service has a 17.2% impact on throughput.</span></span>  <span data-ttu-id="af963-269">Za pomocą kanału buforowanie, kary wynosi około 23,8%.</span><span class="sxs-lookup"><span data-stu-id="af963-269">With channel pooling, the penalty is about 23.8%.</span></span>  <span data-ttu-id="af963-270">W przypadku protokołu HTTP wpływ jest znacznie mniej: 4.3 bez buforowania – 8.1% z puli.</span><span class="sxs-lookup"><span data-stu-id="af963-270">For HTTP, the impact is much less: 4.3% without pooling and 8.1% with pooling.</span></span>  <span data-ttu-id="af963-271">Jest również pamiętać, że buforowanie kanału zapewnia bardzo niewielkie korzyści, gdy przy użyciu protokołu HTTP.</span><span class="sxs-lookup"><span data-stu-id="af963-271">It is also important to note that the channel pooling provides very little benefit when using HTTP.</span></span>

 <span data-ttu-id="af963-272">Choć obciążenie ze środowiska wykonawczego WF4 w porównaniu z usługą WCF kodowane ręcznie w tym teście, należy uważać scenariuszu najgorszego przypadku.</span><span class="sxs-lookup"><span data-stu-id="af963-272">While there is overhead from the WF4 runtime compared with a hand-coded WCF service in this test, it could be considered a worst-case scenario.</span></span>  <span data-ttu-id="af963-273">Te dwie usługi wewnętrznej bazy danych, w tym teście zrobić bardzo małego wysiłku.</span><span class="sxs-lookup"><span data-stu-id="af963-273">The two backend services in this test do very little work.</span></span>  <span data-ttu-id="af963-274">W scenariuszu rzeczywistym end-to-end te usługi przeprowadza się bardziej kosztowne operacje, takie jak wywołania bazy danych, co mniej istotny wpływ na wydajność warstwy transportowej.</span><span class="sxs-lookup"><span data-stu-id="af963-274">In a real end-to-end scenario, these services would perform more expensive operations like database calls, making the performance impact of the transport layer less important.</span></span>  <span data-ttu-id="af963-275">To plus korzyści z funkcji dostępnych w WF4 sprawia, że Workflow Foundation wyboru możliwego do użycia do tworzenia usług aranżacji.</span><span class="sxs-lookup"><span data-stu-id="af963-275">This plus the benefits of the features available in WF4 makes Workflow Foundation a viable choice for creating orchestration services.</span></span>

## <a name="key-performance-considerations"></a><span data-ttu-id="af963-276">Kluczowe zagadnienia dotyczące wydajności</span><span class="sxs-lookup"><span data-stu-id="af963-276">Key Performance Considerations</span></span>
 <span data-ttu-id="af963-277">Obszary funkcji w tej sekcji, z wyjątkiem współdziałania, zmieniły się znacznie między WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="af963-277">The feature areas in this section, with the exception of interop, have dramatically changed between WF3 and WF4.</span></span>  <span data-ttu-id="af963-278">Ma to wpływ na projekt aplikacji przepływu pracy, a także wydajność.</span><span class="sxs-lookup"><span data-stu-id="af963-278">This affects the design of workflow applications as well as the performance.</span></span>

#### <a name="workflow-activation-latency"></a><span data-ttu-id="af963-279">Opóźnienie aktywacji przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="af963-279">Workflow Activation Latency</span></span>
 <span data-ttu-id="af963-280">W aplikacji usługi przepływu pracy WCF czas oczekiwania na uruchomienie nowego przepływu pracy lub ładowania istniejącego przepływu pracy jest ważne, ponieważ może blokować.</span><span class="sxs-lookup"><span data-stu-id="af963-280">In a WCF workflow service application, the latency for starting a new workflow or loading an existing workflow is important as it can be blocking.</span></span>  <span data-ttu-id="af963-281">Ten przypadek testowy środków hosta WF3 XOML przed hostem WF4 XAMLX w typowym scenariuszu.</span><span class="sxs-lookup"><span data-stu-id="af963-281">This test case measures a WF3 XOML host against a WF4 XAMLX host in a typical scenario.</span></span>

##### <a name="environment-setup"></a><span data-ttu-id="af963-282">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="af963-282">Environment Setup</span></span>
 ![Konfigurowanie środowiska do testów opóźnienia i przepływności](./media/performance/latency-throughput-environment-setup.gif)

##### <a name="test-setup"></a><span data-ttu-id="af963-284">Testuj ustawienia</span><span class="sxs-lookup"><span data-stu-id="af963-284">Test Setup</span></span>
 <span data-ttu-id="af963-285">W tym scenariuszu komputer kliencki kontaktuje się z usług przepływu pracy WCF dzięki wykorzystaniu korelacja oparta na kontekście.</span><span class="sxs-lookup"><span data-stu-id="af963-285">In the scenario, a client computer contacts a WCF workflow service using context-based correlation.</span></span>  <span data-ttu-id="af963-286">Kontekst korelacji wymaga specjalnych kontekst powiązania i używa nagłówka kontekstu lub plik cookie do powiązania komunikatów dla wystąpienia przepływu pracy poprawne.</span><span class="sxs-lookup"><span data-stu-id="af963-286">Context correlation requires a special context binding and uses a context header or cookie to relate messages to the correct workflow instance.</span></span>  <span data-ttu-id="af963-287">Ma ona wydajności korzyści w tym korelacji, której identyfikator znajduje się w nagłówku komunikatu, więc treść komunikatu musi zostać przeanalizowany.</span><span class="sxs-lookup"><span data-stu-id="af963-287">It has a performance benefit in that the correlation Id is located in the message header so the message body does not need to be parsed.</span></span>

 <span data-ttu-id="af963-288">Usługa utworzy nowy przepływ pracy z tym żądaniem i Wyślij natychmiastowej reakcji pomiaru opóźnienia nie obejmuje czas uruchamiania przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-288">The service will create a new workflow with the request and send an immediate response so that the measurement of latency does not include the time spent running the workflow.</span></span>  <span data-ttu-id="af963-289">Przepływ pracy WF3 jest XOML związanego z kodem i WF4 przepływu pracy jest całkowicie XAML.</span><span class="sxs-lookup"><span data-stu-id="af963-289">The WF3 workflow is XOML with a code-behind and the WF4 workflow is entirely XAML.</span></span>  <span data-ttu-id="af963-290">Przepływ pracy WF4 wygląda następująco:</span><span class="sxs-lookup"><span data-stu-id="af963-290">The WF4 workflow looks like this:</span></span>

 ![Zakres korelacji WF4 przepływu pracy](./media/performance/wf4-correlationscope-workflow.gif)

 <span data-ttu-id="af963-292"><xref:System.ServiceModel.Activities.Receive> Działanie tworzy wystąpienie przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-292">The <xref:System.ServiceModel.Activities.Receive> activity creates the workflow instance.</span></span>  <span data-ttu-id="af963-293">Wartość przekazana w odebranej wiadomości jest powtarzana w komunikacie odpowiedzi.</span><span class="sxs-lookup"><span data-stu-id="af963-293">A value passed in the received message is echoed in the reply message.</span></span>  <span data-ttu-id="af963-294">Sekwencja następujące odpowiedź zawiera przepływ pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-294">A sequence following the reply contains the rest of the workflow.</span></span>  <span data-ttu-id="af963-295">W przypadku powyższych działań tylko jeden komentarz jest wyświetlany.</span><span class="sxs-lookup"><span data-stu-id="af963-295">In the above case, only one comment activity is shown.</span></span>  <span data-ttu-id="af963-296">Liczba działań w komentarz zostanie zmieniony na symulować złożoności przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-296">The number of comment activities is changed to simulate workflow complexity.</span></span>  <span data-ttu-id="af963-297">Działanie komentarza jest odpowiednikiem WF3 <xref:System.Workflow.Activities.CodeActivity> , nie wykonuje żadnych operacji.</span><span class="sxs-lookup"><span data-stu-id="af963-297">A comment activity is equivalent to a WF3 <xref:System.Workflow.Activities.CodeActivity> that performs no work.</span></span> <span data-ttu-id="af963-298">Aby uzyskać więcej informacji o działaniu komentarz zobacz sekcję "porównania wydajności poziomie składnika" wcześniej w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="af963-298">For more information about the comment activity, see the "Component-level Performance Comparison" section earlier in this article.</span></span>

##### <a name="test-results"></a><span data-ttu-id="af963-299">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="af963-299">Test Results</span></span>

 <span data-ttu-id="af963-300">Opóźnienie ścieżce nieaktywnej i dostępu do ciepłych usług przepływu pracy WCF:</span><span class="sxs-lookup"><span data-stu-id="af963-300">Cold and warm latency for WCF workflow services:</span></span>

 ![Wykres kolumnowy, przedstawiając opóźnienie ścieżce nieaktywnej i dostępu do ciepłych przy użyciu WF3 i WF4 usług przepływu pracy WCF](./media/performance/latency-results-graph.gif)

 <span data-ttu-id="af963-302">Na poprzednim wykresie zimnego odwołuje się do sprawy w przypadku, gdy nie ma, nie istnieje <xref:System.ServiceModel.WorkflowServiceHost> dla danego przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-302">In the previous chart, cold refers to the case where there is not an existing <xref:System.ServiceModel.WorkflowServiceHost> for the given workflow.</span></span>  <span data-ttu-id="af963-303">Innymi słowy czas oczekiwania na zimno jest podczas przepływu pracy jest używany po raz pierwszy i XOML lub XAML musi być skompilowana.</span><span class="sxs-lookup"><span data-stu-id="af963-303">In other words, cold latency is when the workflow is being used for the first time and the XOML or XAML needs to be compiled.</span></span>  <span data-ttu-id="af963-304">Czas oczekiwania na ciepło to czas do utworzenia nowego wystąpienia przepływu pracy, gdy typ przepływu pracy został już wcześniej skompilowany.</span><span class="sxs-lookup"><span data-stu-id="af963-304">Warm latency is the time to create a new workflow instance when the workflow type has already been compiled.</span></span>  <span data-ttu-id="af963-305">Złożoność przepływu pracy sprawia, że bardzo niewielkie różnice w przypadku WF4, ale ma progresji liniowej w przypadku WF3.</span><span class="sxs-lookup"><span data-stu-id="af963-305">The complexity of the workflow makes very little difference in the WF4 case but has a linear progression in the WF3 case.</span></span>

#### <a name="correlation-throughput"></a><span data-ttu-id="af963-306">Przepływność korelacji</span><span class="sxs-lookup"><span data-stu-id="af963-306">Correlation Throughput</span></span>
 <span data-ttu-id="af963-307">WF4 wprowadzono nową funkcję korelacji na podstawie zawartości.</span><span class="sxs-lookup"><span data-stu-id="af963-307">WF4 introduces a new content-based correlation feature.</span></span>  <span data-ttu-id="af963-308">WF3 podany tylko korelacja oparta na kontekście.</span><span class="sxs-lookup"><span data-stu-id="af963-308">WF3 provided only context-based correlation.</span></span>  <span data-ttu-id="af963-309">Korelacja oparta na kontekście może być przeprowadzone wyłącznie za pośrednictwem określonego powiązania kanału WCF.</span><span class="sxs-lookup"><span data-stu-id="af963-309">Context-based correlation could only be done over specific WCF channel bindings.</span></span>  <span data-ttu-id="af963-310">Identyfikator przepływu pracy są wstawiane do nagłówka wiadomości, korzystając z tych powiązań.</span><span class="sxs-lookup"><span data-stu-id="af963-310">The workflow Id is inserted into the message header when using these bindings.</span></span>  <span data-ttu-id="af963-311">Środowisko uruchomieniowe WF3 tylko można zidentyfikować przepływu pracy za pomocą jego identyfikatora.  Za pomocą opartego na zawartości korelacji Autor przepływu pracy może utworzyć klucz korelacji poza odpowiednie części danych, takich jak numer konta lub klienta identyfikator.</span><span class="sxs-lookup"><span data-stu-id="af963-311">The WF3 runtime could only identify a workflow by its Id.  With content-based correlation, the workflow author can create a correlation key out of a relevant piece of data like an account number or customer Id.</span></span>

 <span data-ttu-id="af963-312">Korelacja oparta na kontekście ma korzystać wydajności, w tym, że klucz korelacji znajduje się w nagłówku komunikatu.</span><span class="sxs-lookup"><span data-stu-id="af963-312">Context-based correlation has a performance advantage in that the correlation key is located in the message header.</span></span>  <span data-ttu-id="af963-313">Klucz można odczytać z wiadomość bez cofania-serialization/komunikat kopiowania.</span><span class="sxs-lookup"><span data-stu-id="af963-313">The key can be read from the message without de-serialization/message-copying.</span></span>  <span data-ttu-id="af963-314">W korelacja oparta na zawartości klucz korelacji jest przechowywany w treści komunikatu.</span><span class="sxs-lookup"><span data-stu-id="af963-314">In content-based correlation, the correlation key is stored in the message body.</span></span>  <span data-ttu-id="af963-315">Wyrażenie XPath jest używana do lokalizowania klucza.</span><span class="sxs-lookup"><span data-stu-id="af963-315">An XPath expression is used to locate the key.</span></span>  <span data-ttu-id="af963-316">Koszt tego dodatkowego przetwarzania zależy od rozmiaru wiadomości głębokość klucza w treści i liczbę kluczy.</span><span class="sxs-lookup"><span data-stu-id="af963-316">The cost of this extra processing depends on the size of the message, depth of the key in the body, and the number of keys.</span></span>  <span data-ttu-id="af963-317">Ten test porównuje korelacji na podstawie kontekstu i zawartości i pokazuje również obniżenia wydajności w przypadku korzystania z wielu kluczy.</span><span class="sxs-lookup"><span data-stu-id="af963-317">This test compares context- and content-based correlation and also shows the performance degradation when using multiple keys.</span></span>

#### <a name="environment-setup"></a><span data-ttu-id="af963-318">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="af963-318">Environment Setup</span></span>
![Konfigurowanie środowiska dla testów wydajności przepływu pracy](./media/performance/performance-test-environment.gif)

#### <a name="test-setup"></a><span data-ttu-id="af963-320">Testuj ustawienia</span><span class="sxs-lookup"><span data-stu-id="af963-320">Test Setup</span></span>
<span data-ttu-id="af963-321">![Korelacja przepływności przepływu pracy testowania](./media/performance/correlation-throughput-workflow.gif "konfiguracji testu przepływu pracy przepływności korelacji")</span><span class="sxs-lookup"><span data-stu-id="af963-321">![Correlation Throughput Workflow Test](./media/performance/correlation-throughput-workflow.gif "Correlation throughput workflow test setup")</span></span>

 <span data-ttu-id="af963-322">Poprzedni przepływ pracy jest taka sama, używany w [trwałości](#persistence) sekcji.</span><span class="sxs-lookup"><span data-stu-id="af963-322">The previous workflow is the same one used in the [Persistence](#persistence) section.</span></span> <span data-ttu-id="af963-323">W przypadku testów korelacji bez trwałości nie ma trwałości dostawcy zainstalowane w środowisku uruchomieniowym.</span><span class="sxs-lookup"><span data-stu-id="af963-323">For the correlation tests without persistence, there is no persistence provider installed in the runtime.</span></span> <span data-ttu-id="af963-324">Korelacja odbywa się w dwóch miejscach: CreateOrder i CompleteOrder.</span><span class="sxs-lookup"><span data-stu-id="af963-324">Correlation occurs in two places: CreateOrder and CompleteOrder.</span></span>

#### <a name="test-results"></a><span data-ttu-id="af963-325">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="af963-325">Test Results</span></span>
<span data-ttu-id="af963-326">![Przepływność korelacji](./media/performance/correlation-throughput-graph.gif "wykres przepływności korelacji")</span><span class="sxs-lookup"><span data-stu-id="af963-326">![Correlation Throughput](./media/performance/correlation-throughput-graph.gif "Correlation throughput graph")</span></span>

 <span data-ttu-id="af963-327">Ten wykres pokazuje spadek wydajności jako liczba kluczy używanych do zwiększenia korelacji na podstawie zawartości.</span><span class="sxs-lookup"><span data-stu-id="af963-327">This graph shows a decrease in performance as the number of keys used in content-based correlation increases.</span></span>  <span data-ttu-id="af963-328">Podobieństwa krzywych między TCP i HTTP wskazuje obciążenia związanego z tych protokołów.</span><span class="sxs-lookup"><span data-stu-id="af963-328">The similarity in the curves between TCP and HTTP indicates the overhead associated with these protocols.</span></span>

#### <a name="correlation-with-persistence"></a><span data-ttu-id="af963-329">Korelacja z trwałości</span><span class="sxs-lookup"><span data-stu-id="af963-329">Correlation with Persistence</span></span>
 <span data-ttu-id="af963-330">Za pomocą utrwalonych przepływu pracy wykorzystanie procesora CPU z korelacji na podstawie zawartości przenosi ze środowiska wykonawczego przepływów pracy z bazą danych SQL.</span><span class="sxs-lookup"><span data-stu-id="af963-330">With a persisted workflow, the CPU pressure from content-based correlation shifts from the workflow runtime to the SQL database.</span></span>  <span data-ttu-id="af963-331">Procedur składowanych w dostawcy stanów trwałych programu SQL spełniała zgodności kluczy, aby zlokalizować odpowiedni przepływ pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-331">The stored procedures in the SQL persistence provider do the work of matching the keys to locate the appropriate workflow.</span></span>

 ![Wykres liniowy przedstawiający wyniki korelacji i trwałości](./media/performance/correlation-persistence-graph.gif)

 <span data-ttu-id="af963-333">Korelacja oparta na kontekście jest nadal szybciej niż korelacji na podstawie zawartości.</span><span class="sxs-lookup"><span data-stu-id="af963-333">Context-based correlation is still faster than content-based correlation.</span></span>  <span data-ttu-id="af963-334">Jednak różnica jest mniejsza wymawiane jako trwałości ma większy wpływ na wydajność niż korelacji.</span><span class="sxs-lookup"><span data-stu-id="af963-334">However, the difference is less pronounced as persistence has more impact on performance than correlation.</span></span>

### <a name="complex-workflow-throughput"></a><span data-ttu-id="af963-335">Przepływność złożonych przepływów prac</span><span class="sxs-lookup"><span data-stu-id="af963-335">Complex Workflow Throughput</span></span>
 <span data-ttu-id="af963-336">Złożoność przepływu pracy nie jest mierzona tylko przez liczbę działań.</span><span class="sxs-lookup"><span data-stu-id="af963-336">The complexity of a workflow is not measured only by the number of activities.</span></span>  <span data-ttu-id="af963-337">Działań złożonych może zawierać wiele podrzędnych, a te elementy podrzędne mogą być również działań złożonych.</span><span class="sxs-lookup"><span data-stu-id="af963-337">Composite activities can contain many children and those children can also be composite activities.</span></span>  <span data-ttu-id="af963-338">Jako liczba poziomów zagnieżdżenia zwiększa to samo dotyczy liczby działań, które mogą być obecnie w stanie Wykonywanie i liczba zmiennych, które mogą być w stanie.</span><span class="sxs-lookup"><span data-stu-id="af963-338">As the number of levels of nesting increases, so does the number of activities that can be currently in the executing state and the number of variables that can be in state.</span></span>  <span data-ttu-id="af963-339">Ten test porównuje przepływności między WF3 i WF4 podczas wykonywania złożonych przepływów pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-339">This test compares throughput between WF3 and WF4 when executing complex workflows.</span></span>

### <a name="test-setup"></a><span data-ttu-id="af963-340">Testuj ustawienia</span><span class="sxs-lookup"><span data-stu-id="af963-340">Test Setup</span></span>
 <span data-ttu-id="af963-341">Te testy zostały wykonane na Intel Xeon X5355 @ procesor 2,66 GHz 4 sposób komputera z 4 GB pamięci RAM, systemem Windows Server 2008 x64.</span><span class="sxs-lookup"><span data-stu-id="af963-341">These tests were executed on an Intel Xeon X5355 @ 2.66GHz 4-way computer with 4GB RAM running Windows Server 2008 x64.</span></span>  <span data-ttu-id="af963-342">Kod testu jest uruchamiany w ramach jednego procesu z jednego wątku na każdy rdzeń do osiągnięcia 100% wykorzystanie Procesora.</span><span class="sxs-lookup"><span data-stu-id="af963-342">The test code runs in a single process with one thread per core to reach 100% CPU utilization.</span></span>

 <span data-ttu-id="af963-343">Przepływy pracy, generowany dla tego testu mają dwóch głównych zmiennych: głębokość i liczbę działań zawartych w poszczególnych sekwencji.</span><span class="sxs-lookup"><span data-stu-id="af963-343">The workflows generated for this test have two main variables: depth and number of activities in each sequence.</span></span>  <span data-ttu-id="af963-344">Każdy poziom głębokość zawiera działania równoległego, podczas pętli, decyzje, przydziały i sekwencji.</span><span class="sxs-lookup"><span data-stu-id="af963-344">Each depth level includes a parallel activity, while loop, decisions, assignments, and sequences.</span></span>  <span data-ttu-id="af963-345">W Projektancie WF4 na obrazku poniżej najwyższego poziomu blokowy jest przedstawiony.</span><span class="sxs-lookup"><span data-stu-id="af963-345">In the WF4 designer pictured below, the top-level flow chart is pictured.</span></span>  <span data-ttu-id="af963-346">Każde działanie schemat blokowy przypomina głównym schematu blokowego.</span><span class="sxs-lookup"><span data-stu-id="af963-346">Each flowchart activity resembles the main flowchart.</span></span>  <span data-ttu-id="af963-347">Może być można wyobrazić sobie fraktalowy podczas picturing ten przepływ pracy, gdzie głębokość jest ograniczona do parametrów testu.</span><span class="sxs-lookup"><span data-stu-id="af963-347">It may be helpful to think of a fractal when picturing this workflow, where the depth is limited to the parameters of the test.</span></span>

 <span data-ttu-id="af963-348">Liczba działań w dany test zależy od głębokości i liczba działań w sekwencji.</span><span class="sxs-lookup"><span data-stu-id="af963-348">The number of activities in a given test is determined by the depth and number of activities per sequence.</span></span>  <span data-ttu-id="af963-349">Poniższego równania oblicza liczbę działań w teście WF4:</span><span class="sxs-lookup"><span data-stu-id="af963-349">The following equation computes the number of activities in the WF4 test:</span></span>

 ![Równania do obliczenia liczby działań](./media/performance/number-activities-equation.gif)

 <span data-ttu-id="af963-351">Liczba działań testów WF3 może zostać obliczony z nieco równania ze względu na dodatkowe sekwencji:</span><span class="sxs-lookup"><span data-stu-id="af963-351">The WF3 test’s activity count can be computed with a slightly different equation due to an extra sequence:</span></span>

 ![Równania do obliczenia liczby działań WF3](./media/performance/wf3-number-activities-equation.gif)

 <span data-ttu-id="af963-353">Gdzie głębokość d, a jeśli tak, to a jest liczba działań w sekwencji.</span><span class="sxs-lookup"><span data-stu-id="af963-353">Where d is the depth and a is the number of activities per sequence.</span></span>  <span data-ttu-id="af963-354">Logiki stojącej za tymi równania jest, że pierwszym stała mnożona przez, jest numerem sekwencji, a drugi — stała jest statyczny liczbę działań zawartych w bieżącym poziomie.</span><span class="sxs-lookup"><span data-stu-id="af963-354">The logic behind these equations is that the first constant, multiplied by a, is the number of sequences and the second constant is the static number of activities in the current level.</span></span>  <span data-ttu-id="af963-355">Istnieją trzy działania podrzędne schemat blokowy w każdym schemacie blokowym.</span><span class="sxs-lookup"><span data-stu-id="af963-355">There are three flowchart child activities in each flowchart.</span></span>  <span data-ttu-id="af963-356">Na najniższym poziomie głębokość blokowych te są puste, ale na innych poziomach są kopie głównym schematu blokowego.</span><span class="sxs-lookup"><span data-stu-id="af963-356">At the bottom depth level, these flowcharts are empty but at the other levels they are copies of the main flowchart.</span></span>  <span data-ttu-id="af963-357">Liczba działań w definicji przepływu pracy poszczególnych odmian test jest oznaczany w poniższej tabeli:</span><span class="sxs-lookup"><span data-stu-id="af963-357">The number of activities in each test variation’s workflow definition is indicated in the following table:</span></span>

 ![Tabelę, która pokazuje liczbę działań, używany do każdego testu](./media/performance/workflow-variation-compare-table.gif)

 <span data-ttu-id="af963-359">Liczba działań w definicji przepływu pracy znacznie zwiększa się, każdy poziom głębi.</span><span class="sxs-lookup"><span data-stu-id="af963-359">The number of activities in the workflow definition increases sharply with each depth level.</span></span>  <span data-ttu-id="af963-360">Ale tylko jedna ścieżka na podjęcie decyzji, czy jest wykonywana w wystąpienia danego przepływu pracy, wykonywane są tylko mały podzbiór rzeczywistych działań.</span><span class="sxs-lookup"><span data-stu-id="af963-360">But only one path per decision point is executed in a given workflow instance, so only a small subset of the actual activities are executed.</span></span>

 ![Schemat blokowy przebiegu przepływu pracy złożonych przepływności](./media/performance/complex-workflow-throughput-workflow.gif)

 <span data-ttu-id="af963-362">Przepływ pracy równoważnych został utworzony dla WF3.</span><span class="sxs-lookup"><span data-stu-id="af963-362">An equivalent workflow was created for WF3.</span></span> <span data-ttu-id="af963-363">Projektant WF3 pokazuje całego przepływu pracy w obszarze projektowania zamiast zagnieżdżania, dlatego jest zbyt duży do wyświetlenia w tym temacie.</span><span class="sxs-lookup"><span data-stu-id="af963-363">The WF3 designer shows the entire workflow in the design area instead of nesting, therefore it is too big to display in this topic.</span></span> <span data-ttu-id="af963-364">Poniżej przedstawiono fragment przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-364">A snippet of the workflow is shown below.</span></span>

 ![Schemat blokowy fragment WF3 przepływu pracy](./media/performance/wf3-workflow-snippet.gif)

 <span data-ttu-id="af963-366">Do wykonania zagnieżdżenia w ekstremalnych przypadkach, inny przepływ pracy, który jest częścią tego testu używa 100 sekwencje zagnieżdżone.</span><span class="sxs-lookup"><span data-stu-id="af963-366">To exercise nesting in an extreme case, another workflow that is part of this test uses 100 nested sequences.</span></span>  <span data-ttu-id="af963-367">Najbardziej wewnętrzny sekwencji jest pojedynczy `Comment` lub <xref:System.Workflow.Activities.CodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="af963-367">In the innermost sequence is a single `Comment` or <xref:System.Workflow.Activities.CodeActivity>.</span></span>

 ![Schemat blokowy zagnieżdżonych sekwencji](./media/performance/nested-sequence-workflow.gif)

 <span data-ttu-id="af963-369">Śledzenie i trwałości nie są używane jako część tego testu.</span><span class="sxs-lookup"><span data-stu-id="af963-369">Tracking and persistence are not used as part of this test.</span></span>

### <a name="test-results"></a><span data-ttu-id="af963-370">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="af963-370">Test Results</span></span>
 ![Wykres kolumnowy przedstawiający przepływność wyników wydajności](./media/performance/throughput-performance-results.gif)

 <span data-ttu-id="af963-372">Nawet w przypadku złożonych przepływów pracy za pomocą mnóstwo głębi i dużą liczbę działań wyniki są zgodne z inne liczby przepływności przedstawiony we wcześniejszej części tego artykułu.</span><span class="sxs-lookup"><span data-stu-id="af963-372">Even with complex workflows with lots of depth and a high number of activities, the performance results are consistent with other throughput numbers shown earlier in this article.</span></span>  <span data-ttu-id="af963-373">Przepływność WF4 firmy jest szybsza rzędy wielkości i ma być porównywana na skali logarytmicznej.</span><span class="sxs-lookup"><span data-stu-id="af963-373">WF4’s throughput is orders of magnitude faster and has to be compared on a logarithmic scale.</span></span>

### <a name="memory"></a><span data-ttu-id="af963-374">Pamięć</span><span class="sxs-lookup"><span data-stu-id="af963-374">Memory</span></span>
 <span data-ttu-id="af963-375">Obciążenie pamięci programu Windows Workflow Foundation jest mierzony w dwóch podstawowych obszarach: złożoność przepływu pracy i liczbę definicji przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-375">The memory overhead of Windows Workflow Foundation is measured in two key areas: workflow complexity and number of workflow definitions.</span></span>  <span data-ttu-id="af963-376">Pomiary pamięci zostały pobrane na stacji roboczej x 64 Windows 7.</span><span class="sxs-lookup"><span data-stu-id="af963-376">Memory measurements were taken on a Windows 7 64-bit workstation.</span></span>  <span data-ttu-id="af963-377">Istnieje wiele sposobów na uzyskanie pomiarów Ustaw rozmiar, takich jak monitorowanie liczników wydajności, sondowanie Environment.WorkingSet lub przy użyciu narzędzia, takiego jak VMMap dostępne praca [VMMap](/sysinternals/downloads/vmmap).</span><span class="sxs-lookup"><span data-stu-id="af963-377">There are many ways to obtain the measurement of working set size such as monitoring performance counters, polling Environment.WorkingSet, or using a tool like VMMap available from [VMMap](/sysinternals/downloads/vmmap).</span></span> <span data-ttu-id="af963-378">Kombinacji metod został użyty do uzyskania i sprawdzić wyniki każdego testu.</span><span class="sxs-lookup"><span data-stu-id="af963-378">A combination of methods was used to obtain and verify the results of each test.</span></span>

### <a name="workflow-complexity-test"></a><span data-ttu-id="af963-379">Test złożoności przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="af963-379">Workflow Complexity Test</span></span>
 <span data-ttu-id="af963-380">Złożoność przepływu pracy testu środków zestaw roboczy różnica, zależnie od stopnia złożoności przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-380">The workflow complexity test measures the working set difference based on the complexity of the workflow.</span></span>  <span data-ttu-id="af963-381">Oprócz złożone przepływy pracy, wykorzystywane w poprzedniej sekcji, nowe zmiany są dodawane do obejmuje dwa podstawowe przypadki: jedno działanie przepływu pracy i sekwencję działań 1000.</span><span class="sxs-lookup"><span data-stu-id="af963-381">In addition to the complex workflows used in the previous section, new variations are added to cover two basic cases: a single activity workflow and a sequence with 1000 activities.</span></span>  <span data-ttu-id="af963-382">Testy te przepływy pracy są zainicjowany i wykonywane w celu ukończenia w jednej pętli szeregowe w okresie jednej minuty.</span><span class="sxs-lookup"><span data-stu-id="af963-382">For these tests the workflows are initialized and executed to completion in a single serial loop for a period of one minute.</span></span>  <span data-ttu-id="af963-383">Poszczególnych odmian test jest uruchamiany trzy razy, a dane zapisane jest średnią z tych trzech przebiegów.</span><span class="sxs-lookup"><span data-stu-id="af963-383">Each test variation is run three times and the data recorded is the average of those three runs.</span></span>

 <span data-ttu-id="af963-384">Dwie nowe podstawowe testy mają przepływy pracy, wyglądające podobnie jak pokazano poniżej:</span><span class="sxs-lookup"><span data-stu-id="af963-384">The two new basic tests have workflows that look like those shown below:</span></span>

 ![Złożonych przepływów prac dla WF3 i WF4](./media/performance/complex-workflow-wf3-wf4.gif)

 <span data-ttu-id="af963-386">W przepływie pracy WF3 powyżej pusty <xref:System.Workflow.Activities.CodeActivity> działania są używane.</span><span class="sxs-lookup"><span data-stu-id="af963-386">In the WF3 workflow shown above, empty <xref:System.Workflow.Activities.CodeActivity> activities are used.</span></span>  <span data-ttu-id="af963-387">Przepływ pracy WF4 powyżej używa `Comment` działań.</span><span class="sxs-lookup"><span data-stu-id="af963-387">The WF4 workflow above uses `Comment` activities.</span></span>  <span data-ttu-id="af963-388">`Comment` Działanie zostało opisane w sekcji porównania wydajności poziomie składników we wcześniejszej części tego artykułu.</span><span class="sxs-lookup"><span data-stu-id="af963-388">The `Comment` activity was described in the Component-level Performance Comparisons section earlier in this article.</span></span>

 ![Wykres kolumnowy przedstawiający użycie pamięci złożonych przepływów prac dla WF3 i WF4 przepływów pracy](./media/performance/complex-memory-usage-wf3-wf4.gif)

 <span data-ttu-id="af963-390">Jednym z wyczyść trendów, które należy zwrócić uwagę na tym wykresie jest, że zagnieżdżanie ma względnie minimalny wpływ na użycie pamięci w WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="af963-390">One of the clear trends to notice in this graph is that nesting has relatively minimal impact on memory usage in both WF3 and WF4.</span></span>  <span data-ttu-id="af963-391">Największy wpływ pamięci pochodzi z liczbę działań w danym przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-391">The most significant memory impact comes from the number of activities in a given workflow.</span></span>  <span data-ttu-id="af963-392">Mając dane z sekwencji 1000, złożonych głębokość 5 sekwencji 5 i złożonych głębokość 7 sekwencji 1 odmiany, jest jasne, że podczas tysięcy liczbę działań, wzrost użycia pamięci staje się bardziej zauważalne.</span><span class="sxs-lookup"><span data-stu-id="af963-392">Given the data from the sequence 1000, complex depth 5 sequence 5, and complex depth 7 sequence 1 variations, it is clear that as the number of activities enters the thousands, the memory usage increase becomes more noticeable.</span></span>  <span data-ttu-id="af963-393">W przypadku extreme (głębokość 7 sekwencji 1) w przypadku działania ~ 29K WF4 przy użyciu prawie 79% mniej pamięci niż WF3.</span><span class="sxs-lookup"><span data-stu-id="af963-393">In the extreme case (depth 7 sequence 1) where there are ~29K activities, WF4 is using almost 79% less memory than WF3.</span></span>

### <a name="multiple-workflow-definitions-test"></a><span data-ttu-id="af963-394">Wiele testów definicji przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="af963-394">Multiple Workflow Definitions Test</span></span>
 <span data-ttu-id="af963-395">Ze względu na dostępne opcje do hostowania przepływów pracy w programie WF3 i WF4, pomiaru pamięci dla definicji przepływu pracy jest podzielony na dwóch różnych badań.</span><span class="sxs-lookup"><span data-stu-id="af963-395">Measuring memory per workflow definition is divided into two different tests because of the available options for hosting workflows in WF3 and WF4.</span></span>  <span data-ttu-id="af963-396">Testy są uruchamiane w inny sposób niż badanie złożoności przepływu pracy, w tym danego przepływu pracy jest wystąpienia i wykonywane tylko raz w każdej definicji.</span><span class="sxs-lookup"><span data-stu-id="af963-396">The tests are run in a different manner than the workflow complexity test in that a given workflow is instanced and executed only once per definition.</span></span>  <span data-ttu-id="af963-397">Jest to spowodowane definicji przepływu pracy i jej hostem pozostają w pamięci dla okresu istnienia domeny aplikacji.</span><span class="sxs-lookup"><span data-stu-id="af963-397">This is because the workflow definition and its host remain in memory for the lifetime of the AppDomain.</span></span>  <span data-ttu-id="af963-398">Można wyczyścić pamięci używanej przez uruchomione wystąpienie danego przepływu pracy w podczas wyrzucania elementów bezużytecznych.</span><span class="sxs-lookup"><span data-stu-id="af963-398">The memory used by running a given workflow instance should be cleaned up during garbage collection.</span></span>  <span data-ttu-id="af963-399">Wskazówki dotyczące migracji dla WF4 zawiera bardziej szczegółowe informacje na temat opcji hostingu.</span><span class="sxs-lookup"><span data-stu-id="af963-399">The migration guidance for WF4 contains more detailed information on the hosting options.</span></span> <span data-ttu-id="af963-400">Aby uzyskać więcej informacji, zobacz [Podręcznik migracji WF: Przepływ pracy obsługujący](https://go.microsoft.com/fwlink/?LinkID=153313).</span><span class="sxs-lookup"><span data-stu-id="af963-400">For more information, see [WF Migration Cookbook: Workflow Hosting](https://go.microsoft.com/fwlink/?LinkID=153313).</span></span>

 <span data-ttu-id="af963-401">Tworzenie wielu definicji przepływu pracy w celu przetestowania definicji przepływu pracy można wykonać na kilka sposobów.</span><span class="sxs-lookup"><span data-stu-id="af963-401">Creating many workflow definitions for a workflow definition test can be done in several ways.</span></span>  <span data-ttu-id="af963-402">Na przykład jedna Użyj generowania kodu, aby utworzyć zbiór 1000 przepływów pracy, które są identyczne, z wyjątkiem nazwy i zapisać każdy z tych przepływów pracy w osobnych plikach.</span><span class="sxs-lookup"><span data-stu-id="af963-402">For instance, one could use code generation to create a set of 1000 workflows that are identical except in name and save each of those workflows into separate files.</span></span>  <span data-ttu-id="af963-403">Ta metoda została wykonana dla testu hostowanymi w konsoli.</span><span class="sxs-lookup"><span data-stu-id="af963-403">This approach was taken for the console-hosted test.</span></span>  <span data-ttu-id="af963-404">W WF3 <xref:System.Workflow.Runtime.WorkflowRuntime> klasy został użyty do uruchomienia definicji przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-404">In WF3, the <xref:System.Workflow.Runtime.WorkflowRuntime> class was used to run the workflow definitions.</span></span>  <span data-ttu-id="af963-405">WF4 można użyć <xref:System.Activities.WorkflowApplication> do utworzenia wystąpienia jeden przepływ pracy lub bezpośrednio przy użyciu <xref:System.Activities.WorkflowInvoker> do uruchomienia wybranego działania, jak w przypadku wywołania metody.</span><span class="sxs-lookup"><span data-stu-id="af963-405">WF4 can either use <xref:System.Activities.WorkflowApplication> to create a single workflow instance or directly use <xref:System.Activities.WorkflowInvoker> to run the activity as if it were a method call.</span></span>  <span data-ttu-id="af963-406"><xref:System.Activities.WorkflowApplication> host wystąpienia jeden przepływ pracy i ma bliżej równoważności funkcji, aby <xref:System.Workflow.Runtime.WorkflowRuntime> tak, aby został użyty w tym teście.</span><span class="sxs-lookup"><span data-stu-id="af963-406"><xref:System.Activities.WorkflowApplication> is a host of a single workflow instance and has closer feature parity to <xref:System.Workflow.Runtime.WorkflowRuntime> so that was used in this test.</span></span>

 <span data-ttu-id="af963-407">W przypadku hostowania przepływów pracy w usługach IIS jest możliwość użycia <xref:System.Web.Hosting.VirtualPathProvider> do tworzenia nowego <xref:System.ServiceModel.WorkflowServiceHost> zamiast generować wszystkie pliki XAMLX lub pliku XOML.</span><span class="sxs-lookup"><span data-stu-id="af963-407">When hosting workflows in IIS it is possible to use a <xref:System.Web.Hosting.VirtualPathProvider> to create a new <xref:System.ServiceModel.WorkflowServiceHost> instead of generating all of the XAMLX or XOML files.</span></span>  <span data-ttu-id="af963-408"><xref:System.Web.Hosting.VirtualPathProvider> Obsługuje przychodzące żądanie i odpowiada za pomocą "wirtualnego pliku", która może być załadowana z bazy danych lub, w tym przypadku jest generowane na bieżąco.</span><span class="sxs-lookup"><span data-stu-id="af963-408">The <xref:System.Web.Hosting.VirtualPathProvider> handles the incoming request and responds with a "virtual file" that can be loaded from a database or, in this case, generated on the fly.</span></span>  <span data-ttu-id="af963-409">Jest konieczne utworzyć pliki fizyczne 1000.</span><span class="sxs-lookup"><span data-stu-id="af963-409">It is therefore unnecessary to create 1000 physical files.</span></span>

 <span data-ttu-id="af963-410">Definicje przepływów pracy używanych w teście konsoli były proste sekwencyjne przepływy pracy za pomocą jednego działania.</span><span class="sxs-lookup"><span data-stu-id="af963-410">The workflow definitions used in the console test were simple sequential workflows with a single activity.</span></span>  <span data-ttu-id="af963-411">Pojedyncze działanie była pusta <xref:System.Workflow.Activities.CodeActivity> przypadku WF3 i `Comment` działanie w przypadku WF4.</span><span class="sxs-lookup"><span data-stu-id="af963-411">The single activity was an empty <xref:System.Workflow.Activities.CodeActivity> for the WF3 case and a `Comment` activity for the WF4 case.</span></span>  <span data-ttu-id="af963-412">W przypadku hostowanych przez usługi IIS używane przepływów pracy rozpoczynających się po odebraniu wiadomości i zakończenia na wysyłanie odpowiedzi:</span><span class="sxs-lookup"><span data-stu-id="af963-412">The IIS-hosted case used workflows that start on receiving a message and end on sending a reply:</span></span>

<span data-ttu-id="af963-413">Na poniższej ilustracji przedstawiono WF3 przepływ pracy o działaniu ReceiveActivity oraz WF4 przepływu pracy przy użyciu wzorca żądania/odpowiedzi:</span><span class="sxs-lookup"><span data-stu-id="af963-413">The following image shows a WF3 workflow with ReceiveActivity and a WF4 workflow with request/response pattern:</span></span>

 ![Usługi przepływu pracy w WF3 i WF4](./media/performance/workflow-receive-activity.gif)

 <span data-ttu-id="af963-415">W poniższej tabeli przedstawiono różnicowej w zestawie roboczym między definicji jeden przepływ pracy i definicje 1001:</span><span class="sxs-lookup"><span data-stu-id="af963-415">The following table shows the delta in working set between a single workflow definition and 1001 definitions:</span></span>

|<span data-ttu-id="af963-416">Opcje hostingu</span><span class="sxs-lookup"><span data-stu-id="af963-416">Hosting Options</span></span>|<span data-ttu-id="af963-417">WF3 Różnica zestawu roboczego</span><span class="sxs-lookup"><span data-stu-id="af963-417">WF3 Working Set Delta</span></span>|<span data-ttu-id="af963-418">WF4 Różnica zestawu roboczego</span><span class="sxs-lookup"><span data-stu-id="af963-418">WF4 Working Set Delta</span></span>|
|---------------------|---------------------------|---------------------------|
|<span data-ttu-id="af963-419">Aplikacja konsoli hostowana przepływów pracy</span><span class="sxs-lookup"><span data-stu-id="af963-419">Console Application Hosted Workflows</span></span>|<span data-ttu-id="af963-420">18 MB</span><span class="sxs-lookup"><span data-stu-id="af963-420">18 MB</span></span>|<span data-ttu-id="af963-421">9 MB</span><span class="sxs-lookup"><span data-stu-id="af963-421">9 MB</span></span>|
|<span data-ttu-id="af963-422">Przepływ pracy usługi hostowanej w programie IIS</span><span class="sxs-lookup"><span data-stu-id="af963-422">IIS Hosted Workflow Services</span></span>|<span data-ttu-id="af963-423">446 MB</span><span class="sxs-lookup"><span data-stu-id="af963-423">446 MB</span></span>|<span data-ttu-id="af963-424">364 MB</span><span class="sxs-lookup"><span data-stu-id="af963-424">364 MB</span></span>|

 <span data-ttu-id="af963-425">Hosting definicji przepływu pracy w usługach IIS zużywa znacznie większej ilości pamięci, ze względu na <xref:System.ServiceModel.WorkflowServiceHost>, szczegółowe artefaktów usługi WCF i przetwarzania logiki skojarzonej z hostem wiadomości.</span><span class="sxs-lookup"><span data-stu-id="af963-425">Hosting workflow definitions in IIS consumes much more memory due to the <xref:System.ServiceModel.WorkflowServiceHost>, detailed WCF service artifacts, and the message processing logic associated with the host.</span></span>

 <span data-ttu-id="af963-426">Dla konsoli hostowanie WF3 przepływy pracy zostały wprowadzone w kodzie zamiast pliku XOML.</span><span class="sxs-lookup"><span data-stu-id="af963-426">For console hosting in WF3 the workflows were implemented in code instead of XOML.</span></span>  <span data-ttu-id="af963-427">W WF4 wartość domyślna jest użycie XAML.</span><span class="sxs-lookup"><span data-stu-id="af963-427">In WF4 the default is to use XAML.</span></span>  <span data-ttu-id="af963-428">XAML jest przechowywany jako zasobu osadzonego w zestawie i kompilowane w czasie wykonywania, aby zapewnić implementację przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-428">The XAML is stored as an embedded resource in the assembly and compiled during runtime to provide the implementation of the workflow.</span></span>  <span data-ttu-id="af963-429">Istnieje pewne nadmiarowe obciążenie związane z tym procesem.</span><span class="sxs-lookup"><span data-stu-id="af963-429">There is some overhead associated with this process.</span></span>  <span data-ttu-id="af963-430">W celu uczciwe porównanie WF3 WF4, kodowane przepływy pracy były używane zamiast XAML.</span><span class="sxs-lookup"><span data-stu-id="af963-430">In order to make a fair comparison between WF3 and WF4, coded workflows were used instead of XAML.</span></span>  <span data-ttu-id="af963-431">Na przykład jeden z przepływów pracy WF4 znajdują się poniżej:</span><span class="sxs-lookup"><span data-stu-id="af963-431">An example of one of the WF4 workflows is shown below:</span></span>

```csharp
public class Workflow1 : Activity
{
    protected override Func<Activity> Implementation
    {
        get
        {
            return new Func<Activity>(() =>
            {
                return new Sequence
                {
                    Activities = {
                        new Comment()
                    }
                };
            });
        }
        set
        {
            base.Implementation = value;
        }
    }
}
```

 <span data-ttu-id="af963-432">Istnieje wiele czynników, które mogą mieć wpływ na zużycie pamięci.</span><span class="sxs-lookup"><span data-stu-id="af963-432">There are many other factors that can affect memory consumption.</span></span> <span data-ttu-id="af963-433">Nadal mają zastosowanie tego samego wskazówki dotyczące wszystkich programów zarządzanych.</span><span class="sxs-lookup"><span data-stu-id="af963-433">The same advice for all managed programs still applies.</span></span>  <span data-ttu-id="af963-434">W środowiskach hostowanych przez usługi IIS <xref:System.ServiceModel.WorkflowServiceHost> obiekt utworzony dla definicji przepływu pracy pozostaje w pamięci, dopóki pula aplikacji zostanie odtworzona.</span><span class="sxs-lookup"><span data-stu-id="af963-434">In IIS-hosted environments, the <xref:System.ServiceModel.WorkflowServiceHost> object created for a workflow definition stays in memory until the application pool is recycled.</span></span>  <span data-ttu-id="af963-435">Powinna być ograniczona pamiętać podczas zapisywania rozszerzenia.</span><span class="sxs-lookup"><span data-stu-id="af963-435">This should be kept in mind when writing extensions.</span></span>  <span data-ttu-id="af963-436">Ponadto najlepiej jest uniknąć "global" zmienne (zmienne o zakresie do całego przepływu pracy) i ograniczyć zakres zmiennych, tam gdzie to możliwe.</span><span class="sxs-lookup"><span data-stu-id="af963-436">Also, it is best to avoid "global" variables (variables scoped to the whole workflow) and limit the scope of variables wherever possible.</span></span>

## <a name="workflow-runtime-services"></a><span data-ttu-id="af963-437">Usługi czasu wykonywania przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="af963-437">Workflow Runtime Services</span></span>

### <a name="persistence"></a><span data-ttu-id="af963-438">Stan trwały</span><span class="sxs-lookup"><span data-stu-id="af963-438">Persistence</span></span>
 <span data-ttu-id="af963-439">WF3 oraz WF4 zarówno dostarczane z dostawcy stanów trwałych programu SQL.</span><span class="sxs-lookup"><span data-stu-id="af963-439">WF3 and WF4 both ship with a SQL persistence provider.</span></span>  <span data-ttu-id="af963-440">Dostawcy stanów trwałych programu SQL WF3 jest proste wdrażanie, który serializuje wystąpienia przepływu pracy i zapisuje go w obiekcie blob.</span><span class="sxs-lookup"><span data-stu-id="af963-440">The WF3 SQL persistence provider is a simple implementation that serializes the workflow instance and stores it in a blob.</span></span>  <span data-ttu-id="af963-441">Z tego powodu wydajności tego dostawcy intensywnie zależna od rozmiaru wystąpienia przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-441">For this reason, the performance of this provider depends heavily on the size of the workflow instance.</span></span>  <span data-ttu-id="af963-442">W WF3 rozmiar wystąpienia może zwiększyć z wielu powodów, jak omówiono wcześniej w tym dokumencie.</span><span class="sxs-lookup"><span data-stu-id="af963-442">In WF3, the instance size could increase for many reasons, as is discussed previously in this paper.</span></span>  <span data-ttu-id="af963-443">Wielu klientów decyduje się nie należy używać domyślnego dostawcy stanów trwałych programu SQL, ponieważ przechowywania Zserializowany wystąpienie w bazie danych zapewniające nie wgląd w stan przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-443">Many customers choose not to use the default SQL persistence provider because storing a serialized instance in a database gives no visibility into the state of the workflow.</span></span>  <span data-ttu-id="af963-444">Aby można było znaleźć określonego przepływu pracy, nie wiedząc o tym identyfikator przepływu pracy, jeden musi deserializacji każdego utrwalonego wystąpienia i sprawdzać zawartość.</span><span class="sxs-lookup"><span data-stu-id="af963-444">In order to find a particular workflow without knowing the workflow id, one would have to deserialize each persisted instance and examine the contents.</span></span>  <span data-ttu-id="af963-445">Wielu programistów chce napisać własne dostawcy stanów trwałych, aby obejść ten problem.</span><span class="sxs-lookup"><span data-stu-id="af963-445">Many developers prefer to write their own persistence providers to overcome this obstacle.</span></span>

 <span data-ttu-id="af963-446">Dostawcy stanów trwałych programu SQL WF4 próbował rozwiązać niektóre z tych problemów.</span><span class="sxs-lookup"><span data-stu-id="af963-446">The WF4 SQL persistence provider has tried to address some of these concerns.</span></span>  <span data-ttu-id="af963-447">Tabele trwałości ujawnić pewne informacje, takie jak active zakładek i Awansowanie właściwości.</span><span class="sxs-lookup"><span data-stu-id="af963-447">The persistence tables expose certain information such as the active bookmarks and promotable properties.</span></span>  <span data-ttu-id="af963-448">Nowa funkcja korelacji na podstawie zawartości w WF4 nie przeprowadza się również za pomocą podejścia trwałości WF3 SQL ma opartych na niektóre zmiany w organizacji utrwalonego wystąpienia przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-448">The new content-based correlation feature in WF4 would not perform well using the WF3 SQL persistence approach, which has driven some change in the organization of the persisted workflow instance.</span></span>  <span data-ttu-id="af963-449">To sprawia, że dostawcy stanów trwałych bardziej złożone i umieszcza dodatkowe obciążenia w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="af963-449">This makes the job of the persistence provider more complex and puts extra stress on the database.</span></span>

### <a name="environment-setup"></a><span data-ttu-id="af963-450">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="af963-450">Environment Setup</span></span>
![Konfigurowanie środowiska dla testów wydajności przepływu pracy](./media/performance/performance-test-environment.gif)

### <a name="test-setup"></a><span data-ttu-id="af963-452">Testuj ustawienia</span><span class="sxs-lookup"><span data-stu-id="af963-452">Test Setup</span></span>
 <span data-ttu-id="af963-453">Nawet w przypadku zestawu funkcji ulepszone i lepsza obsługa współbieżności dostawcy stanów trwałych programu SQL w WF4 jest szybsze niż dostawcy w WF3.</span><span class="sxs-lookup"><span data-stu-id="af963-453">Even with an improved feature set and better concurrency handling, the SQL persistence provider in WF4 is faster than the provider in WF3.</span></span>  <span data-ttu-id="af963-454">Aby zaprezentować, to, dwa przepływy pracy, które wykonują głównie operacje WF3 i WF4 są porównywane poniżej.</span><span class="sxs-lookup"><span data-stu-id="af963-454">To showcase this, two workflows that perform essentially the same operations in WF3 and WF4 are compared below.</span></span>

 ![Trwałość przepływu pracy WF3 po lewej stronie i WF4 po prawej stronie](./media/performance/persist-workflow-wf3-wf4.gif)

 <span data-ttu-id="af963-456">Dwa przepływy pracy są tworzone przez odebranego komunikatu.</span><span class="sxs-lookup"><span data-stu-id="af963-456">The two workflows are both created by a received message.</span></span>  <span data-ttu-id="af963-457">Po wysłaniu odpowiedzi na wiadomość początkowej, przepływ pracy jest trwały.</span><span class="sxs-lookup"><span data-stu-id="af963-457">After sending an initial reply, the workflow is persisted.</span></span>  <span data-ttu-id="af963-458">W przypadku WF3 pustą <xref:System.Workflow.ComponentModel.TransactionScopeActivity> służy do inicjowania trwałości.</span><span class="sxs-lookup"><span data-stu-id="af963-458">In the WF3 case, an empty <xref:System.Workflow.ComponentModel.TransactionScopeActivity> is used to initiate the persistence.</span></span>  <span data-ttu-id="af963-459">Taki sam mógł zostać osiągnięty w WF3, oznaczając działanie jako "utrwalanie w pobliżu".</span><span class="sxs-lookup"><span data-stu-id="af963-459">The same could be achieved in WF3 by marking an activity as "persist on close."</span></span>  <span data-ttu-id="af963-460">Drugi skorelowany komunikat kończy przepływ pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-460">A second, correlated message completes the workflow.</span></span>  <span data-ttu-id="af963-461">Przepływy pracy są zachowywane, ale nie zostały załadowane.</span><span class="sxs-lookup"><span data-stu-id="af963-461">The workflows are persisted but not unloaded.</span></span>

### <a name="test-results"></a><span data-ttu-id="af963-462">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="af963-462">Test Results</span></span>
 ![Kolumna wykres przedstawiający przepływność trwałości](./media/performance/throughput-persistence-graph.gif)

 <span data-ttu-id="af963-464">Podczas transportu między klienta i warstwą środkową, jest protokół HTTP, trwałość WF4 wykazuje wzrost 2,6 razy.</span><span class="sxs-lookup"><span data-stu-id="af963-464">When the transport between client and middle tier is HTTP, persistence in WF4 shows an improvement of 2.6 times.</span></span>  <span data-ttu-id="af963-465">Warstwy transportowej TCP zwiększa ten współczynnik na czas 3.0.</span><span class="sxs-lookup"><span data-stu-id="af963-465">The TCP transport increases that factor to 3.0 times.</span></span>  <span data-ttu-id="af963-466">We wszystkich przypadkach, użycie procesora CPU w warstwie środkowej wynosi 98% lub nowszej.</span><span class="sxs-lookup"><span data-stu-id="af963-466">In all cases, CPU utilization on the middle tier is 98% or higher.</span></span>  <span data-ttu-id="af963-467">Przyczyna czy WF4 przepływność wynosi powyżej wynika z szybsze środowisko wykonawcze przepływów pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-467">The reason that WF4 throughput is greater is due to the faster workflow runtime.</span></span>  <span data-ttu-id="af963-468">Rozmiar wystąpienia serializacji brakuje w obu przypadkach i nie jest głównym elementem mającym swój wkład w takiej sytuacji.</span><span class="sxs-lookup"><span data-stu-id="af963-468">The size of the serialized instance is low for both cases and is not a major contributing element in this situation.</span></span>

 <span data-ttu-id="af963-469">WF3 i WF4 przepływów pracy w tym teście umożliwia jawnie wskazywać, kiedy stan trwały powinny być wykonywane działania.</span><span class="sxs-lookup"><span data-stu-id="af963-469">Both the WF3 and WF4 workflows in this test use an activity to explicitly indicate when persistence should occur.</span></span>  <span data-ttu-id="af963-470">To ma tę zaletę utrwalanie przepływu pracy bez rozładowywania go.</span><span class="sxs-lookup"><span data-stu-id="af963-470">This has the benefit of persisting the workflow without unloading it.</span></span>  <span data-ttu-id="af963-471">W WF3, jest również możliwe utrwalanie przy użyciu <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> funkcji, ale zwalnia wystąpienie przepływu pracy z pamięci.</span><span class="sxs-lookup"><span data-stu-id="af963-471">In WF3, it is also possible to persist using the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> feature, but this unloads the workflow instance from memory.</span></span>  <span data-ttu-id="af963-472">Jeśli Deweloper przy użyciu WF3 chce upewnij się, że przepływ pracy będzie nadal występował w pewnych punktach, albo muszą zmienić definicję przepływu pracy lub naliczana jest opłata za zwalniania i ponownego ładowania wystąpienia przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-472">If a developer using WF3 wants to make sure a workflow persists at certain points, they either have to alter the workflow definition or pay the cost for unloading and re-loading the workflow instance.</span></span>  <span data-ttu-id="af963-473">Nowa funkcja WF4 sprawia, że można utrwalić bez rozładowywania: <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>.</span><span class="sxs-lookup"><span data-stu-id="af963-473">A new feature in WF4 makes it possible to persist without unloading: <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>.</span></span>  <span data-ttu-id="af963-474">Ta funkcja umożliwia wystąpienie przepływu pracy utrwalone w stanie bezczynności, ale pozostanie w pamięci, dopóki <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> osiągnięty jest próg lub wykonanie zostanie wznowione.</span><span class="sxs-lookup"><span data-stu-id="af963-474">This feature allows the workflow instance to be persisted on idle but stay in memory until the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> threshold is met or execution is resumed.</span></span>

 <span data-ttu-id="af963-475">Należy pamiętać, że dostawcy stanów trwałych programu SQL WF4 wykonuje więcej pracy w warstwie bazy danych.</span><span class="sxs-lookup"><span data-stu-id="af963-475">Note that the WF4 SQL persistence provider performs more work in the database tier.</span></span>  <span data-ttu-id="af963-476">Bazy danych SQL może stać się wąskim gardłem tak ważne jest, aby monitorować istnieje użycie Procesora i dysku.</span><span class="sxs-lookup"><span data-stu-id="af963-476">The SQL database can become a bottleneck so it is important to monitor the CPU and disk usage there.</span></span>  <span data-ttu-id="af963-477">Należy uwzględnić następujące liczniki wydajności z SQL, bazy danych podczas testowania aplikacji przepływu pracy:</span><span class="sxs-lookup"><span data-stu-id="af963-477">Be sure to include the following performance counters from the SQL database when performance testing workflow applications:</span></span>

- <span data-ttu-id="af963-478">Dysk fizyczny\\czas odczytu z dysku %</span><span class="sxs-lookup"><span data-stu-id="af963-478">PhysicalDisk\\%Disk Read Time</span></span>

- <span data-ttu-id="af963-479">Dysk fizyczny\\czas dysku (%)</span><span class="sxs-lookup"><span data-stu-id="af963-479">PhysicalDisk\\% Disk Time</span></span>

- <span data-ttu-id="af963-480">Dysk fizyczny\\czas zapisu dysku %</span><span class="sxs-lookup"><span data-stu-id="af963-480">PhysicalDisk\\% Disk Write Time</span></span>

- <span data-ttu-id="af963-481">Dysk fizyczny\\% średni Długość kolejki dysku</span><span class="sxs-lookup"><span data-stu-id="af963-481">PhysicalDisk\\% Avg. Disk Queue Length</span></span>

- <span data-ttu-id="af963-482">Dysk Fizyczny\średni Długość kolejki odczytu dysku</span><span class="sxs-lookup"><span data-stu-id="af963-482">PhysicalDisk\Avg. Disk Read Queue Length</span></span>

- <span data-ttu-id="af963-483">Dysk Fizyczny\średni Długość kolejki zapisu dysku</span><span class="sxs-lookup"><span data-stu-id="af963-483">PhysicalDisk\Avg. Disk Write Queue Length</span></span>

- <span data-ttu-id="af963-484">Długość kolejki dysku PhysicalDisk\Current</span><span class="sxs-lookup"><span data-stu-id="af963-484">PhysicalDisk\Current Disk Queue Length</span></span>

- <span data-ttu-id="af963-485">Informacje o procesorze\\czas procesora (%)</span><span class="sxs-lookup"><span data-stu-id="af963-485">Processor Information\\% Processor Time</span></span>

- <span data-ttu-id="af963-486">Czas oczekiwania zatrzaśnięcia SQLServer:Latches\Average (ms)</span><span class="sxs-lookup"><span data-stu-id="af963-486">SQLServer:Latches\Average Latch Wait Time (ms)</span></span>

- <span data-ttu-id="af963-487">SQLServer:Latches\Latch Waits/sec</span><span class="sxs-lookup"><span data-stu-id="af963-487">SQLServer:Latches\Latch Waits/sec</span></span>

### <a name="tracking"></a><span data-ttu-id="af963-488">Śledzenie</span><span class="sxs-lookup"><span data-stu-id="af963-488">Tracking</span></span>
 <span data-ttu-id="af963-489">Śledzenie przepływu pracy może służyć do śledzenia postępu dla przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-489">Workflow tracking can be used to track the progress of a workflow.</span></span>  <span data-ttu-id="af963-490">Informacje, które są objęte zdarzeń śledzenia jest ustalany profilu śledzenia.</span><span class="sxs-lookup"><span data-stu-id="af963-490">The information that is included in the tracking events is determined by a tracking profile.</span></span>  <span data-ttu-id="af963-491">Bardziej złożone staje się profilu śledzenia śledzenia bardziej kosztowne.</span><span class="sxs-lookup"><span data-stu-id="af963-491">The more complex the tracking profile, the more expensive tracking becomes.</span></span>

 <span data-ttu-id="af963-492">WF3 dostarczanych z usługą SQL na podstawie śledzenia.</span><span class="sxs-lookup"><span data-stu-id="af963-492">WF3 shipped with a SQL-based tracking service.</span></span>  <span data-ttu-id="af963-493">Ta usługa może pracować w trybie wsadowej i -przetwarzanej.</span><span class="sxs-lookup"><span data-stu-id="af963-493">This service could work in batched and non-batched modes.</span></span>  <span data-ttu-id="af963-494">W trybie-przetwarzanej zdarzenia śledzenia są zapisywane bezpośrednio w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="af963-494">In non-batched mode, tracking events are written directly to the database.</span></span>  <span data-ttu-id="af963-495">W trybie wsadowej zdarzenia śledzenia są zbierane w tej samej partii jako stan wystąpienia przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-495">In batched mode, tracking events are collected into the same batch as the workflow instance state.</span></span>  <span data-ttu-id="af963-496">Tryb wsadowej ma lepszą wydajność dla najszerszą gamę projekty przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-496">The batched mode has the best performance for the widest range of workflow designs.</span></span>  <span data-ttu-id="af963-497">Jednak przetwarzanie wsadowe może mieć negatywny wpływ na wydajność, jeśli wiele działań wykonywania przepływu pracy bez utrwalanie i te działania są śledzone.</span><span class="sxs-lookup"><span data-stu-id="af963-497">However, batching can have a negative performance impact if the workflow runs many activities without persisting and those activities are tracked.</span></span>  <span data-ttu-id="af963-498">To sytuacja często może mieć miejsce w pętli, a najlepszym sposobem uniknięcia tego scenariusza jest zaprojektowanie dużą pętli, aby zawierać punkt stanu trwałego.</span><span class="sxs-lookup"><span data-stu-id="af963-498">This would commonly happen in loops and the best way to avoid this scenario is to design large loops to contain a persistence point.</span></span>  <span data-ttu-id="af963-499">Wprowadzenie do punktu stanu trwałego w pętli może negatywnie wpłynąć na również pod względem wydajności, więc jest ważne, aby zmierzyć koszty każdego z nich i stworzyć równowagi.</span><span class="sxs-lookup"><span data-stu-id="af963-499">Introducing a persistence point into a loop can negatively affect performance as well so it is important to measure the costs of each and come up with a balance.</span></span>

 <span data-ttu-id="af963-500">WF4 nie jest dostarczany z usługi śledzenia SQL.</span><span class="sxs-lookup"><span data-stu-id="af963-500">WF4 is not shipped with a SQL tracking service.</span></span>  <span data-ttu-id="af963-501">Nagrywanie informacje śledzenia bazą danych SQL można być lepszego obsługiwane z serwera aplikacji zamiast wbudowana w programie .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="af963-501">Recording tracking information to a SQL database can be handled better from an application server rather than built into the .NET Framework.</span></span> <span data-ttu-id="af963-502">W związku z tym śledzenie SQL jest teraz obsługiwane przez rozwiązania AppFabric.</span><span class="sxs-lookup"><span data-stu-id="af963-502">Therefore SQL tracking is now handled by AppFabric.</span></span>  <span data-ttu-id="af963-503">Dostawcy śledzenia poza pole w WF4 opiera się na śledzenie zdarzeń dla Windows (ETW).</span><span class="sxs-lookup"><span data-stu-id="af963-503">The out-of-the-box tracking provider in WF4 is based on Event Tracing for Windows (ETW).</span></span>

 <span data-ttu-id="af963-504">ETW to system zdarzeń w poziomie jądra i niskim opóźnieniu wbudowane w Windows.</span><span class="sxs-lookup"><span data-stu-id="af963-504">ETW is a kernel-level, low-latency event system built into Windows.</span></span>  <span data-ttu-id="af963-505">Używa modelu dostawcy i odbiorcy, który sprawia, że można tylko pociągnąć za sobą spadek do śledzenia zdarzeń po faktycznie konsumenta.</span><span class="sxs-lookup"><span data-stu-id="af963-505">It uses a provider/consumer model that makes it possible to only incur the penalty for event tracing when there is actually a consumer.</span></span>  <span data-ttu-id="af963-506">Oprócz zdarzeń jądra, np. procesora, dysku, pamięci i użycie sieci wiele aplikacji oraz korzystać z funkcji ETW.</span><span class="sxs-lookup"><span data-stu-id="af963-506">In addition to kernel events such as processor, disk, memory, and network usage, many applications leverage ETW as well.</span></span>  <span data-ttu-id="af963-507">Zdarzenia ETW są bardziej wydajne niż liczników wydajności, zdarzenia, które można dostosować do aplikacji.</span><span class="sxs-lookup"><span data-stu-id="af963-507">ETW events are more powerful than performance counters in that events can be customized to the application.</span></span>  <span data-ttu-id="af963-508">Zdarzenie może zawierać tekst, takie jak identyfikator przepływu pracy lub komunikat informacyjny.</span><span class="sxs-lookup"><span data-stu-id="af963-508">An event can contain text such as a workflow ID or an informational message.</span></span>  <span data-ttu-id="af963-509">Ponadto zdarzenia są skategoryzowane przy użyciu masek bitowych, tak aby używania tylko podzbiór zdarzeń mają mniej wpływ na wydajność, niż przechwytywania wszystkich zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="af963-509">Also, events are categorized with bitmasks so that consuming a certain subset of events will have less performance impact than capturing all events.</span></span>

 <span data-ttu-id="af963-510">Podejście za pomocą funkcji ETW śledzenia zamiast SQL korzyści:</span><span class="sxs-lookup"><span data-stu-id="af963-510">Benefits to the approach of using ETW for tracking instead of SQL include:</span></span>

- <span data-ttu-id="af963-511">Kolekcja zdarzenia śledzenia mogą być oddzielone do innego procesu.</span><span class="sxs-lookup"><span data-stu-id="af963-511">Collection of tracking events can be separated to another process.</span></span>  <span data-ttu-id="af963-512">Daje to większą elastyczność w jaki sposób są rejestrowane zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="af963-512">This gives greater flexibility in how the events are recorded.</span></span>

- <span data-ttu-id="af963-513">Zdarzenia śledzenia ETW łatwo są połączone z zdarzenia WCF ETW lub innych dostawców ETW, takiego jak dostawca programu SQL Server lub jądra.</span><span class="sxs-lookup"><span data-stu-id="af963-513">ETW tracking events are easily combined with the WCF ETW events or other ETW providers such as a SQL Server or kernel provider.</span></span>

- <span data-ttu-id="af963-514">Autorzy przepływu pracy nie trzeba zmienić przepływ pracy do lepszą współpracę z implementacją określonego śledzenia, takie jak Usługa śledzenia WF3 SQL trybie wsadowym.</span><span class="sxs-lookup"><span data-stu-id="af963-514">Workflow authors do not need to alter a workflow to work better with a particular tracking implementation, such as the WF3 SQL tracking service’s batch mode.</span></span>

- <span data-ttu-id="af963-515">Administrator może włączyć śledzenie lub wyłączyć bez odtwarzania procesu hosta.</span><span class="sxs-lookup"><span data-stu-id="af963-515">An administrator can turn tracking on or off without recycling the host process.</span></span>

 <span data-ttu-id="af963-516">Korzyści w zakresie wydajności do śledzenia zdarzeń systemu Windows są dostarczane z systemem zwrotu.</span><span class="sxs-lookup"><span data-stu-id="af963-516">The performance benefits to ETW tracking come with a drawback.</span></span>  <span data-ttu-id="af963-517">Zdarzenia ETW mogą zostać utracone, jeśli system jest w dużym natężeniu zasobu.</span><span class="sxs-lookup"><span data-stu-id="af963-517">ETW events can be lost if the system is under intense resource pressure.</span></span>  <span data-ttu-id="af963-518">Przetwarzanie zdarzeń nie jest przeznaczona do blokowania normalnego działania programu i dlatego nie ma żadnej gwarancji, wszystkie zdarzenia ETW zostanie emisji do subskrybentów.</span><span class="sxs-lookup"><span data-stu-id="af963-518">The processing of events is not meant to block normal program execution and therefore it is not guaranteed that all ETW events will be broadcast to their subscribers.</span></span>  <span data-ttu-id="af963-519">To sprawia, że śledzenie zdarzeń systemu Windows idealne narzędzie do monitorowania kondycji, ale nie nadaje się do inspekcji.</span><span class="sxs-lookup"><span data-stu-id="af963-519">This makes ETW tracking great for health monitoring but not suitable for auditing.</span></span>

 <span data-ttu-id="af963-520">Gdy WF4 nie ma dostawcy śledzenia bazy danych SQL, wykonuje AppFabric.</span><span class="sxs-lookup"><span data-stu-id="af963-520">While WF4 does not have a SQL tracking provider, AppFabric does.</span></span>  <span data-ttu-id="af963-521">Podejście śledzenia SQL w AppFabric jest do subskrybowania zdarzenia ETW za pomocą usługi Windows, która partii zdarzeń i zapisuje je do tabeli SQL przeznaczony do wstawienia szybkie.</span><span class="sxs-lookup"><span data-stu-id="af963-521">AppFabric’s SQL tracking approach is to subscribe to ETW events with a Windows Service that batches the events and writes them to a SQL table designed for quick inserts.</span></span>  <span data-ttu-id="af963-522">Jako osobne zadanie wstrzymanie danych z tej tabeli i reforms go do tabel, które mogą być wyświetlane na pulpicie nawigacyjnym rozwiązania AppFabric raportowania.</span><span class="sxs-lookup"><span data-stu-id="af963-522">A separate job drains the data from this table and reforms it into reporting tables that can be viewed on the AppFabric dashboard.</span></span>  <span data-ttu-id="af963-523">Oznacza to, że partii śledzenia zdarzeń odbywa się niezależnie od przepływu pracy, pochodzi z i w związku z tym nie trzeba czekać na punkcie trwałości przed rejestrowane.</span><span class="sxs-lookup"><span data-stu-id="af963-523">This means that a batch of tracking events is handled independent of the workflow it came from and therefore does not have to wait for a persistence point before being recorded.</span></span>

 <span data-ttu-id="af963-524">Zdarzenia ETW mogą być rejestrowane za pomocą narzędzi takich jak logman lub narzędzia xperf.</span><span class="sxs-lookup"><span data-stu-id="af963-524">ETW events can be recorded with tools such as logman or xperf.</span></span>  <span data-ttu-id="af963-525">Można wyświetlić za pomocą narzędzia, takiego jak xperfview lub przekonwertowane na bardziej czytelnym formacie, takich jak XML, za pomocą tracerpt compact pliku ETL.</span><span class="sxs-lookup"><span data-stu-id="af963-525">The compact ETL file can be viewed with a tool like xperfview or converted to a more readable format, such as XML, with tracerpt.</span></span>  <span data-ttu-id="af963-526">W WF3 jedyną opcją, w celu uzyskania śledzenia zdarzeń, bez bazy danych SQL jest tworzenie niestandardowe śledzenia usługi.</span><span class="sxs-lookup"><span data-stu-id="af963-526">In WF3, the only option for getting tracking events without a SQL database is to create a custom tracking service.</span></span> <span data-ttu-id="af963-527">Aby uzyskać więcej informacji na temat funkcji ETW, zobacz [usługi WCF i zdarzenia śledzenia dla Windows](../wcf/samples/wcf-services-and-event-tracing-for-windows.md) i [śledzenie zdarzeń — aplikacje Windows](/windows/desktop/etw/event-tracing-portal).</span><span class="sxs-lookup"><span data-stu-id="af963-527">For more information about ETW, see [WCF Services and Event Tracing for Windows](../wcf/samples/wcf-services-and-event-tracing-for-windows.md) and [Event Tracing - Windows applications](/windows/desktop/etw/event-tracing-portal).</span></span>

 <span data-ttu-id="af963-528">Włączanie śledzenia przepływu pracy wpływają na wydajność w różnym stopniu.</span><span class="sxs-lookup"><span data-stu-id="af963-528">Enabling workflow tracking will impact performance in varying degrees.</span></span>  <span data-ttu-id="af963-529">Test porównawczy poniżej używa narzędzia logman do wykorzystania funkcji ETW śledzenia zdarzeń i zarejestruj je w pliku ETL.</span><span class="sxs-lookup"><span data-stu-id="af963-529">The benchmark below uses the logman tool to consume the ETW tracking events and record them to an ETL file.</span></span>  <span data-ttu-id="af963-530">Koszt SQL śledzenia w AppFabric nie znajduje się w zakresie tego artykułu.</span><span class="sxs-lookup"><span data-stu-id="af963-530">The cost of the SQL tracking in AppFabric is not in the scope of this article.</span></span>  <span data-ttu-id="af963-531">Profil śledzenia podstawowego, używany również w AppFabric, jest wyświetlany w tym testów porównawczych.</span><span class="sxs-lookup"><span data-stu-id="af963-531">The basic tracking profile, also used in AppFabric, is shown in this benchmark.</span></span>  <span data-ttu-id="af963-532">Również obejmuje koszt śledzenia tylko zdarzeń monitorowania kondycji.</span><span class="sxs-lookup"><span data-stu-id="af963-532">Also included is the cost of tracking only health monitoring events.</span></span>  <span data-ttu-id="af963-533">Zdarzenia te są przydatne do rozwiązywania problemów i określania średniej przepływności systemu.</span><span class="sxs-lookup"><span data-stu-id="af963-533">These events are useful for troubleshooting problems and determining the average throughput of the system.</span></span>

### <a name="environment-setup"></a><span data-ttu-id="af963-534">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="af963-534">Environment Setup</span></span>
 ![Konfigurowanie środowiska dla testów wydajności przepływu pracy](./media/performance/performance-test-environment.gif)

### <a name="test-results"></a><span data-ttu-id="af963-536">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="af963-536">Test Results</span></span>

 ![Wykres kolumnowy przedstawiający koszty śledzenia przepływu pracy](./media/performance/workflow-tracking-costs.gif)

 <span data-ttu-id="af963-538">Monitorowanie kondycji ma około 3% wpływ na przepustowość.</span><span class="sxs-lookup"><span data-stu-id="af963-538">Health monitoring has roughly a 3% impact on throughput.</span></span>  <span data-ttu-id="af963-539">Koszt profilu podstawowego jest około 8%.</span><span class="sxs-lookup"><span data-stu-id="af963-539">The basic profile’s cost is around 8%.</span></span>

## <a name="interop"></a><span data-ttu-id="af963-540">Interop</span><span class="sxs-lookup"><span data-stu-id="af963-540">Interop</span></span>
 <span data-ttu-id="af963-541">WF4 jest niemal ukończone nadpisania [!INCLUDE[wf1](../../../includes/wf1-md.md)] i w związku z tym WF3 przepływów pracy i działań nie są bezpośrednio zgodne z WF4.</span><span class="sxs-lookup"><span data-stu-id="af963-541">WF4 is almost a complete rewrite of [!INCLUDE[wf1](../../../includes/wf1-md.md)] and therefore WF3 workflows and activities are not directly compatible with WF4.</span></span>  <span data-ttu-id="af963-542">Wielu klientów, które wcześniej przyjęte Windows Workflow Foundation mają definicji przepływu pracy wewnętrznymi lub innych firm i niestandardowych działań dla WF3.</span><span class="sxs-lookup"><span data-stu-id="af963-542">Many customers that adopted Windows Workflow Foundation early will have in-house or third-party workflow definitions and custom activities for WF3.</span></span>  <span data-ttu-id="af963-543">Jednym ze sposobów, aby ułatwić przejście na WF4 jest użyć międzyoperacyjny działania, które można wykonać działania WF3 z WF4 przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="af963-543">One way to ease the transition to WF4 is to use the Interop activity, which can execute WF3 activities from within a WF4 workflow.</span></span>  <span data-ttu-id="af963-544">Zalecane jest, <xref:System.Activities.Statements.Interop> działania można używać tylko gdy jest to konieczne.</span><span class="sxs-lookup"><span data-stu-id="af963-544">It is recommended that the <xref:System.Activities.Statements.Interop> activity only be used when necessary.</span></span> <span data-ttu-id="af963-545">Aby uzyskać więcej informacji na temat migracji do WF4 zapoznaj się z [wskazówek dotyczących migracji WF4](https://go.microsoft.com/fwlink/?LinkID=153313).</span><span class="sxs-lookup"><span data-stu-id="af963-545">For more information about migrating to WF4 check out the [WF4 Migration Guidance](https://go.microsoft.com/fwlink/?LinkID=153313).</span></span>

### <a name="environment-setup"></a><span data-ttu-id="af963-546">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="af963-546">Environment Setup</span></span>
 ![Konfigurowanie środowiska dla testów wydajności przepływu pracy](./media/performance/performance-test-environment.gif)

### <a name="test-results"></a><span data-ttu-id="af963-548">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="af963-548">Test Results</span></span>
 
<span data-ttu-id="af963-549">W poniższej tabeli przedstawiono wyniki działania przepływu pracy zawierający pięciu działań w Sekwencje w różnych konfiguracjach.</span><span class="sxs-lookup"><span data-stu-id="af963-549">The following table shows the results of running a workflow containing five activities in a sequence in various configurations.</span></span>

|<span data-ttu-id="af963-550">Test</span><span class="sxs-lookup"><span data-stu-id="af963-550">Test</span></span>|<span data-ttu-id="af963-551">Przepływność (przepływy pracy/s)</span><span class="sxs-lookup"><span data-stu-id="af963-551">Throughput (workflows/sec)</span></span>|
|----------|-----------------------------------|
|<span data-ttu-id="af963-552">Sekwencja WF3 w środowisku uruchomieniowym WF3</span><span class="sxs-lookup"><span data-stu-id="af963-552">WF3 Sequence in WF3 runtime</span></span>|<span data-ttu-id="af963-553">1,576</span><span class="sxs-lookup"><span data-stu-id="af963-553">1,576</span></span>|
|<span data-ttu-id="af963-554">Sekwencja WF3 w środowisku uruchomieniowym WF4 za pomocą międzyoperacyjności</span><span class="sxs-lookup"><span data-stu-id="af963-554">WF3 Sequence in WF4 runtime using Interop</span></span>|<span data-ttu-id="af963-555">2,745</span><span class="sxs-lookup"><span data-stu-id="af963-555">2,745</span></span>|
|<span data-ttu-id="af963-556">Sekwencja WF4</span><span class="sxs-lookup"><span data-stu-id="af963-556">WF4 Sequence</span></span>|<span data-ttu-id="af963-557">153,582</span><span class="sxs-lookup"><span data-stu-id="af963-557">153,582</span></span>|

 <span data-ttu-id="af963-558">Zwiększenie wydajności istotne za pomocą międzyoperacyjności za pośrednictwem prostej WF3 nie istnieje.</span><span class="sxs-lookup"><span data-stu-id="af963-558">There is a notable performance increase to using Interop over straight WF3.</span></span>  <span data-ttu-id="af963-559">Jednak gdy porównywana WF4 działań, zwiększenie jest niewielki.</span><span class="sxs-lookup"><span data-stu-id="af963-559">However, when compared against WF4 activities, the increase is negligible.</span></span>

## <a name="summary"></a><span data-ttu-id="af963-560">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="af963-560">Summary</span></span>
 <span data-ttu-id="af963-561">Dużych inwestycji w wydajności WF4 zapłaciły w wielu obszarach niezwykle istotne.</span><span class="sxs-lookup"><span data-stu-id="af963-561">Heavy investments in performance for WF4 have paid off in many crucial areas.</span></span>  <span data-ttu-id="af963-562">Wydajność składników określonego przepływu pracy jest w niektórych przypadkach kilkaset razy szybszy w WF4 w porównaniu do WF3 ze względu na bardziej oszczędny [!INCLUDE[wf1](../../../includes/wf1-md.md)] środowiska uruchomieniowego.</span><span class="sxs-lookup"><span data-stu-id="af963-562">Individual workflow component performance is in some cases hundreds of times faster in WF4 compared to WF3 due to a leaner [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="af963-563">Opóźnienie liczb są również znacznie lepszą.</span><span class="sxs-lookup"><span data-stu-id="af963-563">Latency numbers are significantly better as well.</span></span>  <span data-ttu-id="af963-564">To oznacza spadek wydajności przy użyciu [!INCLUDE[wf1](../../../includes/wf1-md.md)] w przeciwieństwie do programowania ręcznego aranżacji WCF jest bardzo mały, biorąc pod uwagę oraz dodatkowe zalety korzystania z usług [!INCLUDE[wf1](../../../includes/wf1-md.md)].</span><span class="sxs-lookup"><span data-stu-id="af963-564">This means the performance penalty for using [!INCLUDE[wf1](../../../includes/wf1-md.md)] as opposed to hand-coding WCF orchestration services is very small considering the added benefits of using [!INCLUDE[wf1](../../../includes/wf1-md.md)].</span></span>  <span data-ttu-id="af963-565">Trwałość wydajności został zwiększony współczynnik 3.0 2.5.</span><span class="sxs-lookup"><span data-stu-id="af963-565">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="af963-566">Monitorowanie kondycji za pomocą przepływu pracy śledzenia teraz ma niewielkim zapasem.</span><span class="sxs-lookup"><span data-stu-id="af963-566">Health monitoring by means of workflow tracking now has very little overhead.</span></span>  <span data-ttu-id="af963-567">Kompleksowy zestaw przewodniki dotyczące migracji są dostępne dla osób, które rozważają przenoszenie z WF3 do WF4.</span><span class="sxs-lookup"><span data-stu-id="af963-567">A comprehensive set of migration guides are available for those that are considering moving from WF3 to WF4.</span></span>  <span data-ttu-id="af963-568">Wszystkie te powinny być WF4 atrakcyjną opcję do tworzenia złożonych aplikacji.</span><span class="sxs-lookup"><span data-stu-id="af963-568">All of this should make WF4 an attractive option for writing complex applications.</span></span>
