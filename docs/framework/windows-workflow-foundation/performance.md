---
title: Wydajność programu Windows Workflow Foundation 4
description: W tym artykule wyjaśniono charakterystykę wydajności głównej wersji Windows Workflow Foundation, która jest częścią .NET Framework 4.
ms.date: 03/30/2017
ms.assetid: 67d2b3e8-3777-49f8-9084-abbb33b5a766
ms.openlocfilehash: 1ad12d9fd69205bde726fe650a2ec28ba6c750ef
ms.sourcegitcommit: 27a15a55019f6b5f2733961738babe94aec0def3
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 09/15/2020
ms.locfileid: "90558345"
---
# <a name="windows-workflow-foundation-4-performance"></a><span data-ttu-id="9c1b0-103">Wydajność programu Windows Workflow Foundation 4</span><span class="sxs-lookup"><span data-stu-id="9c1b0-103">Windows Workflow Foundation 4 Performance</span></span>

 <span data-ttu-id="9c1b0-104">.NET Framework 4 obejmuje poważną poprawkę Windows Workflow Foundation (WF) z ciężkimi inwestycjami w wydajność.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-104">.NET Framework 4 includes a major revision of the Windows Workflow Foundation (WF) with heavy investments in performance.</span></span> <span data-ttu-id="9c1b0-105">Ta nowa poprawka wprowadza istotne zmiany projektowe z poprzednich wersji programu [!INCLUDE[wf1](../../../includes/wf1-md.md)] , które zostały dostarczone w ramach .NET Framework 3,0 i .NET Framework 3,5.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-105">This new revision introduces significant design changes from the previous versions of [!INCLUDE[wf1](../../../includes/wf1-md.md)] that shipped as part of .NET Framework 3.0 and .NET Framework 3.5.</span></span> <span data-ttu-id="9c1b0-106">Został on jeszcze zaprojektowany z myślą o rozbudowaniu modelu programowania, środowiska uruchomieniowego i narzędzi, aby znacznie poprawić wydajność i użyteczność.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-106">It has been re-architected from the core of the programming model, runtime, and tooling to greatly improve performance and usability.</span></span> <span data-ttu-id="9c1b0-107">W tym temacie przedstawiono ważne cechy wydajności tych poprawek i porównuje je z poprzednimi wersjami.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-107">This topic shows the important performance characteristics of these revisions and compares them against those of the previous version.</span></span>

 <span data-ttu-id="9c1b0-108">Wydajność poszczególnych składników przepływu pracy zwiększyła się o kolejność wielkości między WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-108">Individual workflow component performance has increased by orders of magnitude between WF3 and WF4.</span></span>  <span data-ttu-id="9c1b0-109">Spowoduje to pozostawienie przerwy między kodowanymi ręcznie usługami Windows Communication Foundation (WCF) i usługi przepływu pracy WCF, aby były dość małe.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-109">This leaves the gap between hand-coded Windows Communication Foundation (WCF) services and WCF workflow services to be quite small.</span></span>  <span data-ttu-id="9c1b0-110">Opóźnienie przepływu pracy zostało znacznie zmniejszone w WF4.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-110">Workflow latency has been significantly reduced in WF4.</span></span>  <span data-ttu-id="9c1b0-111">Wydajność trwałości wzrosła przez współczynnik 2,5-3,0.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-111">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="9c1b0-112">Monitorowanie kondycji przy użyciu śledzenia przepływu pracy ma znacznie mniej obciążenia.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-112">Health monitoring by means of workflow tracking has significantly less overhead.</span></span>  <span data-ttu-id="9c1b0-113">Są to przydatne powody do migracji lub przyjęcia WF4 w aplikacjach.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-113">These are compelling reasons to migrate to or adopt WF4 in your applications.</span></span>

## <a name="terminology"></a><span data-ttu-id="9c1b0-114">Terminologia</span><span class="sxs-lookup"><span data-stu-id="9c1b0-114">Terminology</span></span>

 <span data-ttu-id="9c1b0-115">Wersja [!INCLUDE[wf1](../../../includes/wf1-md.md)] wprowadzona w .NET Framework 4 będzie określana jako WF4 w pozostałej części tego tematu.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-115">The version of [!INCLUDE[wf1](../../../includes/wf1-md.md)] introduced in .NET Framework 4 will be referred to as WF4 for the rest of this topic.</span></span> [!INCLUDE[wf1](../../../includes/wf1-md.md)] <span data-ttu-id="9c1b0-116">wprowadzono w .NET Framework 3,0 i wprowadzono kilka drobnych poprawek za pomocą .NET Framework 3,5 z dodatkiem SP1.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-116">was introduced in .NET Framework 3.0 and had a few minor revisions through .NET Framework 3.5 SP1.</span></span> <span data-ttu-id="9c1b0-117">Wersja .NET Framework 3,5 programu Workflow Foundation będzie określana jako WF3 w pozostałej części tego tematu.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-117">The .NET Framework 3.5 version of Workflow Foundation will be referred to as WF3 for the rest of this topic.</span></span> <span data-ttu-id="9c1b0-118">WF3 jest dostarczany w .NET Framework 4 obok WF4.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-118">WF3 is shipped in .NET Framework 4 side-by-side with WF4.</span></span> <span data-ttu-id="9c1b0-119">Aby uzyskać więcej informacji na temat migrowania artefaktów WF3 do WF4, zobacz: [Przewodnik migracji Windows Workflow Foundation 4](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="9c1b0-119">For more information about migrating WF3 artifacts to WF4 see: [Windows Workflow Foundation 4 Migration Guide](migration-guidance.md).</span></span>

 <span data-ttu-id="9c1b0-120">Windows Communication Foundation (WCF) to ujednolicony model programowania firmy Microsoft służący do tworzenia aplikacji zorientowanych na usługę.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-120">Windows Communication Foundation (WCF) is Microsoft’s unified programming model for building service-oriented applications.</span></span> <span data-ttu-id="9c1b0-121">Najpierw została wprowadzona jako część programu .NET 3,0 wraz z WF3 i teraz jest jednym z najważniejszych składników .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-121">It was first introduced as part of .NET 3.0 together with WF3 and now is one of the key components of the .NET Framework.</span></span>

 <span data-ttu-id="9c1b0-122">Windows Server AppFabric to zestaw zintegrowanych technologii, które ułatwiają tworzenie, skalowanie i zarządzanie aplikacjami sieci Web i złożonymi, które działają w usługach IIS.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-122">Windows Server AppFabric is a set of integrated technologies that make it easier to build, scale and manage Web and composite applications that run on IIS.</span></span> <span data-ttu-id="9c1b0-123">Zapewnia narzędzia do monitorowania usług i przepływów pracy oraz zarządzania nimi.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-123">It provides tools for monitoring and managing services and workflows.</span></span> <span data-ttu-id="9c1b0-124">Aby uzyskać więcej informacji, zobacz [Windows Server AppFabric 1,0](/previous-versions/appfabric/ff384253(v=azure.10)).</span><span class="sxs-lookup"><span data-stu-id="9c1b0-124">For more information, see [Windows Server AppFabric 1.0](/previous-versions/appfabric/ff384253(v=azure.10)).</span></span>

## <a name="goals"></a><span data-ttu-id="9c1b0-125">Cele</span><span class="sxs-lookup"><span data-stu-id="9c1b0-125">Goals</span></span>
 <span data-ttu-id="9c1b0-126">Celem tego tematu jest przedstawienie charakterystyki wydajności WF4 z danymi mierzonymi dla różnych scenariuszy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-126">The goal of this topic is to show the performance characteristics of WF4 with data measured for different scenarios.</span></span> <span data-ttu-id="9c1b0-127">Zawiera również szczegółowe porównania między WF4 i WF3, a tym samym przedstawia doskonałe ulepszenia, które zostały wprowadzone w tej nowej wersji.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-127">It also provides detailed comparisons between WF4 and WF3, and thus shows the great improvements that have been made in this new revision.</span></span> <span data-ttu-id="9c1b0-128">Scenariusze i dane przedstawione w tym artykule określają bazowy koszt różnych aspektów WF4 i WF3.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-128">The scenarios and data presented in this article quantify the underlying cost of different aspects of WF4 and WF3.</span></span> <span data-ttu-id="9c1b0-129">Te dane są przydatne w zrozumieniu charakterystyki wydajności WF4 i mogą być przydatne w planowaniu migracji z WF3 do WF4 lub przy użyciu WF4 podczas opracowywania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-129">This data is useful in understanding the performance characteristics of WF4 and can be helpful in planning migrations from WF3 to WF4 or using WF4 in application development.</span></span> <span data-ttu-id="9c1b0-130">Należy jednak zadbać o to, aby pochodziły z danych przedstawionych w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-130">However, care should be taken in the conclusions drawn from the data presented in this article.</span></span> <span data-ttu-id="9c1b0-131">Wydajność aplikacji złożonego przepływu pracy jest wysoce zależna od implementacji przepływu pracy i sposobu integrowania różnych składników.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-131">The performance of a composite workflow application is highly dependent on how the workflow is implemented and how different components are integrated.</span></span> <span data-ttu-id="9c1b0-132">Jeden musi mierzyć każdą aplikację, aby określić charakterystykę wydajności tej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-132">One must measure each application to determine the performance characteristics of that application.</span></span>

## <a name="overview-of-wf4-performance-enhancements"></a><span data-ttu-id="9c1b0-133">Omówienie ulepszeń wydajności WF4</span><span class="sxs-lookup"><span data-stu-id="9c1b0-133">Overview of WF4 Performance Enhancements</span></span>
 <span data-ttu-id="9c1b0-134">WF4 został starannie zaprojektowany i wdrożony z wysoką wydajnością i skalowalnością, które opisano w poniższych sekcjach.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-134">WF4 was carefully designed and implemented with high performance and scalability which are described in the following sections.</span></span>

### <a name="wf-runtime"></a><span data-ttu-id="9c1b0-135">Środowisko uruchomieniowe WF</span><span class="sxs-lookup"><span data-stu-id="9c1b0-135">WF Runtime</span></span>
 <span data-ttu-id="9c1b0-136">Rdzeń [!INCLUDE[wf1](../../../includes/wf1-md.md)] środowiska uruchomieniowego to asynchroniczny harmonogram, który umożliwia wykonywanie działań w przepływie pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-136">At the core of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime is an asynchronous scheduler that drives the execution of the activities in a workflow.</span></span> <span data-ttu-id="9c1b0-137">Zapewnia wydajne, przewidywalne środowisko wykonawcze dla działań.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-137">It provides a performant, predictable execution environment for activities.</span></span> <span data-ttu-id="9c1b0-138">Środowisko zawiera dobrze zdefiniowaną umowę na potrzeby wykonywania, kontynuacji, uzupełniania, anulowania, wyjątków i prognozowanego modelu wątkowości.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-138">The environment has a well-defined contract for execution, continuation, completion, cancellation, exceptions, and a predictable threading model.</span></span>

 <span data-ttu-id="9c1b0-139">W porównaniu do WF3 środowisko uruchomieniowe WF4 ma wydajniejszy harmonogram.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-139">In comparison to WF3, the WF4 runtime has a more efficient scheduler.</span></span> <span data-ttu-id="9c1b0-140">Wykorzystuje tę samą pulę wątków we/wy, która jest używana na potrzeby WCF, co jest bardzo wydajne przy wykonywaniu wsadowych elementów roboczych.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-140">It leverages the same I/O thread pool that is used for WCF, which is very efficient at executing batched work items.</span></span> <span data-ttu-id="9c1b0-141">Kolejka harmonogramu wewnętrznego elementu pracy jest zoptymalizowana pod kątem większości typowych wzorców użytkowania.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-141">The internal work item scheduler queue is optimized for most common usage patterns.</span></span> <span data-ttu-id="9c1b0-142">Środowisko uruchomieniowe WF4 zarządza również Stanami wykonywania w bardzo lekkim stopniu z minimalną logiką obsługi zdarzeń i synchronizacji, podczas gdy WF3 zależy od dużej ilości rejestracji i wywołań zdarzeń w celu przeprowadzenia złożonej synchronizacji w celu przejścia stanu.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-142">The WF4 runtime also manages the execution states in a very lightweight way with minimal synchronization and event handling logic, while WF3 depends on heavy-weight event registration and invocation to perform complex synchronization for state transitions.</span></span>

### <a name="data-storage-and-flow"></a><span data-ttu-id="9c1b0-143">Magazyn danych i przepływ</span><span class="sxs-lookup"><span data-stu-id="9c1b0-143">Data Storage and Flow</span></span>
 <span data-ttu-id="9c1b0-144">W WF3 dane skojarzone z działaniem są modelowane za pomocą właściwości zależności implementowanych przez typ <xref:System.Windows.DependencyProperty> .</span><span class="sxs-lookup"><span data-stu-id="9c1b0-144">In WF3, data associated with an activity is modeled through dependency properties implemented by the type <xref:System.Windows.DependencyProperty>.</span></span> <span data-ttu-id="9c1b0-145">Wzorzec właściwości zależności został wprowadzony w Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="9c1b0-145">The dependency property pattern was introduced in Windows Presentation Foundation (WPF).</span></span> <span data-ttu-id="9c1b0-146">Ogólnie rzecz biorąc, ten wzorzec jest bardzo elastyczny do obsługi prostego powiązania danych i innych funkcji interfejsu użytkownika.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-146">In general, this pattern is very flexible to support easy data binding and other UI features.</span></span> <span data-ttu-id="9c1b0-147">Jednak wzorzec wymaga, aby właściwości były zdefiniowane jako pola statyczne w definicji przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-147">However, the pattern requires the properties to be defined as static fields in the workflow definition.</span></span> <span data-ttu-id="9c1b0-148">Za każdym razem [!INCLUDE[wf1](../../../includes/wf1-md.md)] , gdy środowisko uruchomieniowe ustawia lub pobiera wartości właściwości, obejmuje silnie ważoną logikę wyszukiwania.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-148">Whenever the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime sets or gets the property values, it involves heavily-weighted look-up logic.</span></span>

 <span data-ttu-id="9c1b0-149">WF4 używa logiki określania zakresu danych, aby znacznie poprawić sposób obsługi danych w przepływie pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-149">WF4 uses clear data scoping logic to greatly improve how data is handled in a workflow.</span></span> <span data-ttu-id="9c1b0-150">Oddzieli dane przechowywane w działaniu z danych, które przepływają między granicami działania przy użyciu dwóch różnych koncepcji: zmiennych i argumentów.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-150">It separates the data stored in an activity from the data that is flowing across the activity boundaries by using two different concepts: variables and arguments.</span></span> <span data-ttu-id="9c1b0-151">Przy użyciu jasnego zakresu hierarchicznego dla zmiennych i argumentów "in/out/InOut" złożoność użycia danych dla działań jest znacznie ograniczona i okres istnienia danych jest również automatycznie objęty zakresem.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-151">By using a clear hierarchical scope for variables and "In/Out/InOut" arguments, the data usage complexity for activities is dramatically reduced and the lifetime of the data is also automatically scoped.</span></span> <span data-ttu-id="9c1b0-152">Działania mają dobrze zdefiniowany podpis opisany przez jego argumenty.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-152">Activities have a well-defined signature described by its arguments.</span></span> <span data-ttu-id="9c1b0-153">Po prostu Inspekcja aktywności można określić, jakie dane mają być odbierane, oraz jakie dane zostaną przez niego utworzone w wyniku jego wykonania.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-153">By simply inspecting an activity you can determine what data it expects to receive and what data will be produced by it as the result of its execution.</span></span>

 <span data-ttu-id="9c1b0-154">W działaniach WF3 zostały zainicjowane podczas tworzenia przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-154">In WF3 activities were initialized when a workflow was created.</span></span> <span data-ttu-id="9c1b0-155">W działaniach WF 4 są inicjowane tylko wtedy, gdy wykonywane są odpowiednie działania.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-155">In WF 4 activities are initialized only when the corresponding activities are executing.</span></span> <span data-ttu-id="9c1b0-156">Dzięki temu można uprościć cykl życia aktywności bez wykonywania operacji inicjacji/odinicjowania, gdy zostanie utworzone nowe wystąpienie przepływu pracy, co spowodowało zwiększenie wydajności</span><span class="sxs-lookup"><span data-stu-id="9c1b0-156">This allows a simpler activity lifecycle without performing Initialize/Uninitialize operations when a new workflow instance is created, and thus has achieved more efficiency</span></span>

### <a name="control-flow"></a><span data-ttu-id="9c1b0-157">Przepływ sterowania</span><span class="sxs-lookup"><span data-stu-id="9c1b0-157">Control Flow</span></span>
 <span data-ttu-id="9c1b0-158">Podobnie jak w przypadku dowolnego języka programowania, [!INCLUDE[wf1](../../../includes/wf1-md.md)] zapewnia obsługę przepływów sterowania dla definicji przepływu pracy przez wprowadzenie zestawu działań przepływu sterowania dla sekwencjonowania, pętli, rozgałęzień i innych wzorców.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-158">Just as in any programming language, [!INCLUDE[wf1](../../../includes/wf1-md.md)] provides support for control flows for workflow definitions by introducing a set of control flow activities for sequencing, looping, branching and other patterns.</span></span> <span data-ttu-id="9c1b0-159">W WF3, gdy konieczne jest ponowne wykonanie tego samego działania, tworzony jest nowy element, <xref:System.Workflow.ComponentModel.ActivityExecutionContext> a działanie jest klonowane przy użyciu dużej ilości logiki serializacji i deserializacji na podstawie <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> .</span><span class="sxs-lookup"><span data-stu-id="9c1b0-159">In WF3, when the same activity needs to be re-executed, a new <xref:System.Workflow.ComponentModel.ActivityExecutionContext> is created and the activity is cloned through a heavy-weight serialization and deserialization logic based on <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>.</span></span> <span data-ttu-id="9c1b0-160">Zwykle wydajność dla przebiegów kontroli iteracyjnej jest znacznie wolniejsza niż wykonywanie sekwencji działań.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-160">Usually the performance for iterative control flows is much slower than executing a sequence of activities.</span></span>

 <span data-ttu-id="9c1b0-161">WF4 obsługuje to zupełnie inaczej.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-161">WF4 handles this quite differently.</span></span> <span data-ttu-id="9c1b0-162">Przyjmuje szablon działania, tworzy nowy obiekt ActivityInstance i dodaje go do kolejki harmonogramu.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-162">It takes the activity template, creates a new ActivityInstance object, and adds it to the scheduler queue.</span></span> <span data-ttu-id="9c1b0-163">Ten cały proces obejmuje tylko jawne Tworzenie obiektów i jest bardzo lekki.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-163">This whole process only involves explicit object creation and is very lightweight.</span></span>

### <a name="asynchronous-programming"></a><span data-ttu-id="9c1b0-164">Programowanie asynchroniczne</span><span class="sxs-lookup"><span data-stu-id="9c1b0-164">Asynchronous Programming</span></span>
 <span data-ttu-id="9c1b0-165">Aplikacje mają zwykle lepszą wydajność i skalowalność dzięki programowaniu asynchronicznym na długotrwałe operacje blokowania, takie jak operacje we/wy lub rozproszone procesy obliczeniowe.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-165">Applications usually have better performance and scalability with asynchronous programming for long running blocking operations such as I/O or distributed computing operations.</span></span> <span data-ttu-id="9c1b0-166">WF4 zapewnia obsługę asynchroniczną za pomocą podstawowych typów działań <xref:System.Activities.AsyncCodeActivity> <xref:System.Activities.AsyncCodeActivity%601> .</span><span class="sxs-lookup"><span data-stu-id="9c1b0-166">WF4 provides asynchronous support through base activity types <xref:System.Activities.AsyncCodeActivity>, <xref:System.Activities.AsyncCodeActivity%601>.</span></span> <span data-ttu-id="9c1b0-167">Środowisko uruchomieniowe natywnie rozumie działania asynchroniczne i w związku z tym może automatycznie umieścić wystąpienie w strefie no-utrwalania, gdy Praca asynchroniczna jest zaległa.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-167">The runtime natively understands asynchronous activities and therefore can automatically put the instance in a no-persist zone while the asynchronous work is outstanding.</span></span> <span data-ttu-id="9c1b0-168">Działania niestandardowe mogą pochodzić od tych typów w celu wykonywania operacji asynchronicznych bez przytrzymywania wątku harmonogramu przepływu pracy i blokowania działań, które mogą być uruchamiane równolegle.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-168">Custom activities can derive from these types to perform asynchronous work without holding the workflow scheduler thread and blocking any activities that may be able to run in parallel.</span></span>

### <a name="messaging"></a><span data-ttu-id="9c1b0-169">Obsługa komunikatów</span><span class="sxs-lookup"><span data-stu-id="9c1b0-169">Messaging</span></span>
 <span data-ttu-id="9c1b0-170">Początkowo WF3 bardzo ograniczoną obsługę komunikatów przez zewnętrzne zdarzenia lub wywołania usług sieci Web.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-170">Initially WF3 had very limited messaging support through external events or web services invocations.</span></span> <span data-ttu-id="9c1b0-171">W programie .NET 3,5 przepływy pracy mogą być implementowane jako klienci WCF lub udostępniane jako usługi WCF za poorednictwem systemów <xref:System.Workflow.Activities.SendActivity> i <xref:System.Workflow.Activities.ReceiveActivity> .</span><span class="sxs-lookup"><span data-stu-id="9c1b0-171">In .NET 3.5, workflows could be implemented as WCF clients or exposed as WCF services through <xref:System.Workflow.Activities.SendActivity> and <xref:System.Workflow.Activities.ReceiveActivity>.</span></span> <span data-ttu-id="9c1b0-172">W WF4 koncepcji programowania komunikatów opartych na przepływach pracy został jeszcze bardziej wzmocniony przez ścisłą integrację logiki obsługi komunikatów WCF z WF.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-172">In WF4, the concept of workflow-based messaging programming has been further strengthened through the tight integration of WCF messaging logic into WF.</span></span>

 <span data-ttu-id="9c1b0-173">Potok przetwarzania ujednoliconych komunikatów zapewniany w programie WCF w programie .NET 4 pomaga WF4 usługom w znacznie lepszą wydajność i skalowalność niż WF3.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-173">The unified message processing pipeline provided in WCF in .NET 4 helps WF4 services to have significantly better performance and scalability than WF3.</span></span> <span data-ttu-id="9c1b0-174">WF4 zapewnia także bogatszą obsługę programowania komunikatów, która może modelować złożone wzorce wymiany komunikatów (MEPs).</span><span class="sxs-lookup"><span data-stu-id="9c1b0-174">WF4 also provides richer messaging programming support that can model complex Message Exchange Patterns (MEPs).</span></span> <span data-ttu-id="9c1b0-175">Deweloperzy mogą korzystać z umów usług z systemem, aby w łatwy sposób programistyczny lub nieokreślony z nieokreślonymi typami umów uzyskać lepszą wydajność bez płacenia kosztów serializacji.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-175">Developers can use either typed service contracts to achieve easy programming or un-typed service contracts to achieve better performance without paying serialization costs.</span></span> <span data-ttu-id="9c1b0-176">Obsługa buforowania kanału po stronie klienta za pośrednictwem <xref:System.ServiceModel.Activities.SendMessageChannelCache> klasy w WF4 ułatwia deweloperom tworzenie szybkich aplikacji z minimalnym nakładem pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-176">The client-side channel caching support through the <xref:System.ServiceModel.Activities.SendMessageChannelCache> class in WF4 helps developers build fast applications with minimal effort.</span></span> <span data-ttu-id="9c1b0-177">Aby uzyskać więcej informacji, zobacz [Zmienianie poziomów udostępniania pamięci podręcznej dla działań wysyłania](../wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span><span class="sxs-lookup"><span data-stu-id="9c1b0-177">For more information, see [Changing the Cache Sharing Levels for Send Activities](../wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span></span>

### <a name="declarative-programming"></a><span data-ttu-id="9c1b0-178">Programowanie deklaracyjne</span><span class="sxs-lookup"><span data-stu-id="9c1b0-178">Declarative Programming</span></span>
 <span data-ttu-id="9c1b0-179">WF4 zapewnia czysty i prosty, deklaracyjne środowisko programistyczne do modelowania procesów i usług firmy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-179">WF4 provides a clean and simple declarative programming framework to model business processes and services.</span></span> <span data-ttu-id="9c1b0-180">Model programowania obsługuje w pełni deklaratywne składowe działań bez kodu, co znacznie upraszcza tworzenie przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-180">The programming model supports fully declarative composition of activities, with no code-beside, greatly simplifying workflow authoring.</span></span> <span data-ttu-id="9c1b0-181">W .NET Framework 4, deklaracyjne środowisko programistyczne oparte na języku XAML zostało ujednolicone w jednym zestawie System.Xaml.dll do obsługi programów WPF i WF.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-181">In .NET Framework 4, the XAML-based declarative programming framework has been unified into the single assembly System.Xaml.dll to support both WPF and WF.</span></span>

 <span data-ttu-id="9c1b0-182">W WF4, język XAML zapewnia prawdziwie deklaracyjne środowisko i umożliwia zdefiniowanie całej definicji przepływu pracy w znaczniku XML, odwołujące się do działań i typów utworzonych przy użyciu platformy .NET.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-182">In WF4, XAML provides a truly declarative experience and allows for the entire definition of the workflow to be defined in XML markup, referencing activities and types built using .NET.</span></span> <span data-ttu-id="9c1b0-183">Było to trudne do wykonania w WF3 z formatem XOML, bez uwzględniania niestandardowej logiki związanej z kodem.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-183">This was difficult to do in WF3 with XOML format without involving custom code-behind logic.</span></span> <span data-ttu-id="9c1b0-184">Nowy stos XAML w programie .NET 4 ma znacznie lepszą wydajność podczas serializowania/deserializacji artefaktów przepływu pracy i sprawia, że deklaratywne programowanie jest bardziej atrakcyjne i trwałe.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-184">The new XAML-stack in .NET 4 has much better performance in serializing/deserializing workflow artifacts and makes declarative programming more attractive and solid.</span></span>

### <a name="workflow-designer"></a><span data-ttu-id="9c1b0-185">Projektant przepływów pracy</span><span class="sxs-lookup"><span data-stu-id="9c1b0-185">Workflow Designer</span></span>
 <span data-ttu-id="9c1b0-186">W pełni deklaracyjne wsparcie programistyczne dla WF4 jawnie nakłada wyższe wymagania dotyczące wydajności czasu projektowania dla dużych przepływów pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-186">Fully declarative programming support for WF4 explicitly imposes higher requirements for design time performance for large workflows.</span></span> <span data-ttu-id="9c1b0-187">Projektant przepływu pracy w programie WF4 ma znacznie lepszą skalowalność dla dużych przepływów pracy niż w przypadku WF3.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-187">The Workflow designer in WF4 has much better scalability for large workflows than that for WF3.</span></span> <span data-ttu-id="9c1b0-188">Dzięki obsłudze wirtualizacji interfejsu użytkownika Projektant może łatwo ładować duże przepływy pracy 1000 działań w ciągu kilku sekund, podczas gdy niemal niemożliwe jest załadowanie przepływu pracy kilku setek działań za pomocą projektanta WF3.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-188">With UI virtualization support, the designer can easily load a large workflow of 1000 activities in a few seconds, while it is almost impossible to load a workflow of a few hundred activities with the WF3 designer.</span></span>

## <a name="component-level-performance-comparisons"></a><span data-ttu-id="9c1b0-189">Porównania wydajności na poziomie składników</span><span class="sxs-lookup"><span data-stu-id="9c1b0-189">Component-level Performance Comparisons</span></span>
 <span data-ttu-id="9c1b0-190">Ta sekcja zawiera dane dotyczące bezpośredniego porównania między poszczególnymi działaniami w przepływach pracy WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-190">This section contains data on direct comparisons between individual activities in WF3 and WF4 workflows.</span></span>  <span data-ttu-id="9c1b0-191">Kluczowe obszary, takie jak trwałość, mają bardziej głęboki wpływ na wydajność niż poszczególne składniki działania.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-191">Key areas like persistence have a more profound impact on performance than the individual activity components.</span></span>  <span data-ttu-id="9c1b0-192">Udoskonalenia wydajności w poszczególnych składnikach WF4 są ważne, ponieważ składniki są teraz wystarczająco szybkie, aby można je było porównać z logiką aranżacji.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-192">The performance improvements in individual components in WF4 are important though because the components are now fast enough to be compared against hand-coded orchestration logic.</span></span>  <span data-ttu-id="9c1b0-193">Przykład, który został omówiony w następnej sekcji: "scenariusz tworzenia usług".</span><span class="sxs-lookup"><span data-stu-id="9c1b0-193">An example of which is covered in the next section: "Service Composition Scenario."</span></span>

### <a name="environment-setup"></a><span data-ttu-id="9c1b0-194">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="9c1b0-194">Environment Setup</span></span>
 ![Konfiguracja środowiska dla pomiaru wydajności przepływu pracy](./media/performance/performance-test-environment.gif)

 <span data-ttu-id="9c1b0-196">Powyższy rysunek przedstawia konfigurację komputera używaną do pomiaru wydajności na poziomie składnika.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-196">The above figure shows the machine configuration used for component-level performance measurement.</span></span> <span data-ttu-id="9c1b0-197">Jeden serwer i pięć klientów połączonych za pośrednictwem jednego interfejsu sieciowego Ethernet 1 GB/s.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-197">A single server and five clients connected over one 1-Gbps Ethernet network interface.</span></span> <span data-ttu-id="9c1b0-198">W celu ułatwienia pomiarów serwer jest skonfigurowany do korzystania z jednego rdzenia serwera dwuprocesowego/Quad-Core z systemem Windows Server 2008 x86.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-198">For easy measurements, the server is configured to use a single core of a dual-proc/quad-core server  running Windows Server 2008 x86.</span></span> <span data-ttu-id="9c1b0-199">Użycie procesora CPU systemu jest utrzymywane o niemal 100%.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-199">The system CPU utilization is maintained at nearly 100%.</span></span>

### <a name="test-details"></a><span data-ttu-id="9c1b0-200">Szczegóły testu</span><span class="sxs-lookup"><span data-stu-id="9c1b0-200">Test Details</span></span>
 <span data-ttu-id="9c1b0-201">WF3 <xref:System.Workflow.Activities.CodeActivity> jest prawdopodobnie najprostszym działaniem, które może być używane w przepływie pracy WF3.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-201">The WF3 <xref:System.Workflow.Activities.CodeActivity> is likely the simplest activity that can be used in a WF3 workflow.</span></span>  <span data-ttu-id="9c1b0-202">Działanie wywołuje metodę w kodzie, za pomocą którego programista przepływu pracy może umieścić kod niestandardowy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-202">The activity calls a method in the code-behind that the workflow programmer can put custom code into.</span></span>  <span data-ttu-id="9c1b0-203">W programie WF4 nie ma bezpośredniego analogu do WF3, <xref:System.Workflow.Activities.CodeActivity> który zapewnia te same funkcje.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-203">In WF4, there is no direct analog to the WF3 <xref:System.Workflow.Activities.CodeActivity> that provides the same functionality.</span></span>  <span data-ttu-id="9c1b0-204">Należy zauważyć, że istnieje <xref:System.Activities.CodeActivity> Klasa bazowa w WF4, która nie jest powiązana z WF3 <xref:System.Workflow.Activities.CodeActivity> .</span><span class="sxs-lookup"><span data-stu-id="9c1b0-204">Note that there is a <xref:System.Activities.CodeActivity> base class in WF4 that is not related to the WF3 <xref:System.Workflow.Activities.CodeActivity>.</span></span>  <span data-ttu-id="9c1b0-205">Autorzy przepływu pracy zachęca się do tworzenia działań niestandardowych i tworzenia przepływów pracy tylko w języku XAML.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-205">Workflow authors are encouraged to create custom activities and build XAML-only workflows.</span></span>  <span data-ttu-id="9c1b0-206">W poniższych testach użyto wywoływanego działania `Comment` zamiast pustego <xref:System.Workflow.Activities.CodeActivity> w przepływie pracy WF4.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-206">In the tests below, an activity called `Comment` is used in place of an empty <xref:System.Workflow.Activities.CodeActivity> in WF4 workflows.</span></span>  <span data-ttu-id="9c1b0-207">Kod w `Comment` działaniu jest następujący:</span><span class="sxs-lookup"><span data-stu-id="9c1b0-207">The code in the `Comment` activity is as follows:</span></span>

```csharp
[ContentProperty("Body")]
    public sealed class Comment : CodeActivity
    {
        public Comment()
            : base()
        {
        }

        [DefaultValue(null)]
        public Activity Body
        {
            get;
            set;
        }

        protected override void Execute(CodeActivityContext context)
        {
        }
    }
```

### <a name="empty-workflow"></a><span data-ttu-id="9c1b0-208">Pusty przepływ pracy</span><span class="sxs-lookup"><span data-stu-id="9c1b0-208">Empty Workflow</span></span>
 <span data-ttu-id="9c1b0-209">Ten test używa przepływu pracy sekwencji bez działań podrzędnych.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-209">This test uses a sequence workflow with no child activities.</span></span>

### <a name="single-activity"></a><span data-ttu-id="9c1b0-210">Pojedyncze działanie</span><span class="sxs-lookup"><span data-stu-id="9c1b0-210">Single Activity</span></span>
 <span data-ttu-id="9c1b0-211">Przepływ pracy jest przepływem pracy sekwencji zawierającym jedno działanie podrzędne.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-211">The workflow is a sequence workflow containing one child activity.</span></span>  <span data-ttu-id="9c1b0-212">Działanie to <xref:System.Workflow.Activities.CodeActivity> bez kodu w przypadku WF3 i `Comment` działania w przypadku WF4.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-212">The activity is a <xref:System.Workflow.Activities.CodeActivity> with no code in the WF3 case and a `Comment` activity in the WF4 case.</span></span>

### <a name="while-with-1000-iterations"></a><span data-ttu-id="9c1b0-213">While z 1000 iteracji</span><span class="sxs-lookup"><span data-stu-id="9c1b0-213">While with 1000 Iterations</span></span>
 <span data-ttu-id="9c1b0-214">Przepływ pracy sekwencji zawiera jedno <xref:System.Activities.Statements.While> działanie z jednym działaniem podrzędnym w pętli, które nie wykonuje żadnej pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-214">The sequence workflow contains one <xref:System.Activities.Statements.While> activity with one child activity in the loop that does not perform any work.</span></span>

### <a name="replicator-compared-to-parallelforeach"></a><span data-ttu-id="9c1b0-215">Replikator w porównaniu do ParallelForEach</span><span class="sxs-lookup"><span data-stu-id="9c1b0-215">Replicator compared to ParallelForEach</span></span>
 <span data-ttu-id="9c1b0-216"><xref:System.Workflow.Activities.ReplicatorActivity> w programie WF3 są tryby wykonywania sekwencyjnego i równoległego.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-216"><xref:System.Workflow.Activities.ReplicatorActivity> in WF3 has sequential and parallel execution modes.</span></span>  <span data-ttu-id="9c1b0-217">W trybie sekwencyjnym wydajność działania jest podobna do <xref:System.Workflow.Activities.WhileActivity> .</span><span class="sxs-lookup"><span data-stu-id="9c1b0-217">In sequential mode, the activity’s performance is similar to the <xref:System.Workflow.Activities.WhileActivity>.</span></span>  <span data-ttu-id="9c1b0-218"><xref:System.Workflow.Activities.ReplicatorActivity>Jest najbardziej przydatny do wykonywania równoległego.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-218">The <xref:System.Workflow.Activities.ReplicatorActivity> is most useful for parallel execution.</span></span>  <span data-ttu-id="9c1b0-219">Wartość WF4 jest analogiczna dla tego <xref:System.Activities.Statements.ParallelForEach%601> działania.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-219">The WF4 analog for this is the <xref:System.Activities.Statements.ParallelForEach%601> activity.</span></span>

 <span data-ttu-id="9c1b0-220">Na poniższym diagramie przedstawiono przepływy pracy używane do tego testu.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-220">The following diagram shows the workflows used for this test.</span></span> <span data-ttu-id="9c1b0-221">Przepływ pracy WF3 jest po lewej stronie, a przepływ pracy WF4 znajduje się po prawej stronie.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-221">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>

 ![WF3 Replikator i WF4 ParallelForEach](./media/performance/replicator-parallel-wf3-wf4.gif)

### <a name="sequential-workflow-with-five-activities"></a><span data-ttu-id="9c1b0-223">Sekwencyjny przepływ pracy z pięcioma działaniami</span><span class="sxs-lookup"><span data-stu-id="9c1b0-223">Sequential Workflow with Five Activities</span></span>
 <span data-ttu-id="9c1b0-224">Ten test ma na celu pokazanie efektu wykonywania kilku działań w sekwencji.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-224">This test is meant to show the effect of having several activities execute in sequence.</span></span>  <span data-ttu-id="9c1b0-225">Sekwencja obejmuje pięć działań.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-225">There are five activities in the sequence.</span></span>

### <a name="transaction-scope"></a><span data-ttu-id="9c1b0-226">Zakres transakcji</span><span class="sxs-lookup"><span data-stu-id="9c1b0-226">Transaction Scope</span></span>
 <span data-ttu-id="9c1b0-227">Test zakresu transakcji różni się od innych testów w niewielkim stopniu w przypadku, gdy nowe wystąpienie przepływu pracy nie jest tworzone dla każdej iteracji.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-227">The transaction scope test differs from the other tests slightly in that a new workflow instance is not created for every iteration.</span></span>  <span data-ttu-id="9c1b0-228">Zamiast tego przepływ pracy jest strukturalny przy użyciu pętli while zawierającej <xref:System.Activities.Statements.TransactionScope> działanie zawierające pojedyncze działanie, które nie działa.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-228">Instead, the workflow is structured with a while loop containing a <xref:System.Activities.Statements.TransactionScope> activity containing a single activity that does no work.</span></span>  <span data-ttu-id="9c1b0-229">Każdy przebieg wsadu 50 iteracji przez pętlę while jest liczony jako jedna operacja.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-229">Each run of a batch of 50 iterations through the while loop is counted as a single operation.</span></span>

### <a name="compensation"></a><span data-ttu-id="9c1b0-230">Kompensacja</span><span class="sxs-lookup"><span data-stu-id="9c1b0-230">Compensation</span></span>
 <span data-ttu-id="9c1b0-231">Przepływ pracy WF3 ma pojedyncze działanie kompensowane o nazwie `WorkScope` .</span><span class="sxs-lookup"><span data-stu-id="9c1b0-231">The WF3 workflow has a single compensatable activity named `WorkScope`.</span></span>  <span data-ttu-id="9c1b0-232">Działanie po prostu implementuje <xref:System.Workflow.ComponentModel.ICompensatableActivity> Interfejs:</span><span class="sxs-lookup"><span data-stu-id="9c1b0-232">The activity simply implements the <xref:System.Workflow.ComponentModel.ICompensatableActivity> interface:</span></span>

```csharp
class WorkScope :
        CompositeActivity, ICompensatableActivity
    {
        public WorkScope() : base() { }

        public WorkScope(string name)
        {
            this.Name = name;
        }

        public ActivityExecutionStatus Compensate(
            ActivityExecutionContext executionContext)
        {
            return ActivityExecutionStatus.Closed;
        }
    }
```

 <span data-ttu-id="9c1b0-233">Procedura obsługi błędów odwołuje się do `WorkScope` działania.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-233">The fault handler targets the `WorkScope` activity.</span></span> <span data-ttu-id="9c1b0-234">Przepływ pracy WF4 jest równie uproszczony.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-234">The WF4 workflow is equally simplistic.</span></span>  <span data-ttu-id="9c1b0-235"><xref:System.Activities.Statements.CompensableActivity>Ma program obsługi treści i kompensacji.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-235">A <xref:System.Activities.Statements.CompensableActivity> has a body and a compensation handler.</span></span>  <span data-ttu-id="9c1b0-236">W sekwencji są dalej wyrównane kompensacje.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-236">An explicit compensate is next in the sequence.</span></span>  <span data-ttu-id="9c1b0-237">Działanie treści i działania programu obsługi kompensacji są pustymi implementacjami:</span><span class="sxs-lookup"><span data-stu-id="9c1b0-237">The body activity and compensation handler activity are both empty implementations:</span></span>

```csharp
public sealed class CompensableActivityEmptyCompensation : CodeActivity
    {
        public CompensableActivityEmptyCompensation()
            : base() { }

        public Activity Body { get; set; }

        protected override void Execute(CodeActivityContext context) { }
    }
    public sealed class CompensableActivityEmptyBody : CodeActivity
    {
        public CompensableActivityEmptyBody()
            : base() { }

        public Activity Body { get; set; }

        protected override void Execute(CodeActivityContext context) { }
    }
```

<span data-ttu-id="9c1b0-238">Na poniższym diagramie przedstawiono podstawowy przepływ pracy związane z wynagrodzeniem.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-238">The following diagram shows the basic compensation workflow.</span></span> <span data-ttu-id="9c1b0-239">Przepływ pracy WF3 jest po lewej stronie, a przepływ pracy WF4 znajduje się po prawej stronie.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-239">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>

![Podstawowe przepływy pracy dotyczące WF3 i WF4](./media/performance/basic-compensation-workflows-wf3-wf4.gif)

### <a name="performance-test-results"></a><span data-ttu-id="9c1b0-241">Wyniki testów wydajności</span><span class="sxs-lookup"><span data-stu-id="9c1b0-241">Performance Test Results</span></span>

 ![Tabela przedstawiająca dane wyników testu wydajnościowego](./media/performance/performance-test-data.gif)

 ![Wykres kolumnowy porównujący dane testu wydajności WF3 i WF4](./media/performance/performance-test-chart.gif)

 <span data-ttu-id="9c1b0-244">Wszystkie testy są mierzone w przepływach pracy na sekundę z wyjątkiem testu zakresu transakcji.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-244">All tests are measured in workflows per second with the exception of the transaction scope test.</span></span>  <span data-ttu-id="9c1b0-245">Jak widać powyżej, [!INCLUDE[wf1](../../../includes/wf1-md.md)] wydajność środowiska uruchomieniowego została ulepszona w całej tablicy, szczególnie w obszarach wymagających wielokrotnych wykonań tego samego działania, takich jak Pętla WHILE.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-245">As can be seen above, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime performance has improved across the board, especially in areas that require multiple executions of the same activity like the while loop.</span></span>

## <a name="service-composition-scenario"></a><span data-ttu-id="9c1b0-246">Scenariusz tworzenia usługi</span><span class="sxs-lookup"><span data-stu-id="9c1b0-246">Service Composition Scenario</span></span>
 <span data-ttu-id="9c1b0-247">Jak pokazano w poprzedniej sekcji "porównania wydajności na poziomie składników", nastąpił znaczny spadek obciążenia między WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-247">As is shown in the previous section, "Component-level Performance Comparisons," there has been a significant reduction in overhead between WF3 and WF4.</span></span>  <span data-ttu-id="9c1b0-248">Usługi przepływu pracy WCF mogą teraz prawie odpowiadać wydajności kodowanym ręcznie usługom WCF, ale nadal mają wszystkie zalety [!INCLUDE[wf1](../../../includes/wf1-md.md)] środowiska uruchomieniowego.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-248">WCF workflow services can now almost match the performance of hand-coded WCF services but still have all the benefits of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="9c1b0-249">Ten scenariusz testu porównuje usługę WCF z usługą przepływu pracy WCF w WF4.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-249">This test scenario compares a WCF service against a WCF workflow service in WF4.</span></span>

### <a name="online-store-service"></a><span data-ttu-id="9c1b0-250">Usługa sklepu online</span><span class="sxs-lookup"><span data-stu-id="9c1b0-250">Online Store Service</span></span>
 <span data-ttu-id="9c1b0-251">Jedną z zalet Windows Workflow Foundation jest możliwość tworzenia procesów przy użyciu kilku usług.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-251">One of the strengths of Windows Workflow Foundation is the ability to compose processes using several services.</span></span>  <span data-ttu-id="9c1b0-252">W tym przykładzie istnieje usługa sklepu online, która organizuje dwa wywołania usługi, aby zakupić zamówienie.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-252">For this example, there is an online store service that orchestrates two service calls to purchase an order.</span></span>  <span data-ttu-id="9c1b0-253">Pierwszym krokiem jest sprawdzenie kolejności przy użyciu usługi Order Validate Service.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-253">The first step is to validate the order using an Order Validating Service.</span></span>  <span data-ttu-id="9c1b0-254">Drugim krokiem jest wypełnienie zamówienia przy użyciu usługi magazynu.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-254">The second step is to fill the order using a Warehouse Service.</span></span>

 <span data-ttu-id="9c1b0-255">Dwa usługi zaplecza, zamawianie walidacji usługi i usługi magazynu, pozostają takie same dla obu testów.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-255">The two backend services, Order Validating Service and Warehouse Service, remain the same for both tests.</span></span>  <span data-ttu-id="9c1b0-256">Częścią, która zmienia się, jest usługa sklepu online, która wykonuje aranżację.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-256">The part that changes is the Online Store Service that performs the orchestration.</span></span>  <span data-ttu-id="9c1b0-257">W jednym przypadku usługa jest zapisana ręcznie jako usługa WCF.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-257">In one case, the service is hand-coded as a WCF service.</span></span>  <span data-ttu-id="9c1b0-258">W przypadku innych przypadków usługa jest zapisywana jako usługa przepływu pracy WCF w WF4.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-258">For the other case, the service is written as a WCF workflow service in WF4.</span></span> [!INCLUDE[wf1](../../../includes/wf1-md.md)]<span data-ttu-id="9c1b0-259">dla tego testu są wyłączone określone funkcje, takie jak śledzenie i trwałość.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-259">-specific features like tracking and persistence are turned off for this test.</span></span>

### <a name="environment"></a><span data-ttu-id="9c1b0-260">Środowisko</span><span class="sxs-lookup"><span data-stu-id="9c1b0-260">Environment</span></span>
![Konfiguracja środowiska dla pomiaru wydajności](./media/performance/performance-test-environment.gif)

 <span data-ttu-id="9c1b0-262">Żądania klientów są wysyłane do usługi sklepu online za pośrednictwem protokołu HTTP z wielu komputerów.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-262">Client requests are made to the Online Store Service via HTTP from multiple computers.</span></span>  <span data-ttu-id="9c1b0-263">Pojedynczy komputer obsługuje wszystkie trzy usługi.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-263">A single computer hosts all three services.</span></span>  <span data-ttu-id="9c1b0-264">Warstwa transportu między usługą sklepu online a usługami zaplecza to TCP lub HTTP.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-264">The transport layer between the Online Store Service and the backend services is TCP or HTTP.</span></span>  <span data-ttu-id="9c1b0-265">Pomiar operacji na sekundę jest oparty na liczbie ukończonych `PurchaseOrder` wywołań do usługi sklepu online.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-265">The measurement of operations/second is based on the number of completed `PurchaseOrder` calls made to the Online Store Service.</span></span>  <span data-ttu-id="9c1b0-266">Buforowanie kanałów jest nową funkcją dostępną w WF4.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-266">Channel pooling is a new feature available in WF4.</span></span>  <span data-ttu-id="9c1b0-267">W części WCF tej puli kanałów testowych nie jest dostarczany poza Box, dlatego w usłudze sklepu online użyto rozmieszczonej ręcznie implementacji techniki prostego buforowania.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-267">In the WCF portion of this test channel pooling is not provided out of the box so a hand-coded implementation of a simple pooling technique was used in the Online Store Service.</span></span>

### <a name="performance"></a><span data-ttu-id="9c1b0-268">Wydajność</span><span class="sxs-lookup"><span data-stu-id="9c1b0-268">Performance</span></span>
![Wykres kolumnowy przedstawiający wydajność usługi sklepu online](./media/performance/online-store-performance-graph.gif)

 <span data-ttu-id="9c1b0-270">Połączenie z usługami TCP zaplecza bez buforowania kanałów [!INCLUDE[wf1](../../../includes/wf1-md.md)] Usługa ma wpływ na przepływność na 17,2%.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-270">Connecting to backend TCP services without channel pooling, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] service has a 17.2% impact on throughput.</span></span>  <span data-ttu-id="9c1b0-271">W przypadku używania puli kanałów kara wynosi około 23,8%.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-271">With channel pooling, the penalty is about 23.8%.</span></span>  <span data-ttu-id="9c1b0-272">W przypadku protokołu HTTP wpływ jest znacznie mniejszy: 4,3% bez pul i 8,1% z buforowaniem.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-272">For HTTP, the impact is much less: 4.3% without pooling and 8.1% with pooling.</span></span>  <span data-ttu-id="9c1b0-273">Należy również pamiętać, że w przypadku korzystania z protokołu HTTP buforowanie kanałów zapewnia bardzo mało korzyści.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-273">It is also important to note that the channel pooling provides very little benefit when using HTTP.</span></span>

 <span data-ttu-id="9c1b0-274">Chociaż w tym teście WF4 środowisko uruchomieniowe w porównaniu z zaręczną usługą WCF, można go traktować jako najgorszy scenariusz.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-274">While there is overhead from the WF4 runtime compared with a hand-coded WCF service in this test, it could be considered a worst-case scenario.</span></span>  <span data-ttu-id="9c1b0-275">Dwa usługi zaplecza w tym teście wykonują bardzo mało pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-275">The two backend services in this test do very little work.</span></span>  <span data-ttu-id="9c1b0-276">W codziennym scenariuszu te usługi będą wykonywać bardziej kosztowne operacje, takie jak wywołania bazy danych, co zmniejsza wpływ na wydajność warstwy transportowej.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-276">In a real end-to-end scenario, these services would perform more expensive operations like database calls, making the performance impact of the transport layer less important.</span></span>  <span data-ttu-id="9c1b0-277">Dzięki temu można korzystać z zalet funkcji dostępnych w programie WF4, co sprawia, że usługa Workflow Foundation umożliwia tworzenie usług aranżacji.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-277">This plus the benefits of the features available in WF4 makes Workflow Foundation a viable choice for creating orchestration services.</span></span>

## <a name="key-performance-considerations"></a><span data-ttu-id="9c1b0-278">Kluczowe zagadnienia dotyczące wydajności</span><span class="sxs-lookup"><span data-stu-id="9c1b0-278">Key Performance Considerations</span></span>
 <span data-ttu-id="9c1b0-279">Obszary funkcji w tej sekcji, z wyjątkiem międzyoperacyjności, zostały znacząco zmienione między WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-279">The feature areas in this section, with the exception of interop, have dramatically changed between WF3 and WF4.</span></span>  <span data-ttu-id="9c1b0-280">Ma to wpływ na projekt aplikacji przepływu pracy, a także wydajność.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-280">This affects the design of workflow applications as well as the performance.</span></span>

#### <a name="workflow-activation-latency"></a><span data-ttu-id="9c1b0-281">Opóźnienie aktywacji przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="9c1b0-281">Workflow Activation Latency</span></span>
 <span data-ttu-id="9c1b0-282">W aplikacji usługi przepływu pracy WCF czas oczekiwania na uruchomienie nowego przepływu pracy lub załadowanie istniejącego przepływu pracy jest istotny, ponieważ może być blokowany.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-282">In a WCF workflow service application, the latency for starting a new workflow or loading an existing workflow is important as it can be blocking.</span></span>  <span data-ttu-id="9c1b0-283">Ten przypadek testowy mierzy WF3 hosta XOML dla hosta WF4 XAMLX w typowym scenariuszu.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-283">This test case measures a WF3 XOML host against a WF4 XAMLX host in a typical scenario.</span></span>

##### <a name="environment-setup"></a><span data-ttu-id="9c1b0-284">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="9c1b0-284">Environment Setup</span></span>
 ![Konfiguracja środowiska dla testów opóźnienia i przepływności](./media/performance/latency-throughput-environment-setup.gif)

##### <a name="test-setup"></a><span data-ttu-id="9c1b0-286">Konfiguracja testu</span><span class="sxs-lookup"><span data-stu-id="9c1b0-286">Test Setup</span></span>
 <span data-ttu-id="9c1b0-287">W tym scenariuszu komputer kliencki kontaktuje się z usługą przepływu pracy WCF przy użyciu korelacji opartej na kontekście.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-287">In the scenario, a client computer contacts a WCF workflow service using context-based correlation.</span></span>  <span data-ttu-id="9c1b0-288">Korelacja kontekstu wymaga specjalnego powiązania kontekstu i używa nagłówka kontekstu lub pliku cookie do powiązania komunikatów z prawidłowym wystąpieniem przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-288">Context correlation requires a special context binding and uses a context header or cookie to relate messages to the correct workflow instance.</span></span>  <span data-ttu-id="9c1b0-289">Ma korzyść wydajności w przypadku, gdy identyfikator korelacji znajduje się w nagłówku komunikatu, dlatego nie trzeba analizować treści komunikatu.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-289">It has a performance benefit in that the correlation Id is located in the message header so the message body does not need to be parsed.</span></span>

 <span data-ttu-id="9c1b0-290">Usługa utworzy nowy przepływ pracy z żądaniem i wyśle natychmiastową odpowiedź, aby pomiar opóźnienia nie obejmował czasu, w którym przepływ pracy został uruchomiony.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-290">The service will create a new workflow with the request and send an immediate response so that the measurement of latency does not include the time spent running the workflow.</span></span>  <span data-ttu-id="9c1b0-291">Przepływ pracy WF3 jest elementem XOML z kodem, a przepływ pracy WF4 jest całkowicie XAML.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-291">The WF3 workflow is XOML with a code-behind and the WF4 workflow is entirely XAML.</span></span>  <span data-ttu-id="9c1b0-292">Przepływ pracy WF4 wygląda następująco:</span><span class="sxs-lookup"><span data-stu-id="9c1b0-292">The WF4 workflow looks like this:</span></span>

 ![Przepływ pracy zakresu korelacji WF4](./media/performance/wf4-correlationscope-workflow.gif)

 <span data-ttu-id="9c1b0-294"><xref:System.ServiceModel.Activities.Receive>Działanie tworzy wystąpienie przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-294">The <xref:System.ServiceModel.Activities.Receive> activity creates the workflow instance.</span></span>  <span data-ttu-id="9c1b0-295">Wartość przeniesiona w odebranej wiadomości jest echo w komunikacie odpowiedzi.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-295">A value passed in the received message is echoed in the reply message.</span></span>  <span data-ttu-id="9c1b0-296">Sekwencja po odpowiedzi zawiera resztę przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-296">A sequence following the reply contains the rest of the workflow.</span></span>  <span data-ttu-id="9c1b0-297">W powyższym przypadku wyświetlane jest tylko jedno działanie komentarza.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-297">In the above case, only one comment activity is shown.</span></span>  <span data-ttu-id="9c1b0-298">Liczba działań związanych z komentarzem została zmieniona w celu symulowania złożoności przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-298">The number of comment activities is changed to simulate workflow complexity.</span></span>  <span data-ttu-id="9c1b0-299">Działanie comment jest równoznaczne z WF3 <xref:System.Workflow.Activities.CodeActivity> , który nie wykonuje żadnych działań.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-299">A comment activity is equivalent to a WF3 <xref:System.Workflow.Activities.CodeActivity> that performs no work.</span></span> <span data-ttu-id="9c1b0-300">Aby uzyskać więcej informacji na temat działania komentarza, zobacz sekcję "porównanie wydajności na poziomie składników" wcześniej w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-300">For more information about the comment activity, see the "Component-level Performance Comparison" section earlier in this article.</span></span>

##### <a name="test-results"></a><span data-ttu-id="9c1b0-301">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="9c1b0-301">Test Results</span></span>

 <span data-ttu-id="9c1b0-302">Oczekiwanie na zimne i ciepłe usługi przepływu pracy WCF:</span><span class="sxs-lookup"><span data-stu-id="9c1b0-302">Cold and warm latency for WCF workflow services:</span></span>

 ![Wykres kolumnowy przedstawiający czas oczekiwania na zimne i ciepłe usługi przepływu pracy WCF przy użyciu WF3 i WF4](./media/performance/latency-results-graph.gif)

 <span data-ttu-id="9c1b0-304">Na poprzednim wykresie zimny odnosi się do przypadku, gdy nie istnieje istniejący <xref:System.ServiceModel.WorkflowServiceHost> dla danego przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-304">In the previous chart, cold refers to the case where there is not an existing <xref:System.ServiceModel.WorkflowServiceHost> for the given workflow.</span></span>  <span data-ttu-id="9c1b0-305">Innymi słowy, podczas gdy przepływ pracy jest używany po raz pierwszy, a plik XOML lub XAML musi zostać skompilowany.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-305">In other words, cold latency is when the workflow is being used for the first time and the XOML or XAML needs to be compiled.</span></span>  <span data-ttu-id="9c1b0-306">Opóźnienie rozgrzane to czas, aby utworzyć nowe wystąpienie przepływu pracy, gdy typ przepływu pracy został już skompilowany.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-306">Warm latency is the time to create a new workflow instance when the workflow type has already been compiled.</span></span>  <span data-ttu-id="9c1b0-307">Złożoność przepływu pracy powoduje bardzo małą różnicę w przypadku WF4, ale ma liniowy postęp w przypadku WF3.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-307">The complexity of the workflow makes very little difference in the WF4 case but has a linear progression in the WF3 case.</span></span>

#### <a name="correlation-throughput"></a><span data-ttu-id="9c1b0-308">Przepływność korelacji</span><span class="sxs-lookup"><span data-stu-id="9c1b0-308">Correlation Throughput</span></span>
 <span data-ttu-id="9c1b0-309">WF4 wprowadza nową funkcję korelacji opartą na zawartości.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-309">WF4 introduces a new content-based correlation feature.</span></span>  <span data-ttu-id="9c1b0-310">WF3 udostępnia tylko korelację opartą na kontekście.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-310">WF3 provided only context-based correlation.</span></span>  <span data-ttu-id="9c1b0-311">Korelację opartą na kontekście można wykonać tylko dla określonych powiązań kanałów WCF.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-311">Context-based correlation could only be done over specific WCF channel bindings.</span></span>  <span data-ttu-id="9c1b0-312">Identyfikator przepływu pracy jest wstawiany do nagłówka komunikatu podczas korzystania z tych powiązań.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-312">The workflow Id is inserted into the message header when using these bindings.</span></span>  <span data-ttu-id="9c1b0-313">Środowisko uruchomieniowe WF3 może zidentyfikować tylko przepływ pracy na podstawie jego identyfikatora.  W przypadku korelacji opartej na zawartości Autor przepływu pracy może utworzyć klucz korelacji z odpowiedniego fragmentu danych, takiego jak numer konta lub identyfikator klienta.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-313">The WF3 runtime could only identify a workflow by its Id.  With content-based correlation, the workflow author can create a correlation key out of a relevant piece of data like an account number or customer Id.</span></span>

 <span data-ttu-id="9c1b0-314">Korelacja oparta na kontekście ma zalety wydajności w przypadku, gdy klucz korelacji znajduje się w nagłówku komunikatu.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-314">Context-based correlation has a performance advantage in that the correlation key is located in the message header.</span></span>  <span data-ttu-id="9c1b0-315">Klucz można odczytać z komunikatu bez deserializacji/kopiowania komunikatów.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-315">The key can be read from the message without de-serialization/message-copying.</span></span>  <span data-ttu-id="9c1b0-316">W korelacji opartej na zawartości klucz korelacji jest przechowywany w treści komunikatu.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-316">In content-based correlation, the correlation key is stored in the message body.</span></span>  <span data-ttu-id="9c1b0-317">Wyrażenie XPath służy do lokalizowania klucza.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-317">An XPath expression is used to locate the key.</span></span>  <span data-ttu-id="9c1b0-318">Koszt tego dodatkowego przetwarzania zależy od rozmiaru wiadomości, głębokości klucza w treści i liczby kluczy...</span><span class="sxs-lookup"><span data-stu-id="9c1b0-318">The cost of this extra processing depends on the size of the message, depth of the key in the body, and the number of keys.</span></span>  <span data-ttu-id="9c1b0-319">Ten test porównuje korelację opartą na kontekście i treści, a także pokazuje spadek wydajności podczas korzystania z wielu kluczy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-319">This test compares context- and content-based correlation and also shows the performance degradation when using multiple keys.</span></span>

#### <a name="environment-setup"></a><span data-ttu-id="9c1b0-320">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="9c1b0-320">Environment Setup</span></span>
![Konfiguracja środowiska dla testu wydajności przepływu pracy](./media/performance/performance-test-environment.gif)

#### <a name="test-setup"></a><span data-ttu-id="9c1b0-322">Konfiguracja testu</span><span class="sxs-lookup"><span data-stu-id="9c1b0-322">Test Setup</span></span>
<span data-ttu-id="9c1b0-323">![Test przepływu pracy korelacji przepływności](./media/performance/correlation-throughput-workflow.gif "Konfiguracja testu przepływu pracy korelacji przepływności")</span><span class="sxs-lookup"><span data-stu-id="9c1b0-323">![Correlation Throughput Workflow Test](./media/performance/correlation-throughput-workflow.gif "Correlation throughput workflow test setup")</span></span>

 <span data-ttu-id="9c1b0-324">Poprzedni przepływ pracy jest taki sam, jak użyty w sekcji [trwałość](#persistence) .</span><span class="sxs-lookup"><span data-stu-id="9c1b0-324">The previous workflow is the same one used in the [Persistence](#persistence) section.</span></span> <span data-ttu-id="9c1b0-325">W przypadku testów korelacji bez trwałości nie ma żadnego dostawcy trwałości zainstalowanego w czasie wykonywania.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-325">For the correlation tests without persistence, there is no persistence provider installed in the runtime.</span></span> <span data-ttu-id="9c1b0-326">Korelacja występuje w dwóch miejscach: CompleteOrder i.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-326">Correlation occurs in two places: CreateOrder and CompleteOrder.</span></span>

#### <a name="test-results"></a><span data-ttu-id="9c1b0-327">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="9c1b0-327">Test Results</span></span>
<span data-ttu-id="9c1b0-328">![Przepływność korelacji](./media/performance/correlation-throughput-graph.gif "Wykres przepływności korelacji")</span><span class="sxs-lookup"><span data-stu-id="9c1b0-328">![Correlation Throughput](./media/performance/correlation-throughput-graph.gif "Correlation throughput graph")</span></span>

 <span data-ttu-id="9c1b0-329">Ten wykres przedstawia spadek wydajności w miarę zwiększania się liczby kluczy używanych w ramach korelacji opartej na zawartości.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-329">This graph shows a decrease in performance as the number of keys used in content-based correlation increases.</span></span>  <span data-ttu-id="9c1b0-330">Podobieństwo krzywej między TCP i HTTP wskazuje obciążenie związane z tymi protokołami.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-330">The similarity in the curves between TCP and HTTP indicates the overhead associated with these protocols.</span></span>

#### <a name="correlation-with-persistence"></a><span data-ttu-id="9c1b0-331">Korelacja z trwałością</span><span class="sxs-lookup"><span data-stu-id="9c1b0-331">Correlation with Persistence</span></span>
 <span data-ttu-id="9c1b0-332">W przypadku utrwalonego przepływu pracy wykorzystanie procesora CPU z korelacji opartej na zawartości jest przesunięte ze środowiska uruchomieniowego przepływu pracy do bazy danych SQL.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-332">With a persisted workflow, the CPU pressure from content-based correlation shifts from the workflow runtime to the SQL database.</span></span>  <span data-ttu-id="9c1b0-333">Procedury składowane w dostawcy trwałości SQL wykonują zadania pasujące do kluczy, aby zlokalizować odpowiedni przepływ pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-333">The stored procedures in the SQL persistence provider do the work of matching the keys to locate the appropriate workflow.</span></span>

 ![Wykres liniowy przedstawiający korelację i wyniki trwałości](./media/performance/correlation-persistence-graph.gif)

 <span data-ttu-id="9c1b0-335">Korelacja oparta na kontekście jest ciągle szybsza niż korelacja oparta na zawartości.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-335">Context-based correlation is still faster than content-based correlation.</span></span>  <span data-ttu-id="9c1b0-336">Różnica jest jednak mniej wymawiana, ponieważ trwałość ma większy wpływ na wydajność niż korelacja.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-336">However, the difference is less pronounced as persistence has more impact on performance than correlation.</span></span>

### <a name="complex-workflow-throughput"></a><span data-ttu-id="9c1b0-337">Przepływność złożonych przepływów pracy</span><span class="sxs-lookup"><span data-stu-id="9c1b0-337">Complex Workflow Throughput</span></span>
 <span data-ttu-id="9c1b0-338">Złożoność przepływu pracy nie jest mierzona tylko przez liczbę działań.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-338">The complexity of a workflow is not measured only by the number of activities.</span></span>  <span data-ttu-id="9c1b0-339">Działania złożone mogą zawierać wiele elementów podrzędnych i te elementy podrzędne mogą również być działaniami złożonymi.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-339">Composite activities can contain many children and those children can also be composite activities.</span></span>  <span data-ttu-id="9c1b0-340">Liczba poziomów wzrostu zagnieżdżenia, dlatego liczba działań, które mogą być obecnie w stanie wykonywania, oraz liczba zmiennych, które mogą być w stanie.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-340">As the number of levels of nesting increases, so does the number of activities that can be currently in the executing state and the number of variables that can be in state.</span></span>  <span data-ttu-id="9c1b0-341">Ten test porównuje przepływność między WF3 i WF4 podczas wykonywania złożonych przepływów pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-341">This test compares throughput between WF3 and WF4 when executing complex workflows.</span></span>

### <a name="test-setup"></a><span data-ttu-id="9c1b0-342">Konfiguracja testu</span><span class="sxs-lookup"><span data-stu-id="9c1b0-342">Test Setup</span></span>
 <span data-ttu-id="9c1b0-343">Te testy zostały wykonane na komputerze z procesorem Intel Xeon X5355 @ ośmiordzeniowy 2,66 GHz, a 4 GB pamięci RAM z systemem Windows Server 2008 x64.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-343">These tests were executed on an Intel Xeon X5355 @ 2.66GHz 4-way computer with 4GB RAM running Windows Server 2008 x64.</span></span>  <span data-ttu-id="9c1b0-344">Kod testu jest uruchamiany w jednym procesie z jednym wątkiem na rdzeń, aby osiągnąć 100% użycia procesora CPU.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-344">The test code runs in a single process with one thread per core to reach 100% CPU utilization.</span></span>

 <span data-ttu-id="9c1b0-345">Przepływy pracy wygenerowane dla tego testu mają dwie zmienne główne: głębokość i liczbę działań w każdej sekwencji.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-345">The workflows generated for this test have two main variables: depth and number of activities in each sequence.</span></span>  <span data-ttu-id="9c1b0-346">Każdy poziom głębokości obejmuje aktywność równoległą, podczas gdy pętla, decyzje, przypisania i sekwencje.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-346">Each depth level includes a parallel activity, while loop, decisions, assignments, and sequences.</span></span>  <span data-ttu-id="9c1b0-347">W programie WF4 Designer poniżej znajduje się wykres przepływu najwyższego poziomu.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-347">In the WF4 designer pictured below, the top-level flow chart is pictured.</span></span>  <span data-ttu-id="9c1b0-348">Każde działanie Flowchart jest podobne do głównego schematu blokowego.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-348">Each flowchart activity resembles the main flowchart.</span></span>  <span data-ttu-id="9c1b0-349">Pomocne może być Fractal, gdy Picturing ten przepływ pracy, gdzie głębokość jest ograniczona do parametrów testu.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-349">It may be helpful to think of a fractal when picturing this workflow, where the depth is limited to the parameters of the test.</span></span>

 <span data-ttu-id="9c1b0-350">Liczba działań w danym teście zależy od głębokości i liczby działań na sekwencję.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-350">The number of activities in a given test is determined by the depth and number of activities per sequence.</span></span>  <span data-ttu-id="9c1b0-351">Poniższe równanie oblicza liczbę działań w teście WF4:</span><span class="sxs-lookup"><span data-stu-id="9c1b0-351">The following equation computes the number of activities in the WF4 test:</span></span>

 ![Równanie do liczby działań obliczeniowych](./media/performance/number-activities-equation.gif)

 <span data-ttu-id="9c1b0-353">Liczba działań testu WF3 można obliczyć przy użyciu nieco innego równania z powodu dodatkowej sekwencji:</span><span class="sxs-lookup"><span data-stu-id="9c1b0-353">The WF3 test’s activity count can be computed with a slightly different equation due to an extra sequence:</span></span>

 ![Równanie do liczby obliczeń WF3 działań](./media/performance/wf3-number-activities-equation.gif)

 <span data-ttu-id="9c1b0-355">Gdzie d to głębokość, a to liczba działań na sekwencję.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-355">Where d is the depth and a is the number of activities per sequence.</span></span>  <span data-ttu-id="9c1b0-356">Logika za te równania polega na tym, że pierwsza stała, pomnożona przez, jest liczbą sekwencji, a druga stała jest statyczną liczbą działań na bieżącym poziomie.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-356">The logic behind these equations is that the first constant, multiplied by a, is the number of sequences and the second constant is the static number of activities in the current level.</span></span>  <span data-ttu-id="9c1b0-357">Każdy schemat blokowy zawiera trzy działania podrzędne schematu blokowego.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-357">There are three flowchart child activities in each flowchart.</span></span>  <span data-ttu-id="9c1b0-358">Na niższym poziomie głębokości te schematy blokowe są puste, ale na innych poziomach są to kopie głównego schematu blokowego.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-358">At the bottom depth level, these flowcharts are empty but at the other levels they are copies of the main flowchart.</span></span>  <span data-ttu-id="9c1b0-359">W poniższej tabeli przedstawiono liczbę działań w definicji przepływu pracy każdej z odmian testowych:</span><span class="sxs-lookup"><span data-stu-id="9c1b0-359">The number of activities in each test variation’s workflow definition is indicated in the following table:</span></span>

 ![Tabela przedstawiająca liczbę działań użytych w każdym teście](./media/performance/workflow-variation-compare-table.gif)

 <span data-ttu-id="9c1b0-361">Liczba działań w definicji przepływu pracy rośnie gwałtownie z każdym poziomem głębokości.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-361">The number of activities in the workflow definition increases sharply with each depth level.</span></span>  <span data-ttu-id="9c1b0-362">Ale tylko jedna ścieżka na punkt decyzyjny jest wykonywana w danym wystąpieniu przepływu pracy, więc wykonywane jest tylko niewielki podzestaw rzeczywistych działań.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-362">But only one path per decision point is executed in a given workflow instance, so only a small subset of the actual activities are executed.</span></span>

 ![Schemat blokowy przepływu pracy złożonej przepływności](./media/performance/complex-workflow-throughput-workflow.gif)

 <span data-ttu-id="9c1b0-364">Utworzono równoważny przepływ pracy dla WF3.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-364">An equivalent workflow was created for WF3.</span></span> <span data-ttu-id="9c1b0-365">Projektant WF3 wyświetla cały przepływ pracy w obszarze projektowania zamiast zagnieżdżania, w związku z czym jest zbyt duży do wyświetlenia w tym temacie.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-365">The WF3 designer shows the entire workflow in the design area instead of nesting, therefore it is too big to display in this topic.</span></span> <span data-ttu-id="9c1b0-366">Poniżej przedstawiono fragment przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-366">A snippet of the workflow is shown below.</span></span>

 ![Fragment kodu schematu przepływu pracy WF3](./media/performance/wf3-workflow-snippet.gif)

 <span data-ttu-id="9c1b0-368">Aby wykonać zagnieżdżenie w skrajnym przypadku, inny przepływ pracy, który jest częścią tego testu, korzysta z 100 sekwencji zagnieżdżonych.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-368">To exercise nesting in an extreme case, another workflow that is part of this test uses 100 nested sequences.</span></span>  <span data-ttu-id="9c1b0-369">W wewnętrznej sekwencji jest pojedyncza `Comment` lub <xref:System.Workflow.Activities.CodeActivity> .</span><span class="sxs-lookup"><span data-stu-id="9c1b0-369">In the innermost sequence is a single `Comment` or <xref:System.Workflow.Activities.CodeActivity>.</span></span>

 ![Schemat blokowy sekwencji zagnieżdżonej](./media/performance/nested-sequence-workflow.gif)

 <span data-ttu-id="9c1b0-371">Śledzenie i trwałość nie są używane w ramach tego testu.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-371">Tracking and persistence are not used as part of this test.</span></span>

### <a name="test-results"></a><span data-ttu-id="9c1b0-372">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="9c1b0-372">Test Results</span></span>
 ![Wykres kolumnowy przedstawiający wyniki wydajności przepływności](./media/performance/throughput-performance-results.gif)

 <span data-ttu-id="9c1b0-374">Nawet w przypadku złożonych przepływów pracy ze znaczną głębokością i dużą liczbą działań wyniki wydajności są spójne z innymi numerami przepływności przedstawionymi wcześniej w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-374">Even with complex workflows with lots of depth and a high number of activities, the performance results are consistent with other throughput numbers shown earlier in this article.</span></span>  <span data-ttu-id="9c1b0-375">WF4's przepływność jest znacznie szybsza i musi być porównana z skalą logarytmiczną.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-375">WF4’s throughput is orders of magnitude faster and has to be compared on a logarithmic scale.</span></span>

### <a name="memory"></a><span data-ttu-id="9c1b0-376">Pamięć</span><span class="sxs-lookup"><span data-stu-id="9c1b0-376">Memory</span></span>
 <span data-ttu-id="9c1b0-377">Obciążenie pamięcią Windows Workflow Foundation jest mierzone w dwóch kluczowych obszarach: złożoność przepływu pracy i liczba definicji przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-377">The memory overhead of Windows Workflow Foundation is measured in two key areas: workflow complexity and number of workflow definitions.</span></span>  <span data-ttu-id="9c1b0-378">Pomiary pamięci zostały wykonane na stacji roboczej systemu Windows 7 64-bitowego.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-378">Memory measurements were taken on a Windows 7 64-bit workstation.</span></span>  <span data-ttu-id="9c1b0-379">Istnieje wiele sposobów uzyskania pomiaru rozmiaru zestawu roboczego, takiego jak monitorowanie liczników wydajności, środowisko sondowania środowiska. zestaw roboczy lub używanie narzędzia, takiego jak VMMap dostępne z [VMMap](/sysinternals/downloads/vmmap).</span><span class="sxs-lookup"><span data-stu-id="9c1b0-379">There are many ways to obtain the measurement of working set size such as monitoring performance counters, polling Environment.WorkingSet, or using a tool like VMMap available from [VMMap](/sysinternals/downloads/vmmap).</span></span> <span data-ttu-id="9c1b0-380">Kombinacja metod została użyta w celu uzyskania i sprawdzenia wyników każdego testu.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-380">A combination of methods was used to obtain and verify the results of each test.</span></span>

### <a name="workflow-complexity-test"></a><span data-ttu-id="9c1b0-381">Test złożoności przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="9c1b0-381">Workflow Complexity Test</span></span>
 <span data-ttu-id="9c1b0-382">Test złożoności przepływu pracy mierzy różnicę zestawu roboczego na podstawie złożoności przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-382">The workflow complexity test measures the working set difference based on the complexity of the workflow.</span></span>  <span data-ttu-id="9c1b0-383">Oprócz złożonych przepływów pracy używanych w poprzedniej sekcji nowe odmiany są dodawane w celu pokrycia dwóch podstawowych przypadków: przepływu pracy pojedynczego działania i sekwencji z 1000 działaniami.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-383">In addition to the complex workflows used in the previous section, new variations are added to cover two basic cases: a single activity workflow and a sequence with 1000 activities.</span></span>  <span data-ttu-id="9c1b0-384">Dla tych testów przepływy pracy są inicjowane i wykonywane do ukończenia w pojedynczej pętli szeregowej przez okres jednej minuty.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-384">For these tests the workflows are initialized and executed to completion in a single serial loop for a period of one minute.</span></span>  <span data-ttu-id="9c1b0-385">Każda odmiana testowa jest uruchamiana trzy razy, a dane zarejestrowane to średnia z tych trzech przebiegów.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-385">Each test variation is run three times and the data recorded is the average of those three runs.</span></span>

 <span data-ttu-id="9c1b0-386">Dwa nowe podstawowe testy mają przepływy pracy, które wyglądają jak te pokazane poniżej:</span><span class="sxs-lookup"><span data-stu-id="9c1b0-386">The two new basic tests have workflows that look like those shown below:</span></span>

 ![Złożony przepływ pracy dla zarówno WF3, jak i WF4](./media/performance/complex-workflow-wf3-wf4.gif)

 <span data-ttu-id="9c1b0-388">W pokazanym powyżej przepływie pracy WF3 <xref:System.Workflow.Activities.CodeActivity> są używane puste działania.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-388">In the WF3 workflow shown above, empty <xref:System.Workflow.Activities.CodeActivity> activities are used.</span></span>  <span data-ttu-id="9c1b0-389">W przepływie pracy WF4 powyżej są wykorzystywane `Comment` działania.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-389">The WF4 workflow above uses `Comment` activities.</span></span>  <span data-ttu-id="9c1b0-390">`Comment`Działanie zostało opisane w sekcji porównania wydajności na poziomie składnika wcześniej w tym artykule.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-390">The `Comment` activity was described in the Component-level Performance Comparisons section earlier in this article.</span></span>

 ![Wykres kolumnowy przedstawiający złożone użycie pamięci przepływu pracy dla przepływów pracy WF3 i WF4](./media/performance/complex-memory-usage-wf3-wf4.gif)

 <span data-ttu-id="9c1b0-392">Jedną z oczywistych trendów, które należy zwrócić na ten Graf, jest to, że zagnieżdżanie ma stosunkowo minimalny wpływ na użycie pamięci zarówno w WF3, jak i w WF4.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-392">One of the clear trends to notice in this graph is that nesting has relatively minimal impact on memory usage in both WF3 and WF4.</span></span>  <span data-ttu-id="9c1b0-393">Najbardziej znaczący wpływ na pamięć pochodzi z liczby działań w danym przepływie pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-393">The most significant memory impact comes from the number of activities in a given workflow.</span></span>  <span data-ttu-id="9c1b0-394">Dane z sekwencji 1000, złożonej głębokości 5 sekwencji 5 i złożoności złożonej 7 sekwencji 1 są oczywiste, ponieważ liczba działań przejdzie do tysięcy, a wzrost wykorzystania pamięci będzie bardziej zauważalny.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-394">Given the data from the sequence 1000, complex depth 5 sequence 5, and complex depth 7 sequence 1 variations, it is clear that as the number of activities enters the thousands, the memory usage increase becomes more noticeable.</span></span>  <span data-ttu-id="9c1b0-395">W skrajnym przypadku (głębokość 7 sekwencji 1), w której znajdują się 29K działania, WF4 używa niemal 79% mniej pamięci niż WF3.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-395">In the extreme case (depth 7 sequence 1) where there are ~29K activities, WF4 is using almost 79% less memory than WF3.</span></span>

### <a name="multiple-workflow-definitions-test"></a><span data-ttu-id="9c1b0-396">Test wielu definicji przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="9c1b0-396">Multiple Workflow Definitions Test</span></span>
 <span data-ttu-id="9c1b0-397">Pomiar ilości pamięci na definicję przepływu pracy jest podzielony na dwa różne testy ze względu na dostępne opcje hostingu przepływów pracy w WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-397">Measuring memory per workflow definition is divided into two different tests because of the available options for hosting workflows in WF3 and WF4.</span></span>  <span data-ttu-id="9c1b0-398">Testy są uruchamiane w inny sposób niż w teście złożoności przepływu pracy w przypadku wystąpienia danego przepływu pracy, który jest wykonywany tylko raz dla każdej definicji.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-398">The tests are run in a different manner than the workflow complexity test in that a given workflow is instanced and executed only once per definition.</span></span>  <span data-ttu-id="9c1b0-399">Wynika to z faktu, że definicja przepływu pracy i jego host pozostają w pamięci przez okres istnienia elementu AppDomain.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-399">This is because the workflow definition and its host remain in memory for the lifetime of the AppDomain.</span></span>  <span data-ttu-id="9c1b0-400">Podczas wyrzucania elementów bezużytecznych należy oczyścić pamięć używaną przez uruchomienie danego wystąpienia przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-400">The memory used by running a given workflow instance should be cleaned up during garbage collection.</span></span>  <span data-ttu-id="9c1b0-401">Wskazówki dotyczące migracji WF4 zawierają bardziej szczegółowe informacje na temat opcji hostingu.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-401">The migration guidance for WF4 contains more detailed information on the hosting options.</span></span> <span data-ttu-id="9c1b0-402">Aby uzyskać więcej informacji, zobacz temat [migracja WF Cookbook: hosting przepływu pracy](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="9c1b0-402">For more information, see [WF Migration Cookbook: Workflow Hosting](migration-guidance.md).</span></span>

 <span data-ttu-id="9c1b0-403">Tworzenie wielu definicji przepływu pracy dla testu definicji przepływu pracy można wykonać na kilka sposobów.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-403">Creating many workflow definitions for a workflow definition test can be done in several ways.</span></span>  <span data-ttu-id="9c1b0-404">Na przykład, jeden może użyć generowania kodu, aby utworzyć zestaw 1000 przepływów pracy, które są identyczne, z wyjątkiem nazwy i Zapisz każdy z tych przepływów pracy w oddzielnych plikach.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-404">For instance, one could use code generation to create a set of 1000 workflows that are identical except in name and save each of those workflows into separate files.</span></span>  <span data-ttu-id="9c1b0-405">To podejście zostało wykonane dla testu obsługiwanego przez konsolę.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-405">This approach was taken for the console-hosted test.</span></span>  <span data-ttu-id="9c1b0-406">W WF3, <xref:System.Workflow.Runtime.WorkflowRuntime> Klasa była używana do uruchamiania definicji przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-406">In WF3, the <xref:System.Workflow.Runtime.WorkflowRuntime> class was used to run the workflow definitions.</span></span>  <span data-ttu-id="9c1b0-407">WF4 może użyć <xref:System.Activities.WorkflowApplication> , aby utworzyć pojedyncze wystąpienie przepływu pracy lub bezpośrednio użyć <xref:System.Activities.WorkflowInvoker> do uruchomienia działania tak, jakby było wywołaniem metody.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-407">WF4 can either use <xref:System.Activities.WorkflowApplication> to create a single workflow instance or directly use <xref:System.Activities.WorkflowInvoker> to run the activity as if it were a method call.</span></span>  <span data-ttu-id="9c1b0-408"><xref:System.Activities.WorkflowApplication> jest hostem pojedynczego wystąpienia przepływu pracy i ma bliższą parzystość funkcji <xref:System.Workflow.Runtime.WorkflowRuntime> , która została użyta w tym teście.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-408"><xref:System.Activities.WorkflowApplication> is a host of a single workflow instance and has closer feature parity to <xref:System.Workflow.Runtime.WorkflowRuntime> so that was used in this test.</span></span>

 <span data-ttu-id="9c1b0-409">Podczas hostowania przepływów pracy w usługach IIS można użyć programu, <xref:System.Web.Hosting.VirtualPathProvider> Aby utworzyć nowy <xref:System.ServiceModel.WorkflowServiceHost> zamiast generować wszystkie pliki xamlx lub xoml.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-409">When hosting workflows in IIS it is possible to use a <xref:System.Web.Hosting.VirtualPathProvider> to create a new <xref:System.ServiceModel.WorkflowServiceHost> instead of generating all of the XAMLX or XOML files.</span></span>  <span data-ttu-id="9c1b0-410"><xref:System.Web.Hosting.VirtualPathProvider>Obsługuje przychodzące żądanie i odpowiada za pomocą "pliku wirtualnego", który można załadować z bazy danych lub, w tym przypadku, generowany na bieżąco.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-410">The <xref:System.Web.Hosting.VirtualPathProvider> handles the incoming request and responds with a "virtual file" that can be loaded from a database or, in this case, generated on the fly.</span></span>  <span data-ttu-id="9c1b0-411">W związku z tym nie trzeba tworzyć plików fizycznych 1000.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-411">It is therefore unnecessary to create 1000 physical files.</span></span>

 <span data-ttu-id="9c1b0-412">Definicje przepływów pracy używane w teście konsoli były prostymi sekwencyjnymi przepływami pracy z pojedynczym działaniem.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-412">The workflow definitions used in the console test were simple sequential workflows with a single activity.</span></span>  <span data-ttu-id="9c1b0-413">Pojedyncze działanie było puste <xref:System.Workflow.Activities.CodeActivity> dla przypadku WF3 i `Comment` działania w przypadku WF4 przypadku.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-413">The single activity was an empty <xref:System.Workflow.Activities.CodeActivity> for the WF3 case and a `Comment` activity for the WF4 case.</span></span>  <span data-ttu-id="9c1b0-414">Oparte na usługach IIS przepływy pracy, które zaczynają się otrzymywać po odebraniu komunikatu i kończący wysyłanie odpowiedzi:</span><span class="sxs-lookup"><span data-stu-id="9c1b0-414">The IIS-hosted case used workflows that start on receiving a message and end on sending a reply:</span></span>

<span data-ttu-id="9c1b0-415">Na poniższej ilustracji przedstawiono przepływ pracy WF3 z funkcją Receives i przepływ pracy WF4 z wzorcem żądania/odpowiedzi:</span><span class="sxs-lookup"><span data-stu-id="9c1b0-415">The following image shows a WF3 workflow with ReceiveActivity and a WF4 workflow with request/response pattern:</span></span>

 ![Usługi przepływu pracy w WF3 i WF4](./media/performance/workflow-receive-activity.gif)

 <span data-ttu-id="9c1b0-417">W poniższej tabeli przedstawiono różnice w zestawie roboczym między jedną definicją przepływu pracy i definicjami 1001:</span><span class="sxs-lookup"><span data-stu-id="9c1b0-417">The following table shows the delta in working set between a single workflow definition and 1001 definitions:</span></span>

|<span data-ttu-id="9c1b0-418">Opcje hostingu</span><span class="sxs-lookup"><span data-stu-id="9c1b0-418">Hosting Options</span></span>|<span data-ttu-id="9c1b0-419">WF3 Delta zestawu roboczego</span><span class="sxs-lookup"><span data-stu-id="9c1b0-419">WF3 Working Set Delta</span></span>|<span data-ttu-id="9c1b0-420">WF4 Delta zestawu roboczego</span><span class="sxs-lookup"><span data-stu-id="9c1b0-420">WF4 Working Set Delta</span></span>|
|---------------------|---------------------------|---------------------------|
|<span data-ttu-id="9c1b0-421">Hostowane przepływy pracy aplikacji konsolowej</span><span class="sxs-lookup"><span data-stu-id="9c1b0-421">Console Application Hosted Workflows</span></span>|<span data-ttu-id="9c1b0-422">18 MB</span><span class="sxs-lookup"><span data-stu-id="9c1b0-422">18 MB</span></span>|<span data-ttu-id="9c1b0-423">9 MB</span><span class="sxs-lookup"><span data-stu-id="9c1b0-423">9 MB</span></span>|
|<span data-ttu-id="9c1b0-424">Hostowane usługi przepływu pracy usług IIS</span><span class="sxs-lookup"><span data-stu-id="9c1b0-424">IIS Hosted Workflow Services</span></span>|<span data-ttu-id="9c1b0-425">446 MB</span><span class="sxs-lookup"><span data-stu-id="9c1b0-425">446 MB</span></span>|<span data-ttu-id="9c1b0-426">364 MB</span><span class="sxs-lookup"><span data-stu-id="9c1b0-426">364 MB</span></span>|

 <span data-ttu-id="9c1b0-427">Hostowanie definicji przepływu pracy w usługach IIS zużywa znacznie więcej pamięci ze względu na <xref:System.ServiceModel.WorkflowServiceHost> szczegółowe artefakty usługi WCF i logikę przetwarzania komunikatów skojarzoną z hostem.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-427">Hosting workflow definitions in IIS consumes much more memory due to the <xref:System.ServiceModel.WorkflowServiceHost>, detailed WCF service artifacts, and the message processing logic associated with the host.</span></span>

 <span data-ttu-id="9c1b0-428">W przypadku hostingu konsoli w programie WF3 przepływy pracy zostały zaimplementowane w kodzie zamiast pliku XOML.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-428">For console hosting in WF3 the workflows were implemented in code instead of XOML.</span></span>  <span data-ttu-id="9c1b0-429">W WF4 wartość domyślna to użycie języka XAML.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-429">In WF4 the default is to use XAML.</span></span>  <span data-ttu-id="9c1b0-430">KOD XAML jest przechowywany jako zasób osadzony w zestawie i kompilowany w czasie wykonywania, aby zapewnić implementację przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-430">The XAML is stored as an embedded resource in the assembly and compiled during runtime to provide the implementation of the workflow.</span></span>  <span data-ttu-id="9c1b0-431">Ten proces wiąże się z pewnym obciążeniem.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-431">There is some overhead associated with this process.</span></span>  <span data-ttu-id="9c1b0-432">Aby zapewnić rzetelne porównanie między WF3 i WF4, zamiast języka XAML były używane kodowane przepływy pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-432">In order to make a fair comparison between WF3 and WF4, coded workflows were used instead of XAML.</span></span>  <span data-ttu-id="9c1b0-433">Poniżej przedstawiono przykład jednego z przepływów pracy WF4:</span><span class="sxs-lookup"><span data-stu-id="9c1b0-433">An example of one of the WF4 workflows is shown below:</span></span>

```csharp
public class Workflow1 : Activity
{
    protected override Func<Activity> Implementation
    {
        get
        {
            return new Func<Activity>(() =>
            {
                return new Sequence
                {
                    Activities = {
                        new Comment()
                    }
                };
            });
        }
        set
        {
            base.Implementation = value;
        }
    }
}
```

 <span data-ttu-id="9c1b0-434">Istnieje wiele innych czynników, które mogą mieć wpływ na użycie pamięci.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-434">There are many other factors that can affect memory consumption.</span></span> <span data-ttu-id="9c1b0-435">Te same porady dotyczące wszystkich programów zarządzanych nadal mają zastosowanie.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-435">The same advice for all managed programs still applies.</span></span>  <span data-ttu-id="9c1b0-436">W środowiskach hostowanych przez usługi IIS <xref:System.ServiceModel.WorkflowServiceHost> obiekt utworzony dla definicji przepływu pracy pozostaje w pamięci do momentu odtworzenia puli aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-436">In IIS-hosted environments, the <xref:System.ServiceModel.WorkflowServiceHost> object created for a workflow definition stays in memory until the application pool is recycled.</span></span>  <span data-ttu-id="9c1b0-437">Należy pamiętać o tym podczas pisania rozszerzeń.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-437">This should be kept in mind when writing extensions.</span></span>  <span data-ttu-id="9c1b0-438">Ponadto najlepiej jest unikać zmiennych "Global" (zmiennych w zakresie całego przepływu pracy) i ograniczyć zakres zmiennych wszędzie tam, gdzie to możliwe.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-438">Also, it is best to avoid "global" variables (variables scoped to the whole workflow) and limit the scope of variables wherever possible.</span></span>

## <a name="workflow-runtime-services"></a><span data-ttu-id="9c1b0-439">Usługi środowiska uruchomieniowego przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="9c1b0-439">Workflow Runtime Services</span></span>

### <a name="persistence"></a><span data-ttu-id="9c1b0-440">Trwałość</span><span class="sxs-lookup"><span data-stu-id="9c1b0-440">Persistence</span></span>
 <span data-ttu-id="9c1b0-441">WF3 i WF4 są dostarczane z dostawcą trwałości SQL.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-441">WF3 and WF4 both ship with a SQL persistence provider.</span></span>  <span data-ttu-id="9c1b0-442">Dostawca trwałości SQL WF3 jest prostą implementacją, która serializować wystąpienie przepływu pracy i zapisuje je w obiekcie blob.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-442">The WF3 SQL persistence provider is a simple implementation that serializes the workflow instance and stores it in a blob.</span></span>  <span data-ttu-id="9c1b0-443">Z tego powodu wydajność tego dostawcy zależy w dużym stopniu od rozmiaru wystąpienia przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-443">For this reason, the performance of this provider depends heavily on the size of the workflow instance.</span></span>  <span data-ttu-id="9c1b0-444">W WF3 rozmiar wystąpienia może wzrosnąć z wielu powodów, jak opisano wcześniej w tym dokumencie.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-444">In WF3, the instance size could increase for many reasons, as is discussed previously in this paper.</span></span>  <span data-ttu-id="9c1b0-445">Wielu klientów zdecyduje się nie używać domyślnego dostawcy trwałości SQL, ponieważ przechowywanie serializowanego wystąpienia w bazie danych nie zapewnia wglądu w stan przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-445">Many customers choose not to use the default SQL persistence provider because storing a serialized instance in a database gives no visibility into the state of the workflow.</span></span>  <span data-ttu-id="9c1b0-446">Aby znaleźć konkretny przepływ pracy bez znajomości identyfikatora przepływu pracy, jeden z nich będzie musiał rozszeregować każde trwałe wystąpienie i sprawdzić zawartość.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-446">In order to find a particular workflow without knowing the workflow id, one would have to deserialize each persisted instance and examine the contents.</span></span>  <span data-ttu-id="9c1b0-447">Wielu deweloperów woli napisać własnych dostawców trwałości do pokonania tej przeszkody.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-447">Many developers prefer to write their own persistence providers to overcome this obstacle.</span></span>

 <span data-ttu-id="9c1b0-448">Dostawca trwałości SQL WF4 próbował rozwiązać niektóre z tych problemów.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-448">The WF4 SQL persistence provider has tried to address some of these concerns.</span></span>  <span data-ttu-id="9c1b0-449">Tabele trwałości uwidaczniają pewne informacje, takie jak aktywne zakładki i właściwości promocji.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-449">The persistence tables expose certain information such as the active bookmarks and promotable properties.</span></span>  <span data-ttu-id="9c1b0-450">Nowa funkcja korelacji oparta na zawartości w programie WF4 nie będzie działać prawidłowo przy użyciu metody trwałości SQL WF3, która jest oparta na pewnych zmianach w organizacji wystąpienia utrwalonego przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-450">The new content-based correlation feature in WF4 would not perform well using the WF3 SQL persistence approach, which has driven some change in the organization of the persisted workflow instance.</span></span>  <span data-ttu-id="9c1b0-451">Dzięki temu zadanie dostawcy trwałości jest bardziej złożone i ma dodatkowe obciążenie bazy danych.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-451">This makes the job of the persistence provider more complex and puts extra stress on the database.</span></span>

### <a name="environment-setup"></a><span data-ttu-id="9c1b0-452">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="9c1b0-452">Environment Setup</span></span>
![Konfiguracja środowiska dla testu wydajności przepływu pracy](./media/performance/performance-test-environment.gif)

### <a name="test-setup"></a><span data-ttu-id="9c1b0-454">Konfiguracja testu</span><span class="sxs-lookup"><span data-stu-id="9c1b0-454">Test Setup</span></span>
 <span data-ttu-id="9c1b0-455">Nawet przy ulepszonym zestawie funkcji i lepszym obsłudze współbieżności dostawca trwałości SQL w programie WF4 jest szybszy niż dostawca w WF3.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-455">Even with an improved feature set and better concurrency handling, the SQL persistence provider in WF4 is faster than the provider in WF3.</span></span>  <span data-ttu-id="9c1b0-456">Aby to zaprezentować, dwa przepływy pracy, które wykonują zasadniczo te same operacje w WF3 i WF4 są porównane poniżej.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-456">To showcase this, two workflows that perform essentially the same operations in WF3 and WF4 are compared below.</span></span>

 ![Przepływ pracy trwałości w WF3 po lewej stronie i WF4 po prawej](./media/performance/persist-workflow-wf3-wf4.gif)

 <span data-ttu-id="9c1b0-458">Dwa przepływy pracy są tworzone przez odebraną wiadomość.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-458">The two workflows are both created by a received message.</span></span>  <span data-ttu-id="9c1b0-459">Po wysłaniu początkowej odpowiedzi przepływ pracy zostanie utrwalony.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-459">After sending an initial reply, the workflow is persisted.</span></span>  <span data-ttu-id="9c1b0-460">W przypadku WF3 wartość pusta <xref:System.Workflow.ComponentModel.TransactionScopeActivity> jest używana do inicjowania trwałości.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-460">In the WF3 case, an empty <xref:System.Workflow.ComponentModel.TransactionScopeActivity> is used to initiate the persistence.</span></span>  <span data-ttu-id="9c1b0-461">To samo można osiągnąć w WF3 przez oznaczenie działania jako "utrwalanie przy zamykaniu".</span><span class="sxs-lookup"><span data-stu-id="9c1b0-461">The same could be achieved in WF3 by marking an activity as "persist on close."</span></span>  <span data-ttu-id="9c1b0-462">Drugi skorelowany komunikat kończy przepływ pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-462">A second, correlated message completes the workflow.</span></span>  <span data-ttu-id="9c1b0-463">Przepływy pracy są utrwalane, ale nie są zwalniane.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-463">The workflows are persisted but not unloaded.</span></span>

### <a name="test-results"></a><span data-ttu-id="9c1b0-464">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="9c1b0-464">Test Results</span></span>
 ![Wykres kolumnowy przedstawiający trwałość przepływności](./media/performance/throughput-persistence-graph.gif)

 <span data-ttu-id="9c1b0-466">Gdy transport między klientem a warstwą środkową jest HTTP, trwałość w WF4 wykazuje zwiększenie 2,6 razy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-466">When the transport between client and middle tier is HTTP, persistence in WF4 shows an improvement of 2.6 times.</span></span>  <span data-ttu-id="9c1b0-467">Transport TCP zwiększa ten współczynnik do 3,0 razy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-467">The TCP transport increases that factor to 3.0 times.</span></span>  <span data-ttu-id="9c1b0-468">We wszystkich przypadkach użycie procesora CPU w warstwie środkowej ma wartość 98% lub wyższą.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-468">In all cases, CPU utilization on the middle tier is 98% or higher.</span></span>  <span data-ttu-id="9c1b0-469">Przyczyna WF4 przepływności jest większa z powodu szybszego środowiska uruchomieniowego przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-469">The reason that WF4 throughput is greater is due to the faster workflow runtime.</span></span>  <span data-ttu-id="9c1b0-470">Rozmiar serializowanego wystąpienia jest niski dla obu przypadków i nie jest głównym elementem, w tej sytuacji.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-470">The size of the serialized instance is low for both cases and is not a major contributing element in this situation.</span></span>

 <span data-ttu-id="9c1b0-471">Przepływy pracy WF3 i WF4 w tym teście używają działania, aby jawnie określić, kiedy powinna wystąpić trwałość.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-471">Both the WF3 and WF4 workflows in this test use an activity to explicitly indicate when persistence should occur.</span></span>  <span data-ttu-id="9c1b0-472">Umożliwia to utrwalanie przepływu pracy bez jego wyładowania.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-472">This has the benefit of persisting the workflow without unloading it.</span></span>  <span data-ttu-id="9c1b0-473">W programie WF3 można również nadal korzystać z <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> funkcji, ale spowoduje to odciążenie wystąpienia przepływu pracy z pamięci.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-473">In WF3, it is also possible to persist using the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> feature, but this unloads the workflow instance from memory.</span></span>  <span data-ttu-id="9c1b0-474">Jeśli deweloper korzystający z usługi WF3 chce upewnić się, że przepływ pracy utrzymuje się w określonych punktach, musi zmienić definicję przepływu pracy lub uregulować koszt wyładowania i ponownego załadowania wystąpienia przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-474">If a developer using WF3 wants to make sure a workflow persists at certain points, they either have to alter the workflow definition or pay the cost for unloading and re-loading the workflow instance.</span></span>  <span data-ttu-id="9c1b0-475">Nowa funkcja w programie WF4 umożliwia utrwalanie bez rozładowywania: <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A> .</span><span class="sxs-lookup"><span data-stu-id="9c1b0-475">A new feature in WF4 makes it possible to persist without unloading: <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>.</span></span>  <span data-ttu-id="9c1b0-476">Ta funkcja umożliwia utrwalanie wystąpienia przepływu pracy w trybie bezczynności, ale pozostaje w pamięci do momentu <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> spełnienia progu lub wznowienia wykonania.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-476">This feature allows the workflow instance to be persisted on idle but stay in memory until the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> threshold is met or execution is resumed.</span></span>

 <span data-ttu-id="9c1b0-477">Należy pamiętać, że dostawca trwałości SQL WF4 wykonuje więcej pracy w warstwie bazy danych.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-477">Note that the WF4 SQL persistence provider performs more work in the database tier.</span></span>  <span data-ttu-id="9c1b0-478">Baza danych SQL może stać się wąskim gardłem, dlatego ważne jest, aby monitorować użycie procesora i dysku w tym miejscu.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-478">The SQL database can become a bottleneck so it is important to monitor the CPU and disk usage there.</span></span>  <span data-ttu-id="9c1b0-479">Podczas testowania wydajności aplikacji przepływu pracy należy uwzględnić następujące liczniki wydajności z bazy danych SQL:</span><span class="sxs-lookup"><span data-stu-id="9c1b0-479">Be sure to include the following performance counters from the SQL database when performance testing workflow applications:</span></span>

- <span data-ttu-id="9c1b0-480">DyskFizyczny \\ % czasu odczytu dysku</span><span class="sxs-lookup"><span data-stu-id="9c1b0-480">PhysicalDisk\\%Disk Read Time</span></span>

- <span data-ttu-id="9c1b0-481">DyskFizyczny \\ % czasu dysku</span><span class="sxs-lookup"><span data-stu-id="9c1b0-481">PhysicalDisk\\% Disk Time</span></span>

- <span data-ttu-id="9c1b0-482">DyskFizyczny \\ % czasu zapisu dysku</span><span class="sxs-lookup"><span data-stu-id="9c1b0-482">PhysicalDisk\\% Disk Write Time</span></span>

- <span data-ttu-id="9c1b0-483">DyskFizyczny \\ % średniej długości kolejki dysku</span><span class="sxs-lookup"><span data-stu-id="9c1b0-483">PhysicalDisk\\% Avg. Disk Queue Length</span></span>

- <span data-ttu-id="9c1b0-484">Długość kolejki odczytu dysku PhysicalDisk\Avg.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-484">PhysicalDisk\Avg. Disk Read Queue Length</span></span>

- <span data-ttu-id="9c1b0-485">Długość kolejki zapisu dysku PhysicalDisk\Avg.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-485">PhysicalDisk\Avg. Disk Write Queue Length</span></span>

- <span data-ttu-id="9c1b0-486">Długość kolejki dysku fizyczny \ bieżąca</span><span class="sxs-lookup"><span data-stu-id="9c1b0-486">PhysicalDisk\Current Disk Queue Length</span></span>

- <span data-ttu-id="9c1b0-487">Informacje o procesorze \\ czas procesora (%)</span><span class="sxs-lookup"><span data-stu-id="9c1b0-487">Processor Information\\% Processor Time</span></span>

- <span data-ttu-id="9c1b0-488">SQLServer: czas oczekiwania zamka Latches\Average (MS)</span><span class="sxs-lookup"><span data-stu-id="9c1b0-488">SQLServer:Latches\Average Latch Wait Time (ms)</span></span>

- <span data-ttu-id="9c1b0-489">SQLServer: Latches\Latch oczekiwania na sekundę</span><span class="sxs-lookup"><span data-stu-id="9c1b0-489">SQLServer:Latches\Latch Waits/sec</span></span>

### <a name="tracking"></a><span data-ttu-id="9c1b0-490">Śledzenie</span><span class="sxs-lookup"><span data-stu-id="9c1b0-490">Tracking</span></span>
 <span data-ttu-id="9c1b0-491">Śledzenie przepływu pracy może służyć do śledzenia postępu przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-491">Workflow tracking can be used to track the progress of a workflow.</span></span>  <span data-ttu-id="9c1b0-492">Informacje zawarte w zdarzeniach śledzenia są określane przez profil śledzenia.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-492">The information that is included in the tracking events is determined by a tracking profile.</span></span>  <span data-ttu-id="9c1b0-493">Im bardziej skomplikowany profil śledzenia, tym bardziej kosztowne jest śledzenie.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-493">The more complex the tracking profile, the more expensive tracking becomes.</span></span>

 <span data-ttu-id="9c1b0-494">WF3 dostarczana z usługą śledzenia opartą na języku SQL.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-494">WF3 shipped with a SQL-based tracking service.</span></span>  <span data-ttu-id="9c1b0-495">Ta usługa może współpracować w trybach wsadowych i niewsadowych.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-495">This service could work in batched and non-batched modes.</span></span>  <span data-ttu-id="9c1b0-496">W trybie bez partii zdarzenia śledzenia są zapisywane bezpośrednio w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-496">In non-batched mode, tracking events are written directly to the database.</span></span>  <span data-ttu-id="9c1b0-497">W trybie wsadowym zdarzenia śledzenia są gromadzone w tej samej partii co stan wystąpienia przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-497">In batched mode, tracking events are collected into the same batch as the workflow instance state.</span></span>  <span data-ttu-id="9c1b0-498">Tryb wsadowy ma najlepszą wydajność dla szerokiego zakresu projektów przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-498">The batched mode has the best performance for the widest range of workflow designs.</span></span>  <span data-ttu-id="9c1b0-499">Jednak przetwarzanie wsadowe może mieć negatywny wpływ na wydajność, jeśli przepływ pracy uruchamia wiele działań bez utrwalania i te działania są śledzone.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-499">However, batching can have a negative performance impact if the workflow runs many activities without persisting and those activities are tracked.</span></span>  <span data-ttu-id="9c1b0-500">Zwykle zdarza się to w pętlach i najlepszym sposobem na uniknięcie tego scenariusza jest zaprojektowanie dużych pętli w celu uwzględnienia punktu trwałości.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-500">This would commonly happen in loops and the best way to avoid this scenario is to design large loops to contain a persistence point.</span></span>  <span data-ttu-id="9c1b0-501">Wprowadzenie punktu trwałości do pętli może negatywnie wpłynąć na wydajność, dlatego ważne jest, aby mierzyć koszty każdego z nich i mieć saldo.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-501">Introducing a persistence point into a loop can negatively affect performance as well so it is important to measure the costs of each and come up with a balance.</span></span>

 <span data-ttu-id="9c1b0-502">Usługa WF4 nie jest dostarczana z usługą śledzenia SQL.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-502">WF4 is not shipped with a SQL tracking service.</span></span>  <span data-ttu-id="9c1b0-503">Rejestrowanie informacji o śledzeniu do bazy danych SQL może być obsługiwane lepiej z serwera aplikacji, a nie wbudowane w .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-503">Recording tracking information to a SQL database can be handled better from an application server rather than built into the .NET Framework.</span></span> <span data-ttu-id="9c1b0-504">Dlatego śledzenie SQL jest teraz obsługiwane przez program AppFabric.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-504">Therefore SQL tracking is now handled by AppFabric.</span></span>  <span data-ttu-id="9c1b0-505">Wbudowany dostawca śledzenia w programie WF4 jest oparty na śledzeniu zdarzeń systemu Windows (ETW).</span><span class="sxs-lookup"><span data-stu-id="9c1b0-505">The out-of-the-box tracking provider in WF4 is based on Event Tracing for Windows (ETW).</span></span>

 <span data-ttu-id="9c1b0-506">ETW to system zdarzeń o niskim opóźnieniu, wbudowany w system Windows.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-506">ETW is a kernel-level, low-latency event system built into Windows.</span></span>  <span data-ttu-id="9c1b0-507">Używa modelu dostawcy/odbiorcy, który umożliwia naliczanie opłat za śledzenie zdarzeń tylko wtedy, gdy istnieje w rzeczywistości konsument.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-507">It uses a provider/consumer model that makes it possible to only incur the penalty for event tracing when there is actually a consumer.</span></span>  <span data-ttu-id="9c1b0-508">Oprócz zdarzeń jądra, takich jak procesor, dysk, pamięć i użycie sieci, wiele aplikacji korzysta również z funkcji ETW.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-508">In addition to kernel events such as processor, disk, memory, and network usage, many applications leverage ETW as well.</span></span>  <span data-ttu-id="9c1b0-509">Zdarzenia ETW są bardziej wydajne niż liczniki wydajności w tym zdarzeniu można dostosować do aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-509">ETW events are more powerful than performance counters in that events can be customized to the application.</span></span>  <span data-ttu-id="9c1b0-510">Zdarzenie może zawierać tekst, taki jak identyfikator przepływu pracy lub komunikat informacyjny.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-510">An event can contain text such as a workflow ID or an informational message.</span></span>  <span data-ttu-id="9c1b0-511">Ponadto zdarzenia są klasyfikowane przy użyciu masek bitowych, dzięki czemu używanie pewnego podzestawu zdarzeń będzie miało mniejszy wpływ na wydajność niż przechwytywanie wszystkich zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-511">Also, events are categorized with bitmasks so that consuming a certain subset of events will have less performance impact than capturing all events.</span></span>

 <span data-ttu-id="9c1b0-512">Korzyści wynikające z używania funkcji ETW do śledzenia zamiast programu SQL obejmują:</span><span class="sxs-lookup"><span data-stu-id="9c1b0-512">Benefits to the approach of using ETW for tracking instead of SQL include:</span></span>

- <span data-ttu-id="9c1b0-513">Zbieranie zdarzeń śledzenia może być oddzielone innym procesom.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-513">Collection of tracking events can be separated to another process.</span></span>  <span data-ttu-id="9c1b0-514">Zapewnia to większą elastyczność w sposobie rejestrowania zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-514">This gives greater flexibility in how the events are recorded.</span></span>

- <span data-ttu-id="9c1b0-515">Zdarzenia śledzenia funkcji ETW można łatwo łączyć z zdarzeniami ETW WCF lub innymi dostawcami ETW, takimi jak SQL Server lub dostawca jądra.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-515">ETW tracking events are easily combined with the WCF ETW events or other ETW providers such as a SQL Server or kernel provider.</span></span>

- <span data-ttu-id="9c1b0-516">Autorzy przepływu pracy nie muszą zmieniać przepływu pracy w celu lepszego działania z określoną implementacją śledzenia, taką jak tryb wsadowy usługi WF3 śledzenia SQL.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-516">Workflow authors do not need to alter a workflow to work better with a particular tracking implementation, such as the WF3 SQL tracking service’s batch mode.</span></span>

- <span data-ttu-id="9c1b0-517">Administrator może włączać lub wyłączać śledzenie bez konieczności odtwarzania procesu hosta.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-517">An administrator can turn tracking on or off without recycling the host process.</span></span>

 <span data-ttu-id="9c1b0-518">Korzyści wynikające z wydajności śledzenia ETW są uzyskiwane z wadą.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-518">The performance benefits to ETW tracking come with a drawback.</span></span>  <span data-ttu-id="9c1b0-519">Zdarzenia ETW mogą zostać utracone, jeśli system ma intensywną siłę zasobów.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-519">ETW events can be lost if the system is under intense resource pressure.</span></span>  <span data-ttu-id="9c1b0-520">Przetwarzanie zdarzeń nie jest przeznaczone do blokowania normalnego wykonywania programu i w związku z tym nie jest gwarantowane, że wszystkie zdarzenia ETW będą emitowane do subskrybentów.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-520">The processing of events is not meant to block normal program execution and therefore it is not guaranteed that all ETW events will be broadcast to their subscribers.</span></span>  <span data-ttu-id="9c1b0-521">Dzięki temu śledzenie ETW jest doskonałe dla monitorowania kondycji, ale nie jest odpowiednie do inspekcji.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-521">This makes ETW tracking great for health monitoring but not suitable for auditing.</span></span>

 <span data-ttu-id="9c1b0-522">Mimo że usługa WF4 nie ma dostawcy śledzenia SQL, program AppFabric wykonuje.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-522">While WF4 does not have a SQL tracking provider, AppFabric does.</span></span>  <span data-ttu-id="9c1b0-523">Podejście do śledzenia SQL w programie AppFabric ma na celu subskrybowanie zdarzeń ETW za pomocą usługi systemu Windows, która tworzy partię zdarzeń i zapisuje je w tabeli SQL zaprojektowanej do szybkiego wstawiania.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-523">AppFabric’s SQL tracking approach is to subscribe to ETW events with a Windows Service that batches the events and writes them to a SQL table designed for quick inserts.</span></span>  <span data-ttu-id="9c1b0-524">Osobne zadanie opróżnia dane z tej tabeli i replikuje je do tabel raportowania, które mogą być wyświetlane na pulpicie nawigacyjnym programu AppFabric.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-524">A separate job drains the data from this table and reforms it into reporting tables that can be viewed on the AppFabric dashboard.</span></span>  <span data-ttu-id="9c1b0-525">Oznacza to, że partia zdarzeń śledzenia jest obsługiwana niezależnie od przepływu pracy, z którego pochodzi, i w związku z tym nie musi czekać na punkt trwałości przed zarejestrowaniem.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-525">This means that a batch of tracking events is handled independent of the workflow it came from and therefore does not have to wait for a persistence point before being recorded.</span></span>

 <span data-ttu-id="9c1b0-526">Zdarzenia ETW można rejestrować za pomocą narzędzi, takich jak logman lub Xperf.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-526">ETW events can be recorded with tools such as logman or xperf.</span></span>  <span data-ttu-id="9c1b0-527">Kompaktowy plik ETL można wyświetlić za pomocą narzędzia, takiego jak XperfView lub przekonwertowanego do bardziej czytelnego formatu, takiego jak XML, z tracerpt.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-527">The compact ETL file can be viewed with a tool like xperfview or converted to a more readable format, such as XML, with tracerpt.</span></span>  <span data-ttu-id="9c1b0-528">W programie WF3 jedyną opcją pobierania zdarzeń śledzenia bez bazy danych SQL jest utworzenie niestandardowej usługi śledzenia.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-528">In WF3, the only option for getting tracking events without a SQL database is to create a custom tracking service.</span></span> <span data-ttu-id="9c1b0-529">Aby uzyskać więcej informacji na temat funkcji ETW, zobacz [usługi WCF i śledzenie zdarzeń dla systemu Windows](../wcf/samples/wcf-services-and-event-tracing-for-windows.md) i [Śledzenie zdarzeń — aplikacje systemu Windows](/windows/desktop/etw/event-tracing-portal).</span><span class="sxs-lookup"><span data-stu-id="9c1b0-529">For more information about ETW, see [WCF Services and Event Tracing for Windows](../wcf/samples/wcf-services-and-event-tracing-for-windows.md) and [Event Tracing - Windows applications](/windows/desktop/etw/event-tracing-portal).</span></span>

 <span data-ttu-id="9c1b0-530">Włączenie śledzenia przepływu pracy będzie miało wpływ na wydajność w różnych stopniach.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-530">Enabling workflow tracking will impact performance in varying degrees.</span></span>  <span data-ttu-id="9c1b0-531">Poniższy wzorzec używa narzędzia Logman do użycia zdarzeń śledzenia ETW i rejestrowania ich w pliku ETL.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-531">The benchmark below uses the logman tool to consume the ETW tracking events and record them to an ETL file.</span></span>  <span data-ttu-id="9c1b0-532">Koszt śledzenia SQL w programie AppFabric nie jest objęty zakresem tego artykułu.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-532">The cost of the SQL tracking in AppFabric is not in the scope of this article.</span></span>  <span data-ttu-id="9c1b0-533">W tym teście porównawczym jest wyświetlany podstawowy profil śledzenia, używany również w programie AppFabric.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-533">The basic tracking profile, also used in AppFabric, is shown in this benchmark.</span></span>  <span data-ttu-id="9c1b0-534">Uwzględniono również koszt śledzenia tylko zdarzeń monitorowania kondycji.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-534">Also included is the cost of tracking only health monitoring events.</span></span>  <span data-ttu-id="9c1b0-535">Te zdarzenia są przydatne do rozwiązywania problemów i określania średniej przepływności systemu.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-535">These events are useful for troubleshooting problems and determining the average throughput of the system.</span></span>

### <a name="environment-setup"></a><span data-ttu-id="9c1b0-536">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="9c1b0-536">Environment Setup</span></span>
 ![Konfiguracja środowiska dla testu wydajności przepływu pracy](./media/performance/performance-test-environment.gif)

### <a name="test-results"></a><span data-ttu-id="9c1b0-538">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="9c1b0-538">Test Results</span></span>

 ![Wykres kolumnowy przedstawiający koszty śledzenia przepływu pracy](./media/performance/workflow-tracking-costs.gif)

 <span data-ttu-id="9c1b0-540">Monitorowanie kondycji ma około 3% wpływu na przepływność.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-540">Health monitoring has roughly a 3% impact on throughput.</span></span>  <span data-ttu-id="9c1b0-541">Koszt profilu podstawowego wynosi około 8%.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-541">The basic profile’s cost is around 8%.</span></span>

## <a name="interop"></a><span data-ttu-id="9c1b0-542">Interop</span><span class="sxs-lookup"><span data-stu-id="9c1b0-542">Interop</span></span>
 <span data-ttu-id="9c1b0-543">WF4 to prawie pełna odpisana wartość [!INCLUDE[wf1](../../../includes/wf1-md.md)] i dlatego WF3 przepływy pracy i działania nie są bezpośrednio zgodne z WF4.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-543">WF4 is almost a complete rewrite of [!INCLUDE[wf1](../../../includes/wf1-md.md)] and therefore WF3 workflows and activities are not directly compatible with WF4.</span></span>  <span data-ttu-id="9c1b0-544">Wielu klientów, którzy wcześniej przyjęli Windows Workflow Foundation, będą mieć definicje przepływów pracy lub innych firm, a także niestandardowe działania dla WF3.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-544">Many customers that adopted Windows Workflow Foundation early will have in-house or third-party workflow definitions and custom activities for WF3.</span></span>  <span data-ttu-id="9c1b0-545">Jednym ze sposobów ułatwienia przejścia do WF4 jest użycie działania międzyoperacyjności, które może wykonywać działania WF3 z poziomu przepływu pracy WF4.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-545">One way to ease the transition to WF4 is to use the Interop activity, which can execute WF3 activities from within a WF4 workflow.</span></span>  <span data-ttu-id="9c1b0-546">Zalecane jest, aby <xref:System.Activities.Statements.Interop> działanie było używane tylko wtedy, gdy jest to konieczne.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-546">It is recommended that the <xref:System.Activities.Statements.Interop> activity only be used when necessary.</span></span> <span data-ttu-id="9c1b0-547">Aby uzyskać więcej informacji na temat migracji do programu WF4, zapoznaj się ze [wskazówkami dotyczącymi migracji WF4](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="9c1b0-547">For more information about migrating to WF4 check out the [WF4 Migration Guidance](migration-guidance.md).</span></span>

### <a name="environment-setup"></a><span data-ttu-id="9c1b0-548">Konfigurowanie środowiska</span><span class="sxs-lookup"><span data-stu-id="9c1b0-548">Environment Setup</span></span>
 ![Konfiguracja środowiska dla testu wydajności przepływu pracy](./media/performance/performance-test-environment.gif)

### <a name="test-results"></a><span data-ttu-id="9c1b0-550">Wyniki tekstu</span><span class="sxs-lookup"><span data-stu-id="9c1b0-550">Test Results</span></span>

<span data-ttu-id="9c1b0-551">W poniższej tabeli przedstawiono wyniki przebiegu przepływu pracy zawierającego pięć działań w sekwencji w różnych konfiguracjach.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-551">The following table shows the results of running a workflow containing five activities in a sequence in various configurations.</span></span>

|<span data-ttu-id="9c1b0-552">Testowanie</span><span class="sxs-lookup"><span data-stu-id="9c1b0-552">Test</span></span>|<span data-ttu-id="9c1b0-553">Przepływność (przepływy pracy/s)</span><span class="sxs-lookup"><span data-stu-id="9c1b0-553">Throughput (workflows/sec)</span></span>|
|----------|-----------------------------------|
|<span data-ttu-id="9c1b0-554">Sekwencja WF3 w środowisku uruchomieniowym WF3</span><span class="sxs-lookup"><span data-stu-id="9c1b0-554">WF3 Sequence in WF3 runtime</span></span>|<span data-ttu-id="9c1b0-555">1 576</span><span class="sxs-lookup"><span data-stu-id="9c1b0-555">1,576</span></span>|
|<span data-ttu-id="9c1b0-556">Sekwencja WF3 w środowisku uruchomieniowym WF4 przy użyciu międzyoperacyjnego</span><span class="sxs-lookup"><span data-stu-id="9c1b0-556">WF3 Sequence in WF4 runtime using Interop</span></span>|<span data-ttu-id="9c1b0-557">2 745</span><span class="sxs-lookup"><span data-stu-id="9c1b0-557">2,745</span></span>|
|<span data-ttu-id="9c1b0-558">Sekwencja WF4</span><span class="sxs-lookup"><span data-stu-id="9c1b0-558">WF4 Sequence</span></span>|<span data-ttu-id="9c1b0-559">153 582</span><span class="sxs-lookup"><span data-stu-id="9c1b0-559">153,582</span></span>|

 <span data-ttu-id="9c1b0-560">Istnieje istotny wzrost wydajności dotyczący użycia międzyoperacyjności w przypadku prostych WF3.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-560">There is a notable performance increase to using Interop over straight WF3.</span></span>  <span data-ttu-id="9c1b0-561">Jednak w porównaniu z działaniami WF4 wzrost jest nieznaczny.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-561">However, when compared against WF4 activities, the increase is negligible.</span></span>

## <a name="summary"></a><span data-ttu-id="9c1b0-562">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="9c1b0-562">Summary</span></span>
 <span data-ttu-id="9c1b0-563">Duże inwestycje w wydajność dla WF4 są płatne w wielu kluczowych obszarach.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-563">Heavy investments in performance for WF4 have paid off in many crucial areas.</span></span>  <span data-ttu-id="9c1b0-564">Wydajność poszczególnych składników przepływu pracy to w niektórych przypadkach setki razy szybsze w WF4 w porównaniu do WF3 ze względu na [!INCLUDE[wf1](../../../includes/wf1-md.md)] środowisko uruchomieniowe programu leaner.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-564">Individual workflow component performance is in some cases hundreds of times faster in WF4 compared to WF3 due to a leaner [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="9c1b0-565">Liczby opóźnień również są znacznie lepsze.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-565">Latency numbers are significantly better as well.</span></span>  <span data-ttu-id="9c1b0-566">Oznacza to, że spadek wydajności do użycia [!INCLUDE[wf1](../../../includes/wf1-md.md)] w przeciwieństwie do kodu ręcznego usług aranżacji WCF jest bardzo mały, biorąc pod uwagę, że dodano zalety korzystania z programu [!INCLUDE[wf1](../../../includes/wf1-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="9c1b0-566">This means the performance penalty for using [!INCLUDE[wf1](../../../includes/wf1-md.md)] as opposed to hand-coding WCF orchestration services is very small considering the added benefits of using [!INCLUDE[wf1](../../../includes/wf1-md.md)].</span></span>  <span data-ttu-id="9c1b0-567">Wydajność trwałości wzrosła przez współczynnik 2,5-3,0.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-567">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="9c1b0-568">Monitorowanie kondycji przy użyciu śledzenia przepływów pracy ma teraz bardzo niewielkie obciążenie.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-568">Health monitoring by means of workflow tracking now has very little overhead.</span></span>  <span data-ttu-id="9c1b0-569">Kompleksowy zestaw przewodników migracji jest dostępny dla tych, które rozważają przechodzenie od WF3 do WF4.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-569">A comprehensive set of migration guides are available for those that are considering moving from WF3 to WF4.</span></span>  <span data-ttu-id="9c1b0-570">Wszystko to powinno WF4 atrakcyjną opcję tworzenia złożonych aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9c1b0-570">All of this should make WF4 an attractive option for writing complex applications.</span></span>
