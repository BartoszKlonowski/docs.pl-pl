---
title: Zużywanie strumieniowych danych OData z przepływu pracy — WF
ms.date: 03/30/2017
ms.assetid: 1b26617c-53e9-476a-81af-675c36d95919
ms.openlocfilehash: ceac2c2d07351fcb79e2345068f07fa22f356411
ms.sourcegitcommit: de17a7a0a37042f0d4406f5ae5393531caeb25ba
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 01/24/2020
ms.locfileid: "76743791"
---
# <a name="consuming-odata-feeds-from-a-workflow"></a><span data-ttu-id="de63c-102">Zużywanie źródeł danych OData z przepływu pracy</span><span class="sxs-lookup"><span data-stu-id="de63c-102">Consuming OData feeds from a workflow</span></span>

<span data-ttu-id="de63c-103">Usługi danych programu WCF jest składnikiem .NET Framework, który umożliwia tworzenie usług korzystających z protokołu Open Data Protocol (OData) do udostępniania danych i korzystania z nich za pośrednictwem sieci Web lub intranet przy użyciu semantyki przenoszenia stanu (REST).</span><span class="sxs-lookup"><span data-stu-id="de63c-103">WCF Data Services is a component of the .NET Framework that enables you to create services that use the Open Data Protocol (OData) to expose and consume data over the Web or intranet by using the semantics of representational state transfer (REST).</span></span> <span data-ttu-id="de63c-104">Usługa OData udostępnia dane jako zasoby, które są adresowane przez identyfikatory URI.</span><span class="sxs-lookup"><span data-stu-id="de63c-104">OData exposes data as resources that are addressable by URIs.</span></span> <span data-ttu-id="de63c-105">Każda aplikacja może korzystać z usługi danych opartych na protokole OData, jeśli może wysyłać żądanie HTTP i przetwarzać źródło danych OData.</span><span class="sxs-lookup"><span data-stu-id="de63c-105">Any application can interact with an OData-based data service if it can send an HTTP request and process the OData feed that a data service returns.</span></span> <span data-ttu-id="de63c-106">Ponadto Usługi danych programu WCF obejmuje biblioteki klienckie, które zapewniają bogatsze środowisko programistyczne w przypadku korzystania ze źródeł danych OData z aplikacji .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="de63c-106">In addition, WCF Data Services includes client libraries that provide a richer programming experience when you consume OData feeds from .NET Framework applications.</span></span> <span data-ttu-id="de63c-107">Ten temat zawiera omówienie używania źródła danych OData w przepływie pracy z i bez użycia bibliotek klienckich.</span><span class="sxs-lookup"><span data-stu-id="de63c-107">This topic provides an overview of consuming an OData feed in a workflow with and without using the client libraries.</span></span>

## <a name="using-the-sample-northwind-odata-service"></a><span data-ttu-id="de63c-108">Korzystanie z przykładowej usługi OData Northwind</span><span class="sxs-lookup"><span data-stu-id="de63c-108">Using the sample Northwind OData service</span></span>

<span data-ttu-id="de63c-109">Przykłady w tym temacie wykorzystują przykładową usługę danych Northwind znajdującą się w <https://services.odata.org/Northwind/Northwind.svc/>.</span><span class="sxs-lookup"><span data-stu-id="de63c-109">The examples in this topic use the sample Northwind data service located at <https://services.odata.org/Northwind/Northwind.svc/>.</span></span> <span data-ttu-id="de63c-110">Ta usługa jest świadczona jako część [zestawu SDK OData](https://www.odata.org/ecosystem/#sdk) i zapewnia dostęp tylko do odczytu do przykładowej bazy danych Northwind.</span><span class="sxs-lookup"><span data-stu-id="de63c-110">This service is provided as part of the [OData SDK](https://www.odata.org/ecosystem/#sdk) and provides read-only access to the sample Northwind database.</span></span> <span data-ttu-id="de63c-111">Jeśli wymagana jest funkcja dostępu do zapisu lub jeśli jest wymagana lokalna usługa danych programu WCF, można wykonać kroki przedstawione w [usługi danych programu WCF przewodniku szybki start](../data/wcf/quickstart-wcf-data-services.md) , aby utworzyć lokalną usługę OData, która zapewnia dostęp do bazy danych Northwind.</span><span class="sxs-lookup"><span data-stu-id="de63c-111">If write access is desired, or if a local WCF Data Service is desired, you can follow the steps of the [WCF Data Services Quickstart](../data/wcf/quickstart-wcf-data-services.md) to create a local OData service that provides access to the Northwind database.</span></span> <span data-ttu-id="de63c-112">W przypadku skorzystania z przewodnika Szybki Start należy zastąpić lokalny identyfikator URI dla tego, który został podany w przykładowym kodzie w tym temacie.</span><span class="sxs-lookup"><span data-stu-id="de63c-112">If you follow the quickstart, substitute the local URI for the one provided in the example code in this topic.</span></span>

## <a name="consuming-an-odata-feed-using-the-client-libraries"></a><span data-ttu-id="de63c-113">Zużywanie źródła danych OData przy użyciu bibliotek klienckich</span><span class="sxs-lookup"><span data-stu-id="de63c-113">Consuming an OData feed using the client libraries</span></span>

<span data-ttu-id="de63c-114">Usługi danych programu WCF obejmuje biblioteki klienckie, które umożliwiają łatwiejsze korzystanie z kanału informacyjnego OData z aplikacji .NET Framework i klienckich.</span><span class="sxs-lookup"><span data-stu-id="de63c-114">WCF Data Services includes client libraries that enable you to more easily consume an OData feed from .NET Framework and client applications.</span></span> <span data-ttu-id="de63c-115">Te biblioteki upraszczają wysyłanie i otrzymywanie komunikatów HTTP.</span><span class="sxs-lookup"><span data-stu-id="de63c-115">These libraries simplify sending and receiving HTTP messages.</span></span> <span data-ttu-id="de63c-116">Tłumaczą one również ładunek komunikatów na obiekty CLR, które reprezentują dane jednostki.</span><span class="sxs-lookup"><span data-stu-id="de63c-116">They also translate the message payload into CLR objects that represent entity data.</span></span> <span data-ttu-id="de63c-117">Biblioteki klienckie oferują dwie klasy podstawowe <xref:System.Data.Services.Client.DataServiceContext> i <xref:System.Data.Services.Client.DataServiceQuery%601>.</span><span class="sxs-lookup"><span data-stu-id="de63c-117">The client libraries feature the two core classes <xref:System.Data.Services.Client.DataServiceContext> and <xref:System.Data.Services.Client.DataServiceQuery%601>.</span></span> <span data-ttu-id="de63c-118">Te klasy umożliwiają wykonywanie zapytań do usługi danych, a następnie współpracują z zwróconymi danymi jednostki jako obiektami CLR.</span><span class="sxs-lookup"><span data-stu-id="de63c-118">These classes enable you to query a data service and then work with the returned entity data as CLR objects.</span></span> <span data-ttu-id="de63c-119">Ta sekcja dotyczy dwóch metod tworzenia działań, które korzystają z bibliotek klienckich.</span><span class="sxs-lookup"><span data-stu-id="de63c-119">This section covers two approaches to creating activities that use the client libraries.</span></span>

### <a name="adding-a-service-reference-to-the-wcf-data-service"></a><span data-ttu-id="de63c-120">Dodawanie odwołania do usługi do usługi danych programu WCF</span><span class="sxs-lookup"><span data-stu-id="de63c-120">Adding a service reference to the WCF Data service</span></span>

<span data-ttu-id="de63c-121">Aby wygenerować biblioteki klienckie Northwind, można użyć okna dialogowego **Dodaj odwołanie do usługi** w programie Visual Studio 2012 w celu dodania odwołania do usługi Northwind OData.</span><span class="sxs-lookup"><span data-stu-id="de63c-121">To generate the Northwind client libraries, you can use the **Add Service Reference** dialog box in Visual Studio 2012 to add a reference to the Northwind OData service.</span></span>

![Zrzut ekranu przedstawiający okno dialogowe Dodaj odwołanie do usługi.](./media/consuming-odata-feeds-from-a-workflow/add-service-reference-dialog.gif)

<span data-ttu-id="de63c-123">Należy zauważyć, że usługa nie udostępnia żadnych operacji usługi, a na liście **usług** znajdują się elementy reprezentujące jednostki udostępniane przez usługę danych Northwind.</span><span class="sxs-lookup"><span data-stu-id="de63c-123">Note that there are no service operations exposed by the service, and in the **Services** list there are items representing the entities exposed by the Northwind data service.</span></span> <span data-ttu-id="de63c-124">Po dodaniu odwołania do usługi klasy zostaną wygenerowane dla tych jednostek i mogą być używane w kodzie klienta.</span><span class="sxs-lookup"><span data-stu-id="de63c-124">When the service reference is added, classes will be generated for these entities and they can be used in the client code.</span></span> <span data-ttu-id="de63c-125">Przykłady w tym temacie używają tych klas i klasy `NorthwindEntities` do wykonywania zapytań.</span><span class="sxs-lookup"><span data-stu-id="de63c-125">The examples in this topic use these classes and the `NorthwindEntities` class to perform the queries.</span></span>

> [!NOTE]
> <span data-ttu-id="de63c-126">Aby uzyskać więcej informacji, zobacz [generowanie biblioteki klienta usługi danych (usługi danych programu WCF)](../data/wcf/generating-the-data-service-client-library-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="de63c-126">For more information, see [Generating the Data Service Client Library (WCF Data Services)](../data/wcf/generating-the-data-service-client-library-wcf-data-services.md).</span></span>

### <a name="using-asynchronous-methods"></a><span data-ttu-id="de63c-127">Korzystanie z metod asynchronicznych</span><span class="sxs-lookup"><span data-stu-id="de63c-127">Using asynchronous methods</span></span>

<span data-ttu-id="de63c-128">Aby rozwiązać możliwe problemy z opóźnieniem, które mogą wystąpić podczas uzyskiwania dostępu do zasobów za pośrednictwem sieci Web, zalecamy asynchroniczne uzyskiwanie dostępu do Usługi danych programu WCF.</span><span class="sxs-lookup"><span data-stu-id="de63c-128">To address possible latency issues that may occur when accessing resources over the Web, we recommend accessing WCF Data Services asynchronously.</span></span> <span data-ttu-id="de63c-129">Biblioteki klienta Usługi danych programu WCF zawierają metody asynchroniczne do wywoływania zapytań, a Windows Workflow Foundation (WF) udostępnia klasę <xref:System.Activities.AsyncCodeActivity> do tworzenia działań asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="de63c-129">The WCF Data Services client libraries include asynchronous methods for invoking queries, and Windows Workflow Foundation (WF) provides the <xref:System.Activities.AsyncCodeActivity> class for authoring asynchronous activities.</span></span> <span data-ttu-id="de63c-130"><xref:System.Activities.AsyncCodeActivity> działań pochodnych można napisać, aby wykorzystać klasy .NET Framework z metodami asynchronicznymi lub kod, który ma być wykonywany asynchronicznie, można umieścić w metodzie i wywołać za pomocą delegata.</span><span class="sxs-lookup"><span data-stu-id="de63c-130"><xref:System.Activities.AsyncCodeActivity> derived activities can be written to take advantage of .NET Framework classes that have asynchronous methods, or the code to be executed asynchronously can be put into a method and invoked by using a delegate.</span></span> <span data-ttu-id="de63c-131">Ta sekcja zawiera dwa przykłady działań pochodnych <xref:System.Activities.AsyncCodeActivity>; jeden, który korzysta z metod asynchronicznych Usługi danych programu WCF bibliotek klienckich i jeden, który używa delegata.</span><span class="sxs-lookup"><span data-stu-id="de63c-131">This section provides two examples of an <xref:System.Activities.AsyncCodeActivity> derived activity; one that uses the asynchronous methods of the WCF Data Services client libraries and one that uses a delegate.</span></span>

> [!NOTE]
> <span data-ttu-id="de63c-132">Aby uzyskać więcej informacji, zobacz [operacje asynchroniczne (usługi danych programu WCF)](../data/wcf/asynchronous-operations-wcf-data-services.md) i [Tworzenie działań asynchronicznych](creating-asynchronous-activities-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="de63c-132">For more information, see [Asynchronous Operations (WCF Data Services)](../data/wcf/asynchronous-operations-wcf-data-services.md) and [Creating Asynchronous Activities](creating-asynchronous-activities-in-wf.md).</span></span>

### <a name="using-client-library-asynchronous-methods"></a><span data-ttu-id="de63c-133">Korzystanie z metod asynchronicznych biblioteki klienta</span><span class="sxs-lookup"><span data-stu-id="de63c-133">Using client library asynchronous methods</span></span>

<span data-ttu-id="de63c-134">Klasa <xref:System.Data.Services.Client.DataServiceQuery%601> dostarcza metody <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> i <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> do asynchronicznego wykonywania zapytań dotyczących usługi OData.</span><span class="sxs-lookup"><span data-stu-id="de63c-134">The <xref:System.Data.Services.Client.DataServiceQuery%601> class provides <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> and <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> methods for querying an OData service asynchronously.</span></span> <span data-ttu-id="de63c-135">Metody te mogą być wywoływane z <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> i <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> zastąpień <xref:System.Activities.AsyncCodeActivity> klasy pochodnej.</span><span class="sxs-lookup"><span data-stu-id="de63c-135">These methods can be called from the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> overrides of an <xref:System.Activities.AsyncCodeActivity> derived class.</span></span> <span data-ttu-id="de63c-136">Gdy <xref:System.Activities.AsyncCodeActivity> przesłonić <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>, przepływ pracy może przejść w stan bezczynności (ale nie utrzymywać) i po ukończeniu pracy asynchronicznej <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> jest wywoływany przez środowisko uruchomieniowe.</span><span class="sxs-lookup"><span data-stu-id="de63c-136">When the <xref:System.Activities.AsyncCodeActivity> <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override returns, the workflow can go idle (but not persist), and when the asynchronous work is completed, <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> is invoked by the runtime.</span></span>

<span data-ttu-id="de63c-137">W poniższym przykładzie zdefiniowano działanie `OrdersByCustomer`, które ma dwa argumenty wejściowe.</span><span class="sxs-lookup"><span data-stu-id="de63c-137">In the following example, an `OrdersByCustomer` activity is defined that has two input arguments.</span></span> <span data-ttu-id="de63c-138">Argument `CustomerId` reprezentuje klienta, który identyfikuje, które zlecenia zwracają, a argument `ServiceUri` reprezentuje identyfikator URI usługi OData do zbadania.</span><span class="sxs-lookup"><span data-stu-id="de63c-138">The `CustomerId` argument represents the customer who identifies which orders to return, and the `ServiceUri` argument represents the URI of the OData service to be queried.</span></span> <span data-ttu-id="de63c-139">Ponieważ działanie pochodzi z `AsyncCodeActivity<IEnumerable<Order>>` istnieje również argument danych wyjściowych <xref:System.Activities.Activity%601.Result%2A>, który jest używany do zwracania wyników zapytania.</span><span class="sxs-lookup"><span data-stu-id="de63c-139">Because the activity derives from `AsyncCodeActivity<IEnumerable<Order>>` there is also a <xref:System.Activities.Activity%601.Result%2A> output argument that is used to return the results of the query.</span></span> <span data-ttu-id="de63c-140">Zastępowanie <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> powoduje utworzenie zapytania LINQ, które wybiera wszystkie zamówienia określonego klienta.</span><span class="sxs-lookup"><span data-stu-id="de63c-140">The <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override creates a LINQ query that selects all orders of the specified customer.</span></span> <span data-ttu-id="de63c-141">To zapytanie jest określone jako <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> przekazaną <xref:System.Activities.AsyncCodeActivityContext>, a następnie wywoływana jest metoda <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> zapytania.</span><span class="sxs-lookup"><span data-stu-id="de63c-141">This query is specified as the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> of the passed <xref:System.Activities.AsyncCodeActivityContext>, and then the query's <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> method is called.</span></span> <span data-ttu-id="de63c-142">Należy zauważyć, że wywołanie zwrotne i stan, które są przesyłane do <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> zapytania są te, które są przesyłane do metody <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> działania.</span><span class="sxs-lookup"><span data-stu-id="de63c-142">Note that the callback and state that are passed into the query's <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> are the ones that are passed in to the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> method.</span></span> <span data-ttu-id="de63c-143">Po zakończeniu wykonywania zapytania zostanie wywołana metoda <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> działania.</span><span class="sxs-lookup"><span data-stu-id="de63c-143">When the query has finished executing, the activity's <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> method is invoked.</span></span> <span data-ttu-id="de63c-144">Zapytanie jest pobierane z <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, a następnie wywoływana jest metoda <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> kwerendy.</span><span class="sxs-lookup"><span data-stu-id="de63c-144">The query is retrieved from the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, and then the query's <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> method is called.</span></span> <span data-ttu-id="de63c-145">Ta metoda zwraca <xref:System.Collections.Generic.IEnumerable%601> określonego typu jednostki; w tym przypadku `Order`.</span><span class="sxs-lookup"><span data-stu-id="de63c-145">This method returns an <xref:System.Collections.Generic.IEnumerable%601> of the specified entity type; in this case `Order`.</span></span> <span data-ttu-id="de63c-146">Ponieważ `IEnumerable<Order>` jest typem ogólnym <xref:System.Activities.AsyncCodeActivity%601>, ten <xref:System.Collections.IEnumerable> jest ustawiany jako <xref:System.Activities.Activity%601.Result%2A> <xref:System.Activities.OutArgument%601> działania.</span><span class="sxs-lookup"><span data-stu-id="de63c-146">Since `IEnumerable<Order>` is the generic type of the <xref:System.Activities.AsyncCodeActivity%601>, this <xref:System.Collections.IEnumerable> is set as the <xref:System.Activities.Activity%601.Result%2A> <xref:System.Activities.OutArgument%601> of the activity.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#100](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#100)]

<span data-ttu-id="de63c-147">W poniższym przykładzie działanie `OrdersByCustomer` pobiera listę zamówień dla określonego klienta, a następnie działanie <xref:System.Activities.Statements.ForEach%601> wylicza zwrócone zamówienia i zapisuje datę każdego zamówienia w konsoli programu.</span><span class="sxs-lookup"><span data-stu-id="de63c-147">In the following example, the `OrdersByCustomer` activity retrieves a list of orders for the specified customer, and then a <xref:System.Activities.Statements.ForEach%601> activity enumerates the returned orders and writes the date of each order to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#10](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#10)]

<span data-ttu-id="de63c-148">Po wywołaniu tego przepływu pracy w konsoli zapisywane są następujące dane:</span><span class="sxs-lookup"><span data-stu-id="de63c-148">When this workflow is invoked, the following data is written to the console:</span></span>

```console
Calling WCF Data Service...
8/25/1997
10/3/1997
10/13/1997
1/15/1998
3/16/1998
4/9/1998
```

> [!NOTE]
> <span data-ttu-id="de63c-149">Jeśli nie można nawiązać połączenia z serwerem OData, zostanie wyświetlony wyjątek podobny do następującego:</span><span class="sxs-lookup"><span data-stu-id="de63c-149">If a connection to the OData server cannot be established, you will get an exception similar to the following exception:</span></span>
>
> <span data-ttu-id="de63c-150">Nieobsługiwany wyjątek: System. InvalidOperationException: Wystąpił błąd podczas przetwarzania tego żądania.</span><span class="sxs-lookup"><span data-stu-id="de63c-150">Unhandled Exception: System.InvalidOperationException: An error occurred while processing this request.</span></span> <span data-ttu-id="de63c-151">---> System .NET. WebException: nie można nawiązać połączenia z serwerem zdalnym---> System .NET. Sockets. SocketException: próba nawiązania połączenia nie powiodła się, ponieważ połączona Strona nie odpowiedziała prawidłowo po upływie określonego czasu lub nawiązane połączenie nie powiodło się ponieważ podłączony host nie odpowiedział.</span><span class="sxs-lookup"><span data-stu-id="de63c-151">---> System.Net.WebException: Unable to connect to the remote server ---> System.Net.Sockets.SocketException: A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond.</span></span>

<span data-ttu-id="de63c-152">Jeśli wymagane jest dodatkowe przetwarzanie danych zwróconych przez zapytanie, można je wykonać w przesłonięciu <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> działania.</span><span class="sxs-lookup"><span data-stu-id="de63c-152">If any additional processing of the data returned by the query is required, it can be done in the activity's <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> override.</span></span> <span data-ttu-id="de63c-153">Zarówno <xref:System.Activities.AsyncCodeActivity%601.BeginExecute%2A>, jak i <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> są wywoływane przy użyciu wątku przepływu pracy, a każdy kod w tych zastąpień nie działa asynchronicznie.</span><span class="sxs-lookup"><span data-stu-id="de63c-153">Both <xref:System.Activities.AsyncCodeActivity%601.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> are invoked by using the workflow thread, and any code in these overrides does not run asynchronously.</span></span> <span data-ttu-id="de63c-154">Jeśli dodatkowe przetwarzanie jest rozległe lub długotrwałe lub wyniki zapytania są stronicowane, należy wziąć pod uwagę podejście omówione w następnej sekcji, która używa delegata do wykonywania zapytania i wykonywania dodatkowego przetwarzania asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="de63c-154">If the additional processing is extensive or long-running, or the query results are paged, you should consider the approach discussed in the next section, which uses a delegate to execute the query and perform additional processing asynchronously.</span></span>

### <a name="using-a-delegate"></a><span data-ttu-id="de63c-155">Korzystanie z delegata</span><span class="sxs-lookup"><span data-stu-id="de63c-155">Using a delegate</span></span>

<span data-ttu-id="de63c-156">Oprócz wywoływania asynchronicznej metody klasy .NET Framework, działania oparte na <xref:System.Activities.AsyncCodeActivity>można także zdefiniować dla logiki asynchronicznej w jednej z jej metod.</span><span class="sxs-lookup"><span data-stu-id="de63c-156">In addition to invoking the asynchronous method of a .NET Framework class, an <xref:System.Activities.AsyncCodeActivity>-based activity can also define the asynchronous logic in one of its methods.</span></span> <span data-ttu-id="de63c-157">Ta metoda jest określana za pomocą delegata w przesłonięciu <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> działania.</span><span class="sxs-lookup"><span data-stu-id="de63c-157">This method is specified by using a delegate in the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override.</span></span> <span data-ttu-id="de63c-158">Gdy metoda zwraca, środowisko uruchomieniowe wywoła przesłonięcie <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> działania.</span><span class="sxs-lookup"><span data-stu-id="de63c-158">When the method returns, the runtime invokes the activity's <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> override.</span></span> <span data-ttu-id="de63c-159">Podczas wywoływania usługi OData z przepływu pracy ta metoda może służyć do wysyłania zapytań do usługi i zapewnienia dodatkowego przetwarzania.</span><span class="sxs-lookup"><span data-stu-id="de63c-159">When calling an OData service from a workflow, this method can be used to query the service and provide any additional processing.</span></span>

<span data-ttu-id="de63c-160">W poniższym przykładzie zdefiniowano działanie `ListCustomers`.</span><span class="sxs-lookup"><span data-stu-id="de63c-160">In the following example, a `ListCustomers` activity is defined.</span></span> <span data-ttu-id="de63c-161">To działanie wysyła zapytanie do przykładowej usługi danych Northwind i zwraca `List<Customer>`, która zawiera wszystkich klientów w bazie danych Northwind.</span><span class="sxs-lookup"><span data-stu-id="de63c-161">This activity queries the sample Northwind data service and returns a `List<Customer>` that contains all of the customers in the Northwind database.</span></span> <span data-ttu-id="de63c-162">Asynchroniczne działanie jest wykonywane przez metodę `GetCustomers`.</span><span class="sxs-lookup"><span data-stu-id="de63c-162">The asynchronous work is performed by the `GetCustomers` method.</span></span> <span data-ttu-id="de63c-163">Ta metoda wysyła zapytanie do usługi dla wszystkich klientów, a następnie kopiuje je do `List<Customer>`.</span><span class="sxs-lookup"><span data-stu-id="de63c-163">This method queries the service for all customers, and then copies them into a `List<Customer>`.</span></span> <span data-ttu-id="de63c-164">Następnie sprawdza, czy wyniki są wyświetlane na stronie.</span><span class="sxs-lookup"><span data-stu-id="de63c-164">It then checks to see if the results are paged.</span></span> <span data-ttu-id="de63c-165">Jeśli tak, wysyła zapytanie do usługi pod kątem następnej strony wyników, dodaje je do listy i kontynuuje do momentu pobrania wszystkich danych klienta.</span><span class="sxs-lookup"><span data-stu-id="de63c-165">If so, it queries the service for the next page of results, adds them to the list, and continues until all of the customer data has been retrieved.</span></span>

> [!NOTE]
> <span data-ttu-id="de63c-166">Aby uzyskać więcej informacji na temat stronicowania w Usługi danych programu WCF, zobacz [How to: Loaded Results (usługi danych programu WCF)](../data/wcf/how-to-load-paged-results-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="de63c-166">For more information about paging in WCF Data Services, see [How to: Load Paged Results (WCF Data Services)](../data/wcf/how-to-load-paged-results-wcf-data-services.md).</span></span>

<span data-ttu-id="de63c-167">Po dodaniu wszystkich klientów zostanie zwrócona lista.</span><span class="sxs-lookup"><span data-stu-id="de63c-167">Once all customers are added, the list is returned.</span></span> <span data-ttu-id="de63c-168">Metoda `GetCustomers` jest określona w przesłonięciu <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> działania.</span><span class="sxs-lookup"><span data-stu-id="de63c-168">The `GetCustomers` method is specified in the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override.</span></span> <span data-ttu-id="de63c-169">Ponieważ metoda ma wartość zwracaną, tworzony jest `Func<string, List<Customer>>`, aby określić metodę.</span><span class="sxs-lookup"><span data-stu-id="de63c-169">Since the method has a return value, a `Func<string, List<Customer>>` is created to specify the method.</span></span>

> [!NOTE]
> <span data-ttu-id="de63c-170">Jeśli metoda wykonująca zadanie asynchroniczne nie ma wartości zwracanej, zamiast <xref:System.Func%601>zostanie użyta <xref:System.Action>.</span><span class="sxs-lookup"><span data-stu-id="de63c-170">If the method that performs the asynchronous work does not have a return value, an <xref:System.Action> is used instead of a <xref:System.Func%601>.</span></span> <span data-ttu-id="de63c-171">Przykłady tworzenia przykładu asynchronicznego przy użyciu obu podejścia można znaleźć w temacie [Tworzenie działań asynchronicznych](creating-asynchronous-activities-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="de63c-171">For examples of creating an asynchronous example using both approaches, see [Creating Asynchronous Activities](creating-asynchronous-activities-in-wf.md).</span></span>

<span data-ttu-id="de63c-172">Ta <xref:System.Func%601> jest przypisana do <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, a następnie `BeginInvoke` jest wywoływana.</span><span class="sxs-lookup"><span data-stu-id="de63c-172">This <xref:System.Func%601> is assigned to the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, and then `BeginInvoke` is called.</span></span> <span data-ttu-id="de63c-173">Ponieważ metoda, która ma zostać wywołana, nie ma dostępu do środowiska działania argumentów, wartość argumentu `ServiceUri` jest przenoszona jako pierwszy parametr wraz z wywołaniem zwrotnym i stanem, które zostały przekazane do <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="de63c-173">Since the method to be invoked does not have access to the activity's environment of arguments, the value of the `ServiceUri` argument is passed as the first parameter, together with the callback and state that were passed into <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span></span> <span data-ttu-id="de63c-174">Gdy `GetCustomers` zwraca, środowisko uruchomieniowe wywoła <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="de63c-174">When `GetCustomers` returns, the runtime invokes <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="de63c-175">Kod w <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> pobiera delegata z <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, wywołuje `EndInvoke`i zwraca wynik, który jest listą klientów zwracanych z metody `GetCustomers`.</span><span class="sxs-lookup"><span data-stu-id="de63c-175">The code in <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> retrieves the delegate from the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, calls `EndInvoke`, and returns the result, which is the list of customers returned from the `GetCustomers` method.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#200](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#200)]

<span data-ttu-id="de63c-176">W poniższym przykładzie działanie `ListCustomers` pobiera listę klientów, a następnie działanie <xref:System.Activities.Statements.ForEach%601> wylicza je i zapisuje nazwę firmy oraz nazwę kontaktu każdego klienta w konsoli programu.</span><span class="sxs-lookup"><span data-stu-id="de63c-176">In the following example, the `ListCustomers` activity retrieves a list of customers, and then a <xref:System.Activities.Statements.ForEach%601> activity enumerates them and writes the company name and contact name of each customer to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#20](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#20)]

<span data-ttu-id="de63c-177">Po wywołaniu tego przepływu pracy następujące dane są zapisywane w konsoli programu.</span><span class="sxs-lookup"><span data-stu-id="de63c-177">When this workflow is invoked, the following data is written to the console.</span></span> <span data-ttu-id="de63c-178">Ponieważ to zapytanie zwraca wielu klientów, w tym miejscu jest wyświetlana tylko część danych wyjściowych.</span><span class="sxs-lookup"><span data-stu-id="de63c-178">Since this query returns many customers, only part of the output is displayed here.</span></span>

```console
Calling WCF Data Service...
Alfreds Futterkiste, Contact: Maria Anders
Ana Trujillo Emparedados y helados, Contact: Ana Trujillo
Antonio Moreno Taquería, Contact: Antonio Moreno
Around the Horn, Contact: Thomas Hardy
Berglunds snabbköp, Contact: Christina Berglund
...
```

## <a name="consuming-an-odata-feed-without-using-the-client-libraries"></a><span data-ttu-id="de63c-179">Zużywanie źródła danych OData bez użycia bibliotek klienckich</span><span class="sxs-lookup"><span data-stu-id="de63c-179">Consuming an OData feed without using the client libraries</span></span>

<span data-ttu-id="de63c-180">Usługa OData udostępnia dane jako zasoby, które są adresowane przez identyfikatory URI.</span><span class="sxs-lookup"><span data-stu-id="de63c-180">OData exposes data as resources that are addressable by URIs.</span></span> <span data-ttu-id="de63c-181">W przypadku korzystania z bibliotek klienckich te identyfikatory URI są tworzone dla Ciebie, ale nie trzeba używać bibliotek klienckich.</span><span class="sxs-lookup"><span data-stu-id="de63c-181">When you use the client libraries these URIs are created for you, but you do not have to use the client libraries.</span></span> <span data-ttu-id="de63c-182">W razie potrzeby usługi OData są dostępne bezpośrednio bez używania bibliotek klienckich.</span><span class="sxs-lookup"><span data-stu-id="de63c-182">If desired, OData services can be accessed directly without using the client libraries.</span></span> <span data-ttu-id="de63c-183">Gdy nie korzystasz z bibliotek klienckich, lokalizacja usługi i żądane dane są określone przez identyfikator URI, a wyniki są zwracane w odpowiedzi na żądanie HTTP.</span><span class="sxs-lookup"><span data-stu-id="de63c-183">When not using the client libraries the location of the service and the desired data are specified by the URI and the results are returned in the response to the HTTP request.</span></span> <span data-ttu-id="de63c-184">Te nieprzetworzone dane można następnie przetworzyć lub przetwarzać w odpowiedni sposób.</span><span class="sxs-lookup"><span data-stu-id="de63c-184">This raw data can then be processed or manipulated in the desired manner.</span></span> <span data-ttu-id="de63c-185">Jednym ze sposobów pobierania wyników zapytania OData jest użycie klasy <xref:System.Net.WebClient>.</span><span class="sxs-lookup"><span data-stu-id="de63c-185">One way to retrieve the results of an OData query is by using the <xref:System.Net.WebClient> class.</span></span> <span data-ttu-id="de63c-186">W tym przykładzie zostanie pobrana nazwa kontaktu dla klienta reprezentowanego przez usługi Key ALFKI.</span><span class="sxs-lookup"><span data-stu-id="de63c-186">In this example, the contact name for the customer represented by the key ALFKI is retrieved.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#2](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#2)]

<span data-ttu-id="de63c-187">Po uruchomieniu tego kodu następujące dane wyjściowe są wyświetlane w konsoli programu:</span><span class="sxs-lookup"><span data-stu-id="de63c-187">When this code is run, the following output is displayed to the console:</span></span>

```console
Raw data returned:
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<ContactName xmlns="http://schemas.microsoft.com/ado/2007/08/dataservices">Maria Anders</ContactName>
```

<span data-ttu-id="de63c-188">W przepływie pracy kod z tego przykładu można włączyć do <xref:System.Activities.CodeActivity.Execute%2A> przesłonięcia niestandardowego działania opartego na <xref:System.Activities.CodeActivity>, ale te same funkcje można także wykonać przy użyciu działania <xref:System.Activities.Expressions.InvokeMethod%601>.</span><span class="sxs-lookup"><span data-stu-id="de63c-188">In a workflow, the code from this example could be incorporated into the <xref:System.Activities.CodeActivity.Execute%2A> override of a <xref:System.Activities.CodeActivity>-based custom activity, but the same functionality can also be accomplished by using the <xref:System.Activities.Expressions.InvokeMethod%601> activity.</span></span> <span data-ttu-id="de63c-189">Działanie <xref:System.Activities.Expressions.InvokeMethod%601> umożliwia autorom przepływu pracy wywoływanie metod statycznych i wystąpień klasy, a także opcję wywołania określonej metody asynchronicznie.</span><span class="sxs-lookup"><span data-stu-id="de63c-189">The <xref:System.Activities.Expressions.InvokeMethod%601> activity enables workflow authors to invoke static and instance methods of a class, and also has an option to invoke the specified method asynchronously.</span></span> <span data-ttu-id="de63c-190">W poniższym przykładzie działanie <xref:System.Activities.Expressions.InvokeMethod%601> jest skonfigurowane do wywoływania metody <xref:System.Net.WebClient.DownloadString%2A> klasy <xref:System.Net.WebClient> i zwracania listy klientów.</span><span class="sxs-lookup"><span data-stu-id="de63c-190">In the following example, an <xref:System.Activities.Expressions.InvokeMethod%601> activity is configured to call the <xref:System.Net.WebClient.DownloadString%2A> method of the <xref:System.Net.WebClient> class and return a list of customers.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#3](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#3)]

<span data-ttu-id="de63c-191"><xref:System.Activities.Expressions.InvokeMethod%601> może wywoływać zarówno metody statyczne, jak i wystąpienia klasy.</span><span class="sxs-lookup"><span data-stu-id="de63c-191"><xref:System.Activities.Expressions.InvokeMethod%601> can call both static and instance methods of a class.</span></span> <span data-ttu-id="de63c-192">Ponieważ <xref:System.Net.WebClient.DownloadString%2A> jest metodą wystąpienia klasy <xref:System.Net.WebClient>, dla <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A>określono nowe wystąpienie klasy <xref:System.Net.WebClient>.</span><span class="sxs-lookup"><span data-stu-id="de63c-192">Since <xref:System.Net.WebClient.DownloadString%2A> is an instance method of the <xref:System.Net.WebClient> class, a new instance of the <xref:System.Net.WebClient> class is specified for the <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A>.</span></span> <span data-ttu-id="de63c-193">`DownloadString` jest określony jako <xref:System.Activities.Expressions.InvokeMethod%601.MethodName%2A>, identyfikator URI, który zawiera zapytanie, jest określony w kolekcji <xref:System.Activities.Expressions.InvokeMethod%601.Parameters%2A>, a wartość zwracana jest przypisywana do wartości <xref:System.Activities.Activity%601.Result%2A>.</span><span class="sxs-lookup"><span data-stu-id="de63c-193">`DownloadString` is specified as the <xref:System.Activities.Expressions.InvokeMethod%601.MethodName%2A>, the URI that contains the query is specified in the <xref:System.Activities.Expressions.InvokeMethod%601.Parameters%2A> collection, and the return value is assigned to the <xref:System.Activities.Activity%601.Result%2A> value.</span></span> <span data-ttu-id="de63c-194">Wartość <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A> jest ustawiona na `true`, co oznacza, że wywołanie metody zostanie uruchomione asynchronicznie w odniesieniu do przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="de63c-194">The <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A> value is set to `true`, which means that the method invocation will run asynchronously with regard to the workflow.</span></span> <span data-ttu-id="de63c-195">W poniższym przykładzie zostanie skonstruowany przepływ pracy, który używa działania <xref:System.Activities.Expressions.InvokeMethod%601>, aby wykonać zapytanie dotyczące przykładowej usługi danych Northwind o listę zamówień dla określonego klienta, a następnie zwrócone dane są zapisywane w konsoli programu.</span><span class="sxs-lookup"><span data-stu-id="de63c-195">In the following example, a workflow is constructed that uses the <xref:System.Activities.Expressions.InvokeMethod%601> activity to query the sample Northwind data service for a list of orders for a specific customer, and then the returned data is written to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#1](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#1)]

<span data-ttu-id="de63c-196">Po wywołaniu tego przepływu pracy następujące dane wyjściowe są wyświetlane w konsoli programu.</span><span class="sxs-lookup"><span data-stu-id="de63c-196">When this workflow is invoked, the following output is displayed to the console.</span></span> <span data-ttu-id="de63c-197">Ponieważ to zapytanie zwraca kilka zamówień, w tym miejscu są wyświetlane tylko część danych wyjściowych.</span><span class="sxs-lookup"><span data-stu-id="de63c-197">Since this query returns several orders, only part of the output is displayed here.</span></span>

```console
Calling WCF Data Service...
Raw data returned:

<?xml version="1.0" encoding="utf-8" standalone="yes"?>*
<feed
xml:base="http://services.odata.org/Northwind/Northwind.svc/"
xmlns:d="http://schemas.microsoft.com/ado/2007/08/dataservices"
xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata"
xmlns="http://www.w3.org/2005/Atom">
<title type="text">Orders\</title>
<id>http://services.odata.org/Northwind/Northwind.svc/Customers('ALFKI')/Orders\</id>
<updated>2010-05-19T19:37:07Z\</updated>
<link rel="self" title="Orders" href="Orders" />
<entry>
<id>http://services.odata.org/Northwind/Northwind.svc/Orders(10643)\</id>
<title type="text">\</title>
<updated>2010-05-19T19:37:07Z\</updated>
<author>
<name />
</author>
<link rel="edit" title="Order" href="Orders(10643)" />
<link rel="http://schemas.microsoft.com/ado/2007/08/dataservices/related/Customer" type="application/atom+xml;type=entry" title="Customer" href="Orders(10643)/Customer" />
...
```

<span data-ttu-id="de63c-198">Ten przykład zawiera jedną metodę, która może być używana przez autorów aplikacji przepływu pracy do korzystania z danych pierwotnych zwróconych z usługi OData.</span><span class="sxs-lookup"><span data-stu-id="de63c-198">This example provides one method that workflow application authors can use to consume the raw data returned from an OData service.</span></span> <span data-ttu-id="de63c-199">Aby uzyskać więcej informacji na temat uzyskiwania dostępu do Usługi danych programu WCF przy użyciu identyfikatorów URI, zobacz [Uzyskiwanie dostępu do zasobów usługi Data Service (usługi danych programu WCF) i protokołu](../data/wcf/accessing-data-service-resources-wcf-data-services.md) [OData: URI](https://www.odata.org/documentation/odata-version-2-0/uri-conventions/).</span><span class="sxs-lookup"><span data-stu-id="de63c-199">For more information about accessing WCF Data Services using URIs, see [Accessing Data Service Resources (WCF Data Services)](../data/wcf/accessing-data-service-resources-wcf-data-services.md) and [OData: URI Conventions](https://www.odata.org/documentation/odata-version-2-0/uri-conventions/).</span></span>
