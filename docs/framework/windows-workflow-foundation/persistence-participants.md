---
title: Uczestnicy stanów trwałych
ms.date: 03/30/2017
ms.assetid: f84d2d5d-1c1b-4f19-be45-65b552d3e9e3
ms.openlocfilehash: 0bff6cc8fafb1832dc4d0e33b754fe3adb81dcf6
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/26/2020
ms.locfileid: "96246111"
---
# <a name="persistence-participants"></a><span data-ttu-id="6bcff-102">Uczestnicy stanów trwałych</span><span class="sxs-lookup"><span data-stu-id="6bcff-102">Persistence Participants</span></span>

<span data-ttu-id="6bcff-103">Uczestnik trwałości może uczestniczyć w operacji trwałości (Save lub Load) wyzwalanej przez hosta aplikacji.</span><span class="sxs-lookup"><span data-stu-id="6bcff-103">A persistence participant can participate in a persistence operation (Save or Load) triggered by an application host.</span></span> <span data-ttu-id="6bcff-104">[!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)]Statki mające dwie klasy abstrakcyjne, **PersistenceParticipant** i **PersistenceIOParticipant**, których można użyć do utworzenia uczestnika trwałości.</span><span class="sxs-lookup"><span data-stu-id="6bcff-104">The [!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] ships with two abstract classes, **PersistenceParticipant** and **PersistenceIOParticipant**, which you can use to create a persistence participant.</span></span> <span data-ttu-id="6bcff-105">Uczestnik trwałości pochodzi z jednej z tych klas, implementuje metody zainteresowania, a następnie dodaje wystąpienie klasy do <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> kolekcji na <xref:System.ServiceModel.Activities.WorkflowServiceHost> .</span><span class="sxs-lookup"><span data-stu-id="6bcff-105">A persistence participant derives from one of these classes, implements the methods of interest, and then adds an instance of the class to the <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> collection on the <xref:System.ServiceModel.Activities.WorkflowServiceHost> .</span></span> <span data-ttu-id="6bcff-106">Host aplikacji może wyszukiwać takie rozszerzenia przepływu pracy podczas utrwalania wystąpienia przepływu pracy i wywoływać odpowiednie metody dla uczestników trwałości w odpowiednim czasie.</span><span class="sxs-lookup"><span data-stu-id="6bcff-106">The application host may look for such workflow extensions when persisting a workflow instance and invoke appropriate methods on the persistence participants at appropriate times.</span></span>  
  
 <span data-ttu-id="6bcff-107">Poniższa lista zawiera opis zadań wykonywanych przez podsystem trwałości na różnych etapach operacji utrwalania (Save).</span><span class="sxs-lookup"><span data-stu-id="6bcff-107">The following list describes the tasks performed by the persistence subsystem in different stages of the Persist (Save) operation.</span></span> <span data-ttu-id="6bcff-108">Uczestnicy trwałości są używani w trzecim i czwartym etapie.</span><span class="sxs-lookup"><span data-stu-id="6bcff-108">The persistence participants are used in the third and fourth stages.</span></span> <span data-ttu-id="6bcff-109">Jeśli uczestnik jest uczestnikiem we/wy (uczestnik trwałości, który również uczestniczy w operacjach we/wy), uczestnik jest również używany na szóstym etapie.</span><span class="sxs-lookup"><span data-stu-id="6bcff-109">If the participant is an I/O participant (a persistence participant that also participates in I/O operations), the participant is also used in the sixth stage.</span></span>  
  
1. <span data-ttu-id="6bcff-110">Gromadzi wartości wbudowane, w tym stan przepływu pracy, zakładki, zmapowane zmienne i sygnaturę czasową.</span><span class="sxs-lookup"><span data-stu-id="6bcff-110">Gathers built-in values, including workflow state, bookmarks, mapped variables, and timestamp.</span></span>  
  
2. <span data-ttu-id="6bcff-111">Gromadzi wszystkich uczestników trwałości, którzy zostali dodani do kolekcji rozszerzeń skojarzonej z wystąpieniem przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="6bcff-111">Gathers all persistence participants that were added to the extension collection associated with the workflow instance.</span></span>  
  
3. <span data-ttu-id="6bcff-112">Wywołuje <xref:System.Activities.Persistence.PersistenceParticipant.CollectValues%2A> metodę zaimplementowaną przez wszystkich uczestników trwałości.</span><span class="sxs-lookup"><span data-stu-id="6bcff-112">Invokes the <xref:System.Activities.Persistence.PersistenceParticipant.CollectValues%2A> method implemented by all persistence participants.</span></span>  
  
4. <span data-ttu-id="6bcff-113">Wywołuje <xref:System.Activities.Persistence.PersistenceParticipant.MapValues%2A> metodę zaimplementowaną przez wszystkich uczestników trwałości.</span><span class="sxs-lookup"><span data-stu-id="6bcff-113">Invokes the <xref:System.Activities.Persistence.PersistenceParticipant.MapValues%2A> method implemented by all persistence participants.</span></span>  
  
5. <span data-ttu-id="6bcff-114">Utrwalanie lub zapisywanie przepływu pracy w magazynie trwałości.</span><span class="sxs-lookup"><span data-stu-id="6bcff-114">Persist or save the workflow into the persistence store.</span></span>  
  
6. <span data-ttu-id="6bcff-115">Wywołuje <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnSave%2A> metodę we wszystkich uczestnikach we/wy trwałości.</span><span class="sxs-lookup"><span data-stu-id="6bcff-115">Invokes the <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnSave%2A> method on all of the persistence I/O participants.</span></span> <span data-ttu-id="6bcff-116">Jeśli uczestnik nie jest uczestnikiem we/wy, to zadanie jest pomijane.</span><span class="sxs-lookup"><span data-stu-id="6bcff-116">If the participant is not an I/O participant, this task is skipped.</span></span> <span data-ttu-id="6bcff-117">Jeśli odcinek trwałości jest transakcyjny, transakcja jest udostępniana w właściwości TRANSACTION. Current.</span><span class="sxs-lookup"><span data-stu-id="6bcff-117">If the persistence episode is transactional, the transaction is provided in Transaction.Current property.</span></span>  
  
7. <span data-ttu-id="6bcff-118">Czeka na zakończenie wszystkich uczestników trwałości.</span><span class="sxs-lookup"><span data-stu-id="6bcff-118">Waits for all persistence participants to complete.</span></span> <span data-ttu-id="6bcff-119">Jeśli wszyscy uczestnicy pomyślnie zachowują dane wystąpienia, zatwierdziją transakcję.</span><span class="sxs-lookup"><span data-stu-id="6bcff-119">If all the participants succeed in persisting instance data, commits the transaction.</span></span>  
  
 <span data-ttu-id="6bcff-120">Uczestnik trwałości pochodzi z klasy **PersistenceParticipant** i może implementować metody **CollectValues** i **MapValues** .</span><span class="sxs-lookup"><span data-stu-id="6bcff-120">A persistence participant derives from the **PersistenceParticipant** class and may implement the **CollectValues** and **MapValues** methods.</span></span> <span data-ttu-id="6bcff-121">Uczestnik we/wy o trwałości pochodzi z klasy **PersistenceIOParticipant** i może zaimplementować metodę **BeginOnSave** oprócz implementacji metod **CollectValues** i **MapValues** .</span><span class="sxs-lookup"><span data-stu-id="6bcff-121">A persistence I/O participant derives from the **PersistenceIOParticipant** class and may implement the **BeginOnSave** method in addition to implementing the **CollectValues** and **MapValues** methods.</span></span>  
  
 <span data-ttu-id="6bcff-122">Każdy etap zostanie ukończony przed rozpoczęciem następnego etapu.</span><span class="sxs-lookup"><span data-stu-id="6bcff-122">Each stage is completed before the next stage begins.</span></span> <span data-ttu-id="6bcff-123">Na przykład wartości są zbierane od **wszystkich** uczestników trwałości w pierwszym etapie.</span><span class="sxs-lookup"><span data-stu-id="6bcff-123">For example, values are collected from **all** persistence participants in the first stage.</span></span> <span data-ttu-id="6bcff-124">Następnie wszystkie wartości zebrane w pierwszym etapie są udostępniane wszystkim uczestnikom trwałości w drugim etapie na potrzeby mapowania.</span><span class="sxs-lookup"><span data-stu-id="6bcff-124">Then all the values collected in the first stage are provided to all persistence participants in the second stage for mapping.</span></span> <span data-ttu-id="6bcff-125">Następnie wszystkie wartości zbierane i mapowane na pierwszy i drugi etap są udostępniane dostawcy trwałości w trzecim etapie i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="6bcff-125">Then all the values collected and mapped in the first and second stages are provided to the persistence provider in the third stage, and so on.</span></span>  
  
 <span data-ttu-id="6bcff-126">Poniższa lista zawiera opis zadań wykonywanych przez podsystem trwałości na różnych etapach operacji ładowania.</span><span class="sxs-lookup"><span data-stu-id="6bcff-126">The following list describes the tasks performed by the persistence subsystem in different stages of the Load operation.</span></span> <span data-ttu-id="6bcff-127">Uczestnicy trwałości są używani w czwartym etapie.</span><span class="sxs-lookup"><span data-stu-id="6bcff-127">The persistence participants are used in the fourth stage.</span></span> <span data-ttu-id="6bcff-128">Uczestnicy operacji we/wy (uczestnicy trwałości, którzy również uczestniczą w operacjach we/wy) również są używani w trzecim etapie.</span><span class="sxs-lookup"><span data-stu-id="6bcff-128">The persistence I/O participants (persistence participants that also participate in I/O operations) are also used in the third stage.</span></span>  
  
1. <span data-ttu-id="6bcff-129">Gromadzi wszystkich uczestników trwałości, którzy zostali dodani do kolekcji rozszerzeń skojarzonej z wystąpieniem przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="6bcff-129">Gathers all persistence participants that were added to the extension collection associated with the workflow instance.</span></span>  
  
2. <span data-ttu-id="6bcff-130">Ładuje przepływ pracy z magazynu trwałości.</span><span class="sxs-lookup"><span data-stu-id="6bcff-130">Loads the workflow from the persistence store.</span></span>  
  
3. <span data-ttu-id="6bcff-131">Wywołuje <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnLoad%2A> wszystkie uczestników we/wy o trwałości i czeka na zakończenie wszystkich uczestników trwałości.</span><span class="sxs-lookup"><span data-stu-id="6bcff-131">Invokes the <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnLoad%2A> on all persistence I/O participants and waits for all the persistence participants to complete.</span></span> <span data-ttu-id="6bcff-132">Jeśli odcinek trwałości jest transakcyjny, transakcja jest dostarczana w Transaction. Current.</span><span class="sxs-lookup"><span data-stu-id="6bcff-132">If the persistence episode is transactional, the transaction is provided in Transaction.Current.</span></span>  
  
4. <span data-ttu-id="6bcff-133">Ładuje wystąpienie przepływu pracy w pamięci na podstawie danych pobranych z magazynu trwałości.</span><span class="sxs-lookup"><span data-stu-id="6bcff-133">Loads the workflow instance in memory based on the data retrieved from the persistence store.</span></span>  
  
5. <span data-ttu-id="6bcff-134">Wywołuje <xref:System.Activities.Persistence.PersistenceParticipant.PublishValues%2A> każdy uczestnik trwałości.</span><span class="sxs-lookup"><span data-stu-id="6bcff-134">Invokes <xref:System.Activities.Persistence.PersistenceParticipant.PublishValues%2A> on each persistence participant.</span></span>  
  
 <span data-ttu-id="6bcff-135">Uczestnik trwałości pochodzi z klasy **PersistenceParticipant** i może zaimplementować metodę **PublishValues** .</span><span class="sxs-lookup"><span data-stu-id="6bcff-135">A persistence participant derives from the **PersistenceParticipant** class and may implement the **PublishValues** method.</span></span> <span data-ttu-id="6bcff-136">Uczestnik we/wy o trwałości pochodzi z klasy **PersistenceIOParticipant** i może zaimplementować metodę **BeginOnLoad** oprócz implementacji metody **PublishValues** .</span><span class="sxs-lookup"><span data-stu-id="6bcff-136">A persistence I/O participant derives from the **PersistenceIOParticipant** class and may implement the **BeginOnLoad** method in addition to implementing the **PublishValues** method.</span></span>  
  
 <span data-ttu-id="6bcff-137">Podczas ładowania wystąpienia przepływu pracy dostawca trwałości tworzy blokadę dla tego wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="6bcff-137">When loading a workflow instance the persistence provider creates a lock on that instance.</span></span> <span data-ttu-id="6bcff-138">Zapobiega to załadowaniu wystąpienia przez więcej niż jeden host w scenariuszu z wieloma węzłami.</span><span class="sxs-lookup"><span data-stu-id="6bcff-138">This prevents the instance from being loaded by more than one host in a multi-node scenario.</span></span> <span data-ttu-id="6bcff-139">Jeśli spróbujesz załadować wystąpienie przepływu pracy, które zostało zablokowane, zobaczysz wyjątek podobny do następującego: wyjątek "System. ServiceModel. trwałości. InstanceLockException —: Żądana operacja nie mogła zostać ukończona, ponieważ nie można uzyskać blokady wystąpienia" 00000000-0000-0000-0000-000000000000 ".</span><span class="sxs-lookup"><span data-stu-id="6bcff-139">If you attempt to load a workflow instance that has been locked you will see an exception like the following: The exception " System.ServiceModel.Persistence.InstanceLockException: The requested operation could not complete because the lock for instance '00000000-0000-0000-0000-000000000000' could not be acquired".</span></span> <span data-ttu-id="6bcff-140">Ten błąd jest spowodowany wystąpieniem jednej z następujących sytuacji:</span><span class="sxs-lookup"><span data-stu-id="6bcff-140">This error is caused when one of the following occurs:</span></span>  
  
- <span data-ttu-id="6bcff-141">W scenariuszu obejmującym wiele węzłów wystąpienie jest ładowane przez innego hosta.</span><span class="sxs-lookup"><span data-stu-id="6bcff-141">In a multi-node scenario the instance is loaded by another host.</span></span>  <span data-ttu-id="6bcff-142">Istnieje kilka różnych sposobów rozwiązywania tych rodzajów konfliktów: przekazanie przetwarzania do węzła, który jest właścicielem blokady i ponawianie próby, lub wymuszenie obciążenia, co spowoduje, że inny host nie będzie mógł zapisać swojej pracy.</span><span class="sxs-lookup"><span data-stu-id="6bcff-142">There are a few different ways to resolve these types of conflicts: forward the processing to the node which owns the lock and retry, or force the load which will cause the other host to be unable to save their work.</span></span>  
  
- <span data-ttu-id="6bcff-143">W scenariuszu z jednym węzłem i awarią hosta.</span><span class="sxs-lookup"><span data-stu-id="6bcff-143">In a single-node scenario and the host crashed.</span></span>  <span data-ttu-id="6bcff-144">Po ponownym uruchomieniu hosta (proces odtwarzania lub utworzeniu nowej fabryki dostawców trwałości) Nowy host próbuje załadować wystąpienie, które jest nadal blokowane przez stary host, ponieważ blokada jeszcze nie wygasła.</span><span class="sxs-lookup"><span data-stu-id="6bcff-144">When the host starts up again (a process recycle or creating a new persistence provider factory) the new host attempts to load an instance which is still locked by the old host because the lock hasn't expired yet.</span></span>  
  
- <span data-ttu-id="6bcff-145">W scenariuszu z jednym węzłem, a dane wystąpienie zostało przerwane w pewnym momencie i zostanie utworzone nowe wystąpienie dostawcy trwałości o innym IDENTYFIKATORze hosta.</span><span class="sxs-lookup"><span data-stu-id="6bcff-145">In a single-node scenario and the instance in question was aborted at some point and a new persistence provider instance is created which has a different host ID.</span></span>  
  
 <span data-ttu-id="6bcff-146">Wartość limitu czasu blokady ma wartość domyślną wynoszącą 5 minut, podczas wywoływania należy określić inną wartość limitu czasu <xref:System.ServiceModel.Persistence.PersistenceProvider.Load%2A> .</span><span class="sxs-lookup"><span data-stu-id="6bcff-146">The lock timeout value has a default value of 5 minutes, you can specify a different timeout value when calling <xref:System.ServiceModel.Persistence.PersistenceProvider.Load%2A>.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="6bcff-147">W tej sekcji</span><span class="sxs-lookup"><span data-stu-id="6bcff-147">In This Section</span></span>  
  
- [<span data-ttu-id="6bcff-148">Instrukcje: Tworzenie niestandardowego uczestnika stanów trwałych</span><span class="sxs-lookup"><span data-stu-id="6bcff-148">How to: Create a Custom Persistence Participant</span></span>](how-to-create-a-custom-persistence-participant.md)  
  
## <a name="see-also"></a><span data-ttu-id="6bcff-149">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="6bcff-149">See also</span></span>

- [<span data-ttu-id="6bcff-150">Rozszerzalność magazynu</span><span class="sxs-lookup"><span data-stu-id="6bcff-150">Store Extensibility</span></span>](store-extensibility.md)
