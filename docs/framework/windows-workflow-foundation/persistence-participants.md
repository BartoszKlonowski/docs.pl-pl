---
title: "Uczestnicy trwałości"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: f84d2d5d-1c1b-4f19-be45-65b552d3e9e3
caps.latest.revision: "14"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: a19099ea928e8867dd8206b8add0f1146496d052
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/18/2017
---
# <a name="persistence-participants"></a><span data-ttu-id="8c6f1-102">Uczestnicy trwałości</span><span class="sxs-lookup"><span data-stu-id="8c6f1-102">Persistence Participants</span></span>
<span data-ttu-id="8c6f1-103">Uczestnika trwałości mogą uczestniczyć w operacji trwałości (Zapisz lub obciążenia) wyzwalane przez hosta aplikacji.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-103">A persistence participant can participate in a persistence operation (Save or Load) triggered by an application host.</span></span> <span data-ttu-id="8c6f1-104">[!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] Jest dostarczany z dwóch klas abstrakcyjnych, **PersistenceParticipant** i **PersistenceIOParticipant**, które służy do tworzenia uczestnika trwałości.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-104">The [!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] ships with two abstract classes, **PersistenceParticipant** and **PersistenceIOParticipant**, which you can use to create a persistence participant.</span></span> <span data-ttu-id="8c6f1-105">Uczestnika trwałości pochodzi z jednego z tych klas, implementuje metody zainteresowań, a następnie dodanie wystąpienia klasy do <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> kolekcji na <xref:System.ServiceModel.Activities.WorkflowServiceHost> .</span><span class="sxs-lookup"><span data-stu-id="8c6f1-105">A persistence participant derives from one of these classes, implements the methods of interest, and then adds an instance of the class to the <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> collection on the <xref:System.ServiceModel.Activities.WorkflowServiceHost> .</span></span> <span data-ttu-id="8c6f1-106">Host aplikacji może wyglądać dla tych rozszerzeń przepływu pracy po trwałym wystąpienia przepływu pracy i wywołać odpowiednie metody uczestnika trwałości w odpowiednim czasie.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-106">The application host may look for such workflow extensions when persisting a workflow instance and invoke appropriate methods on the persistence participants at appropriate times.</span></span>  
  
 <span data-ttu-id="8c6f1-107">Na poniższej liście opisano zadania wykonywane przez podsystem trwałości na różnych etapach operacji utrwalania (Zapisz).</span><span class="sxs-lookup"><span data-stu-id="8c6f1-107">The following list describes the tasks performed by the persistence subsystem in different stages of the Persist (Save) operation.</span></span> <span data-ttu-id="8c6f1-108">Uczestnicy trwałości są używane w trzecim i czwartym etapach.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-108">The persistence participants are used in the third and fourth stages.</span></span> <span data-ttu-id="8c6f1-109">Jeśli uczestnik jest uczestnika we/wy (trwałości uczestnika, który również uczestniczy w operacjach we/wy), uczestnik jest również używane w fazie szóstego.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-109">If the participant is an IO participant (a persistence participant that also participates in IO operations), the participant is also used in the sixth stage.</span></span>  
  
1.  <span data-ttu-id="8c6f1-110">Zbiera informacje o wbudowanych wartości, w tym stanu przepływu pracy, zakładki zamapowanych zmienne i sygnatura czasowa.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-110">Gathers built-in values, including workflow state, bookmarks, mapped variables, and timestamp.</span></span>  
  
2.  <span data-ttu-id="8c6f1-111">Zbiera informacje o wszystkich uczestników trwałości, które zostały dodane do kolekcji rozszerzeń skojarzonej z wystąpieniem przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-111">Gathers all persistence participants that were added to the extension collection associated with the workflow instance.</span></span>  
  
3.  <span data-ttu-id="8c6f1-112">Wywołuje <xref:System.Activities.Persistence.PersistenceParticipant.CollectValues%2A> metoda zaimplementowana przez wszystkich uczestników trwałości.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-112">Invokes the <xref:System.Activities.Persistence.PersistenceParticipant.CollectValues%2A> method implemented by all persistence participants.</span></span>  
  
4.  <span data-ttu-id="8c6f1-113">Wywołuje <xref:System.Activities.Persistence.PersistenceParticipant.MapValues%2A> metoda zaimplementowana przez wszystkich uczestników trwałości.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-113">Invokes the <xref:System.Activities.Persistence.PersistenceParticipant.MapValues%2A> method implemented by all persistence participants.</span></span>  
  
5.  <span data-ttu-id="8c6f1-114">Utrwalić lub zapisać ten przepływ pracy w magazynie informacji o trwałości.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-114">Persist or save the workflow into the persistence store.</span></span>  
  
6.  <span data-ttu-id="8c6f1-115">Wywołuje <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnSave%2A> metody dla wszystkich uczestników we/wy trwałości.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-115">Invokes the <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnSave%2A> method on all of the persistence IO participants.</span></span> <span data-ttu-id="8c6f1-116">Jeśli go nie ma uczestnika we/wy, to zadanie zostanie pominięte.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-116">If the participant is not an IO participant, this task is skipped.</span></span> <span data-ttu-id="8c6f1-117">Jeśli epizodu trwałości jest transakcyjna, transakcja jest świadczona w Właściwość Transaction.Current.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-117">If the persistence episode is transactional, the transaction is provided in Transaction.Current property.</span></span>  
  
7.  <span data-ttu-id="8c6f1-118">Czeka na zakończenie wszystkich uczestników trwałości.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-118">Waits for all persistence participants to complete.</span></span> <span data-ttu-id="8c6f1-119">W przypadku wszystkich uczestników w trwałych danych wystąpienia, zatwierdza transakcji.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-119">If all the participants succeed in persisting instance data, commits the transaction.</span></span>  
  
 <span data-ttu-id="8c6f1-120">Uczestnika trwałości pochodną **PersistenceParticipant** klasy i może wdrożyć **obiektu CollectValues** i **obiektu MapValues** metody.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-120">A persistence participant derives from the **PersistenceParticipant** class and may implement the **CollectValues** and **MapValues** methods.</span></span> <span data-ttu-id="8c6f1-121">We/Wy uczestnika trwałości pochodną **PersistenceIOParticipant** klasy i może wdrożyć **BeginOnSave** metodę oprócz wykonania **obiektu CollectValues**i **obiektu MapValues** metody.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-121">A persistence IO participant derives from the **PersistenceIOParticipant** class and may implement the **BeginOnSave** method in addition to implementing the **CollectValues** and **MapValues** methods.</span></span>  
  
 <span data-ttu-id="8c6f1-122">Na każdym z etapów zostało ukończone przed rozpoczęciem kolejnego etapu.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-122">Each stage is completed before the next stage begins.</span></span> <span data-ttu-id="8c6f1-123">Na przykład wartości pochodzą z **wszystkie** uczestników trwałości podczas pierwszego etapu.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-123">For example, values are collected from **all** persistence participants in the first stage.</span></span> <span data-ttu-id="8c6f1-124">Następnie wszystkie wartości zebranych podczas pierwszego etapu są przekazywane do wszystkich uczestników trwałości w drugim etapie mapowania.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-124">Then all the values collected in the first stage are provided to all persistence participants in the second stage for mapping.</span></span> <span data-ttu-id="8c6f1-125">Następnie wszystkie wartości zbierane i zamapowana pierwszego i drugiego etapu są dostarczane do dostawcy trwałości w trzecim etapie i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-125">Then all the values collected and mapped in the first and second stages are provided to the persistence provider in the third stage, and so on.</span></span>  
  
 <span data-ttu-id="8c6f1-126">Na poniższej liście opisano zadania wykonywane przez podsystem trwałości na różnych etapach operacji ładowania.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-126">The following list describes the tasks performed by the persistence subsystem in different stages of the Load operation.</span></span> <span data-ttu-id="8c6f1-127">Uczestnicy trwałości są używane w czwartym etapie.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-127">The persistence participants are used in the fourth stage.</span></span> <span data-ttu-id="8c6f1-128">Trwałość uczestników we/wy (uczestników trwałości, które również uczestniczyć w operacji We/Wy) są również używane w trzecim etapie.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-128">The persistence IO participants (persistence participants that also participate in IO operations) are also used in the third stage.</span></span>  
  
1.  <span data-ttu-id="8c6f1-129">Zbiera informacje o wszystkich uczestników trwałości, które zostały dodane do kolekcji rozszerzeń skojarzonej z wystąpieniem przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-129">Gathers all persistence participants that were added to the extension collection associated with the workflow instance.</span></span>  
  
2.  <span data-ttu-id="8c6f1-130">Ładuje przepływu pracy w sklepie trwałości.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-130">Loads the workflow from the persistence store.</span></span>  
  
3.  <span data-ttu-id="8c6f1-131">Wywołuje <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnLoad%2A> dla wszystkich uczestników we/wy trwałości i czeka na wszystkich uczestników trwałości do wykonania.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-131">Invokes the <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnLoad%2A> on all persistence IO participants and waits for all the persistence participants to complete.</span></span> <span data-ttu-id="8c6f1-132">Jeśli epizodu trwałości jest transakcyjna, transakcja znajduje się w operacji Transaction.Current.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-132">If the persistence episode is transactional, the transaction is provided in Transaction.Current.</span></span>  
  
4.  <span data-ttu-id="8c6f1-133">Ładuje wystąpienia przepływu pracy w pamięci na podstawie danych pobrana z magazynu trwałości.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-133">Loads the workflow instance in memory based on the data retrieved from the persistence store.</span></span>  
  
5.  <span data-ttu-id="8c6f1-134">Wywołuje <xref:System.Activities.Persistence.PersistenceParticipant.PublishValues%2A> na każdym uczestnika trwałości.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-134">Invokes <xref:System.Activities.Persistence.PersistenceParticipant.PublishValues%2A> on each persistence participant.</span></span>  
  
 <span data-ttu-id="8c6f1-135">Uczestnika trwałości pochodną **PersistenceParticipant** klasy i może wdrożyć **PublishValues** metody.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-135">A persistence participant derives from the **PersistenceParticipant** class and may implement the **PublishValues** method.</span></span> <span data-ttu-id="8c6f1-136">We/Wy uczestnika trwałości pochodną **PersistenceIOParticipant** klasy i może wdrożyć **BeginOnLoad** metodę oprócz wykonania **PublishValues**metody.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-136">A persistence IO participant derives from the **PersistenceIOParticipant** class and may implement the **BeginOnLoad** method in addition to implementing the **PublishValues** method.</span></span>  
  
 <span data-ttu-id="8c6f1-137">Podczas ładowania wystąpienia przepływu pracy dostawca trwałości tworzy blokady w tym wystąpieniu.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-137">When loading a workflow instance the persistence provider creates a lock on that instance.</span></span> <span data-ttu-id="8c6f1-138">Uniemożliwia to wystąpienie ładowany przez więcej niż jednego hosta w scenariuszu z wieloma węzłami.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-138">This prevents the instance from being loaded by more than one host in a multi-node scenario.</span></span> <span data-ttu-id="8c6f1-139">Jeśli próba załadowania wystąpienia przepływu pracy, który został zablokowany w sposób zobaczysz wyjątek podobnie do następującej: wyjątek "System.ServiceModel.Persistence.InstanceLockException: nie można ukończyć żądanej operacji, ponieważ blokady dla wystąpienia" 00000000-0000-0000-0000-000000000000 "nie można uzyskać".</span><span class="sxs-lookup"><span data-stu-id="8c6f1-139">If you attempt to load a workflow instance that has been locked you will see an exception like the following: The exception " System.ServiceModel.Persistence.InstanceLockException: The requested operation could not complete because the lock for instance '00000000-0000-0000-0000-000000000000' could not be acquired".</span></span> <span data-ttu-id="8c6f1-140">Ten błąd występuje, gdy wystąpi jedno z następujących czynności:</span><span class="sxs-lookup"><span data-stu-id="8c6f1-140">This error is caused when one of the following occurs:</span></span>  
  
-   <span data-ttu-id="8c6f1-141">W scenariuszu z wieloma węzłami wystąpienie jest załadowany przez innego hosta.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-141">In a multi-node scenario the instance is loaded by another host.</span></span>  <span data-ttu-id="8c6f1-142">Istnieje kilka różnych sposobów, aby rozwiązać konfliktów tego typu: przekazywania przetwarzania do węzła, który jest właścicielem blokady i spróbuj ponownie lub wymusić obciążenia, co spowoduje innych hostów można będzie zapisanie pracy.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-142">There are a few different ways to resolve these types of conflicts: forward the processing to the node which owns the lock and retry, or force the load which will cause the other host to be unable to save their work.</span></span>  
  
-   <span data-ttu-id="8c6f1-143">W scenariuszu jednym węzłem i host awaria.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-143">In a single-node scenario and the host crashed.</span></span>  <span data-ttu-id="8c6f1-144">Po uruchomieniu hosta ponownie (odtworzenia procesu lub tworzenia nowych fabryki dostawców trwałości) nowy host próbuje załadować do wystąpienia, które nadal jest zablokowany przez stary host, ponieważ blokada nie jeszcze wygasł.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-144">When the host starts up again (a process recycle or creating a new persistence provider factory) the new host attempts to load an instance which is still locked by the old host because the lock hasn't expired yet.</span></span>  
  
-   <span data-ttu-id="8c6f1-145">W scenariuszu jednym węzłem i wystąpieniem zagrożona zostało przerwane w pewnym momencie i jest tworzony nowe wystąpienie dostawcy trwałości, który ma identyfikator inny host.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-145">In a single-node scenario and the instance in question was aborted at some point and a new persistence provider instance is created which has a different host ID.</span></span>  
  
 <span data-ttu-id="8c6f1-146">Wartość limitu czasu blokady ma wartość domyślna wynosi 5 minut, można określić wartość innego limitu czasu podczas wywoływania metody <xref:System.ServiceModel.Persistence.PersistenceProvider.Load%2A>.</span><span class="sxs-lookup"><span data-stu-id="8c6f1-146">The lock timeout value has a default value of 5 minutes, you can specify a different timeout value when calling <xref:System.ServiceModel.Persistence.PersistenceProvider.Load%2A>.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="8c6f1-147">W tej sekcji</span><span class="sxs-lookup"><span data-stu-id="8c6f1-147">In This Section</span></span>  
  
-   [<span data-ttu-id="8c6f1-148">Porady: tworzenie uczestnika trwałości niestandardowych</span><span class="sxs-lookup"><span data-stu-id="8c6f1-148">How to: Create a Custom Persistence Participant</span></span>](../../../docs/framework/windows-workflow-foundation/how-to-create-a-custom-persistence-participant.md)  
  
## <a name="see-also"></a><span data-ttu-id="8c6f1-149">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="8c6f1-149">See Also</span></span>  
 [<span data-ttu-id="8c6f1-150">Rozszerzalność magazynu</span><span class="sxs-lookup"><span data-stu-id="8c6f1-150">Store Extensibility</span></span>](../../../docs/framework/windows-workflow-foundation/store-extensibility.md)
