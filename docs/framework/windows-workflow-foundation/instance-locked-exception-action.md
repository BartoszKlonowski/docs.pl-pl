---
title: Działanie zablokowanego wyjątku wystąpienia
ms.date: 03/30/2017
ms.assetid: 164a5419-315c-4987-ad72-54cbdb88d402
ms.openlocfilehash: 0cb39c51436271999c66c30210e0da79adc92e72
ms.sourcegitcommit: 558d78d2a68acd4c95ef23231c8b4e4c7bac3902
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/09/2019
ms.locfileid: "59326154"
---
# <a name="instance-locked-exception-action"></a><span data-ttu-id="5a29c-102">Działanie zablokowanego wyjątku wystąpienia</span><span class="sxs-lookup"><span data-stu-id="5a29c-102">Instance Locked Exception Action</span></span>
<span data-ttu-id="5a29c-103"><xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A> Właściwość Store wystąpienia przepływu pracy SQL pozwala określić, jaka akcja dostawcy stanów trwałych programu SQL powinna wykonać, gdy odbierze <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span><span class="sxs-lookup"><span data-stu-id="5a29c-103">The <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A> property of the SQL Workflow Instance Store lets you specify what action the SQL persistence provider should take when it receives an <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span></span> <span data-ttu-id="5a29c-104">Dostawcy stanów trwałych odbiera tego wyjątku, gdy próbuje zablokować wystąpienie usługi przepływu pracy, który jest zablokowany przez inny host usługi.</span><span class="sxs-lookup"><span data-stu-id="5a29c-104">The persistence provider receives this exception when it tries to lock a workflow service instance that is currently locked by another service host.</span></span> <span data-ttu-id="5a29c-105">Wartości dla tej właściwości to <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>, <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry>, i <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>.</span><span class="sxs-lookup"><span data-stu-id="5a29c-105">The values for this property are <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>, <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry>, and <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>.</span></span> <span data-ttu-id="5a29c-106">Wartość domyślna to <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span><span class="sxs-lookup"><span data-stu-id="5a29c-106">The default value is <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span></span> <span data-ttu-id="5a29c-107">Na poniższej liście opisano trzy opcje:</span><span class="sxs-lookup"><span data-stu-id="5a29c-107">The following list describes the three options:</span></span>  
  
-   <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry><span data-ttu-id="5a29c-108">.</span><span class="sxs-lookup"><span data-stu-id="5a29c-108">.</span></span> <span data-ttu-id="5a29c-109">Host usługi nie próbuje zablokować wystąpienie usługi przepływu pracy i przekazuje <xref:System.Runtime.DurableInstancing.InstanceLockedException> do obiektu wywołującego.</span><span class="sxs-lookup"><span data-stu-id="5a29c-109">The service host does not attempt to lock the workflow service instance and passes the <xref:System.Runtime.DurableInstancing.InstanceLockedException> to the caller.</span></span>  <span data-ttu-id="5a29c-110">Jeśli przepływ pracy pozostaje w pamięci przez okres dłuższy niż 60 sekund, użyj <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry> jako ponownych prób.</span><span class="sxs-lookup"><span data-stu-id="5a29c-110">If your workflow stays in memory for a period exceeding 60 seconds, use <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry> as the retry.</span></span> <span data-ttu-id="5a29c-111">Wartość domyślna to <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span><span class="sxs-lookup"><span data-stu-id="5a29c-111">The default value is <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span></span>  
  
-   <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry><span data-ttu-id="5a29c-112">.</span><span class="sxs-lookup"><span data-stu-id="5a29c-112">.</span></span> <span data-ttu-id="5a29c-113">Host usługi reattempts do blokowania wystąpienie usługi przepływu pracy przy użyciu liniowego interwał między ponownymi próbami i przekazuje <xref:System.Runtime.DurableInstancing.InstanceLockedException> do obiektu wywołującego na końcu sekwencji.</span><span class="sxs-lookup"><span data-stu-id="5a29c-113">The service host reattempts to lock the workflow service instance with a linear interval between retry attempts and passes the <xref:System.Runtime.DurableInstancing.InstanceLockedException> to the caller at the end of the sequence.</span></span> <span data-ttu-id="5a29c-114">Jeśli przepływ pracy zostanie pozostaje w pamięci w przybliżeniu od 5 do 60 sekund, a nadejścia w partiach, gdzie jest bardziej prawdopodobne, aby komunikaty są wysyłane do tego samego wystąpienia na tym samym hoście można przetworzyć wszystkie komunikaty przed zwolnieniem przepływu pracy, użyj <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> do osiągnięcia najlepszych opóźnienie bez marnowania zasobów.</span><span class="sxs-lookup"><span data-stu-id="5a29c-114">If you workflow stays in memory approximately between 5-60 seconds, and messages arrive in batches where it is more likely for messages being sent to the same instance on the same host to process all messages before unloading the workflow, use <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> to achieve the best latency without wasting resources.</span></span>  
  
-   <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry><span data-ttu-id="5a29c-115">.</span><span class="sxs-lookup"><span data-stu-id="5a29c-115">.</span></span> <span data-ttu-id="5a29c-116">Host usługi reattempts do blokowania wystąpienie usługi przepływu pracy z interwałem wykładniczego wycofywania między ponownymi próbami i przekazuje wyjątek do obiektu wywołującego na końcu sekwencji.</span><span class="sxs-lookup"><span data-stu-id="5a29c-116">The service host reattempts to lock the workflow service instance with an exponential backoff interval between retry attempts, and passes the exception to the caller at the end of the sequence.</span></span> <span data-ttu-id="5a29c-117">Jeśli przepływ pracy pozostaje w pamięci dla bardzo krótkim czasie (mniej niż 5 sekund) lub sieci Web farmy jest duży i nie jest bardzo duże ryzyko kolejną wiadomość dostarczona do tego samego hosta, należy użyć <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry> do osiągnięcia najlepszych opóźnienia.</span><span class="sxs-lookup"><span data-stu-id="5a29c-117">If your workflow stays in memory for a very short time (less than 5 seconds), or a Web farm is large and the chance of another message being delivered to the same host is not very high, use <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry> to achieve the best latency.</span></span>  
  
 <span data-ttu-id="5a29c-118">Funkcja akcji wyjątek zablokowane wystąpienie obsługuje następujące scenariusze.</span><span class="sxs-lookup"><span data-stu-id="5a29c-118">The Instance Locked Exception Action feature supports the following scenarios.</span></span> <span data-ttu-id="5a29c-119">We wszystkich scenariuszach, jeśli ustawiono właściwość instanceLockedExceptionAction SqlWorkflowInstanceStore <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> lub <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>, sposób niewidoczny dla użytkownika można uzyskać blokady na wystąpieniach okresowo ponawia próbę hosta.</span><span class="sxs-lookup"><span data-stu-id="5a29c-119">In all scenarios, if the instanceLockedExceptionAction property of the SqlWorkflowInstanceStore is set to <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> or <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>, the host transparently retries to acquire the lock on instances periodically.</span></span>  
  
1. **<span data-ttu-id="5a29c-120">Włączanie bezpiecznego zamknięcia i nachodzące odtwarzania domen aplikacji.</span><span class="sxs-lookup"><span data-stu-id="5a29c-120">Enabling graceful shutdown and overlapped recycling of application domains.</span></span>** <span data-ttu-id="5a29c-121">Załóżmy, że **AppDomain** z hostem usługi uruchamiania wystąpień usługi przepływu pracy jest w trakcie odtwarzania i nowej **AppDomain** zostaną podwyższone do obsługi nowych żądań równolegle równocześnie z  **Obiekt AppDomain** jest obniżona bezpiecznie.</span><span class="sxs-lookup"><span data-stu-id="5a29c-121">Suppose an **AppDomain** with a service host running workflow service instances is being recycled and a new **AppDomain** is brought up to handle new requests in parallel while the old **AppDomain** is brought down gracefully.</span></span> <span data-ttu-id="5a29c-122">Zamknięcie czeka, aż wystąpień usługi przepływu pracy jest bezczynny, a następnie będzie się powtarzać i zwalnia wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="5a29c-122">The shutdown waits until workflow service instances are idle, and then persists and unloads the instances.</span></span> <span data-ttu-id="5a29c-123">Wszystkie próby ustalenia przez hosty w nowym **AppDomain** do blokowania wystąpienie spowoduje, że <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span><span class="sxs-lookup"><span data-stu-id="5a29c-123">Any attempts by hosts in the new **AppDomain** to lock an instance will cause an <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span></span>  
  
2. **<span data-ttu-id="5a29c-124">Skalowanych w poziomie na trwałe przepływy pracy jednorodnych farmie serwerów.</span><span class="sxs-lookup"><span data-stu-id="5a29c-124">Horizontally scaling durable workflows across a homogeneous farm of servers.</span></span>** <span data-ttu-id="5a29c-125">Załóżmy, że węzeł farmy serwerów, na którym działa wystąpienie przepływu pracy awarie i hosta przepływu pracy nie można usunąć blokady w wystąpieniu, w którym jest uruchomiona.</span><span class="sxs-lookup"><span data-stu-id="5a29c-125">Suppose a node of a server farm on which a workflow instance is running crashes and the workflow host cannot remove locks on the instance it is running.</span></span> <span data-ttu-id="5a29c-126">Gdy hosta usługi uruchomionych w innym węźle farmy odbiera wiadomości dla tego wystąpienia przepływu pracy, próby uzyskania blokady w tych wystąpieniach, będzie ona otrzymywać <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span><span class="sxs-lookup"><span data-stu-id="5a29c-126">When a service host running on another node of the farm receives a message for that workflow instance, it tries to acquire locks on these instances it will receive the <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span></span> <span data-ttu-id="5a29c-127">Blokady wygaśnie po pewnym czasie, ponieważ hosta, który miał odnowić blokady już nie istnieje.</span><span class="sxs-lookup"><span data-stu-id="5a29c-127">The locks will expire after some time because the host that was supposed to renew the lock no longer exists.</span></span>  
  
     **<span data-ttu-id="5a29c-128">Skalowanych w poziomie na trwałe przepływy pracy jednorodnych farmie serwerów.</span><span class="sxs-lookup"><span data-stu-id="5a29c-128">Horizontally scaling durable workflows across a homogeneous farm of servers.</span></span>**  <span data-ttu-id="5a29c-129">Załóżmy, że chcesz skalować w poziomie trwałość przepływu pracy przy użyciu wielu hostach za modułem równoważenia obciążenia Sieciowego (moduł równoważenia obciążenia sieciowego), hosta przepływu pracy, uruchomiony w jednym z węzłów farmy ładuje wystąpienie przepływu pracy i przetwarza komunikat i następny komunikat do wystąpienia jest kierowany do host, który jest uruchomiony w innym węźle, ponieważ Równoważenie obciążenia Sieciowego nie ma algorytm routingu w celu dostarczenia komunikatu do hosta, który jest już uruchomione wystąpienie.</span><span class="sxs-lookup"><span data-stu-id="5a29c-129">Suppose you want to horizontally scale a durable workflow using multiple hosts behind a NLB (Network Load Balancer), the workflow host running on one node of the farm loads a workflow instance and is processing a message, and the next message to the instance is routed to the host that is running on another node because the NLB does not have routing algorithm to deliver messages to the host that is already running the instance.</span></span> <span data-ttu-id="5a29c-130">Po odebraniu wiadomości, drugi host próbuje załadować wystąpienia przepływu pracy i odbiera <xref:System.Runtime.DurableInstancing.InstanceLockedException> ponieważ pierwszym hoście ma blokady w wystąpieniu.</span><span class="sxs-lookup"><span data-stu-id="5a29c-130">Upon receiving the message, the second host attempts to load the workflow instance and receives the <xref:System.Runtime.DurableInstancing.InstanceLockedException> because the first host has a lock on the instance.</span></span> <span data-ttu-id="5a29c-131">Pierwszym hoście odblokowuje wystąpienie, po zakończeniu przy użyciu przetwarzania pierwszy komunikat i drugim hoście uzyskuje blokadę podczas ponownych prób przy następnym, ładuje wystąpienie i przetwarza drugi komunikat.</span><span class="sxs-lookup"><span data-stu-id="5a29c-131">The first host unlocks the instance when it is finished with processing the first message and the second host acquires the lock when it retries the next time, loads the instance, and processes the second message.</span></span>
