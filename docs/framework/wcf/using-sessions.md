---
title: Korzystanie z sesji
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- sessions [WCF]
ms.assetid: 864ba12f-3331-4359-a359-6d6d387f1035
ms.openlocfilehash: 42159b3871d974e53751468b422cbe9f72b6f908
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/26/2020
ms.locfileid: "96273688"
---
# <a name="using-sessions"></a><span data-ttu-id="b3944-102">Korzystanie z sesji</span><span class="sxs-lookup"><span data-stu-id="b3944-102">Using Sessions</span></span>

<span data-ttu-id="b3944-103">W aplikacjach Windows Communication Foundation (WCF) *sesja* korelacji grupy komunikatów w konwersacji.</span><span class="sxs-lookup"><span data-stu-id="b3944-103">In Windows Communication Foundation (WCF) applications, a *session* correlates a group of messages into a conversation.</span></span> <span data-ttu-id="b3944-104">Sesje WCF są inne niż w przypadku obiektów sesji dostępnych w aplikacjach ASP.NET, obsługują różne zachowania i są kontrolowane na różne sposoby.</span><span class="sxs-lookup"><span data-stu-id="b3944-104">WCF sessions are different than the session object available in ASP.NET applications, support different behaviors, and are controlled in different ways.</span></span> <span data-ttu-id="b3944-105">W tym temacie opisano funkcje, które są włączane przez sesje w aplikacjach WCF i jak z nich korzystać.</span><span class="sxs-lookup"><span data-stu-id="b3944-105">This topic describes the features that sessions enable in WCF applications and how to use them.</span></span>  
  
## <a name="sessions-in-windows-communication-foundation-applications"></a><span data-ttu-id="b3944-106">Sesje w Windows Communication Foundation aplikacji</span><span class="sxs-lookup"><span data-stu-id="b3944-106">Sessions in Windows Communication Foundation Applications</span></span>  

 <span data-ttu-id="b3944-107">Gdy kontrakt usługi określa, że wymaga sesji, ten kontrakt Określa, że wszystkie wywołania (czyli podstawowe wymiany komunikatów, które obsługują wywołania) muszą być częścią tej samej konwersacji.</span><span class="sxs-lookup"><span data-stu-id="b3944-107">When a service contract specifies that it requires a session, that contract is specifying that all calls (that is, the underlying message exchanges that support the calls) must be part of the same conversation.</span></span> <span data-ttu-id="b3944-108">Jeśli kontrakt Określa, że zezwala na sesje, ale go nie wymaga, klienci mogą nawiązywać połączenia i ustanawiać sesję lub nie ustanawiają sesji.</span><span class="sxs-lookup"><span data-stu-id="b3944-108">If a contract specifies that it allows sessions but does not require one, clients can connect and either establish a session or not establish a session.</span></span> <span data-ttu-id="b3944-109">Jeśli sesja zostanie zakończona i zostanie wysłany komunikat za pośrednictwem tego samego kanału, zgłaszany jest wyjątek.</span><span class="sxs-lookup"><span data-stu-id="b3944-109">If the session ends and a message is sent through the same channel an exception is thrown.</span></span>  
  
 <span data-ttu-id="b3944-110">Sesje WCF mają następujące główne funkcje koncepcyjne:</span><span class="sxs-lookup"><span data-stu-id="b3944-110">WCF sessions have the following main conceptual features:</span></span>  
  
- <span data-ttu-id="b3944-111">Są one jawnie inicjowane i kończone przez aplikację wywołującą (klienta WCF).</span><span class="sxs-lookup"><span data-stu-id="b3944-111">They are explicitly initiated and terminated by the calling application (the WCF client).</span></span>  
  
- <span data-ttu-id="b3944-112">Komunikaty dostarczane podczas sesji są przetwarzane w kolejności, w jakiej zostały odebrane.</span><span class="sxs-lookup"><span data-stu-id="b3944-112">Messages delivered during a session are processed in the order in which they are received.</span></span>  
  
- <span data-ttu-id="b3944-113">Sesje są skorelowane z grupą komunikatów w konwersacji.</span><span class="sxs-lookup"><span data-stu-id="b3944-113">Sessions correlate a group of messages into a conversation.</span></span> <span data-ttu-id="b3944-114">Możliwe są różne typy korelacji.</span><span class="sxs-lookup"><span data-stu-id="b3944-114">Different types of correlation are possible.</span></span> <span data-ttu-id="b3944-115">Na przykład jeden kanał oparty na sesji może skorelować komunikaty na podstawie udostępnionego połączenia sieciowego, podczas gdy inny kanał oparty na sesji może skorelować komunikaty na podstawie tagu udostępnionego w treści komunikatu.</span><span class="sxs-lookup"><span data-stu-id="b3944-115">For instance, one session-based channel may correlate messages based on a shared network connection while another session-based channel may correlate messages based on a shared tag in the message body.</span></span> <span data-ttu-id="b3944-116">Funkcje, które mogą pochodzić z sesji, zależą od charakteru korelacji.</span><span class="sxs-lookup"><span data-stu-id="b3944-116">The features that can be derived from the session depend on the nature of the correlation.</span></span>  
  
- <span data-ttu-id="b3944-117">Brak ogólnego magazynu danych skojarzonego z sesją WCF.</span><span class="sxs-lookup"><span data-stu-id="b3944-117">There is no general data store associated with a WCF session.</span></span>  
  
 <span data-ttu-id="b3944-118">W przypadku znajomości <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> klasy w aplikacjach ASP.NET i udostępnianej przez nią funkcji, można zauważyć następujące różnice między tym rodzajem sesji a sesjami programu WCF:</span><span class="sxs-lookup"><span data-stu-id="b3944-118">If you are familiar with the <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> class in ASP.NET applications and the functionality it provides, you might notice the following differences between that kind of session and WCF sessions:</span></span>  
  
- <span data-ttu-id="b3944-119">Sesje ASP.NET są zawsze inicjowane przez serwer.</span><span class="sxs-lookup"><span data-stu-id="b3944-119">ASP.NET sessions are always server-initiated.</span></span>  
  
- <span data-ttu-id="b3944-120">Sesje ASP.NET są niejawnie nieuporządkowane.</span><span class="sxs-lookup"><span data-stu-id="b3944-120">ASP.NET sessions are implicitly unordered.</span></span>  
  
- <span data-ttu-id="b3944-121">Sesje ASP.NET zapewniają ogólny mechanizm magazynowania danych między żądaniami.</span><span class="sxs-lookup"><span data-stu-id="b3944-121">ASP.NET sessions provide a general data storage mechanism across requests.</span></span>  
  
 <span data-ttu-id="b3944-122">W tym temacie opisano:</span><span class="sxs-lookup"><span data-stu-id="b3944-122">This topic describes:</span></span>  
  
- <span data-ttu-id="b3944-123">Domyślne zachowanie wykonywania w przypadku korzystania z powiązań opartych na sesji w warstwie modelu usług.</span><span class="sxs-lookup"><span data-stu-id="b3944-123">The default execution behavior when using session-based bindings in the service model layer.</span></span>  
  
- <span data-ttu-id="b3944-124">Typy funkcji, które zapewnia oparty na sesji WCF, powiązania dostarczone przez system.</span><span class="sxs-lookup"><span data-stu-id="b3944-124">The types of features that the WCF session-based, system-provided bindings provide.</span></span>  
  
- <span data-ttu-id="b3944-125">Jak utworzyć kontrakt, który deklaruje wymaganie sesji.</span><span class="sxs-lookup"><span data-stu-id="b3944-125">How to create a contract that declares a session requirement.</span></span>  
  
- <span data-ttu-id="b3944-126">Jak zrozumieć i kontrolować tworzenie i zakończenie sesji oraz relacje między sesją a wystąpieniem usługi.</span><span class="sxs-lookup"><span data-stu-id="b3944-126">How to understand and control the creation and termination of the session and the relationship of the session to the service instance.</span></span>  
  
## <a name="default-execution-behavior-using-sessions"></a><span data-ttu-id="b3944-127">Domyślne zachowanie wykonywania przy użyciu sesji</span><span class="sxs-lookup"><span data-stu-id="b3944-127">Default Execution Behavior Using Sessions</span></span>  

 <span data-ttu-id="b3944-128">Powiązanie, które próbuje zainicjować sesję, nazywa się powiązaniem *opartym na sesji* .</span><span class="sxs-lookup"><span data-stu-id="b3944-128">A binding that attempts to initiate a session is called a *session-based* binding.</span></span> <span data-ttu-id="b3944-129">Kontrakty usługi określają, że wymagają, zezwalają lub odrzucają powiązania oparte na sesji przez ustawienie <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> właściwości w interfejsie lub klasie kontraktu usługi na jedną z <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> wartości wyliczenia.</span><span class="sxs-lookup"><span data-stu-id="b3944-129">Service contracts specify that they require, permit, or refuse session-based bindings by setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property on the service contract interface (or class) to one of the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> enumeration values.</span></span> <span data-ttu-id="b3944-130">Domyślnie wartość tej właściwości to <xref:System.ServiceModel.SessionMode.Allowed> , co oznacza, że jeśli klient używa powiązań opartych na sesji z implementacją usługi WCF, usługa ustanawia i używa udostępnionej sesji.</span><span class="sxs-lookup"><span data-stu-id="b3944-130">By default, the value of this property is <xref:System.ServiceModel.SessionMode.Allowed>, which means that if a client uses a session-based binding with a WCF service implementation, the service establishes and uses the session provided.</span></span>  
  
 <span data-ttu-id="b3944-131">Gdy usługa WCF akceptuje sesję klienta, domyślnie włączone są następujące funkcje:</span><span class="sxs-lookup"><span data-stu-id="b3944-131">When a WCF service accepts a client session, the following features are enabled by default:</span></span>  
  
1. <span data-ttu-id="b3944-132">Wszystkie wywołania między obiektem klienta WCF są obsługiwane przez to samo wystąpienie usługi.</span><span class="sxs-lookup"><span data-stu-id="b3944-132">All calls between a WCF client object are handled by the same service instance.</span></span>  
  
2. <span data-ttu-id="b3944-133">Różne powiązania oparte na sesji zapewniają dodatkowe funkcje.</span><span class="sxs-lookup"><span data-stu-id="b3944-133">Different session-based bindings provide additional features.</span></span>  
  
## <a name="system-provided-session-types"></a><span data-ttu-id="b3944-134">System-Provided typy sesji</span><span class="sxs-lookup"><span data-stu-id="b3944-134">System-Provided Session Types</span></span>  

 <span data-ttu-id="b3944-135">Powiązanie oparte na sesji obsługuje domyślne skojarzenie wystąpienia usługi z określoną sesją.</span><span class="sxs-lookup"><span data-stu-id="b3944-135">A session-based binding supports the default association of a service instance with a particular session.</span></span> <span data-ttu-id="b3944-136">Jednak różne powiązania oparte na sesji obsługują różne funkcje oprócz włączania opisanej wcześniej kontrolki dotyczącej wystąpienia opartego na sesji.</span><span class="sxs-lookup"><span data-stu-id="b3944-136">However, different session-based bindings support different features in addition to enabling the session-based instancing control previously described.</span></span>  
  
 <span data-ttu-id="b3944-137">Funkcja WCF udostępnia następujące typy zachowań aplikacji opartych na sesji:</span><span class="sxs-lookup"><span data-stu-id="b3944-137">WCF provides the following types of session-based application behavior:</span></span>  
  
- <span data-ttu-id="b3944-138"><xref:System.ServiceModel.Channels.SecurityBindingElement?displayProperty=nameWithType>Obsługuje sesje oparte na zabezpieczeniach, w których oba punkty końcowe komunikacji zgadzają się z określoną bezpieczną konwersacją.</span><span class="sxs-lookup"><span data-stu-id="b3944-138">The <xref:System.ServiceModel.Channels.SecurityBindingElement?displayProperty=nameWithType> supports security-based sessions, in which both ends of communication have agreed upon a specific secure conversation.</span></span> <span data-ttu-id="b3944-139">Aby uzyskać więcej informacji, zobacz [Zabezpieczanie usług](securing-services.md).</span><span class="sxs-lookup"><span data-stu-id="b3944-139">For more information, see [Securing Services](securing-services.md).</span></span> <span data-ttu-id="b3944-140">Na przykład <xref:System.ServiceModel.WSHttpBinding?displayProperty=nameWithType> powiązanie, które zawiera obsługę zarówno dla sesji zabezpieczeń, jak i sesji niezawodnych, domyślnie używa tylko bezpiecznej sesji, która szyfruje i cyfrowo podpisuje wiadomości.</span><span class="sxs-lookup"><span data-stu-id="b3944-140">For example, the <xref:System.ServiceModel.WSHttpBinding?displayProperty=nameWithType> binding, which contains support for both security sessions and reliable sessions, by default uses only a secure session that encrypts and digitally signs messages.</span></span>  
  
- <span data-ttu-id="b3944-141"><xref:System.ServiceModel.NetTcpBinding?displayProperty=nameWithType>Powiązanie obsługuje sesje oparte na protokole TCP/IP, aby upewnić się, że wszystkie komunikaty są skorelowane przez połączenie na poziomie gniazda.</span><span class="sxs-lookup"><span data-stu-id="b3944-141">The <xref:System.ServiceModel.NetTcpBinding?displayProperty=nameWithType> binding supports TCP/IP-based sessions to ensure that all messages are correlated by the connection at the socket level.</span></span>  
  
- <span data-ttu-id="b3944-142"><xref:System.ServiceModel.Channels.ReliableSessionBindingElement?displayProperty=nameWithType>Element, który implementuje specyfikację WS-ReliableMessaging, zapewnia obsługę niezawodnych sesji, w których można skonfigurować dostarczanie komunikatów w kolejności i dokładnie jeden raz, dzięki czemu komunikaty są odbierane nawet w przypadku przesyłania komunikatów między wieloma węzłami podczas rozmowy.</span><span class="sxs-lookup"><span data-stu-id="b3944-142">The <xref:System.ServiceModel.Channels.ReliableSessionBindingElement?displayProperty=nameWithType> element, which implements the WS-ReliableMessaging specification, provides support for reliable sessions in which messages can be configured to be delivered in order and exactly once, ensuring messages are received even when messages travel across multiple nodes during the conversation.</span></span> <span data-ttu-id="b3944-143">Aby uzyskać więcej informacji, zobacz [niezawodne sesje](./feature-details/reliable-sessions.md).</span><span class="sxs-lookup"><span data-stu-id="b3944-143">For more information, see [Reliable Sessions](./feature-details/reliable-sessions.md).</span></span>  
  
- <span data-ttu-id="b3944-144"><xref:System.ServiceModel.NetMsmqBinding?displayProperty=nameWithType>Powiązanie zawiera sesje datagramu usługi MSMQ.</span><span class="sxs-lookup"><span data-stu-id="b3944-144">The <xref:System.ServiceModel.NetMsmqBinding?displayProperty=nameWithType> binding provides MSMQ datagram sessions.</span></span> <span data-ttu-id="b3944-145">Aby uzyskać więcej informacji, zobacz [kolejki w programie WCF](./feature-details/queues-in-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="b3944-145">For more information, see [Queues in WCF](./feature-details/queues-in-wcf.md).</span></span>  
  
 <span data-ttu-id="b3944-146">Ustawienie <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> właściwości nie określa typu sesji wymaganej przez umowę.</span><span class="sxs-lookup"><span data-stu-id="b3944-146">Setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> property does not specify the type of session the contract requires, only that it requires one.</span></span>  
  
## <a name="creating-a-contract-that-requires-a-session"></a><span data-ttu-id="b3944-147">Tworzenie kontraktu wymagającego sesji</span><span class="sxs-lookup"><span data-stu-id="b3944-147">Creating a Contract That Requires a Session</span></span>  

 <span data-ttu-id="b3944-148">Utworzenie kontraktu wymagającego podania stanu sesji, że Grupa operacji deklarujących kontrakt usługi musi być wykonywana w ramach tej samej sesji, a komunikaty muszą zostać dostarczone w pożądanej kolejności.</span><span class="sxs-lookup"><span data-stu-id="b3944-148">Creating a contract that requires a session states that the group of operations that the service contract declares must all be executed within the same session and that messages must be delivered in order.</span></span> <span data-ttu-id="b3944-149">Aby zapewnić obsługę sesji wymaganej przez kontrakt usługi, ustaw <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> Właściwość w interfejsie lub klasie kontraktu usługi na wartość <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> wyliczenia, aby określić, czy kontrakt:</span><span class="sxs-lookup"><span data-stu-id="b3944-149">To assert the level of session support that a service contract requires, set the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property on your service contract interface or class to the value of the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> enumeration to specify whether the contract:</span></span>  
  
- <span data-ttu-id="b3944-150">Wymaga sesji.</span><span class="sxs-lookup"><span data-stu-id="b3944-150">Requires a session.</span></span>  
  
- <span data-ttu-id="b3944-151">Zezwala klientowi na ustanawianie sesji.</span><span class="sxs-lookup"><span data-stu-id="b3944-151">Allows a client to establish a session.</span></span>  
  
- <span data-ttu-id="b3944-152">Zabrania sesji.</span><span class="sxs-lookup"><span data-stu-id="b3944-152">Prohibits a session.</span></span>  
  
 <span data-ttu-id="b3944-153">Ustawienie <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> właściwości nie określa jednak typu zachowania, którego wymaga kontrakt.</span><span class="sxs-lookup"><span data-stu-id="b3944-153">Setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> property does not, however, specify the type of session-based behavior the contract requires.</span></span> <span data-ttu-id="b3944-154">Powoduje to, że program WCF sprawdza w czasie wykonywania, że skonfigurowane powiązanie (które tworzy kanał komunikacyjny) dla usługi, nie lub może ustanowić sesję podczas implementowania usługi.</span><span class="sxs-lookup"><span data-stu-id="b3944-154">It instructs WCF to confirm at runtime that the configured binding (which creates the communication channel) for the service does, does not, or can establish a session when implementing a service.</span></span> <span data-ttu-id="b3944-155">Po ponownym rozwiązaniu można spełnić to wymaganie przy użyciu dowolnego typu zachowań opartych na sesji, które wybiera — zabezpieczenia, transport, niezawodne lub kilka kombinacji.</span><span class="sxs-lookup"><span data-stu-id="b3944-155">Again, the binding can satisfy that requirement with any type of session-based behavior it chooses—security, transport, reliable, or some combination.</span></span> <span data-ttu-id="b3944-156">Dokładne zachowanie zależy od <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> wybranej wartości.</span><span class="sxs-lookup"><span data-stu-id="b3944-156">The exact behavior depends on the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> value selected.</span></span> <span data-ttu-id="b3944-157">Jeśli skonfigurowane powiązanie usługi nie jest zgodne z wartością <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> , zostanie zgłoszony wyjątek.</span><span class="sxs-lookup"><span data-stu-id="b3944-157">If the configured binding of the service does not conform to the value of <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A>, an exception is thrown.</span></span> <span data-ttu-id="b3944-158">Powiązania i kanały tworzone przez siebie do sesji obsługi są określane jako oparte na sesji.</span><span class="sxs-lookup"><span data-stu-id="b3944-158">Bindings and the channels they create that support sessions are said to be session-based.</span></span>  
  
 <span data-ttu-id="b3944-159">Następujący kontrakt usługi określa, że wszystkie operacje w ramach programu `ICalculatorSession` muszą być wymieniane w ramach sesji.</span><span class="sxs-lookup"><span data-stu-id="b3944-159">The following service contract specifies that all operations in the `ICalculatorSession` must be exchanged within a session.</span></span> <span data-ttu-id="b3944-160">Żadna z operacji nie zwraca wartości do obiektu wywołującego, z wyjątkiem `Equals` metody.</span><span class="sxs-lookup"><span data-stu-id="b3944-160">None of the operations returns a value to the caller except the `Equals` method.</span></span> <span data-ttu-id="b3944-161">Jednak `Equals` Metoda nie przyjmuje żadnych parametrów i dlatego może zwracać wartość różną od zera w sesji, w której dane zostały już przesłane do innych operacji.</span><span class="sxs-lookup"><span data-stu-id="b3944-161">However, the `Equals` method takes no parameters and, therefore, can only return a non-zero value inside a session in which data has already been passed to the other operations.</span></span> <span data-ttu-id="b3944-162">Ten kontrakt wymaga poprawnego działania sesji.</span><span class="sxs-lookup"><span data-stu-id="b3944-162">This contract requires a session to function properly.</span></span> <span data-ttu-id="b3944-163">Bez sesji skojarzonej z określonym klientem wystąpienie usługi nie ma wpływu na to, jakie poprzednie dane wysłał ten klient.</span><span class="sxs-lookup"><span data-stu-id="b3944-163">Without a session associated with a specific client, the service instance has no way of knowing what previous data this client has sent.</span></span>  
  
 [!code-csharp[S_Service_Session#1](../../../samples/snippets/csharp/VS_Snippets_CFX/s_service_session/cs/service.cs#1)]
 [!code-vb[S_Service_Session#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_service_session/vb/service.vb#1)]  
  
 <span data-ttu-id="b3944-164">Jeśli usługa zezwala na sesję, sesja zostanie nawiązana i użyta, jeśli klient ją zainicjuje. w przeciwnym razie nie zostanie ustanowiona żadna sesja.</span><span class="sxs-lookup"><span data-stu-id="b3944-164">If a service allows a session, then a session is established and used if the client initiates one; otherwise, no session is established.</span></span>  
  
## <a name="sessions-and-service-instances"></a><span data-ttu-id="b3944-165">Sesje i wystąpienia usługi</span><span class="sxs-lookup"><span data-stu-id="b3944-165">Sessions and Service Instances</span></span>  

 <span data-ttu-id="b3944-166">W przypadku korzystania z domyślnego zachowania podczas wystąpienia programu WCF wszystkie wywołania między obiektem klienta WCF są obsługiwane przez to samo wystąpienie usługi.</span><span class="sxs-lookup"><span data-stu-id="b3944-166">If you use the default instancing behavior in WCF, all calls between a WCF client object are handled by the same service instance.</span></span> <span data-ttu-id="b3944-167">W związku z tym na poziomie aplikacji można myśleć o sesji, co umożliwia zachowanie aplikacji podobnej do zachowania połączenia lokalnego.</span><span class="sxs-lookup"><span data-stu-id="b3944-167">Therefore, at the application level, you can think of a session as enabling application behavior similar to local call behavior.</span></span> <span data-ttu-id="b3944-168">Na przykład podczas tworzenia obiektu lokalnego:</span><span class="sxs-lookup"><span data-stu-id="b3944-168">For example, when you create a local object:</span></span>  
  
- <span data-ttu-id="b3944-169">Konstruktor jest wywoływany.</span><span class="sxs-lookup"><span data-stu-id="b3944-169">A constructor is called.</span></span>  
  
- <span data-ttu-id="b3944-170">Wszystkie kolejne wywołania w odwołaniu do obiektu klienta WCF są przetwarzane przez to samo wystąpienie obiektu.</span><span class="sxs-lookup"><span data-stu-id="b3944-170">All subsequent calls made to the WCF client object reference are processed by the same object instance.</span></span>  
  
- <span data-ttu-id="b3944-171">Destruktor jest wywoływany, gdy odwołanie do obiektu jest niszczone.</span><span class="sxs-lookup"><span data-stu-id="b3944-171">A destructor is called when the object reference is destroyed.</span></span>  
  
 <span data-ttu-id="b3944-172">Sesje umożliwiają podobne zachowanie między klientami i usługami, o ile jest używane domyślne zachowanie wystąpienia usługi.</span><span class="sxs-lookup"><span data-stu-id="b3944-172">Sessions enable a similar behavior between clients and services as long as the default service instance behavior is used.</span></span> <span data-ttu-id="b3944-173">Jeśli kontrakt usługi wymaga lub obsługuje sesje, co najmniej jedna operacja kontraktu może być oznaczona jako inicjująca lub kończąca sesję przez ustawienie <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A> właściwości i <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A> .</span><span class="sxs-lookup"><span data-stu-id="b3944-173">If a service contract requires or supports sessions, one or more contract operations can be marked as initiating or terminating a session by setting the <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A> and <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A> properties.</span></span>  
  
 <span data-ttu-id="b3944-174">*Operacje inicjujące* to te, które muszą być wywoływane jako pierwsza operacja nowej sesji.</span><span class="sxs-lookup"><span data-stu-id="b3944-174">*Initiating operations* are those that must be called as the first operation of a new session.</span></span> <span data-ttu-id="b3944-175">Operacje nieinicjujące mogą być wywoływane tylko po wywołaniu co najmniej jednej operacji inicjującej.</span><span class="sxs-lookup"><span data-stu-id="b3944-175">Non-initiating operations can be called only after at least one initiating operation has been called.</span></span> <span data-ttu-id="b3944-176">W związku z tym można utworzyć rodzaj konstruktora sesji dla swojej usługi, deklarując operacje inicjowania, które umożliwiają przejęcie danych z klientów odpowiednich do początku wystąpienia usługi.</span><span class="sxs-lookup"><span data-stu-id="b3944-176">You can therefore create a kind of session constructor for your service by declaring initiating operations designed to take input from clients appropriate to the beginning of the service instance.</span></span> <span data-ttu-id="b3944-177">(Stan jest skojarzony z sesją, ale nie z obiektem usługi).</span><span class="sxs-lookup"><span data-stu-id="b3944-177">(The state is associated with the session, however, and not the service object.)</span></span>  
  
 <span data-ttu-id="b3944-178">*Przerywanie operacji*, jest to te, które muszą być wywoływane jako ostatni komunikat w istniejącej sesji.</span><span class="sxs-lookup"><span data-stu-id="b3944-178">*Terminating operations*, conversely, are those that must be called as the last message in an existing session.</span></span> <span data-ttu-id="b3944-179">W przypadku domyślnego przypadku usługa WCF odtwarza obiekt usługi i jego kontekst po zamknięciu sesji, z którą usługa została skojarzona.</span><span class="sxs-lookup"><span data-stu-id="b3944-179">In the default case, WCF recycles the service object and its context after the session with which the service was associated is closed.</span></span> <span data-ttu-id="b3944-180">W związku z tym można utworzyć Rodzaj destruktora, deklarując operacje kończące, które umożliwiają wykonanie funkcji odpowiedniej dla końca wystąpienia usługi.</span><span class="sxs-lookup"><span data-stu-id="b3944-180">You can, therefore, create a kind of destructor by declaring terminating operations designed to perform a function appropriate to the end of the service instance.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="b3944-181">Chociaż domyślne zachowanie nosi podobieństwo do lokalnych konstruktorów i destruktorów, jest to tylko podobieństwo.</span><span class="sxs-lookup"><span data-stu-id="b3944-181">Although the default behavior bears a resemblance to local constructors and destructors, it is only a resemblance.</span></span> <span data-ttu-id="b3944-182">Każda operacja usługi WCF może być operacją inicjującą lub kończącą lub jednocześnie.</span><span class="sxs-lookup"><span data-stu-id="b3944-182">Any WCF service operation can be an initiating or terminating operation, or both at the same time.</span></span> <span data-ttu-id="b3944-183">Ponadto w przypadku domyślnego przypadku operacje inicjujące mogą być wywoływane dowolną liczbę razy w dowolnej kolejności; Po ustanowieniu sesji i skojarzeniu jej z wystąpieniem nie są tworzone żadne dodatkowe sesje, chyba że jawnie kontrolujesz okres istnienia wystąpienia usługi (przez manipulowanie <xref:System.ServiceModel.InstanceContext?displayProperty=nameWithType> obiektem).</span><span class="sxs-lookup"><span data-stu-id="b3944-183">In addition, in the default case, initiating operations can be called any number of times in any order; no additional sessions are created once the session is established and associated with an instance unless you explicitly control the lifetime of the service instance (by manipulating the <xref:System.ServiceModel.InstanceContext?displayProperty=nameWithType> object).</span></span> <span data-ttu-id="b3944-184">Na koniec stan jest skojarzony z sesją, a nie z obiektem usługi.</span><span class="sxs-lookup"><span data-stu-id="b3944-184">Finally, the state is associated with the session and not the service object.</span></span>  
  
 <span data-ttu-id="b3944-185">Na przykład `ICalculatorSession` kontrakt użyty w poprzednim przykładzie wymaga, aby obiekt klienta WCF najpierw wywoływał `Clear` operację przed żadną inną operacją i że sesja z tym obiektem klienta WCF powinna zakończyć się po wywołaniu `Equals` operacji.</span><span class="sxs-lookup"><span data-stu-id="b3944-185">For example, the `ICalculatorSession` contract used in the preceding example requires that the WCF client object first call the `Clear` operation prior to any other operation and that the session with this WCF client object should terminate when it calls the `Equals` operation.</span></span> <span data-ttu-id="b3944-186">Poniższy przykład kodu przedstawia kontrakt, który wymusza te wymagania.</span><span class="sxs-lookup"><span data-stu-id="b3944-186">The following code example shows a contract that enforces these requirements.</span></span> <span data-ttu-id="b3944-187">`Clear` musi być wywoływana jako pierwsza, aby zainicjować sesję, a sesja zostanie zakończona, gdy `Equals` jest wywoływana.</span><span class="sxs-lookup"><span data-stu-id="b3944-187">`Clear` must be called first to initiate a session, and that session ends when `Equals` is called.</span></span>  
  
 [!code-csharp[SCA.IsInitiatingIsTerminating#1](../../../samples/snippets/csharp/VS_Snippets_CFX/sca.isinitiatingisterminating/cs/service.cs#1)]
 [!code-vb[SCA.IsInitiatingIsTerminating#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/sca.isinitiatingisterminating/vb/service.vb#1)]  
  
 <span data-ttu-id="b3944-188">Usługi nie uruchamiają sesji z klientami programu.</span><span class="sxs-lookup"><span data-stu-id="b3944-188">Services do not start sessions with clients.</span></span> <span data-ttu-id="b3944-189">W aplikacjach klienckich WCF istnieje relacja bezpośrednia między okresem istnienia kanału opartego na sesji i okresem istnienia sesji.</span><span class="sxs-lookup"><span data-stu-id="b3944-189">In WCF client applications, a direct relationship exists between the lifetime of the session-based channel and the lifetime of the session itself.</span></span> <span data-ttu-id="b3944-190">W związku z tym klienci tworzą nowe sesje przez utworzenie nowych kanałów opartych na sesji i rozbicie istniejących sesji przez zamknięcie kanałów opartych na sesji.</span><span class="sxs-lookup"><span data-stu-id="b3944-190">As such, clients create new sessions by creating new session-based channels and tear down existing sessions by closing session-based channels gracefully.</span></span> <span data-ttu-id="b3944-191">Klient uruchamia sesję z punktem końcowym usługi, wywołując jedną z następujących czynności:</span><span class="sxs-lookup"><span data-stu-id="b3944-191">A client starts a session with a service endpoint by calling one of the following:</span></span>  
  
- <span data-ttu-id="b3944-192"><xref:System.ServiceModel.ICommunicationObject.Open%2A?displayProperty=nameWithType> na kanale zwróconym przez wywołanie metody <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="b3944-192"><xref:System.ServiceModel.ICommunicationObject.Open%2A?displayProperty=nameWithType> on the channel returned by a call to <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span></span>  
  
- <span data-ttu-id="b3944-193"><xref:System.ServiceModel.ClientBase%601.Open%2A?displayProperty=nameWithType> w obiekcie klienta WCF wygenerowanym przez [Narzędzie narzędzia metadanych ServiceModel (Svcutil.exe)](servicemodel-metadata-utility-tool-svcutil-exe.md).</span><span class="sxs-lookup"><span data-stu-id="b3944-193"><xref:System.ServiceModel.ClientBase%601.Open%2A?displayProperty=nameWithType> on the WCF client object generated by the [ServiceModel Metadata Utility Tool (Svcutil.exe)](servicemodel-metadata-utility-tool-svcutil-exe.md).</span></span>  
  
- <span data-ttu-id="b3944-194">Operacja inicjująca dla każdego typu obiektu klienta WCF (domyślnie wszystkie operacje są inicjowane).</span><span class="sxs-lookup"><span data-stu-id="b3944-194">An initiating operation on either type of WCF client object (by default, all operations are initiating).</span></span> <span data-ttu-id="b3944-195">Po wywołaniu pierwszej operacji obiekt klienta WCF automatycznie otwiera kanał i inicjuje sesję.</span><span class="sxs-lookup"><span data-stu-id="b3944-195">When the first operation is called, the WCF client object automatically opens the channel and initiates a session.</span></span>  
  
 <span data-ttu-id="b3944-196">Zwykle klient zamyka sesję z punktem końcowym usługi, wywołując jedną z następujących czynności:</span><span class="sxs-lookup"><span data-stu-id="b3944-196">Typically a client ends a session with a service endpoint by calling one of the following:</span></span>  
  
- <span data-ttu-id="b3944-197"><xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType> na kanale zwróconym przez wywołanie metody <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="b3944-197"><xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType> on the channel returned by a call to <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span></span>  
  
- <span data-ttu-id="b3944-198"><xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType> w obiekcie klienta WCF wygenerowanym przez Svcutil.exe.</span><span class="sxs-lookup"><span data-stu-id="b3944-198"><xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType> on the WCF client object generated by Svcutil.exe.</span></span>  
  
- <span data-ttu-id="b3944-199">Operacja przerywania dla każdego typu obiektu klienta WCF (domyślnie nie kończy się żadna operacja; kontrakt musi jawnie określić operację kończącą).</span><span class="sxs-lookup"><span data-stu-id="b3944-199">A terminating operation on either type of WCF client object (by default, no operations are terminating; the contract must explicitly specify a terminating operation).</span></span> <span data-ttu-id="b3944-200">Po wywołaniu pierwszej operacji obiekt klienta WCF automatycznie otwiera kanał i inicjuje sesję.</span><span class="sxs-lookup"><span data-stu-id="b3944-200">When the first operation is called, the WCF client object automatically opens the channel and initiates a session.</span></span>  
  
 <span data-ttu-id="b3944-201">Przykłady można znaleźć w temacie [How to: Create a Service, która wymaga sesji](./feature-details/how-to-create-a-service-that-requires-sessions.md) oraz [domyślne zachowanie usługi](./samples/default-service-behavior.md) i przykłady tworzenia [wystąpień](./samples/instancing.md) .</span><span class="sxs-lookup"><span data-stu-id="b3944-201">For examples, see [How to: Create a Service That Requires Sessions](./feature-details/how-to-create-a-service-that-requires-sessions.md) as well as the [Default Service Behavior](./samples/default-service-behavior.md) and [Instancing](./samples/instancing.md) samples.</span></span>  
  
 <span data-ttu-id="b3944-202">Więcej informacji o klientach i sesjach znajduje się w temacie [Uzyskiwanie dostępu do usług za pomocą klienta WCF](./feature-details/accessing-services-using-a-client.md).</span><span class="sxs-lookup"><span data-stu-id="b3944-202">For more information about clients and sessions, see [Accessing Services Using a WCF Client](./feature-details/accessing-services-using-a-client.md).</span></span>  
  
## <a name="sessions-interact-with-instancecontext-settings"></a><span data-ttu-id="b3944-203">Sesje współpracują z ustawieniami InstanceContext</span><span class="sxs-lookup"><span data-stu-id="b3944-203">Sessions Interact with InstanceContext Settings</span></span>  

 <span data-ttu-id="b3944-204">Istnieje interakcja między <xref:System.ServiceModel.SessionMode> wyliczeniem w kontrakcie i <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> właściwością, która kontroluje skojarzenie między kanałami i określonymi obiektami usługi.</span><span class="sxs-lookup"><span data-stu-id="b3944-204">There is an interaction between the <xref:System.ServiceModel.SessionMode> enumeration in a contract and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property, which controls the association between channels and specific service objects.</span></span> <span data-ttu-id="b3944-205">Aby uzyskać więcej informacji, zobacz [sesje, Tworzenie wystąpień i współbieżność](./feature-details/sessions-instancing-and-concurrency.md).</span><span class="sxs-lookup"><span data-stu-id="b3944-205">For more information, see [Sessions, Instancing, and Concurrency](./feature-details/sessions-instancing-and-concurrency.md).</span></span>  
  
### <a name="sharing-instancecontext-objects"></a><span data-ttu-id="b3944-206">Udostępnianie obiektów InstanceContext</span><span class="sxs-lookup"><span data-stu-id="b3944-206">Sharing InstanceContext Objects</span></span>  

 <span data-ttu-id="b3944-207">Można również kontrolować, który kanał lub połączenie oparte na sesji jest skojarzone z tym <xref:System.ServiceModel.InstanceContext> obiektem przez wykonanie tego skojarzenia samodzielnie.</span><span class="sxs-lookup"><span data-stu-id="b3944-207">You can also control which session-based channel or call is associated with which <xref:System.ServiceModel.InstanceContext> object by performing that association yourself.</span></span>
  
## <a name="sessions-and-streaming"></a><span data-ttu-id="b3944-208">Sesje i przesyłanie strumieniowe</span><span class="sxs-lookup"><span data-stu-id="b3944-208">Sessions and Streaming</span></span>  

 <span data-ttu-id="b3944-209">W przypadku transferu dużej ilości danych, tryb transferu przesyłania strumieniowego w programie WCF jest możliwym rozwiązaniem alternatywnym dla domyślnego zachowania buforowania i przetwarzania komunikatów w pamięci.</span><span class="sxs-lookup"><span data-stu-id="b3944-209">When you have a large amount of data to transfer, the streaming transfer mode in WCF is a feasible alternative to the default behavior of buffering and processing messages in memory in their entirety.</span></span> <span data-ttu-id="b3944-210">Podczas przesyłania strumieniowego do wywołań opartych na sesji może wystąpić nieoczekiwane zachowanie.</span><span class="sxs-lookup"><span data-stu-id="b3944-210">You may get unexpected behavior when streaming calls with a session-based binding.</span></span> <span data-ttu-id="b3944-211">Wszystkie wywołania przesyłania strumieniowego są realizowane za pośrednictwem pojedynczego kanału (kanału datagramu), który nie obsługuje sesji, nawet jeśli używane powiązanie jest skonfigurowane do korzystania z sesji.</span><span class="sxs-lookup"><span data-stu-id="b3944-211">All streaming calls are made through a single channel (the datagram channel) that does not support sessions even if the binding being used is configured to use sessions.</span></span> <span data-ttu-id="b3944-212">Jeśli wielu klientów przeprowadzi wywołania przesyłania strumieniowego do tego samego obiektu usługi za pośrednictwem powiązań opartych na sesji, a tryb współbieżności obiektu usługi jest ustawiony na wartość Single, a jego tryb kontekstu wystąpienia jest ustawiony na `PerSession` , wszystkie wywołania muszą przechodzić przez kanał datagramu i dlatego tylko jedno wywołanie jest przetwarzane jednocześnie.</span><span class="sxs-lookup"><span data-stu-id="b3944-212">If multiple clients make streaming calls to the same service object over a session-based binding, and the service object's concurrency mode is set to single and its instance context mode is set to `PerSession`, all calls must go through the datagram channel and so only one call is processed at a time.</span></span> <span data-ttu-id="b3944-213">Co najmniej jeden klient może przekroczyć limit czasu. Ten problem można obejść, konfigurując obiekt usługi `InstanceContextMode` `PerCall` lub współbieżność do wielu.</span><span class="sxs-lookup"><span data-stu-id="b3944-213">One or more clients may then time out. You can work around this issue by either setting the service object's `InstanceContextMode` to `PerCall` or Concurrency to multiple.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="b3944-214">MaxConcurrentSessions nie ma wpływu w tym przypadku, ponieważ jest dostępna tylko jedna "sesja".</span><span class="sxs-lookup"><span data-stu-id="b3944-214">MaxConcurrentSessions have no effect in this case because there is only one "session" available.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b3944-215">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="b3944-215">See also</span></span>

- <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A>
- <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A>
