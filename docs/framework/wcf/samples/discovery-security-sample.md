---
title: "Zabezpieczenia odnajdywania — przykład"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: b8db01f4-b4a1-43fe-8e31-26d4e9304a65
caps.latest.revision: "13"
author: BrucePerlerMS
ms.author: bruceper
manager: mbaldwin
ms.openlocfilehash: 2b21017be0927f0d5189744111437c5afa6dd623
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/18/2017
---
# <a name="discovery-security-sample"></a><span data-ttu-id="f55f3-102">Zabezpieczenia odnajdywania — przykład</span><span class="sxs-lookup"><span data-stu-id="f55f3-102">Discovery Security Sample</span></span>
<span data-ttu-id="f55f3-103">Specyfikacja odnajdywania nie wymaga czy punkty końcowe, które uczestniczą w procesie odnajdywania należy zabezpieczyć.</span><span class="sxs-lookup"><span data-stu-id="f55f3-103">The Discovery specification does not require that endpoints that participate in the discovery process to be secure.</span></span> <span data-ttu-id="f55f3-104">Udoskonalanie komunikaty odnajdywania z zabezpieczeniami zmniejsza różnych rodzajów ataków (komunikatu zmiany, odmowę usługi, powtarzania, fałszowania).</span><span class="sxs-lookup"><span data-stu-id="f55f3-104">Enhancing the discovery messages with security mitigates various types of attacks (message alteration, denial of service, replay, spoofing).</span></span> <span data-ttu-id="f55f3-105">W tym przykładzie implementuje kanałów niestandardowych, które obliczeniowe i weryfikowania podpisów wiadomości w formacie kompaktowym podpisu (opisanej w sekcji 8.2 specyfikacji WS-Discovery).</span><span class="sxs-lookup"><span data-stu-id="f55f3-105">This sample implements custom channels that compute and verify message signatures using the compact signature format (described in Section 8.2 of the WS-Discovery specification).</span></span> <span data-ttu-id="f55f3-106">Przykład obsługuje zarówno [specyfikacji odnajdywania 2005](http://go.microsoft.com/fwlink/?LinkId=177912) i [wersji 1.1](http://go.microsoft.com/fwlink/?LinkId=179677).</span><span class="sxs-lookup"><span data-stu-id="f55f3-106">The sample supports both the [2005 Discovery specification](http://go.microsoft.com/fwlink/?LinkId=177912) and the [1.1 version](http://go.microsoft.com/fwlink/?LinkId=179677).</span></span>  
  
 <span data-ttu-id="f55f3-107">Niestandardowy kanał jest stosowany na szczycie stosu istniejącego kanału dla punktów końcowych odnajdywania i anonsu.</span><span class="sxs-lookup"><span data-stu-id="f55f3-107">The custom channel is applied on top of the existing channel stack for Discovery and Announcement endpoints.</span></span> <span data-ttu-id="f55f3-108">W ten sposób nagłówka podpis jest stosowana dla każdej wiadomości wysyłane.</span><span class="sxs-lookup"><span data-stu-id="f55f3-108">This way, a signature header is applied for every message sent.</span></span> <span data-ttu-id="f55f3-109">Podpis jest weryfikowany na odebrane wiadomości, a jeśli nie są zgodne lub komunikaty nie ma podpisu, komunikaty są usuwane.</span><span class="sxs-lookup"><span data-stu-id="f55f3-109">The signature is verified on received messages and when it does not match or when the messages do not have a signature, the messages are dropped.</span></span> <span data-ttu-id="f55f3-110">Aby zarejestrować i Sprawdź komunikaty, próbki korzysta z certyfikatów.</span><span class="sxs-lookup"><span data-stu-id="f55f3-110">To sign and verify messages, the sample uses certificates.</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="f55f3-111">Omówienie</span><span class="sxs-lookup"><span data-stu-id="f55f3-111">Discussion</span></span>  
 <span data-ttu-id="f55f3-112">Usługi WCF jest bardzo extensible i umożliwia użytkownikom możliwość dostosowywania kanałów zgodnie z potrzebami.</span><span class="sxs-lookup"><span data-stu-id="f55f3-112">WCF is very extensible and allows users the possibility to customize channels as desired.</span></span> <span data-ttu-id="f55f3-113">Przykład implementuje element bezpiecznego powiązania odnajdywania, która tworzy bezpiecznych kanałów.</span><span class="sxs-lookup"><span data-stu-id="f55f3-113">The sample implements a discovery secure binding element that builds secure channels.</span></span> <span data-ttu-id="f55f3-114">Bezpieczne kanały zastosować i weryfikowania podpisów wiadomości i są stosowane na szczycie stosu bieżącej.</span><span class="sxs-lookup"><span data-stu-id="f55f3-114">The secure channels apply and verify message signatures and are applied on top of the current stack.</span></span>  
  
 <span data-ttu-id="f55f3-115">Element powiązania bezpiecznej kompilacje fabryk bezpiecznego kanału i odbiorniki kanałów.</span><span class="sxs-lookup"><span data-stu-id="f55f3-115">The secure binding element builds secure channel factories and channel listeners.</span></span>  
  
## <a name="secure-channel-factory"></a><span data-ttu-id="f55f3-116">Fabryka bezpiecznego kanału</span><span class="sxs-lookup"><span data-stu-id="f55f3-116">Secure Channel Factory</span></span>  
 <span data-ttu-id="f55f3-117">Fabryka bezpiecznego kanału tworzy dane wyjściowe lub kanałach dupleksowych, które Dodawanie podpisu compact do nagłówków komunikatów.</span><span class="sxs-lookup"><span data-stu-id="f55f3-117">The secure channel factory creates output or duplex channels that add a compact signature to message headers.</span></span> <span data-ttu-id="f55f3-118">Aby zachować wiadomości możliwie najmniejsze format compact podpisu jest używana.</span><span class="sxs-lookup"><span data-stu-id="f55f3-118">To keep messages as small as possible the compact signature format is used.</span></span> <span data-ttu-id="f55f3-119">W poniższym przykładzie przedstawiono struktury podpisu compact.</span><span class="sxs-lookup"><span data-stu-id="f55f3-119">The structure of a compact signature is shown in the following example.</span></span>  
  
```xml  
<d:Security ... >   
  [<d:Sig Scheme="xs:anyURI"   
         [KeyId="xs:base64Binary"]?  
          Refs="..."  
         [PrefixList]="xs:NMTOKENS"   
          Sig="xs:base64Binary"   
          ... />]?  
  ...   
</d:Security>  
```  
  
> [!NOTE]
>  <span data-ttu-id="f55f3-120">`PrefixList` Został dodany w protokole 2008 w wersji odnajdywania.</span><span class="sxs-lookup"><span data-stu-id="f55f3-120">The `PrefixList` was added in the 2008 Discovery version protocol.</span></span>  
  
 <span data-ttu-id="f55f3-121">Można obliczyć podpisu, próbki określa elementy rozszerzonej podpisu.</span><span class="sxs-lookup"><span data-stu-id="f55f3-121">To compute the signature, the sample determines the expanded signature items.</span></span> <span data-ttu-id="f55f3-122">Podpis XML (`SignedInfo`) jest tworzony przy użyciu `ds` prefiks przestrzeni nazw, co jest wymagane przez specyfikację WS-Discovery.</span><span class="sxs-lookup"><span data-stu-id="f55f3-122">An XML signature (`SignedInfo`) is created, using the `ds` namespace prefix, as required by the WS-Discovery specification.</span></span> <span data-ttu-id="f55f3-123">Treść i wszystkich nagłówków odnajdywania i przestrzeni nazw adresowania odwołuje się podpisu, więc nie może być naruszona z.</span><span class="sxs-lookup"><span data-stu-id="f55f3-123">The body and all the headers in discovery and addressing namespaces are referenced in the signature, so they cannot be tampered with.</span></span> <span data-ttu-id="f55f3-124">Każdy element do którego istnieje odwołanie jest przekształcana przy użyciu wyłącznego zapewniania kanoniczności (http://www.w3.org/2001/10/xml-exc-c14n#), a następnie wartość skrótu SHA-1 jest obliczana (http://www.w3.org/2000/09/xmldsig#sha1).</span><span class="sxs-lookup"><span data-stu-id="f55f3-124">Each referenced element is transformed using the Exclusive Canonicalization (http://www.w3.org/2001/10/xml-exc-c14n# ), and then an SHA-1 digest value is computed (http://www.w3.org/2000/09/xmldsig#sha1 ).</span></span> <span data-ttu-id="f55f3-125">Na podstawie wszystkich elementów i ich wartości, wartość podpisu jest obliczana, przy użyciu algorytmu RSA (http://www.w3.org/2000/09/xmldsig#rsa-sha1).</span><span class="sxs-lookup"><span data-stu-id="f55f3-125">Based on all referenced elements and their digest values, the signature value is computed using the RSA algorithm (http://www.w3.org/2000/09/xmldsig#rsa-sha1 ).</span></span>  
  
 <span data-ttu-id="f55f3-126">Komunikaty są podpisane za pomocą certyfikatu określonego przez klienta.</span><span class="sxs-lookup"><span data-stu-id="f55f3-126">The messages are signed with a client-specified certificate.</span></span> <span data-ttu-id="f55f3-127">Lokalizacja magazynu, nazwę i nazwa podmiotu certyfikatu należy określić podczas tworzenia elementu powiązania.</span><span class="sxs-lookup"><span data-stu-id="f55f3-127">The store location, name and the certificate subject name must be specified when the binding element is created.</span></span> <span data-ttu-id="f55f3-128">`KeyId` w podpisie compact reprezentuje identyfikator klucza podpisywania tokenu i identyfikator klucza podmiotu (SKI) podpisywania tokenu jest lub (Jeśli nie ma SKI) wartości skrótu SHA-1 podpisywania tokenu klucza publicznego.</span><span class="sxs-lookup"><span data-stu-id="f55f3-128">The `KeyId` in the compact signature represents the key identifier of the signing token and is the Subject Key Identifier (SKI) of the signing token or (if the SKI does not exist) a SHA-1 hash of the public key of the signing token.</span></span>  
  
## <a name="secure-channel-listener"></a><span data-ttu-id="f55f3-129">Bezpieczny kanał odbiornika</span><span class="sxs-lookup"><span data-stu-id="f55f3-129">Secure Channel Listener</span></span>  
 <span data-ttu-id="f55f3-130">Bezpieczny kanał odbiornika tworzy danych wejściowych lub dupleks kanałów, które Sprawdź compact podpis odebranej wiadomości.</span><span class="sxs-lookup"><span data-stu-id="f55f3-130">The secure channel listener creates input or duplex channels that verify the compact signature in received messages.</span></span> <span data-ttu-id="f55f3-131">Można zweryfikować podpisu, `KeyId` określone w kompaktowania podpisu w załączniku do wiadomości jest używany do wybierania certyfikatu w sklepie.</span><span class="sxs-lookup"><span data-stu-id="f55f3-131">To verify the signature, the `KeyId` specified in the compact signature attached to the message is used to select a certificate from the specified store.</span></span> <span data-ttu-id="f55f3-132">Jeśli komunikat nie ma podpisu lub sprawdzenie podpisu nie powiedzie się, komunikaty są usuwane.</span><span class="sxs-lookup"><span data-stu-id="f55f3-132">If the message does not have a signature or the signature check fails, the messages are dropped.</span></span> <span data-ttu-id="f55f3-133">Aby używać bezpiecznego powiązania, próbki określa fabrykę, która tworzy niestandardowe <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> i <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> z elementem bezpiecznego powiązania odnajdywania dodany.</span><span class="sxs-lookup"><span data-stu-id="f55f3-133">To use the secure binding, the sample defines a factory that creates custom <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> and <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> with the added discovery secure binding element.</span></span> <span data-ttu-id="f55f3-134">Te bezpieczne punkty końcowe można używać w odbiorników anonsu odnajdywania i wykrywalny usług.</span><span class="sxs-lookup"><span data-stu-id="f55f3-134">These secure endpoints can be used in discovery announcement listeners and discoverable services.</span></span>  
  
## <a name="sample-details"></a><span data-ttu-id="f55f3-135">Szczegóły próbki</span><span class="sxs-lookup"><span data-stu-id="f55f3-135">Sample Details</span></span>  
 <span data-ttu-id="f55f3-136">Przykład obejmuje biblioteki i 4 aplikacje konsoli:</span><span class="sxs-lookup"><span data-stu-id="f55f3-136">The sample includes a library and 4 console applications:</span></span>  
  
-   <span data-ttu-id="f55f3-137">**DiscoverySecurityChannels**: Biblioteka, która uwidacznia bezpiecznego powiązania.</span><span class="sxs-lookup"><span data-stu-id="f55f3-137">**DiscoverySecurityChannels**: A library that exposes the secure binding.</span></span> <span data-ttu-id="f55f3-138">Biblioteka oblicza i weryfikuje podpis compact dla komunikatów wychodzących/przychodzących.</span><span class="sxs-lookup"><span data-stu-id="f55f3-138">The library computes and verifies the compact signature for outgoing/incoming messages.</span></span>  
  
-   <span data-ttu-id="f55f3-139">**Usługa**: udostępnianie ICalculatorService kontraktu usługi, hostowana samodzielnie.</span><span class="sxs-lookup"><span data-stu-id="f55f3-139">**Service**: A service exposing ICalculatorService contract, self hosted.</span></span> <span data-ttu-id="f55f3-140">Usługa jest oznaczona jako wykrywalny.</span><span class="sxs-lookup"><span data-stu-id="f55f3-140">The service is marked as Discoverable.</span></span> <span data-ttu-id="f55f3-141">Użytkownik określa szczegóły certyfikatu używanego do podpisywania wiadomości, określając lokalizację magazynu i nazwę i nazwa podmiotu lub inny unikatowy identyfikator certyfikatu i Magazyn, których certyfikaty klienta są znajduje (certyfikaty używane do sprawdzenie, czy podpis dla komunikatów przychodzących).</span><span class="sxs-lookup"><span data-stu-id="f55f3-141">The user specifies the details of the certificate used to sign messages by specifying the store location and name and the subject name or other unique identifier for the certificate, and the store where the client certificates are located (the certificates used to check signature for incoming messages).</span></span> <span data-ttu-id="f55f3-142">W oparciu o te informacje, UdpDiscoveryEndpoint z zwiększyć bezpieczeństwo jest utworzony i używany.</span><span class="sxs-lookup"><span data-stu-id="f55f3-142">Based on these details, a UdpDiscoveryEndpoint with added security is built and used.</span></span>  
  
-   <span data-ttu-id="f55f3-143">**Klient**: Ta klasa próbuje ICalculatorService i wywoływać metod w usłudze.</span><span class="sxs-lookup"><span data-stu-id="f55f3-143">**Client**: This class tries to discover an ICalculatorService and to call methods on the service.</span></span> <span data-ttu-id="f55f3-144">Ponownie <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> z dodane zabezpieczeń jest utworzony i używany do podpisywania i Sprawdź komunikaty.</span><span class="sxs-lookup"><span data-stu-id="f55f3-144">Again, a <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> with added security is built and used to sign and verify the messages.</span></span>  
  
-   <span data-ttu-id="f55f3-145">**AnnouncementListener**: hostowanie Samoobsługowe usługa nasłuchuje anonsów online i offline i korzysta z punktu końcowego bezpiecznego anonsu.</span><span class="sxs-lookup"><span data-stu-id="f55f3-145">**AnnouncementListener**: A self-hosted service that listens for online and offline announcements and uses the secure announcement endpoint.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f55f3-146">Jeśli pliku Setup.bat jest uruchamiana wielokrotnie, Menedżer certyfikatów wyświetla monit o wybranie certyfikat, aby dodać, ponieważ istnieją zduplikowane certyfikatów.</span><span class="sxs-lookup"><span data-stu-id="f55f3-146">If Setup.bat is run multiple times, the certificate manager prompts you for choosing a certificate to add, as there are duplicate certificates.</span></span> <span data-ttu-id="f55f3-147">W takim przypadku powinien być przerwane pliku Setup.bat i powinna być wywoływana Cleanup.bat, ponieważ duplikaty zostały już utworzone.</span><span class="sxs-lookup"><span data-stu-id="f55f3-147">In that case, Setup.bat should be aborted and Cleanup.bat should be called, because the duplicates have already been created.</span></span> <span data-ttu-id="f55f3-148">CleanUp.bat także wyświetli monit o wybranie certyfikatu do usunięcia.</span><span class="sxs-lookup"><span data-stu-id="f55f3-148">Cleanup.bat also prompts you to choose a certificate to delete.</span></span> <span data-ttu-id="f55f3-149">Wybierz certyfikat z listy i kontynuuje wykonywanie Cleanup.bat, dopóki pozostają nie ma żadnych certyfikatów.</span><span class="sxs-lookup"><span data-stu-id="f55f3-149">Select a certificate from the list and continue executing Cleanup.bat until no certificates are remaining.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="f55f3-150">Aby użyć tego przykładu</span><span class="sxs-lookup"><span data-stu-id="f55f3-150">To use this sample</span></span>  
  
1.  <span data-ttu-id="f55f3-151">Wykonanie skryptu pliku Setup.bat z wiersza polecenia programu Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="f55f3-151">Execute the Setup.bat script from a Visual Studio command prompt.</span></span> <span data-ttu-id="f55f3-152">Przykład używa certyfikatów do podpisywania i Sprawdź komunikaty.</span><span class="sxs-lookup"><span data-stu-id="f55f3-152">The sample uses certificates to sign and verify messages.</span></span> <span data-ttu-id="f55f3-153">Skrypt tworzy certyfikaty przy użyciu Makecert.exe, a następnie instaluje je przy użyciu Certmgr.exe.</span><span class="sxs-lookup"><span data-stu-id="f55f3-153">The script creates the certificates using Makecert.exe and then installs them using Certmgr.exe.</span></span> <span data-ttu-id="f55f3-154">Skrypt musi zostać uruchomione z uprawnieniami administratora.</span><span class="sxs-lookup"><span data-stu-id="f55f3-154">The script must be run with administrator privileges.</span></span>  
  
2.  <span data-ttu-id="f55f3-155">Aby skompilować i uruchomić przykład, otwórz plik Security.sln w programie Visual Studio i wybierz polecenie **rekompilacji wszystkiego**.</span><span class="sxs-lookup"><span data-stu-id="f55f3-155">To build and run the sample, open the Security.sln file in Visual Studio and choose **Rebuild All**.</span></span> <span data-ttu-id="f55f3-156">Aktualizowanie właściwości rozwiązania, aby uruchomić wiele projektów: Wybierz **Start** dla wszystkich projektów z wyjątkiem DiscoverySecureChannels.</span><span class="sxs-lookup"><span data-stu-id="f55f3-156">Update the solution properties to start multiple projects: select **Start** for all projects except DiscoverySecureChannels.</span></span> <span data-ttu-id="f55f3-157">Rozwiązanie, będą działać normalnie.</span><span class="sxs-lookup"><span data-stu-id="f55f3-157">Run the solution normally.</span></span>  
  
3.  <span data-ttu-id="f55f3-158">Po wykonaniu próbki, należy wykonać skrypt Cleanup.bat, który usuwa certyfikaty utworzone dla tego przykładu.</span><span class="sxs-lookup"><span data-stu-id="f55f3-158">After you are done with the sample, execute the Cleanup.bat script that removes the certificates created for this sample.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="f55f3-159">Próbki mogą być zainstalowane na tym komputerze.</span><span class="sxs-lookup"><span data-stu-id="f55f3-159">The samples may already be installed on your machine.</span></span> <span data-ttu-id="f55f3-160">Przed kontynuowaniem sprawdź, czy są dostępne dla następującego katalogu (ustawienie domyślne).</span><span class="sxs-lookup"><span data-stu-id="f55f3-160">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="f55f3-161">Jeśli ten katalog nie istnieje, przejdź do [Windows Communication Foundation (WCF) i Windows Workflow Foundation (WF) przykłady dla programu .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) pobrać wszystkie [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] i [!INCLUDE[wf1](../../../../includes/wf1-md.md)] próbek.</span><span class="sxs-lookup"><span data-stu-id="f55f3-161">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="f55f3-162">W tym przykładzie znajduje się w następującym katalogu.</span><span class="sxs-lookup"><span data-stu-id="f55f3-162">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Scenario\DiscoveryScenario`  
  
## <a name="see-also"></a><span data-ttu-id="f55f3-163">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="f55f3-163">See Also</span></span>
