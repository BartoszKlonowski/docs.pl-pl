---
title: 'Porady: zmienianie dostawcy kryptograficznego dla certyfikatu X.509&#39;s klucza prywatnego'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- cryptographic provider [WCF], changing
- cryptographic provider [WCF]
ms.assetid: b4254406-272e-4774-bd61-27e39bbb6c12
ms.openlocfilehash: 633e87bca302adc0963e1bf52d2470c9dbae81a5
ms.sourcegitcommit: 15109844229ade1c6449f48f3834db1b26907824
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 05/07/2018
ms.locfileid: "33808094"
---
# <a name="how-to-change-the-cryptographic-provider-for-an-x509-certificate39s-private-key"></a><span data-ttu-id="cc9f1-102">Porady: zmienianie dostawcy kryptograficznego dla certyfikatu X.509&#39;s klucza prywatnego</span><span class="sxs-lookup"><span data-stu-id="cc9f1-102">How to: Change the Cryptographic Provider for an X.509 Certificate&#39;s Private Key</span></span>
<span data-ttu-id="cc9f1-103">W tym temacie pokazano sposób zintegrować dostawcy przez strukturę zabezpieczeń systemu Windows Communication Foundation (WCF) oraz sposobu zmiany dostawcy usług kryptograficznych, umożliwiające uzyskanie klucza prywatnego certyfikatu X.509.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-103">This topic shows how to change the cryptographic provider used to provide an X.509 certificate's private key and how to integrate the provider into the Windows Communication Foundation (WCF) security framework.</span></span> <span data-ttu-id="cc9f1-104">Aby uzyskać więcej informacji o korzystaniu z certyfikatów, zobacz [Praca z certyfikatami](../../../../docs/framework/wcf/feature-details/working-with-certificates.md).</span><span class="sxs-lookup"><span data-stu-id="cc9f1-104">For more information about using certificates, see [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md).</span></span>  
  
 <span data-ttu-id="cc9f1-105">Struktura zabezpieczeń WCF umożliwia wprowadzenie nowych typów tokenu zabezpieczeń, zgodnie z opisem w [porady: Tworzenie tokenu niestandardowego](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="cc9f1-105">The WCF security framework provides a way to introduce new security token types as described in [How to: Create a Custom Token](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span></span> <span data-ttu-id="cc9f1-106">Użytkownik może również używać niestandardowy token, aby zastąpić istniejące typy tokenów dostarczane przez system.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-106">It is also possible to use a custom token to replace existing system-provided token types.</span></span>  
  
 <span data-ttu-id="cc9f1-107">W tym temacie tokenu zabezpieczającego X.509 dostarczane przez system zastępuje niestandardowy token X.509, który zawiera inną implementację dla klucza prywatnego certyfikatu.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-107">In this topic, the system-provided X.509 security token is replaced by a custom X.509 token that provides a different implementation for the certificate private key.</span></span> <span data-ttu-id="cc9f1-108">Jest to przydatne w scenariuszach, w którym podano rzeczywistego klucza prywatnego przez dostawcę usług kryptograficznych innego niż domyślny dostawca usług kryptograficznych systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-108">This is useful in scenarios where the actual private key is provided by a different cryptographic provider than the default Windows cryptographic provider.</span></span> <span data-ttu-id="cc9f1-109">Przykładem alternatywnego dostawcy usług kryptograficznych jest sprzętowego modułu zabezpieczeń, który wykonuje wszystkie prywatnego klucza pokrewne operacje kryptograficzne, a nie przechowywania kluczy prywatnych w pamięci, co poprawia zabezpieczeń systemu.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-109">One example of an alternative cryptographic provider is a hardware security module that performs all private key related cryptographic operations, and does not store the private keys in memory, thus improving security of the system.</span></span>  
  
 <span data-ttu-id="cc9f1-110">Poniższy przykład jest tylko w celach demonstracyjnych.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-110">The following example is for demonstration purposes only.</span></span> <span data-ttu-id="cc9f1-111">Nie zastępuje domyślny dostawca usług kryptograficznych systemu Windows, ale zawiera, gdzie można zintegrować takiego dostawcy.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-111">It does not replace the default Windows cryptographic provider, but it shows where such a provider could be integrated.</span></span>  
  
## <a name="procedures"></a><span data-ttu-id="cc9f1-112">Procedury</span><span class="sxs-lookup"><span data-stu-id="cc9f1-112">Procedures</span></span>  
 <span data-ttu-id="cc9f1-113">Każdy token zabezpieczający, który ma skojarzony klucz lub klucze musi implementować <xref:System.IdentityModel.Tokens.SecurityToken.SecurityKeys%2A> właściwość, która zwraca kolekcję kluczy z wystąpienia tokenu zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-113">Every security token that has an associated security key or keys must implement the <xref:System.IdentityModel.Tokens.SecurityToken.SecurityKeys%2A> property, which returns a collection of keys from the security token instance.</span></span> <span data-ttu-id="cc9f1-114">Jeśli token jest tokenem zabezpieczającym X.509, Kolekcja zawiera pojedyncze wystąpienie <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> klasa, która reprezentuje klucze publiczny i prywatny skojarzony z certyfikatem.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-114">If the token is an X.509 security token, the collection contains a single instance of the <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> class that represents both public and private keys associated with the certificate.</span></span> <span data-ttu-id="cc9f1-115">Aby zastąpić domyślny dostawca usług kryptograficznych używane w celu dostarczania kluczy do certyfikatu, Utwórz nową implementacją tej klasy.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-115">To replace the default cryptographic provider used to provide the certificate's keys, create a new implementation of this class.</span></span>  
  
#### <a name="to-create-a-custom-x509-asymmetric-key"></a><span data-ttu-id="cc9f1-116">Aby utworzyć niestandardowe klucza asymetrycznego X.509</span><span class="sxs-lookup"><span data-stu-id="cc9f1-116">To create a custom X.509 asymmetric key</span></span>  
  
1.  <span data-ttu-id="cc9f1-117">Zdefiniuj nową klasę pochodną <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> klasy.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-117">Define a new class derived from the <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> class.</span></span>  
  
2.  <span data-ttu-id="cc9f1-118">Zastąpienie <xref:System.IdentityModel.Tokens.SecurityKey.KeySize%2A> właściwości tylko do odczytu.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-118">Override the <xref:System.IdentityModel.Tokens.SecurityKey.KeySize%2A> read-only property.</span></span> <span data-ttu-id="cc9f1-119">Ta właściwość zwraca rzeczywisty rozmiar klucza certyfikatu pary kluczy publiczny/prywatny.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-119">This property returns the actual key size of the certificate's public/private key pair.</span></span>  
  
3.  <span data-ttu-id="cc9f1-120">Zastąpienie <xref:System.IdentityModel.Tokens.SecurityKey.DecryptKey%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-120">Override the <xref:System.IdentityModel.Tokens.SecurityKey.DecryptKey%2A> method.</span></span> <span data-ttu-id="cc9f1-121">Ta metoda jest wywoływana przez strukturę zabezpieczeń WCF do odszyfrowania klucza symetrycznego klucza prywatnego certyfikatu.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-121">This method is called by the WCF security framework to decrypt a symmetric key with the certificate's private key.</span></span> <span data-ttu-id="cc9f1-122">(Klucz został wcześniej zaszyfrowany z użyciem klucza publicznego certyfikatu).</span><span class="sxs-lookup"><span data-stu-id="cc9f1-122">(The key was previously encrypted with the certificate's public key.)</span></span>  
  
4.  <span data-ttu-id="cc9f1-123">Zastąpienie <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetAsymmetricAlgorithm%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-123">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetAsymmetricAlgorithm%2A> method.</span></span> <span data-ttu-id="cc9f1-124">Ta metoda jest wywoływana przez strukturę zabezpieczeń WCF można uzyskać wystąpienia <xref:System.Security.Cryptography.AsymmetricAlgorithm> klasa, która reprezentuje dostawcy usług kryptograficznych dla jego certyfikat prywatny lub publiczny klucz, w zależności od parametrów przekazane do metody.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-124">This method is called by the WCF security framework to obtain an instance of the <xref:System.Security.Cryptography.AsymmetricAlgorithm> class that represents the cryptographic provider for either the certificate's private or public key, depending on the parameters passed to the method.</span></span>  
  
5.  <span data-ttu-id="cc9f1-125">Opcjonalna.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-125">Optional.</span></span> <span data-ttu-id="cc9f1-126">Zastąpienie <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetHashAlgorithmForSignature%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-126">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetHashAlgorithmForSignature%2A> method.</span></span> <span data-ttu-id="cc9f1-127">Przesłonić tę metodę, jeśli różne implementacje <xref:System.Security.Cryptography.HashAlgorithm> klasa jest wymagana.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-127">Override this method if a different implementation of the <xref:System.Security.Cryptography.HashAlgorithm> class is required.</span></span>  
  
6.  <span data-ttu-id="cc9f1-128">Zastąpienie <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetSignatureFormatter%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-128">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetSignatureFormatter%2A> method.</span></span> <span data-ttu-id="cc9f1-129">Ta metoda zwraca wystąpienie klasy <xref:System.Security.Cryptography.AsymmetricSignatureFormatter> klasy, która jest skojarzona z klucza prywatnego certyfikatu.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-129">This method returns an instance of the <xref:System.Security.Cryptography.AsymmetricSignatureFormatter> class that is associated with the certificate's private key.</span></span>  
  
7.  <span data-ttu-id="cc9f1-130">Zastąpienie <xref:System.IdentityModel.Tokens.SecurityKey.IsSupportedAlgorithm%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-130">Override the <xref:System.IdentityModel.Tokens.SecurityKey.IsSupportedAlgorithm%2A> method.</span></span> <span data-ttu-id="cc9f1-131">Ta metoda jest używana w celu wskazania, czy konkretnego algorytmu kryptograficznego jest obsługiwana przez implementację klucza zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-131">This method is used to indicate whether a particular cryptographic algorithm is supported by the security key implementation.</span></span>  
  
     [!code-csharp[c_CustomX509Token#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#1)]
     [!code-vb[c_CustomX509Token#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#1)]  
  
 <span data-ttu-id="cc9f1-132">Poniższa procedura przedstawia sposób integrowanie niestandardowych X.509 asymetrycznego klucza implementacji zabezpieczeń utworzony w poprzedniej procedurze z architekturą WCF zabezpieczeń, aby zastąpić zabezpieczeń X.509 dostarczane przez system tokenu.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-132">The following procedure shows how to integrate the custom X.509 asymmetric security key implementation created in the preceding procedure with the WCF security framework in order to replace the system-provided X.509 security token.</span></span>  
  
#### <a name="to-replace-the-system-provided-x509-security-token-with-a-custom-x509-asymmetric-security-key-token"></a><span data-ttu-id="cc9f1-133">Aby zastąpić niestandardowy token klucza asymetrycznego zabezpieczeń X.509 tokenu zabezpieczającego X.509 dostarczane przez system</span><span class="sxs-lookup"><span data-stu-id="cc9f1-133">To replace the system-provided X.509 security token with a custom X.509 asymmetric security key token</span></span>  
  
1.  <span data-ttu-id="cc9f1-134">Tworzenie niestandardowych token zabezpieczający X.509, który zwraca niestandardowe klucza asymetrycznego zabezpieczeń X.509 zamiast klucza dostarczane przez system zabezpieczeń, jak pokazano w poniższym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-134">Create a custom X.509 security token that returns the custom X.509 asymmetric security key instead of the system-provided security key, as shown in the following example.</span></span> <span data-ttu-id="cc9f1-135">Aby uzyskać więcej informacji na temat tokeny zabezpieczające niestandardowych, zobacz [porady: Tworzenie niestandardowego tokenu](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="cc9f1-135">For more information about custom security tokens, see [How to: Create a Custom Token](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#2)]
     [!code-vb[c_CustomX509Token#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#2)]  
  
2.  <span data-ttu-id="cc9f1-136">Utwórz zabezpieczeń niestandardowego dostawcę tokenów, który zwraca token zabezpieczający X.509 niestandardowych, jak pokazano w przykładzie.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-136">Create a custom security token provider that returns a custom X.509 security token, as shown in the example.</span></span> <span data-ttu-id="cc9f1-137">Aby uzyskać więcej informacji na temat dostawcy tokenów zabezpieczeń niestandardowych, zobacz [porady: Tworzenie niestandardowego dostawcy tokenów zabezpieczających](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md).</span><span class="sxs-lookup"><span data-stu-id="cc9f1-137">For more information about custom security token providers, see [How to: Create a Custom Security Token Provider](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#3)]
     [!code-vb[c_CustomX509Token#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#3)]  
  
3.  <span data-ttu-id="cc9f1-138">Jeśli klucz niestandardowy zabezpieczeń musi być używane po stronie inicjatora, Utwórz niestandardowe klienta, Menedżer tokenów zabezpieczających i klasy poświadczenia niestandardowego klienta, jak pokazano w poniższym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-138">If the custom security key needs to be used on the initiator side, create a custom client security token manager and custom client credentials classes, as shown in the following example.</span></span> <span data-ttu-id="cc9f1-139">Aby uzyskać więcej informacji o poświadczenia niestandardowego klienta i menedżerów tokenu zabezpieczeń klienta, zobacz [wskazówki: Tworzenie niestandardowego klienta i poświadczeń usługi](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="cc9f1-139">For more information about custom client credentials and client security token managers, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#4)]
     [!code-vb[c_CustomX509Token#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#4)]  
  
     [!code-csharp[c_CustomX509Token#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#6)]
     [!code-vb[c_CustomX509Token#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#6)]  
  
4.  <span data-ttu-id="cc9f1-140">Jeśli klucz niestandardowy zabezpieczeń musi być używane po stronie odbiorcy, Utwórz niestandardowe usługi Menedżer tokenów zabezpieczających i poświadczeń usługi niestandardowych, jak pokazano w poniższym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="cc9f1-140">If the custom security key needs to be used on the recipient side, create a custom service security token manager and custom service credentials, as shown in the following example.</span></span> <span data-ttu-id="cc9f1-141">Aby uzyskać więcej informacji na temat niestandardowe poświadczenia i menedżerów tokenu zabezpieczeń usługi, zobacz [wskazówki: Tworzenie niestandardowego klienta i poświadczeń usługi](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="cc9f1-141">For more information about custom service credentials and service security token managers, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#5)]
     [!code-vb[c_CustomX509Token#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#5)]  
  
     [!code-csharp[c_CustomX509Token#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#7)]
     [!code-vb[c_CustomX509Token#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#7)]  
  
## <a name="see-also"></a><span data-ttu-id="cc9f1-142">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="cc9f1-142">See Also</span></span>  
 <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey>  
 <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey>  
 <xref:System.IdentityModel.Tokens.SecurityKey>  
 <xref:System.Security.Cryptography.AsymmetricAlgorithm>  
 <xref:System.Security.Cryptography.HashAlgorithm>  
 <xref:System.Security.Cryptography.AsymmetricSignatureFormatter>  
 [<span data-ttu-id="cc9f1-143">Przewodnik: tworzenie niestandardowego klienta i poświadczeń usługi</span><span class="sxs-lookup"><span data-stu-id="cc9f1-143">Walkthrough: Creating Custom Client and Service Credentials</span></span>](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md)  
 [<span data-ttu-id="cc9f1-144">Instrukcje: tworzenie niestandardowego wystawcy uwierzytelniania tokenu zabezpieczeń</span><span class="sxs-lookup"><span data-stu-id="cc9f1-144">How to: Create a Custom Security Token Authenticator</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md)  
 [<span data-ttu-id="cc9f1-145">Instrukcje: tworzenie niestandardowego dostawcy tokenów zabezpieczeń</span><span class="sxs-lookup"><span data-stu-id="cc9f1-145">How to: Create a Custom Security Token Provider</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)  
 [<span data-ttu-id="cc9f1-146">Instrukcje: tworzenie tokenu niestandardowego</span><span class="sxs-lookup"><span data-stu-id="cc9f1-146">How to: Create a Custom Token</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md)  
 [<span data-ttu-id="cc9f1-147">Architektura zabezpieczeń</span><span class="sxs-lookup"><span data-stu-id="cc9f1-147">Security Architecture</span></span>](http://msdn.microsoft.com/library/16593476-d36a-408d-808c-ae6fd483e28f)
