---
title: 'Porady: zmienianie dostawcy kryptograficznego dla certyfikatu X.509&#39;s klucza prywatnego'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- cryptographic provider [WCF], changing
- cryptographic provider [WCF]
ms.assetid: b4254406-272e-4774-bd61-27e39bbb6c12
ms.openlocfilehash: bb345b3106895a75c00a0d80b8665a0e9239598f
ms.sourcegitcommit: 2eceb05f1a5bb261291a1f6a91c5153727ac1c19
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 09/04/2018
ms.locfileid: "43510482"
---
# <a name="how-to-change-the-cryptographic-provider-for-an-x509-certificate39s-private-key"></a><span data-ttu-id="06384-102">Porady: zmienianie dostawcy kryptograficznego dla certyfikatu X.509&#39;s klucza prywatnego</span><span class="sxs-lookup"><span data-stu-id="06384-102">How to: Change the Cryptographic Provider for an X.509 Certificate&#39;s Private Key</span></span>
<span data-ttu-id="06384-103">W tym temacie pokazano, jak zmienić dostawcy usług kryptograficznych, używane do zapewnienia klucza prywatnego certyfikatu X.509 oraz integrować dostawcę w ramach zabezpieczeń Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="06384-103">This topic shows how to change the cryptographic provider used to provide an X.509 certificate's private key and how to integrate the provider into the Windows Communication Foundation (WCF) security framework.</span></span> <span data-ttu-id="06384-104">Aby uzyskać więcej informacji o korzystaniu z certyfikatów, zobacz [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md).</span><span class="sxs-lookup"><span data-stu-id="06384-104">For more information about using certificates, see [Working with Certificates](../../../../docs/framework/wcf/feature-details/working-with-certificates.md).</span></span>  
  
 <span data-ttu-id="06384-105">Struktura zabezpieczeń programu WCF zapewnia sposób wprowadzenia nowych typów tokenu zabezpieczeń, zgodnie z opisem w [porady: Tworzenie tokenu niestandardowego](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="06384-105">The WCF security framework provides a way to introduce new security token types as described in [How to: Create a Custom Token](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span></span> <span data-ttu-id="06384-106">Użytkownik może również użyć niestandardowy token, aby zamienić istniejący dostarczane przez system typy tokenów.</span><span class="sxs-lookup"><span data-stu-id="06384-106">It is also possible to use a custom token to replace existing system-provided token types.</span></span>  
  
 <span data-ttu-id="06384-107">W tym temacie tokenu zabezpieczającego X.509 dostarczane przez system zastępuje niestandardowy token X.509, który zawiera różne implementacje dla klucza prywatnego certyfikatu.</span><span class="sxs-lookup"><span data-stu-id="06384-107">In this topic, the system-provided X.509 security token is replaced by a custom X.509 token that provides a different implementation for the certificate private key.</span></span> <span data-ttu-id="06384-108">Jest to przydatne w scenariuszach, gdzie rzeczywiste klucz prywatny jest udostępniany przez dostawcę usług kryptograficznych innej niż domyślny dostawca usług kryptograficznych Windows.</span><span class="sxs-lookup"><span data-stu-id="06384-108">This is useful in scenarios where the actual private key is provided by a different cryptographic provider than the default Windows cryptographic provider.</span></span> <span data-ttu-id="06384-109">Jednym z przykładów alternatywnego dostawcy usług kryptograficznych jest sprzętowego modułu zabezpieczeń, który wykonuje wszystkie prywatnych kluczy powiązanych operacji kryptograficznych, a nie przechowuje klucze prywatne w pamięci, co poprawia bezpieczeństwo systemu.</span><span class="sxs-lookup"><span data-stu-id="06384-109">One example of an alternative cryptographic provider is a hardware security module that performs all private key related cryptographic operations, and does not store the private keys in memory, thus improving security of the system.</span></span>  
  
 <span data-ttu-id="06384-110">Poniższy przykład jest tylko w celach demonstracyjnych.</span><span class="sxs-lookup"><span data-stu-id="06384-110">The following example is for demonstration purposes only.</span></span> <span data-ttu-id="06384-111">Nie zastępuje domyślny dostawca usług kryptograficznych Windows, ale pokazuje, gdzie można zintegrować takiego dostawcy.</span><span class="sxs-lookup"><span data-stu-id="06384-111">It does not replace the default Windows cryptographic provider, but it shows where such a provider could be integrated.</span></span>  
  
## <a name="procedures"></a><span data-ttu-id="06384-112">Procedury</span><span class="sxs-lookup"><span data-stu-id="06384-112">Procedures</span></span>  
 <span data-ttu-id="06384-113">Każdy token zabezpieczający, który ma skojarzony klucz zabezpieczeń lub klucze muszą implementować <xref:System.IdentityModel.Tokens.SecurityToken.SecurityKeys%2A> właściwość, która zwraca kolekcję kluczy z wystąpienia tokenu zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="06384-113">Every security token that has an associated security key or keys must implement the <xref:System.IdentityModel.Tokens.SecurityToken.SecurityKeys%2A> property, which returns a collection of keys from the security token instance.</span></span> <span data-ttu-id="06384-114">Jeśli token jest tokenem zabezpieczeń X.509, Kolekcja zawiera jedno wystąpienie <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> klasa, która reprezentuje kluczy prywatnych i publicznych skojarzonego z certyfikatem.</span><span class="sxs-lookup"><span data-stu-id="06384-114">If the token is an X.509 security token, the collection contains a single instance of the <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> class that represents both public and private keys associated with the certificate.</span></span> <span data-ttu-id="06384-115">Aby zastąpić domyślny dostawca usług kryptograficznych używany w celu dostarczania kluczy certyfikatu, Utwórz nową metodę implementacji tej klasy.</span><span class="sxs-lookup"><span data-stu-id="06384-115">To replace the default cryptographic provider used to provide the certificate's keys, create a new implementation of this class.</span></span>  
  
#### <a name="to-create-a-custom-x509-asymmetric-key"></a><span data-ttu-id="06384-116">Aby utworzyć niestandardowy klucz asymetryczny X.509</span><span class="sxs-lookup"><span data-stu-id="06384-116">To create a custom X.509 asymmetric key</span></span>  
  
1.  <span data-ttu-id="06384-117">Zdefiniuj nową klasę pochodną <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> klasy.</span><span class="sxs-lookup"><span data-stu-id="06384-117">Define a new class derived from the <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> class.</span></span>  
  
2.  <span data-ttu-id="06384-118">Zastąp <xref:System.IdentityModel.Tokens.SecurityKey.KeySize%2A> właściwość tylko do odczytu.</span><span class="sxs-lookup"><span data-stu-id="06384-118">Override the <xref:System.IdentityModel.Tokens.SecurityKey.KeySize%2A> read-only property.</span></span> <span data-ttu-id="06384-119">Ta właściwość zwraca rzeczywisty rozmiar klucza pary kluczy publiczny/prywatny certyfikatu.</span><span class="sxs-lookup"><span data-stu-id="06384-119">This property returns the actual key size of the certificate's public/private key pair.</span></span>  
  
3.  <span data-ttu-id="06384-120">Zastąp <xref:System.IdentityModel.Tokens.SecurityKey.DecryptKey%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="06384-120">Override the <xref:System.IdentityModel.Tokens.SecurityKey.DecryptKey%2A> method.</span></span> <span data-ttu-id="06384-121">Ta metoda jest wywoływana przez strukturę zabezpieczeń programu WCF do odszyfrowania klucza symetrycznego przy użyciu klucza prywatnego certyfikatu.</span><span class="sxs-lookup"><span data-stu-id="06384-121">This method is called by the WCF security framework to decrypt a symmetric key with the certificate's private key.</span></span> <span data-ttu-id="06384-122">(Klucz wcześniej został zaszyfrowany za pomocą klucza publicznego certyfikatu).</span><span class="sxs-lookup"><span data-stu-id="06384-122">(The key was previously encrypted with the certificate's public key.)</span></span>  
  
4.  <span data-ttu-id="06384-123">Zastąp <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetAsymmetricAlgorithm%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="06384-123">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetAsymmetricAlgorithm%2A> method.</span></span> <span data-ttu-id="06384-124">Ta metoda jest wywoływana przez platformę zabezpieczeń usługi WCF w celu uzyskania wystąpienie <xref:System.Security.Cryptography.AsymmetricAlgorithm> klasa, która reprezentuje dostawcy usług kryptograficznych do certyfikatu prywatnej lub publicznej klucza, w zależności od parametrów przekazywany do metody.</span><span class="sxs-lookup"><span data-stu-id="06384-124">This method is called by the WCF security framework to obtain an instance of the <xref:System.Security.Cryptography.AsymmetricAlgorithm> class that represents the cryptographic provider for either the certificate's private or public key, depending on the parameters passed to the method.</span></span>  
  
5.  <span data-ttu-id="06384-125">Opcjonalna.</span><span class="sxs-lookup"><span data-stu-id="06384-125">Optional.</span></span> <span data-ttu-id="06384-126">Zastąp <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetHashAlgorithmForSignature%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="06384-126">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetHashAlgorithmForSignature%2A> method.</span></span> <span data-ttu-id="06384-127">Przesłonić tę metodę, jeśli z inną implementacją <xref:System.Security.Cryptography.HashAlgorithm> klasy jest wymagana.</span><span class="sxs-lookup"><span data-stu-id="06384-127">Override this method if a different implementation of the <xref:System.Security.Cryptography.HashAlgorithm> class is required.</span></span>  
  
6.  <span data-ttu-id="06384-128">Zastąp <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetSignatureFormatter%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="06384-128">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetSignatureFormatter%2A> method.</span></span> <span data-ttu-id="06384-129">Ta metoda zwraca wystąpienie <xref:System.Security.Cryptography.AsymmetricSignatureFormatter> klasę, która jest skojarzona z klucza prywatnego certyfikatu.</span><span class="sxs-lookup"><span data-stu-id="06384-129">This method returns an instance of the <xref:System.Security.Cryptography.AsymmetricSignatureFormatter> class that is associated with the certificate's private key.</span></span>  
  
7.  <span data-ttu-id="06384-130">Zastąp <xref:System.IdentityModel.Tokens.SecurityKey.IsSupportedAlgorithm%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="06384-130">Override the <xref:System.IdentityModel.Tokens.SecurityKey.IsSupportedAlgorithm%2A> method.</span></span> <span data-ttu-id="06384-131">Ta metoda jest używana w celu wskazania, czy określonego algorytmu kryptograficznego jest obsługiwana przez implementację klucza zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="06384-131">This method is used to indicate whether a particular cryptographic algorithm is supported by the security key implementation.</span></span>  
  
     [!code-csharp[c_CustomX509Token#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#1)]
     [!code-vb[c_CustomX509Token#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#1)]  
  
 <span data-ttu-id="06384-132">Poniższa procedura pokazuje, jak zintegrować X.509 asymetrycznego zabezpieczeń klucza implementację niestandardową utworzony w poprzedniej procedurze z architekturą WCF zabezpieczeń w celu zastąpienia zabezpieczeń X.509 dostarczane przez system tokenu.</span><span class="sxs-lookup"><span data-stu-id="06384-132">The following procedure shows how to integrate the custom X.509 asymmetric security key implementation created in the preceding procedure with the WCF security framework in order to replace the system-provided X.509 security token.</span></span>  
  
#### <a name="to-replace-the-system-provided-x509-security-token-with-a-custom-x509-asymmetric-security-key-token"></a><span data-ttu-id="06384-133">Aby zastąpić token zabezpieczający X.509 dostarczane przez system niestandardowy token klucza asymetrycznego zabezpieczeń X.509</span><span class="sxs-lookup"><span data-stu-id="06384-133">To replace the system-provided X.509 security token with a custom X.509 asymmetric security key token</span></span>  
  
1.  <span data-ttu-id="06384-134">Utwórz niestandardowy token zabezpieczający X.509, który zwraca niestandardowy klucz asymetryczny zabezpieczeń X.509 zamiast klucz zabezpieczeń dostarczanych przez system, jak pokazano w poniższym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="06384-134">Create a custom X.509 security token that returns the custom X.509 asymmetric security key instead of the system-provided security key, as shown in the following example.</span></span> <span data-ttu-id="06384-135">Aby uzyskać więcej informacji na temat tokenów zabezpieczających niestandardowych, zobacz [jak: utworzyć niestandardowe tokenu](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="06384-135">For more information about custom security tokens, see [How to: Create a Custom Token](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#2)]
     [!code-vb[c_CustomX509Token#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#2)]  
  
2.  <span data-ttu-id="06384-136">Tworzenie niestandardowego dostawcy tokenów zabezpieczeń zwracające niestandardowy token zabezpieczający X.509, jak pokazano w przykładzie.</span><span class="sxs-lookup"><span data-stu-id="06384-136">Create a custom security token provider that returns a custom X.509 security token, as shown in the example.</span></span> <span data-ttu-id="06384-137">Aby uzyskać więcej informacji na temat dostawcy tokenów zabezpieczeń niestandardowe zobacz [porady: Tworzenie niestandardowego dostawcy tokenów zabezpieczeń](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md).</span><span class="sxs-lookup"><span data-stu-id="06384-137">For more information about custom security token providers, see [How to: Create a Custom Security Token Provider](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#3)]
     [!code-vb[c_CustomX509Token#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#3)]  
  
3.  <span data-ttu-id="06384-138">Jeśli klucz niestandardowy zabezpieczeń wymaga do użycia na stronie inicjatora, tworzenie niestandardowego klienta Menedżer tokenów zabezpieczeń i klas poświadczenia niestandardowego klienta, jak pokazano w poniższym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="06384-138">If the custom security key needs to be used on the initiator side, create a custom client security token manager and custom client credentials classes, as shown in the following example.</span></span> <span data-ttu-id="06384-139">Aby uzyskać więcej informacji o poświadczenia niestandardowego klienta i menedżerów tokenu zabezpieczeń klienta, zobacz [wskazówki: Tworzenie niestandardowego klienta i poświadczeń usługi](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="06384-139">For more information about custom client credentials and client security token managers, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#4)]
     [!code-vb[c_CustomX509Token#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#4)]  
  
     [!code-csharp[c_CustomX509Token#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#6)]
     [!code-vb[c_CustomX509Token#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#6)]  
  
4.  <span data-ttu-id="06384-140">Jeśli klucz niestandardowy zabezpieczeń musi być używane po stronie odbiorcy, należy utworzyć niestandardowe usługi Menedżer tokenów zabezpieczeń i poświadczeń usługi niestandardowych, jak pokazano w poniższym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="06384-140">If the custom security key needs to be used on the recipient side, create a custom service security token manager and custom service credentials, as shown in the following example.</span></span> <span data-ttu-id="06384-141">Aby uzyskać więcej informacji na temat niestandardowe poświadczenia i menedżerów tokenu zabezpieczeń usługi, zobacz [wskazówki: Tworzenie niestandardowego klienta i poświadczeń usługi](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="06384-141">For more information about custom service credentials and service security token managers, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#5)]
     [!code-vb[c_CustomX509Token#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#5)]  
  
     [!code-csharp[c_CustomX509Token#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#7)]
     [!code-vb[c_CustomX509Token#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#7)]  
  
## <a name="see-also"></a><span data-ttu-id="06384-142">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="06384-142">See Also</span></span>  
 <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey>  
 <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey>  
 <xref:System.IdentityModel.Tokens.SecurityKey>  
 <xref:System.Security.Cryptography.AsymmetricAlgorithm>  
 <xref:System.Security.Cryptography.HashAlgorithm>  
 <xref:System.Security.Cryptography.AsymmetricSignatureFormatter>  
 [<span data-ttu-id="06384-143">Przewodnik: tworzenie niestandardowego klienta i poświadczeń usługi</span><span class="sxs-lookup"><span data-stu-id="06384-143">Walkthrough: Creating Custom Client and Service Credentials</span></span>](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md)  
 [<span data-ttu-id="06384-144">Instrukcje: tworzenie niestandardowego wystawcy uwierzytelniania tokenu zabezpieczeń</span><span class="sxs-lookup"><span data-stu-id="06384-144">How to: Create a Custom Security Token Authenticator</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md)  
 [<span data-ttu-id="06384-145">Instrukcje: tworzenie niestandardowego dostawcy tokenów zabezpieczeń</span><span class="sxs-lookup"><span data-stu-id="06384-145">How to: Create a Custom Security Token Provider</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)  
 [<span data-ttu-id="06384-146">Instrukcje: tworzenie tokenu niestandardowego</span><span class="sxs-lookup"><span data-stu-id="06384-146">How to: Create a Custom Token</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md)  
 [<span data-ttu-id="06384-147">Architektura zabezpieczeń</span><span class="sxs-lookup"><span data-stu-id="06384-147">Security Architecture</span></span>](https://msdn.microsoft.com/library/16593476-d36a-408d-808c-ae6fd483e28f)
