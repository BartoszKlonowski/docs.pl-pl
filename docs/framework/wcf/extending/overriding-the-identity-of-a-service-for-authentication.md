---
title: Przesłanianie tożsamości usługi na potrzeby uwierzytelniania
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: d613a22b-07d7-41a4-bada-1adc653b9b5d
ms.openlocfilehash: 3df1f2490f8636d52ac75fad2469adadec2a57da
ms.sourcegitcommit: 15109844229ade1c6449f48f3834db1b26907824
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 05/07/2018
---
# <a name="overriding-the-identity-of-a-service-for-authentication"></a><span data-ttu-id="c75f5-102">Przesłanianie tożsamości usługi na potrzeby uwierzytelniania</span><span class="sxs-lookup"><span data-stu-id="c75f5-102">Overriding the Identity of a Service for Authentication</span></span>
<span data-ttu-id="c75f5-103">Zazwyczaj nie trzeba ustawić tożsamość w usłudze, ponieważ typ tożsamości w metadanych usługi nakazują wybór typu poświadczeń klienta.</span><span class="sxs-lookup"><span data-stu-id="c75f5-103">Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata.</span></span> <span data-ttu-id="c75f5-104">Na przykład w poniższym kodzie konfiguracji użyto [ \<wsHttpBinding >](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) element i zestawy `clientCredentialType` atrybutu do systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="c75f5-104">For example, the following configuration code uses the [\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) element and sets the `clientCredentialType` attribute to Windows.</span></span>  
  
  
  
 <span data-ttu-id="c75f5-105">Poniższy fragment Web Services Description Language (WSDL) zawiera tożsamość punktu końcowego wcześniej zdefiniowany.</span><span class="sxs-lookup"><span data-stu-id="c75f5-105">The following Web Services Description Language (WSDL) fragment shows the identity for the endpoint previously defined.</span></span> <span data-ttu-id="c75f5-106">W tym przykładzie usługa jest uruchomiona jako usługa samodzielnie hostowana w obszarze konta określonego użytkownika (username@contoso.com), dlatego tożsamości użytkownika (UPN) Nazwa główna zawiera nazwę konta.</span><span class="sxs-lookup"><span data-stu-id="c75f5-106">In this example, the service is running as a self-hosted service under a particular user account (username@contoso.com) and therefore the user principal name (UPN) identity contains the account name.</span></span> <span data-ttu-id="c75f5-107">Nazwa UPN nosi również nazwę logowania użytkownika w domenie systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="c75f5-107">The UPN is also known as the user logon name in a Windows domain.</span></span>  
  
  
  
 <span data-ttu-id="c75f5-108">Przykładową aplikację prezentującą ustawienie tożsamości, zobacz [tożsamość usług — przykład](../../../../docs/framework/wcf/samples/service-identity-sample.md).</span><span class="sxs-lookup"><span data-stu-id="c75f5-108">For a sample application that demonstrates identity setting, see [Service Identity Sample](../../../../docs/framework/wcf/samples/service-identity-sample.md).</span></span> <span data-ttu-id="c75f5-109">Aby uzyskać więcej informacji o tożsamości usługi, zobacz [uwierzytelnianie i tożsamość usługi](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="c75f5-109">For more information about service identity, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span></span>  
  
## <a name="kerberos-authentication-and-identity"></a><span data-ttu-id="c75f5-110">Uwierzytelnianie Kerberos i tożsamość</span><span class="sxs-lookup"><span data-stu-id="c75f5-110">Kerberos Authentication and Identity</span></span>  
 <span data-ttu-id="c75f5-111">Domyślnie, gdy usługa jest skonfigurowana do używania poświadczeń systemu Windows [ \<tożsamości >](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md) element, który zawiera [ \<userPrincipalName >](../../../../docs/framework/configure-apps/file-schema/wcf/userprincipalname.md) lub [ \<servicePrincipalName >](../../../../docs/framework/configure-apps/file-schema/wcf/serviceprincipalname.md) element jest generowany w formacie WSDL.</span><span class="sxs-lookup"><span data-stu-id="c75f5-111">By default, when a service is configured to use a Windows credential, an [\<identity>](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md) element that contains a [\<userPrincipalName>](../../../../docs/framework/configure-apps/file-schema/wcf/userprincipalname.md) or [\<servicePrincipalName>](../../../../docs/framework/configure-apps/file-schema/wcf/serviceprincipalname.md) element is generated in the WSDL.</span></span> <span data-ttu-id="c75f5-112">Jeśli usługa jest uruchomiona w obszarze `LocalSystem`, `LocalService`, lub `NetworkService` konto, usługi głównej nazwy (usługi SPN) jest generowany domyślnie w formie `host/` \< *hostname*> ponieważ te konta mają dostęp do danych SPN komputera.</span><span class="sxs-lookup"><span data-stu-id="c75f5-112">If the service is running under the `LocalSystem`, `LocalService`, or `NetworkService` account, a service principal name (SPN) is generated by default in the form of `host/`\<*hostname*> because those accounts have access to the computer's SPN data.</span></span> <span data-ttu-id="c75f5-113">Jeśli usługa jest uruchomiona przy użyciu innego konta, Windows Communication Foundation (WCF) generuje nazwy UPN w formie \< *username*>@<*domainName* `>` .</span><span class="sxs-lookup"><span data-stu-id="c75f5-113">If the service is running under a different account, Windows Communication Foundation (WCF) generates a UPN in the form of \<*username*>@<*domainName*`>`.</span></span> <span data-ttu-id="c75f5-114">Dzieje się tak, ponieważ wymaga uwierzytelniania Kerberos, należy podać nazwy UPN lub nazwy SPN do klienta do uwierzytelniania usługi.</span><span class="sxs-lookup"><span data-stu-id="c75f5-114">This occurs because Kerberos authentication requires that a UPN or SPN be supplied to the client to authenticate the service.</span></span>  
  
 <span data-ttu-id="c75f5-115">Można także użyć narzędzia Setspn.exe rejestrowania nazwy SPN dodatkowych z kontem usługi w domenie.</span><span class="sxs-lookup"><span data-stu-id="c75f5-115">You can also use the Setspn.exe tool to register an additional SPN with a service's account in a domain.</span></span> <span data-ttu-id="c75f5-116">Można następnie użyć nazwy SPN jako tożsamość usługi.</span><span class="sxs-lookup"><span data-stu-id="c75f5-116">You can then use the SPN as the identity of the service.</span></span> <span data-ttu-id="c75f5-117">Aby pobrać to narzędzie, zobacz [systemu Windows 2000 Resource Kit narzędzie: Setspn.exe](http://go.microsoft.com/fwlink/?LinkId=91752).</span><span class="sxs-lookup"><span data-stu-id="c75f5-117">To download the tool, see [Windows 2000 Resource Kit Tool : Setspn.exe](http://go.microsoft.com/fwlink/?LinkId=91752).</span></span> <span data-ttu-id="c75f5-118">Aby uzyskać więcej informacji o tym narzędziu, zobacz [Omówienie narzędzia Setspn](http://go.microsoft.com/fwlink/?LinkId=61374).</span><span class="sxs-lookup"><span data-stu-id="c75f5-118">For more information about the tool, see [Setspn Overview](http://go.microsoft.com/fwlink/?LinkId=61374).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="c75f5-119">Aby użyć typu poświadczeń systemu Windows bez negocjowania, konto użytkownika usługi musi mieć dostęp do głównej nazwy usługi, które jest zarejestrowane w domenie usługi Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c75f5-119">To use the Windows credential type without negotiation, the service's user account must have access to the SPN that is registered with the Active Directory domain.</span></span> <span data-ttu-id="c75f5-120">Można to zrobić w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="c75f5-120">You can do this in the following ways:</span></span>  
  
-   <span data-ttu-id="c75f5-121">Użyj konta NetworkService lub LocalSystem uruchamiania usługi.</span><span class="sxs-lookup"><span data-stu-id="c75f5-121">Use the NetworkService or LocalSystem account to run your service.</span></span> <span data-ttu-id="c75f5-122">Ponieważ te konta dostępu do komputera, nazwę SPN, który zostanie nawiązane, gdy komputer jest dołączany do domeny usługi Active Directory, usługi WCF automatycznie generuje prawidłowego elementu SPN w punkt końcowy usługi w metadanych usługi (WSDL).</span><span class="sxs-lookup"><span data-stu-id="c75f5-122">Because those accounts have access to the machine SPN that is established when the machine joins the Active Directory domain, WCF automatically generates the proper SPN element inside the service's endpoint in the service's metadata (WSDL).</span></span>  
  
-   <span data-ttu-id="c75f5-123">Użyj dowolnego konta domeny usługi Active Directory do uruchomienia usługi.</span><span class="sxs-lookup"><span data-stu-id="c75f5-123">Use an arbitrary Active Directory domain account to run your service.</span></span> <span data-ttu-id="c75f5-124">W takim przypadku ustanowić nazwę SPN dla tego konta domeny, co można zrobić za pomocą narzędzia Narzędzie Setspn.exe.</span><span class="sxs-lookup"><span data-stu-id="c75f5-124">In this case, establish an SPN for that domain account, which you can do by using the Setspn.exe utility tool.</span></span> <span data-ttu-id="c75f5-125">Po utworzeniu nazwy SPN konta usługi, należy skonfigurować usług WCF do opublikowania tej nazwy SPN do obsługi klientów za pośrednictwem jego metadanych (WSDL).</span><span class="sxs-lookup"><span data-stu-id="c75f5-125">Once you create the SPN for the service's account, configure WCF to publish that SPN to the service's clients through its metadata (WSDL).</span></span> <span data-ttu-id="c75f5-126">Jest to realizowane przez ustawienie tożsamość punktu końcowego dla dostępnego punktu końcowego, albo za pomocą pliku konfiguracji aplikacji lub kodu.</span><span class="sxs-lookup"><span data-stu-id="c75f5-126">This is done by setting the endpoint identity for the exposed endpoint, either through an application configuration file or code.</span></span>  
  
 <span data-ttu-id="c75f5-127">Aby uzyskać więcej informacji na temat nazw SPN, protokołu Kerberos i usługi Active Directory, zobacz [Kerberos techniczne dodatku dla systemu Windows](http://go.microsoft.com/fwlink/?LinkId=88330).</span><span class="sxs-lookup"><span data-stu-id="c75f5-127">For more information about SPNs, the Kerberos protocol, and Active Directory, see [Kerberos Technical Supplement for Windows](http://go.microsoft.com/fwlink/?LinkId=88330).</span></span>  
  
### <a name="when-spn-or-upn-equals-the-empty-string"></a><span data-ttu-id="c75f5-128">Kiedy nazwa SPN i UPN jest równa pusty ciąg</span><span class="sxs-lookup"><span data-stu-id="c75f5-128">When SPN or UPN Equals the Empty String</span></span>  
 <span data-ttu-id="c75f5-129">Jeśli jest ustawiony SPN i UPN na pusty ciąg, liczbę różnych rzeczy wystąpi, w zależności od poziomu i uwierzytelnianie trybu zabezpieczeń używany:</span><span class="sxs-lookup"><span data-stu-id="c75f5-129">If you set the SPN or UPN equal to an empty string, a number of different things happen, depending on the security level and authentication mode being used:</span></span>  
  
-   <span data-ttu-id="c75f5-130">Jeśli używane są zabezpieczenia na poziomie transportu, jest wybierany uwierzytelniania LanMan NT (NTLM).</span><span class="sxs-lookup"><span data-stu-id="c75f5-130">If you are using transport level security, NT LanMan (NTLM) authentication is chosen.</span></span>  
  
-   <span data-ttu-id="c75f5-131">Jeśli korzystasz z zabezpieczeniami na poziomie wiadomości, uwierzytelnianie może zakończyć się niepowodzeniem, w zależności od trybu uwierzytelniania:</span><span class="sxs-lookup"><span data-stu-id="c75f5-131">If you are using message level security, authentication may fail, depending on the authentication mode:</span></span>  
  
-   <span data-ttu-id="c75f5-132">Jeśli używasz `spnego` tryb i `AllowNtlm` atrybut ma ustawioną `false`, niepowodzenie uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="c75f5-132">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `false`, authentication fail.</span></span>  
  
-   <span data-ttu-id="c75f5-133">Jeśli używasz `spnego` tryb i `AllowNtlm` atrybut ma ustawioną `true`, uwierzytelnianie nie powiedzie się, jeśli nazwa UPN jest pusty, ale zakończy się pomyślnie, jeśli nazwa SPN jest pusta.</span><span class="sxs-lookup"><span data-stu-id="c75f5-133">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `true`, authentication fails if the UPN is empty, but succeeds if the SPN is empty.</span></span>  
  
-   <span data-ttu-id="c75f5-134">Jeśli używasz protokołu Kerberos bezpośrednio (znanej także jako "jednorazowej"), uwierzytelnianie nie powiedzie się.</span><span class="sxs-lookup"><span data-stu-id="c75f5-134">If you are using Kerberos direct (also known as "one-shot"), authentication fails.</span></span>  
  
### <a name="using-the-identity-element-in-configuration"></a><span data-ttu-id="c75f5-135">Przy użyciu \<tożsamości > Element w konfiguracji</span><span class="sxs-lookup"><span data-stu-id="c75f5-135">Using the \<identity> Element in Configuration</span></span>  
 <span data-ttu-id="c75f5-136">Jeśli zmienisz typ poświadczeń klienta w powiązaniu pokazano wcześniej certyfikatem`,` wygenerowanego WSDL zawiera seryjnych Base64 certyfikatu X.509 do wartości tożsamości, jak pokazano w poniższym kodzie.</span><span class="sxs-lookup"><span data-stu-id="c75f5-136">If you change the client credential type in the binding previously shown to Certificate`,` then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code.</span></span> <span data-ttu-id="c75f5-137">Jest to wartość domyślna dla wszystkich typów poświadczeń klienta innych niż Windows.</span><span class="sxs-lookup"><span data-stu-id="c75f5-137">This is the default for all client credential types other than Windows.</span></span>  
  
  
  
 <span data-ttu-id="c75f5-138">Możesz zmienić wartość domyślną tożsamość usługi lub zmień typ tożsamości za pomocą <`identity`> element w konfiguracji lub ustawiając tożsamość w kodzie.</span><span class="sxs-lookup"><span data-stu-id="c75f5-138">You can change the value of the default service identity or change the type of the identity by using the <`identity`> element in configuration or by setting the identity in code.</span></span> <span data-ttu-id="c75f5-139">Poniższy kod konfiguracji ustawia tożsamość systemu (nazw domen DNS) nazwy domeny, z wartością `contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="c75f5-139">The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`.</span></span>  
  
  
  
### <a name="setting-identity-programmatically"></a><span data-ttu-id="c75f5-140">Ustawienie programowo tożsamości</span><span class="sxs-lookup"><span data-stu-id="c75f5-140">Setting Identity Programmatically</span></span>  
 <span data-ttu-id="c75f5-141">Usługi nie trzeba jawnie określić tożsamości, ponieważ automatycznie określa WCF.</span><span class="sxs-lookup"><span data-stu-id="c75f5-141">Your service does not have to explicitly specify an identity, because WCF automatically determines it.</span></span> <span data-ttu-id="c75f5-142">Jednak WCF można określić tożsamości dla punktu końcowego, jeśli jest to wymagane.</span><span class="sxs-lookup"><span data-stu-id="c75f5-142">However, WCF allows you to specify an identity on an endpoint, if required.</span></span> <span data-ttu-id="c75f5-143">Poniższy kod dodaje nowy punkt końcowy usługi o określonej tożsamości DNS.</span><span class="sxs-lookup"><span data-stu-id="c75f5-143">The following code adds a new service endpoint with a specific DNS identity.</span></span>  
  
 [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]
 [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  
  
## <a name="see-also"></a><span data-ttu-id="c75f5-144">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="c75f5-144">See Also</span></span>  
 [<span data-ttu-id="c75f5-145">Instrukcje: tworzenie niestandardowego weryfikatora tożsamości klienta</span><span class="sxs-lookup"><span data-stu-id="c75f5-145">How to: Create a Custom Client Identity Verifier</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md)  
 [<span data-ttu-id="c75f5-146">Uwierzytelnianie i tożsamość usług</span><span class="sxs-lookup"><span data-stu-id="c75f5-146">Service Identity and Authentication</span></span>](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)
