---
title: 'Instrukcje: używanie osobnych certyfikatów X.509 do podpisywania i szyfrowania'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, extensibility
- ClientCredentials class
- ClientCredentialsSecurityTokenManager class
ms.assetid: 0b06ce4e-7835-4d82-8baf-d525c71a0e49
ms.openlocfilehash: e464aff46f311ede1cd629fb459ade9a6e627d59
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 09/07/2019
ms.locfileid: "70796958"
---
# <a name="how-to-use-separate-x509-certificates-for-signing-and-encryption"></a><span data-ttu-id="f94f3-102">Instrukcje: używanie osobnych certyfikatów X.509 do podpisywania i szyfrowania</span><span class="sxs-lookup"><span data-stu-id="f94f3-102">How to: Use Separate X.509 Certificates for Signing and Encryption</span></span>

<span data-ttu-id="f94f3-103">W tym temacie opisano sposób konfigurowania Windows Communication Foundation (WCF) do używania różnych certyfikatów do podpisywania i szyfrowania wiadomości na kliencie i w usłudze.</span><span class="sxs-lookup"><span data-stu-id="f94f3-103">This topic shows how to configure Windows Communication Foundation (WCF) to use different certificates for message signing and encryption on both the client and service.</span></span>

<span data-ttu-id="f94f3-104">Aby umożliwić używanie oddzielnych certyfikatów do podpisywania i szyfrowania, należy utworzyć niestandardowe poświadczenia klienta lub usługi (lub oba), ponieważ usługa WCF nie udostępnia interfejsu API do ustawiania wielu certyfikatów klienta lub usługi.</span><span class="sxs-lookup"><span data-stu-id="f94f3-104">To enable separate certificates to be used for signing and encryption, a custom client or service credentials (or both) must be created because WCF does not provide an API to set multiple client or service certificates.</span></span> <span data-ttu-id="f94f3-105">Ponadto należy podać Menedżera tokenów zabezpieczających, aby wykorzystać informacje o wielu certyfikatach i utworzyć odpowiedniego dostawcę tokenów zabezpieczających dla określonego użycia klucza i kierunku komunikatów.</span><span class="sxs-lookup"><span data-stu-id="f94f3-105">Additionally, a security token manager must be provided to leverage the multiple certificates' information and to create an appropriate security token provider for specified key usage and message direction.</span></span>

<span data-ttu-id="f94f3-106">Na poniższym diagramie przedstawiono główne klasy używane, klasy, z których dziedziczą (pokazane przez strzałkę w górę) i typy zwracane niektórych metod i właściwości.</span><span class="sxs-lookup"><span data-stu-id="f94f3-106">The following diagram shows the main classes used, the classes they inherit from (shown by an upward-pointing arrow), and the return types of certain methods and properties.</span></span>

- <span data-ttu-id="f94f3-107">`MyClientCredentials`jest implementacją <xref:System.ServiceModel.Description.ClientCredentials>niestandardową.</span><span class="sxs-lookup"><span data-stu-id="f94f3-107">`MyClientCredentials` is a custom implementation of <xref:System.ServiceModel.Description.ClientCredentials>.</span></span>

  - <span data-ttu-id="f94f3-108">Jego właściwości wyświetlane na diagramie zwracają wystąpienia elementu <xref:System.Security.Cryptography.X509Certificates.X509Certificate2>.</span><span class="sxs-lookup"><span data-stu-id="f94f3-108">Its properties shown in the diagram all return instances of <xref:System.Security.Cryptography.X509Certificates.X509Certificate2>.</span></span>

  - <span data-ttu-id="f94f3-109">Jego Metoda <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> zwraca wystąpienie elementu `MyClientCredentialsSecurityTokenManager`.</span><span class="sxs-lookup"><span data-stu-id="f94f3-109">Its method <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> returns an instance of `MyClientCredentialsSecurityTokenManager`.</span></span>

- <span data-ttu-id="f94f3-110">`MyClientCredentialsSecurityTokenManager`jest implementacją <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>niestandardową.</span><span class="sxs-lookup"><span data-stu-id="f94f3-110">`MyClientCredentialsSecurityTokenManager` is a custom implementation of <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.</span></span>

  - <span data-ttu-id="f94f3-111">Jego Metoda <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> zwraca wystąpienie elementu <xref:System.IdentityModel.Selectors.X509SecurityTokenProvider>.</span><span class="sxs-lookup"><span data-stu-id="f94f3-111">Its method <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> returns an instance of <xref:System.IdentityModel.Selectors.X509SecurityTokenProvider>.</span></span>

<span data-ttu-id="f94f3-112">![Wykres przedstawiający sposób użycia poświadczeń klienta](./media/e4971edd-a59f-4571-b36f-7e6b2f0d610f.gif "e4971edd-a59f-4571-b36f-7e6b2f0d610f")</span><span class="sxs-lookup"><span data-stu-id="f94f3-112">![Chart showing how client credentials are used](./media/e4971edd-a59f-4571-b36f-7e6b2f0d610f.gif "e4971edd-a59f-4571-b36f-7e6b2f0d610f")</span></span>

<span data-ttu-id="f94f3-113">Aby uzyskać więcej informacji o poświadczeniach niestandardowych [, zobacz Przewodnik: Tworzenie niestandardowych poświadczeń](walkthrough-creating-custom-client-and-service-credentials.md)klienta i usługi.</span><span class="sxs-lookup"><span data-stu-id="f94f3-113">For more information about custom credentials, see [Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md).</span></span>

<span data-ttu-id="f94f3-114">Ponadto należy utworzyć niestandardowego weryfikatora tożsamości i połączyć go z elementem powiązania zabezpieczeń w niestandardowym powiązaniu.</span><span class="sxs-lookup"><span data-stu-id="f94f3-114">In addition, you must create a custom identity verifier, and link it to a security binding element in a custom binding.</span></span> <span data-ttu-id="f94f3-115">Należy również użyć niestandardowych poświadczeń zamiast poświadczeń domyślnych.</span><span class="sxs-lookup"><span data-stu-id="f94f3-115">You must also use the custom credentials instead of the default credentials.</span></span>

<span data-ttu-id="f94f3-116">Na poniższym diagramie przedstawiono klasy powiązane z powiązaniem niestandardowym oraz sposób powiązania niestandardowego weryfikatora tożsamości.</span><span class="sxs-lookup"><span data-stu-id="f94f3-116">The following diagram shows the classes involved in the custom binding, and how the custom identity verifier is linked.</span></span> <span data-ttu-id="f94f3-117">Istnieje kilka elementów powiązania, z których wszystkie dziedziczą <xref:System.ServiceModel.Channels.BindingElement>.</span><span class="sxs-lookup"><span data-stu-id="f94f3-117">There are several binding elements involved, all of which inherit from <xref:System.ServiceModel.Channels.BindingElement>.</span></span> <span data-ttu-id="f94f3-118">Zawiera właściwość, która zwraca wystąpienie `MyIdentityVerifier` , z którego jest dostosowane. <xref:System.ServiceModel.Security.IdentityVerifier> <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> <xref:System.ServiceModel.Channels.LocalClientSecuritySettings></span><span class="sxs-lookup"><span data-stu-id="f94f3-118">The <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> has the <xref:System.ServiceModel.Channels.LocalClientSecuritySettings> property, which returns an instance of <xref:System.ServiceModel.Security.IdentityVerifier>, from which `MyIdentityVerifier` is customized.</span></span>

<span data-ttu-id="f94f3-119">![Wykres przedstawiający niestandardowy element powiązania](./media/dddea4a2-0bb4-4921-9bf4-20d4d82c3da5.gif "dddea4a2-0bb4-4921-9bf4-20d4d82c3da5")</span><span class="sxs-lookup"><span data-stu-id="f94f3-119">![Chart showing a custom binding element](./media/dddea4a2-0bb4-4921-9bf4-20d4d82c3da5.gif "dddea4a2-0bb4-4921-9bf4-20d4d82c3da5")</span></span>

<span data-ttu-id="f94f3-120">Aby uzyskać więcej informacji na temat tworzenia niestandardowego weryfikatora tożsamości, zobacz How to: [Instrukcje: Utwórz niestandardowego weryfikatora](how-to-create-a-custom-client-identity-verifier.md)tożsamości klienta.</span><span class="sxs-lookup"><span data-stu-id="f94f3-120">For more information about creating a custom identity verifier, see How to: [How to: Create a Custom Client Identity Verifier](how-to-create-a-custom-client-identity-verifier.md).</span></span>

### <a name="to-use-separate-certificates-for-signing-and-encryption"></a><span data-ttu-id="f94f3-121">Aby używać oddzielnych certyfikatów do podpisywania i szyfrowania</span><span class="sxs-lookup"><span data-stu-id="f94f3-121">To use separate certificates for signing and encryption</span></span>

1. <span data-ttu-id="f94f3-122">Zdefiniuj nową klasę poświadczeń klienta, która dziedziczy z <xref:System.ServiceModel.Description.ClientCredentials> klasy.</span><span class="sxs-lookup"><span data-stu-id="f94f3-122">Define a new client credentials class that inherits from the <xref:System.ServiceModel.Description.ClientCredentials> class.</span></span> <span data-ttu-id="f94f3-123">Zaimplementuj cztery nowe właściwości, aby umożliwić określenie wielu `ClientSigningCertificate`certyfikatów `ClientEncryptingCertificate`: `ServiceSigningCertificate`,, `ServiceEncryptingCertificate`i.</span><span class="sxs-lookup"><span data-stu-id="f94f3-123">Implement four new properties to allow multiple certificates specification: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate`, and `ServiceEncryptingCertificate`.</span></span> <span data-ttu-id="f94f3-124">Należy również zastąpić <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> metodę, aby zwrócić wystąpienie dostosowanej <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> klasy zdefiniowanej w następnym kroku.</span><span class="sxs-lookup"><span data-stu-id="f94f3-124">Also override the <xref:System.ServiceModel.Description.ClientCredentials.CreateSecurityTokenManager%2A> method to return an instance of the customized <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> class that is defined in the next step.</span></span>

     [!code-csharp[c_FourCerts#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#1)]
     [!code-vb[c_FourCerts#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#1)]

2. <span data-ttu-id="f94f3-125">Zdefiniuj nowego menedżera tokenów zabezpieczających klienta, który dziedziczy <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> z klasy.</span><span class="sxs-lookup"><span data-stu-id="f94f3-125">Define a new client security token manager that inherits from the <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> class.</span></span> <span data-ttu-id="f94f3-126">Zastąp <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> metodę, aby utworzyć odpowiedniego dostawcę tokenów zabezpieczających.</span><span class="sxs-lookup"><span data-stu-id="f94f3-126">Override the <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> method to create an appropriate security token provider.</span></span> <span data-ttu-id="f94f3-127">Parametr (a <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>) zawiera kierunek wiadomości i użycie klucza. `requirement`</span><span class="sxs-lookup"><span data-stu-id="f94f3-127">The `requirement` parameter (a <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>) provides the message direction and key usage.</span></span>

     [!code-csharp[c_FourCerts#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#2)]
     [!code-vb[c_FourCerts#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#2)]

3. <span data-ttu-id="f94f3-128">Zdefiniuj nową klasę poświadczeń usługi, która dziedziczy z <xref:System.ServiceModel.Description.ServiceCredentials> klasy.</span><span class="sxs-lookup"><span data-stu-id="f94f3-128">Define a new service credentials class that inherits from the <xref:System.ServiceModel.Description.ServiceCredentials> class.</span></span> <span data-ttu-id="f94f3-129">Zaimplementuj cztery nowe właściwości, aby umożliwić określenie wielu `ClientSigningCertificate`certyfikatów `ClientEncryptingCertificate`: `ServiceSigningCertificate`,, `ServiceEncryptingCertificate`i.</span><span class="sxs-lookup"><span data-stu-id="f94f3-129">Implement four new properties to allow multiple certificates specification: `ClientSigningCertificate`, `ClientEncryptingCertificate`, `ServiceSigningCertificate`, and `ServiceEncryptingCertificate`.</span></span> <span data-ttu-id="f94f3-130">Należy również zastąpić <xref:System.ServiceModel.Description.ServiceCredentials.CreateSecurityTokenManager%2A> metodę, aby zwrócić wystąpienie dostosowanej <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> klasy zdefiniowanej w następnym kroku.</span><span class="sxs-lookup"><span data-stu-id="f94f3-130">Also override the <xref:System.ServiceModel.Description.ServiceCredentials.CreateSecurityTokenManager%2A> method to return an instance of the customized <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class that is defined in the next step.</span></span>

     [!code-csharp[c_FourCerts#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#3)]
     [!code-vb[c_FourCerts#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#3)]

4. <span data-ttu-id="f94f3-131">Zdefiniuj nowego menedżera tokenów zabezpieczeń usługi, który dziedziczy z <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> klasy.</span><span class="sxs-lookup"><span data-stu-id="f94f3-131">Define a new service security token manager that inherits from the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class.</span></span> <span data-ttu-id="f94f3-132">Zastąp <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> metodę w celu utworzenia odpowiedniego dostawcy tokenów zabezpieczających, który ma przekazany kierunek komunikatu i użycie klucza.</span><span class="sxs-lookup"><span data-stu-id="f94f3-132">Override the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager.CreateSecurityTokenProvider%2A> method to create an appropriate security token provider given the passed-in message direction and key usage.</span></span>

     [!code-csharp[c_FourCerts#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#4)]
     [!code-vb[c_FourCerts#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#4)]

### <a name="to-use-multiple-certificates-on-the-client"></a><span data-ttu-id="f94f3-133">Aby użyć wielu certyfikatów na kliencie</span><span class="sxs-lookup"><span data-stu-id="f94f3-133">To use multiple certificates on the client</span></span>

1. <span data-ttu-id="f94f3-134">Tworzenie niestandardowego powiązania.</span><span class="sxs-lookup"><span data-stu-id="f94f3-134">Create a custom binding.</span></span> <span data-ttu-id="f94f3-135">Element powiązania zabezpieczeń musi działać w trybie dupleksu, aby zezwolić na obecność różnych dostawców tokenów zabezpieczających dla żądań i odpowiedzi.</span><span class="sxs-lookup"><span data-stu-id="f94f3-135">The security binding element must operate in duplex mode to allow different security token providers to be present for requests and responses.</span></span> <span data-ttu-id="f94f3-136">Jednym ze sposobów jest użycie transportu z obsługą dupleksu lub użycie <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> , jak pokazano w poniższym kodzie.</span><span class="sxs-lookup"><span data-stu-id="f94f3-136">One way to do this is to use a duplex-capable transport or to use the <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> as shown in the following code.</span></span> <span data-ttu-id="f94f3-137">Połącz dostosowany <xref:System.ServiceModel.Security.IdentityVerifier> element, który jest zdefiniowany w następnym kroku do elementu powiązania zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="f94f3-137">Link the customized <xref:System.ServiceModel.Security.IdentityVerifier> which is defined in the next step to the security binding element.</span></span> <span data-ttu-id="f94f3-138">Zastąp domyślne poświadczenia klienta przy użyciu niestandardowych poświadczeń klienta, które zostały wcześniej utworzone.</span><span class="sxs-lookup"><span data-stu-id="f94f3-138">Replace the default client credentials with the customized client credentials previously created.</span></span>

     [!code-csharp[c_FourCerts#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#5)]
     [!code-vb[c_FourCerts#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#5)]

2. <span data-ttu-id="f94f3-139">Zdefiniuj niestandardową <xref:System.ServiceModel.Security.IdentityVerifier>.</span><span class="sxs-lookup"><span data-stu-id="f94f3-139">Define a custom <xref:System.ServiceModel.Security.IdentityVerifier>.</span></span> <span data-ttu-id="f94f3-140">Usługa ma wiele tożsamości, ponieważ do szyfrowania żądania służą różne certyfikaty i podpisanie odpowiedzi.</span><span class="sxs-lookup"><span data-stu-id="f94f3-140">The service has multiple identities because different certificates are used to encrypt the request and to sign the response.</span></span>

    > [!NOTE]
    > <span data-ttu-id="f94f3-141">W poniższym przykładzie dostarczony niestandardowy weryfikator tożsamości nie sprawdza tożsamości punktu końcowego w celach demonstracyjnych.</span><span class="sxs-lookup"><span data-stu-id="f94f3-141">In the following sample, the provided custom identity verifier does not perform any endpoint identity checking for demonstration purposes.</span></span> <span data-ttu-id="f94f3-142">Nie jest to zalecane rozwiązanie w przypadku kodu produkcyjnego.</span><span class="sxs-lookup"><span data-stu-id="f94f3-142">This is not recommended practice for production code.</span></span>

     [!code-csharp[c_FourCerts#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#6)]
     [!code-vb[c_FourCerts#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#6)]

### <a name="to-use-multiple-certificates-on-the-service"></a><span data-ttu-id="f94f3-143">Aby użyć wielu certyfikatów w usłudze</span><span class="sxs-lookup"><span data-stu-id="f94f3-143">To use multiple certificates on the service</span></span>

1. <span data-ttu-id="f94f3-144">Tworzenie niestandardowego powiązania.</span><span class="sxs-lookup"><span data-stu-id="f94f3-144">Create a custom binding.</span></span> <span data-ttu-id="f94f3-145">Element powiązania zabezpieczeń musi działać w trybie dupleksu, aby zezwolić na obecność różnych dostawców tokenów zabezpieczających dla żądań i odpowiedzi.</span><span class="sxs-lookup"><span data-stu-id="f94f3-145">The security binding element must operate in a duplex mode to allow different security token providers to be present for requests and responses.</span></span> <span data-ttu-id="f94f3-146">Podobnie jak w przypadku klienta należy użyć transportu z obsługą dupleksu <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> lub użyć, jak pokazano w poniższym kodzie.</span><span class="sxs-lookup"><span data-stu-id="f94f3-146">As with the client, use a duplex-capable transport or use <xref:System.ServiceModel.Channels.CompositeDuplexBindingElement> as shown in the following code.</span></span> <span data-ttu-id="f94f3-147">Zastąp domyślne poświadczenia usługi przy użyciu wcześniej utworzonych poświadczeń usługi.</span><span class="sxs-lookup"><span data-stu-id="f94f3-147">Replace the default service credentials with the customized service credentials previously created.</span></span>

     [!code-csharp[c_FourCerts#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_fourcerts/cs/source.cs#7)]
     [!code-vb[c_FourCerts#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_fourcerts/vb/source.vb#7)]

## <a name="see-also"></a><span data-ttu-id="f94f3-148">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="f94f3-148">See also</span></span>

- <xref:System.ServiceModel.Description.ClientCredentials>
- <xref:System.ServiceModel.Description.ServiceCredentials>
- <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>
- <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager>
- <xref:System.ServiceModel.Security.IdentityVerifier>
- [<span data-ttu-id="f94f3-149">Przewodnik: Tworzenie niestandardowych poświadczeń klienta i usługi</span><span class="sxs-lookup"><span data-stu-id="f94f3-149">Walkthrough: Creating Custom Client and Service Credentials</span></span>](walkthrough-creating-custom-client-and-service-credentials.md)
