---
title: 'Porady: tworzenie wystawcy uwierzytelniania tokenu zabezpieczeń niestandardowych'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
ms.assetid: 10e245f7-d31e-42e7-82a2-d5780325d372
author: BrucePerlerMS
manager: mbaldwin
ms.openlocfilehash: 8cbc22be68aae976e939520383995652e896d529
ms.sourcegitcommit: 76a304c79a32aa13889ebcf4b9789a4542b48e3e
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 09/13/2018
ms.locfileid: "45507774"
---
# <a name="how-to-create-a-custom-security-token-authenticator"></a><span data-ttu-id="ac2f1-102">Porady: tworzenie wystawcy uwierzytelniania tokenu zabezpieczeń niestandardowych</span><span class="sxs-lookup"><span data-stu-id="ac2f1-102">How to: create a custom security token authenticator</span></span>
<span data-ttu-id="ac2f1-103">W tym temacie przedstawiono sposób tworzenia wystawcy uwierzytelniania tokenu zabezpieczeń niestandardowych oraz zintegrować ją z usługą Menedżer tokenów zabezpieczeń niestandardowych.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-103">This topic shows how to create a custom security token authenticator and how to integrate it with a custom security token manager.</span></span> <span data-ttu-id="ac2f1-104">Wystawcy uwierzytelniania tokenu zabezpieczeń sprawdza poprawność zawartości tokenu zabezpieczającego z dołączonym wiadomości przychodzącej.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-104">A security token authenticator validates the content of a security token provided with an incoming message.</span></span> <span data-ttu-id="ac2f1-105">Jeśli weryfikacja zakończy się powodzeniem, wystawcy uwierzytelnienia zwraca kolekcję <xref:System.IdentityModel.Policy.IAuthorizationPolicy> wystąpień, gdy obliczane, zwracany jest zestaw oświadczeń.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-105">If the validation succeeds, the authenticator returns a collection of <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instances that, when evaluated, returns a set of claims.</span></span>  
  
 <span data-ttu-id="ac2f1-106">Aby użyć wystawcy uwierzytelniania tokenu zabezpieczeń niestandardowych w Windows Communication Foundation (WCF), należy najpierw utworzyć niestandardowe poświadczenia i zabezpieczeń implementacje Menedżer tokenów.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-106">To use a custom security token authenticator in Windows Communication Foundation (WCF), you must first create custom credentials and security token manager implementations.</span></span> <span data-ttu-id="ac2f1-107">Aby uzyskać więcej informacji na temat tworzenia niestandardowych poświadczeń i zabezpieczeń Menedżer tokenów zobacz [wskazówki: Tworzenie niestandardowego klienta i poświadczeń usługi](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="ac2f1-107">For more information about creating custom credentials and a security token manager, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span></span> <span data-ttu-id="ac2f1-108">Aby uzyskać więcej informacji na temat klasy dostawcy i wystawcy uwierzytelnienia poświadczeń, Menedżer tokenów zabezpieczeń i zobacz [architekturę zabezpieczeń](https://msdn.microsoft.com/library/16593476-d36a-408d-808c-ae6fd483e28f).</span><span class="sxs-lookup"><span data-stu-id="ac2f1-108">For more information about credentials, security token manager, and provider and authenticator classes, see [Security Architecture](https://msdn.microsoft.com/library/16593476-d36a-408d-808c-ae6fd483e28f).</span></span>  
  
## <a name="procedures"></a><span data-ttu-id="ac2f1-109">Procedury</span><span class="sxs-lookup"><span data-stu-id="ac2f1-109">Procedures</span></span>  
  
#### <a name="to-create-a-custom-security-token-authenticator"></a><span data-ttu-id="ac2f1-110">Aby utworzyć wystawcy uwierzytelniania tokenu zabezpieczeń niestandardowych</span><span class="sxs-lookup"><span data-stu-id="ac2f1-110">To create a custom security token authenticator</span></span>  
  
1.  <span data-ttu-id="ac2f1-111">Zdefiniuj nową klasę pochodną <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> klasy.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-111">Define a new class derived from the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> class.</span></span>  
  
2.  <span data-ttu-id="ac2f1-112">Zastąp <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateTokenCore%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-112">Override the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateTokenCore%2A> method.</span></span> <span data-ttu-id="ac2f1-113">Metoda ta zwraca `true` lub `false` w zależności od tego, czy niestandardowe wystawcy uwierzytelnienia można sprawdzić poprawność przychodzącego tokenu typu lub nie.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-113">The method returns `true` or `false` depending on whether the custom authenticator can validate the incoming token type or not.</span></span>  
  
3.  <span data-ttu-id="ac2f1-114">Zastąp <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-114">Override the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> method.</span></span> <span data-ttu-id="ac2f1-115">Ta metoda musi sprawdzić zawartość tokenów, odpowiednio.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-115">This method needs to validate the token contents appropriately.</span></span> <span data-ttu-id="ac2f1-116">Jeśli token przechodzi do kroku weryfikacji, zwraca kolekcję <xref:System.IdentityModel.Policy.IAuthorizationPolicy> wystąpień.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-116">If the token passes the validation step, it returns a collection of <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instances.</span></span> <span data-ttu-id="ac2f1-117">W poniższym przykładzie użyto implementację zasad autoryzacja niestandardowa, która zostanie utworzona w następnej procedurze.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-117">The following example uses a custom authorization policy implementation that will be created in the next procedure.</span></span>  
  
     [!code-csharp[C_CustomTokenAuthenticator#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#1)]
     [!code-vb[C_CustomTokenAuthenticator#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#1)]  
  
 <span data-ttu-id="ac2f1-118">Powyższy kod zwraca kolekcję obiektów zasad autoryzacji w <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateToken%28System.IdentityModel.Tokens.SecurityToken%29> metody.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-118">The previous code returns a collection of authorization policies in the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateToken%28System.IdentityModel.Tokens.SecurityToken%29> method.</span></span> <span data-ttu-id="ac2f1-119">Usługi WCF nie udostępnia publiczne implementację tego interfejsu.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-119">WCF does not provide a public implementation of this interface.</span></span> <span data-ttu-id="ac2f1-120">Poniższa procedura pokazuje, jak to zrobić dla własnych wymagań.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-120">The following procedure shows how to do so for your own requirements.</span></span>  
  
#### <a name="to-create-a-custom-authorization-policy"></a><span data-ttu-id="ac2f1-121">Do utworzenia niestandardowych zasad autoryzacji</span><span class="sxs-lookup"><span data-stu-id="ac2f1-121">To create a custom authorization policy</span></span>  
  
1.  <span data-ttu-id="ac2f1-122">Definiowanie, wdrażanie nowej klasy <xref:System.IdentityModel.Policy.IAuthorizationPolicy> interfejsu.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-122">Define a new class implementing the <xref:System.IdentityModel.Policy.IAuthorizationPolicy> interface.</span></span>  
  
2.  <span data-ttu-id="ac2f1-123">Implementowanie <xref:System.IdentityModel.Policy.IAuthorizationComponent.Id%2A> właściwość tylko do odczytu.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-123">Implement the <xref:System.IdentityModel.Policy.IAuthorizationComponent.Id%2A> read-only property.</span></span> <span data-ttu-id="ac2f1-124">Jednym ze sposobów zaimplementowania tej właściwości jest wygenerować unikatowy identyfikator globalny (GUID) w konstruktorze klasy i przywrócić go za każdym razem, gdy wartość tej właściwości jest wymagane.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-124">One way to implement this property is to generate a globally unique identifier (GUID) in the class constructor and return it every time the value for this property is requested.</span></span>  
  
3.  <span data-ttu-id="ac2f1-125">Implementowanie <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Issuer%2A> właściwość tylko do odczytu.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-125">Implement the <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Issuer%2A> read-only property.</span></span> <span data-ttu-id="ac2f1-126">Ta właściwość musi zwracać wystawcy zestawów oświadczeń, które są uzyskiwane z tokenu.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-126">This property needs to return an issuer of the claim sets that are obtained from the token.</span></span> <span data-ttu-id="ac2f1-127">Wystawca tokenu lub urząd który jest odpowiedzialny za sprawdzanie poprawności zawartości tokenu powinna odpowiadać tym wystawcą.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-127">This issuer should correspond to the issuer of the token or an authority that is responsible for validating the token contents.</span></span> <span data-ttu-id="ac2f1-128">W poniższym przykładzie użyto wystawcy oświadczenia, które przekazane do tej klasy z niestandardowego wystawcy uwierzytelniania tokenu zabezpieczeń utworzone w poprzedniej procedurze.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-128">The following example uses the issuer claim that passed to this class from the custom security token authenticator created in the previous procedure.</span></span> <span data-ttu-id="ac2f1-129">Wystawcy uwierzytelniania tokenu zabezpieczeń niestandardowych używa zestawu oświadczeń dostarczane przez system (zwrócone przez <xref:System.IdentityModel.Claims.ClaimSet.System%2A> właściwość) do reprezentowania wystawca token nazwy użytkownika.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-129">The custom security token authenticator uses the system-provided claim set (returned by the <xref:System.IdentityModel.Claims.ClaimSet.System%2A> property) to represent the issuer of the username token.</span></span>  
  
4.  <span data-ttu-id="ac2f1-130">Implementowanie <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-130">Implement the <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A> method.</span></span> <span data-ttu-id="ac2f1-131">Ta metoda wypełni wystąpienie <xref:System.IdentityModel.Policy.EvaluationContext> klasy (przekazanego jako argument) przy użyciu oświadczeń, które są oparte na przychodzące zawartości tokenu zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-131">This method populates an instance of the <xref:System.IdentityModel.Policy.EvaluationContext> class (passed in as an argument) with claims that are based on the incoming security token content.</span></span> <span data-ttu-id="ac2f1-132">Metoda ta zwraca `true` po zakończeniu z oceną.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-132">The method returns `true` when it is done with the evaluation.</span></span> <span data-ttu-id="ac2f1-133">W przypadkach, gdy implementacja zależy od obecności innych zasad autoryzacji, które udostępniają dodatkowe informacje na kontekst oceny tej metody może zwrócić `false` Jeśli nie ma wymaganych informacji jeszcze w kontekście oceny.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-133">In cases when the implementation relies on the presence of other authorization policies that provide additional information to the evaluation context, this method can return `false` if the required information is not present yet in the evaluation context.</span></span> <span data-ttu-id="ac2f1-134">W takim przypadku WCF będzie wywoływać metody ponownie po przeprowadzeniu oceny innych zasad autoryzacji wygenerowany dla komunikatu przychodzącego, jeśli co najmniej jeden z tych zasad autoryzacji zmodyfikowany kontekst oceny.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-134">In that case, WCF will call the method again after evaluating all other authorization policies generated for the incoming message if at least one of those authorization policies modified the evaluation context.</span></span>  
  
     [!code-csharp[c_CustomTokenAuthenticator#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#3)]
     [!code-vb[c_CustomTokenAuthenticator#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#3)]  

 <span data-ttu-id="ac2f1-135">[Wskazówki: Tworzenie niestandardowego klienta i poświadczeń usługi](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md) zawiera opis sposobu tworzenia niestandardowych poświadczeń i niestandardowe zabezpieczeń Menedżer tokenów.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-135">[Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md) describes how to create custom credentials and a custom security token manager.</span></span> <span data-ttu-id="ac2f1-136">Aby użyć niestandardowego wystawcy uwierzytelniania tokenu zabezpieczeń utworzone, w tym miejscu implementację Menedżer tokenów zabezpieczeń zostanie zmodyfikowany na potrzeby zwracają niestandardowych aplikacji authenticator z <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-136">To use the custom security token authenticator created here, an implementation of the security token manager is modified to return the custom authenticator from the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method.</span></span> <span data-ttu-id="ac2f1-137">Metoda zwraca wystawcy uwierzytelnienia, gdy wymóg tokenu zabezpieczeń odpowiednich jest przekazywany w.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-137">The method returns an authenticator when an appropriate security token requirement is passed in.</span></span>  
  
#### <a name="to-integrate-a-custom-security-token-authenticator-with-a-custom-security-token-manager"></a><span data-ttu-id="ac2f1-138">Aby zintegrować wystawcy uwierzytelniania tokenu zabezpieczeń niestandardowych z Menedżer tokenów zabezpieczeń niestandardowe</span><span class="sxs-lookup"><span data-stu-id="ac2f1-138">To integrate a custom security token authenticator with a custom security token manager</span></span>  
  
1.  <span data-ttu-id="ac2f1-139">Zastąp <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> metody w danej implementacji Menedżer tokenów zabezpieczeń niestandardowych.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-139">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method in your custom security token manager implementation.</span></span>  
  
2.  <span data-ttu-id="ac2f1-140">Dodaj logikę do metody, aby umożliwić zwracają Twojego niestandardowego wystawcy uwierzytelniania tokenu zabezpieczeń na podstawie <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> parametru.</span><span class="sxs-lookup"><span data-stu-id="ac2f1-140">Add logic to the method to enable it to return your custom security token authenticator based on the <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> parameter.</span></span> <span data-ttu-id="ac2f1-141">Poniższy przykład zwraca wystawcy uwierzytelniania tokenu zabezpieczeń niestandardowych, jeśli typ tokenu wymagania tokenu jest nazwą użytkownika (reprezentowane przez <xref:System.IdentityModel.Tokens.SecurityTokenTypes.UserName%2A> właściwości) i danych wejściowych (kierunek wiadomości, dla którego wnioskuje się wystawcy uwierzytelniania tokenu zabezpieczeń reprezentowane przez <xref:System.ServiceModel.Description.MessageDirection.Input> pola).</span><span class="sxs-lookup"><span data-stu-id="ac2f1-141">The following example returns a custom security token authenticator if the token requirements token type is a user name (represented by the <xref:System.IdentityModel.Tokens.SecurityTokenTypes.UserName%2A> property) and the message direction for which the security token authenticator is being requested is input (represented by the <xref:System.ServiceModel.Description.MessageDirection.Input> field).</span></span>  
  
     [!code-csharp[c_CustomTokenAuthenticator#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#2)]
     [!code-vb[c_CustomTokenAuthenticator#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#2)]  
 
## <a name="see-also"></a><span data-ttu-id="ac2f1-142">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="ac2f1-142">See also</span></span>  
 <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator>  
 <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>  
 <xref:System.IdentityModel.Selectors.SecurityTokenManager>  
 <xref:System.IdentityModel.Tokens.UserNameSecurityToken>  
 [<span data-ttu-id="ac2f1-143">Przewodnik: tworzenie niestandardowego klienta i poświadczeń usługi</span><span class="sxs-lookup"><span data-stu-id="ac2f1-143">Walkthrough: Creating Custom Client and Service Credentials</span></span>](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md)  
 [<span data-ttu-id="ac2f1-144">Instrukcje: tworzenie niestandardowego dostawcy tokenów zabezpieczeń</span><span class="sxs-lookup"><span data-stu-id="ac2f1-144">How to: Create a Custom Security Token Provider</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)  
 [<span data-ttu-id="ac2f1-145">Architektura zabezpieczeń</span><span class="sxs-lookup"><span data-stu-id="ac2f1-145">Security Architecture</span></span>](https://msdn.microsoft.com/library/16593476-d36a-408d-808c-ae6fd483e28f)
