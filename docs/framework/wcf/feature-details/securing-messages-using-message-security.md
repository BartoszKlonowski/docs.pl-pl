---
title: Korzystanie z zabezpieczeń komunikatów
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: a17ebe67-836b-4c52-9a81-2c3d58e225ee
caps.latest.revision: 16
author: BrucePerlerMS
ms.author: bruceper
manager: mbaldwin
ms.workload:
- dotnet
ms.openlocfilehash: be9d55e508308f23e70be81ac0d4fe0dfd0ea9cd
ms.sourcegitcommit: 03ee570f6f528a7d23a4221dcb26a9498edbdf8c
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/28/2018
---
# <a name="securing-messages-using-message-security"></a><span data-ttu-id="3cf86-102">Korzystanie z zabezpieczeń komunikatów</span><span class="sxs-lookup"><span data-stu-id="3cf86-102">Securing Messages Using Message Security</span></span>
<span data-ttu-id="3cf86-103">W tej sekcji omówiono [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] zabezpieczenia wiadomości, korzystając z <xref:System.ServiceModel.NetMsmqBinding>.</span><span class="sxs-lookup"><span data-stu-id="3cf86-103">This section discusses [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] message security when using <xref:System.ServiceModel.NetMsmqBinding>.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="3cf86-104">Przed przeczytaniem za pośrednictwem tego tematu, zaleca się przeczytanie [pojęcia dotyczące zabezpieczeń](../../../../docs/framework/wcf/feature-details/security-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="3cf86-104">Before reading through this topic, it is recommended that you read [Security Concepts](../../../../docs/framework/wcf/feature-details/security-concepts.md).</span></span>  
  
 <span data-ttu-id="3cf86-105">Następująca ilustracja przedstawia model koncepcyjny umieszczonych w kolejce komunikacji przy użyciu [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].</span><span class="sxs-lookup"><span data-stu-id="3cf86-105">The following illustration provides a conceptual model of queued communication using [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].</span></span> <span data-ttu-id="3cf86-106">Ta ilustracja i terminologia służą do wyjaśnienia</span><span class="sxs-lookup"><span data-stu-id="3cf86-106">This illustration and terminology are used to explain</span></span>  
  
 <span data-ttu-id="3cf86-107">transport pojęć związanych z zabezpieczeniami.</span><span class="sxs-lookup"><span data-stu-id="3cf86-107">transport security concepts.</span></span>  
  
 <span data-ttu-id="3cf86-108">![Diagram aplikacji w kolejce](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "rozproszonych kolejki — rysunek")</span><span class="sxs-lookup"><span data-stu-id="3cf86-108">![Queued Application Diagram](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "Distributed-Queue-Figure")</span></span>  
  
 <span data-ttu-id="3cf86-109">Podczas wysyłania wiadomości z kolejki przy użyciu [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] wiadomości jest dołączony jako treść komunikatu usługi kolejkowania komunikatów (MSMQ).</span><span class="sxs-lookup"><span data-stu-id="3cf86-109">When sending queued messages using [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] message is attached as a body of the Message Queuing (MSMQ) message.</span></span> <span data-ttu-id="3cf86-110">Gdy zabezpieczeń transportu zabezpiecza cały MSMQ komunikatu, komunikat (lub SOAP) zabezpieczeń tylko zabezpiecza treści wiadomości MSMQ.</span><span class="sxs-lookup"><span data-stu-id="3cf86-110">While transport security secures the entire MSMQ message, message (or SOAP) security only secures the body of the MSMQ message.</span></span>  
  
 <span data-ttu-id="3cf86-111">Kluczowe pojęcia zabezpieczenia komunikatów jest, czy klient zabezpiecza wiadomości do aplikacji odbierającej (usługa), w przeciwieństwie do zabezpieczeń transportu, w którym klient zabezpiecza wiadomości do kolejki docelowej.</span><span class="sxs-lookup"><span data-stu-id="3cf86-111">The key concept of message security is that the client secures the message for the receiving application (service), unlike transport security where the client secures the message for the Target Queue.</span></span> <span data-ttu-id="3cf86-112">W efekcie MSMQ odgrywa bez części zabezpieczania [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] wiadomości przy użyciu zabezpieczeń wiadomości.</span><span class="sxs-lookup"><span data-stu-id="3cf86-112">As such, MSMQ plays no part when securing the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] message using message security.</span></span>  
  
 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="3cf86-113"> zabezpieczenia komunikatów dodaje nagłówek zabezpieczeń w celu [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] wiadomości, które integrują się z istniejącej infrastruktury zabezpieczeń, takie jak certyfikat lub protokołu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="3cf86-113"> message security adds security headers to the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] message that integrate with existing security infrastructures, such as a certificate or the Kerberos protocol.</span></span>  
  
## <a name="message-credential-type"></a><span data-ttu-id="3cf86-114">Typ poświadczeń komunikatu</span><span class="sxs-lookup"><span data-stu-id="3cf86-114">Message Credential Type</span></span>  
 <span data-ttu-id="3cf86-115">Korzystanie z zabezpieczeń komunikatów, usługa i klient może stanowić poświadczenia umożliwiające uwierzytelnianie w każdym innym.</span><span class="sxs-lookup"><span data-stu-id="3cf86-115">Using message security, the service and client can present credentials to authenticate each another.</span></span> <span data-ttu-id="3cf86-116">Wybierz opcję zabezpieczenia komunikatów przez ustawienie <xref:System.ServiceModel.NetMsmqBinding.Security%2A> tryb `Message` lub `Both` (oznacza to, używają zarówno zabezpieczeń transportu i zabezpieczenia komunikatów).</span><span class="sxs-lookup"><span data-stu-id="3cf86-116">You can select message security by setting the <xref:System.ServiceModel.NetMsmqBinding.Security%2A> mode to `Message` or `Both` (that is, use both transport security and message security).</span></span>  
  
 <span data-ttu-id="3cf86-117">Usługa może wykorzystać <xref:System.ServiceModel.ServiceSecurityContext.Current%2A> właściwości, aby sprawdzić poświadczenia używane do uwierzytelniania klienta.</span><span class="sxs-lookup"><span data-stu-id="3cf86-117">The service can use the <xref:System.ServiceModel.ServiceSecurityContext.Current%2A> property to inspect the credential used to authenticate the client.</span></span> <span data-ttu-id="3cf86-118">To może być również używany dla dalszego sprawdzeń autoryzacji usługa wybierze do zaimplementowania.</span><span class="sxs-lookup"><span data-stu-id="3cf86-118">This can also be used for further authorization checks that the service chooses to implement.</span></span>  
  
 <span data-ttu-id="3cf86-119">W tej sekcji opisano typy różnych poświadczeń i sposób ich użycia w przypadku kolejek.</span><span class="sxs-lookup"><span data-stu-id="3cf86-119">This section explains the different credential types and how to use them with queues.</span></span>  
  
### <a name="certificate"></a><span data-ttu-id="3cf86-120">certyfikat</span><span class="sxs-lookup"><span data-stu-id="3cf86-120">Certificate</span></span>  
 <span data-ttu-id="3cf86-121">Typ poświadczeń certyfikatu używa certyfikatu X.509 do identyfikowania usługi i klienta.</span><span class="sxs-lookup"><span data-stu-id="3cf86-121">The certificate credential type uses an X.509 certificate to identify the service and the client.</span></span>  
  
 <span data-ttu-id="3cf86-122">W typowy scenariusz, klient i usługa są prawidłowy certyfikat wystawiony przez zaufany urząd certyfikacji.</span><span class="sxs-lookup"><span data-stu-id="3cf86-122">In a typical scenario, the client and the service are issued a valid certificate by a trusted certification authority.</span></span> <span data-ttu-id="3cf86-123">Następnie połączenie zostanie nawiązane, klient uwierzytelnia ważności usługi za pomocą certyfikatu usługi można określić, czy można ufać usługi.</span><span class="sxs-lookup"><span data-stu-id="3cf86-123">Then the connection is established, the client authenticates the validity of the service using the service's certificate to decide whether it can trust the service.</span></span> <span data-ttu-id="3cf86-124">Podobnie usługa używa certyfikatu klienta można sprawdzić poprawności zaufania klienta.</span><span class="sxs-lookup"><span data-stu-id="3cf86-124">Similarly, the service uses the client's certificate to validate the client trust.</span></span>  
  
 <span data-ttu-id="3cf86-125">Rozłączona charakter kolejek, klient i usługa nie może być online w tym samym czasie.</span><span class="sxs-lookup"><span data-stu-id="3cf86-125">Given the disconnected nature of queues, the client and the service may not be online at the same time.</span></span> <span data-ttu-id="3cf86-126">Tak klient i usługa trzeba wymienić certyfikaty poza pasmem.</span><span class="sxs-lookup"><span data-stu-id="3cf86-126">As such, the client and service have to exchange certificates out-of-band.</span></span> <span data-ttu-id="3cf86-127">W szczególności klienta, na podstawie przechowywania w magazynie zaufanych certyfikatów usługi, (które można powiązać do urzędu certyfikacji) musi ufać jest podczas komunikacji z usługą poprawne.</span><span class="sxs-lookup"><span data-stu-id="3cf86-127">In particular, the client, by virtue of holding the service's certificate (which can be chained to a certification authority) in its trusted store, must trust that it is communicating with the correct service.</span></span> <span data-ttu-id="3cf86-128">W celu uwierzytelniania klienta, używane przez usługę certyfikatu X.509, dołączone do wiadomości dopasowuje je przy użyciu certyfikatu w magazynie w celu sprawdzenia autentyczności klienta.</span><span class="sxs-lookup"><span data-stu-id="3cf86-128">For authenticating the client, the service uses the X.509 certificate attached with the message to matches it with the certificate in its store to verify the authenticity of the client.</span></span> <span data-ttu-id="3cf86-129">Ponownie certyfikat musi być powiązany łańcuchem zależności urzędu certyfikacji.</span><span class="sxs-lookup"><span data-stu-id="3cf86-129">Again, the certificate must be chained to a certification authority.</span></span>  
  
 <span data-ttu-id="3cf86-130">Na komputerze z systemem Windows certyfikaty są przechowywane w kilku rodzajów magazynów.</span><span class="sxs-lookup"><span data-stu-id="3cf86-130">On a computer running Windows, certificates are held in several kinds of stores.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="3cf86-131"> Zobacz różnych sklepów [magazyny certyfikatów](http://go.microsoft.com/fwlink/?LinkId=87787).</span><span class="sxs-lookup"><span data-stu-id="3cf86-131"> the different stores, see [Certificate stores](http://go.microsoft.com/fwlink/?LinkId=87787).</span></span>  
  
### <a name="windows"></a><span data-ttu-id="3cf86-132">Windows</span><span class="sxs-lookup"><span data-stu-id="3cf86-132">Windows</span></span>  
 <span data-ttu-id="3cf86-133">Typ poświadczeń komunikatu systemu Windows używa protokołu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="3cf86-133">Windows message credential type uses the Kerberos protocol.</span></span>  
  
 <span data-ttu-id="3cf86-134">Protokół Kerberos jest mechanizmem zabezpieczeń uwierzytelnia użytkowników w domenie, który umożliwia uwierzytelnionym użytkownikom ustanowienia bezpiecznego konteksty z innymi osobami w domenie.</span><span class="sxs-lookup"><span data-stu-id="3cf86-134">The Kerberos protocol is a security mechanism that authenticates users on a domain and allows the authenticated users to establish secure contexts with other entities on a domain.</span></span>  
  
 <span data-ttu-id="3cf86-135">Problem przy użyciu protokołu Kerberos do komunikacji w kolejce to względnie krótkim okresie biletów, które zawierają tożsamości klienta, który rozprowadza Centrum dystrybucji kluczy (KDC).</span><span class="sxs-lookup"><span data-stu-id="3cf86-135">The problem with using the Kerberos protocol for queued communication is that the tickets that contain client identity that the Key Distribution Center (KDC) distributes are relatively short-lived.</span></span> <span data-ttu-id="3cf86-136">A *okres istnienia* jest skojarzony z bilet Kerberos, który wskazuje ważność biletu.</span><span class="sxs-lookup"><span data-stu-id="3cf86-136">A *lifetime* is associated with the Kerberos ticket that indicates the validity of the ticket.</span></span> <span data-ttu-id="3cf86-137">Tak, biorąc pod uwagę duże opóźnienie, możesz nie może być się, że token jest ciągle ważny dla usługi, który uwierzytelnia klientów.</span><span class="sxs-lookup"><span data-stu-id="3cf86-137">As such, given high latency, you cannot be sure that the token is still valid for the service that authenticates the client.</span></span>  
  
 <span data-ttu-id="3cf86-138">Należy pamiętać, że gdy przy użyciu tego typu poświadczeń, usługa musi działać na koncie usługi.</span><span class="sxs-lookup"><span data-stu-id="3cf86-138">Note that when using this credential type, the service must be running under the SERVICE account.</span></span>  
  
 <span data-ttu-id="3cf86-139">Protokół Kerberos jest używany domyślnie w przypadku wybrania poświadczeniami komunikatu.</span><span class="sxs-lookup"><span data-stu-id="3cf86-139">The Kerberos protocol is used by default when choosing message credential.</span></span> <span data-ttu-id="3cf86-140">Aby uzyskać więcej informacji, zobacz [eksploracji protokołu Kerberos, protokół dla rozproszonych zabezpieczeń w systemie Windows 2000](http://go.microsoft.com/fwlink/?LinkId=87790).</span><span class="sxs-lookup"><span data-stu-id="3cf86-140">For more information, see [Exploring Kerberos, the Protocol for Distributed Security in Windows 2000](http://go.microsoft.com/fwlink/?LinkId=87790).</span></span>  
  
### <a name="username-password"></a><span data-ttu-id="3cf86-141">Hasło nazwy użytkownika</span><span class="sxs-lookup"><span data-stu-id="3cf86-141">Username Password</span></span>  
 <span data-ttu-id="3cf86-142">Za pomocą tej właściwości, klient może uwierzytelnić się na serwerze przy użyciu nazwy użytkownika hasła w nagłówku zabezpieczeń wiadomości.</span><span class="sxs-lookup"><span data-stu-id="3cf86-142">Using this property, the client can authenticate to the server using a username password in the security header of the message.</span></span>  
  
### <a name="issuedtoken"></a><span data-ttu-id="3cf86-143">IssuedToken</span><span class="sxs-lookup"><span data-stu-id="3cf86-143">IssuedToken</span></span>  
 <span data-ttu-id="3cf86-144">Klient może używać usługi tokenu zabezpieczającego wystawianie tokenów, który można dołączyć do wiadomości dla usługi do uwierzytelniania klienta.</span><span class="sxs-lookup"><span data-stu-id="3cf86-144">The client can use the security token service to issue a token that can then be attached to the message for the service to authenticate the client.</span></span>  
  
## <a name="using-transport-and-message-security"></a><span data-ttu-id="3cf86-145">Przy użyciu transportu i zabezpieczeń komunikatów</span><span class="sxs-lookup"><span data-stu-id="3cf86-145">Using Transport and Message Security</span></span>  
 <span data-ttu-id="3cf86-146">Podczas korzystania zarówno z zabezpieczeń transportu i zabezpieczeń wiadomości, certyfikat używany do zabezpieczania komunikatów zarówno na poziomie komunikatu protokołu SOAP i transportu muszą być takie same.</span><span class="sxs-lookup"><span data-stu-id="3cf86-146">When using both transport security and message security, the certificate used to secure the message both at the transport and the SOAP message level must be the same.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="3cf86-147">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="3cf86-147">See Also</span></span>  
 [<span data-ttu-id="3cf86-148">Ochrona komunikatów za pomocą zabezpieczeń transportu</span><span class="sxs-lookup"><span data-stu-id="3cf86-148">Securing Messages Using Transport Security</span></span>](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md)  
 [<span data-ttu-id="3cf86-149">Zabezpieczenia komunikatów w ramach kolejkowania komunikatów</span><span class="sxs-lookup"><span data-stu-id="3cf86-149">Message Security over Message Queuing</span></span>](../../../../docs/framework/wcf/samples/message-security-over-message-queuing.md)  
 [<span data-ttu-id="3cf86-150">Pojęcia dotyczące zabezpieczeń</span><span class="sxs-lookup"><span data-stu-id="3cf86-150">Security Concepts</span></span>](../../../../docs/framework/wcf/feature-details/security-concepts.md)  
 [<span data-ttu-id="3cf86-151">Zabezpieczanie usług i klientów</span><span class="sxs-lookup"><span data-stu-id="3cf86-151">Securing Services and Clients</span></span>](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md)
