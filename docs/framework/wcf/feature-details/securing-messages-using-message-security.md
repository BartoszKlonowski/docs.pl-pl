---
title: Korzystanie z zabezpieczeń komunikatów
ms.date: 03/30/2017
ms.assetid: a17ebe67-836b-4c52-9a81-2c3d58e225ee
ms.openlocfilehash: 9ba8923d23140bb951a4993739ec267ad6f6a4c4
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/22/2019
ms.locfileid: "69911777"
---
# <a name="securing-messages-using-message-security"></a><span data-ttu-id="d07c6-102">Korzystanie z zabezpieczeń komunikatów</span><span class="sxs-lookup"><span data-stu-id="d07c6-102">Securing Messages Using Message Security</span></span>
<span data-ttu-id="d07c6-103">W tej części omówiono zabezpieczenia komunikatów WCF podczas <xref:System.ServiceModel.NetMsmqBinding>korzystania z programu.</span><span class="sxs-lookup"><span data-stu-id="d07c6-103">This section discusses WCF message security when using <xref:System.ServiceModel.NetMsmqBinding>.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d07c6-104">Przed przeczytaniem z tego tematu zaleca się zapoznanie się z [pojęciami dotyczącymi zabezpieczeń](../../../../docs/framework/wcf/feature-details/security-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="d07c6-104">Before reading through this topic, it is recommended that you read [Security Concepts](../../../../docs/framework/wcf/feature-details/security-concepts.md).</span></span>  
  
 <span data-ttu-id="d07c6-105">Poniższa ilustracja przedstawia model koncepcyjny komunikacji kolejkowanej przy użyciu programu WCF.</span><span class="sxs-lookup"><span data-stu-id="d07c6-105">The following illustration provides a conceptual model of queued communication using WCF.</span></span> <span data-ttu-id="d07c6-106">Ta ilustracja i terminologia są używane do wyjaśnienia</span><span class="sxs-lookup"><span data-stu-id="d07c6-106">This illustration and terminology are used to explain</span></span>  
  
 <span data-ttu-id="d07c6-107">zagadnienia dotyczące zabezpieczeń transportu.</span><span class="sxs-lookup"><span data-stu-id="d07c6-107">transport security concepts.</span></span>  
  
 <span data-ttu-id="d07c6-108">![Diagram aplikacji] znajdujących się w kolejce (../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "Rozproszona-queueed-Figure")</span><span class="sxs-lookup"><span data-stu-id="d07c6-108">![Queued Application Diagram](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "Distributed-Queue-Figure")</span></span>  
  
 <span data-ttu-id="d07c6-109">Podczas wysyłania komunikatów umieszczonych w kolejce przy użyciu programu WCF komunikat WCF jest dołączany jako treść komunikatu usługi kolejkowania komunikatów (MSMQ).</span><span class="sxs-lookup"><span data-stu-id="d07c6-109">When sending queued messages using WCF, the WCF message is attached as a body of the Message Queuing (MSMQ) message.</span></span> <span data-ttu-id="d07c6-110">Chociaż zabezpieczenia transportu zabezpieczają cały komunikat MSMQ, zabezpieczenia komunikatów (lub SOAP) zabezpieczają tylko treść wiadomości MSMQ.</span><span class="sxs-lookup"><span data-stu-id="d07c6-110">While transport security secures the entire MSMQ message, message (or SOAP) security only secures the body of the MSMQ message.</span></span>  
  
 <span data-ttu-id="d07c6-111">Najważniejszym pojęciem zabezpieczeń komunikatów jest, że klient zabezpieczy komunikat dla aplikacji odbiorczej (usługi), w przeciwieństwie do zabezpieczeń transportu, gdy klient zabezpieczy komunikat dla kolejki docelowej.</span><span class="sxs-lookup"><span data-stu-id="d07c6-111">The key concept of message security is that the client secures the message for the receiving application (service), unlike transport security where the client secures the message for the Target Queue.</span></span> <span data-ttu-id="d07c6-112">W związku z tym usługa MSMQ nie pełni żadnej części podczas zabezpieczania wiadomości WCF przy użyciu zabezpieczeń komunikatów.</span><span class="sxs-lookup"><span data-stu-id="d07c6-112">As such, MSMQ plays no part when securing the WCF message using message security.</span></span>  
  
 <span data-ttu-id="d07c6-113">Funkcja zabezpieczenia komunikatów WCF dodaje nagłówki zabezpieczeń do wiadomości WCF, która integruje się z istniejącymi infrastrukturami zabezpieczeń, takimi jak certyfikat lub protokół Kerberos.</span><span class="sxs-lookup"><span data-stu-id="d07c6-113">WCF message security adds security headers to the WCF message that integrate with existing security infrastructures, such as a certificate or the Kerberos protocol.</span></span>  
  
## <a name="message-credential-type"></a><span data-ttu-id="d07c6-114">Typ poświadczeń wiadomości</span><span class="sxs-lookup"><span data-stu-id="d07c6-114">Message Credential Type</span></span>  
 <span data-ttu-id="d07c6-115">Korzystając z zabezpieczeń komunikatów, usługa i klient mogą przedstawić poświadczenia do wzajemnego uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="d07c6-115">Using message security, the service and client can present credentials to authenticate each another.</span></span> <span data-ttu-id="d07c6-116">Możesz wybrać opcję Zabezpieczenia komunikatów, ustawiając <xref:System.ServiceModel.NetMsmqBinding.Security%2A> tryb na `Message` lub `Both` (to oznacza, że są używane zabezpieczenia transportu i zabezpieczenia komunikatów).</span><span class="sxs-lookup"><span data-stu-id="d07c6-116">You can select message security by setting the <xref:System.ServiceModel.NetMsmqBinding.Security%2A> mode to `Message` or `Both` (that is, use both transport security and message security).</span></span>  
  
 <span data-ttu-id="d07c6-117">Usługa może użyć <xref:System.ServiceModel.ServiceSecurityContext.Current%2A> właściwości, aby sprawdzić poświadczenie używane do uwierzytelniania klienta.</span><span class="sxs-lookup"><span data-stu-id="d07c6-117">The service can use the <xref:System.ServiceModel.ServiceSecurityContext.Current%2A> property to inspect the credential used to authenticate the client.</span></span> <span data-ttu-id="d07c6-118">Można go również użyć do dalszej kontroli autoryzacji, którą usługa wybiera do wdrożenia.</span><span class="sxs-lookup"><span data-stu-id="d07c6-118">This can also be used for further authorization checks that the service chooses to implement.</span></span>  
  
 <span data-ttu-id="d07c6-119">W tej sekcji objaśniono różne typy poświadczeń i sposoby ich używania z kolejkami.</span><span class="sxs-lookup"><span data-stu-id="d07c6-119">This section explains the different credential types and how to use them with queues.</span></span>  
  
### <a name="certificate"></a><span data-ttu-id="d07c6-120">Certyfikatu</span><span class="sxs-lookup"><span data-stu-id="d07c6-120">Certificate</span></span>  
 <span data-ttu-id="d07c6-121">Typ poświadczeń certyfikatu używa certyfikatu X. 509, aby zidentyfikować usługę i klienta.</span><span class="sxs-lookup"><span data-stu-id="d07c6-121">The certificate credential type uses an X.509 certificate to identify the service and the client.</span></span>  
  
 <span data-ttu-id="d07c6-122">W typowym scenariuszu klient i usługa otrzymują prawidłowy certyfikat przez zaufany urząd certyfikacji.</span><span class="sxs-lookup"><span data-stu-id="d07c6-122">In a typical scenario, the client and the service are issued a valid certificate by a trusted certification authority.</span></span> <span data-ttu-id="d07c6-123">Następnie połączenie zostanie nawiązane, a klient uwierzytelnia ważność usługi przy użyciu certyfikatu usługi, aby zdecydować, czy może ufać usłudze.</span><span class="sxs-lookup"><span data-stu-id="d07c6-123">Then the connection is established, the client authenticates the validity of the service using the service's certificate to decide whether it can trust the service.</span></span> <span data-ttu-id="d07c6-124">Podobnie usługa używa certyfikatu klienta do sprawdzania poprawności zaufania klienta.</span><span class="sxs-lookup"><span data-stu-id="d07c6-124">Similarly, the service uses the client's certificate to validate the client trust.</span></span>  
  
 <span data-ttu-id="d07c6-125">Ze względu na rozłączoną naturę kolejek, klient i usługa nie mogą być w trybie online w tym samym czasie.</span><span class="sxs-lookup"><span data-stu-id="d07c6-125">Given the disconnected nature of queues, the client and the service may not be online at the same time.</span></span> <span data-ttu-id="d07c6-126">W związku z tym klient i usługa muszą wymieniać certyfikaty poza pasmem.</span><span class="sxs-lookup"><span data-stu-id="d07c6-126">As such, the client and service have to exchange certificates out-of-band.</span></span> <span data-ttu-id="d07c6-127">W szczególności klient z tytułu posiadania certyfikatu usługi (który może być łańcuchem do urzędu certyfikacji) w swoim zaufanym magazynie, musi ufać, że komunikuje się z poprawną usługą.</span><span class="sxs-lookup"><span data-stu-id="d07c6-127">In particular, the client, by virtue of holding the service's certificate (which can be chained to a certification authority) in its trusted store, must trust that it is communicating with the correct service.</span></span> <span data-ttu-id="d07c6-128">Aby można było uwierzytelniać klienta, usługa używa certyfikatu X. 509 dołączonego do wiadomości w celu dopasowania go do certyfikatu w magazynie w celu zweryfikowania autentyczności klienta.</span><span class="sxs-lookup"><span data-stu-id="d07c6-128">For authenticating the client, the service uses the X.509 certificate attached with the message to matches it with the certificate in its store to verify the authenticity of the client.</span></span> <span data-ttu-id="d07c6-129">Ponownie certyfikat musi być łańcuchem do urzędu certyfikacji.</span><span class="sxs-lookup"><span data-stu-id="d07c6-129">Again, the certificate must be chained to a certification authority.</span></span>  
  
 <span data-ttu-id="d07c6-130">Na komputerze z systemem Windows certyfikaty są przechowywane w kilku rodzajach magazynów.</span><span class="sxs-lookup"><span data-stu-id="d07c6-130">On a computer running Windows, certificates are held in several kinds of stores.</span></span> <span data-ttu-id="d07c6-131">Aby uzyskać więcej informacji na temat różnych magazynów, zobacz [magazyny certyfikatów](https://go.microsoft.com/fwlink/?LinkId=87787).</span><span class="sxs-lookup"><span data-stu-id="d07c6-131">For more information about the different stores, see [Certificate stores](https://go.microsoft.com/fwlink/?LinkId=87787).</span></span>  
  
### <a name="windows"></a><span data-ttu-id="d07c6-132">Windows</span><span class="sxs-lookup"><span data-stu-id="d07c6-132">Windows</span></span>  
 <span data-ttu-id="d07c6-133">Typ poświadczeń komunikatu systemu Windows używa protokołu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="d07c6-133">Windows message credential type uses the Kerberos protocol.</span></span>  
  
 <span data-ttu-id="d07c6-134">Protokół Kerberos jest mechanizmem zabezpieczeń, który uwierzytelnia użytkowników w domenie i zezwala uwierzytelnionym użytkownikom na ustanawianie bezpiecznych kontekstów z innymi jednostkami w domenie.</span><span class="sxs-lookup"><span data-stu-id="d07c6-134">The Kerberos protocol is a security mechanism that authenticates users on a domain and allows the authenticated users to establish secure contexts with other entities on a domain.</span></span>  
  
 <span data-ttu-id="d07c6-135">Problem z korzystaniem z protokołu Kerberos na potrzeby komunikacji w kolejce polega na tym, że bilety zawierające tożsamość klienta dystrybuowaną przez centrum dystrybucji kluczy (KDC) są stosunkowo krótko.</span><span class="sxs-lookup"><span data-stu-id="d07c6-135">The problem with using the Kerberos protocol for queued communication is that the tickets that contain client identity that the Key Distribution Center (KDC) distributes are relatively short-lived.</span></span> <span data-ttu-id="d07c6-136">*Okres istnienia* jest skojarzony z biletem protokołu Kerberos, który wskazuje na ważność biletu.</span><span class="sxs-lookup"><span data-stu-id="d07c6-136">A *lifetime* is associated with the Kerberos ticket that indicates the validity of the ticket.</span></span> <span data-ttu-id="d07c6-137">W związku z tym duże opóźnienie nie można mieć pewności, że token jest nadal ważny dla usługi, która uwierzytelnia klienta.</span><span class="sxs-lookup"><span data-stu-id="d07c6-137">As such, given high latency, you cannot be sure that the token is still valid for the service that authenticates the client.</span></span>  
  
 <span data-ttu-id="d07c6-138">Należy pamiętać, że w przypadku korzystania z tego typu poświadczeń usługa musi być uruchomiona w ramach konta usługi.</span><span class="sxs-lookup"><span data-stu-id="d07c6-138">Note that when using this credential type, the service must be running under the SERVICE account.</span></span>  
  
 <span data-ttu-id="d07c6-139">Protokół Kerberos jest używany domyślnie podczas wybierania poświadczeń wiadomości.</span><span class="sxs-lookup"><span data-stu-id="d07c6-139">The Kerberos protocol is used by default when choosing message credential.</span></span> <span data-ttu-id="d07c6-140">Aby uzyskać więcej informacji, zobacz [Eksplorowanie protokołu Kerberos, protokół dla zabezpieczeń rozproszonych w systemie Windows 2000](https://go.microsoft.com/fwlink/?LinkId=87790).</span><span class="sxs-lookup"><span data-stu-id="d07c6-140">For more information, see [Exploring Kerberos, the Protocol for Distributed Security in Windows 2000](https://go.microsoft.com/fwlink/?LinkId=87790).</span></span>  
  
### <a name="username-password"></a><span data-ttu-id="d07c6-141">Hasło użytkownika</span><span class="sxs-lookup"><span data-stu-id="d07c6-141">Username Password</span></span>  
 <span data-ttu-id="d07c6-142">Korzystając z tej właściwości, klient może uwierzytelniać się na serwerze przy użyciu hasła użytkownika w nagłówku zabezpieczeń wiadomości.</span><span class="sxs-lookup"><span data-stu-id="d07c6-142">Using this property, the client can authenticate to the server using a username password in the security header of the message.</span></span>  
  
### <a name="issuedtoken"></a><span data-ttu-id="d07c6-143">IssuedToken</span><span class="sxs-lookup"><span data-stu-id="d07c6-143">IssuedToken</span></span>  
 <span data-ttu-id="d07c6-144">Klient może użyć usługi tokenu zabezpieczającego, aby wystawić token, który następnie może zostać dołączony do wiadomości dla usługi w celu uwierzytelnienia klienta.</span><span class="sxs-lookup"><span data-stu-id="d07c6-144">The client can use the security token service to issue a token that can then be attached to the message for the service to authenticate the client.</span></span>  
  
## <a name="using-transport-and-message-security"></a><span data-ttu-id="d07c6-145">Korzystanie z usługi transport i zabezpieczenia komunikatów</span><span class="sxs-lookup"><span data-stu-id="d07c6-145">Using Transport and Message Security</span></span>  
 <span data-ttu-id="d07c6-146">W przypadku korzystania z zabezpieczeń transportu i zabezpieczeń komunikatów certyfikat używany do zabezpieczenia komunikatu zarówno w transportie, jak i na poziomie komunikatu protokołu SOAP musi być taki sam.</span><span class="sxs-lookup"><span data-stu-id="d07c6-146">When using both transport security and message security, the certificate used to secure the message both at the transport and the SOAP message level must be the same.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d07c6-147">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="d07c6-147">See also</span></span>

- [<span data-ttu-id="d07c6-148">Ochrona komunikatów za pomocą zabezpieczeń transportu</span><span class="sxs-lookup"><span data-stu-id="d07c6-148">Securing Messages Using Transport Security</span></span>](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md)
- [<span data-ttu-id="d07c6-149">Zabezpieczenia komunikatów w ramach kolejkowania komunikatów</span><span class="sxs-lookup"><span data-stu-id="d07c6-149">Message Security over Message Queuing</span></span>](../../../../docs/framework/wcf/samples/message-security-over-message-queuing.md)
- [<span data-ttu-id="d07c6-150">Pojęcia dotyczące zabezpieczeń</span><span class="sxs-lookup"><span data-stu-id="d07c6-150">Security Concepts</span></span>](../../../../docs/framework/wcf/feature-details/security-concepts.md)
- [<span data-ttu-id="d07c6-151">Zabezpieczanie usług i klientów</span><span class="sxs-lookup"><span data-stu-id="d07c6-151">Securing Services and Clients</span></span>](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md)
