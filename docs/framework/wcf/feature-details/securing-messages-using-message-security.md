---
title: Korzystanie z zabezpieczeń komunikatów
ms.date: 03/30/2017
ms.assetid: a17ebe67-836b-4c52-9a81-2c3d58e225ee
author: BrucePerlerMS
manager: mbaldwin
ms.openlocfilehash: d895524d36895ad087f7394fcc3380573355eaad
ms.sourcegitcommit: 2eceb05f1a5bb261291a1f6a91c5153727ac1c19
ms.translationtype: HT
ms.contentlocale: pl-PL
ms.lasthandoff: 09/05/2018
ms.locfileid: "43724184"
---
# <a name="securing-messages-using-message-security"></a><span data-ttu-id="ec624-102">Korzystanie z zabezpieczeń komunikatów</span><span class="sxs-lookup"><span data-stu-id="ec624-102">Securing Messages Using Message Security</span></span>
<span data-ttu-id="ec624-103">W tej sekcji omówiono zabezpieczenie wiadomości WCF w przypadku korzystania z <xref:System.ServiceModel.NetMsmqBinding>.</span><span class="sxs-lookup"><span data-stu-id="ec624-103">This section discusses WCF message security when using <xref:System.ServiceModel.NetMsmqBinding>.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="ec624-104">Przed odczytaniem za pośrednictwem tego tematu, zaleca się przeczytanie [pojęcia dotyczące zabezpieczeń](../../../../docs/framework/wcf/feature-details/security-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="ec624-104">Before reading through this topic, it is recommended that you read [Security Concepts](../../../../docs/framework/wcf/feature-details/security-concepts.md).</span></span>  
  
 <span data-ttu-id="ec624-105">Następująca ilustracja przedstawia model koncepcyjny umieszczonych w kolejce komunikacji przy użyciu usługi WCF.</span><span class="sxs-lookup"><span data-stu-id="ec624-105">The following illustration provides a conceptual model of queued communication using WCF.</span></span> <span data-ttu-id="ec624-106">Ta ilustracja i terminologii służą do wyjaśnienia</span><span class="sxs-lookup"><span data-stu-id="ec624-106">This illustration and terminology are used to explain</span></span>  
  
 <span data-ttu-id="ec624-107">transport pojęcia dotyczące zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="ec624-107">transport security concepts.</span></span>  
  
 <span data-ttu-id="ec624-108">![Diagram aplikacji w kolejce](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "rozproszonych kolejka rysunek")</span><span class="sxs-lookup"><span data-stu-id="ec624-108">![Queued Application Diagram](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "Distributed-Queue-Figure")</span></span>  
  
 <span data-ttu-id="ec624-109">Podczas wysyłania komunikatów z obsługą kolejek przy użyciu usługi WCF, wiadomości WCF jest dołączony jako treść komunikatu usługi kolejkowania komunikatów (MSMQ).</span><span class="sxs-lookup"><span data-stu-id="ec624-109">When sending queued messages using WCF, the WCF message is attached as a body of the Message Queuing (MSMQ) message.</span></span> <span data-ttu-id="ec624-110">Gdy zabezpieczenia transportu zabezpiecza całą MSMQ wiadomość, komunikat (lub protokołu SOAP) zabezpieczeń zabezpiecza tylko treści wiadomości usługi MSMQ.</span><span class="sxs-lookup"><span data-stu-id="ec624-110">While transport security secures the entire MSMQ message, message (or SOAP) security only secures the body of the MSMQ message.</span></span>  
  
 <span data-ttu-id="ec624-111">Kluczowe pojęcia zabezpieczeń wiadomości jest, że klient zabezpiecza wiadomości dla aplikacji odbierającej (usługa), w przeciwieństwie do zabezpieczenia transportu, w której klient zabezpiecza komunikat do kolejki docelowej.</span><span class="sxs-lookup"><span data-stu-id="ec624-111">The key concept of message security is that the client secures the message for the receiving application (service), unlike transport security where the client secures the message for the Target Queue.</span></span> <span data-ttu-id="ec624-112">W efekcie MSMQ odgrywa bez części, gdy zabezpieczenie wiadomości WCF, korzystanie z zabezpieczeń komunikatów.</span><span class="sxs-lookup"><span data-stu-id="ec624-112">As such, MSMQ plays no part when securing the WCF message using message security.</span></span>  
  
 <span data-ttu-id="ec624-113">Zabezpieczenie wiadomości WCF dodaje nagłówki zabezpieczeń wiadomości WCF, które integrują się z istniejącymi infrastrukturami zabezpieczeń, takie jak certyfikat lub protokołu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="ec624-113">WCF message security adds security headers to the WCF message that integrate with existing security infrastructures, such as a certificate or the Kerberos protocol.</span></span>  
  
## <a name="message-credential-type"></a><span data-ttu-id="ec624-114">Typ poświadczeń komunikatu</span><span class="sxs-lookup"><span data-stu-id="ec624-114">Message Credential Type</span></span>  
 <span data-ttu-id="ec624-115">Korzystanie z zabezpieczeń komunikatów, usługi i klienta może powodować poświadczeń w celu uwierzytelnienia każdego innego.</span><span class="sxs-lookup"><span data-stu-id="ec624-115">Using message security, the service and client can present credentials to authenticate each another.</span></span> <span data-ttu-id="ec624-116">Zabezpieczenia komunikatów można wybrać, ustawiając <xref:System.ServiceModel.NetMsmqBinding.Security%2A> tryb `Message` lub `Both` (oznacza to, użyj zarówno z zabezpieczeń transportu i zabezpieczenia komunikatów).</span><span class="sxs-lookup"><span data-stu-id="ec624-116">You can select message security by setting the <xref:System.ServiceModel.NetMsmqBinding.Security%2A> mode to `Message` or `Both` (that is, use both transport security and message security).</span></span>  
  
 <span data-ttu-id="ec624-117">Można użyć usługa <xref:System.ServiceModel.ServiceSecurityContext.Current%2A> właściwości, aby sprawdzić poświadczenia używane do uwierzytelniania klienta.</span><span class="sxs-lookup"><span data-stu-id="ec624-117">The service can use the <xref:System.ServiceModel.ServiceSecurityContext.Current%2A> property to inspect the credential used to authenticate the client.</span></span> <span data-ttu-id="ec624-118">To umożliwia także do dalszego sprawdzania autoryzacji, usługa zdecyduje się na implementacji.</span><span class="sxs-lookup"><span data-stu-id="ec624-118">This can also be used for further authorization checks that the service chooses to implement.</span></span>  
  
 <span data-ttu-id="ec624-119">W tej sekcji opisano typy innego poświadczenia i jak z nich korzystać w przypadku kolejek.</span><span class="sxs-lookup"><span data-stu-id="ec624-119">This section explains the different credential types and how to use them with queues.</span></span>  
  
### <a name="certificate"></a><span data-ttu-id="ec624-120">Certyfikat</span><span class="sxs-lookup"><span data-stu-id="ec624-120">Certificate</span></span>  
 <span data-ttu-id="ec624-121">Typ poświadczeń certyfikatu używa certyfikatu X.509 do identyfikowania usługi i klienta.</span><span class="sxs-lookup"><span data-stu-id="ec624-121">The certificate credential type uses an X.509 certificate to identify the service and the client.</span></span>  
  
 <span data-ttu-id="ec624-122">W typowym scenariuszu, klient i usługa są prawidłowy certyfikat wystawiony przez zaufany urząd certyfikacji.</span><span class="sxs-lookup"><span data-stu-id="ec624-122">In a typical scenario, the client and the service are issued a valid certificate by a trusted certification authority.</span></span> <span data-ttu-id="ec624-123">Następnie połączenie zostanie nawiązane, klient uwierzytelnia ważności usługę za pomocą certyfikatu usługi, aby określić, czy można ufać w niej usługi.</span><span class="sxs-lookup"><span data-stu-id="ec624-123">Then the connection is established, the client authenticates the validity of the service using the service's certificate to decide whether it can trust the service.</span></span> <span data-ttu-id="ec624-124">Podobnie usługa korzysta z certyfikatu klienta można zweryfikować relacji zaufania klienta.</span><span class="sxs-lookup"><span data-stu-id="ec624-124">Similarly, the service uses the client's certificate to validate the client trust.</span></span>  
  
 <span data-ttu-id="ec624-125">Ze względu na charakter odłączonego kolejek, klient i usługa może nie być online w tym samym czasie.</span><span class="sxs-lookup"><span data-stu-id="ec624-125">Given the disconnected nature of queues, the client and the service may not be online at the same time.</span></span> <span data-ttu-id="ec624-126">W efekcie klienta i usługi muszą wymienić certyfikaty poza pasmem.</span><span class="sxs-lookup"><span data-stu-id="ec624-126">As such, the client and service have to exchange certificates out-of-band.</span></span> <span data-ttu-id="ec624-127">W szczególności klienta, na podstawie zawierający certyfikat usługi, (które można powiązać do urzędu certyfikacji) w magazynie zaufanych muszą ufać, to podczas komunikacji z usługą poprawne.</span><span class="sxs-lookup"><span data-stu-id="ec624-127">In particular, the client, by virtue of holding the service's certificate (which can be chained to a certification authority) in its trusted store, must trust that it is communicating with the correct service.</span></span> <span data-ttu-id="ec624-128">W przypadku uwierzytelniania klienta, używane przez usługę certyfikatu X.509, dołączone do wiadomości pasuje go za pomocą certyfikatu w magazynie w celu sprawdzenia autentyczności klienta.</span><span class="sxs-lookup"><span data-stu-id="ec624-128">For authenticating the client, the service uses the X.509 certificate attached with the message to matches it with the certificate in its store to verify the authenticity of the client.</span></span> <span data-ttu-id="ec624-129">Ponownie certyfikatu muszą być powiązane do urzędu certyfikacji.</span><span class="sxs-lookup"><span data-stu-id="ec624-129">Again, the certificate must be chained to a certification authority.</span></span>  
  
 <span data-ttu-id="ec624-130">Na komputerze z systemem Windows certyfikaty są przechowywane w różnych typów magazynów.</span><span class="sxs-lookup"><span data-stu-id="ec624-130">On a computer running Windows, certificates are held in several kinds of stores.</span></span> <span data-ttu-id="ec624-131">Aby uzyskać więcej informacji na temat różnych sklepach zobacz [magazyny certyfikatów](https://go.microsoft.com/fwlink/?LinkId=87787).</span><span class="sxs-lookup"><span data-stu-id="ec624-131">For more information about the different stores, see [Certificate stores](https://go.microsoft.com/fwlink/?LinkId=87787).</span></span>  
  
### <a name="windows"></a><span data-ttu-id="ec624-132">Windows</span><span class="sxs-lookup"><span data-stu-id="ec624-132">Windows</span></span>  
 <span data-ttu-id="ec624-133">Typ poświadczeń komunikatu Windows używa protokołu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="ec624-133">Windows message credential type uses the Kerberos protocol.</span></span>  
  
 <span data-ttu-id="ec624-134">Protokół Kerberos jest mechanizmem zabezpieczeń, który uwierzytelnia użytkowników w domenie i umożliwia uwierzytelnionym użytkownikom ustanowienia bezpiecznego kontekstów z innymi jednostkami w domenie.</span><span class="sxs-lookup"><span data-stu-id="ec624-134">The Kerberos protocol is a security mechanism that authenticates users on a domain and allows the authenticated users to establish secure contexts with other entities on a domain.</span></span>  
  
 <span data-ttu-id="ec624-135">Problem z używaniem protokołu Kerberos do komunikacji z obsługą kolejek są stosunkowo krótkotrwałe biletów, które zawierają tożsamości klienta, który rozdziela Centrum dystrybucji kluczy (KDC).</span><span class="sxs-lookup"><span data-stu-id="ec624-135">The problem with using the Kerberos protocol for queued communication is that the tickets that contain client identity that the Key Distribution Center (KDC) distributes are relatively short-lived.</span></span> <span data-ttu-id="ec624-136">A *okres istnienia* jest skojarzony z biletu protokołu Kerberos, który wskazuje na prawidłowość--ticket.</span><span class="sxs-lookup"><span data-stu-id="ec624-136">A *lifetime* is associated with the Kerberos ticket that indicates the validity of the ticket.</span></span> <span data-ttu-id="ec624-137">Jako takie biorąc pod uwagę duże opóźnienie, nie można się upewnić, że token jest ciągle ważny dla usługi, która uwierzytelnia klientów.</span><span class="sxs-lookup"><span data-stu-id="ec624-137">As such, given high latency, you cannot be sure that the token is still valid for the service that authenticates the client.</span></span>  
  
 <span data-ttu-id="ec624-138">Należy pamiętać, że podczas korzystania z tego typu poświadczeń, usługa musi być uruchomiona w ramach konta usługi.</span><span class="sxs-lookup"><span data-stu-id="ec624-138">Note that when using this credential type, the service must be running under the SERVICE account.</span></span>  
  
 <span data-ttu-id="ec624-139">Protokół Kerberos jest używany domyślnie podczas wybierania poświadczeniami komunikatu.</span><span class="sxs-lookup"><span data-stu-id="ec624-139">The Kerberos protocol is used by default when choosing message credential.</span></span> <span data-ttu-id="ec624-140">Aby uzyskać więcej informacji, zobacz [Eksplorowanie protokołu Kerberos, protokół rozproszonych zabezpieczeń na platformie Windows 2000](https://go.microsoft.com/fwlink/?LinkId=87790).</span><span class="sxs-lookup"><span data-stu-id="ec624-140">For more information, see [Exploring Kerberos, the Protocol for Distributed Security in Windows 2000](https://go.microsoft.com/fwlink/?LinkId=87790).</span></span>  
  
### <a name="username-password"></a><span data-ttu-id="ec624-141">Hasło nazwy użytkownika</span><span class="sxs-lookup"><span data-stu-id="ec624-141">Username Password</span></span>  
 <span data-ttu-id="ec624-142">Używanie tej właściwości, umożliwia uwierzytelnienie klienta na serwerze przy użyciu hasła nazwy użytkownika w nagłówku zabezpieczenia wiadomości.</span><span class="sxs-lookup"><span data-stu-id="ec624-142">Using this property, the client can authenticate to the server using a username password in the security header of the message.</span></span>  
  
### <a name="issuedtoken"></a><span data-ttu-id="ec624-143">IssuedToken</span><span class="sxs-lookup"><span data-stu-id="ec624-143">IssuedToken</span></span>  
 <span data-ttu-id="ec624-144">Klient może używać usługi tokenów zabezpieczeń można wystawić tokenu, który może następnie być dołączony do wiadomości dla usługi do uwierzytelniania klienta.</span><span class="sxs-lookup"><span data-stu-id="ec624-144">The client can use the security token service to issue a token that can then be attached to the message for the service to authenticate the client.</span></span>  
  
## <a name="using-transport-and-message-security"></a><span data-ttu-id="ec624-145">Za pomocą transportu i zabezpieczeń komunikatów</span><span class="sxs-lookup"><span data-stu-id="ec624-145">Using Transport and Message Security</span></span>  
 <span data-ttu-id="ec624-146">Korzystając z zabezpieczeń transportu i zabezpieczeń wiadomości, certyfikat używany do zabezpieczenia wiadomości, zarówno na poziomie transportu i protokołu SOAP wiadomości musi być taka sama.</span><span class="sxs-lookup"><span data-stu-id="ec624-146">When using both transport security and message security, the certificate used to secure the message both at the transport and the SOAP message level must be the same.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ec624-147">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="ec624-147">See Also</span></span>  
 [<span data-ttu-id="ec624-148">Ochrona komunikatów za pomocą zabezpieczeń transportu</span><span class="sxs-lookup"><span data-stu-id="ec624-148">Securing Messages Using Transport Security</span></span>](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md)  
 [<span data-ttu-id="ec624-149">Zabezpieczenia komunikatów w ramach kolejkowania komunikatów</span><span class="sxs-lookup"><span data-stu-id="ec624-149">Message Security over Message Queuing</span></span>](../../../../docs/framework/wcf/samples/message-security-over-message-queuing.md)  
 [<span data-ttu-id="ec624-150">Pojęcia dotyczące zabezpieczeń</span><span class="sxs-lookup"><span data-stu-id="ec624-150">Security Concepts</span></span>](../../../../docs/framework/wcf/feature-details/security-concepts.md)  
 [<span data-ttu-id="ec624-151">Zabezpieczanie usług i klientów</span><span class="sxs-lookup"><span data-stu-id="ec624-151">Securing Services and Clients</span></span>](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md)
