---
title: Ograniczanie dystrybucji komunikatów
ms.date: 03/30/2017
ms.assetid: 8b5ec4b8-1ce9-45ef-bb90-2c840456bcc1
ms.openlocfilehash: 188d7bd365caad7d4cd438744c78ae8e7cd95e7e
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 06/09/2020
ms.locfileid: "84586315"
---
# <a name="limiting-message-distribution"></a><span data-ttu-id="775e4-102">Ograniczanie dystrybucji komunikatów</span><span class="sxs-lookup"><span data-stu-id="775e4-102">Limiting Message Distribution</span></span>

<span data-ttu-id="775e4-103">Kanałem równorzędnym jest zaprojektowanie siatki emisji.</span><span class="sxs-lookup"><span data-stu-id="775e4-103">Peer Channel is by design a broadcast mesh.</span></span> <span data-ttu-id="775e4-104">Jego podstawowy model zalewania obejmuje dystrybuowanie każdej wiadomości wysyłanej przez dowolnego członka siatki do wszystkich innych członków tej siatki.</span><span class="sxs-lookup"><span data-stu-id="775e4-104">Its basic flooding model involves distributing each message sent by any member of a mesh to all other members of that mesh.</span></span> <span data-ttu-id="775e4-105">Jest to idealne rozwiązanie w sytuacjach, gdy każdy komunikat generowany przez członka jest istotny i przydatny dla wszystkich innych członków (na przykład pokoju rozmów).</span><span class="sxs-lookup"><span data-stu-id="775e4-105">This is ideal in situations where every message generated by a member is relevant and useful to all other members (for example, a chat room).</span></span> <span data-ttu-id="775e4-106">Jednak wiele aplikacji ma sporadyczną potrzebę do ograniczania dystrybucji komunikatów.</span><span class="sxs-lookup"><span data-stu-id="775e4-106">However, many applications have an occasional need for limiting message distribution.</span></span> <span data-ttu-id="775e4-107">Na przykład jeśli nowy element członkowski łączy siatkę i chce pobrać ostatnią wiadomość wysłaną przez siatkę, to żądanie nie musi być zalewana do każdego elementu członkowskiego siatki.</span><span class="sxs-lookup"><span data-stu-id="775e4-107">For example, if a new member joins a mesh and wants to retrieve the last message sent through the mesh, this request does not need to be flooded to every member of the mesh.</span></span> <span data-ttu-id="775e4-108">Żądanie może być ograniczone do bliskich sąsiadów lub można odfiltrować lokalnie wygenerowane komunikaty. Komunikaty mogą być również wysyłane do poszczególnych węzłów siatki.</span><span class="sxs-lookup"><span data-stu-id="775e4-108">The request could be limited to near neighbors, or locally generated messages can be filtered out. Messages can also be sent to an individual node on the mesh.</span></span> <span data-ttu-id="775e4-109">W tym temacie omówiono użycie liczby przeskoków, filtru propagacji komunikatów, lokalnego filtru lub bezpośredniego połączenia w celu kontrolowania sposobu przekazywania komunikatów w całej sieci i przedstawiono ogólne wytyczne dotyczące wybierania podejścia.</span><span class="sxs-lookup"><span data-stu-id="775e4-109">This topic discusses using Hop Count, a Message Propagation Filter, a local filter, or a direct connection to control how messages are forwarded throughout the mesh, and provides general guidelines for choosing an approach.</span></span>

## <a name="hop-counts"></a><span data-ttu-id="775e4-110">Liczba przeskoków</span><span class="sxs-lookup"><span data-stu-id="775e4-110">Hop Counts</span></span>

<span data-ttu-id="775e4-111">Koncepcja `PeerHopCount` jest podobna do czasu wygaśnięcia (Time-to-Live) używanego w protokole IP.</span><span class="sxs-lookup"><span data-stu-id="775e4-111">The concept of `PeerHopCount` is similar to TTL (Time-To-Live) used in IP protocol.</span></span> <span data-ttu-id="775e4-112">Wartość `PeerHopCount` jest powiązana z wystąpieniem komunikatu i określa, ile razy wiadomość powinna być przekazywana przed porzuceniem.</span><span class="sxs-lookup"><span data-stu-id="775e4-112">The value of `PeerHopCount` is tied to a message instance, and it specifies how many times a message should be forwarded before being dropped.</span></span> <span data-ttu-id="775e4-113">Za każdym razem, gdy komunikat jest odbierany przez klienta kanału równorzędnego, klient analizuje komunikat, aby zobaczyć, czy `PeerHopCount` jest określony.</span><span class="sxs-lookup"><span data-stu-id="775e4-113">Each time a message is received by a Peer Channel client, the client examines the message to see if `PeerHopCount` is specified.</span></span> <span data-ttu-id="775e4-114">Jeśli jest określona, klient zmniejsza wartość liczby przeskoków o jeden przed przekazaniem komunikatu do sąsiednich węzłów.</span><span class="sxs-lookup"><span data-stu-id="775e4-114">If it is specified, then the client decrements the hop count value by one before forwarding the message to neighboring nodes.</span></span> <span data-ttu-id="775e4-115">Gdy klient otrzymuje komunikat z wartością liczby przeskoków równą zero, Klient przetwarza komunikat, ale nie przekazuje komunikatu do sąsiadów.</span><span class="sxs-lookup"><span data-stu-id="775e4-115">When a client receives a message with a hop count value of zero, the client processes the message, but does not forward the message to neighbors.</span></span>

<span data-ttu-id="775e4-116">Licznik przeskoków może zostać dodany do komunikatu przez dodanie `PeerHopCount` jako atrybut do odpowiedniej właściwości lub pola w implementacji klasy komunikatów.</span><span class="sxs-lookup"><span data-stu-id="775e4-116">Hop count may be added to a message by adding `PeerHopCount` as an attribute to the applicable property or field in the implementation of the message class.</span></span> <span data-ttu-id="775e4-117">Można ją ustawić na określoną wartość przed wysłaniem komunikatu do siatki.</span><span class="sxs-lookup"><span data-stu-id="775e4-117">You can set this to a specific value before sending the message to the mesh.</span></span> <span data-ttu-id="775e4-118">W ten sposób można użyć liczby przeskoków, aby ograniczyć dystrybucję komunikatów w sieci w razie potrzeby, potencjalnie unikając niepotrzebne duplikowanie komunikatów.</span><span class="sxs-lookup"><span data-stu-id="775e4-118">In this manner, you can use hop count to limit distribution of messages throughout the mesh when necessary, potentially avoiding unnecessary message duplication.</span></span> <span data-ttu-id="775e4-119">Jest to przydatne w przypadkach, gdy siatka zawiera dużą ilość danych nadmiarowych lub do wysyłania komunikatów do bezpośrednich sąsiadów lub sąsiadów w ciągu kilku przeskoków.</span><span class="sxs-lookup"><span data-stu-id="775e4-119">This is useful in cases where the mesh contains a high amount of redundant data, or for sending a message to immediate neighbors, or neighbors within a few hops.</span></span>

- <span data-ttu-id="775e4-120">Fragmenty kodu i powiązane informacje można znaleźć w [atrybucie PeerHopCount: kontrolowanie wpisu dystrybucji komunikatów](https://docs.microsoft.com/archive/blogs/peerchan/the-peerhopcount-attribute-controlling-message-distribution) na blogu kanału równorzędnego.</span><span class="sxs-lookup"><span data-stu-id="775e4-120">For code snippets and related information, see the [The PeerHopCount Attribute: Controlling Message Distribution](https://docs.microsoft.com/archive/blogs/peerchan/the-peerhopcount-attribute-controlling-message-distribution) post on the Peer Channel blog.</span></span>

## <a name="message-propagation-filter"></a><span data-ttu-id="775e4-121">Filtr propagacji komunikatów</span><span class="sxs-lookup"><span data-stu-id="775e4-121">Message Propagation Filter</span></span>

<span data-ttu-id="775e4-122">`MessagePropagationFilter`może służyć do dostosowanej kontroli zalewania komunikatów, szczególnie w przypadku, gdy zawartość wiadomości lub innych określonych scenariuszy decyduje o propagacji.</span><span class="sxs-lookup"><span data-stu-id="775e4-122">`MessagePropagationFilter` can be used for customized control of message flooding, especially when the content of the message or other specific scenarios determine propagation.</span></span> <span data-ttu-id="775e4-123">Filtr wykonuje decyzje propagacji dla każdego komunikatu, który przechodzi przez węzeł.</span><span class="sxs-lookup"><span data-stu-id="775e4-123">The filter makes propagation decisions for every message that passes through the node.</span></span> <span data-ttu-id="775e4-124">Jest to prawdziwe w przypadku komunikatów, które pochodzą z innych miejsc w siatce, które zostały odebrane przez ten węzeł, a także wiadomości utworzonych przez aplikację.</span><span class="sxs-lookup"><span data-stu-id="775e4-124">This is true for messages that originated elsewhere in the mesh that your node has received as well as messages created by your application.</span></span> <span data-ttu-id="775e4-125">Filtr ma dostęp zarówno do wiadomości, jak i jej pochodzenia, dlatego decyzje dotyczące przekazywania lub porzucania wiadomości mogą opierać się na pełnych dostępnych informacjach.</span><span class="sxs-lookup"><span data-stu-id="775e4-125">The filter has access to both the message and its origination, so decisions about forwarding or dropping the message can be based on the full information available.</span></span>

<span data-ttu-id="775e4-126"><xref:System.ServiceModel.PeerMessagePropagationFilter>jest podstawową klasą abstrakcyjną z pojedynczą funkcją <xref:System.ServiceModel.PeerMessagePropagationFilter.ShouldMessagePropagate%2A> .</span><span class="sxs-lookup"><span data-stu-id="775e4-126"><xref:System.ServiceModel.PeerMessagePropagationFilter> is a base abstract class with a single function, <xref:System.ServiceModel.PeerMessagePropagationFilter.ShouldMessagePropagate%2A>.</span></span> <span data-ttu-id="775e4-127">Pierwszy argument wywołania metody przekazuje pełną kopię wiadomości.</span><span class="sxs-lookup"><span data-stu-id="775e4-127">The first argument of the method call passes in a full copy of the message.</span></span> <span data-ttu-id="775e4-128">Wszelkie zmiany wprowadzone w komunikacie nie wpływają na rzeczywistą wiadomość.</span><span class="sxs-lookup"><span data-stu-id="775e4-128">Any changes made to the message do not affect the actual message.</span></span> <span data-ttu-id="775e4-129">Ostatni argument wywołania metody Określa początek komunikatu ( `PeerMessageOrigination.Local` lub `PeerMessageOrigination.Remote` ).</span><span class="sxs-lookup"><span data-stu-id="775e4-129">The last argument of the method call identifies the origin of the message (`PeerMessageOrigination.Local` or `PeerMessageOrigination.Remote`).</span></span> <span data-ttu-id="775e4-130">Konkretne implementacje tej metody muszą zwracać stałą z wyliczenia, <xref:System.ServiceModel.PeerMessagePropagation> wskazując, że wiadomość ma być przekazywana do lokalnej aplikacji ( `Local` ), przekazana do klientów zdalnych ( `Remote` ), obu ( `LocalAndRemote` ) lub nie ( `None` ).</span><span class="sxs-lookup"><span data-stu-id="775e4-130">Concrete implementations of this method must return a constant from the <xref:System.ServiceModel.PeerMessagePropagation> enumeration indicating that the message is to be forwarded to the local application (`Local`), forwarded to remote clients (`Remote`), both (`LocalAndRemote`), or neither (`None`).</span></span> <span data-ttu-id="775e4-131">Ten filtr można zastosować, uzyskując dostęp do odpowiedniego `PeerNode` obiektu i określając wystąpienie klasy filtru propagacji pochodnej we `PeerNode.MessagePropagationFilter` właściwości.</span><span class="sxs-lookup"><span data-stu-id="775e4-131">This filter can be applied by accessing the corresponding `PeerNode` object and specifying an instance of the derived propagation filter class in the `PeerNode.MessagePropagationFilter` property.</span></span> <span data-ttu-id="775e4-132">Przed otwarciem kanału równorzędnego upewnij się, że jest dołączony filtr propagacji.</span><span class="sxs-lookup"><span data-stu-id="775e4-132">Ensure that the propagation filter is attached before opening the Peer Channel.</span></span>

- <span data-ttu-id="775e4-133">Fragmenty kodu i powiązane informacje znajdują się w witrynie [peer Channel i MessagePropagationFilter](https://docs.microsoft.com/archive/blogs/peerchan/peer-channel-and-messagepropagationfilter) post na blogu kanału równorzędnego.</span><span class="sxs-lookup"><span data-stu-id="775e4-133">For code snippets and related information, see the [Peer Channel and MessagePropagationFilter](https://docs.microsoft.com/archive/blogs/peerchan/peer-channel-and-messagepropagationfilter) post on the Peer Channel blog.</span></span>

## <a name="contacting-an-individual-node-in-the-mesh"></a><span data-ttu-id="775e4-134">Kontaktowanie się z pojedynczym węzłem w sieci</span><span class="sxs-lookup"><span data-stu-id="775e4-134">Contacting an Individual Node in the Mesh</span></span>

<span data-ttu-id="775e4-135">Można skontaktować się z pojedynczym węzłem w siatce przez skonfigurowanie lokalnego filtru lub przez skonfigurowanie połączenia bezpośredniego.</span><span class="sxs-lookup"><span data-stu-id="775e4-135">An individual node in a mesh can be contacted by setting up a local filter, or by setting up a direct connection.</span></span>

<span data-ttu-id="775e4-136">Jeśli węzły w siatce mają poszczególne identyfikatory, w implementacji wiadomości można określić identyfikator docelowy.</span><span class="sxs-lookup"><span data-stu-id="775e4-136">If the nodes in a mesh each have an individual ID, a destination ID can be specified in the implementation of your message.</span></span> <span data-ttu-id="775e4-137">Filtr lokalny można skonfigurować przez napisanie funkcji w kontrakcie wiadomości, która będzie wyświetlać komunikat tylko do bieżącego węzła, jeśli jego identyfikator jest zgodny z określonym IDENTYFIKATORem docelowym.</span><span class="sxs-lookup"><span data-stu-id="775e4-137">A local filter can be set up by writing a function in your message contract that will only display the message to the current node if its ID matches the destination ID you specified.</span></span> <span data-ttu-id="775e4-138">Siatka transportuje komunikat, dzięki czemu obciążenie związane z konfigurowaniem nowego połączenia nie musi być naliczane.</span><span class="sxs-lookup"><span data-stu-id="775e4-138">The mesh transports the message, so the overhead of setting up a new connection does not have to be incurred.</span></span> <span data-ttu-id="775e4-139">Istnieje jednak utrata wydajności, ponieważ wiadomość jest wysyłana wiele razy w całej sieci.</span><span class="sxs-lookup"><span data-stu-id="775e4-139">However, there is a loss of efficiency since the message is sent many times throughout the mesh.</span></span> <span data-ttu-id="775e4-140">Jest to dobre rozwiązanie w przypadku wysyłania komunikatów do poszczególnych elementów członkowskich siatki, o ile komunikaty nie są zbyt duże ani zbyt częste.</span><span class="sxs-lookup"><span data-stu-id="775e4-140">This works well for sending messages to individual members of a mesh as long as the messages are neither too big nor too frequent.</span></span>

<span data-ttu-id="775e4-141">W przypadku długotrwałych połączeń o dużej przepustowości preferowane są bezpośrednie połączenia.</span><span class="sxs-lookup"><span data-stu-id="775e4-141">For long-lasting, high-bandwidth connections, direct connections are preferable.</span></span> <span data-ttu-id="775e4-142">Informacje o połączeniu można wysłać przez siatkę, a następnie skonfigurować bezpośrednie połączenie z wybieraniem do wysyłania/odbierania wiadomości.</span><span class="sxs-lookup"><span data-stu-id="775e4-142">You can send connection information over the mesh, and then set up a direct connection of your choosing to send/receive messages.</span></span>

## <a name="choosing-an-approach-for-limiting-message-distribution"></a><span data-ttu-id="775e4-143">Wybieranie podejścia do ograniczania dystrybucji komunikatów</span><span class="sxs-lookup"><span data-stu-id="775e4-143">Choosing an Approach for Limiting Message Distribution</span></span>

<span data-ttu-id="775e4-144">Po znalezieniu scenariusza, w którym należy ograniczyć dystrybucję wiadomości, należy zadać sobie następujące pytania:</span><span class="sxs-lookup"><span data-stu-id="775e4-144">When you discover a scenario in which you need to limit message distribution, ask yourself the following questions:</span></span>

- <span data-ttu-id="775e4-145">**Kto** musi odebrać komunikat?</span><span class="sxs-lookup"><span data-stu-id="775e4-145">**Who** needs to receive the message?</span></span> <span data-ttu-id="775e4-146">Tylko jeden węzeł sąsiada?</span><span class="sxs-lookup"><span data-stu-id="775e4-146">Just one neighbor node?</span></span> <span data-ttu-id="775e4-147">Węzeł w innym miejscu siatki?</span><span class="sxs-lookup"><span data-stu-id="775e4-147">A node somewhere else in the mesh?</span></span> <span data-ttu-id="775e4-148">Połowa siatki?</span><span class="sxs-lookup"><span data-stu-id="775e4-148">Half the mesh?</span></span>

- <span data-ttu-id="775e4-149">**Jak często** będzie wysyłany ten komunikat?</span><span class="sxs-lookup"><span data-stu-id="775e4-149">**How often** will this message be sent?</span></span>

- <span data-ttu-id="775e4-150">Jakiego rodzaju **przepustowość** będzie używać ten komunikat?</span><span class="sxs-lookup"><span data-stu-id="775e4-150">What kind of **bandwidth** will this message use?</span></span>

<span data-ttu-id="775e4-151">Odpowiedzi na te pytania mogą pomóc w ustaleniu, czy użyć liczby przeskoków, filtru propagacji komunikatów, lokalnego filtru czy połączenia bezpośredniego.</span><span class="sxs-lookup"><span data-stu-id="775e4-151">The answers to these questions can help you determine whether to use Hop Count, a Message Propagation Filter, a local filter, or a direct connection.</span></span> <span data-ttu-id="775e4-152">Należy wziąć pod uwagę następujące ogólne wytyczne:</span><span class="sxs-lookup"><span data-stu-id="775e4-152">Consider the following general guidelines:</span></span>

- <span data-ttu-id="775e4-153">**Którzy**</span><span class="sxs-lookup"><span data-stu-id="775e4-153">**Who**</span></span>

  - <span data-ttu-id="775e4-154">*Pojedynczy węzeł*: filtr lokalny lub bezpośrednie połączenie.</span><span class="sxs-lookup"><span data-stu-id="775e4-154">*Individual node*:  Local filter or direct connection.</span></span>

  - <span data-ttu-id="775e4-155">*Sąsiedzi w określonym sąsiedztwie*: PeerHopCount.</span><span class="sxs-lookup"><span data-stu-id="775e4-155">*Neighbors within a certain vicinity*:  PeerHopCount.</span></span>

  - <span data-ttu-id="775e4-156">*Złożony podzestaw siatki*: MessagePropagationFilter.</span><span class="sxs-lookup"><span data-stu-id="775e4-156">*Complex subset of the mesh*:  MessagePropagationFilter.</span></span>

- <span data-ttu-id="775e4-157">**Jak często**</span><span class="sxs-lookup"><span data-stu-id="775e4-157">**How often**</span></span>

  - <span data-ttu-id="775e4-158">*Bardzo częste*: połączenie bezpośrednie, PeerHopCount, MessagePropagationFilter.</span><span class="sxs-lookup"><span data-stu-id="775e4-158">*Very frequent*:  Direct connection, PeerHopCount, MessagePropagationFilter.</span></span>

  - <span data-ttu-id="775e4-159">*Sporadycznie*: filtr lokalny.</span><span class="sxs-lookup"><span data-stu-id="775e4-159">*Occasional*:  Local filter.</span></span>

- <span data-ttu-id="775e4-160">**Wykorzystanie przepustowości**</span><span class="sxs-lookup"><span data-stu-id="775e4-160">**Bandwidth use**</span></span>

  - <span data-ttu-id="775e4-161">*Wysoki*: bezpośrednie połączenie, mniej zalecane do użycia MessagePropagationFilter lub filtru lokalnego.</span><span class="sxs-lookup"><span data-stu-id="775e4-161">*High*:  Direct connection, less advisable to use MessagePropagationFilter or local filter.</span></span>

  - <span data-ttu-id="775e4-162">*Niska*: dowolne, bezpośrednie połączenie prawdopodobnie nie jest potrzebne.</span><span class="sxs-lookup"><span data-stu-id="775e4-162">*Low*:  Any, direct connection probably not needed.</span></span>

## <a name="see-also"></a><span data-ttu-id="775e4-163">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="775e4-163">See also</span></span>

- [<span data-ttu-id="775e4-164">Tworzenie aplikacji kanału równorzędnego</span><span class="sxs-lookup"><span data-stu-id="775e4-164">Building a Peer Channel Application</span></span>](building-a-peer-channel-application.md)
