---
title: Debugowanie błędów uwierzytelniania systemu Windows
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
- WCF, Windows authentication
ms.assetid: 181be4bd-79b1-4a66-aee2-931887a6d7cc
ms.openlocfilehash: d9226324b69e5c27738abb35bb155a43964b9127
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 05/04/2018
ms.locfileid: "33495876"
---
# <a name="debugging-windows-authentication-errors"></a><span data-ttu-id="34f59-102">Debugowanie błędów uwierzytelniania systemu Windows</span><span class="sxs-lookup"><span data-stu-id="34f59-102">Debugging Windows Authentication Errors</span></span>
<span data-ttu-id="34f59-103">Korzystając z uwierzytelniania systemu Windows jako mechanizm zabezpieczeń, interfejsu dostawcy obsługi zabezpieczeń (SSPI) obsługuje procesów zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="34f59-103">When using Windows authentication as a security mechanism, the Security Support Provider Interface (SSPI) handles security processes.</span></span> <span data-ttu-id="34f59-104">W przypadku wystąpienia błędów zabezpieczeń w warstwie SSPI, są one udostępniane przez Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="34f59-104">When security errors occur at the SSPI layer, they are surfaced by Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="34f59-105">Ten temat zawiera framework i zestawu pytania, aby pomóc w zdiagnozowaniu błędów.</span><span class="sxs-lookup"><span data-stu-id="34f59-105">This topic provides a framework and set of questions to help diagnose the errors.</span></span>  
  
 <span data-ttu-id="34f59-106">Omówienie protokołu Kerberos, zobacz [protokołu Kerberos](http://go.microsoft.com/fwlink/?LinkID=86946); w przypadku zobacz omówienie interfejsu SSPI, [SSPI](http://go.microsoft.com/fwlink/?LinkId=88941).</span><span class="sxs-lookup"><span data-stu-id="34f59-106">For an overview of the Kerberos protocol, see [Kerberos Explained](http://go.microsoft.com/fwlink/?LinkID=86946); for an overview of SSPI, see [SSPI](http://go.microsoft.com/fwlink/?LinkId=88941).</span></span>  
  
 <span data-ttu-id="34f59-107">W przypadku uwierzytelniania systemu Windows, zazwyczaj używa WCF *Negotiate* Obsługa dostawca zabezpieczeń (SSP), który przeprowadza uwierzytelnianie wzajemne Kerberos między klientem a usługą.</span><span class="sxs-lookup"><span data-stu-id="34f59-107">For Windows authentication, WCF typically uses the *Negotiate* Security Support Provider (SSP), which performs Kerberos mutual authentication between the client and service.</span></span> <span data-ttu-id="34f59-108">Jeśli protokół Kerberos nie jest dostępny, domyślnie WCF powraca do programu NT LAN Manager (NTLM).</span><span class="sxs-lookup"><span data-stu-id="34f59-108">If the Kerberos protocol is not available, by default WCF falls back to NT LAN Manager (NTLM).</span></span> <span data-ttu-id="34f59-109">Można jednak skonfigurować WCF do korzystania z protokołu Kerberos (i Zgłoś wyjątek, jeśli protokół Kerberos nie jest dostępna).</span><span class="sxs-lookup"><span data-stu-id="34f59-109">However, you can configure WCF to use only the Kerberos protocol (and to throw an exception if Kerberos is not available).</span></span> <span data-ttu-id="34f59-110">Można również skonfigurować usługi WCF do użycia formularze ograniczone protokołu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="34f59-110">You can also configure WCF to use restricted forms of the Kerberos protocol.</span></span>  
  
## <a name="debugging-methodology"></a><span data-ttu-id="34f59-111">Metodologia debugowania</span><span class="sxs-lookup"><span data-stu-id="34f59-111">Debugging Methodology</span></span>  
 <span data-ttu-id="34f59-112">Podstawowa metoda wygląda następująco:</span><span class="sxs-lookup"><span data-stu-id="34f59-112">The basic method is as follows:</span></span>  
  
1.  <span data-ttu-id="34f59-113">Określ, czy używasz uwierzytelniania systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="34f59-113">Determine whether you are using Windows authentication.</span></span> <span data-ttu-id="34f59-114">Jeśli korzystasz z innego systemu, w tym temacie nie ma zastosowania.</span><span class="sxs-lookup"><span data-stu-id="34f59-114">If you are using any other scheme, this topic does not apply.</span></span>  
  
2.  <span data-ttu-id="34f59-115">Jeśli masz pewność, że używasz uwierzytelniania systemu Windows, należy określić, czy konfiguracji WCF używa protokołu Kerberos, bezpośrednio lub Negotiate.</span><span class="sxs-lookup"><span data-stu-id="34f59-115">If you are sure you are using Windows authentication, determine whether your WCF configuration uses Kerberos direct or Negotiate.</span></span>  
  
3.  <span data-ttu-id="34f59-116">Po określeniu, czy konfiguracja jest przy użyciu protokołu Kerberos lub NTLM, można zrozumieć, komunikaty o błędach w poprawny kontekst.</span><span class="sxs-lookup"><span data-stu-id="34f59-116">Once you have determined whether your configuration is using the Kerberos protocol or NTLM, you can understand error messages in the correct context.</span></span>  
  
### <a name="availability-of-the-kerberos-protocol-and-ntlm"></a><span data-ttu-id="34f59-117">Dostępność protokołu Kerberos i NTLM</span><span class="sxs-lookup"><span data-stu-id="34f59-117">Availability of the Kerberos Protocol and NTLM</span></span>  
 <span data-ttu-id="34f59-118">Dostawca obsługi zabezpieczeń Kerberos wymaga kontrolera domeny do działania jako centrum dystrybucji kluczy (KDC) protokołu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="34f59-118">The Kerberos SSP requires a domain controller to act as the Kerberos Key Distribution Center (KDC).</span></span> <span data-ttu-id="34f59-119">Protokół Kerberos jest dostępne tylko wtedy, gdy klient i usługa są przy użyciu tożsamości domeny.</span><span class="sxs-lookup"><span data-stu-id="34f59-119">The Kerberos protocol is available only when both the client and service are using domain identities.</span></span> <span data-ttu-id="34f59-120">W innych kombinacji kont NTLM jest używany, zgodnie z opisem w poniższej tabeli.</span><span class="sxs-lookup"><span data-stu-id="34f59-120">In other account combinations, NTLM is used, as summarized in the following table.</span></span>  
  
 <span data-ttu-id="34f59-121">Nagłówki tabeli przedstawiono typy kont używane przez serwer.</span><span class="sxs-lookup"><span data-stu-id="34f59-121">The table headers show possible account types used by the server.</span></span> <span data-ttu-id="34f59-122">W lewej kolumnie pokazany typów kont używanych przez klienta.</span><span class="sxs-lookup"><span data-stu-id="34f59-122">The left column shows possible account types used by the client.</span></span>  
  
||<span data-ttu-id="34f59-123">Użytkownik lokalny</span><span class="sxs-lookup"><span data-stu-id="34f59-123">Local User</span></span>|<span data-ttu-id="34f59-124">System lokalny</span><span class="sxs-lookup"><span data-stu-id="34f59-124">Local System</span></span>|<span data-ttu-id="34f59-125">Użytkownik domeny</span><span class="sxs-lookup"><span data-stu-id="34f59-125">Domain User</span></span>|<span data-ttu-id="34f59-126">Komputerze domeny</span><span class="sxs-lookup"><span data-stu-id="34f59-126">Domain Machine</span></span>|  
|-|----------------|------------------|-----------------|--------------------|  
|<span data-ttu-id="34f59-127">Użytkownik lokalny</span><span class="sxs-lookup"><span data-stu-id="34f59-127">Local User</span></span>|<span data-ttu-id="34f59-128">NTLM</span><span class="sxs-lookup"><span data-stu-id="34f59-128">NTLM</span></span>|<span data-ttu-id="34f59-129">NTLM</span><span class="sxs-lookup"><span data-stu-id="34f59-129">NTLM</span></span>|<span data-ttu-id="34f59-130">NTLM</span><span class="sxs-lookup"><span data-stu-id="34f59-130">NTLM</span></span>|<span data-ttu-id="34f59-131">NTLM</span><span class="sxs-lookup"><span data-stu-id="34f59-131">NTLM</span></span>|  
|<span data-ttu-id="34f59-132">System lokalny</span><span class="sxs-lookup"><span data-stu-id="34f59-132">Local System</span></span>|<span data-ttu-id="34f59-133">Anonimowe NTLM</span><span class="sxs-lookup"><span data-stu-id="34f59-133">Anonymous NTLM</span></span>|<span data-ttu-id="34f59-134">Anonimowe NTLM</span><span class="sxs-lookup"><span data-stu-id="34f59-134">Anonymous NTLM</span></span>|<span data-ttu-id="34f59-135">Anonimowe NTLM</span><span class="sxs-lookup"><span data-stu-id="34f59-135">Anonymous NTLM</span></span>|<span data-ttu-id="34f59-136">Anonimowe NTLM</span><span class="sxs-lookup"><span data-stu-id="34f59-136">Anonymous NTLM</span></span>|  
|<span data-ttu-id="34f59-137">Użytkownik domeny</span><span class="sxs-lookup"><span data-stu-id="34f59-137">Domain User</span></span>|<span data-ttu-id="34f59-138">NTLM</span><span class="sxs-lookup"><span data-stu-id="34f59-138">NTLM</span></span>|<span data-ttu-id="34f59-139">NTLM</span><span class="sxs-lookup"><span data-stu-id="34f59-139">NTLM</span></span>|<span data-ttu-id="34f59-140">Kerberos</span><span class="sxs-lookup"><span data-stu-id="34f59-140">Kerberos</span></span>|<span data-ttu-id="34f59-141">Kerberos</span><span class="sxs-lookup"><span data-stu-id="34f59-141">Kerberos</span></span>|  
|<span data-ttu-id="34f59-142">Komputerze domeny</span><span class="sxs-lookup"><span data-stu-id="34f59-142">Domain Machine</span></span>|<span data-ttu-id="34f59-143">NTLM</span><span class="sxs-lookup"><span data-stu-id="34f59-143">NTLM</span></span>|<span data-ttu-id="34f59-144">NTLM</span><span class="sxs-lookup"><span data-stu-id="34f59-144">NTLM</span></span>|<span data-ttu-id="34f59-145">Kerberos</span><span class="sxs-lookup"><span data-stu-id="34f59-145">Kerberos</span></span>|<span data-ttu-id="34f59-146">Kerberos</span><span class="sxs-lookup"><span data-stu-id="34f59-146">Kerberos</span></span>|  
  
 <span data-ttu-id="34f59-147">W szczególności cztery typy kont obejmują:</span><span class="sxs-lookup"><span data-stu-id="34f59-147">Specifically, the four account types include:</span></span>  
  
-   <span data-ttu-id="34f59-148">Użytkownika lokalnego: Profil użytkownika tylko do komputera.</span><span class="sxs-lookup"><span data-stu-id="34f59-148">Local User: Machine-only user profile.</span></span> <span data-ttu-id="34f59-149">Na przykład: `MachineName\Administrator` lub `MachineName\ProfileName`.</span><span class="sxs-lookup"><span data-stu-id="34f59-149">For example: `MachineName\Administrator` or `MachineName\ProfileName`.</span></span>  
  
-   <span data-ttu-id="34f59-150">System lokalny: Wbudowane konto systemowe na komputerze, na którym nie jest przyłączony do domeny.</span><span class="sxs-lookup"><span data-stu-id="34f59-150">Local System: The built-in account SYSTEM on a machine that is not joined to a domain.</span></span>  
  
-   <span data-ttu-id="34f59-151">Użytkownik domeny: Konto użytkownika w domenie systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="34f59-151">Domain User: A user account on a Windows domain.</span></span> <span data-ttu-id="34f59-152">Na przykład: `DomainName\ProfileName`.</span><span class="sxs-lookup"><span data-stu-id="34f59-152">For example: `DomainName\ProfileName`.</span></span>  
  
-   <span data-ttu-id="34f59-153">Komputer do domeny: Proces z tożsamością maszyny uruchomiony na komputer przyłączony do domeny systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="34f59-153">Domain Machine: A process with machine identity running on a machine joined to a Windows domain.</span></span> <span data-ttu-id="34f59-154">Na przykład: `MachineName\Network Service`.</span><span class="sxs-lookup"><span data-stu-id="34f59-154">For example: `MachineName\Network Service`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="34f59-155">Poświadczenie usługi są przechwytywane podczas <xref:System.ServiceModel.ICommunicationObject.Open%2A> metody <xref:System.ServiceModel.ServiceHost> nosi nazwę klasy.</span><span class="sxs-lookup"><span data-stu-id="34f59-155">The service credential is captured when the <xref:System.ServiceModel.ICommunicationObject.Open%2A> method of the <xref:System.ServiceModel.ServiceHost> class is called.</span></span> <span data-ttu-id="34f59-156">Poświadczenie klienta jest do odczytu zawsze, gdy klient wysyła wiadomość.</span><span class="sxs-lookup"><span data-stu-id="34f59-156">The client credential is read whenever the client sends a message.</span></span>  
  
## <a name="common-windows-authentication-problems"></a><span data-ttu-id="34f59-157">Typowe problemy z uwierzytelnianiem systemu Windows</span><span class="sxs-lookup"><span data-stu-id="34f59-157">Common Windows Authentication Problems</span></span>  
 <span data-ttu-id="34f59-158">W tej sekcji opisano niektóre typowe problemy z uwierzytelnianiem systemu Windows i możliwości.</span><span class="sxs-lookup"><span data-stu-id="34f59-158">This section discusses some common Windows authentication problems and possible remedies.</span></span>  
  
### <a name="kerberos-protocol"></a><span data-ttu-id="34f59-159">Protokół Kerberos</span><span class="sxs-lookup"><span data-stu-id="34f59-159">Kerberos Protocol</span></span>  
  
#### <a name="spnupn-problems-with-the-kerberos-protocol"></a><span data-ttu-id="34f59-160">Nazwa SPN/nazwa UPN problemów przy użyciu protokołu Kerberos</span><span class="sxs-lookup"><span data-stu-id="34f59-160">SPN/UPN Problems with the Kerberos Protocol</span></span>  
 <span data-ttu-id="34f59-161">Korzystając z uwierzytelniania systemu Windows i protokołu Kerberos, protokół jest używany lub wynegocjowanym przez interfejs SSPI, adres URL punktu końcowego klienta używa musi zawierać w pełni kwalifikowana nazwa domeny hosta usługi wewnątrz adres URL usługi.</span><span class="sxs-lookup"><span data-stu-id="34f59-161">When using Windows authentication, and the Kerberos protocol is used or negotiated by SSPI, the URL the client endpoint uses must include the fully qualified domain name of the service's host inside the service URL.</span></span> <span data-ttu-id="34f59-162">Przy założeniu, że konto, na którym uruchomiono usługę ma prawa dostępu do klucza głównej nazwy (usługi SPN) usługi maszyny (ustawienie domyślne), który jest tworzony po dodaniu komputera do domeny usługi Active Directory, najczęściej jest to zrobić, uruchamiając usługi w Konto Usługa sieciowa.</span><span class="sxs-lookup"><span data-stu-id="34f59-162">This assumes that the account under which the service is running has access to the machine (default) service principal name (SPN) key that is created when the computer is added to the Active Directory domain, which is most commonly done by running the service under the Network Service account.</span></span> <span data-ttu-id="34f59-163">Jeśli usługa nie ma dostępu do klucza SPN komputera, należy podać poprawną nazwę SPN lub użytkownika nazwę główną (UPN) konta, pod którym usługa jest uruchomiona w tożsamości punktu końcowego klienta.</span><span class="sxs-lookup"><span data-stu-id="34f59-163">If the service does not have access to the machine SPN key, you must supply the correct SPN or user principal name (UPN) of the account under which the service is running in the client's endpoint identity.</span></span> <span data-ttu-id="34f59-164">Aby uzyskać więcej informacji na temat działania usługi WCF z nazw SPN i UPN, zobacz [uwierzytelnianie i tożsamość usługi](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="34f59-164">For more information about how WCF works with SPN and UPN, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span></span>  
  
 <span data-ttu-id="34f59-165">W programie Równoważenie obciążenia scenariusze, takie jak farmy serwerów sieci Web lub ogrodach sieci Web popularną praktyką jest zdefiniuj unikatowe konto dla poszczególnych aplikacji, Przypisz nazwę SPN dla tego konta i upewnij się, że wszystkie usługi aplikacji uruchomione na tym koncie.</span><span class="sxs-lookup"><span data-stu-id="34f59-165">In load-balancing scenarios, such as Web farms or Web gardens, a common practice is to define a unique account for each application, assign an SPN to that account, and ensure that all of the application's services run in that account.</span></span>  
  
 <span data-ttu-id="34f59-166">Aby uzyskać nazwę SPN konta usługi, musisz być administratorem domeny usługi Active Directory.</span><span class="sxs-lookup"><span data-stu-id="34f59-166">To obtain an SPN for your service's account, you need to be an Active Directory domain administrator.</span></span> <span data-ttu-id="34f59-167">Aby uzyskać więcej informacji, zobacz [Kerberos techniczne dodatku dla systemu Windows](http://go.microsoft.com/fwlink/?LinkID=88330).</span><span class="sxs-lookup"><span data-stu-id="34f59-167">For more information, see [Kerberos Technical Supplement for Windows](http://go.microsoft.com/fwlink/?LinkID=88330).</span></span>  
  
#### <a name="kerberos-protocol-direct-requires-the-service-to-run-under-a-domain-machine-account"></a><span data-ttu-id="34f59-168">Protokół Kerberos Direct wymaga usługi do uruchomienia konta komputera do domeny</span><span class="sxs-lookup"><span data-stu-id="34f59-168">Kerberos Protocol Direct Requires the Service to Run Under a Domain Machine Account</span></span>  
 <span data-ttu-id="34f59-169">Dzieje się tak, gdy `ClientCredentialType` właściwość jest ustawiona na `Windows` i <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> właściwość jest ustawiona na `false`, jak pokazano w poniższym kodzie.</span><span class="sxs-lookup"><span data-stu-id="34f59-169">This occurs when the `ClientCredentialType` property is set to `Windows` and the <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> property is set to `false`, as shown in the following code.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#1)]
 [!code-vb[C_DebuggingWindowsAuth#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#1)]  
  
 <span data-ttu-id="34f59-170">Aby rozwiązać, uruchom tę usługę, używając konta domeny komputera, na przykład usługi sieciowej, w domenie przyłączone do komputera.</span><span class="sxs-lookup"><span data-stu-id="34f59-170">To remedy, run the service using a Domain Machine account, such as Network Service, on a domain joined machine.</span></span>  
  
### <a name="delegation-requires-credential-negotiation"></a><span data-ttu-id="34f59-171">Delegowanie wymaga negocjowania poświadczeń</span><span class="sxs-lookup"><span data-stu-id="34f59-171">Delegation Requires Credential Negotiation</span></span>  
 <span data-ttu-id="34f59-172">Aby używać protokołu uwierzytelniania Kerberos z delegowania, musi implementować protokołu Kerberos z negocjowania poświadczeń (nazywane czasem "wieloetapowego" lub "wieloetapowych" Kerberos).</span><span class="sxs-lookup"><span data-stu-id="34f59-172">To use the Kerberos authentication protocol with delegation, you must implement the Kerberos protocol with credential negotiation (sometimes called "multi-leg" or "multi-step" Kerberos).</span></span> <span data-ttu-id="34f59-173">Uwierzytelnianie Kerberos w przypadku zastosowania bez negocjowania poświadczeń (nazywane czasem "jednorazowej" lub "jeden etap" Kerberos), zostanie wygenerowany wyjątek.</span><span class="sxs-lookup"><span data-stu-id="34f59-173">If you implement Kerberos authentication without credential negotiation (sometimes called "one-shot" or "single-leg" Kerberos), an exception will be thrown.</span></span>  
  
 <span data-ttu-id="34f59-174">Do implementowania protokołu Kerberos z negocjowania poświadczeń, wykonaj następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="34f59-174">To implement Kerberos with credential negotiation, do the following steps:</span></span>  
  
1.  <span data-ttu-id="34f59-175">Implementowanie delegowania przez ustawienie <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> do <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span><span class="sxs-lookup"><span data-stu-id="34f59-175">Implement delegation by setting <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> to <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span>  
  
2.  <span data-ttu-id="34f59-176">Wymagaj negocjowanie interfejsu SSPI:</span><span class="sxs-lookup"><span data-stu-id="34f59-176">Require SSPI negotiation:</span></span>  
  
    1.  <span data-ttu-id="34f59-177">Jeśli używasz standardowego powiązania ustawić `NegotiateServiceCredential` właściwości `true`.</span><span class="sxs-lookup"><span data-stu-id="34f59-177">If you are using standard bindings, set the `NegotiateServiceCredential` property to `true`.</span></span>  
  
    2.  <span data-ttu-id="34f59-178">Jeśli używasz niestandardowego powiązania, ustaw `AuthenticationMode` atrybutu `Security` elementu `SspiNegotiated`.</span><span class="sxs-lookup"><span data-stu-id="34f59-178">If you are using custom bindings, set the `AuthenticationMode` attribute of the `Security` element to `SspiNegotiated`.</span></span>  
  
3.  <span data-ttu-id="34f59-179">Wymagaj negocjowanie interfejsu SSPI, aby używać protokołu Kerberos, zezwalając na korzystanie z uwierzytelniania NTLM:</span><span class="sxs-lookup"><span data-stu-id="34f59-179">Require the SSPI negotiation to use Kerberos by disallowing the use of NTLM:</span></span>  
  
    1.  <span data-ttu-id="34f59-180">Wykonaj następujące czynności w kodzie, z następujących instrukcji: `ChannelFactory.Credentials.Windows.AllowNtlm = false`</span><span class="sxs-lookup"><span data-stu-id="34f59-180">Do this in code, with the following statement: `ChannelFactory.Credentials.Windows.AllowNtlm = false`</span></span>  
  
    2.  <span data-ttu-id="34f59-181">Lub możesz zrobić to w pliku konfiguracji przez ustawienie `allowNtlm` atrybutu `false`.</span><span class="sxs-lookup"><span data-stu-id="34f59-181">Or you can do this in the configuration file by setting the `allowNtlm` attribute to `false`.</span></span> <span data-ttu-id="34f59-182">Ten atrybut jest zawarta w [ \<windows >](../../../../docs/framework/configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md).</span><span class="sxs-lookup"><span data-stu-id="34f59-182">This attribute is contained in the [\<windows>](../../../../docs/framework/configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md).</span></span>  
  
### <a name="ntlm-protocol"></a><span data-ttu-id="34f59-183">Protokół NTLM</span><span class="sxs-lookup"><span data-stu-id="34f59-183">NTLM Protocol</span></span>  
  
#### <a name="negotiate-ssp-falls-back-to-ntlm-but-ntlm-is-disabled"></a><span data-ttu-id="34f59-184">Negocjowania SSP powróci do uwierzytelniania NTLM, ale uwierzytelnianie NTLM jest wyłączone.</span><span class="sxs-lookup"><span data-stu-id="34f59-184">Negotiate SSP Falls Back to NTLM, but NTLM Is Disabled</span></span>  
 <span data-ttu-id="34f59-185"><xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> Właściwość jest ustawiona na `false`, co powoduje, że Windows Communication Foundation (WCF) aby optymalnych zostać zgłoszony wyjątek, jeśli używane jest uwierzytelnianie NTLM.</span><span class="sxs-lookup"><span data-stu-id="34f59-185">The <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> property is set to `false`, which causes Windows Communication Foundation (WCF) to make a best-effort to throw an exception if NTLM is used.</span></span> <span data-ttu-id="34f59-186">Należy pamiętać, że ustawienie tej właściwości na `false` może uniemożliwia poświadczeń NTLM są przesyłane przez sieć.</span><span class="sxs-lookup"><span data-stu-id="34f59-186">Note that setting this property to `false` may not prevent NTLM credentials from being sent over the wire.</span></span>  
  
 <span data-ttu-id="34f59-187">Poniżej przedstawiono sposób wyłączania powrotu do uwierzytelniania NTLM.</span><span class="sxs-lookup"><span data-stu-id="34f59-187">The following shows how to disable fallback to NTLM.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#4)]
 [!code-vb[C_DebuggingWindowsAuth#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#4)]  
  
#### <a name="ntlm-logon-fails"></a><span data-ttu-id="34f59-188">Niepowodzenia logowania NTLM</span><span class="sxs-lookup"><span data-stu-id="34f59-188">NTLM Logon Fails</span></span>  
 <span data-ttu-id="34f59-189">Poświadczenia klienta nie są prawidłowe w usłudze.</span><span class="sxs-lookup"><span data-stu-id="34f59-189">The client credentials are not valid on the service.</span></span> <span data-ttu-id="34f59-190">Sprawdź, czy nazwa użytkownika i hasło są poprawnie ustawione i odpowiadać na konto, które jest znany na komputerze, na którym jest uruchomiona usługa.</span><span class="sxs-lookup"><span data-stu-id="34f59-190">Check that the user name and password are correctly set and correspond to an account that is known to the computer where the service is running.</span></span> <span data-ttu-id="34f59-191">NTLM korzysta z określonych poświadczeń do logowania się do komputera usługi.</span><span class="sxs-lookup"><span data-stu-id="34f59-191">NTLM uses the specified credentials to log on to the service's computer.</span></span> <span data-ttu-id="34f59-192">Poświadczenia mogą być prawidłowy na komputerze, na którym działa klient, to logowanie zakończy się niepowodzeniem, jeśli poświadczenia nie są prawidłowe dla komputera usługi.</span><span class="sxs-lookup"><span data-stu-id="34f59-192">While the credentials may be valid on the computer where the client is running, this logon will fail if the credentials are not valid on the service's computer.</span></span>  
  
#### <a name="anonymous-ntlm-logon-occurs-but-anonymous-logons-are-disabled-by-default"></a><span data-ttu-id="34f59-193">Logowania z anonimowych NTLM występuje, ale anonimowego logowania są domyślnie wyłączone</span><span class="sxs-lookup"><span data-stu-id="34f59-193">Anonymous NTLM Logon Occurs, but Anonymous Logons Are Disabled by Default</span></span>  
 <span data-ttu-id="34f59-194">Podczas tworzenia klienta, <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> właściwość jest ustawiona na <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, jak pokazano w poniższym przykładzie, ale domyślnie serwer nie zezwala na logowanie anonimowe.</span><span class="sxs-lookup"><span data-stu-id="34f59-194">When creating a client, the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property is set to <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, as shown in the following example, but by default the server disallows anonymous logons.</span></span> <span data-ttu-id="34f59-195">Dzieje się tak, ponieważ domyślna wartość <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> właściwość <xref:System.ServiceModel.Security.WindowsServiceCredential> jest klasa `false`.</span><span class="sxs-lookup"><span data-stu-id="34f59-195">This occurs because the default value of the <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> property of the <xref:System.ServiceModel.Security.WindowsServiceCredential> class is `false`.</span></span>  
  
 <span data-ttu-id="34f59-196">Poniższy kod klienta próbuje włączyć anonimowego logowania (należy pamiętać, że jest właściwością domyślną `Identification`).</span><span class="sxs-lookup"><span data-stu-id="34f59-196">The following client code attempts to enable anonymous logons (note that the default property is `Identification`).</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#5)]
 [!code-vb[C_DebuggingWindowsAuth#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#5)]  
  
 <span data-ttu-id="34f59-197">Poniższy kod usługi zmienia domyślne można włączyć anonimowego logowania przez serwer.</span><span class="sxs-lookup"><span data-stu-id="34f59-197">The following service code changes the default to enable anonymous logons by the server.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#6)]
 [!code-vb[C_DebuggingWindowsAuth#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#6)]  
  
 <span data-ttu-id="34f59-198">Aby uzyskać więcej informacji o personifikacji, zobacz [delegowanie i personifikacja](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="34f59-198">For more information about impersonation, see [Delegation and Impersonation](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span></span>  
  
 <span data-ttu-id="34f59-199">Alternatywnie klient jest uruchomiony jako usługa systemu Windows przy użyciu wbudowanego konta SYSTEM.</span><span class="sxs-lookup"><span data-stu-id="34f59-199">Alternatively, the client is running as a Windows service, using the built-in account SYSTEM.</span></span>  
  
### <a name="other-problems"></a><span data-ttu-id="34f59-200">Inne problemy</span><span class="sxs-lookup"><span data-stu-id="34f59-200">Other Problems</span></span>  
  
#### <a name="client-credentials-are-not-set-correctly"></a><span data-ttu-id="34f59-201">Poświadczenia klienta nie są poprawnie ustawione.</span><span class="sxs-lookup"><span data-stu-id="34f59-201">Client Credentials Are Not Set Correctly</span></span>  
 <span data-ttu-id="34f59-202">Uwierzytelnianie systemu Windows przy użyciu <xref:System.ServiceModel.Security.WindowsClientCredential> zwrócone przez wystąpienie <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> właściwość <xref:System.ServiceModel.ClientBase%601> klasy nie <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span><span class="sxs-lookup"><span data-stu-id="34f59-202">Windows authentication uses the <xref:System.ServiceModel.Security.WindowsClientCredential> instance returned by the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the <xref:System.ServiceModel.ClientBase%601> class, not the <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span></span> <span data-ttu-id="34f59-203">Poniżej przedstawiono przykład nieprawidłowy.</span><span class="sxs-lookup"><span data-stu-id="34f59-203">The following shows an incorrect example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#2)]
 [!code-vb[C_DebuggingWindowsAuth#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#2)]  
  
 <span data-ttu-id="34f59-204">Poniżej przedstawiono przykład poprawnego.</span><span class="sxs-lookup"><span data-stu-id="34f59-204">The following shows the correct example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#3)]
 [!code-vb[C_DebuggingWindowsAuth#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#3)]  
  
#### <a name="sspi-is-not-available"></a><span data-ttu-id="34f59-205">Interfejs SSPI nie jest dostępna</span><span class="sxs-lookup"><span data-stu-id="34f59-205">SSPI Is Not Available</span></span>  
 <span data-ttu-id="34f59-206">Następujące systemy operacyjne nie obsługują uwierzytelnianie systemu Windows, gdy jest używany jako serwer: [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Media Center Edition i [!INCLUDE[wv](../../../../includes/wv-md.md)]Home Edition.</span><span class="sxs-lookup"><span data-stu-id="34f59-206">The following operating systems do not support Windows authentication when used as a server: [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition, [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Media Center Edition, and [!INCLUDE[wv](../../../../includes/wv-md.md)]Home editions.</span></span>  
  
#### <a name="developing-and-deploying-with-different-identities"></a><span data-ttu-id="34f59-207">Tworzenie i wdrażanie z różnych tożsamości</span><span class="sxs-lookup"><span data-stu-id="34f59-207">Developing and Deploying with Different Identities</span></span>  
 <span data-ttu-id="34f59-208">Jeśli aplikacja na komputerze i wdrażanie na innym i używają różnych typów kont do uwierzytelniania na każdej maszynie, możesz napotkać inaczej.</span><span class="sxs-lookup"><span data-stu-id="34f59-208">If you develop your application on one machine, and deploy on another, and use different account types to authenticate on each machine, you may experience different behavior.</span></span> <span data-ttu-id="34f59-209">Na przykład, załóżmy, że opracowywanie aplikacji przy użyciu systemu Windows XP Pro maszyny `SSPI Negotiated` tryb uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="34f59-209">For example, suppose you develop your application on a Windows XP Pro machine using the `SSPI Negotiated` authentication mode.</span></span> <span data-ttu-id="34f59-210">Jeśli używasz konta użytkownika lokalnego uwierzytelniania za pomocą protokołu NTLM będzie używany.</span><span class="sxs-lookup"><span data-stu-id="34f59-210">If you use a local user account to authenticate with, then NTLM protocol will be used.</span></span> <span data-ttu-id="34f59-211">Po aplikacji do opracowania, możesz wdrożyć usługę do maszyny z systemem Windows Server 2003, którym został uruchomiony w ramach konta domeny.</span><span class="sxs-lookup"><span data-stu-id="34f59-211">Once the application is developed, you deploy the service to a Windows Server 2003 machine where it runs under a domain account.</span></span> <span data-ttu-id="34f59-212">W tym momencie klienta nie będzie do uwierzytelniania usługi, ponieważ będą używać protokołu Kerberos i kontrolera domeny.</span><span class="sxs-lookup"><span data-stu-id="34f59-212">At this point the client will not be able to authenticate the service because it will be using Kerberos and a domain controller.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="34f59-213">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="34f59-213">See Also</span></span>  
 <xref:System.ServiceModel.Security.WindowsClientCredential>  
 <xref:System.ServiceModel.Security.WindowsServiceCredential>  
 <xref:System.ServiceModel.Security.WindowsClientCredential>  
 <xref:System.ServiceModel.ClientBase%601>  
 [<span data-ttu-id="34f59-214">Delegowanie i personifikacja</span><span class="sxs-lookup"><span data-stu-id="34f59-214">Delegation and Impersonation</span></span>](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)  
 [<span data-ttu-id="34f59-215">Nieobsługiwane scenariusze</span><span class="sxs-lookup"><span data-stu-id="34f59-215">Unsupported Scenarios</span></span>](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md)
