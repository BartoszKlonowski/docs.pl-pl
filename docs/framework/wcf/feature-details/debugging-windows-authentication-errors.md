---
title: Debugowanie błędów uwierzytelniania systemu Windows
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
- WCF, Windows authentication
ms.assetid: 181be4bd-79b1-4a66-aee2-931887a6d7cc
ms.openlocfilehash: 45f4185df1c55ff40fce3e33fe5e0e497fa54654
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: HT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/08/2019
ms.locfileid: "59228267"
---
# <a name="debugging-windows-authentication-errors"></a><span data-ttu-id="8d7b1-102">Debugowanie błędów uwierzytelniania systemu Windows</span><span class="sxs-lookup"><span data-stu-id="8d7b1-102">Debugging Windows Authentication Errors</span></span>
<span data-ttu-id="8d7b1-103">Korzystając z uwierzytelniania Windows jako mechanizm bezpieczeństwa, interfejs dostawcy obsługi zabezpieczeń (SSPI) obsługuje zabezpieczenia procesów.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-103">When using Windows authentication as a security mechanism, the Security Support Provider Interface (SSPI) handles security processes.</span></span> <span data-ttu-id="8d7b1-104">Po wystąpieniu błędów zabezpieczeń w warstwie interfejsu SSPI, są one udostępniane przez Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="8d7b1-104">When security errors occur at the SSPI layer, they are surfaced by Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="8d7b1-105">Ten temat zawiera framework i zestaw pytań, aby łatwiej diagnozować błędy.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-105">This topic provides a framework and set of questions to help diagnose the errors.</span></span>  
  
 <span data-ttu-id="8d7b1-106">Omówienie protokołu Kerberos, zobacz [protokołu Kerberos](https://go.microsoft.com/fwlink/?LinkID=86946); zobacz omówienie interfejsu SSPI, [SSPI](https://go.microsoft.com/fwlink/?LinkId=88941).</span><span class="sxs-lookup"><span data-stu-id="8d7b1-106">For an overview of the Kerberos protocol, see [Kerberos Explained](https://go.microsoft.com/fwlink/?LinkID=86946); for an overview of SSPI, see [SSPI](https://go.microsoft.com/fwlink/?LinkId=88941).</span></span>  
  
 <span data-ttu-id="8d7b1-107">W przypadku uwierzytelniania Windows WCF zwykle korzysta z *Negotiate* Dostawca obsługi zabezpieczeń (SSP), który wykonuje Kerberos uwierzytelnianie wzajemne między klientem a usługą.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-107">For Windows authentication, WCF typically uses the *Negotiate* Security Support Provider (SSP), which performs Kerberos mutual authentication between the client and service.</span></span> <span data-ttu-id="8d7b1-108">Jeśli protokół Kerberos nie jest dostępna, domyślnie WCF powraca do programu NT LAN Manager (NTLM).</span><span class="sxs-lookup"><span data-stu-id="8d7b1-108">If the Kerberos protocol is not available, by default WCF falls back to NT LAN Manager (NTLM).</span></span> <span data-ttu-id="8d7b1-109">Można jednak skonfigurować WCF do korzystania z protokołu Kerberos (i zgłosić wyjątek, jeśli protokół Kerberos nie jest dostępna).</span><span class="sxs-lookup"><span data-stu-id="8d7b1-109">However, you can configure WCF to use only the Kerberos protocol (and to throw an exception if Kerberos is not available).</span></span> <span data-ttu-id="8d7b1-110">Można również skonfigurować usługi WCF na użycie metod ograniczone protokołu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-110">You can also configure WCF to use restricted forms of the Kerberos protocol.</span></span>  
  
## <a name="debugging-methodology"></a><span data-ttu-id="8d7b1-111">Metodologia debugowania</span><span class="sxs-lookup"><span data-stu-id="8d7b1-111">Debugging Methodology</span></span>  
 <span data-ttu-id="8d7b1-112">Metoda podstawowa jest w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="8d7b1-112">The basic method is as follows:</span></span>  
  
1.  <span data-ttu-id="8d7b1-113">Ustal, czy korzystasz z uwierzytelniania Windows.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-113">Determine whether you are using Windows authentication.</span></span> <span data-ttu-id="8d7b1-114">Jeśli używasz innego systemu w tym temacie nie ma zastosowania.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-114">If you are using any other scheme, this topic does not apply.</span></span>  
  
2.  <span data-ttu-id="8d7b1-115">Jeśli masz pewność, że używasz uwierzytelniania Windows, należy określić, czy konfiguracji usługi WCF używa protokołu Kerberos, bezpośrednio lub Negotiate.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-115">If you are sure you are using Windows authentication, determine whether your WCF configuration uses Kerberos direct or Negotiate.</span></span>  
  
3.  <span data-ttu-id="8d7b1-116">Po określeniu, czy konfiguracja używa protokołu Kerberos lub NTLM, można zrozumieć, komunikaty o błędach w odpowiednim kontekście.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-116">Once you have determined whether your configuration is using the Kerberos protocol or NTLM, you can understand error messages in the correct context.</span></span>  
  
### <a name="availability-of-the-kerberos-protocol-and-ntlm"></a><span data-ttu-id="8d7b1-117">Dostępność protokołu Kerberos i NTLM</span><span class="sxs-lookup"><span data-stu-id="8d7b1-117">Availability of the Kerberos Protocol and NTLM</span></span>  
 <span data-ttu-id="8d7b1-118">Dostawca obsługi zabezpieczeń Kerberos wymaga kontrolera domeny do działania jako centrum dystrybucji kluczy (KDC) protokołu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-118">The Kerberos SSP requires a domain controller to act as the Kerberos Key Distribution Center (KDC).</span></span> <span data-ttu-id="8d7b1-119">Protokół Kerberos jest dostępna tylko wtedy, gdy klient i usługa są przy użyciu tożsamości domeny.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-119">The Kerberos protocol is available only when both the client and service are using domain identities.</span></span> <span data-ttu-id="8d7b1-120">W przypadku innych kombinacji konta NTLM jest używana zgodnie z opisem w poniższej tabeli.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-120">In other account combinations, NTLM is used, as summarized in the following table.</span></span>  
  
 <span data-ttu-id="8d7b1-121">Nagłówki tabeli Pokaż typy możliwe konto używane przez serwer.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-121">The table headers show possible account types used by the server.</span></span> <span data-ttu-id="8d7b1-122">Kolumna po lewej stronie zawiera typy kont używanych przez klienta.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-122">The left column shows possible account types used by the client.</span></span>  
  
||<span data-ttu-id="8d7b1-123">Użytkownik lokalny</span><span class="sxs-lookup"><span data-stu-id="8d7b1-123">Local User</span></span>|<span data-ttu-id="8d7b1-124">Local System</span><span class="sxs-lookup"><span data-stu-id="8d7b1-124">Local System</span></span>|<span data-ttu-id="8d7b1-125">Domena użytkownik</span><span class="sxs-lookup"><span data-stu-id="8d7b1-125">Domain User</span></span>|<span data-ttu-id="8d7b1-126">Maszyny do domeny</span><span class="sxs-lookup"><span data-stu-id="8d7b1-126">Domain Machine</span></span>|  
|-|----------------|------------------|-----------------|--------------------|  
|<span data-ttu-id="8d7b1-127">Użytkownik lokalny</span><span class="sxs-lookup"><span data-stu-id="8d7b1-127">Local User</span></span>|<span data-ttu-id="8d7b1-128">NTLM</span><span class="sxs-lookup"><span data-stu-id="8d7b1-128">NTLM</span></span>|<span data-ttu-id="8d7b1-129">NTLM</span><span class="sxs-lookup"><span data-stu-id="8d7b1-129">NTLM</span></span>|<span data-ttu-id="8d7b1-130">NTLM</span><span class="sxs-lookup"><span data-stu-id="8d7b1-130">NTLM</span></span>|<span data-ttu-id="8d7b1-131">NTLM</span><span class="sxs-lookup"><span data-stu-id="8d7b1-131">NTLM</span></span>|  
|<span data-ttu-id="8d7b1-132">Local System</span><span class="sxs-lookup"><span data-stu-id="8d7b1-132">Local System</span></span>|<span data-ttu-id="8d7b1-133">Anonymous NTLM</span><span class="sxs-lookup"><span data-stu-id="8d7b1-133">Anonymous NTLM</span></span>|<span data-ttu-id="8d7b1-134">Anonymous NTLM</span><span class="sxs-lookup"><span data-stu-id="8d7b1-134">Anonymous NTLM</span></span>|<span data-ttu-id="8d7b1-135">Anonymous NTLM</span><span class="sxs-lookup"><span data-stu-id="8d7b1-135">Anonymous NTLM</span></span>|<span data-ttu-id="8d7b1-136">Anonymous NTLM</span><span class="sxs-lookup"><span data-stu-id="8d7b1-136">Anonymous NTLM</span></span>|  
|<span data-ttu-id="8d7b1-137">Domena użytkownik</span><span class="sxs-lookup"><span data-stu-id="8d7b1-137">Domain User</span></span>|<span data-ttu-id="8d7b1-138">NTLM</span><span class="sxs-lookup"><span data-stu-id="8d7b1-138">NTLM</span></span>|<span data-ttu-id="8d7b1-139">NTLM</span><span class="sxs-lookup"><span data-stu-id="8d7b1-139">NTLM</span></span>|<span data-ttu-id="8d7b1-140">Kerberos</span><span class="sxs-lookup"><span data-stu-id="8d7b1-140">Kerberos</span></span>|<span data-ttu-id="8d7b1-141">Kerberos</span><span class="sxs-lookup"><span data-stu-id="8d7b1-141">Kerberos</span></span>|  
|<span data-ttu-id="8d7b1-142">Maszyny do domeny</span><span class="sxs-lookup"><span data-stu-id="8d7b1-142">Domain Machine</span></span>|<span data-ttu-id="8d7b1-143">NTLM</span><span class="sxs-lookup"><span data-stu-id="8d7b1-143">NTLM</span></span>|<span data-ttu-id="8d7b1-144">NTLM</span><span class="sxs-lookup"><span data-stu-id="8d7b1-144">NTLM</span></span>|<span data-ttu-id="8d7b1-145">Kerberos</span><span class="sxs-lookup"><span data-stu-id="8d7b1-145">Kerberos</span></span>|<span data-ttu-id="8d7b1-146">Kerberos</span><span class="sxs-lookup"><span data-stu-id="8d7b1-146">Kerberos</span></span>|  
  
 <span data-ttu-id="8d7b1-147">W szczególności cztery typy kont obejmują:</span><span class="sxs-lookup"><span data-stu-id="8d7b1-147">Specifically, the four account types include:</span></span>  
  
-   <span data-ttu-id="8d7b1-148">Użytkownik lokalny: Profil użytkownika tylko do maszyny.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-148">Local User: Machine-only user profile.</span></span> <span data-ttu-id="8d7b1-149">Na przykład: `MachineName\Administrator` lub `MachineName\ProfileName`.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-149">For example: `MachineName\Administrator` or `MachineName\ProfileName`.</span></span>  
  
-   <span data-ttu-id="8d7b1-150">Local System: Wbudowane konto SYSTEM na komputerze, który nie jest przyłączony do domeny.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-150">Local System: The built-in account SYSTEM on a machine that is not joined to a domain.</span></span>  
  
-   <span data-ttu-id="8d7b1-151">Użytkownik domeny: Konto użytkownika domeny Windows.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-151">Domain User: A user account on a Windows domain.</span></span> <span data-ttu-id="8d7b1-152">Na przykład: `DomainName\ProfileName`.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-152">For example: `DomainName\ProfileName`.</span></span>  
  
-   <span data-ttu-id="8d7b1-153">Komputer do domeny: Proces tożsamość komputera z uruchomioną na maszynie jest przyłączony do domeny Windows.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-153">Domain Machine: A process with machine identity running on a machine joined to a Windows domain.</span></span> <span data-ttu-id="8d7b1-154">Na przykład: `MachineName\Network Service`.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-154">For example: `MachineName\Network Service`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="8d7b1-155">Poświadczenia usługi są przechwytywane podczas <xref:System.ServiceModel.ICommunicationObject.Open%2A> metody <xref:System.ServiceModel.ServiceHost> nosi nazwę klasy.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-155">The service credential is captured when the <xref:System.ServiceModel.ICommunicationObject.Open%2A> method of the <xref:System.ServiceModel.ServiceHost> class is called.</span></span> <span data-ttu-id="8d7b1-156">Poświadczeń klienta jest do odczytu zawsze, gdy klient wysyła komunikat.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-156">The client credential is read whenever the client sends a message.</span></span>  
  
## <a name="common-windows-authentication-problems"></a><span data-ttu-id="8d7b1-157">Typowe problemy z uwierzytelnianiem Windows</span><span class="sxs-lookup"><span data-stu-id="8d7b1-157">Common Windows Authentication Problems</span></span>  
 <span data-ttu-id="8d7b1-158">W tej sekcji omówiono niektóre typowe problemy z uwierzytelnianiem Windows i tymczasowe.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-158">This section discusses some common Windows authentication problems and possible remedies.</span></span>  
  
### <a name="kerberos-protocol"></a><span data-ttu-id="8d7b1-159">Protokół Kerberos</span><span class="sxs-lookup"><span data-stu-id="8d7b1-159">Kerberos Protocol</span></span>  
  
#### <a name="spnupn-problems-with-the-kerberos-protocol"></a><span data-ttu-id="8d7b1-160">Główna nazwa usługi/nazwy UPN problemów przy użyciu protokołu Kerberos</span><span class="sxs-lookup"><span data-stu-id="8d7b1-160">SPN/UPN Problems with the Kerberos Protocol</span></span>  
 <span data-ttu-id="8d7b1-161">Korzystając z uwierzytelniania Windows i protokołu Kerberos, protokół jest używany lub wynegocjowanym przez interfejs SSPI, adres URL punktu końcowego klienta używa musi zawierać w pełni kwalifikowaną nazwę domeny hosta usługi wewnątrz adres URL usługi.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-161">When using Windows authentication, and the Kerberos protocol is used or negotiated by SSPI, the URL the client endpoint uses must include the fully qualified domain name of the service's host inside the service URL.</span></span> <span data-ttu-id="8d7b1-162">Założono, że konto, na którym uruchomiono usługę ma dostęp do klucza głównej nazwy (usługi SPN) usługi maszyny (ustawienie domyślne), który jest tworzony po dodaniu komputera do domeny usługi Active Directory, co zwykle odbywa się przez uruchomienie usługi w obszarze Konto Usługa sieciowa.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-162">This assumes that the account under which the service is running has access to the machine (default) service principal name (SPN) key that is created when the computer is added to the Active Directory domain, which is most commonly done by running the service under the Network Service account.</span></span> <span data-ttu-id="8d7b1-163">Jeśli usługa nie ma dostępu do klucza nazwy SPN maszyny, musisz podać poprawną SPN lub użytkownika głównej nazwy (UPN) konta, w którym usługa jest uruchomiona w tożsamości punktu końcowego klienta.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-163">If the service does not have access to the machine SPN key, you must supply the correct SPN or user principal name (UPN) of the account under which the service is running in the client's endpoint identity.</span></span> <span data-ttu-id="8d7b1-164">Aby uzyskać więcej informacji na temat współdziałania usługi WCF z nazwy SPN i UPN, zobacz [uwierzytelnianie i tożsamość usług](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="8d7b1-164">For more information about how WCF works with SPN and UPN, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span></span>  
  
 <span data-ttu-id="8d7b1-165">W programie Równoważenie obciążenia scenariusze, takie jak farmy serwerów sieci Web lub ogrodach sieci Web powszechną praktyką jest definiowanie unikatowe konto dla każdej aplikacji, przypisywanie nazwy SPN do tego konta i upewnij się, że wszystkie usługi aplikacji są uruchamiane w ramach tego konta.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-165">In load-balancing scenarios, such as Web farms or Web gardens, a common practice is to define a unique account for each application, assign an SPN to that account, and ensure that all of the application's services run in that account.</span></span>  
  
 <span data-ttu-id="8d7b1-166">Aby uzyskać nazwę SPN dla konta usługi, musisz mieć uprawnienia administratora domeny usługi Active Directory.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-166">To obtain an SPN for your service's account, you need to be an Active Directory domain administrator.</span></span> <span data-ttu-id="8d7b1-167">Aby uzyskać więcej informacji, zobacz [Kerberos technicznego dodatku dla Windows](https://go.microsoft.com/fwlink/?LinkID=88330).</span><span class="sxs-lookup"><span data-stu-id="8d7b1-167">For more information, see [Kerberos Technical Supplement for Windows](https://go.microsoft.com/fwlink/?LinkID=88330).</span></span>  
  
#### <a name="kerberos-protocol-direct-requires-the-service-to-run-under-a-domain-machine-account"></a><span data-ttu-id="8d7b1-168">Protokół Kerberos Direct wymaga usługi do uruchomienia w ramach konta komputera do domeny</span><span class="sxs-lookup"><span data-stu-id="8d7b1-168">Kerberos Protocol Direct Requires the Service to Run Under a Domain Machine Account</span></span>  
 <span data-ttu-id="8d7b1-169">Ten problem wystąpi podczas `ClientCredentialType` właściwość jest ustawiona na `Windows` i <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> właściwość jest ustawiona na `false`, jak pokazano w poniższym kodzie.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-169">This occurs when the `ClientCredentialType` property is set to `Windows` and the <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> property is set to `false`, as shown in the following code.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#1)]
 [!code-vb[C_DebuggingWindowsAuth#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#1)]  
  
 <span data-ttu-id="8d7b1-170">Aby rozwiązać problem, uruchom usługę przy użyciu konta komputera do domeny, takie jak Usługa sieciowa, w domenie przyłączony komputer.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-170">To remedy, run the service using a Domain Machine account, such as Network Service, on a domain joined machine.</span></span>  
  
### <a name="delegation-requires-credential-negotiation"></a><span data-ttu-id="8d7b1-171">Delegowanie wymaga negocjowania poświadczeń</span><span class="sxs-lookup"><span data-stu-id="8d7b1-171">Delegation Requires Credential Negotiation</span></span>  
 <span data-ttu-id="8d7b1-172">Aby używać protokołu uwierzytelniania Kerberos z delegowania, musi implementować protokołu Kerberos za pomocą negocjowania poświadczeń (czasami nazywany "wielu gałęzi" lub "wieloetapowego" protokołu Kerberos).</span><span class="sxs-lookup"><span data-stu-id="8d7b1-172">To use the Kerberos authentication protocol with delegation, you must implement the Kerberos protocol with credential negotiation (sometimes called "multi-leg" or "multi-step" Kerberos).</span></span> <span data-ttu-id="8d7b1-173">W przypadku zaimplementowania uwierzytelniania Kerberos bez negocjowania poświadczeń (czasami nazywany "jednorazowej" lub "pojedynczej gałęzi" protokołu Kerberos), zostanie zgłoszony wyjątek.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-173">If you implement Kerberos authentication without credential negotiation (sometimes called "one-shot" or "single-leg" Kerberos), an exception will be thrown.</span></span>  
  
 <span data-ttu-id="8d7b1-174">Aby zaimplementować protokół Kerberos za pomocą negocjowania poświadczeń, wykonaj następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="8d7b1-174">To implement Kerberos with credential negotiation, do the following steps:</span></span>  
  
1.  <span data-ttu-id="8d7b1-175">Implementowanie delegowanie, ustawiając <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> do <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-175">Implement delegation by setting <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> to <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span>  
  
2.  <span data-ttu-id="8d7b1-176">Wymagaj negocjacji interfejsu SSPI:</span><span class="sxs-lookup"><span data-stu-id="8d7b1-176">Require SSPI negotiation:</span></span>  
  
    1.  <span data-ttu-id="8d7b1-177">Jeśli używasz standardowego powiązania zestawu `NegotiateServiceCredential` właściwość `true`.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-177">If you are using standard bindings, set the `NegotiateServiceCredential` property to `true`.</span></span>  
  
    2.  <span data-ttu-id="8d7b1-178">Jeśli używasz niestandardowego powiązania, ustaw `AuthenticationMode` atrybutu `Security` elementu `SspiNegotiated`.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-178">If you are using custom bindings, set the `AuthenticationMode` attribute of the `Security` element to `SspiNegotiated`.</span></span>  
  
3.  <span data-ttu-id="8d7b1-179">Wymagaj negocjacji interfejsu SSPI do używania protokołu Kerberos, nie można przydzielać korzystanie z uwierzytelniania NTLM:</span><span class="sxs-lookup"><span data-stu-id="8d7b1-179">Require the SSPI negotiation to use Kerberos by disallowing the use of NTLM:</span></span>  
  
    1.  <span data-ttu-id="8d7b1-180">Wykonaj następujące czynności w kodzie za pomocą następującej instrukcji:</span><span class="sxs-lookup"><span data-stu-id="8d7b1-180">Do this in code, with the following statement:</span></span> `ChannelFactory.Credentials.Windows.AllowNtlm = false`  
  
    2.  <span data-ttu-id="8d7b1-181">Lub możesz to zrobić w pliku konfiguracji, ustawienia `allowNtlm` atrybutu `false`.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-181">Or you can do this in the configuration file by setting the `allowNtlm` attribute to `false`.</span></span> <span data-ttu-id="8d7b1-182">Ten atrybut jest zawarty w [ \<systemu windows >](../../../../docs/framework/configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md).</span><span class="sxs-lookup"><span data-stu-id="8d7b1-182">This attribute is contained in the [\<windows>](../../../../docs/framework/configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md).</span></span>  
  
### <a name="ntlm-protocol"></a><span data-ttu-id="8d7b1-183">Protokół NTLM</span><span class="sxs-lookup"><span data-stu-id="8d7b1-183">NTLM Protocol</span></span>  
  
#### <a name="negotiate-ssp-falls-back-to-ntlm-but-ntlm-is-disabled"></a><span data-ttu-id="8d7b1-184">Negocjowania SSP powróci do uwierzytelniania NTLM, ale uwierzytelnianie NTLM zostało wyłączone</span><span class="sxs-lookup"><span data-stu-id="8d7b1-184">Negotiate SSP Falls Back to NTLM, but NTLM Is Disabled</span></span>  
 <span data-ttu-id="8d7b1-185"><xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> Właściwość jest ustawiona na `false`, co powoduje, że Windows Communication Foundation (WCF) umożliwiają staranności do zgłoszenia wyjątku, jeśli używane jest uwierzytelnianie NTLM.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-185">The <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> property is set to `false`, which causes Windows Communication Foundation (WCF) to make a best-effort to throw an exception if NTLM is used.</span></span> <span data-ttu-id="8d7b1-186">Należy pamiętać, że ustawienie tej właściwości na `false` może uniemożliwia poświadczeń NTLM są przesyłane przez sieć.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-186">Note that setting this property to `false` may not prevent NTLM credentials from being sent over the wire.</span></span>  
  
 <span data-ttu-id="8d7b1-187">Poniżej przedstawiono sposób wyłączania powrót do uwierzytelniania NTLM.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-187">The following shows how to disable fallback to NTLM.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#4)]
 [!code-vb[C_DebuggingWindowsAuth#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#4)]  
  
#### <a name="ntlm-logon-fails"></a><span data-ttu-id="8d7b1-188">Niepowodzenie logowania NTLM</span><span class="sxs-lookup"><span data-stu-id="8d7b1-188">NTLM Logon Fails</span></span>  
 <span data-ttu-id="8d7b1-189">Poświadczenia klienta są nieprawidłowe w usłudze.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-189">The client credentials are not valid on the service.</span></span> <span data-ttu-id="8d7b1-190">Upewnij się, że nazwa użytkownika i hasło są poprawnie ustawione i odnoszą się do konta które jest znana na komputerze, na którym jest uruchomiona usługa.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-190">Check that the user name and password are correctly set and correspond to an account that is known to the computer where the service is running.</span></span> <span data-ttu-id="8d7b1-191">NTLM korzysta z określonych poświadczeń do logowania się komputerze usługi.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-191">NTLM uses the specified credentials to log on to the service's computer.</span></span> <span data-ttu-id="8d7b1-192">Poświadczenia mogą być prawidłowe na komputerze, na którym działa klient, to logowanie zakończy się niepowodzeniem, jeśli poświadczenia nie są prawidłowe dla komputera usługi.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-192">While the credentials may be valid on the computer where the client is running, this logon will fail if the credentials are not valid on the service's computer.</span></span>  
  
#### <a name="anonymous-ntlm-logon-occurs-but-anonymous-logons-are-disabled-by-default"></a><span data-ttu-id="8d7b1-193">Logowanie anonimowe NTLM występuje, ale anonimowego logowania są domyślnie wyłączone</span><span class="sxs-lookup"><span data-stu-id="8d7b1-193">Anonymous NTLM Logon Occurs, but Anonymous Logons Are Disabled by Default</span></span>  
 <span data-ttu-id="8d7b1-194">Podczas tworzenia klienta <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> właściwość jest ustawiona na <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, jak pokazano w poniższym przykładzie, ale domyślnie serwer nie zezwala na logowanie anonimowe.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-194">When creating a client, the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property is set to <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, as shown in the following example, but by default the server disallows anonymous logons.</span></span> <span data-ttu-id="8d7b1-195">Dzieje się tak dlatego wartość domyślną <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> właściwość <xref:System.ServiceModel.Security.WindowsServiceCredential> klasa jest `false`.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-195">This occurs because the default value of the <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> property of the <xref:System.ServiceModel.Security.WindowsServiceCredential> class is `false`.</span></span>  
  
 <span data-ttu-id="8d7b1-196">Poniższy kod klienta spróbuje włączyć logowanie anonimowe (należy zauważyć, że właściwość default `Identification`).</span><span class="sxs-lookup"><span data-stu-id="8d7b1-196">The following client code attempts to enable anonymous logons (note that the default property is `Identification`).</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#5)]
 [!code-vb[C_DebuggingWindowsAuth#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#5)]  
  
 <span data-ttu-id="8d7b1-197">Poniższy kod usługi zmienia domyślne, aby włączyć logowanie anonimowe przez serwer.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-197">The following service code changes the default to enable anonymous logons by the server.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#6)]
 [!code-vb[C_DebuggingWindowsAuth#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#6)]  
  
 <span data-ttu-id="8d7b1-198">Aby uzyskać więcej informacji na temat personifikacji, zobacz [delegowanie i personifikacja](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="8d7b1-198">For more information about impersonation, see [Delegation and Impersonation](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span></span>  
  
 <span data-ttu-id="8d7b1-199">Alternatywnie klient jest uruchomiony jako usługa Windows przy użyciu wbudowanego konta SYSTEM.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-199">Alternatively, the client is running as a Windows service, using the built-in account SYSTEM.</span></span>  
  
### <a name="other-problems"></a><span data-ttu-id="8d7b1-200">Inne problemy</span><span class="sxs-lookup"><span data-stu-id="8d7b1-200">Other Problems</span></span>  
  
#### <a name="client-credentials-are-not-set-correctly"></a><span data-ttu-id="8d7b1-201">Poświadczenia klienta nie zostały poprawnie skonfigurowane.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-201">Client Credentials Are Not Set Correctly</span></span>  
 <span data-ttu-id="8d7b1-202">Korzysta z uwierzytelniania Windows <xref:System.ServiceModel.Security.WindowsClientCredential> wystąpienie zwrócone przez <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> właściwość <xref:System.ServiceModel.ClientBase%601> klasy nie <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-202">Windows authentication uses the <xref:System.ServiceModel.Security.WindowsClientCredential> instance returned by the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the <xref:System.ServiceModel.ClientBase%601> class, not the <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span></span> <span data-ttu-id="8d7b1-203">Poniżej przedstawiono przykład nieprawidłowy.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-203">The following shows an incorrect example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#2)]
 [!code-vb[C_DebuggingWindowsAuth#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#2)]  
  
 <span data-ttu-id="8d7b1-204">Na poniższym obrazie przedstawiono przykład poprawnego.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-204">The following shows the correct example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#3)]
 [!code-vb[C_DebuggingWindowsAuth#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#3)]  
  
#### <a name="sspi-is-not-available"></a><span data-ttu-id="8d7b1-205">Interfejs SSPI nie jest dostępna</span><span class="sxs-lookup"><span data-stu-id="8d7b1-205">SSPI Is Not Available</span></span>  
 <span data-ttu-id="8d7b1-206">Następujące systemy operacyjne nie obsługują uwierzytelniania Windows, gdy jest używana jako serwer: [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition, [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Media Center Edition, i [!INCLUDE[wv](../../../../includes/wv-md.md)]Home Edition.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-206">The following operating systems do not support Windows authentication when used as a server: [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition, [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Media Center Edition, and [!INCLUDE[wv](../../../../includes/wv-md.md)]Home editions.</span></span>  
  
#### <a name="developing-and-deploying-with-different-identities"></a><span data-ttu-id="8d7b1-207">Tworzenie i wdrażanie przy użyciu różnych tożsamości</span><span class="sxs-lookup"><span data-stu-id="8d7b1-207">Developing and Deploying with Different Identities</span></span>  
 <span data-ttu-id="8d7b1-208">Jeśli tworzenia aplikacji na jednym komputerze wdrożeniu w innym, używają różnych typów kont do uwierzytelniania na każdej maszynie, mogą występować inne zachowanie.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-208">If you develop your application on one machine, and deploy on another, and use different account types to authenticate on each machine, you may experience different behavior.</span></span> <span data-ttu-id="8d7b1-209">Załóżmy, że tworzenie aplikacji przy użyciu Windows XP Pro maszyny `SSPI Negotiated` tryb uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-209">For example, suppose you develop your application on a Windows XP Pro machine using the `SSPI Negotiated` authentication mode.</span></span> <span data-ttu-id="8d7b1-210">Jeśli używasz konta użytkownika lokalnego do uwierzytelniania przy użyciu protokołu NTLM będą używane.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-210">If you use a local user account to authenticate with, then NTLM protocol will be used.</span></span> <span data-ttu-id="8d7b1-211">Gdy aplikacja jest opracowana, możesz wdrożyć usługę do maszyny systemu Windows Server 2003, w którym został uruchomiony w ramach konta domeny.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-211">Once the application is developed, you deploy the service to a Windows Server 2003 machine where it runs under a domain account.</span></span> <span data-ttu-id="8d7b1-212">W tym momencie klient nie będzie mógł uwierzytelnić usługi, ponieważ będą używać protokołu Kerberos i kontrolerem domeny.</span><span class="sxs-lookup"><span data-stu-id="8d7b1-212">At this point the client will not be able to authenticate the service because it will be using Kerberos and a domain controller.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8d7b1-213">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="8d7b1-213">See also</span></span>

- <xref:System.ServiceModel.Security.WindowsClientCredential>
- <xref:System.ServiceModel.Security.WindowsServiceCredential>
- <xref:System.ServiceModel.Security.WindowsClientCredential>
- <xref:System.ServiceModel.ClientBase%601>
- [<span data-ttu-id="8d7b1-214">Delegowanie i personifikacja</span><span class="sxs-lookup"><span data-stu-id="8d7b1-214">Delegation and Impersonation</span></span>](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)
- [<span data-ttu-id="8d7b1-215">Nieobsługiwane scenariusze</span><span class="sxs-lookup"><span data-stu-id="8d7b1-215">Unsupported Scenarios</span></span>](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md)
