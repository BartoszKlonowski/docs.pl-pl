---
title: Debugowanie błędów uwierzytelniania systemu Windows
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
- WCF, Windows authentication
ms.assetid: 181be4bd-79b1-4a66-aee2-931887a6d7cc
ms.openlocfilehash: 52e968706ef4ca703a26e613e681cff3c30ba181
ms.sourcegitcommit: a4f9b754059f0210e29ae0578363a27b9ba84b64
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 12/05/2019
ms.locfileid: "74838029"
---
# <a name="debugging-windows-authentication-errors"></a><span data-ttu-id="298f3-102">Debugowanie błędów uwierzytelniania systemu Windows</span><span class="sxs-lookup"><span data-stu-id="298f3-102">Debugging Windows Authentication Errors</span></span>
<span data-ttu-id="298f3-103">W przypadku korzystania z uwierzytelniania systemu Windows jako mechanizmu zabezpieczeń interfejs dostawcy obsługi zabezpieczeń (SSPI) obsługuje procesy zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="298f3-103">When using Windows authentication as a security mechanism, the Security Support Provider Interface (SSPI) handles security processes.</span></span> <span data-ttu-id="298f3-104">Gdy w warstwie SSPI wystąpią błędy zabezpieczeń, są one nałożone przez Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="298f3-104">When security errors occur at the SSPI layer, they are surfaced by Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="298f3-105">Ten temat zawiera informacje o strukturze i zestawie pytań ułatwiających zdiagnozowanie błędów.</span><span class="sxs-lookup"><span data-stu-id="298f3-105">This topic provides a framework and set of questions to help diagnose the errors.</span></span>  
  
 <span data-ttu-id="298f3-106">Aby zapoznać się z omówieniem protokołu Kerberos, zobacz Omówienie protokołu [Kerberos](https://go.microsoft.com/fwlink/?LinkID=86946). Aby zapoznać się z omówieniem interfejsu SSPI, zobacz [SSPI](https://go.microsoft.com/fwlink/?LinkId=88941).</span><span class="sxs-lookup"><span data-stu-id="298f3-106">For an overview of the Kerberos protocol, see [Kerberos Explained](https://go.microsoft.com/fwlink/?LinkID=86946); for an overview of SSPI, see [SSPI](https://go.microsoft.com/fwlink/?LinkId=88941).</span></span>  
  
 <span data-ttu-id="298f3-107">W przypadku uwierzytelniania systemu Windows funkcja WCF zazwyczaj używa dostawcy usługi *negocjowania* zabezpieczeń (SSP), który wykonuje wzajemne uwierzytelnianie Kerberos między klientem a usługą.</span><span class="sxs-lookup"><span data-stu-id="298f3-107">For Windows authentication, WCF typically uses the *Negotiate* Security Support Provider (SSP), which performs Kerberos mutual authentication between the client and service.</span></span> <span data-ttu-id="298f3-108">Jeśli protokół Kerberos nie jest dostępny, domyślnie WCF powraca do programu NT LAN Manager (NTLM).</span><span class="sxs-lookup"><span data-stu-id="298f3-108">If the Kerberos protocol is not available, by default WCF falls back to NT LAN Manager (NTLM).</span></span> <span data-ttu-id="298f3-109">Można jednak skonfigurować funkcję WCF do używania tylko protokołu Kerberos (i zgłosić wyjątek, jeśli protokół Kerberos nie jest dostępny).</span><span class="sxs-lookup"><span data-stu-id="298f3-109">However, you can configure WCF to use only the Kerberos protocol (and to throw an exception if Kerberos is not available).</span></span> <span data-ttu-id="298f3-110">Istnieje również możliwość skonfigurowania programu WCF do korzystania z ograniczonych form protokołu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="298f3-110">You can also configure WCF to use restricted forms of the Kerberos protocol.</span></span>  
  
## <a name="debugging-methodology"></a><span data-ttu-id="298f3-111">Metodologia debugowania</span><span class="sxs-lookup"><span data-stu-id="298f3-111">Debugging Methodology</span></span>  
 <span data-ttu-id="298f3-112">Podstawowa metoda jest następująca:</span><span class="sxs-lookup"><span data-stu-id="298f3-112">The basic method is as follows:</span></span>  
  
1. <span data-ttu-id="298f3-113">Określ, czy używasz uwierzytelniania systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="298f3-113">Determine whether you are using Windows authentication.</span></span> <span data-ttu-id="298f3-114">Jeśli używasz innego schematu, ten temat nie ma zastosowania.</span><span class="sxs-lookup"><span data-stu-id="298f3-114">If you are using any other scheme, this topic does not apply.</span></span>  
  
2. <span data-ttu-id="298f3-115">Jeśli masz pewność, że używasz uwierzytelniania systemu Windows, ustal, czy konfiguracja usługi WCF korzysta z protokołu Kerberos Direct czy z negocjowaniem.</span><span class="sxs-lookup"><span data-stu-id="298f3-115">If you are sure you are using Windows authentication, determine whether your WCF configuration uses Kerberos direct or Negotiate.</span></span>  
  
3. <span data-ttu-id="298f3-116">Po ustaleniu, czy konfiguracja używa protokołu Kerberos lub NTLM, można zrozumieć komunikaty o błędach w poprawnym kontekście.</span><span class="sxs-lookup"><span data-stu-id="298f3-116">Once you have determined whether your configuration is using the Kerberos protocol or NTLM, you can understand error messages in the correct context.</span></span>  
  
### <a name="availability-of-the-kerberos-protocol-and-ntlm"></a><span data-ttu-id="298f3-117">Dostępność protokołu Kerberos i NTLM</span><span class="sxs-lookup"><span data-stu-id="298f3-117">Availability of the Kerberos Protocol and NTLM</span></span>  
 <span data-ttu-id="298f3-118">Dostawca SSP Kerberos wymaga, aby kontroler domeny działał jako centrum dystrybucji kluczy Kerberos (KDC).</span><span class="sxs-lookup"><span data-stu-id="298f3-118">The Kerberos SSP requires a domain controller to act as the Kerberos Key Distribution Center (KDC).</span></span> <span data-ttu-id="298f3-119">Protokół Kerberos jest dostępny tylko wtedy, gdy zarówno klient, jak i usługa korzystają z tożsamości domeny.</span><span class="sxs-lookup"><span data-stu-id="298f3-119">The Kerberos protocol is available only when both the client and service are using domain identities.</span></span> <span data-ttu-id="298f3-120">W przypadku innych kombinacji kont używane jest uwierzytelnianie NTLM, zgodnie z podsumowaniem w poniższej tabeli.</span><span class="sxs-lookup"><span data-stu-id="298f3-120">In other account combinations, NTLM is used, as summarized in the following table.</span></span>  
  
 <span data-ttu-id="298f3-121">Nagłówki tabeli zawierają możliwe typy kont używane przez serwer.</span><span class="sxs-lookup"><span data-stu-id="298f3-121">The table headers show possible account types used by the server.</span></span> <span data-ttu-id="298f3-122">W lewej kolumnie są wyświetlane możliwe typy kont używane przez klienta programu.</span><span class="sxs-lookup"><span data-stu-id="298f3-122">The left column shows possible account types used by the client.</span></span>  
  
||<span data-ttu-id="298f3-123">Użytkownik lokalny</span><span class="sxs-lookup"><span data-stu-id="298f3-123">Local User</span></span>|<span data-ttu-id="298f3-124">System lokalny</span><span class="sxs-lookup"><span data-stu-id="298f3-124">Local System</span></span>|<span data-ttu-id="298f3-125">Użytkownik domeny</span><span class="sxs-lookup"><span data-stu-id="298f3-125">Domain User</span></span>|<span data-ttu-id="298f3-126">Komputer domeny</span><span class="sxs-lookup"><span data-stu-id="298f3-126">Domain Machine</span></span>|  
|-|----------------|------------------|-----------------|--------------------|  
|<span data-ttu-id="298f3-127">Użytkownik lokalny</span><span class="sxs-lookup"><span data-stu-id="298f3-127">Local User</span></span>|<span data-ttu-id="298f3-128">NTLM</span><span class="sxs-lookup"><span data-stu-id="298f3-128">NTLM</span></span>|<span data-ttu-id="298f3-129">NTLM</span><span class="sxs-lookup"><span data-stu-id="298f3-129">NTLM</span></span>|<span data-ttu-id="298f3-130">NTLM</span><span class="sxs-lookup"><span data-stu-id="298f3-130">NTLM</span></span>|<span data-ttu-id="298f3-131">NTLM</span><span class="sxs-lookup"><span data-stu-id="298f3-131">NTLM</span></span>|  
|<span data-ttu-id="298f3-132">System lokalny</span><span class="sxs-lookup"><span data-stu-id="298f3-132">Local System</span></span>|<span data-ttu-id="298f3-133">Anonimowe uwierzytelnianie NTLM</span><span class="sxs-lookup"><span data-stu-id="298f3-133">Anonymous NTLM</span></span>|<span data-ttu-id="298f3-134">Anonimowe uwierzytelnianie NTLM</span><span class="sxs-lookup"><span data-stu-id="298f3-134">Anonymous NTLM</span></span>|<span data-ttu-id="298f3-135">Anonimowe uwierzytelnianie NTLM</span><span class="sxs-lookup"><span data-stu-id="298f3-135">Anonymous NTLM</span></span>|<span data-ttu-id="298f3-136">Anonimowe uwierzytelnianie NTLM</span><span class="sxs-lookup"><span data-stu-id="298f3-136">Anonymous NTLM</span></span>|  
|<span data-ttu-id="298f3-137">Użytkownik domeny</span><span class="sxs-lookup"><span data-stu-id="298f3-137">Domain User</span></span>|<span data-ttu-id="298f3-138">NTLM</span><span class="sxs-lookup"><span data-stu-id="298f3-138">NTLM</span></span>|<span data-ttu-id="298f3-139">NTLM</span><span class="sxs-lookup"><span data-stu-id="298f3-139">NTLM</span></span>|<span data-ttu-id="298f3-140">Kerberos</span><span class="sxs-lookup"><span data-stu-id="298f3-140">Kerberos</span></span>|<span data-ttu-id="298f3-141">Kerberos</span><span class="sxs-lookup"><span data-stu-id="298f3-141">Kerberos</span></span>|  
|<span data-ttu-id="298f3-142">Komputer domeny</span><span class="sxs-lookup"><span data-stu-id="298f3-142">Domain Machine</span></span>|<span data-ttu-id="298f3-143">NTLM</span><span class="sxs-lookup"><span data-stu-id="298f3-143">NTLM</span></span>|<span data-ttu-id="298f3-144">NTLM</span><span class="sxs-lookup"><span data-stu-id="298f3-144">NTLM</span></span>|<span data-ttu-id="298f3-145">Kerberos</span><span class="sxs-lookup"><span data-stu-id="298f3-145">Kerberos</span></span>|<span data-ttu-id="298f3-146">Kerberos</span><span class="sxs-lookup"><span data-stu-id="298f3-146">Kerberos</span></span>|  
  
 <span data-ttu-id="298f3-147">W każdym przypadku cztery typy kont obejmują:</span><span class="sxs-lookup"><span data-stu-id="298f3-147">Specifically, the four account types include:</span></span>  
  
- <span data-ttu-id="298f3-148">Użytkownik lokalny: profil użytkownika tylko dla komputera.</span><span class="sxs-lookup"><span data-stu-id="298f3-148">Local User: Machine-only user profile.</span></span> <span data-ttu-id="298f3-149">Na przykład: `MachineName\Administrator` lub `MachineName\ProfileName`.</span><span class="sxs-lookup"><span data-stu-id="298f3-149">For example: `MachineName\Administrator` or `MachineName\ProfileName`.</span></span>  
  
- <span data-ttu-id="298f3-150">System lokalny: wbudowany SYSTEM kont na komputerze, który nie jest przyłączony do domeny.</span><span class="sxs-lookup"><span data-stu-id="298f3-150">Local System: The built-in account SYSTEM on a machine that is not joined to a domain.</span></span>  
  
- <span data-ttu-id="298f3-151">Użytkownik domeny: konto użytkownika w domenie systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="298f3-151">Domain User: A user account on a Windows domain.</span></span> <span data-ttu-id="298f3-152">Na przykład: `DomainName\ProfileName`.</span><span class="sxs-lookup"><span data-stu-id="298f3-152">For example: `DomainName\ProfileName`.</span></span>  
  
- <span data-ttu-id="298f3-153">Komputer domeny: proces z tożsamością komputera uruchomioną na komputerze przyłączonym do domeny systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="298f3-153">Domain Machine: A process with machine identity running on a machine joined to a Windows domain.</span></span> <span data-ttu-id="298f3-154">Na przykład: `MachineName\Network Service`.</span><span class="sxs-lookup"><span data-stu-id="298f3-154">For example: `MachineName\Network Service`.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="298f3-155">Poświadczenie usługi jest przechwytywane, gdy wywoływana jest metoda <xref:System.ServiceModel.ICommunicationObject.Open%2A> klasy <xref:System.ServiceModel.ServiceHost>.</span><span class="sxs-lookup"><span data-stu-id="298f3-155">The service credential is captured when the <xref:System.ServiceModel.ICommunicationObject.Open%2A> method of the <xref:System.ServiceModel.ServiceHost> class is called.</span></span> <span data-ttu-id="298f3-156">Poświadczenie klienta jest odczytywane za każdym razem, gdy klient wysyła komunikat.</span><span class="sxs-lookup"><span data-stu-id="298f3-156">The client credential is read whenever the client sends a message.</span></span>  
  
## <a name="common-windows-authentication-problems"></a><span data-ttu-id="298f3-157">Typowe problemy z uwierzytelnianiem systemu Windows</span><span class="sxs-lookup"><span data-stu-id="298f3-157">Common Windows Authentication Problems</span></span>  
 <span data-ttu-id="298f3-158">W tej sekcji omówiono niektóre typowe problemy z uwierzytelnianiem systemu Windows i możliwe środki zaradcze.</span><span class="sxs-lookup"><span data-stu-id="298f3-158">This section discusses some common Windows authentication problems and possible remedies.</span></span>  
  
### <a name="kerberos-protocol"></a><span data-ttu-id="298f3-159">Protokół Kerberos</span><span class="sxs-lookup"><span data-stu-id="298f3-159">Kerberos Protocol</span></span>  
  
#### <a name="spnupn-problems-with-the-kerberos-protocol"></a><span data-ttu-id="298f3-160">Problemy z nazwą SPN/UPN przy użyciu protokołu Kerberos</span><span class="sxs-lookup"><span data-stu-id="298f3-160">SPN/UPN Problems with the Kerberos Protocol</span></span>  
 <span data-ttu-id="298f3-161">W przypadku korzystania z uwierzytelniania systemu Windows, gdy protokół Kerberos jest używany lub negocjowany przez interfejs SSPI, adres URL używany przez punkt końcowy klienta musi zawierać w pełni kwalifikowaną nazwę domeny hosta usługi w ramach adresu URL usługi.</span><span class="sxs-lookup"><span data-stu-id="298f3-161">When using Windows authentication, and the Kerberos protocol is used or negotiated by SSPI, the URL the client endpoint uses must include the fully qualified domain name of the service's host inside the service URL.</span></span> <span data-ttu-id="298f3-162">Przyjęto założenie, że konto, na którym jest uruchomiona usługa, ma dostęp do komputera (domyślnego) klucza głównej nazwy usługi (SPN), który jest tworzony podczas dodawania komputera do domeny Active Directory, co jest najczęściej wykonywane przez uruchomienie usługi w ramach Konto usługi sieciowej.</span><span class="sxs-lookup"><span data-stu-id="298f3-162">This assumes that the account under which the service is running has access to the machine (default) service principal name (SPN) key that is created when the computer is added to the Active Directory domain, which is most commonly done by running the service under the Network Service account.</span></span> <span data-ttu-id="298f3-163">Jeśli usługa nie ma dostępu do klucza nazwy SPN komputera, należy podać poprawną nazwę SPN lub głównej nazwy użytkownika (UPN) konta, pod którym uruchomiona jest usługa w tożsamości punktu końcowego klienta.</span><span class="sxs-lookup"><span data-stu-id="298f3-163">If the service does not have access to the machine SPN key, you must supply the correct SPN or user principal name (UPN) of the account under which the service is running in the client's endpoint identity.</span></span> <span data-ttu-id="298f3-164">Aby uzyskać więcej informacji na temat działania programu WCF z nazwami SPN i UPN, zobacz [tożsamość usługi i uwierzytelnianie](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="298f3-164">For more information about how WCF works with SPN and UPN, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span></span>  
  
 <span data-ttu-id="298f3-165">W scenariuszach równoważenia obciążenia, takich jak farmy sieci Web lub ogrody sieci Web, typową metodą jest zdefiniowanie unikatowego konta dla każdej aplikacji, przypisanie nazwy SPN do tego konta i upewnienie się, że wszystkie usługi aplikacji działają na tym koncie.</span><span class="sxs-lookup"><span data-stu-id="298f3-165">In load-balancing scenarios, such as Web farms or Web gardens, a common practice is to define a unique account for each application, assign an SPN to that account, and ensure that all of the application's services run in that account.</span></span>  
  
 <span data-ttu-id="298f3-166">Aby uzyskać nazwę SPN konta usługi, musisz być administratorem domeny Active Directory.</span><span class="sxs-lookup"><span data-stu-id="298f3-166">To obtain an SPN for your service's account, you need to be an Active Directory domain administrator.</span></span> <span data-ttu-id="298f3-167">Aby uzyskać więcej informacji, zobacz [dodatek dotyczący protokołu Kerberos dla systemu Windows](https://go.microsoft.com/fwlink/?LinkID=88330).</span><span class="sxs-lookup"><span data-stu-id="298f3-167">For more information, see [Kerberos Technical Supplement for Windows](https://go.microsoft.com/fwlink/?LinkID=88330).</span></span>  
  
#### <a name="kerberos-protocol-direct-requires-the-service-to-run-under-a-domain-machine-account"></a><span data-ttu-id="298f3-168">Protokół Kerberos Direct wymaga, aby usługa działała w ramach konta komputera domeny</span><span class="sxs-lookup"><span data-stu-id="298f3-168">Kerberos Protocol Direct Requires the Service to Run Under a Domain Machine Account</span></span>  
 <span data-ttu-id="298f3-169">Dzieje się tak, gdy właściwość `ClientCredentialType` jest ustawiona na `Windows`, a właściwość <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> jest ustawiona na `false`, jak pokazano w poniższym kodzie.</span><span class="sxs-lookup"><span data-stu-id="298f3-169">This occurs when the `ClientCredentialType` property is set to `Windows` and the <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> property is set to `false`, as shown in the following code.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#1)]
 [!code-vb[C_DebuggingWindowsAuth#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#1)]  
  
 <span data-ttu-id="298f3-170">Aby rozwiązać ten sposób, uruchom usługę przy użyciu konta komputera domeny, takiego jak usługa sieciowa, na komputerze przyłączonym do domeny.</span><span class="sxs-lookup"><span data-stu-id="298f3-170">To remedy, run the service using a Domain Machine account, such as Network Service, on a domain joined machine.</span></span>  
  
### <a name="delegation-requires-credential-negotiation"></a><span data-ttu-id="298f3-171">Delegowanie wymaga negocjowania poświadczeń</span><span class="sxs-lookup"><span data-stu-id="298f3-171">Delegation Requires Credential Negotiation</span></span>  
 <span data-ttu-id="298f3-172">Aby użyć protokołu uwierzytelniania Kerberos z delegowaniem, należy zaimplementować protokół Kerberos za pomocą negocjacji poświadczeń (czasami nazywany "wieloetapowym" lub "wieloetapowym" Kerberos).</span><span class="sxs-lookup"><span data-stu-id="298f3-172">To use the Kerberos authentication protocol with delegation, you must implement the Kerberos protocol with credential negotiation (sometimes called "multi-leg" or "multi-step" Kerberos).</span></span> <span data-ttu-id="298f3-173">W przypadku zaimplementowania uwierzytelniania przy użyciu protokołu Kerberos bez negocjowania poświadczeń (nazywanego czasem "pojedynczym zrzutem" lub "jednoetapowa" Kerberos) zostanie zgłoszony wyjątek.</span><span class="sxs-lookup"><span data-stu-id="298f3-173">If you implement Kerberos authentication without credential negotiation (sometimes called "one-shot" or "single-leg" Kerberos), an exception will be thrown.</span></span>  
  
 <span data-ttu-id="298f3-174">Aby zaimplementować protokół Kerberos za pomocą negocjacji poświadczeń, wykonaj następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="298f3-174">To implement Kerberos with credential negotiation, do the following steps:</span></span>  
  
1. <span data-ttu-id="298f3-175">Implementowanie delegowania przez ustawienie <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span><span class="sxs-lookup"><span data-stu-id="298f3-175">Implement delegation by setting <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> to <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span>  
  
2. <span data-ttu-id="298f3-176">Wymagaj negocjacji interfejsu SSPI:</span><span class="sxs-lookup"><span data-stu-id="298f3-176">Require SSPI negotiation:</span></span>  
  
    1. <span data-ttu-id="298f3-177">Jeśli używasz powiązań standardowych, ustaw właściwość `NegotiateServiceCredential` na `true`.</span><span class="sxs-lookup"><span data-stu-id="298f3-177">If you are using standard bindings, set the `NegotiateServiceCredential` property to `true`.</span></span>  
  
    2. <span data-ttu-id="298f3-178">Jeśli używasz powiązań niestandardowych, ustaw atrybut `AuthenticationMode` elementu `Security` na `SspiNegotiated`.</span><span class="sxs-lookup"><span data-stu-id="298f3-178">If you are using custom bindings, set the `AuthenticationMode` attribute of the `Security` element to `SspiNegotiated`.</span></span>  
  
3. <span data-ttu-id="298f3-179">Wymagaj negocjacji interfejsu SSPI do korzystania z protokołu Kerberos przez niezezwalanie na korzystanie z uwierzytelniania NTLM:</span><span class="sxs-lookup"><span data-stu-id="298f3-179">Require the SSPI negotiation to use Kerberos by disallowing the use of NTLM:</span></span>  
  
    1. <span data-ttu-id="298f3-180">Zrób to w kodzie, z następującą instrukcją: `ChannelFactory.Credentials.Windows.AllowNtlm = false`</span><span class="sxs-lookup"><span data-stu-id="298f3-180">Do this in code, with the following statement: `ChannelFactory.Credentials.Windows.AllowNtlm = false`</span></span>  
  
    2. <span data-ttu-id="298f3-181">Lub możesz to zrobić w pliku konfiguracji, ustawiając atrybut `allowNtlm` na `false`.</span><span class="sxs-lookup"><span data-stu-id="298f3-181">Or you can do this in the configuration file by setting the `allowNtlm` attribute to `false`.</span></span> <span data-ttu-id="298f3-182">Ten atrybut jest zawarty w [\<> systemu Windows](../../../../docs/framework/configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md).</span><span class="sxs-lookup"><span data-stu-id="298f3-182">This attribute is contained in the [\<windows>](../../../../docs/framework/configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md).</span></span>  
  
### <a name="ntlm-protocol"></a><span data-ttu-id="298f3-183">Protokół NTLM</span><span class="sxs-lookup"><span data-stu-id="298f3-183">NTLM Protocol</span></span>  
  
#### <a name="negotiate-ssp-falls-back-to-ntlm-but-ntlm-is-disabled"></a><span data-ttu-id="298f3-184">Negocjowanie dostawcy SSP powraca do protokołu NTLM, ale uwierzytelnianie NTLM jest wyłączone</span><span class="sxs-lookup"><span data-stu-id="298f3-184">Negotiate SSP Falls Back to NTLM, but NTLM Is Disabled</span></span>  
 <span data-ttu-id="298f3-185">Właściwość <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> jest ustawiona na `false`, co powoduje, że Windows Communication Foundation (WCF), aby najlepszym wysiłku zgłosić wyjątek, jeśli jest używany protokół NTLM.</span><span class="sxs-lookup"><span data-stu-id="298f3-185">The <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> property is set to `false`, which causes Windows Communication Foundation (WCF) to make a best-effort to throw an exception if NTLM is used.</span></span> <span data-ttu-id="298f3-186">Należy pamiętać, że ustawienie tej właściwości na `false` może nie uniemożliwiać wysyłania poświadczeń NTLM za pośrednictwem sieci.</span><span class="sxs-lookup"><span data-stu-id="298f3-186">Note that setting this property to `false` may not prevent NTLM credentials from being sent over the wire.</span></span>  
  
 <span data-ttu-id="298f3-187">Poniżej przedstawiono sposób wyłączenia powrotu do protokołu NTLM.</span><span class="sxs-lookup"><span data-stu-id="298f3-187">The following shows how to disable fallback to NTLM.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#4)]
 [!code-vb[C_DebuggingWindowsAuth#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#4)]  
  
#### <a name="ntlm-logon-fails"></a><span data-ttu-id="298f3-188">Logowanie NTLM kończy się niepowodzeniem</span><span class="sxs-lookup"><span data-stu-id="298f3-188">NTLM Logon Fails</span></span>  
 <span data-ttu-id="298f3-189">Poświadczenia klienta nie są prawidłowe w usłudze.</span><span class="sxs-lookup"><span data-stu-id="298f3-189">The client credentials are not valid on the service.</span></span> <span data-ttu-id="298f3-190">Sprawdź, czy nazwa użytkownika i hasło są poprawnie ustawione i odpowiadają kontu znanemu komputerowi, na którym uruchomiono usługę.</span><span class="sxs-lookup"><span data-stu-id="298f3-190">Check that the user name and password are correctly set and correspond to an account that is known to the computer where the service is running.</span></span> <span data-ttu-id="298f3-191">Protokół NTLM używa określonych poświadczeń do logowania się do komputera usługi.</span><span class="sxs-lookup"><span data-stu-id="298f3-191">NTLM uses the specified credentials to log on to the service's computer.</span></span> <span data-ttu-id="298f3-192">Poświadczenia mogą być prawidłowe na komputerze, na którym jest uruchomiony klient programu, więc logowanie nie powiedzie się, jeśli poświadczenia na komputerze usługi nie są prawidłowe.</span><span class="sxs-lookup"><span data-stu-id="298f3-192">While the credentials may be valid on the computer where the client is running, this logon will fail if the credentials are not valid on the service's computer.</span></span>  
  
#### <a name="anonymous-ntlm-logon-occurs-but-anonymous-logons-are-disabled-by-default"></a><span data-ttu-id="298f3-193">Występuje anonimowe logowanie NTLM, ale Logowanie anonimowe jest domyślnie wyłączone</span><span class="sxs-lookup"><span data-stu-id="298f3-193">Anonymous NTLM Logon Occurs, but Anonymous Logons Are Disabled by Default</span></span>  
 <span data-ttu-id="298f3-194">Podczas tworzenia klienta Właściwość <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> jest ustawiona na <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, jak pokazano w poniższym przykładzie, ale domyślnie serwer nie zezwala na Logowanie anonimowe.</span><span class="sxs-lookup"><span data-stu-id="298f3-194">When creating a client, the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property is set to <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, as shown in the following example, but by default the server disallows anonymous logons.</span></span> <span data-ttu-id="298f3-195">Dzieje się tak, ponieważ wartość domyślna właściwości <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> klasy <xref:System.ServiceModel.Security.WindowsServiceCredential> jest `false`.</span><span class="sxs-lookup"><span data-stu-id="298f3-195">This occurs because the default value of the <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> property of the <xref:System.ServiceModel.Security.WindowsServiceCredential> class is `false`.</span></span>  
  
 <span data-ttu-id="298f3-196">Poniższy kod klienta próbuje włączyć Logowanie anonimowe (należy pamiętać, że właściwość domyślna to `Identification`).</span><span class="sxs-lookup"><span data-stu-id="298f3-196">The following client code attempts to enable anonymous logons (note that the default property is `Identification`).</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#5)]
 [!code-vb[C_DebuggingWindowsAuth#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#5)]  
  
 <span data-ttu-id="298f3-197">Poniższy kod usługi zmienia wartość domyślną, aby umożliwić Logowanie anonimowe przez serwer.</span><span class="sxs-lookup"><span data-stu-id="298f3-197">The following service code changes the default to enable anonymous logons by the server.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#6)]
 [!code-vb[C_DebuggingWindowsAuth#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#6)]  
  
 <span data-ttu-id="298f3-198">Aby uzyskać więcej informacji na temat personifikacji, zobacz [delegowanie i personifikacja](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="298f3-198">For more information about impersonation, see [Delegation and Impersonation](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span></span>  
  
 <span data-ttu-id="298f3-199">Alternatywnie klient działa jako usługa systemu Windows przy użyciu wbudowanego systemu kont.</span><span class="sxs-lookup"><span data-stu-id="298f3-199">Alternatively, the client is running as a Windows service, using the built-in account SYSTEM.</span></span>  
  
### <a name="other-problems"></a><span data-ttu-id="298f3-200">Inne problemy</span><span class="sxs-lookup"><span data-stu-id="298f3-200">Other Problems</span></span>  
  
#### <a name="client-credentials-are-not-set-correctly"></a><span data-ttu-id="298f3-201">Poświadczenia klienta nie są ustawione prawidłowo</span><span class="sxs-lookup"><span data-stu-id="298f3-201">Client Credentials Are Not Set Correctly</span></span>  
 <span data-ttu-id="298f3-202">Uwierzytelnianie systemu Windows używa wystąpienia <xref:System.ServiceModel.Security.WindowsClientCredential> zwróconego przez właściwość <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> klasy <xref:System.ServiceModel.ClientBase%601>, a nie do <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span><span class="sxs-lookup"><span data-stu-id="298f3-202">Windows authentication uses the <xref:System.ServiceModel.Security.WindowsClientCredential> instance returned by the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the <xref:System.ServiceModel.ClientBase%601> class, not the <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span></span> <span data-ttu-id="298f3-203">Poniżej przedstawiono nieprawidłowy przykład.</span><span class="sxs-lookup"><span data-stu-id="298f3-203">The following shows an incorrect example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#2)]
 [!code-vb[C_DebuggingWindowsAuth#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#2)]  
  
 <span data-ttu-id="298f3-204">Poniżej przedstawiono poprawność przykładu.</span><span class="sxs-lookup"><span data-stu-id="298f3-204">The following shows the correct example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#3)]
 [!code-vb[C_DebuggingWindowsAuth#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#3)]  
  
#### <a name="sspi-is-not-available"></a><span data-ttu-id="298f3-205">Interfejs SSPI jest niedostępny</span><span class="sxs-lookup"><span data-stu-id="298f3-205">SSPI Is Not Available</span></span>  
 <span data-ttu-id="298f3-206">Następujące systemy operacyjne nie obsługują uwierzytelniania systemu Windows, gdy jest używany jako serwer: [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition, [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Media Center Edition i Windows Vista Home wersje.</span><span class="sxs-lookup"><span data-stu-id="298f3-206">The following operating systems do not support Windows authentication when used as a server: [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition, [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Media Center Edition, and Windows Vista Home editions.</span></span>  
  
#### <a name="developing-and-deploying-with-different-identities"></a><span data-ttu-id="298f3-207">Opracowywanie i wdrażanie przy użyciu różnych tożsamości</span><span class="sxs-lookup"><span data-stu-id="298f3-207">Developing and Deploying with Different Identities</span></span>  
 <span data-ttu-id="298f3-208">Jeśli tworzysz aplikację na jednej maszynie i wdrażasz ją na innym serwerze i używasz innych typów kont do uwierzytelniania na każdej maszynie, może wystąpić inne zachowanie.</span><span class="sxs-lookup"><span data-stu-id="298f3-208">If you develop your application on one machine, and deploy on another, and use different account types to authenticate on each machine, you may experience different behavior.</span></span> <span data-ttu-id="298f3-209">Załóżmy na przykład, że tworzysz aplikację na komputerze z systemem Windows XP Pro przy użyciu trybu uwierzytelniania `SSPI Negotiated`.</span><span class="sxs-lookup"><span data-stu-id="298f3-209">For example, suppose you develop your application on a Windows XP Pro machine using the `SSPI Negotiated` authentication mode.</span></span> <span data-ttu-id="298f3-210">Jeśli używasz konta użytkownika lokalnego do uwierzytelniania za pomocą programu, zostanie użyty protokół NTLM.</span><span class="sxs-lookup"><span data-stu-id="298f3-210">If you use a local user account to authenticate with, then NTLM protocol will be used.</span></span> <span data-ttu-id="298f3-211">Po opracowaniu aplikacji należy wdrożyć usługę na komputerze z systemem Windows Server 2003, na którym działa w ramach konta domeny.</span><span class="sxs-lookup"><span data-stu-id="298f3-211">Once the application is developed, you deploy the service to a Windows Server 2003 machine where it runs under a domain account.</span></span> <span data-ttu-id="298f3-212">W tym momencie klient nie będzie w stanie uwierzytelnić usługi, ponieważ będzie korzystać z protokołu Kerberos i kontrolera domeny.</span><span class="sxs-lookup"><span data-stu-id="298f3-212">At this point the client will not be able to authenticate the service because it will be using Kerberos and a domain controller.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="298f3-213">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="298f3-213">See also</span></span>

- <xref:System.ServiceModel.Security.WindowsClientCredential>
- <xref:System.ServiceModel.Security.WindowsServiceCredential>
- <xref:System.ServiceModel.Security.WindowsClientCredential>
- <xref:System.ServiceModel.ClientBase%601>
- [<span data-ttu-id="298f3-214">Delegowanie i personifikacja</span><span class="sxs-lookup"><span data-stu-id="298f3-214">Delegation and Impersonation</span></span>](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)
- [<span data-ttu-id="298f3-215">Nieobsługiwane scenariusze</span><span class="sxs-lookup"><span data-stu-id="298f3-215">Unsupported Scenarios</span></span>](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md)
