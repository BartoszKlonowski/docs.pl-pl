---
title: "Najlepsze rozwiązania dotyczące sesji niezawodnych"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: b94f6e01-8070-40b6-aac7-a2cb7b4cb4f2
caps.latest.revision: "6"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: c022db62103826aa89e9035fd36c050d1f7c0f84
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 12/22/2017
---
# <a name="best-practices-for-reliable-sessions"></a><span data-ttu-id="27dfc-102">Najlepsze rozwiązania dotyczące sesji niezawodnych</span><span class="sxs-lookup"><span data-stu-id="27dfc-102">Best Practices for Reliable Sessions</span></span>

<span data-ttu-id="27dfc-103">W tym temacie omówiono najlepsze rozwiązania dla sesji niezawodnej.</span><span class="sxs-lookup"><span data-stu-id="27dfc-103">This topic discusses best practices for reliable sessions.</span></span>

## <a name="setting-maxtransferwindowsize"></a><span data-ttu-id="27dfc-104">Ustawienie MaxTransferWindowSize</span><span class="sxs-lookup"><span data-stu-id="27dfc-104">Setting MaxTransferWindowSize</span></span>

<span data-ttu-id="27dfc-105">Niezawodne sesje w [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] okno transferu służy do przechowywania wiadomości na klienta i usługi.</span><span class="sxs-lookup"><span data-stu-id="27dfc-105">Reliable sessions in [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] use a transfer window to hold messages on the client and service.</span></span> <span data-ttu-id="27dfc-106">Można skonfigurować właściwości <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> wskazuje, ile komunikatów okna transfer może przechowywać.</span><span class="sxs-lookup"><span data-stu-id="27dfc-106">The configurable property <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> indicates how many messages the transfer window can hold.</span></span>

<span data-ttu-id="27dfc-107">Na nadawcy oznacza to, ile komunikatów okna transfer może przechowywać podczas oczekiwania na potwierdzeń; odbiornik wskazuje ile komunikatów do buforowania dla usługi.</span><span class="sxs-lookup"><span data-stu-id="27dfc-107">On the sender, this indicates how many messages the transfer window can hold while waiting for acknowledgements; on the receiver, it indicates how many messages to buffer for the service.</span></span>

<span data-ttu-id="27dfc-108">Wybieranie właściwego rozmiaru wpływa na wydajność sieci i optymalną wydajność usług.</span><span class="sxs-lookup"><span data-stu-id="27dfc-108">Choosing the right size impacts the efficiency of the network and the optimal capacity of the service.</span></span> <span data-ttu-id="27dfc-109">W poniższych sekcjach opisano, co należy wziąć pod uwagę podczas wybierania wartości dla tej właściwości i ich wpływ na wartość.</span><span class="sxs-lookup"><span data-stu-id="27dfc-109">The following sections detail what to consider when choosing a value for this property and the impact of the value.</span></span>

<span data-ttu-id="27dfc-110">Domyślny rozmiar okna transfer jest osiem wiadomości.</span><span class="sxs-lookup"><span data-stu-id="27dfc-110">The default transfer window size is eight messages.</span></span>

### <a name="efficient-use-of-the-network"></a><span data-ttu-id="27dfc-111">Efektywne wykorzystanie sieci</span><span class="sxs-lookup"><span data-stu-id="27dfc-111">Efficient use of the network</span></span>

<span data-ttu-id="27dfc-112">W tym kontekście termin *sieci* odpowiada wszystko, co jest używane jako podstawa komunikacji między klientem (nadawcy) i usługi (odbiorca).</span><span class="sxs-lookup"><span data-stu-id="27dfc-112">In this context, the term *network* corresponds to everything used as the basis of communication between a client (sender) and a service (receiver).</span></span> <span data-ttu-id="27dfc-113">Dotyczy to również połączenia transportu i pośredników lub mostków w między tym routery SOAP i HTTP proxy/zapory.</span><span class="sxs-lookup"><span data-stu-id="27dfc-113">This includes the transport connections and any intermediary or bridges in between, including SOAP routers or HTTP proxies/firewalls.</span></span>

<span data-ttu-id="27dfc-114">Efektywne wykorzystanie sieci zapewnia pełni służy pojemność sieci.</span><span class="sxs-lookup"><span data-stu-id="27dfc-114">Efficient use of the network ensures that network capacity is fully used.</span></span> <span data-ttu-id="27dfc-115">Ilość danych, który można przenosić za pośrednictwem sieci na sekundę (*szybkość danych*) i czas potrzebny na transfer danych od nadawcy, odbiorcy (*opóźnienia*) wpływ jak skutecznie sieci jest wykorzystywany.</span><span class="sxs-lookup"><span data-stu-id="27dfc-115">Both the amount of data that can be transferred per second over the network (*data rate*) and the time it takes to transfer data from the sender to the receiver (*latency*) impact how effectively the network is utilized.</span></span>

<span data-ttu-id="27dfc-116">Na nadawcy, właściwość <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> wskazuje, ile komunikatów okna transfer może przechowywać podczas oczekiwania na potwierdzeń.</span><span class="sxs-lookup"><span data-stu-id="27dfc-116">On the sender, the property <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> indicates how many messages its transfer window can hold while waiting for acknowledgements.</span></span> <span data-ttu-id="27dfc-117">Jeśli opóźnienie w sieci jest wysokie, a w celu zapewnienia odpowiadać nadawcy i wykorzystania sieci skuteczne, należy zwiększyć rozmiar okna transmisji.</span><span class="sxs-lookup"><span data-stu-id="27dfc-117">If the network latency is high and in order to ensure a responsive sender and effective network utilization, you should increase the transfer window size.</span></span>

<span data-ttu-id="27dfc-118">Na przykład nawet wtedy, gdy nadawca zachowuje o szybkości danych, czas oczekiwania może być wysoka Jeśli istnieje kilka pośredników między nadawcą i odbiorcą lub dane przechodzą przez pośrednika stratna lub sieci.</span><span class="sxs-lookup"><span data-stu-id="27dfc-118">For example even if the sender keeps up with data rate, latency could be high if several intermediaries exist between the sender and receiver or the data must pass through a lossy intermediary or network.</span></span> <span data-ttu-id="27dfc-119">W związku z tym nadawca ma oczekiwania potwierdzeń komunikatów w jego oknie transmisji zanim zaczną akceptować nowych komunikatów do wysłania w sieci.</span><span class="sxs-lookup"><span data-stu-id="27dfc-119">Thus, the sender has to wait for acknowledgements for the messages in its transfer window before accepting new messages to send on the wire.</span></span> <span data-ttu-id="27dfc-120">Mniejszy rozmiar buforu duże opóźnienie, mniej skuteczne użycie sieci.</span><span class="sxs-lookup"><span data-stu-id="27dfc-120">The smaller the buffer with high latency, the less effective the network utilization.</span></span> <span data-ttu-id="27dfc-121">Z drugiej strony zbyt duży rozmiar okna transmisji może mieć wpływ usługi, ponieważ usługa może być konieczne nadążyć wysokiej szybkości danych wysłanych przez klienta.</span><span class="sxs-lookup"><span data-stu-id="27dfc-121">On the other hand, too high a transfer window size may impact the service because the service may need to catch up to the high rate of data sent by the client.</span></span>

### <a name="running-the-service-to-capacity"></a><span data-ttu-id="27dfc-122">Uruchomiona usługa pojemności</span><span class="sxs-lookup"><span data-stu-id="27dfc-122">Running the service to capacity</span></span>

<span data-ttu-id="27dfc-123">Jak sieci są wydajnie używane, najlepiej również ma usługę by było uruchamiane z optymalną wydajność.</span><span class="sxs-lookup"><span data-stu-id="27dfc-123">As much as the network is used efficiently, ideally you also want the service to run at optimal capacity.</span></span> <span data-ttu-id="27dfc-124">Właściwość rozmiar okna transfer odbiornika wskazuje ile komunikatów można buforować odbiornika.</span><span class="sxs-lookup"><span data-stu-id="27dfc-124">The transfer window size property on the receiver indicates how many messages the receiver can buffer.</span></span> <span data-ttu-id="27dfc-125">Ten komunikat buforowanie umożliwia nie tylko sterowanie przepływem sieci, ale umożliwia również usługę, aby uruchomić pełną pojemność.</span><span class="sxs-lookup"><span data-stu-id="27dfc-125">This message buffering helps not only the network flow control but also enables the service to run to full capacity.</span></span> <span data-ttu-id="27dfc-126">Na przykład, jeśli bufor jest jeden komunikat i szybciej, niż może je przetwarzać usługi nadchodzą komunikaty następnie sieci może porzucić wiadomości i pojemności może niewykorzystana lub niedostatecznego wykorzystania.</span><span class="sxs-lookup"><span data-stu-id="27dfc-126">For example if the buffer is one message and messages arrive faster than the service can process them, then the network might drop messages and capacity might be wasted or underutilized.</span></span>

<span data-ttu-id="27dfc-127">Przy użyciu buforu zwiększa dostępność usługi jednocześnie odbiera i buforuje komunikat podczas przetwarzania wcześniej odebranej wiadomości.</span><span class="sxs-lookup"><span data-stu-id="27dfc-127">Using a buffer increases the availability of the service as it concurrently receives and buffers a message while processing the previously received messages.</span></span>

<span data-ttu-id="27dfc-128">Zaleca się używać tego samego `MaxTransferWindowSize` na nadawcy i odbiorcy.</span><span class="sxs-lookup"><span data-stu-id="27dfc-128">We recommended that you use the same `MaxTransferWindowSize` on both the sender and receiver.</span></span>

### <a name="enabling-flow-control"></a><span data-ttu-id="27dfc-129">Włączanie przepływu sterowania</span><span class="sxs-lookup"><span data-stu-id="27dfc-129">Enabling flow control</span></span>

<span data-ttu-id="27dfc-130">*Sterowanie przepływem* mechanizm, który zapewnia nadawcę i odbiorcę bieżąco ze sobą, oznacza to, że komunikaty są używane i reagować tak szybko, jak są one tworzone.</span><span class="sxs-lookup"><span data-stu-id="27dfc-130">*Flow control* is a mechanism that ensures that the sender and receiver keep pace with each other, that is, the messages are consumed and acted upon as fast as they're produced.</span></span> <span data-ttu-id="27dfc-131">Rozmiar okna transmisji na klienta i usługi zapewnia, że nadawca i odbiorca są uzasadnione okna synchronizacji.</span><span class="sxs-lookup"><span data-stu-id="27dfc-131">The transfer window size on the client and service ensures that the sender and receiver are within a reasonable window of synchronization.</span></span>

<span data-ttu-id="27dfc-132">Zaleca się ustawienie właściwości <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.FlowControlEnabled%2A> do `true` Jeśli używasz niezawodnej sesji między [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] klienta i [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] usługi.</span><span class="sxs-lookup"><span data-stu-id="27dfc-132">We highly recommended that you set the property <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.FlowControlEnabled%2A> to `true` when you're using a reliable session between a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] client and a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service.</span></span>

## <a name="setting-maxpendingchannels"></a><span data-ttu-id="27dfc-133">Ustawienie MaxPendingChannels</span><span class="sxs-lookup"><span data-stu-id="27dfc-133">Setting MaxPendingChannels</span></span>

<span data-ttu-id="27dfc-134">Podczas zapisywania to usługa umożliwiająca komunikacji niezawodnej sesji od różnych klientów, istnieje możliwość dużej liczby klientów utworzyć niezawodnej sesji z usługą w tym samym czasie.</span><span class="sxs-lookup"><span data-stu-id="27dfc-134">When writing a service that enables reliable session communication from different clients, it's possible to have many clients establish a reliable session to the service at the same time.</span></span> <span data-ttu-id="27dfc-135">Odpowiedź usługi w takich sytuacjach jest zależna od `MaxPendingChannels` właściwości.</span><span class="sxs-lookup"><span data-stu-id="27dfc-135">The response of the service in these situations depends on the `MaxPendingChannels` property.</span></span>

<span data-ttu-id="27dfc-136">Gdy nadawca tworzy kanał niezawodnej sesji do odbiornika, uzgadniania między nimi ustanawia niezawodnej sesji.</span><span class="sxs-lookup"><span data-stu-id="27dfc-136">When the sender creates a reliable session channel to a receiver, a handshake between them establishes a reliable session.</span></span> <span data-ttu-id="27dfc-137">Po ustanowieniu sesji niezawodnej kanał jest umieszczany w kolejce kanałów oczekujących na akceptację przez usługę.</span><span class="sxs-lookup"><span data-stu-id="27dfc-137">After the reliable session is established, the channel is put in a pending channel queue for acceptance by the service.</span></span> <span data-ttu-id="27dfc-138">`MaxPendingChannels` Właściwość wskazuje, ile kanałów może znajdować się w tym stanie.</span><span class="sxs-lookup"><span data-stu-id="27dfc-138">The `MaxPendingChannels` property indicates how many channels can be in this state.</span></span>

<span data-ttu-id="27dfc-139">Istnieje możliwość usługa jest w stanie, w których nie można zaakceptować więcej kanałów.</span><span class="sxs-lookup"><span data-stu-id="27dfc-139">It's possible for the service to be in a state where it can't accept more channels.</span></span> <span data-ttu-id="27dfc-140">Jeśli kolejka jest pełna, próby ustanowienia niezawodnej sesji zostało odrzucone, a klient musi próbę.</span><span class="sxs-lookup"><span data-stu-id="27dfc-140">If the queue is full, an attempt to establish a reliable session is rejected, and the client must retry.</span></span>

<span data-ttu-id="27dfc-141">Istnieje również możliwość, że kanałów oczekujących w kolejce pozostają w kolejce przez dłuższy czas.</span><span class="sxs-lookup"><span data-stu-id="27dfc-141">It's also possible that the pending channels in the queue remain in the queue for a longer duration.</span></span> <span data-ttu-id="27dfc-142">Tymczasem limitu czasu bezczynności sesji niezawodnej może wystąpić, powoduje kanału do przejścia do stan.</span><span class="sxs-lookup"><span data-stu-id="27dfc-142">In the meantime, an inactivity timeout on the reliable session may occur, causing the channel to transition to a faulted state.</span></span>

<span data-ttu-id="27dfc-143">Podczas zapisywania usługę, która obsługuje wielu klientów jednocześnie, należy ustawić wartość, która jest odpowiednia do własnych potrzeb.</span><span class="sxs-lookup"><span data-stu-id="27dfc-143">When writing a service that services multiple clients simultaneously, you should set a value that's suitable for your needs.</span></span> <span data-ttu-id="27dfc-144">Ustawienie zbyt wysokiej wartości dla `MaxPendingChannels` właściwość ma wpływ na zestaw roboczy.</span><span class="sxs-lookup"><span data-stu-id="27dfc-144">Setting too high a value for the `MaxPendingChannels` property impacts your working set.</span></span>

<span data-ttu-id="27dfc-145">Wartość domyślna dla <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxPendingChannels%2A> jest czterech kanałów.</span><span class="sxs-lookup"><span data-stu-id="27dfc-145">The default value for <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxPendingChannels%2A> is four channels.</span></span>

## <a name="reliable-sessions-and-hosting"></a><span data-ttu-id="27dfc-146">Niezawodne sesje i hostingu</span><span class="sxs-lookup"><span data-stu-id="27dfc-146">Reliable sessions and hosting</span></span>

<span data-ttu-id="27dfc-147">Gdy sieci web obsługującym usługę korzystającą z sesji niezawodnych, następujące istotne kwestie należy mieć na uwadze:</span><span class="sxs-lookup"><span data-stu-id="27dfc-147">When web hosting a service that uses reliable sessions, you should keep the following important considerations in mind:</span></span>

- <span data-ttu-id="27dfc-148">Niezawodnej sesji nie jest obiektem stanowym i stanie są przechowywane w obiekcie AppDomain.</span><span class="sxs-lookup"><span data-stu-id="27dfc-148">Reliable sessions are stateful, and state is maintained in the AppDomain.</span></span> <span data-ttu-id="27dfc-149">Oznacza to, że wszystkie komunikaty, które są częścią niezawodnej sesji muszą być przetwarzane w tej samej domenie AppDomain.</span><span class="sxs-lookup"><span data-stu-id="27dfc-149">This means that all messages that are part of a reliable session must be processed in the same AppDomain.</span></span> <span data-ttu-id="27dfc-150">Farmy serwerów sieci Web i ogrodach sieci web, których rozmiar farmy lub ogrodu jest większa niż jeden węzeł nie gwarantuje to ograniczenie.</span><span class="sxs-lookup"><span data-stu-id="27dfc-150">Web farms and web gardens where the size of the farm or garden is greater than one node can't guarantee this constraint.</span></span>

- <span data-ttu-id="27dfc-151">Niezawodnej sesji przy użyciu dwa kanały HTTP (na przykład za pomocą `WsDualHttpBinding`) mogą wymagać więcej niż domyślne dwa połączenia na — klient HTTP.</span><span class="sxs-lookup"><span data-stu-id="27dfc-151">Reliable sessions using dual HTTP channels (for example, using `WsDualHttpBinding`) can require more than the default of two HTTP connections per-client.</span></span> <span data-ttu-id="27dfc-152">Oznacza to, że niezawodnej sesji dupleksowej może wymagać połączeń do dwóch każdego sposób, ponieważ równoczesnych komunikatów aplikacji i protokół może przesyłania każdego sposób w danym momencie.</span><span class="sxs-lookup"><span data-stu-id="27dfc-152">This means a duplex reliable session can require up to two connections each way because concurrent application and protocol messages may be transferring each way at any given time.</span></span> <span data-ttu-id="27dfc-153">W niektórych warunkach, w zależności od wymiany komunikatów usługi oznacza to, że ma możliwość zakleszczenie usługi hostowanej w sieci web przy użyciu dwóch HTTP i sesje niezawodne.</span><span class="sxs-lookup"><span data-stu-id="27dfc-153">Under certain conditions depending on the message exchange pattern of the service, this means that it's possible to deadlock a web-hosted service using dual HTTP and reliable sessions.</span></span> <span data-ttu-id="27dfc-154">Aby zwiększyć liczbę dozwolonych połączeń HTTP na klienta, dodaj następującą wartość do pliku konfiguracyjnego odpowiedniego (na przykład *web.config* z danej usługi):</span><span class="sxs-lookup"><span data-stu-id="27dfc-154">To increase the number of allowable HTTP connections per client, add the following to the relevant configuration file (for example, *web.config* of the service in question):</span></span>

  ```xml
  <configuration>
    <system.net>
      <connectionManagement>
        <add name="*" maxconnection="4" />
      </connectionManagement>
    </system.net>
  </configuration>
  ```

  <span data-ttu-id="27dfc-155">Wartość `maxconnection` atrybut jest wymagana liczba połączeń.</span><span class="sxs-lookup"><span data-stu-id="27dfc-155">The value of the `maxconnection` attribute is the number of connections needed.</span></span> <span data-ttu-id="27dfc-156">W takim przypadku powinno być cztery połączenia.</span><span class="sxs-lookup"><span data-stu-id="27dfc-156">The minimum in this case should be four connections.</span></span>
