---
title: Korelacja na podstawie zawartości
ms.date: 03/30/2017
ms.assetid: f46a2b68-8d24-4122-bbee-9573fc3f9fb4
ms.openlocfilehash: 48009420788b8678f842c4368926e04f8a745a52
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 05/04/2018
ms.locfileid: "33494218"
---
# <a name="content-based-correlation"></a><span data-ttu-id="cf446-102">Korelacja na podstawie zawartości</span><span class="sxs-lookup"><span data-stu-id="cf446-102">Content Based Correlation</span></span>
<span data-ttu-id="cf446-103">Gdy usługi przepływu pracy komunikację z klientami oraz innymi usługami, często istnieje części danych w ramach wymiany wiadomości, które jednoznacznie odnosi się komunikat do konkretnego wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="cf446-103">When workflow services communicate with clients and other services, often there is some data in the exchanged messages that uniquely relates a message to a particular instance.</span></span> <span data-ttu-id="cf446-104">Na podstawie zawartości korelacji używa tych danych w komunikacie, takich jak numer lub kolejności ID klienta do wyznaczania tras wiadomościom do wystąpienia przepływu pracy właściwe.</span><span class="sxs-lookup"><span data-stu-id="cf446-104">Content-based correlation uses this data in the message, such as a customer number or order ID, to route messages to the proper workflow instance.</span></span> <span data-ttu-id="cf446-105">W tym temacie opisano sposób korzystania na podstawie zawartości korelacji w przepływach pracy.</span><span class="sxs-lookup"><span data-stu-id="cf446-105">This topic explains how to use content-based correlation in workflows.</span></span>  
  
## <a name="using-content-based-correlation"></a><span data-ttu-id="cf446-106">Przy użyciu korelacji na podstawie zawartości</span><span class="sxs-lookup"><span data-stu-id="cf446-106">Using Content-Based Correlation</span></span>  
 <span data-ttu-id="cf446-107">Korelacja na podstawie zawartości jest używany, gdy usługi przepływu pracy posiada wiele metod, które są udostępniane przez pojedynczego klienta i element danych w ramach wymiany wiadomości identyfikuje odpowiednie wystąpienie.</span><span class="sxs-lookup"><span data-stu-id="cf446-107">Content-based correlation is used when a workflow service has multiple methods that are accessed by a single client and a piece of data in the exchanged messages identifies the desired instance.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="cf446-108">Na podstawie zawartości korelacji jest przydatne, gdy nie można użyć korelacji kontekstu, ponieważ powiązanie nie jest jednym z obsługiwanych kontekstu powiązania programu exchange.</span><span class="sxs-lookup"><span data-stu-id="cf446-108">Content-based correlation is useful when context correlation cannot be used because the binding is not one of the supported context exchange bindings.</span></span> <span data-ttu-id="cf446-109">Aby uzyskać więcej informacji o kontekście korelacji, zobacz [wymiana kontekstu](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md).</span><span class="sxs-lookup"><span data-stu-id="cf446-109">For more information about context correlation, see [Context Exchange](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md).</span></span>  
  
 <span data-ttu-id="cf446-110">Każde działanie obsługi wiadomości, używane podczas komunikacji te należy określić lokalizację danych w komunikacie, który unikatowo identyfikuje wystąpienie.</span><span class="sxs-lookup"><span data-stu-id="cf446-110">Each messaging activity used in these communications must specify the location of the data in the message that uniquely identifies the instance.</span></span> <span data-ttu-id="cf446-111">Jest to zrobić, podając <xref:System.ServiceModel.MessageQuerySet>, za pomocą <xref:System.ServiceModel.Activities.QueryCorrelationInitializer> lub <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A>, który wysyła zapytanie do wiadomości dla element lub elementy danych, które jednoznacznie zidentyfikować wystąpienie.</span><span class="sxs-lookup"><span data-stu-id="cf446-111">This is done by providing a <xref:System.ServiceModel.MessageQuerySet>, using either a <xref:System.ServiceModel.Activities.QueryCorrelationInitializer> or <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A>, that queries the message for the piece or pieces of data that uniquely identify the instance.</span></span>  
  
> [!WARNING]
>  <span data-ttu-id="cf446-112">Dane, które służy do identyfikacji wystąpienia jest wartość skrótu na klucz korelacji.</span><span class="sxs-lookup"><span data-stu-id="cf446-112">The data that is used to identify the instance is hashed into a correlation key.</span></span> <span data-ttu-id="cf446-113">Można uważać, aby upewnić się, że dane używane na potrzeby korelacji jest unikatowa w przeciwnym razie kolizji w formie skrótu klucza może wystąpić i komunikaty można rozsyłanymi.</span><span class="sxs-lookup"><span data-stu-id="cf446-113">Care must be taken to ensure that the data used for correlation is unique or else collisions in the hashed key could occur and cause messages to be misrouted.</span></span> <span data-ttu-id="cf446-114">Na przykład korelacji wyłącznie na nazwy klienta może spowodować kolizji, ponieważ może być wielu klientów o takiej samej nazwie.</span><span class="sxs-lookup"><span data-stu-id="cf446-114">For example, a correlation based solely on a customer name may cause a collision because there may be multiple customers with the same name.</span></span> <span data-ttu-id="cf446-115">Dwukropkiem (`:`) nie powinna być używana jako część danych używane do korelacji wiadomości, ponieważ jest już używany do ograniczania kluczy i wartości do utworzenia ciąg, który jest następnie mieszany kwerendy komunikatów.</span><span class="sxs-lookup"><span data-stu-id="cf446-115">The colon (`:`) should not be used as part of the data used to correlate the message because it is already used to delimit the message query’s key and value to form the string that is subsequently hashed.</span></span>  
  
 <span data-ttu-id="cf446-116">W poniższym przykładzie początkowej <xref:System.ServiceModel.Activities.Receive> / <xref:System.ServiceModel.Activities.SendReply> w usłudze przepływu pracy zwraca `OrderId`, które są następnie przekazywane przez klienta w wywołaniu następujące <xref:System.ServiceModel.Activities.Receive> aktywności w usłudze przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="cf446-116">In the following example, the initial <xref:System.ServiceModel.Activities.Receive>/<xref:System.ServiceModel.Activities.SendReply> in a workflow service returns an `OrderId`, which is then passed back by the client on the call to the following <xref:System.ServiceModel.Activities.Receive> activity in the workflow service.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#1)]  
  
 <span data-ttu-id="cf446-117">W poprzednim przykładzie przedstawiono na podstawie zawartości korelacji, który został zainicjowany przez <xref:System.ServiceModel.Activities.SendReply>.</span><span class="sxs-lookup"><span data-stu-id="cf446-117">The previous example shows a content-based correlation that is initialized by the <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="cf446-118"><xref:System.ServiceModel.MessageQuerySet> Określa, czy dane używane do identyfikowania kolejnych komunikatów do tej usługi jest `OrderId`.</span><span class="sxs-lookup"><span data-stu-id="cf446-118">The <xref:System.ServiceModel.MessageQuerySet> specifies that the data used to identify subsequent messages to this service is the `OrderId`.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#2)]  
  
 <span data-ttu-id="cf446-119"><xref:System.ServiceModel.Activities.Receive> Działaniu występującym <xref:System.ServiceModel.Activities.SendReply> w przepływie pracy wykonuje korelacji, który został zainicjowany przez <xref:System.ServiceModel.Activities.SendReply>.</span><span class="sxs-lookup"><span data-stu-id="cf446-119">The <xref:System.ServiceModel.Activities.Receive> activity that follows the <xref:System.ServiceModel.Activities.SendReply> in the workflow follows the correlation that was initialized by the <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="cf446-120">Zarówno działania udostępnianie takie same <xref:System.ServiceModel.Activities.CorrelationHandle>, ale każda z nich ma własny <xref:System.ServiceModel.MessageQuerySet> i <xref:System.ServiceModel.XPathMessageQuery> określający, gdzie dane identyfikacyjne jest w szczególności wiadomości.</span><span class="sxs-lookup"><span data-stu-id="cf446-120">Both activities share the same <xref:System.ServiceModel.Activities.CorrelationHandle>, but each one has its own <xref:System.ServiceModel.MessageQuerySet> and <xref:System.ServiceModel.XPathMessageQuery> that specifies where the identifying data is in that particular message.</span></span> <span data-ttu-id="cf446-121">W działaniu, które inicjuje korelację to <xref:System.ServiceModel.MessageQuerySet> została określona w <xref:System.ServiceModel.Activities.Receive.CorrelationInitializers%2A> właściwości oraz wszystkie następujące <xref:System.ServiceModel.Activities.Receive> działań, zostanie określona, przy użyciu <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A> właściwości.</span><span class="sxs-lookup"><span data-stu-id="cf446-121">On the activity that initializes the correlation, this <xref:System.ServiceModel.MessageQuerySet> is specified in the <xref:System.ServiceModel.Activities.Receive.CorrelationInitializers%2A> property, and for any following <xref:System.ServiceModel.Activities.Receive> activities, it is specified using the <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A> property.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#3)]  
  
 <span data-ttu-id="cf446-122">Korelacja na podstawie zawartości mogą być inicjowane przez żadnego działania obsługi komunikatów (<xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.Receive>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.ReceiveReply>) podczas przepływu danych jako część komunikatu.</span><span class="sxs-lookup"><span data-stu-id="cf446-122">A content-based correlation can be initialized by any messaging activity (<xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.Receive>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.ReceiveReply>) when the data flows as part of a message.</span></span> <span data-ttu-id="cf446-123">Jeśli określonych danych nie przepływu jako część wiadomości, a następnie mogą być inicjowane w jawnie przy użyciu <xref:System.ServiceModel.Activities.InitializeCorrelation> działania.</span><span class="sxs-lookup"><span data-stu-id="cf446-123">If the particular piece of data does not flow as part of a message, then it can be initialized explicitly by using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span> <span data-ttu-id="cf446-124">Jeśli wielu fragmentów danych są wymagane do unikatowej identyfikacji wiadomości, a następnie można dodać wielu zapytań do <xref:System.ServiceModel.MessageQuerySet>.</span><span class="sxs-lookup"><span data-stu-id="cf446-124">If multiple pieces of data are required to uniquely identify the message, then multiple queries can be added to the <xref:System.ServiceModel.MessageQuerySet>.</span></span> <span data-ttu-id="cf446-125">W tych przykładach <xref:System.ServiceModel.Activities.CorrelationHandle> podany wprost do każdej z tych czynności przy użyciu `CorrelatesWith` lub `CorrelationHandle` właściwości, ale jeśli istnieje tylko jedna korelacja wymagane dla całego przepływu pracy, takich jak w tym przykładzie gdzie wszystko są powiązane z na `OrderId`, zarządzanie dojścia korelacji niejawne zapewniane przez <xref:System.ServiceModel.Activities.WorkflowServiceHost> jest wystarczająca.</span><span class="sxs-lookup"><span data-stu-id="cf446-125">In these examples, a <xref:System.ServiceModel.Activities.CorrelationHandle> was explicitly provided to each of the activities using the `CorrelatesWith` or `CorrelationHandle` properties, but if there is only one correlation required for the entire workflow, such as in this example where everything correlates on `OrderId`, the implicit correlation handle management provided by <xref:System.ServiceModel.Activities.WorkflowServiceHost> is sufficient.</span></span>  
  
## <a name="using-the-initializecorrelation-activity"></a><span data-ttu-id="cf446-126">Za pomocą działania InitializeCorrelation</span><span class="sxs-lookup"><span data-stu-id="cf446-126">Using the InitializeCorrelation Activity</span></span>  
 <span data-ttu-id="cf446-127">W poprzednim przykładzie `OrderId` skierowana do wywołującego za pośrednictwem <xref:System.ServiceModel.Activities.SendReply> działanie jest to gdzie korelację został zainicjowany.</span><span class="sxs-lookup"><span data-stu-id="cf446-127">In the previous example, the `OrderId` flowed to the caller through the <xref:System.ServiceModel.Activities.SendReply> activity and this is where the correlation was initialized.</span></span> <span data-ttu-id="cf446-128">Takie samo zachowanie można zrobić za pomocą <xref:System.ServiceModel.Activities.InitializeCorrelation> działania.</span><span class="sxs-lookup"><span data-stu-id="cf446-128">The same behavior can be accomplished by using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span> <span data-ttu-id="cf446-129"><xref:System.ServiceModel.Activities.InitializeCorrelation> Działanie ma <xref:System.ServiceModel.Activities.CorrelationHandle> i słownika elementów, które reprezentują danych służy do mapowania komunikat na prawidłowe wystąpienie.</span><span class="sxs-lookup"><span data-stu-id="cf446-129">The <xref:System.ServiceModel.Activities.InitializeCorrelation> activity takes the <xref:System.ServiceModel.Activities.CorrelationHandle> and a dictionary of items that represent the data used to map the message to the correct instance.</span></span> <span data-ttu-id="cf446-130">Umożliwia <xref:System.ServiceModel.Activities.InitializeCorrelation> działania w poprzednim przykładzie usuń <xref:System.ServiceModel.Activities.SendReply.CorrelationInitializers%2A> z <xref:System.ServiceModel.Activities.SendReply> działania i zainicjować przy użyciu korelacji <xref:System.ServiceModel.Activities.InitializeCorrelation> działania.</span><span class="sxs-lookup"><span data-stu-id="cf446-130">To use the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity in the preceding sample, remove the <xref:System.ServiceModel.Activities.SendReply.CorrelationInitializers%2A> from the <xref:System.ServiceModel.Activities.SendReply> activity and initialize the correlation using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#4)]  
  
 <span data-ttu-id="cf446-131"><xref:System.ServiceModel.Activities.InitializeCorrelation> Działanie jest następnie używane w przepływie pracy, po zmiennych, które są przechowywane dane są wypełnione, lecz przed <xref:System.ServiceModel.Activities.Receive> działanie, które są powiązane z zainicjowane <xref:System.ServiceModel.Activities.CorrelationHandle>.</span><span class="sxs-lookup"><span data-stu-id="cf446-131">The <xref:System.ServiceModel.Activities.InitializeCorrelation> activity is then used in the workflow, after the variables that hold the data are populated but before the <xref:System.ServiceModel.Activities.Receive> activity that correlates with the initialized <xref:System.ServiceModel.Activities.CorrelationHandle>.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#5)]  
  
## <a name="configuring-xpath-queries-using-the-workflow-designer"></a><span data-ttu-id="cf446-132">Konfigurowanie kwerendy XPath za pomocą projektanta przepływów pracy</span><span class="sxs-lookup"><span data-stu-id="cf446-132">Configuring XPath Queries Using the Workflow Designer</span></span>  
 <span data-ttu-id="cf446-133">W poprzednich przykładach działania i zapytania XPath używane w zapytaniach wiadomości zostały określone w kodzie.</span><span class="sxs-lookup"><span data-stu-id="cf446-133">In the previous examples, the activities and the XPath queries used in the message queries were specified in code.</span></span> <span data-ttu-id="cf446-134">Projektant przepływu pracy w [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] również umożliwia generowanie wyrażenia XPath z `DataContract` typów dla korelacji na podstawie zawartości.</span><span class="sxs-lookup"><span data-stu-id="cf446-134">The workflow designer in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] also provides the ability to generate XPaths from `DataContract` types for content-based correlation.</span></span> <span data-ttu-id="cf446-135">Pierwsze wyrażenie XPath skonfigurowana w poprzednim przykładzie został skonfigurowany pod kątem <xref:System.ServiceModel.Activities.SendReply>.</span><span class="sxs-lookup"><span data-stu-id="cf446-135">The first XPath configured in the previous example was configured for the <xref:System.ServiceModel.Activities.SendReply>.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#2)]  
  
 <span data-ttu-id="cf446-136">Aby skonfigurować wyrażenie XPath dla działania obsługi wiadomości w Projektancie przepływów pracy, wybierz działanie w Projektancie przepływów pracy.</span><span class="sxs-lookup"><span data-stu-id="cf446-136">To configure the XPath for a messaging activity in the workflow designer, select the activity in the workflow designer.</span></span> <span data-ttu-id="cf446-137">Jeśli działanie inicjuje korelację, co w poprzednim przykładzie, kliknij przycisk wielokropka **CorrelationInitializers** właściwości w **właściwości** okna.</span><span class="sxs-lookup"><span data-stu-id="cf446-137">If the activity is initializing the correlation, as in the previous example, click the ellipsis button for the **CorrelationInitializers** property in the **Properties** window.</span></span> <span data-ttu-id="cf446-138">Spowoduje to wyświetlenie **dodać inicjatorów korelacji** okno dialogowe.</span><span class="sxs-lookup"><span data-stu-id="cf446-138">This displays the **Add Correlation Initializers** dialog window.</span></span> <span data-ttu-id="cf446-139">W tym oknie dialogowym można określić typ korelacji i wybrać zawartość, która jest używana do korelacji.</span><span class="sxs-lookup"><span data-stu-id="cf446-139">From this dialog you can specify the correlation type and select the content that is used for the correlation.</span></span> <span data-ttu-id="cf446-140"><xref:System.ServiceModel.Activities.CorrelationHandle> Zmienna jest określona w **dodać inicjatora** wybrania pola oraz typ korelacji i dane używane na potrzeby korelacji z **kwerendy XPath** części okna dialogowego.</span><span class="sxs-lookup"><span data-stu-id="cf446-140">The <xref:System.ServiceModel.Activities.CorrelationHandle> variable is specified in the **Add initializer** box, and the correlation type and data used for the correlation is selected from the **XPath Queries** section of the dialog box.</span></span>  
  
 <span data-ttu-id="cf446-141">![Okno dialogowe CorrelationInitializer](../../../../docs/framework/wcf/feature-details/media/correlationinitializerdlg.jpg "CorrelationInitializerDlg")</span><span class="sxs-lookup"><span data-stu-id="cf446-141">![CorrelationInitializer Dialog](../../../../docs/framework/wcf/feature-details/media/correlationinitializerdlg.jpg "CorrelationInitializerDlg")</span></span>  
  
 <span data-ttu-id="cf446-142">Drugiego zapytania XPath w poprzednim przykładzie został skonfigurowany w <xref:System.ServiceModel.Activities.Receive> działania.</span><span class="sxs-lookup"><span data-stu-id="cf446-142">The second XPath query in the previous example was configured in the <xref:System.ServiceModel.Activities.Receive> activity.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#3)]  
  
 <span data-ttu-id="cf446-143">Aby skonfigurować Kwerenda XPath dla działania obsługi komunikatów, które nie inicjuje korelację, wybierz działanie w Projektancie przepływów pracy, a następnie kliknij przycisk wielokropka, dla **CorrelatesOn** właściwości w  **Właściwości** okna.</span><span class="sxs-lookup"><span data-stu-id="cf446-143">To configure the XPath query for a messaging activity that does not initialize the correlation, select the activity in the workflow designer and then click the ellipsis button for the **CorrelatesOn** property in the **Properties** window.</span></span> <span data-ttu-id="cf446-144">Spowoduje to wyświetlenie **definicji CorrelatesOn** okno dialogowe.</span><span class="sxs-lookup"><span data-stu-id="cf446-144">This displays the **CorrelatesOn Definition** dialog window.</span></span>  
  
 <span data-ttu-id="cf446-145">![Definicja CorrelatesOn](../../../../docs/framework/wcf/feature-details/media/correlatesondialog.jpg "CorrelatesOnDialog")</span><span class="sxs-lookup"><span data-stu-id="cf446-145">![CorrelatesOn Definition](../../../../docs/framework/wcf/feature-details/media/correlatesondialog.jpg "CorrelatesOnDialog")</span></span>  
  
 <span data-ttu-id="cf446-146">W tym oknie dialogowym Określ <xref:System.ServiceModel.Activities.CorrelationHandle> i wybierz elementy w **kwerendy XPath** listy w celu skonstruowania zapytania XPath.</span><span class="sxs-lookup"><span data-stu-id="cf446-146">From this dialog you specify the <xref:System.ServiceModel.Activities.CorrelationHandle> and choose items in the **XPath Queries** list to build the XPath query.</span></span>
