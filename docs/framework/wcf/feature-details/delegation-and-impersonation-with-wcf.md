---
title: Delegowanie i personifikacja za pomocą programu WCF
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- impersonation [WCF]
- delegation [WCF]
ms.assetid: 110e60f7-5b03-4b69-b667-31721b8e3152
ms.openlocfilehash: e491925fdbe8d44df8e0c64b563eb92569453e35
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 06/09/2020
ms.locfileid: "84599259"
---
# <a name="delegation-and-impersonation-with-wcf"></a><span data-ttu-id="92b7f-102">Delegowanie i personifikacja za pomocą programu WCF</span><span class="sxs-lookup"><span data-stu-id="92b7f-102">Delegation and Impersonation with WCF</span></span>
<span data-ttu-id="92b7f-103">*Personifikacja* jest powszechną techniką używaną przez usługi do ograniczania dostępu klientów do zasobów domeny usługi.</span><span class="sxs-lookup"><span data-stu-id="92b7f-103">*Impersonation* is a common technique that services use to restrict client access to a service domain's resources.</span></span> <span data-ttu-id="92b7f-104">Zasoby domeny usługi mogą być zasobami maszynowymi, takimi jak pliki lokalne (personifikacja) lub zasobami na innej maszynie, takimi jak udział plików (delegowanie).</span><span class="sxs-lookup"><span data-stu-id="92b7f-104">Service domain resources can either be machine resources, such as local files (impersonation), or a resource on another machine, such as a file share (delegation).</span></span> <span data-ttu-id="92b7f-105">Aby uzyskać przykładową aplikację, zobacz [Personifikowanie klienta](../samples/impersonating-the-client.md).</span><span class="sxs-lookup"><span data-stu-id="92b7f-105">For a sample application, see [Impersonating the Client](../samples/impersonating-the-client.md).</span></span> <span data-ttu-id="92b7f-106">Przykład korzystania z personifikacji można znaleźć [w temacie How to: Personifikuj klienta w usłudze](../how-to-impersonate-a-client-on-a-service.md).</span><span class="sxs-lookup"><span data-stu-id="92b7f-106">For an example of how to use impersonation, see [How to: Impersonate a Client on a Service](../how-to-impersonate-a-client-on-a-service.md).</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="92b7f-107">Należy pamiętać, że podczas personifikowania klienta w usłudze Usługa jest uruchamiana przy użyciu poświadczeń klienta, które mogą mieć wyższy poziom uprawnień niż proces serwera.</span><span class="sxs-lookup"><span data-stu-id="92b7f-107">Be aware that when impersonating a client on a service, the service runs with the client's credentials, which may have higher privileges than the server process.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="92b7f-108">Omówienie</span><span class="sxs-lookup"><span data-stu-id="92b7f-108">Overview</span></span>  
 <span data-ttu-id="92b7f-109">Zazwyczaj klienci wywołują usługę, aby usługa mogła wykonać pewne działania w imieniu klienta.</span><span class="sxs-lookup"><span data-stu-id="92b7f-109">Typically, clients call a service to have the service perform some action on the client’s behalf.</span></span> <span data-ttu-id="92b7f-110">Personifikacja pozwala usłudze działać jako klient podczas wykonywania akcji.</span><span class="sxs-lookup"><span data-stu-id="92b7f-110">Impersonation allows the service to act as the client while performing the action.</span></span> <span data-ttu-id="92b7f-111">Delegowanie umożliwia usłudze frontonu przekazanie żądania klienta do usługi zaplecza w taki sposób, że usługa zaplecza może również personifikować klienta.</span><span class="sxs-lookup"><span data-stu-id="92b7f-111">Delegation allows a front-end service to forward the client’s request to a back-end service in such a way that the back-end service can also impersonate the client.</span></span> <span data-ttu-id="92b7f-112">Personifikacja jest najczęściej używana jako sposób sprawdzania, czy klient ma autoryzację do wykonania określonej akcji, podczas gdy Delegowanie jest sposobem przepływania możliwości personifikacji wraz z tożsamością klienta do usługi zaplecza.</span><span class="sxs-lookup"><span data-stu-id="92b7f-112">Impersonation is most commonly used as a way of checking whether a client is authorized to perform a particular action, while delegation is a way of flowing impersonation capabilities, along with the client’s identity, to a back-end service.</span></span> <span data-ttu-id="92b7f-113">Delegowanie to funkcja domeny systemu Windows, która może być używana podczas uwierzytelniania opartego na protokole Kerberos.</span><span class="sxs-lookup"><span data-stu-id="92b7f-113">Delegation is a Windows domain feature that can be used when Kerberos-based authentication is performed.</span></span> <span data-ttu-id="92b7f-114">Delegowanie różni się od przepływu tożsamości i, ponieważ delegowanie przenosi możliwość personifikacji klienta bez posiadania hasła klienta, jest to znacznie wyższa uprzywilejowana operacja niż przepływ tożsamości.</span><span class="sxs-lookup"><span data-stu-id="92b7f-114">Delegation is distinct from identity flow and, because delegation transfers the ability to impersonate the client without possession of the client’s password, it is a much higher privileged operation than identity flow.</span></span>  
  
 <span data-ttu-id="92b7f-115">Zarówno personifikacja, jak i delegowanie wymagają, aby klient miał tożsamość systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="92b7f-115">Both impersonation and delegation require that the client have a Windows identity.</span></span> <span data-ttu-id="92b7f-116">Jeśli klient nie ma tożsamości systemu Windows, jedyną dostępną opcją jest przepływanie tożsamości klienta do drugiej usługi.</span><span class="sxs-lookup"><span data-stu-id="92b7f-116">If a client does not possess a Windows identity, then the only option available is to flow the client’s identity to the second service.</span></span>  
  
## <a name="impersonation-basics"></a><span data-ttu-id="92b7f-117">Podstawy personifikacji</span><span class="sxs-lookup"><span data-stu-id="92b7f-117">Impersonation Basics</span></span>  
 <span data-ttu-id="92b7f-118">Windows Communication Foundation (WCF) obsługuje personifikację różnych poświadczeń klienta.</span><span class="sxs-lookup"><span data-stu-id="92b7f-118">Windows Communication Foundation (WCF) supports impersonation for a variety of client credentials.</span></span> <span data-ttu-id="92b7f-119">W tym temacie opisano obsługę modelu usług na potrzeby personifikacji obiektu wywołującego podczas implementacji metody usługi.</span><span class="sxs-lookup"><span data-stu-id="92b7f-119">This topic describes service model support for impersonating the caller during the implementation of a service method.</span></span> <span data-ttu-id="92b7f-120">Omówione są również typowe scenariusze wdrażania dotyczące personifikacji i zabezpieczeń protokołu SOAP oraz opcji WCF w tych scenariuszach.</span><span class="sxs-lookup"><span data-stu-id="92b7f-120">Also discussed are common deployment scenarios involving impersonation and SOAP security and WCF options in these scenarios.</span></span>  
  
 <span data-ttu-id="92b7f-121">Ten temat koncentruje się na personifikacji i delegowaniu w programie WCF w przypadku korzystania z zabezpieczeń protokołu SOAP.</span><span class="sxs-lookup"><span data-stu-id="92b7f-121">This topic focuses on impersonation and delegation in WCF when using SOAP security.</span></span> <span data-ttu-id="92b7f-122">W przypadku korzystania z zabezpieczeń transportu można także użyć personifikacji i delegowania w ramach usługi WCF, jak opisano w temacie [Używanie personifikacji z zabezpieczeniami transportu](using-impersonation-with-transport-security.md).</span><span class="sxs-lookup"><span data-stu-id="92b7f-122">You can also use impersonation and delegation with WCF when using transport security, as described in [Using Impersonation with Transport Security](using-impersonation-with-transport-security.md).</span></span>  
  
## <a name="two-methods"></a><span data-ttu-id="92b7f-123">Dwie metody</span><span class="sxs-lookup"><span data-stu-id="92b7f-123">Two Methods</span></span>  
 <span data-ttu-id="92b7f-124">Zabezpieczenia SOAP WCF mają dwie odrębne metody wykonywania personifikacji.</span><span class="sxs-lookup"><span data-stu-id="92b7f-124">WCF SOAP security has two distinct methods for performing impersonation.</span></span> <span data-ttu-id="92b7f-125">Używana metoda zależy od powiązania.</span><span class="sxs-lookup"><span data-stu-id="92b7f-125">The method used depends on the binding.</span></span> <span data-ttu-id="92b7f-126">Jeden z nich jest personifikacją od tokenu systemu Windows uzyskanego z interfejsu dostawcy obsługi zabezpieczeń (SSPI) lub uwierzytelniania Kerberos, który jest następnie buforowany w usłudze.</span><span class="sxs-lookup"><span data-stu-id="92b7f-126">One is impersonation from a Windows token obtained from the Security Support Provider Interface (SSPI) or Kerberos authentication, which is then cached on the service.</span></span> <span data-ttu-id="92b7f-127">Druga jest personifikacją od tokenu systemu Windows uzyskanego z rozszerzeń protokołu Kerberos, zbiorczo o nazwie *Service-for-User* (S4U).</span><span class="sxs-lookup"><span data-stu-id="92b7f-127">The second is impersonation from a Windows token obtained from the Kerberos extensions, collectively called *Service-for-User* (S4U).</span></span>  
  
### <a name="cached-token-impersonation"></a><span data-ttu-id="92b7f-128">Personifikacja tokenu w pamięci podręcznej</span><span class="sxs-lookup"><span data-stu-id="92b7f-128">Cached Token Impersonation</span></span>  
 <span data-ttu-id="92b7f-129">Można przeprowadzić personifikację w pamięci podręcznej przy użyciu następujących czynności:</span><span class="sxs-lookup"><span data-stu-id="92b7f-129">You can perform cached-token impersonation with the following:</span></span>  
  
- <span data-ttu-id="92b7f-130"><xref:System.ServiceModel.WSHttpBinding>, <xref:System.ServiceModel.WSDualHttpBinding> i <xref:System.ServiceModel.NetTcpBinding> z poświadczeniem klienta systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="92b7f-130"><xref:System.ServiceModel.WSHttpBinding>, <xref:System.ServiceModel.WSDualHttpBinding>, and <xref:System.ServiceModel.NetTcpBinding> with a Windows client credential.</span></span>  
  
- <span data-ttu-id="92b7f-131"><xref:System.ServiceModel.BasicHttpBinding>z <xref:System.ServiceModel.BasicHttpSecurityMode> zestawem <xref:System.ServiceModel.BasicHttpSecurityMode.TransportWithMessageCredential> poświadczeń lub innym powiązaniem standardowym, w którym klient przedstawia poświadczenia nazwy użytkownika, które usługa może zamapować na prawidłowe konto systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="92b7f-131"><xref:System.ServiceModel.BasicHttpBinding> with a <xref:System.ServiceModel.BasicHttpSecurityMode> set to the <xref:System.ServiceModel.BasicHttpSecurityMode.TransportWithMessageCredential> credential, or any other standard binding where the client presents a user name credential that the service can map to a valid Windows account.</span></span>  
  
- <span data-ttu-id="92b7f-132">Wszystkie <xref:System.ServiceModel.Channels.CustomBinding> , które używają poświadczeń klienta systemu Windows z `requireCancellation` ustawionym na `true` .</span><span class="sxs-lookup"><span data-stu-id="92b7f-132">Any <xref:System.ServiceModel.Channels.CustomBinding> that uses a Windows client credential with the `requireCancellation` set to `true`.</span></span> <span data-ttu-id="92b7f-133">(Właściwość jest dostępna dla następujących klas: <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters> , <xref:System.ServiceModel.Security.Tokens.SslSecurityTokenParameters> , i <xref:System.ServiceModel.Security.Tokens.SspiSecurityTokenParameters> .) Jeśli w powiązaniu jest używana bezpieczna Konwersacja, musi ona również mieć `requireCancellation` ustawioną właściwość `true` .</span><span class="sxs-lookup"><span data-stu-id="92b7f-133">(The property is available on the following classes: <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters>, <xref:System.ServiceModel.Security.Tokens.SslSecurityTokenParameters>, and <xref:System.ServiceModel.Security.Tokens.SspiSecurityTokenParameters>.) If a secure conversation is used on the binding, it must also have the `requireCancellation` property set to `true`.</span></span>  
  
- <span data-ttu-id="92b7f-134">Dowolna <xref:System.ServiceModel.Channels.CustomBinding> Lokalizacja, w której klient przedstawia poświadczenie nazwy użytkownika.</span><span class="sxs-lookup"><span data-stu-id="92b7f-134">Any <xref:System.ServiceModel.Channels.CustomBinding> where the client presents a user name credential.</span></span> <span data-ttu-id="92b7f-135">Jeśli w powiązaniu jest używana bezpieczna Konwersacja, musi ona również mieć `requireCancellation` ustawioną właściwość `true` .</span><span class="sxs-lookup"><span data-stu-id="92b7f-135">If secure conversation is used on the binding, it must also have the `requireCancellation` property set to `true`.</span></span>  
  
### <a name="s4u-based-impersonation"></a><span data-ttu-id="92b7f-136">Personifikacja oparta na protokole S4U</span><span class="sxs-lookup"><span data-stu-id="92b7f-136">S4U-Based Impersonation</span></span>  
 <span data-ttu-id="92b7f-137">Personifikację opartą na protokole S4U można wykonać przy użyciu następujących czynności:</span><span class="sxs-lookup"><span data-stu-id="92b7f-137">You can perform S4U-based impersonation with the following:</span></span>  
  
- <span data-ttu-id="92b7f-138"><xref:System.ServiceModel.WSHttpBinding>, <xref:System.ServiceModel.WSDualHttpBinding> i <xref:System.ServiceModel.NetTcpBinding> z poświadczenia klienta certyfikatu, które usługa może zamapować na prawidłowe konto systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="92b7f-138"><xref:System.ServiceModel.WSHttpBinding>, <xref:System.ServiceModel.WSDualHttpBinding>, and <xref:System.ServiceModel.NetTcpBinding> with a certificate client credential that the service can map to a valid Windows account.</span></span>  
  
- <span data-ttu-id="92b7f-139">Wszystkie <xref:System.ServiceModel.Channels.CustomBinding> , które używają poświadczeń klienta systemu Windows z `requireCancellation` właściwością ustawioną na `false` .</span><span class="sxs-lookup"><span data-stu-id="92b7f-139">Any <xref:System.ServiceModel.Channels.CustomBinding> that uses a Windows client credential with the `requireCancellation` property set to `false`.</span></span>  
  
- <span data-ttu-id="92b7f-140">Każdy <xref:System.ServiceModel.Channels.CustomBinding> , który używa nazwy użytkownika lub poświadczeń klienta systemu Windows i bezpiecznej konwersacji z `requireCancellation` właściwością ustawioną na `false` .</span><span class="sxs-lookup"><span data-stu-id="92b7f-140">Any <xref:System.ServiceModel.Channels.CustomBinding> that uses a user name or Windows client credential and secure conversation with the `requireCancellation` property set to `false`.</span></span>  
  
 <span data-ttu-id="92b7f-141">Zakres, w jakim usługa może personifikować klienta, zależy od uprawnień, które są przechowywane w ramach konta usługi podczas próby personifikacji, rodzaju użytego personifikacji, a także zakresu personifikacji, który klient zezwala.</span><span class="sxs-lookup"><span data-stu-id="92b7f-141">The extent to which the service can impersonate the client depends on the privileges the service account holds when it attempts impersonation, the type of impersonation used, and possibly the extent of impersonation the client permits.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="92b7f-142">Gdy klient i usługa są uruchomione na tym samym komputerze, a klient jest uruchomiony na koncie systemowym (na przykład `Local System` lub `Network Service` ), nie można spersonifikować klienta w przypadku ustanowienia bezpiecznej sesji z tokenami kontekstu zabezpieczeń stanowych.</span><span class="sxs-lookup"><span data-stu-id="92b7f-142">When the client and service are running on the same computer and the client is running under a system account (for example, `Local System` or `Network Service`), the client cannot be impersonated when a secure session is established with stateful Security Context tokens.</span></span> <span data-ttu-id="92b7f-143">Aplikacja konsoli lub formularza systemu Windows jest zwykle uruchamiana w ramach aktualnie zalogowanego konta, dzięki czemu konto może być domyślnie personifikowane.</span><span class="sxs-lookup"><span data-stu-id="92b7f-143">A Windows Form or console application typically runs under the currently logged-in account, so that account can be impersonated by default.</span></span> <span data-ttu-id="92b7f-144">Jeśli jednak klient jest stroną ASP.NET, a ta strona jest hostowana w usługach IIS 6,0 lub IIS 7,0, klient domyślnie uruchamia się w ramach `Network Service` konta.</span><span class="sxs-lookup"><span data-stu-id="92b7f-144">However, when the client is an ASP.NET page and that page is hosted in IIS 6.0 or IIS 7.0, then the client does run under the `Network Service` account by default.</span></span> <span data-ttu-id="92b7f-145">Wszystkie powiązania dostarczone przez system obsługujące bezpieczne sesje domyślnie korzystają z tokenu bezstanowego kontekstu zabezpieczeń (SCT).</span><span class="sxs-lookup"><span data-stu-id="92b7f-145">All of the system-provided bindings that support secure sessions use a stateless security context token (SCT) by default.</span></span> <span data-ttu-id="92b7f-146">Jeśli jednak klient jest stroną ASP.NET i są używane bezpieczne sesje ze stanem SCTs, nie można spersonifikować klienta.</span><span class="sxs-lookup"><span data-stu-id="92b7f-146">However, if the client is an ASP.NET page, and secure sessions with stateful SCTs are used, the client cannot be impersonated.</span></span> <span data-ttu-id="92b7f-147">Aby uzyskać więcej informacji o używaniu stanowych SCTs w bezpiecznej sesji, zobacz [How to: Create a Security Context token for a Secure Session](how-to-create-a-security-context-token-for-a-secure-session.md).</span><span class="sxs-lookup"><span data-stu-id="92b7f-147">For more information about using stateful SCTs in a secure session, see [How to: Create a Security Context Token for a Secure Session](how-to-create-a-security-context-token-for-a-secure-session.md).</span></span>  
  
## <a name="impersonation-in-a-service-method-declarative-model"></a><span data-ttu-id="92b7f-148">Personifikacja w metodzie usługi: model deklaratywny</span><span class="sxs-lookup"><span data-stu-id="92b7f-148">Impersonation in a Service Method: Declarative Model</span></span>  
 <span data-ttu-id="92b7f-149">Większość scenariuszy personifikacji obejmuje wykonywanie metody usługi w kontekście obiektu wywołującego.</span><span class="sxs-lookup"><span data-stu-id="92b7f-149">Most impersonation scenarios involve executing the service method in the caller context.</span></span> <span data-ttu-id="92b7f-150">Funkcja WCF zapewnia funkcję personifikacji, która ułatwia wykonywanie tych czynności przez umożliwienie użytkownikowi określenia wymaganego personifikacji w <xref:System.ServiceModel.OperationBehaviorAttribute> atrybucie.</span><span class="sxs-lookup"><span data-stu-id="92b7f-150">WCF provides an impersonation feature that makes this easy to do by allowing the user to specify the impersonation requirement in the <xref:System.ServiceModel.OperationBehaviorAttribute> attribute.</span></span> <span data-ttu-id="92b7f-151">Na przykład w poniższym kodzie Infrastruktura WCF personifikuje obiekt wywołujący przed wykonaniem `Hello` metody.</span><span class="sxs-lookup"><span data-stu-id="92b7f-151">For example, in the following code, the WCF infrastructure impersonates the caller before executing the `Hello` method.</span></span> <span data-ttu-id="92b7f-152">Wszelkie próby uzyskania dostępu do natywnych zasobów wewnątrz `Hello` metody powiodło się tylko wtedy, gdy lista kontroli dostępu (ACL) zasobu zezwala na uprawnienia dostępu do obiektu wywołującego.</span><span class="sxs-lookup"><span data-stu-id="92b7f-152">Any attempt to access native resources inside the `Hello` method succeed only if the access control list (ACL) of the resource allows the caller access privileges.</span></span> <span data-ttu-id="92b7f-153">Aby włączyć personifikację, ustaw <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> Właściwość na jedną z <xref:System.ServiceModel.ImpersonationOption> wartości wyliczenia <xref:System.ServiceModel.ImpersonationOption.Required?displayProperty=nameWithType> lub <xref:System.ServiceModel.ImpersonationOption.Allowed?displayProperty=nameWithType> , jak pokazano w poniższym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="92b7f-153">To enable impersonation, set the <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property to one of the <xref:System.ServiceModel.ImpersonationOption> enumeration values, either <xref:System.ServiceModel.ImpersonationOption.Required?displayProperty=nameWithType> or <xref:System.ServiceModel.ImpersonationOption.Allowed?displayProperty=nameWithType>, as shown in the following example.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="92b7f-154">Jeśli usługa ma wyższe poświadczenia niż Klient zdalny, poświadczenia usługi są używane, jeśli <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> Właściwość jest ustawiona na <xref:System.ServiceModel.ImpersonationOption.Allowed> .</span><span class="sxs-lookup"><span data-stu-id="92b7f-154">When a service has higher credentials than the remote client, the credentials of the service are used if the <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property is set to <xref:System.ServiceModel.ImpersonationOption.Allowed>.</span></span> <span data-ttu-id="92b7f-155">Oznacza to, że jeśli użytkownik z niskim poziomem uprawnień poda swoje poświadczenia, usługa wyższego uprzywilejowania wykonuje metodę z poświadczeniami usługi i może korzystać z zasobów, które nie będą mogły być używane przez użytkownika z niskim poziomem uprawnień.</span><span class="sxs-lookup"><span data-stu-id="92b7f-155">That is, if a low-privileged user provides its credentials, a higher-privileged service executes the method with the credentials of the service, and can use resources that the low-privileged user would otherwise not be able to use.</span></span>  
  
 [!code-csharp[c_ImpersonationAndDelegation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_impersonationanddelegation/cs/source.cs#1)]
 [!code-vb[c_ImpersonationAndDelegation#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_impersonationanddelegation/vb/source.vb#1)]  
  
 <span data-ttu-id="92b7f-156">Infrastruktura WCF może personifikować wywołującego tylko wtedy, gdy obiekt wywołujący jest uwierzytelniany przy użyciu poświadczeń, które mogą być mapowane na konto użytkownika systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="92b7f-156">The WCF infrastructure can impersonate the caller only if the caller is authenticated with credentials that can be mapped to a Windows user account.</span></span> <span data-ttu-id="92b7f-157">Jeśli usługa jest skonfigurowana do uwierzytelniania przy użyciu poświadczeń, których nie można zamapować na konto systemu Windows, metoda usługi nie jest wykonywana.</span><span class="sxs-lookup"><span data-stu-id="92b7f-157">If the service is configured to authenticate using a credential that cannot be mapped to a Windows account, the service method is not executed.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="92b7f-158">W systemie Windows XP personifikacja kończy się niepowodzeniem, jeśli zostanie utworzony stanowy SCT, co spowoduje wystąpienie <xref:System.InvalidOperationException> .</span><span class="sxs-lookup"><span data-stu-id="92b7f-158">On Windows XP, impersonation fails if a stateful SCT is created, resulting in an <xref:System.InvalidOperationException>.</span></span> <span data-ttu-id="92b7f-159">Aby uzyskać więcej informacji, zobacz [scenariusze nieobsługiwane](unsupported-scenarios.md).</span><span class="sxs-lookup"><span data-stu-id="92b7f-159">For more information, see [Unsupported Scenarios](unsupported-scenarios.md).</span></span>  
  
## <a name="impersonation-in-a-service-method-imperative-model"></a><span data-ttu-id="92b7f-160">Personifikacja w metodzie usługi: model bezwzględny</span><span class="sxs-lookup"><span data-stu-id="92b7f-160">Impersonation in a Service Method: Imperative Model</span></span>  
 <span data-ttu-id="92b7f-161">Czasami obiekt wywołujący nie musi personifikować całej metody usługi, aby działała, ale tylko dla jego części.</span><span class="sxs-lookup"><span data-stu-id="92b7f-161">Sometimes a caller does not need to impersonate the entire service method to function, but for only a portion of it.</span></span> <span data-ttu-id="92b7f-162">W takim przypadku należy uzyskać tożsamość systemu Windows wywołującego w metodzie usługi i bezwzględnie przeprowadzić personifikację.</span><span class="sxs-lookup"><span data-stu-id="92b7f-162">In this case, obtain the Windows identity of the caller inside the service method and imperatively perform the impersonation.</span></span> <span data-ttu-id="92b7f-163">W tym celu należy użyć <xref:System.ServiceModel.ServiceSecurityContext.WindowsIdentity%2A> właściwości, <xref:System.ServiceModel.ServiceSecurityContext> Aby zwrócić wystąpienie <xref:System.Security.Principal.WindowsIdentity> klasy i wywołać <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> metodę przed użyciem wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="92b7f-163">Do this by using the <xref:System.ServiceModel.ServiceSecurityContext.WindowsIdentity%2A> property of the <xref:System.ServiceModel.ServiceSecurityContext> to return an instance of the <xref:System.Security.Principal.WindowsIdentity> class and calling the <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> method before using the instance.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="92b7f-164">Należy pamiętać, aby użyć `Using` instrukcji Visual Basic lub instrukcji języka C# `using` do automatycznego przywrócenia akcji personifikacji.</span><span class="sxs-lookup"><span data-stu-id="92b7f-164">Be sure to use the Visual Basic`Using` statement or the C# `using` statement to automatically revert the impersonation action.</span></span> <span data-ttu-id="92b7f-165">Jeśli nie używasz instrukcji lub jeśli używasz języka programowania innego niż Visual Basic lub C#, pamiętaj o odwróceniu poziomu personifikacji.</span><span class="sxs-lookup"><span data-stu-id="92b7f-165">If you do not use the statement, or if you use a programming language other than Visual Basic or C#, be sure to revert the impersonation level.</span></span> <span data-ttu-id="92b7f-166">Niewykonanie tej czynności może stanowić podstawę ataku typu "odmowa usługi" i podniesienia poziomu uprawnień.</span><span class="sxs-lookup"><span data-stu-id="92b7f-166">Failure to do this can form the basis for denial of service and elevation of privilege attacks.</span></span>  
  
 [!code-csharp[c_ImpersonationAndDelegation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_impersonationanddelegation/cs/source.cs#2)]
 [!code-vb[c_ImpersonationAndDelegation#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_impersonationanddelegation/vb/source.vb#2)]  
  
## <a name="impersonation-for-all-service-methods"></a><span data-ttu-id="92b7f-167">Personifikacja dla wszystkich metod usługi</span><span class="sxs-lookup"><span data-stu-id="92b7f-167">Impersonation for All Service Methods</span></span>  
 <span data-ttu-id="92b7f-168">W niektórych przypadkach należy wykonać wszystkie metody usługi w kontekście obiektu wywołującego.</span><span class="sxs-lookup"><span data-stu-id="92b7f-168">In some cases, you must perform all the methods of a service in the caller’s context.</span></span> <span data-ttu-id="92b7f-169">Zamiast jawnie włączyć tę funkcję dla poszczególnych metod, użyj <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior> .</span><span class="sxs-lookup"><span data-stu-id="92b7f-169">Instead of explicitly enabling this feature on a per-method basis, use the <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior>.</span></span> <span data-ttu-id="92b7f-170">Jak pokazano w poniższym kodzie, ustaw <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.ImpersonateCallerForAllOperations%2A> Właściwość na `true` .</span><span class="sxs-lookup"><span data-stu-id="92b7f-170">As shown in the following code, set the <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.ImpersonateCallerForAllOperations%2A> property to `true`.</span></span> <span data-ttu-id="92b7f-171"><xref:System.ServiceModel.Description.ServiceAuthorizationBehavior>Jest pobierany z kolekcji zachowań <xref:System.ServiceModel.ServiceHost> klasy.</span><span class="sxs-lookup"><span data-stu-id="92b7f-171">The <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior> is retrieved from the collections of behaviors of the <xref:System.ServiceModel.ServiceHost> class.</span></span> <span data-ttu-id="92b7f-172">Należy również zauważyć, że `Impersonation` Właściwość <xref:System.ServiceModel.OperationBehaviorAttribute> zastosowana do każdej metody musi również mieć ustawioną wartość <xref:System.ServiceModel.ImpersonationOption.Allowed> lub <xref:System.ServiceModel.ImpersonationOption.Required> .</span><span class="sxs-lookup"><span data-stu-id="92b7f-172">Also note that the `Impersonation` property of the <xref:System.ServiceModel.OperationBehaviorAttribute> applied to each method must also be set to either <xref:System.ServiceModel.ImpersonationOption.Allowed> or <xref:System.ServiceModel.ImpersonationOption.Required>.</span></span>  
  
 [!code-csharp[c_ImpersonationAndDelegation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_impersonationanddelegation/cs/source.cs#3)]
 [!code-vb[c_ImpersonationAndDelegation#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_impersonationanddelegation/vb/source.vb#3)]  
  
 <span data-ttu-id="92b7f-173">W poniższej tabeli opisano zachowanie WCF dla wszystkich możliwych kombinacji `ImpersonationOption` i `ImpersonateCallerForAllServiceOperations` .</span><span class="sxs-lookup"><span data-stu-id="92b7f-173">The following table describes WCF behavior for all possible combinations of `ImpersonationOption` and `ImpersonateCallerForAllServiceOperations`.</span></span>  
  
|`ImpersonationOption`|`ImpersonateCallerForAllServiceOperations`|<span data-ttu-id="92b7f-174">Zachowanie</span><span class="sxs-lookup"><span data-stu-id="92b7f-174">Behavior</span></span>|  
|---------------------------|------------------------------------------------|--------------|  
|<span data-ttu-id="92b7f-175">Wymagane</span><span class="sxs-lookup"><span data-stu-id="92b7f-175">Required</span></span>|<span data-ttu-id="92b7f-176">nie dotyczy</span><span class="sxs-lookup"><span data-stu-id="92b7f-176">n/a</span></span>|<span data-ttu-id="92b7f-177">Funkcja WCF personifikuje wywołującego</span><span class="sxs-lookup"><span data-stu-id="92b7f-177">WCF impersonates the caller</span></span>|  
|<span data-ttu-id="92b7f-178">Dozwolone</span><span class="sxs-lookup"><span data-stu-id="92b7f-178">Allowed</span></span>|<span data-ttu-id="92b7f-179">fałsz</span><span class="sxs-lookup"><span data-stu-id="92b7f-179">false</span></span>|<span data-ttu-id="92b7f-180">Funkcja WCF nie personifikuje wywołującego</span><span class="sxs-lookup"><span data-stu-id="92b7f-180">WCF does not impersonate the caller</span></span>|  
|<span data-ttu-id="92b7f-181">Dozwolone</span><span class="sxs-lookup"><span data-stu-id="92b7f-181">Allowed</span></span>|<span data-ttu-id="92b7f-182">true</span><span class="sxs-lookup"><span data-stu-id="92b7f-182">true</span></span>|<span data-ttu-id="92b7f-183">Funkcja WCF personifikuje wywołującego</span><span class="sxs-lookup"><span data-stu-id="92b7f-183">WCF impersonates the caller</span></span>|  
|<span data-ttu-id="92b7f-184">NotAllowed</span><span class="sxs-lookup"><span data-stu-id="92b7f-184">NotAllowed</span></span>|<span data-ttu-id="92b7f-185">fałsz</span><span class="sxs-lookup"><span data-stu-id="92b7f-185">false</span></span>|<span data-ttu-id="92b7f-186">Funkcja WCF nie personifikuje wywołującego</span><span class="sxs-lookup"><span data-stu-id="92b7f-186">WCF does not impersonate the caller</span></span>|  
|<span data-ttu-id="92b7f-187">NotAllowed</span><span class="sxs-lookup"><span data-stu-id="92b7f-187">NotAllowed</span></span>|<span data-ttu-id="92b7f-188">true</span><span class="sxs-lookup"><span data-stu-id="92b7f-188">true</span></span>|<span data-ttu-id="92b7f-189">Niedozwolone.</span><span class="sxs-lookup"><span data-stu-id="92b7f-189">Disallowed.</span></span> <span data-ttu-id="92b7f-190">( <xref:System.InvalidOperationException> Zgłoszono element).</span><span class="sxs-lookup"><span data-stu-id="92b7f-190">(An <xref:System.InvalidOperationException> is thrown.)</span></span>|  
  
## <a name="impersonation-level-obtained-from-windows-credentials-and-cached-token-impersonation"></a><span data-ttu-id="92b7f-191">Poziom personifikacji uzyskany z poświadczeń systemu Windows i personifikacja tokenu w pamięci podręcznej</span><span class="sxs-lookup"><span data-stu-id="92b7f-191">Impersonation Level Obtained from Windows Credentials and Cached Token Impersonation</span></span>  
 <span data-ttu-id="92b7f-192">W niektórych scenariuszach klient ma częściową kontrolę nad poziomem personifikacji wykonywanym przez usługę podczas korzystania z poświadczeń klienta systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="92b7f-192">In some scenarios the client has partial control over the level of impersonation the service performs when a Windows client credential is used.</span></span> <span data-ttu-id="92b7f-193">Jeden scenariusz występuje, gdy klient określi poziom personifikacji anonimowej.</span><span class="sxs-lookup"><span data-stu-id="92b7f-193">One scenario occurs when the client specifies an Anonymous impersonation level.</span></span> <span data-ttu-id="92b7f-194">Druga dzieje się podczas przeprowadzania personifikacji z buforowanym tokenem.</span><span class="sxs-lookup"><span data-stu-id="92b7f-194">The other occurs when performing impersonation with a cached token.</span></span> <span data-ttu-id="92b7f-195">Jest to realizowane przez ustawienie <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> właściwości <xref:System.ServiceModel.Security.WindowsClientCredential> klasy, która jest używana jako właściwość klasy generycznej <xref:System.ServiceModel.ChannelFactory%601> .</span><span class="sxs-lookup"><span data-stu-id="92b7f-195">This is done by setting the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property of the <xref:System.ServiceModel.Security.WindowsClientCredential> class, which is accessed as a property of the generic <xref:System.ServiceModel.ChannelFactory%601> class.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="92b7f-196">Określenie poziomu personifikacji anonimowe powoduje, że klient loguje się do usługi anonimowo.</span><span class="sxs-lookup"><span data-stu-id="92b7f-196">Specifying an impersonation level of Anonymous causes the client to log on to the service anonymously.</span></span> <span data-ttu-id="92b7f-197">W związku z tym usługa musi zezwalać na Logowanie anonimowe, niezależnie od tego, czy jest wykonywana personifikacja.</span><span class="sxs-lookup"><span data-stu-id="92b7f-197">The service must therefore allow anonymous logons, regardless of whether impersonation is performed.</span></span>  
  
 <span data-ttu-id="92b7f-198">Klient może określić poziom personifikacji jako <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous> , <xref:System.Security.Principal.TokenImpersonationLevel.Identification> , <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation> , lub <xref:System.Security.Principal.TokenImpersonationLevel.Delegation> .</span><span class="sxs-lookup"><span data-stu-id="92b7f-198">The client can specify the impersonation level as <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, <xref:System.Security.Principal.TokenImpersonationLevel.Identification>, <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>, or <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span> <span data-ttu-id="92b7f-199">Tworzony jest tylko token na określonym poziomie, jak pokazano w poniższym kodzie.</span><span class="sxs-lookup"><span data-stu-id="92b7f-199">Only a token at the specified level is produced, as shown in the following code.</span></span>  
  
 [!code-csharp[c_ImpersonationAndDelegation#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_impersonationanddelegation/cs/source.cs#4)]
 [!code-vb[c_ImpersonationAndDelegation#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_impersonationanddelegation/vb/source.vb#4)]  
  
 <span data-ttu-id="92b7f-200">W poniższej tabeli określono poziom personifikacji uzyskany przez usługę podczas personifikacji z buforowanego tokenu.</span><span class="sxs-lookup"><span data-stu-id="92b7f-200">The following table specifies the impersonation level the service obtains when impersonating from a cached token.</span></span>  
  
|<span data-ttu-id="92b7f-201">`AllowedImpersonationLevel`wartościami</span><span class="sxs-lookup"><span data-stu-id="92b7f-201">`AllowedImpersonationLevel` value</span></span>|<span data-ttu-id="92b7f-202">Usługa ma`SeImpersonatePrivilege`</span><span class="sxs-lookup"><span data-stu-id="92b7f-202">Service has `SeImpersonatePrivilege`</span></span>|<span data-ttu-id="92b7f-203">Usługa i klient mogą przebudować</span><span class="sxs-lookup"><span data-stu-id="92b7f-203">Service and client are capable of delegation</span></span>|<span data-ttu-id="92b7f-204">Token pamięci podręcznej`ImpersonationLevel`</span><span class="sxs-lookup"><span data-stu-id="92b7f-204">Cached token `ImpersonationLevel`</span></span>|  
|---------------------------------------|------------------------------------------|--------------------------------------------------|---------------------------------------|  
|<span data-ttu-id="92b7f-205">Anonimowe</span><span class="sxs-lookup"><span data-stu-id="92b7f-205">Anonymous</span></span>|<span data-ttu-id="92b7f-206">Tak</span><span class="sxs-lookup"><span data-stu-id="92b7f-206">Yes</span></span>|<span data-ttu-id="92b7f-207">nie dotyczy</span><span class="sxs-lookup"><span data-stu-id="92b7f-207">n/a</span></span>|<span data-ttu-id="92b7f-208">Personifikacja</span><span class="sxs-lookup"><span data-stu-id="92b7f-208">Impersonation</span></span>|  
|<span data-ttu-id="92b7f-209">Anonimowe</span><span class="sxs-lookup"><span data-stu-id="92b7f-209">Anonymous</span></span>|<span data-ttu-id="92b7f-210">Nie</span><span class="sxs-lookup"><span data-stu-id="92b7f-210">No</span></span>|<span data-ttu-id="92b7f-211">nie dotyczy</span><span class="sxs-lookup"><span data-stu-id="92b7f-211">n/a</span></span>|<span data-ttu-id="92b7f-212">Identyfikacja</span><span class="sxs-lookup"><span data-stu-id="92b7f-212">Identification</span></span>|  
|<span data-ttu-id="92b7f-213">Identyfikacja</span><span class="sxs-lookup"><span data-stu-id="92b7f-213">Identification</span></span>|<span data-ttu-id="92b7f-214">nie dotyczy</span><span class="sxs-lookup"><span data-stu-id="92b7f-214">n/a</span></span>|<span data-ttu-id="92b7f-215">nie dotyczy</span><span class="sxs-lookup"><span data-stu-id="92b7f-215">n/a</span></span>|<span data-ttu-id="92b7f-216">Identyfikacja</span><span class="sxs-lookup"><span data-stu-id="92b7f-216">Identification</span></span>|  
|<span data-ttu-id="92b7f-217">Personifikacja</span><span class="sxs-lookup"><span data-stu-id="92b7f-217">Impersonation</span></span>|<span data-ttu-id="92b7f-218">Tak</span><span class="sxs-lookup"><span data-stu-id="92b7f-218">Yes</span></span>|<span data-ttu-id="92b7f-219">nie dotyczy</span><span class="sxs-lookup"><span data-stu-id="92b7f-219">n/a</span></span>|<span data-ttu-id="92b7f-220">Personifikacja</span><span class="sxs-lookup"><span data-stu-id="92b7f-220">Impersonation</span></span>|  
|<span data-ttu-id="92b7f-221">Personifikacja</span><span class="sxs-lookup"><span data-stu-id="92b7f-221">Impersonation</span></span>|<span data-ttu-id="92b7f-222">Nie</span><span class="sxs-lookup"><span data-stu-id="92b7f-222">No</span></span>|<span data-ttu-id="92b7f-223">nie dotyczy</span><span class="sxs-lookup"><span data-stu-id="92b7f-223">n/a</span></span>|<span data-ttu-id="92b7f-224">Identyfikacja</span><span class="sxs-lookup"><span data-stu-id="92b7f-224">Identification</span></span>|  
|<span data-ttu-id="92b7f-225">Delegowanie</span><span class="sxs-lookup"><span data-stu-id="92b7f-225">Delegation</span></span>|<span data-ttu-id="92b7f-226">Tak</span><span class="sxs-lookup"><span data-stu-id="92b7f-226">Yes</span></span>|<span data-ttu-id="92b7f-227">Tak</span><span class="sxs-lookup"><span data-stu-id="92b7f-227">Yes</span></span>|<span data-ttu-id="92b7f-228">Delegowanie</span><span class="sxs-lookup"><span data-stu-id="92b7f-228">Delegation</span></span>|  
|<span data-ttu-id="92b7f-229">Delegowanie</span><span class="sxs-lookup"><span data-stu-id="92b7f-229">Delegation</span></span>|<span data-ttu-id="92b7f-230">Yes</span><span class="sxs-lookup"><span data-stu-id="92b7f-230">Yes</span></span>|<span data-ttu-id="92b7f-231">Nie</span><span class="sxs-lookup"><span data-stu-id="92b7f-231">No</span></span>|<span data-ttu-id="92b7f-232">Personifikacja</span><span class="sxs-lookup"><span data-stu-id="92b7f-232">Impersonation</span></span>|  
|<span data-ttu-id="92b7f-233">Delegowanie</span><span class="sxs-lookup"><span data-stu-id="92b7f-233">Delegation</span></span>|<span data-ttu-id="92b7f-234">Nie</span><span class="sxs-lookup"><span data-stu-id="92b7f-234">No</span></span>|<span data-ttu-id="92b7f-235">nie dotyczy</span><span class="sxs-lookup"><span data-stu-id="92b7f-235">n/a</span></span>|<span data-ttu-id="92b7f-236">Identyfikacja</span><span class="sxs-lookup"><span data-stu-id="92b7f-236">Identification</span></span>|  
  
## <a name="impersonation-level-obtained-from-user-name-credentials-and-cached-token-impersonation"></a><span data-ttu-id="92b7f-237">Poziom personifikacji uzyskany na podstawie poświadczeń nazwy użytkownika i personifikacji tokenu w pamięci podręcznej</span><span class="sxs-lookup"><span data-stu-id="92b7f-237">Impersonation Level Obtained from User Name Credentials and Cached Token Impersonation</span></span>  
 <span data-ttu-id="92b7f-238">Przekazując usługę nazwę użytkownika i hasło, klient programu może zalogować się jako ten użytkownik, który jest odpowiednikiem ustawienia `AllowedImpersonationLevel` właściwości na <xref:System.Security.Principal.TokenImpersonationLevel.Delegation> .</span><span class="sxs-lookup"><span data-stu-id="92b7f-238">By passing the service its user name and password, a client enables WCF to log on as that user, which is equivalent to setting the `AllowedImpersonationLevel` property to <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span> <span data-ttu-id="92b7f-239">( `AllowedImpersonationLevel` Jest dostępny w <xref:System.ServiceModel.Security.WindowsClientCredential> <xref:System.ServiceModel.Security.HttpDigestClientCredential> klasach i.) Poniższa tabela zawiera poziom personifikacji uzyskany, gdy usługa otrzymuje poświadczenia nazwy użytkownika.</span><span class="sxs-lookup"><span data-stu-id="92b7f-239">(The `AllowedImpersonationLevel` is available on the <xref:System.ServiceModel.Security.WindowsClientCredential> and <xref:System.ServiceModel.Security.HttpDigestClientCredential> classes.) The following table provides the impersonation level obtained when the service receives user name credentials.</span></span>  
  
|`AllowedImpersonationLevel`|<span data-ttu-id="92b7f-240">Usługa ma`SeImpersonatePrivilege`</span><span class="sxs-lookup"><span data-stu-id="92b7f-240">Service has `SeImpersonatePrivilege`</span></span>|<span data-ttu-id="92b7f-241">Usługa i klient mogą przebudować</span><span class="sxs-lookup"><span data-stu-id="92b7f-241">Service and client are capable of delegation</span></span>|<span data-ttu-id="92b7f-242">Token pamięci podręcznej`ImpersonationLevel`</span><span class="sxs-lookup"><span data-stu-id="92b7f-242">Cached token `ImpersonationLevel`</span></span>|  
|---------------------------------|------------------------------------------|--------------------------------------------------|---------------------------------------|  
|<span data-ttu-id="92b7f-243">nie dotyczy</span><span class="sxs-lookup"><span data-stu-id="92b7f-243">n/a</span></span>|<span data-ttu-id="92b7f-244">Tak</span><span class="sxs-lookup"><span data-stu-id="92b7f-244">Yes</span></span>|<span data-ttu-id="92b7f-245">Tak</span><span class="sxs-lookup"><span data-stu-id="92b7f-245">Yes</span></span>|<span data-ttu-id="92b7f-246">Delegowanie</span><span class="sxs-lookup"><span data-stu-id="92b7f-246">Delegation</span></span>|  
|<span data-ttu-id="92b7f-247">nie dotyczy</span><span class="sxs-lookup"><span data-stu-id="92b7f-247">n/a</span></span>|<span data-ttu-id="92b7f-248">Yes</span><span class="sxs-lookup"><span data-stu-id="92b7f-248">Yes</span></span>|<span data-ttu-id="92b7f-249">Nie</span><span class="sxs-lookup"><span data-stu-id="92b7f-249">No</span></span>|<span data-ttu-id="92b7f-250">Personifikacja</span><span class="sxs-lookup"><span data-stu-id="92b7f-250">Impersonation</span></span>|  
|<span data-ttu-id="92b7f-251">nie dotyczy</span><span class="sxs-lookup"><span data-stu-id="92b7f-251">n/a</span></span>|<span data-ttu-id="92b7f-252">Nie</span><span class="sxs-lookup"><span data-stu-id="92b7f-252">No</span></span>|<span data-ttu-id="92b7f-253">nie dotyczy</span><span class="sxs-lookup"><span data-stu-id="92b7f-253">n/a</span></span>|<span data-ttu-id="92b7f-254">Identyfikacja</span><span class="sxs-lookup"><span data-stu-id="92b7f-254">Identification</span></span>|  
  
## <a name="impersonation-level-obtained-from-s4u-based-impersonation"></a><span data-ttu-id="92b7f-255">Poziom personifikacji uzyskany z personifikacji opartej na protokole S4U</span><span class="sxs-lookup"><span data-stu-id="92b7f-255">Impersonation Level Obtained from S4U-Based Impersonation</span></span>  
  
|<span data-ttu-id="92b7f-256">Usługa ma`SeTcbPrivilege`</span><span class="sxs-lookup"><span data-stu-id="92b7f-256">Service has `SeTcbPrivilege`</span></span>|<span data-ttu-id="92b7f-257">Usługa ma`SeImpersonatePrivilege`</span><span class="sxs-lookup"><span data-stu-id="92b7f-257">Service has `SeImpersonatePrivilege`</span></span>|<span data-ttu-id="92b7f-258">Usługa i klient mogą przebudować</span><span class="sxs-lookup"><span data-stu-id="92b7f-258">Service and client are capable of delegation</span></span>|<span data-ttu-id="92b7f-259">Token pamięci podręcznej`ImpersonationLevel`</span><span class="sxs-lookup"><span data-stu-id="92b7f-259">Cached token `ImpersonationLevel`</span></span>|  
|----------------------------------|------------------------------------------|--------------------------------------------------|---------------------------------------|  
|<span data-ttu-id="92b7f-260">Tak</span><span class="sxs-lookup"><span data-stu-id="92b7f-260">Yes</span></span>|<span data-ttu-id="92b7f-261">Tak</span><span class="sxs-lookup"><span data-stu-id="92b7f-261">Yes</span></span>|<span data-ttu-id="92b7f-262">nie dotyczy</span><span class="sxs-lookup"><span data-stu-id="92b7f-262">n/a</span></span>|<span data-ttu-id="92b7f-263">Personifikacja</span><span class="sxs-lookup"><span data-stu-id="92b7f-263">Impersonation</span></span>|  
|<span data-ttu-id="92b7f-264">Yes</span><span class="sxs-lookup"><span data-stu-id="92b7f-264">Yes</span></span>|<span data-ttu-id="92b7f-265">Nie</span><span class="sxs-lookup"><span data-stu-id="92b7f-265">No</span></span>|<span data-ttu-id="92b7f-266">nie dotyczy</span><span class="sxs-lookup"><span data-stu-id="92b7f-266">n/a</span></span>|<span data-ttu-id="92b7f-267">Identyfikacja</span><span class="sxs-lookup"><span data-stu-id="92b7f-267">Identification</span></span>|  
|<span data-ttu-id="92b7f-268">Nie</span><span class="sxs-lookup"><span data-stu-id="92b7f-268">No</span></span>|<span data-ttu-id="92b7f-269">nie dotyczy</span><span class="sxs-lookup"><span data-stu-id="92b7f-269">n/a</span></span>|<span data-ttu-id="92b7f-270">nie dotyczy</span><span class="sxs-lookup"><span data-stu-id="92b7f-270">n/a</span></span>|<span data-ttu-id="92b7f-271">Identyfikacja</span><span class="sxs-lookup"><span data-stu-id="92b7f-271">Identification</span></span>|  
  
## <a name="mapping-a-client-certificate-to-a-windows-account"></a><span data-ttu-id="92b7f-272">Mapowanie certyfikatu klienta na konto systemu Windows</span><span class="sxs-lookup"><span data-stu-id="92b7f-272">Mapping a Client Certificate to a Windows Account</span></span>  
 <span data-ttu-id="92b7f-273">Klient może uwierzytelniać się w usłudze przy użyciu certyfikatu, a Usługa mapuje klienta na istniejące konto za pośrednictwem Active Directory.</span><span class="sxs-lookup"><span data-stu-id="92b7f-273">It is possible for a client to authenticate itself to a service using a certificate, and to have the service map the client to an existing account through Active Directory.</span></span> <span data-ttu-id="92b7f-274">Poniższy kod XML przedstawia sposób konfigurowania usługi do mapowania certyfikatu.</span><span class="sxs-lookup"><span data-stu-id="92b7f-274">The following XML shows how to configure the service to map the certificate.</span></span>  
  
```xml  
<behaviors>  
  <serviceBehaviors>  
    <behavior name="MapToWindowsAccount">  
      <serviceCredentials>  
        <clientCertificate>  
          <authentication mapClientCertificateToWindowsAccount="true" />  
        </clientCertificate>  
      </serviceCredentials>  
    </behavior>  
  </serviceBehaviors>  
</behaviors>  
```  
  
 <span data-ttu-id="92b7f-275">Poniższy kod przedstawia sposób konfigurowania usługi.</span><span class="sxs-lookup"><span data-stu-id="92b7f-275">The following code shows how to configure the service.</span></span>  
  
```csharp
// Create a binding that sets a certificate as the client credential type.  
WSHttpBinding b = new WSHttpBinding();  
b.Security.Message.ClientCredentialType = MessageCredentialType.Certificate;  
  
// Create a service host that maps the certificate to a Windows account.  
Uri httpUri = new Uri("http://localhost/Calculator");  
ServiceHost sh = new ServiceHost(typeof(HelloService), httpUri);  
sh.Credentials.ClientCertificate.Authentication.MapClientCertificateToWindowsAccount = true;  
```  
  
## <a name="delegation"></a><span data-ttu-id="92b7f-276">Delegowanie</span><span class="sxs-lookup"><span data-stu-id="92b7f-276">Delegation</span></span>  
 <span data-ttu-id="92b7f-277">Aby delegować do usługi zaplecza, usługa musi wykonać wieloetapowe uwierzytelnianie Kerberos (SSPI bez powrotu NTLM) lub Kerberos Direct do usługi zaplecza przy użyciu tożsamości systemu Windows klienta.</span><span class="sxs-lookup"><span data-stu-id="92b7f-277">To delegate to a back-end service, a service must perform Kerberos multi-leg (SSPI without NTLM fallback) or Kerberos direct authentication to the back-end service using the client’s Windows identity.</span></span> <span data-ttu-id="92b7f-278">Aby delegować do usługi zaplecza, Utwórz <xref:System.ServiceModel.ChannelFactory%601> i kanał, a następnie przekomunikuj się za pośrednictwem kanału podczas personifikacji klienta.</span><span class="sxs-lookup"><span data-stu-id="92b7f-278">To delegate to a back-end service, create a <xref:System.ServiceModel.ChannelFactory%601> and a channel, and then communicate through the channel while impersonating the client.</span></span> <span data-ttu-id="92b7f-279">Dzięki tej formie delegowania odległość, z jaką usługa zaplecza może znajdować się w usłudze frontonu, zależy od poziomu personifikacji osiągniętego przez usługę frontonu.</span><span class="sxs-lookup"><span data-stu-id="92b7f-279">With this form of delegation, the distance at which the back-end service can be located from the front-end service depends on the impersonation level achieved by the front-end service.</span></span> <span data-ttu-id="92b7f-280">Gdy poziom personifikacji to <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation> , usługi frontonu i zaplecza muszą być uruchomione na tym samym komputerze.</span><span class="sxs-lookup"><span data-stu-id="92b7f-280">When the impersonation level is <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>, the front-end and back-end services must be running on the same machine.</span></span> <span data-ttu-id="92b7f-281">Gdy poziom personifikacji to <xref:System.Security.Principal.TokenImpersonationLevel.Delegation> , usługi frontonu i zaplecza mogą znajdować się na oddzielnych maszynach lub na tym samym komputerze.</span><span class="sxs-lookup"><span data-stu-id="92b7f-281">When the impersonation level is <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>, the front-end and back-end services can be on separate machines or on the same machine.</span></span> <span data-ttu-id="92b7f-282">Włączenie personifikacji na poziomie delegowania wymaga skonfigurowania zasad domeny systemu Windows do zezwalania na delegowanie.</span><span class="sxs-lookup"><span data-stu-id="92b7f-282">Enabling delegation-level impersonation requires that Windows domain policy be configured to permit delegation.</span></span> <span data-ttu-id="92b7f-283">Aby uzyskać więcej informacji o konfigurowaniu Active Directory na potrzeby obsługi delegowania, zobacz [Włączanie uwierzytelniania delegowanego](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc780217(v=ws.10)).</span><span class="sxs-lookup"><span data-stu-id="92b7f-283">For more information about configuring Active Directory for delegation support, see [Enabling Delegated Authentication](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc780217(v=ws.10)).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="92b7f-284">Gdy klient uwierzytelnia się w usłudze frontonu przy użyciu nazwy użytkownika i hasła, które odpowiadają kontu systemu Windows w usłudze zaplecza, usługa frontonu może uwierzytelniać się w usłudze zaplecza przez ponowne użycie nazwy użytkownika i hasła klienta.</span><span class="sxs-lookup"><span data-stu-id="92b7f-284">When a client authenticates to the front-end service using a user name and password that correspond to a Windows account on the back-end service, the front-end service can authenticate to the back-end service by reusing the client’s user name and password.</span></span> <span data-ttu-id="92b7f-285">Jest to szczególnie wydajna postać przepływu tożsamości, ponieważ przekazywanie nazwy użytkownika i hasła do usługi zaplecza umożliwia usłudze zaplecza wykonywanie personifikacji, ale nie stanowi delegowania, ponieważ nie jest używany protokół Kerberos.</span><span class="sxs-lookup"><span data-stu-id="92b7f-285">This is a particularly powerful form of identity flow, because passing user name and password to the back-end service enables the back-end service to perform impersonation, but it does not constitute delegation because Kerberos is not used.</span></span> <span data-ttu-id="92b7f-286">Kontrolki Active Directory w delegowaniu nie mają zastosowania do uwierzytelniania nazwy użytkownika i hasła.</span><span class="sxs-lookup"><span data-stu-id="92b7f-286">Active Directory controls on delegation do not apply to user name and password authentication.</span></span>  
  
### <a name="delegation-ability-as-a-function-of-impersonation-level"></a><span data-ttu-id="92b7f-287">Możliwość delegowania jako funkcja poziomu personifikacji</span><span class="sxs-lookup"><span data-stu-id="92b7f-287">Delegation Ability as a Function of Impersonation Level</span></span>  
  
|<span data-ttu-id="92b7f-288">Poziom personifikacji</span><span class="sxs-lookup"><span data-stu-id="92b7f-288">Impersonation level</span></span>|<span data-ttu-id="92b7f-289">Usługa może przeprowadzać delegowanie między procesami</span><span class="sxs-lookup"><span data-stu-id="92b7f-289">Service can perform cross-process delegation</span></span>|<span data-ttu-id="92b7f-290">Usługa może wykonywać delegowanie między maszynami</span><span class="sxs-lookup"><span data-stu-id="92b7f-290">Service can perform cross-machine delegation</span></span>|  
|-------------------------|---------------------------------------------------|---------------------------------------------------|  
|<xref:System.Security.Principal.TokenImpersonationLevel.Identification>|<span data-ttu-id="92b7f-291">Nie</span><span class="sxs-lookup"><span data-stu-id="92b7f-291">No</span></span>|<span data-ttu-id="92b7f-292">Nie</span><span class="sxs-lookup"><span data-stu-id="92b7f-292">No</span></span>|  
|<xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>|<span data-ttu-id="92b7f-293">Yes</span><span class="sxs-lookup"><span data-stu-id="92b7f-293">Yes</span></span>|<span data-ttu-id="92b7f-294">Nie</span><span class="sxs-lookup"><span data-stu-id="92b7f-294">No</span></span>|  
|<xref:System.Security.Principal.TokenImpersonationLevel.Delegation>|<span data-ttu-id="92b7f-295">Tak</span><span class="sxs-lookup"><span data-stu-id="92b7f-295">Yes</span></span>|<span data-ttu-id="92b7f-296">Tak</span><span class="sxs-lookup"><span data-stu-id="92b7f-296">Yes</span></span>|  
  
 <span data-ttu-id="92b7f-297">Poniższy przykład kodu demonstruje sposób korzystania z delegowania.</span><span class="sxs-lookup"><span data-stu-id="92b7f-297">The following code example demonstrates how to use delegation.</span></span>  
  
 [!code-csharp[c_delegation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_delegation/cs/source.cs#1)]
 [!code-vb[c_delegation#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_delegation/vb/source.vb#1)]  
  
### <a name="how-to-configure-an-application-to-use-constrained-delegation"></a><span data-ttu-id="92b7f-298">Jak skonfigurować aplikację do korzystania z delegowania ograniczonego</span><span class="sxs-lookup"><span data-stu-id="92b7f-298">How to Configure an Application to Use Constrained Delegation</span></span>  
 <span data-ttu-id="92b7f-299">Aby można było korzystać z delegowania ograniczonego, należy odpowiednio skonfigurować nadawcę, odbiorcę i kontroler domeny.</span><span class="sxs-lookup"><span data-stu-id="92b7f-299">Before you can use constrained delegation, the sender, receiver, and the domain controller must be configured to do so.</span></span> <span data-ttu-id="92b7f-300">Poniższa procedura zawiera listę czynności, które umożliwiają delegowanie ograniczone.</span><span class="sxs-lookup"><span data-stu-id="92b7f-300">The following procedure lists the steps that enable constrained delegation.</span></span> <span data-ttu-id="92b7f-301">Aby uzyskać szczegółowe informacje o różnicach między delegowaniem i delegowaniem ograniczonym, zobacz część [rozszerzeń systemu Windows Server 2003 Kerberos](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc738207(v=ws.10)) , które omawiają ograniczone dyskusje.</span><span class="sxs-lookup"><span data-stu-id="92b7f-301">For details about the differences between delegation and constrained delegation, see the portion of [Windows Server 2003 Kerberos Extensions](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc738207(v=ws.10)) that discusses constrained discussion.</span></span>  
  
1. <span data-ttu-id="92b7f-302">Na kontrolerze domeny wyczyść pole wyboru **konto jest poufne i nie może być delegowane** dla konta, w ramach którego jest uruchomiona aplikacja kliencka.</span><span class="sxs-lookup"><span data-stu-id="92b7f-302">On the domain controller, clear the **Account is sensitive and cannot be delegated** check box for the account under which the client application is running.</span></span>  
  
2. <span data-ttu-id="92b7f-303">Na kontrolerze domeny zaznacz pole wyboru **konto jest zaufane dla delegowania** dla konta, w ramach którego uruchomiona jest aplikacja kliencka.</span><span class="sxs-lookup"><span data-stu-id="92b7f-303">On the domain controller, select the **Account is trusted for delegation** check box for the account under which the client application is running.</span></span>  
  
3. <span data-ttu-id="92b7f-304">Na kontrolerze domeny skonfiguruj komputer warstwy środkowej tak, aby był zaufany dla delegowania, klikając opcję **Ufaj komputerowi dla delegowania** .</span><span class="sxs-lookup"><span data-stu-id="92b7f-304">On the domain controller, configure the middle tier computer so that it is trusted for delegation, by clicking the **Trust computer for delegation** option.</span></span>  
  
4. <span data-ttu-id="92b7f-305">Na kontrolerze domeny skonfiguruj komputer warstwy środkowej do korzystania z delegowania ograniczonego, klikając opcję **Ufaj temu komputerowi w delegowaniu tylko do określonych usług** .</span><span class="sxs-lookup"><span data-stu-id="92b7f-305">On the domain controller, configure the middle tier computer to use constrained delegation, by clicking the **Trust this computer for delegation to specified services only** option.</span></span>  
  
 <span data-ttu-id="92b7f-306">Aby uzyskać bardziej szczegółowe instrukcje dotyczące konfigurowania delegowania ograniczonego, zobacz [przejście do protokołu Kerberos i delegowanie ograniczone](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc739587(v=ws.10)).</span><span class="sxs-lookup"><span data-stu-id="92b7f-306">For more detailed instructions about configuring constrained delegation, see [Kerberos Protocol Transition and Constrained Delegation](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc739587(v=ws.10)).</span></span>
  
## <a name="see-also"></a><span data-ttu-id="92b7f-307">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="92b7f-307">See also</span></span>

- <xref:System.ServiceModel.OperationBehaviorAttribute>
- <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A>
- <xref:System.ServiceModel.ImpersonationOption>
- <xref:System.ServiceModel.ServiceSecurityContext.WindowsIdentity%2A>
- <xref:System.ServiceModel.ServiceSecurityContext>
- <xref:System.Security.Principal.WindowsIdentity>
- <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior>
- <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.ImpersonateCallerForAllOperations%2A>
- <xref:System.ServiceModel.ServiceHost>
- <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A>
- <xref:System.ServiceModel.Security.WindowsClientCredential>
- <xref:System.ServiceModel.ChannelFactory%601>
- <xref:System.Security.Principal.TokenImpersonationLevel.Identification>
- [<span data-ttu-id="92b7f-308">Korzystanie z personifikacji z zabezpieczeniami transportu</span><span class="sxs-lookup"><span data-stu-id="92b7f-308">Using Impersonation with Transport Security</span></span>](using-impersonation-with-transport-security.md)
- [<span data-ttu-id="92b7f-309">Personifikowanie klienta</span><span class="sxs-lookup"><span data-stu-id="92b7f-309">Impersonating the Client</span></span>](../samples/impersonating-the-client.md)
- [<span data-ttu-id="92b7f-310">Instrukcje: Personifikowanie klienta w usłudze</span><span class="sxs-lookup"><span data-stu-id="92b7f-310">How to: Impersonate a Client on a Service</span></span>](../how-to-impersonate-a-client-on-a-service.md)
- [<span data-ttu-id="92b7f-311">Narzędzie do obsługi metadanych elementu ServiceModel (Svcutil.exe)</span><span class="sxs-lookup"><span data-stu-id="92b7f-311">ServiceModel Metadata Utility Tool (Svcutil.exe)</span></span>](../servicemodel-metadata-utility-tool-svcutil-exe.md)
