---
title: Rozwiązywanie problemów obsługi komunikatów kolejek
ms.date: 03/30/2017
ms.assetid: a5f2836f-018d-42f5-a571-1e97e64ea5b0
ms.openlocfilehash: 5c039c34983647884561f33645f26e4a89280248
ms.sourcegitcommit: cdf5084648bf5e77970cbfeaa23f1cab3e6e234e
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 02/01/2020
ms.locfileid: "76921268"
---
# <a name="troubleshooting-queued-messaging"></a><span data-ttu-id="e3297-102">Rozwiązywanie problemów obsługi komunikatów kolejek</span><span class="sxs-lookup"><span data-stu-id="e3297-102">Troubleshooting Queued Messaging</span></span>

<span data-ttu-id="e3297-103">Ta sekcja zawiera typowe pytania i pomoc dotycząca rozwiązywania problemów dotyczących korzystania z kolejek w programie Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="e3297-103">This section contains common questions and troubleshooting help for using queues in Windows Communication Foundation (WCF).</span></span>

## <a name="common-questions"></a><span data-ttu-id="e3297-104">Często zadawane pytania</span><span class="sxs-lookup"><span data-stu-id="e3297-104">Common Questions</span></span>

<span data-ttu-id="e3297-105">**P:** Używam programu WCF Beta 1 i zainstalowano poprawkę usługi MSMQ.</span><span class="sxs-lookup"><span data-stu-id="e3297-105">**Q:** I used WCF Beta 1 and I installed the MSMQ hotfix.</span></span> <span data-ttu-id="e3297-106">Czy muszę usunąć poprawkę?</span><span class="sxs-lookup"><span data-stu-id="e3297-106">Do I need to remove the hotfix?</span></span>

<span data-ttu-id="e3297-107">**Odpowiedź:** tak.</span><span class="sxs-lookup"><span data-stu-id="e3297-107">**A:** Yes.</span></span> <span data-ttu-id="e3297-108">Ta poprawka nie jest już obsługiwana.</span><span class="sxs-lookup"><span data-stu-id="e3297-108">This hotfix is no longer supported.</span></span> <span data-ttu-id="e3297-109">Funkcja WCF działa teraz w usłudze MSMQ bez wymaganej poprawki.</span><span class="sxs-lookup"><span data-stu-id="e3297-109">WCF now works on MSMQ without a hotfix requirement.</span></span>

<span data-ttu-id="e3297-110">**P:** Istnieją dwa powiązania usługi MSMQ: <xref:System.ServiceModel.NetMsmqBinding> i <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>.</span><span class="sxs-lookup"><span data-stu-id="e3297-110">**Q:** There are two bindings for MSMQ: <xref:System.ServiceModel.NetMsmqBinding> and <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>.</span></span> <span data-ttu-id="e3297-111">Czego mam używać i kiedy?</span><span class="sxs-lookup"><span data-stu-id="e3297-111">What should I use and when?</span></span>

<span data-ttu-id="e3297-112">Odp **.:** Użyj <xref:System.ServiceModel.NetMsmqBinding>, jeśli chcesz użyć usługi MSMQ jako transportu do kolejkowanej komunikacji między dwiema aplikacjami WCF.</span><span class="sxs-lookup"><span data-stu-id="e3297-112">**A:** Use the <xref:System.ServiceModel.NetMsmqBinding> when you want to use MSMQ as a transport for queued communication between two WCF applications.</span></span> <span data-ttu-id="e3297-113">Użyj <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>, jeśli chcesz używać istniejących aplikacji usługi MSMQ do komunikowania się z nowymi aplikacjami WCF.</span><span class="sxs-lookup"><span data-stu-id="e3297-113">Use the <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> when you want to use existing MSMQ applications to communicate with new WCF applications.</span></span>

<span data-ttu-id="e3297-114">**P:** Czy muszę uaktualnić usługę MSMQ, aby używać powiązań <xref:System.ServiceModel.NetMsmqBinding> i `MsmqIntegration`?</span><span class="sxs-lookup"><span data-stu-id="e3297-114">**Q:** Do I have to upgrade MSMQ to use the <xref:System.ServiceModel.NetMsmqBinding> and `MsmqIntegration` bindings?</span></span>

<span data-ttu-id="e3297-115">**Odp.:** Nie.</span><span class="sxs-lookup"><span data-stu-id="e3297-115">**A:** No.</span></span> <span data-ttu-id="e3297-116">Oba powiązania działają z usługą MSMQ 3,0 w systemach Windows XP i Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="e3297-116">Both bindings work with MSMQ 3.0 on Windows XP and Windows Server 2003.</span></span> <span data-ttu-id="e3297-117">Niektóre funkcje powiązań stają się dostępne po uaktualnieniu do usługi MSMQ 4,0 w systemie Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="e3297-117">Certain features of the bindings become available when you upgrade to MSMQ 4.0 in Windows Vista.</span></span>

<span data-ttu-id="e3297-118">**P:** Jakie funkcje powiązań <xref:System.ServiceModel.NetMsmqBinding> i <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> są dostępne w usłudze MSMQ 4,0, ale nie w usłudze MSMQ 3,0?</span><span class="sxs-lookup"><span data-stu-id="e3297-118">**Q:** What features of the <xref:System.ServiceModel.NetMsmqBinding> and <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> bindings are available in MSMQ 4.0 but not in MSMQ 3.0?</span></span>

<span data-ttu-id="e3297-119">Odp **.:** W przypadku usługi MSMQ 4,0 dostępne są następujące funkcje, ale nie w usłudze MSMQ 3,0:</span><span class="sxs-lookup"><span data-stu-id="e3297-119">**A:** The following features are available in MSMQ 4.0 but not in MSMQ 3.0:</span></span>

- <span data-ttu-id="e3297-120">Niestandardowa Kolejka utraconych wiadomości jest obsługiwana tylko w przypadku usługi MSMQ 4,0.</span><span class="sxs-lookup"><span data-stu-id="e3297-120">Custom dead-letter queue is supported only on MSMQ 4.0.</span></span>

- <span data-ttu-id="e3297-121">Usługi MSMQ 3,0 i 4,0 obsługują skażone komunikaty inaczej.</span><span class="sxs-lookup"><span data-stu-id="e3297-121">MSMQ 3.0 and 4.0 handle poison messages differently.</span></span>

- <span data-ttu-id="e3297-122">Tylko usługa MSMQ 4,0 obsługuje zdalne odczyty transakcyjne.</span><span class="sxs-lookup"><span data-stu-id="e3297-122">Only MSMQ 4.0 supports remote transacted read.</span></span>

<span data-ttu-id="e3297-123">Aby uzyskać więcej informacji, zobacz [różnice w funkcjach kolejkowania w systemach Windows Vista, Windows Server 2003 i Windows XP](../../../../docs/framework/wcf/feature-details/diff-in-queue-in-vista-server-2003-windows-xp.md).</span><span class="sxs-lookup"><span data-stu-id="e3297-123">For more information, see [Differences in Queuing Features in Windows Vista, Windows Server 2003, and Windows XP](../../../../docs/framework/wcf/feature-details/diff-in-queue-in-vista-server-2003-windows-xp.md).</span></span>

<span data-ttu-id="e3297-124">**P:** Czy mogę używać usługi MSMQ 3,0 po jednej stronie komunikacji w kolejce i usługi MSMQ 4,0 po drugiej stronie?</span><span class="sxs-lookup"><span data-stu-id="e3297-124">**Q:** Can I use MSMQ 3.0 on one side of a queued communication and MSMQ 4.0 on the other side?</span></span>

<span data-ttu-id="e3297-125">**Odpowiedź:** tak.</span><span class="sxs-lookup"><span data-stu-id="e3297-125">**A:** Yes.</span></span>

<span data-ttu-id="e3297-126">**P:** Chcę zintegrować istniejące aplikacje usługi MSMQ z nowymi klientami lub serwerami WCF.</span><span class="sxs-lookup"><span data-stu-id="e3297-126">**Q:** I want to integrate existing MSMQ applications with new WCF clients or servers.</span></span> <span data-ttu-id="e3297-127">Czy muszę uaktualnić obie strony mojej infrastruktury usługi MSMQ?</span><span class="sxs-lookup"><span data-stu-id="e3297-127">Do I need to upgrade both sides of my MSMQ infrastructure?</span></span>

<span data-ttu-id="e3297-128">**Odp.:** Nie.</span><span class="sxs-lookup"><span data-stu-id="e3297-128">**A:** No.</span></span> <span data-ttu-id="e3297-129">Po obu stronach nie ma potrzeby uaktualniania do usługi MSMQ 4,0.</span><span class="sxs-lookup"><span data-stu-id="e3297-129">You do not have to upgrade to MSMQ 4.0 on either side.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="e3297-130">Rozwiązywanie problemów</span><span class="sxs-lookup"><span data-stu-id="e3297-130">Troubleshooting</span></span>

<span data-ttu-id="e3297-131">Ta sekcja zawiera odpowiedzi na najczęstsze problemy z rozwiązywaniem problemów.</span><span class="sxs-lookup"><span data-stu-id="e3297-131">This section contains answers to most common troubleshooting issues.</span></span> <span data-ttu-id="e3297-132">Niektóre problemy, które są znane ograniczenia są również opisane w informacjach o wersji.</span><span class="sxs-lookup"><span data-stu-id="e3297-132">Some issues that are known limitations are also described in the release notes.</span></span>

<span data-ttu-id="e3297-133">**P:** Próbuję użyć kolejki prywatnej i otrzymuję następujący wyjątek: `System.InvalidOperationException`: adres URL jest nieprawidłowy.</span><span class="sxs-lookup"><span data-stu-id="e3297-133">**Q:** I am trying to use a private queue and I get the following exception: `System.InvalidOperationException`: The URL is invalid.</span></span> <span data-ttu-id="e3297-134">Adres URL kolejki nie może zawierać znaku "$".</span><span class="sxs-lookup"><span data-stu-id="e3297-134">The URL for the queue cannot contain the '$' character.</span></span> <span data-ttu-id="e3297-135">Użyj składni w usłudze net. MSMQ://machine/private/queueName, aby rozwiązać kolejkę prywatną.</span><span class="sxs-lookup"><span data-stu-id="e3297-135">Use the syntax in net.msmq://machine/private/queueName to address a private queue.</span></span>

<span data-ttu-id="e3297-136">Odp **.:** Sprawdź Uniform Resource Identifier kolejki (URI) w konfiguracji i kodzie.</span><span class="sxs-lookup"><span data-stu-id="e3297-136">**A:** Please check the queue Uniform Resource Identifier (URI) in your configuration and code.</span></span> <span data-ttu-id="e3297-137">Nie używaj znaku "$" w identyfikatorze URI.</span><span class="sxs-lookup"><span data-stu-id="e3297-137">Do not use the "$" character in the URI.</span></span> <span data-ttu-id="e3297-138">Na przykład, aby rozwiązać kolejkę prywatną o nazwie OrdersQueue, określ identyfikator URI w formacie net. MSMQ://localhost/private/ordersQueue.</span><span class="sxs-lookup"><span data-stu-id="e3297-138">For example, to address a private queue named OrdersQueue, specify the URI as net.msmq://localhost/private/ordersQueue.</span></span>

<span data-ttu-id="e3297-139">**P:** Wywołanie `ServiceHost.Open()` w Kolejkowanej aplikacji zgłasza następujący wyjątek: `System.ArgumentException`: adres podstawowy nie może zawierać ciągu zapytania identyfikatora URI.</span><span class="sxs-lookup"><span data-stu-id="e3297-139">**Q:** Calling `ServiceHost.Open()` on my queued application throws the following exception: `System.ArgumentException`: A base address cannot contain a URI query string.</span></span> <span data-ttu-id="e3297-140">Dlaczego?</span><span class="sxs-lookup"><span data-stu-id="e3297-140">Why?</span></span>

<span data-ttu-id="e3297-141">Odp **.:** Sprawdź identyfikator URI kolejki w pliku konfiguracji i w kodzie.</span><span class="sxs-lookup"><span data-stu-id="e3297-141">**A:** Check the queue URI in your configuration file and in your code.</span></span> <span data-ttu-id="e3297-142">Podczas gdy kolejki MSMQ obsługują znak "?", identyfikatory URI interpretują ten znak jako początek zapytania ciągu.</span><span class="sxs-lookup"><span data-stu-id="e3297-142">While MSMQ queues support the use of the '?' character, URIs interpret this character as the beginning of a string query.</span></span> <span data-ttu-id="e3297-143">Aby uniknąć tego problemu, użyj nazw kolejek, które nie zawierają znaków "?".</span><span class="sxs-lookup"><span data-stu-id="e3297-143">To avoid this issue, use queue names that do not contain '?' characters.</span></span>

<span data-ttu-id="e3297-144">**P:** Moje wysłanie zakończyło się pomyślnie, ale na odbiorniku nie została wywołana żadna operacja usługi.</span><span class="sxs-lookup"><span data-stu-id="e3297-144">**Q:** My send succeeded but no service operation is invoked on the receiver.</span></span> <span data-ttu-id="e3297-145">Dlaczego?</span><span class="sxs-lookup"><span data-stu-id="e3297-145">Why?</span></span>

<span data-ttu-id="e3297-146">Odp **.:** Aby określić odpowiedź, należy wykonać następującą listę kontrolną:</span><span class="sxs-lookup"><span data-stu-id="e3297-146">**A:** To determine the answer, work through the following check list:</span></span>

- <span data-ttu-id="e3297-147">Sprawdź, czy wymagania dotyczące kolejki transakcyjnej są zgodne z określonymi gwarancjami.</span><span class="sxs-lookup"><span data-stu-id="e3297-147">Check that the transactional queue requirements are compatible with the assurances specified.</span></span> <span data-ttu-id="e3297-148">Należy pamiętać o następujących zasadach:</span><span class="sxs-lookup"><span data-stu-id="e3297-148">Note the following principles:</span></span>

  - <span data-ttu-id="e3297-149">Można wysyłać trwałe wiadomości (datagramy i sesje) z gwarancjami "dokładnie raz" (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`) tylko do kolejki transakcyjnej.</span><span class="sxs-lookup"><span data-stu-id="e3297-149">You can send durable messages (datagrams and sessions) with "exactly once" assurances (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`) only to a transactional queue.</span></span>

  - <span data-ttu-id="e3297-150">Sesje można wysyłać tylko za pomocą gwarancji "dokładnie raz".</span><span class="sxs-lookup"><span data-stu-id="e3297-150">You can send sessions only with "exactly once" assurances.</span></span>

  - <span data-ttu-id="e3297-151">Transakcja jest wymagana do odbierania komunikatów w sesji z kolejki transakcyjnej.</span><span class="sxs-lookup"><span data-stu-id="e3297-151">A transaction is required to receive messages in a session from a transactional queue.</span></span>

  - <span data-ttu-id="e3297-152">Można wysyłać i odbierać nietrwałe lub trwałe komunikaty (tylko datagramy) bez gwarancji (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`) tylko do kolejki nietransakcyjnej.</span><span class="sxs-lookup"><span data-stu-id="e3297-152">You can send or receive volatile or durable messages (datagrams only) with no assurances (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`) only to a non-transactional queue.</span></span>

- <span data-ttu-id="e3297-153">Sprawdź kolejkę utraconych wiadomości.</span><span class="sxs-lookup"><span data-stu-id="e3297-153">Check the dead-letter queue.</span></span> <span data-ttu-id="e3297-154">Jeśli znajdziesz tam komunikaty, określ, dlaczego nie zostały one dostarczone.</span><span class="sxs-lookup"><span data-stu-id="e3297-154">If you find the messages there, determine why they were not delivered.</span></span>

- <span data-ttu-id="e3297-155">Sprawdź kolejki wychodzące pod kątem problemów z łącznością lub rozruchem.</span><span class="sxs-lookup"><span data-stu-id="e3297-155">Check the outgoing queues for connectivity or addressing problems.</span></span>

<span data-ttu-id="e3297-156">**P:** Określono niestandardową kolejkę utraconych wiadomości, ale po uruchomieniu aplikacji nadawcy otrzymuję wyjątek, że nie można odnaleźć kolejki utraconych wiadomości lub aplikacja wysyłająca nie ma uprawnień do kolejki utraconych wiadomości.</span><span class="sxs-lookup"><span data-stu-id="e3297-156">**Q:** I have specified a custom dead-letter queue, but when I start the sender application, I get an exception that either the dead-letter queue is not found, or the sending application has no permission to the dead-letter queue.</span></span> <span data-ttu-id="e3297-157">Dlaczego tak się dzieje?</span><span class="sxs-lookup"><span data-stu-id="e3297-157">Why is this happening?</span></span>

<span data-ttu-id="e3297-158">Odp **.:** Niestandardowy identyfikator URI kolejki utraconych wiadomości musi zawierać "localhost" lub nazwę komputera w pierwszym segmencie, na przykład net. MSMQ://localhost/private/myAppdead-letter Queue.</span><span class="sxs-lookup"><span data-stu-id="e3297-158">**A:** The custom dead-letter queue URI must include a "localhost" or the computer name in the first segment, for example, net.msmq://localhost/private/myAppdead-letter queue.</span></span>

<span data-ttu-id="e3297-159">**P:** Czy zawsze konieczne jest zdefiniowanie niestandardowej kolejki utraconych wiadomości lub czy istnieje domyślna kolejka utraconych wiadomości?</span><span class="sxs-lookup"><span data-stu-id="e3297-159">**Q:** Is it always necessary to define a custom dead-letter queue, or is there a default dead-letter queue?</span></span>

<span data-ttu-id="e3297-160">Odp **.:** Jeśli program Assurances ma wartość "dokładnie raz" (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`), a jeśli nie określisz niestandardowej kolejki utraconych wiadomości, wartością domyślną będzie Kolejka utraconych wiadomości transakcyjnych w całej systemie.</span><span class="sxs-lookup"><span data-stu-id="e3297-160">**A:** If assurances are "exactly once" (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`), and if you do not specify a custom dead-letter queue, the default is a system-wide transactional dead-letter queue.</span></span>

<span data-ttu-id="e3297-161">Jeśli program Assurances nie ma (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`), wartość domyślna nie jest funkcją kolejki utraconych wiadomości.</span><span class="sxs-lookup"><span data-stu-id="e3297-161">If assurances are none (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`), then the default is no dead-letter queue functionality.</span></span>

<span data-ttu-id="e3297-162">**P:** Moja usługa zgłasza na SvcHost. Otwórz z komunikatem "EndpointListener wymagania nie mogą być spełnione przez ListenerFactory".</span><span class="sxs-lookup"><span data-stu-id="e3297-162">**Q:** My service throws on SvcHost.Open with a message "EndpointListener requirements cannot be met by the ListenerFactory".</span></span> <span data-ttu-id="e3297-163">Dlaczego?</span><span class="sxs-lookup"><span data-stu-id="e3297-163">Why?</span></span>

<span data-ttu-id="e3297-164">A.</span><span class="sxs-lookup"><span data-stu-id="e3297-164">A.</span></span> <span data-ttu-id="e3297-165">Sprawdź kontrakt usługi.</span><span class="sxs-lookup"><span data-stu-id="e3297-165">Check your service contract.</span></span> <span data-ttu-id="e3297-166">Być może zapomniano umieścić "IsOneWay =`true`" we wszystkich operacjach usługi.</span><span class="sxs-lookup"><span data-stu-id="e3297-166">You may have forgotten to put "IsOneWay=`true`" on all the service operations.</span></span> <span data-ttu-id="e3297-167">Kolejki obsługują tylko jednokierunkowe operacje usługi.</span><span class="sxs-lookup"><span data-stu-id="e3297-167">Queues support only one-way service operations.</span></span>

<span data-ttu-id="e3297-168">**P:** W kolejce znajdują się komunikaty, ale nie jest wywoływana żadna operacja usługi.</span><span class="sxs-lookup"><span data-stu-id="e3297-168">**Q:** There are messages in the queue but no service operation is invoked.</span></span> <span data-ttu-id="e3297-169">Jaki jest problem?</span><span class="sxs-lookup"><span data-stu-id="e3297-169">What is the problem?</span></span>

<span data-ttu-id="e3297-170">Odp **.:** Ustal, czy wystąpił błąd hosta usługi.</span><span class="sxs-lookup"><span data-stu-id="e3297-170">**A:** Determine if your service host is faulted.</span></span> <span data-ttu-id="e3297-171">Możesz sprawdzić, patrząc na ślad lub implementując `IErrorHandler`.</span><span class="sxs-lookup"><span data-stu-id="e3297-171">You can check by looking at the trace or implementing `IErrorHandler`.</span></span> <span data-ttu-id="e3297-172">Błędy hosta usługi domyślnie, jeśli zostanie wykryty Trująca wiadomość.</span><span class="sxs-lookup"><span data-stu-id="e3297-172">Service host faults, by default, if a poison message is detected.</span></span>

<span data-ttu-id="e3297-173">**P:** W kolejce znajdują się komunikaty, ale Usługa My hostowana w sieci Web nie jest aktywowana.</span><span class="sxs-lookup"><span data-stu-id="e3297-173">**Q:** There are messages in the queue but my Web-hosted queued service is not getting activated.</span></span> <span data-ttu-id="e3297-174">Dlaczego?</span><span class="sxs-lookup"><span data-stu-id="e3297-174">Why?</span></span>

<span data-ttu-id="e3297-175">Odp **.:** Najbardziej typową przyczyną są uprawnienia.</span><span class="sxs-lookup"><span data-stu-id="e3297-175">**A:** The most common reason is permissions.</span></span>

1. <span data-ttu-id="e3297-176">Upewnij się, że proces `NetMsmqActivator` jest uruchomiony, a tożsamość procesu `NetMsmqActivator` ma przyznane uprawnienie Odczyt i wyszukiwanie w kolejce.</span><span class="sxs-lookup"><span data-stu-id="e3297-176">Ensure that the `NetMsmqActivator` process is running and the identity of the `NetMsmqActivator` process is given read and seek permission on the queue.</span></span>

2. <span data-ttu-id="e3297-177">Jeśli `NetMsmqActivator` jest monitorowane kolejki na komputerze zdalnym, należy się upewnić, że `NetMsmqActivator` nie działa w ramach ograniczonego tokenu.</span><span class="sxs-lookup"><span data-stu-id="e3297-177">If the `NetMsmqActivator` is monitoring queues on a remote machine, ensure that `NetMsmqActivator` does not run under a restricted token.</span></span> <span data-ttu-id="e3297-178">Aby uruchomić `NetMsmqActivator` przy użyciu nieograniczonego tokenu:</span><span class="sxs-lookup"><span data-stu-id="e3297-178">To run the `NetMsmqActivator` with an unrestricted token:</span></span>

    ```console
    sc sidtype NetMsmqActivator unrestricted
    ```

<span data-ttu-id="e3297-179">W przypadku problemów z hostem sieci Web niezwiązanych z zabezpieczeniami odnoszą się do: [hostowanie aplikacji w kolejce](../../../../docs/framework/wcf/feature-details/web-hosting-a-queued-application.md).</span><span class="sxs-lookup"><span data-stu-id="e3297-179">For non-security related Web host issues refer to: [Web Hosting a Queued Application](../../../../docs/framework/wcf/feature-details/web-hosting-a-queued-application.md).</span></span>

<span data-ttu-id="e3297-180">**P:** Co to jest najprostszy sposób uzyskiwania dostępu do sesji?</span><span class="sxs-lookup"><span data-stu-id="e3297-180">**Q:** What is the easiest way to access sessions?</span></span>

<span data-ttu-id="e3297-181">Odp **.:** Ustaw Autouzupełnianie =`true` operacji, która odnosi się do ostatniej wiadomości w sesji, i ustaw Autouzupełnianie =`false` dla wszystkich pozostałych operacji usługi.</span><span class="sxs-lookup"><span data-stu-id="e3297-181">**A:** Set AutoComplete=`true` on the operation that corresponds to the last message in the session, and set AutoComplete=`false` on all remaining service operations.</span></span>

<span data-ttu-id="e3297-182">**P:** Dlaczego moja usługa zgłasza `ProtocolException` podczas odczytywania z kolejki zawierającej zarówno komunikaty sesji w kolejce, jak i komunikaty datagramu w kolejce?</span><span class="sxs-lookup"><span data-stu-id="e3297-182">**Q:** Why does my service throw a `ProtocolException` when reading from a queue that contains both queued session messages and queued datagram messages?</span></span>

<span data-ttu-id="e3297-183">Odp **.:** Istnieje fundamentalna różnica w sposobie, w jaki kolejkowane komunikaty sesji i kolejkowane komunikaty datagramu.</span><span class="sxs-lookup"><span data-stu-id="e3297-183">**A:** There is a fundamental difference in the way queued session messages and queued datagram messages are composed.</span></span> <span data-ttu-id="e3297-184">Z tego względu usługa, która oczekuje na odczytanie komunikatu sesji z kolejką, nie może odebrać komunikatu dataqueue w kolejce, a usługa oczekuje na odczytanie komunikatu dataqueue w kolejce nie może odebrać komunikatu sesji.</span><span class="sxs-lookup"><span data-stu-id="e3297-184">Because of this, a service that is expecting to read a queued session message cannot receive a queued datagram message and a service expecting to read a queued datagram message cannot receive a session message.</span></span> <span data-ttu-id="e3297-185">Próba odczytania obu rodzajów komunikatów z tej samej kolejki zgłasza następujący wyjątek:</span><span class="sxs-lookup"><span data-stu-id="e3297-185">Attempting to read both types of messages from the same queue throws the following exception:</span></span>

```console
System.ServiceModel.MsmqPoisonMessageException: The transport channel detected a poison message. This occurred because the message exceeded the maximum number of delivery attempts or because the channel detected a fundamental problem with the message. The inner exception may contain additional information.
---> System.ServiceModel.ProtocolException: An incoming MSMQ message contained invalid or unexpected .NET Message Framing information in its body. The message cannot be received. Ensure that the sender is using a compatible service contract with a matching SessionMode.
```

<span data-ttu-id="e3297-186">Kolejka utraconych wiadomości systemowych, a także jakakolwiek niestandardowa Kolejka utraconych wiadomości, jest szczególnie podatna na ten problem, jeśli aplikacja wyśle w kolejce komunikaty sesji i dataqueue z tego samego komputera.</span><span class="sxs-lookup"><span data-stu-id="e3297-186">The system dead-letter queue, as well as any custom dead-letter queue, is particularly susceptible to this issue if an application sends both queued session messages and queued datagram messages from the same computer.</span></span> <span data-ttu-id="e3297-187">Jeśli wiadomość nie może zostać wysłana pomyślnie, zostanie ona przeniesiona do kolejki utraconych wiadomości.</span><span class="sxs-lookup"><span data-stu-id="e3297-187">If a message cannot be sent successfully, it is moved to the dead-letter queue.</span></span> <span data-ttu-id="e3297-188">W takich okolicznościach istnieje możliwość, że zarówno sesja, jak i datagram komunikatów w kolejce utraconych wiadomości.</span><span class="sxs-lookup"><span data-stu-id="e3297-188">Under these circumstances, it is possible to have both session and datagram messages in the dead-letter queue.</span></span> <span data-ttu-id="e3297-189">Nie ma możliwości oddzielenia obydwu typów komunikatów w czasie wykonywania podczas odczytywania z kolejki, w związku z tym aplikacje nie powinny wysyłać komunikatów sesji w kolejce i komunikatów dataqueue umieszczonych w kolejce z tego samego komputera.</span><span class="sxs-lookup"><span data-stu-id="e3297-189">There is no way to separate both types of messages at runtime when reading from a queue, therefore, applications should not send both queued session messages and queued datagram messages from the same computer.</span></span>

### <a name="msmq-integration-specific-troubleshooting"></a><span data-ttu-id="e3297-190">Integracja z usługą MSMQ: konkretne Rozwiązywanie problemów</span><span class="sxs-lookup"><span data-stu-id="e3297-190">MSMQ Integration: Specific Troubleshooting</span></span>

<span data-ttu-id="e3297-191">**P:** Po wysłaniu wiadomości lub po otwarciu hosta usługi otrzymuję komunikat o błędzie informujący, że schemat jest nieprawidłowy.</span><span class="sxs-lookup"><span data-stu-id="e3297-191">**Q:** When I send a message, or when I open the service host, I get an error that indicates the scheme is wrong.</span></span> <span data-ttu-id="e3297-192">Dlaczego?</span><span class="sxs-lookup"><span data-stu-id="e3297-192">Why?</span></span>

<span data-ttu-id="e3297-193">Odp **.:** W przypadku korzystania z powiązania integracji usługi MSMQ należy użyć schematu MSMQ. formatname.</span><span class="sxs-lookup"><span data-stu-id="e3297-193">**A:** When you use the MSMQ integration binding, you must use the msmq.formatname scheme.</span></span> <span data-ttu-id="e3297-194">Na przykład MSMQ. formatname: DIRECT = OS: .\private $ \OrdersQueue.</span><span class="sxs-lookup"><span data-stu-id="e3297-194">For example, msmq.formatname:DIRECT=OS:.\private$\OrdersQueue.</span></span> <span data-ttu-id="e3297-195">Ale w przypadku określenia niestandardowej kolejki utraconych wiadomości należy użyć schematu net. MSMQ.</span><span class="sxs-lookup"><span data-stu-id="e3297-195">But when you specify the custom dead-letter queue, you must use the net.msmq scheme.</span></span>

<span data-ttu-id="e3297-196">**P:** Gdy używam nazwy formatu publicznego lub prywatnego i otworzysz hosta usługi w systemie Windows Vista, pojawia się błąd.</span><span class="sxs-lookup"><span data-stu-id="e3297-196">**Q:** When I use a public or private format name and open the service host on Windows Vista, I get an error.</span></span> <span data-ttu-id="e3297-197">Dlaczego?</span><span class="sxs-lookup"><span data-stu-id="e3297-197">Why?</span></span>

<span data-ttu-id="e3297-198">Odp **.:** Kanał integracji WCF w systemie Windows Vista sprawdza, czy podkolejka może być otwarta dla kolejki aplikacji głównej w celu obsługi skażonych komunikatów.</span><span class="sxs-lookup"><span data-stu-id="e3297-198">**A:** The WCF integration channel on Windows Vista checks to see if a sub-queue can be opened for the main application queue for handling poison messages.</span></span> <span data-ttu-id="e3297-199">Nazwa kolejki podrzędnej pochodzi od identyfikatora URI MSMQ. formatname przesłanego do odbiornika.</span><span class="sxs-lookup"><span data-stu-id="e3297-199">The sub-queue name is derived from an msmq.formatname URI passed to the listener.</span></span> <span data-ttu-id="e3297-200">Nazwa kolejki podrzędnej w usłudze MSMQ może być tylko nazwą formatu bezpośredniego.</span><span class="sxs-lookup"><span data-stu-id="e3297-200">The sub-queue name in MSMQ can only be a direct format name.</span></span> <span data-ttu-id="e3297-201">Zostanie wyświetlony komunikat o błędzie.</span><span class="sxs-lookup"><span data-stu-id="e3297-201">So you see the error.</span></span> <span data-ttu-id="e3297-202">Zmień identyfikator URI kolejki na nazwę formatu bezpośredniego.</span><span class="sxs-lookup"><span data-stu-id="e3297-202">Change the queue URI to a direct format name.</span></span>

<span data-ttu-id="e3297-203">**P:** W przypadku odebrania komunikatu z aplikacji MSMQ komunikat znajduje się w kolejce i nie jest odczytywany przez odebraną aplikację WCF.</span><span class="sxs-lookup"><span data-stu-id="e3297-203">**Q:** When receiving a message from an MSMQ application, the message sits in the queue and is not read by the receiving WCF application.</span></span> <span data-ttu-id="e3297-204">Dlaczego?</span><span class="sxs-lookup"><span data-stu-id="e3297-204">Why?</span></span>

<span data-ttu-id="e3297-205">Odp **.:** Sprawdź, czy komunikat ma treść.</span><span class="sxs-lookup"><span data-stu-id="e3297-205">**A:** Check to see whether the message has a body.</span></span> <span data-ttu-id="e3297-206">Jeśli komunikat nie ma treści, kanał integracji usługi MSMQ zignoruje komunikat.</span><span class="sxs-lookup"><span data-stu-id="e3297-206">If the message has no body, the MSMQ integration channel ignores the message.</span></span> <span data-ttu-id="e3297-207">Zaimplementuj `IErrorHandler`, aby otrzymywać powiadomienia o wyjątkach i sprawdź dane śledzenia.</span><span class="sxs-lookup"><span data-stu-id="e3297-207">Implement `IErrorHandler` to be notified of exceptions and check the traces.</span></span>

### <a name="security-related-troubleshooting"></a><span data-ttu-id="e3297-208">Rozwiązywanie problemów związanych z zabezpieczeniami</span><span class="sxs-lookup"><span data-stu-id="e3297-208">Security-Related Troubleshooting</span></span>

<span data-ttu-id="e3297-209">**P:** Gdy uruchamiam przykład, który używa domyślnego powiązania w trybie grupy roboczej, komunikaty pozornie są wysyłane, ale nigdy nie odbierane przez odbiornik.</span><span class="sxs-lookup"><span data-stu-id="e3297-209">**Q:** When I run the sample that uses a default binding in workgroup mode, messages seem to get sent but are never received by the receiver.</span></span>

<span data-ttu-id="e3297-210">Odp **.:** Domyślnie komunikaty są podpisane przy użyciu wewnętrznego certyfikatu usługi MSMQ, który wymaga usługi katalogowej Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e3297-210">**A:** By default, messages are signed using an MSMQ internal certificate that requires the Active Directory directory service.</span></span> <span data-ttu-id="e3297-211">W trybie grupy roboczej, ponieważ Active Directory nie jest dostępny, podpisywanie komunikatu kończy się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="e3297-211">In workgroup mode, because Active Directory is not available, signing the message fails.</span></span> <span data-ttu-id="e3297-212">W związku z tym komunikat znajduje się w kolejce utraconych wiadomości i Przyczyna niepowodzenia, na przykład "zła sygnatura".</span><span class="sxs-lookup"><span data-stu-id="e3297-212">So the message lands in the dead-letter queue and failure cause, such as "Bad signature", is indicated.</span></span>

<span data-ttu-id="e3297-213">Obejście polega na wyłączeniu zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="e3297-213">The workaround is to turn off security.</span></span> <span data-ttu-id="e3297-214">W tym celu należy ustawić <xref:System.ServiceModel.NetMsmqSecurity.Mode%2A> = <xref:System.ServiceModel.NetMsmqSecurityMode.None>, aby działał on w trybie grupy roboczej.</span><span class="sxs-lookup"><span data-stu-id="e3297-214">This is done by setting <xref:System.ServiceModel.NetMsmqSecurity.Mode%2A> = <xref:System.ServiceModel.NetMsmqSecurityMode.None> to make it work in workgroup mode.</span></span>

<span data-ttu-id="e3297-215">Innym obejściem jest uzyskanie <xref:System.ServiceModel.MsmqTransportSecurity> ze właściwości <xref:System.ServiceModel.NetMsmqSecurity.Transport%2A> i ustawienie go na <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate>i ustawienie certyfikatu klienta.</span><span class="sxs-lookup"><span data-stu-id="e3297-215">Another workaround is to get the <xref:System.ServiceModel.MsmqTransportSecurity> from the <xref:System.ServiceModel.NetMsmqSecurity.Transport%2A> property and set it to <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate>, and set the client certificate.</span></span>

<span data-ttu-id="e3297-216">Jeszcze inne obejście polega na zainstalowaniu usługi MSMQ z integracją Active Directory.</span><span class="sxs-lookup"><span data-stu-id="e3297-216">Yet another workaround is to install MSMQ with Active Directory integration.</span></span>

<span data-ttu-id="e3297-217">**P:** Gdy wysyłam komunikat z domyślnym powiązaniem (włączone zabezpieczenia transportu) w Active Directory do kolejki, otrzymuję komunikat "nie znaleziono certyfikatu wewnętrznego".</span><span class="sxs-lookup"><span data-stu-id="e3297-217">**Q:** When I send a message with default binding (transport security turned on) in Active Directory to a queue, I get an "internal certificate not found" message.</span></span> <span data-ttu-id="e3297-218">Jak mogę rozwiązać ten problem?</span><span class="sxs-lookup"><span data-stu-id="e3297-218">How do I fix this?</span></span>

<span data-ttu-id="e3297-219">Odp **.:** Oznacza to, że należy odnowić certyfikat w Active Directory dla nadawcy.</span><span class="sxs-lookup"><span data-stu-id="e3297-219">**A:** This means that the certificate in Active Directory for the sender must be renewed.</span></span> <span data-ttu-id="e3297-220">W tym celu Otwórz **Panel sterowania**, **Narzędzia administracyjne**, **Zarządzanie komputerem**, kliknij prawym przyciskiem myszy pozycję **MSMQ**i wybierz pozycję **Właściwości**.</span><span class="sxs-lookup"><span data-stu-id="e3297-220">To do so, open **Control Panel**, **Administrative Tools**, **Computer Management**, right-click **MSMQ**, and select **Properties**.</span></span> <span data-ttu-id="e3297-221">Wybierz kartę **certyfikat użytkownika** , a następnie kliknij przycisk **Odnów** .</span><span class="sxs-lookup"><span data-stu-id="e3297-221">Select the **User Certificate** tab and click the **Renew** button.</span></span>

<span data-ttu-id="e3297-222">**P:** Gdy wyślę komunikat przy użyciu <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate> i określisz certyfikat do użycia, otrzymuję komunikat o nieprawidłowym certyfikacie.</span><span class="sxs-lookup"><span data-stu-id="e3297-222">**Q:** When I send a message using <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate> and specify the certificate to use, I get an "Invalid certificate" message.</span></span> <span data-ttu-id="e3297-223">Jak mogę rozwiązać ten problem?</span><span class="sxs-lookup"><span data-stu-id="e3297-223">How do I fix this?</span></span>

<span data-ttu-id="e3297-224">Odp **.:** Nie można użyć magazynu certyfikatów komputera lokalnego z trybem certyfikatu.</span><span class="sxs-lookup"><span data-stu-id="e3297-224">**A:** You cannot use a local machine certificate store with certificate mode.</span></span> <span data-ttu-id="e3297-225">Należy skopiować certyfikat z magazynu certyfikatów komputera do bieżącego magazynu użytkowników przy użyciu przystawki certyfikat.</span><span class="sxs-lookup"><span data-stu-id="e3297-225">You have to copy the certificate from the machine certificate store to the current user store using the Certificate snap-in.</span></span> <span data-ttu-id="e3297-226">Aby uzyskać przystawkę certyfikatu:</span><span class="sxs-lookup"><span data-stu-id="e3297-226">To get the Certificate snap-in:</span></span>

1. <span data-ttu-id="e3297-227">Kliknij przycisk **Start**, wybierz polecenie **uruchom**, wpisz `mmc`i kliknij przycisk **OK**.</span><span class="sxs-lookup"><span data-stu-id="e3297-227">Click **Start**, select **Run**, type `mmc`, and click **OK**.</span></span>

2. <span data-ttu-id="e3297-228">W programie **Microsoft Management Console**Otwórz menu **plik** i wybierz polecenie **Dodaj/Usuń przystawkę**.</span><span class="sxs-lookup"><span data-stu-id="e3297-228">In the **Microsoft Management Console**, open the **File** menu and select **Add/Remove Snap-in**.</span></span>

3. <span data-ttu-id="e3297-229">W oknie dialogowym **Dodaj/Usuń przystawkę** kliknij przycisk **Dodaj** .</span><span class="sxs-lookup"><span data-stu-id="e3297-229">In the **Add/Remove Snap-in** dialog box, click the **Add** button.</span></span>

4. <span data-ttu-id="e3297-230">W oknie dialogowym **Dodaj autonomiczną przystawkę** wybierz pozycję Certyfikaty, a następnie kliknij przycisk **Dodaj**.</span><span class="sxs-lookup"><span data-stu-id="e3297-230">In the **Add Standalone Snap-in** dialog box, select Certificates and click **Add**.</span></span>

5. <span data-ttu-id="e3297-231">W oknie dialogowym Przystawka **certyfikatów** wybierz pozycję **Moje konto użytkownika,** a następnie kliknij przycisk **Zakończ**.</span><span class="sxs-lookup"><span data-stu-id="e3297-231">In the **Certificates** snap-in dialog box, select **My user account,** and click **Finish**.</span></span>

6. <span data-ttu-id="e3297-232">Następnie Dodaj drugą przystawkę Certyfikaty przy użyciu poprzednich kroków, ale tym razem wybierz pozycję **konto komputera** i kliknij przycisk **dalej**.</span><span class="sxs-lookup"><span data-stu-id="e3297-232">Next, add a second Certificates snap-in using the previous steps, but this time select **Computer account** and click **Next**.</span></span>

7. <span data-ttu-id="e3297-233">Wybierz pozycję **komputer lokalny** i kliknij przycisk **Zakończ**.</span><span class="sxs-lookup"><span data-stu-id="e3297-233">Select **Local Computer** and click **Finish**.</span></span> <span data-ttu-id="e3297-234">Teraz możesz przeciągać i upuszczać certyfikaty z magazynu certyfikatów komputera do bieżącego magazynu użytkownika.</span><span class="sxs-lookup"><span data-stu-id="e3297-234">You can now drag and drop certificates from the machine certificate store to the current user store.</span></span>

<span data-ttu-id="e3297-235">**P:** Gdy Usługa My odczytuje z kolejki na innym komputerze w trybie grupy roboczej, otrzymuję wyjątek "odmowa dostępu".</span><span class="sxs-lookup"><span data-stu-id="e3297-235">**Q:** When my service reads from a queue on another computer in workgroup mode, I get an "access denied" exception.</span></span>

<span data-ttu-id="e3297-236">Odp **.:** W trybie grupy roboczej dla aplikacji zdalnej, aby uzyskać dostęp do kolejki, aplikacja musi mieć uprawnienia dostępu do kolejki.</span><span class="sxs-lookup"><span data-stu-id="e3297-236">**A:** In workgroup mode, for a remote application to gain access to the queue, the application must have permission to access the queue.</span></span> <span data-ttu-id="e3297-237">Dodaj "Logowanie anonimowe" do listy kontroli dostępu (ACL) kolejki i nadaj im uprawnienie do odczytu.</span><span class="sxs-lookup"><span data-stu-id="e3297-237">Add "Anonymous login" to the queue's access control list (ACL) and give it read permission.</span></span>

<span data-ttu-id="e3297-238">**P:** Gdy klient usługi sieciowej (lub dowolny klient, który nie ma konta domeny) wysyła komunikat w kolejce, wysyłanie kończy się niepowodzeniem z nieprawidłowym certyfikatem.</span><span class="sxs-lookup"><span data-stu-id="e3297-238">**Q:** When a network service client (or any client that does not have a domain account) sends a queued message, the send fails with an invalid certificate.</span></span> <span data-ttu-id="e3297-239">Jak mogę rozwiązać ten problem?</span><span class="sxs-lookup"><span data-stu-id="e3297-239">How do I fix this?</span></span>

<span data-ttu-id="e3297-240">Odp **.:** Sprawdź konfigurację powiązania.</span><span class="sxs-lookup"><span data-stu-id="e3297-240">**A:** Check the binding configuration.</span></span> <span data-ttu-id="e3297-241">Domyślne powiązanie ma włączone zabezpieczenia transportu usługi MSMQ w celu podpisania wiadomości.</span><span class="sxs-lookup"><span data-stu-id="e3297-241">The default binding has MSMQ transport security turned on to sign the message.</span></span> <span data-ttu-id="e3297-242">Go wyłączyć.</span><span class="sxs-lookup"><span data-stu-id="e3297-242">Turn it off.</span></span>

### <a name="remote-transacted-receives"></a><span data-ttu-id="e3297-243">Zdalne odbierane odbiory</span><span class="sxs-lookup"><span data-stu-id="e3297-243">Remote Transacted Receives</span></span>

<span data-ttu-id="e3297-244">**P:** Jeśli mam kolejkę na maszynie A, a usługa WCF, która odczytuje komunikaty z kolejki na komputerze B (zdalnie zrealizowany scenariusz odbierania), wiadomości nie są odczytywane z kolejki.</span><span class="sxs-lookup"><span data-stu-id="e3297-244">**Q:** When I have a queue on machine A, and a WCF service that reads messages from a queue on machine B (the remote transacted receive scenario), messages are not read from the queue.</span></span> <span data-ttu-id="e3297-245">Śledzenie informacji wskazuje, że odbieranie nie powiodło się z komunikatem "nie można zaimportować transakcji".</span><span class="sxs-lookup"><span data-stu-id="e3297-245">Tracing information indicates the receive failed with the message "Transaction cannot be imported."</span></span> <span data-ttu-id="e3297-246">Co mogę zrobić, aby rozwiązać ten problem?</span><span class="sxs-lookup"><span data-stu-id="e3297-246">What can I do to fix this?</span></span>

<span data-ttu-id="e3297-247">Odp **.:** Istnieją trzy możliwe przyczyny tego:</span><span class="sxs-lookup"><span data-stu-id="e3297-247">**A:** There are three possible reasons for this:</span></span>

- <span data-ttu-id="e3297-248">W trybie domeny zdalne odbieranie transakcyjne wymaga dostępu do sieci firmy Microsoft Distributed Transaction Coordinator (MSDTC).</span><span class="sxs-lookup"><span data-stu-id="e3297-248">If you are in domain mode, remote transacted receive requires Microsoft Distributed Transaction Coordinator (MSDTC) network access.</span></span> <span data-ttu-id="e3297-249">Możesz włączyć tę funkcję przy użyciu opcji **Dodaj/Usuń składniki**.</span><span class="sxs-lookup"><span data-stu-id="e3297-249">You can enable this using **Add/Remove Components**.</span></span>

  ![Zrzut ekranu pokazujący Włączanie dostępu do usługi DTC przez sieć.](./media/troubleshooting-queued-messaging/enable-distributed-transaction-coordinator-access.jpg)

- <span data-ttu-id="e3297-251">Sprawdź tryb uwierzytelniania, aby komunikować się z menedżerem transakcji.</span><span class="sxs-lookup"><span data-stu-id="e3297-251">Check the authentication mode for communicating with the transaction manager.</span></span> <span data-ttu-id="e3297-252">Jeśli jesteś w trybie grupy roboczej, należy wybrać opcję "nie jest wymagane uwierzytelnienie".</span><span class="sxs-lookup"><span data-stu-id="e3297-252">If you are in workgroup mode, "No Authentication Required" must be selected.</span></span> <span data-ttu-id="e3297-253">Jeśli jesteś w trybie domeny, należy wybrać opcję "wymagane uwierzytelnianie wzajemne.</span><span class="sxs-lookup"><span data-stu-id="e3297-253">If you are in domain mode, then "Mutual Authentication Required" must be selected.</span></span>

  <span data-ttu-id="e3297-254">![Włączanie transakcji XA](../../../../docs/framework/wcf/feature-details/media/4f3695e0-fb0b-4c5b-afac-75f8860d2bb0.jpg "4f3695e0-fb0b-4c5b-afac-75f8860d2bb0")</span><span class="sxs-lookup"><span data-stu-id="e3297-254">![Enabling XA transactions](../../../../docs/framework/wcf/feature-details/media/4f3695e0-fb0b-4c5b-afac-75f8860d2bb0.jpg "4f3695e0-fb0b-4c5b-afac-75f8860d2bb0")</span></span>

- <span data-ttu-id="e3297-255">Upewnij się, że usługa MSDTC znajduje się na liście wyjątków w ustawieniach **zapory połączenia internetowego** .</span><span class="sxs-lookup"><span data-stu-id="e3297-255">Make sure that MSDTC is in the list of exceptions in the **Internet Connection Firewall** settings.</span></span>

- <span data-ttu-id="e3297-256">Upewnij się, że korzystasz z systemu Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="e3297-256">Ensure that you are using Windows Vista.</span></span> <span data-ttu-id="e3297-257">Usługa MSMQ w systemie Windows Vista obsługuje zdalnie odczytywanie transakcyjne.</span><span class="sxs-lookup"><span data-stu-id="e3297-257">MSMQ on Windows Vista supports remote transacted read.</span></span> <span data-ttu-id="e3297-258">Usługa MSMQ w starszych wersjach systemu Windows nie obsługuje zdalnej operacji odczytu.</span><span class="sxs-lookup"><span data-stu-id="e3297-258">MSMQ on earlier Windows releases does not support remote transacted read.</span></span>

<span data-ttu-id="e3297-259">**P:** Gdy usługa jest odczytywana z kolejki usługi sieciowej, na przykład w hoście sieci Web, Dlaczego otrzymuję wyjątek odmowy dostępu w przypadku odczytu z kolejki?</span><span class="sxs-lookup"><span data-stu-id="e3297-259">**Q:** When the service reading from the queue is a network service, for example, in a Web host, why do I get an access-denied exception is raised when reading from the queue?</span></span>

<span data-ttu-id="e3297-260">Odp **.:** Dostęp do odczytu usługi sieciowej należy dodać do listy ACL kolejki, aby upewnić się, że usługa sieciowa może odczytywać dane z kolejki.</span><span class="sxs-lookup"><span data-stu-id="e3297-260">**A:** Network service read access must be added to the queue ACL to ensure that a network service can read from the queue.</span></span>

<span data-ttu-id="e3297-261">**P:** Czy mogę użyć usługi aktywacji usługi MSMQ w celu aktywowania aplikacji na podstawie komunikatów w kolejce na maszynie zdalnej?</span><span class="sxs-lookup"><span data-stu-id="e3297-261">**Q:** Can I use the MSMQ activation service to activate applications based on messages in a queue on a remote machine?</span></span>

<span data-ttu-id="e3297-262">**Odpowiedź:** tak.</span><span class="sxs-lookup"><span data-stu-id="e3297-262">**A:** Yes.</span></span> <span data-ttu-id="e3297-263">W tym celu należy skonfigurować usługę aktywacji usługi MSMQ do uruchamiania jako usługa sieciowa i dodać do kolejki dostęp do usługi sieciowej na maszynie zdalnej.</span><span class="sxs-lookup"><span data-stu-id="e3297-263">To do this, you must configure the MSMQ activation service to run as a network service, and add network service access to the queue on the remote machine.</span></span>

## <a name="using-custom-msmq-bindings-with-receivecontext-enabled"></a><span data-ttu-id="e3297-264">Używanie niestandardowych powiązań usługi MSMQ z włączonym użyciem funkcji ReceiveContext</span><span class="sxs-lookup"><span data-stu-id="e3297-264">Using Custom MSMQ Bindings with ReceiveContext Enabled</span></span>

<span data-ttu-id="e3297-265">W przypadku używania niestandardowego powiązania usługi MSMQ z <xref:System.ServiceModel.Channels.ReceiveContext> włączonym przetwarzaniem komunikat przychodzący będzie używał wątku puli wątków, ponieważ natywna usługa MSMQ nie obsługuje kończenia operacji we/wy dla odbieranych <xref:System.ServiceModel.Channels.ReceiveContext> asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="e3297-265">When using a custom MSMQ binding with <xref:System.ServiceModel.Channels.ReceiveContext> enabled processing an incoming message will use a thread pool thread because native MSMQ does not support I/O completion for asynchronous <xref:System.ServiceModel.Channels.ReceiveContext> receives.</span></span> <span data-ttu-id="e3297-266">Wynika to z faktu, że przetwarzanie takich komunikatów używa transakcji wewnętrznych dla <xref:System.ServiceModel.Channels.ReceiveContext>, a usługa MSMQ nie obsługuje przetwarzania asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="e3297-266">This is because processing such a message uses internal transactions for <xref:System.ServiceModel.Channels.ReceiveContext> and MSMQ does not support asynchronous processing.</span></span> <span data-ttu-id="e3297-267">Aby obejść ten problem, można dodać <xref:System.ServiceModel.Description.SynchronousReceiveBehavior> do punktu końcowego w celu wymuszenia przetwarzania synchronicznego lub ustawienia <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.MaxPendingReceives%2A> na 1.</span><span class="sxs-lookup"><span data-stu-id="e3297-267">To work around this issue you can add a <xref:System.ServiceModel.Description.SynchronousReceiveBehavior> to the endpoint to force synchronous processing or set <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.MaxPendingReceives%2A> to 1.</span></span>
