---
title: Protokół wymiany kontekstu
ms.date: 03/30/2017
ms.assetid: 3dfd38e0-ae52-491c-94f4-7a862b9843d4
ms.openlocfilehash: a6bc0ac45282d94a6aea8dbbdb5a7d34163c692e
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/23/2019
ms.locfileid: "61857353"
---
# <a name="context-exchange-protocol"></a><span data-ttu-id="98df2-102">Protokół wymiany kontekstu</span><span class="sxs-lookup"><span data-stu-id="98df2-102">Context Exchange Protocol</span></span>
<span data-ttu-id="98df2-103">W tej sekcji opisano protokół wymiany kontekstu, które są wprowadzone w programie Windows Communication Foundation (WCF) w wersji .NET Framework w wersji 3.5.</span><span class="sxs-lookup"><span data-stu-id="98df2-103">This section describes the context exchange protocol introduced in Windows Communication Foundation (WCF) release .NET Framework version 3.5.</span></span> <span data-ttu-id="98df2-104">Ten protokół umożliwia kanału klienta akceptować kontekst dostarczonych przez usługę i zastosować je do wszystkich kolejnych żądań wysyłanych za pośrednictwem tego samego wystąpienia kanału klienta usługi.</span><span class="sxs-lookup"><span data-stu-id="98df2-104">This protocol allows the client channel to accept a context supplied by a service and apply it to all subsequent requests to that service sent over the same client channel instance.</span></span> <span data-ttu-id="98df2-105">Implementacja protokół wymiany kontekstu, można użyć jednej z dwóch następujących mechanizmów propagowanie kontekstu między serwerem a klientem: Pliki cookie protokołu HTTP lub nagłówek SOAP.</span><span class="sxs-lookup"><span data-stu-id="98df2-105">The implementation of the context exchange protocol can use one of the following two mechanisms to propagate the context between the server and the client: HTTP cookies or a SOAP header.</span></span>  
  
 <span data-ttu-id="98df2-106">Protokół wymiany kontekstu jest zaimplementowana w niestandardowym kanale warstwy.</span><span class="sxs-lookup"><span data-stu-id="98df2-106">The context exchange protocol is implemented in a custom channel layer.</span></span> <span data-ttu-id="98df2-107">Kanał komunikuje się kontekstu do i z warstwy aplikacji przy użyciu <xref:System.ServiceModel.Channels.ContextMessageProperty> właściwości.</span><span class="sxs-lookup"><span data-stu-id="98df2-107">The channel communicates the context to and from the application layer using a <xref:System.ServiceModel.Channels.ContextMessageProperty> property.</span></span> <span data-ttu-id="98df2-108">Dla transmisji między punktami końcowymi wartość kontekstu jest serializowana jako nagłówek SOAP w warstwie kanału albo konwertowana do lub z właściwości komunikatu, które reprezentują żądania HTTP i odpowiedzi.</span><span class="sxs-lookup"><span data-stu-id="98df2-108">For transmission between endpoints, the value of the context is either serialized as a SOAP header at the channel layer, or converted to or from the message properties that represent a HTTP request and response.</span></span> <span data-ttu-id="98df2-109">W tym ostatnim przypadku oczekuje się, że jeden z niższych warstwach kanału konwertuje właściwości komunikatów żądań i odpowiedzi HTTP do i z plików cookie protokołu HTTP, odpowiednio.</span><span class="sxs-lookup"><span data-stu-id="98df2-109">In the latter case, it is expected that one of the underlying channel layers converts the HTTP request and response message properties to and from HTTP cookies, respectively.</span></span> <span data-ttu-id="98df2-110">Wybór mechanizm używany do wymiany kontekstu jest wykonywane przy użyciu <xref:System.ServiceModel.Channels.ContextExchangeMechanism> właściwość <xref:System.ServiceModel.Channels.ContextBindingElement>.</span><span class="sxs-lookup"><span data-stu-id="98df2-110">The choice of the mechanism used to exchange the context is done using the <xref:System.ServiceModel.Channels.ContextExchangeMechanism> property on the <xref:System.ServiceModel.Channels.ContextBindingElement>.</span></span> <span data-ttu-id="98df2-111">Prawidłowe wartości to `HttpCookie` lub `SoapHeader`.</span><span class="sxs-lookup"><span data-stu-id="98df2-111">Valid values are `HttpCookie` or `SoapHeader`.</span></span>  
  
 <span data-ttu-id="98df2-112">Na komputerze klienckim, wystąpienie kanału może działać w dwóch trybach zgodnie z ustawieniami właściwości kanału <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A>.</span><span class="sxs-lookup"><span data-stu-id="98df2-112">On the client, an instance of a channel can operate in two modes based on the settings on the channel property, <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A>.</span></span>  
  
## <a name="mode-1-channel-context-management"></a><span data-ttu-id="98df2-113">Tryb 1: Kanał zarządzania kontekstem</span><span class="sxs-lookup"><span data-stu-id="98df2-113">Mode 1: Channel Context Management</span></span>  
 <span data-ttu-id="98df2-114">Jest to domyślny tryb gdzie <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> ustawiono `true`.</span><span class="sxs-lookup"><span data-stu-id="98df2-114">This is the default mode where <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> is set to `true`.</span></span> <span data-ttu-id="98df2-115">W tym trybie kanał kontekstu zarządza kontekstu i zapisuje w jego okres istnienia pamięci podręcznej kontekstu.</span><span class="sxs-lookup"><span data-stu-id="98df2-115">In this mode the context channel manages the context and caches the context during its lifetime.</span></span> <span data-ttu-id="98df2-116">Z kanału za pomocą właściwości kanału można pobrać kontekstu `IContextManager` przez wywołanie metody `GetContext` metody.</span><span class="sxs-lookup"><span data-stu-id="98df2-116">Context can be retrieved from the channel through channel property `IContextManager` by calling the `GetContext` method.</span></span> <span data-ttu-id="98df2-117">Kanał można również wstępnie zainicjowana przy użyciu określonego kontekstu przed otwierana, wywołując `SetContext` metody właściwości kanału.</span><span class="sxs-lookup"><span data-stu-id="98df2-117">The channel can also be pre-initialized with specific context before being opened by calling the `SetContext` method on the channel property.</span></span> <span data-ttu-id="98df2-118">Gdy kanał jest inicjowany z kontekstem nie można zresetować.</span><span class="sxs-lookup"><span data-stu-id="98df2-118">Once the channel is initialized with context it cannot be reset.</span></span>  
  
 <span data-ttu-id="98df2-119">Oto lista invariants w tym trybie:</span><span class="sxs-lookup"><span data-stu-id="98df2-119">The following is a list of invariants in this mode:</span></span>  
  
- <span data-ttu-id="98df2-120">Dowolne próba zresetowania przy użyciu kontekstu `SetContext` po zgłasza otwarty kanał <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="98df2-120">Any attempt to reset the context using `SetContext` after the channel has been opened throws an <xref:System.InvalidOperationException>.</span></span>  
  
- <span data-ttu-id="98df2-121">Dowolne próba wysłania kontekstu przy użyciu <xref:System.ServiceModel.Channels.ContextMessageProperty> w wychodzących wiadomościach zgłasza <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="98df2-121">Any attempt to send context by using the <xref:System.ServiceModel.Channels.ContextMessageProperty> in an outgoing message throws an <xref:System.InvalidOperationException>.</span></span>  
  
- <span data-ttu-id="98df2-122">Gdy wiadomość zostaje odebrana od serwera przy użyciu określonego kontekstu, gdy kanał został już zainicjowany przy użyciu określonego kontekstu, powoduje to <xref:System.ServiceModel.ProtocolException>.</span><span class="sxs-lookup"><span data-stu-id="98df2-122">If a message is received from server with a specific context, when the channel has already been initialized with a specific context, this results in a <xref:System.ServiceModel.ProtocolException>.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="98df2-123">Jest otrzymywać początkowej kontekstu z serwera, tylko wtedy, gdy kanał zostanie otwarty bez żadnego kontekstu ustawiony w sposób jawny.</span><span class="sxs-lookup"><span data-stu-id="98df2-123">It is appropriate to receive an initial context from the server only if the channel is opened without any context set explicitly.</span></span>  
  
- <span data-ttu-id="98df2-124"><xref:System.ServiceModel.Channels.ContextMessageProperty> Na przychodzący komunikat jest zawsze wartość null.</span><span class="sxs-lookup"><span data-stu-id="98df2-124">The <xref:System.ServiceModel.Channels.ContextMessageProperty> on incoming message is always null.</span></span>  
  
## <a name="mode-2-application-context-management"></a><span data-ttu-id="98df2-125">Tryb 2: Zarządzanie kontekstem aplikacji</span><span class="sxs-lookup"><span data-stu-id="98df2-125">Mode 2: Application Context Management</span></span>  
 <span data-ttu-id="98df2-126">Jest to tryb podczas <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> ustawiono `false`.</span><span class="sxs-lookup"><span data-stu-id="98df2-126">This is the mode when <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> is set to `false`.</span></span> <span data-ttu-id="98df2-127">W tym trybie kanał kontekstu nie zarządza kontekstu.</span><span class="sxs-lookup"><span data-stu-id="98df2-127">In this mode the context channel does not manage context.</span></span> <span data-ttu-id="98df2-128">Odpowiada za aplikację do pobrania, zarządzania i zastosować kontekst za pomocą <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span><span class="sxs-lookup"><span data-stu-id="98df2-128">It is the application's responsibility to retrieve, manage and apply context by using the <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span></span> <span data-ttu-id="98df2-129">Dowolne próba wywołania `GetContext` lub `SetContext` skutkuje <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="98df2-129">Any attempt to call `GetContext` or `SetContext` results in an <xref:System.InvalidOperationException>.</span></span>  
  
 <span data-ttu-id="98df2-130">Niezależnie od tego trybu jest wybierany fabryki kanałów klienta obsługuje <xref:System.ServiceModel.Channels.IRequestChannel>, <xref:System.ServiceModel.Channels.IRequestSessionChannel>, i <xref:System.ServiceModel.Channels.IDuplexSessionChannel> komunikatu wzorców programu exchange.</span><span class="sxs-lookup"><span data-stu-id="98df2-130">No matter which mode is chosen the client channel factory supports <xref:System.ServiceModel.Channels.IRequestChannel>, <xref:System.ServiceModel.Channels.IRequestSessionChannel>, and <xref:System.ServiceModel.Channels.IDuplexSessionChannel> message exchange patterns.</span></span>  
  
 <span data-ttu-id="98df2-131">W usłudze jest odpowiedzialny za kontekstu dostarczonych przez klienta na komunikaty przychodzące do konwertowania wystąpienia kanału <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span><span class="sxs-lookup"><span data-stu-id="98df2-131">On the service, an instance of the channel is responsible for converting the context supplied by the client on incoming messages to the <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span></span> <span data-ttu-id="98df2-132">Właściwość wiadomości mogą następnie dostęp do warstwy aplikacji lub innych kanałów dalsze się w stosie wywołań.</span><span class="sxs-lookup"><span data-stu-id="98df2-132">The message property can then be accessed by the application layer or other channels further up in the call stack.</span></span> <span data-ttu-id="98df2-133">Kanały usługi również zezwolić na użycie warstwy aplikacji, aby określić nową wartość kontekstu do jest propagowany z powrotem do klienta przez dołączenie <xref:System.ServiceModel.Channels.ContextMessageProperty> komunikat odpowiedzi.</span><span class="sxs-lookup"><span data-stu-id="98df2-133">The service channels also allow the application layer to specify a new context value to be propagated back to the client by attaching a <xref:System.ServiceModel.Channels.ContextMessageProperty> to the response message.</span></span> <span data-ttu-id="98df2-134">Ta właściwość jest konwertowana na nagłówek SOAP lub pliku cookie HTTP, który zawiera kontekst, który zależy od konfiguracji powiązania.</span><span class="sxs-lookup"><span data-stu-id="98df2-134">This property is converted to the SOAP header or HTTP cookie that contains the context, which depends on the configuration of the binding.</span></span> <span data-ttu-id="98df2-135">Usługa obsługuje odbiornika kanału <xref:System.ServiceModel.Channels.IReplyChannel>, <xref:System.ServiceModel.Channels.IReplySessionChannel>, i <xref:System.ServiceModel.Channels.IReplySessionChannel> komunikatu wzorców programu exchange.</span><span class="sxs-lookup"><span data-stu-id="98df2-135">The service channel listener supports <xref:System.ServiceModel.Channels.IReplyChannel>, <xref:System.ServiceModel.Channels.IReplySessionChannel>, and <xref:System.ServiceModel.Channels.IReplySessionChannel> message exchange patterns.</span></span>  
  
 <span data-ttu-id="98df2-136">Protokół wymiany kontekstu wprowadzono nowy `wsc:Context` nagłówek SOAP reprezentujący informacje o kontekście podczas plików cookie protokołu HTTP nie są używane do propagowania kontekstu.</span><span class="sxs-lookup"><span data-stu-id="98df2-136">The context exchange protocol introduces a new `wsc:Context` SOAP header to represent the context information when HTTP cookies are not used to propagate the context.</span></span> <span data-ttu-id="98df2-137">Schemat nagłówka kontekst zezwala na dowolną liczbę elementów podrzędnych, każdy z klucza typu ciąg i zawartość ciągu.</span><span class="sxs-lookup"><span data-stu-id="98df2-137">The context header schema allows for any number of child elements, each with a string key and string content.</span></span> <span data-ttu-id="98df2-138">Oto przykład nagłówka kontekstu.</span><span class="sxs-lookup"><span data-stu-id="98df2-138">The following is an example of a context header.</span></span>  
  
 `<Context xmlns="http://schemas.microsoft.com/ws/2006/05/context">`  
  
 `<property name="myContext">context-2</property>`  
  
 `</Context>`  
  
 <span data-ttu-id="98df2-139">W `HttpCookie` trybu plików cookie są ustawiane przy użyciu `SetCookie` nagłówka.</span><span class="sxs-lookup"><span data-stu-id="98df2-139">When in `HttpCookie` mode, cookies are set using the `SetCookie` header.</span></span> <span data-ttu-id="98df2-140">Nazwa pliku cookie jest `WscContext`.</span><span class="sxs-lookup"><span data-stu-id="98df2-140">The cookie name is `WscContext`.</span></span> <span data-ttu-id="98df2-141">Wartość pliku cookie jest Base64 kodowanie `wsc:Context` nagłówka.</span><span class="sxs-lookup"><span data-stu-id="98df2-141">The value of the cookie is the Base64 encoding of the `wsc:Context` header.</span></span> <span data-ttu-id="98df2-142">Ta wartość jest ujęty w cudzysłów.</span><span class="sxs-lookup"><span data-stu-id="98df2-142">This value is enclosed in quotes.</span></span>  
  
 <span data-ttu-id="98df2-143">Wartość kontekstu muszą być chronione przed modyfikacjami, podczas przesyłania z tego samego powodu nagłówków WS-Addressing są chronione — nagłówek służy do określania miejsca możesz wysyłać żądania do usługi.</span><span class="sxs-lookup"><span data-stu-id="98df2-143">The value of the context must be protected from modification while in transit for the same reason WS-Addressing headers are protected – the header is used to determine where to dispatch the request to on the service.</span></span> <span data-ttu-id="98df2-144">`wsc:Context` Nagłówek w związku z tym jest wymagany cyfrowo podpisane lub podpisane i szyfrowane na poziomie protokołu SOAP lub transportu, gdy powiązanie oferuje możliwości ochrony wiadomości.</span><span class="sxs-lookup"><span data-stu-id="98df2-144">The `wsc:Context` header is therefore required to be digitally signed or signed and encrypted at either the SOAP or transport level when the binding offers message protection capability.</span></span> <span data-ttu-id="98df2-145">W przypadku używania plików cookie protokołu HTTP do propagowania kontekstu one powinny być chronione za pomocą zabezpieczeń transportu.</span><span class="sxs-lookup"><span data-stu-id="98df2-145">When HTTP cookies are used to propagate context, they should be protected using transport security.</span></span>  
  
 <span data-ttu-id="98df2-146">Punkty końcowe usługi, które wymagają obsługi protokół wymiany kontekstu można tworzyć i jawne w opublikowanych zasad.</span><span class="sxs-lookup"><span data-stu-id="98df2-146">Service endpoints that require support for the context exchange protocol can make it explicit in the published policy.</span></span> <span data-ttu-id="98df2-147">Dwa nowe asercji zasad zostały wprowadzone do reprezentowania potrzebę klient obsługuje protokół wymiany kontekstu na poziomie protokołu SOAP lub włączyć obsługę plików cookie protokołu HTTP.</span><span class="sxs-lookup"><span data-stu-id="98df2-147">Two new policy assertions have been introduced to represent the requirement for the client to support the context exchange protocol at the SOAP level or to enable HTTP cookie support.</span></span> <span data-ttu-id="98df2-148">Generowanie tych potwierdzenia do zasad w usłudze jest kontrolowany przez wartość <xref:System.ServiceModel.Channels.ContextBindingElement.ContextExchangeMechanism%2A> właściwości w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="98df2-148">Generation of these assertions into the policy on the service is controlled by the value of the <xref:System.ServiceModel.Channels.ContextBindingElement.ContextExchangeMechanism%2A> property as follows:</span></span>  
  
- <span data-ttu-id="98df2-149">Aby uzyskać <xref:System.ServiceModel.Channels.ContextExchangeMechanism.ContextSoapHeader>, generowany jest potwierdzenie następujących:</span><span class="sxs-lookup"><span data-stu-id="98df2-149">For <xref:System.ServiceModel.Channels.ContextExchangeMechanism.ContextSoapHeader>, the following assertion is generated:</span></span>  
  
    ```xml  
    <IncludeContext   
    xmlns="http://schemas.microsoft.com/ws/2006/05/context"  
    protectionLevel="Sign" />  
    ```  
  
- <span data-ttu-id="98df2-150">Aby uzyskać <xref:System.ServiceModel.Channels.ContextExchangeMechanism.HttpCookie>, generowany jest potwierdzenie następujących:</span><span class="sxs-lookup"><span data-stu-id="98df2-150">For <xref:System.ServiceModel.Channels.ContextExchangeMechanism.HttpCookie>, the following assertion is generated:</span></span>  
  
    ```xml  
    <HttpUseCookie xmlns="http://schemas.xmlsoap.org/soap/http"/>  
    ```  
  
## <a name="see-also"></a><span data-ttu-id="98df2-151">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="98df2-151">See also</span></span>

- [<span data-ttu-id="98df2-152">Przewodnik dotyczący współpracy protokołów usług sieci Web</span><span class="sxs-lookup"><span data-stu-id="98df2-152">Web Services Protocols Interoperability Guide</span></span>](../../../../docs/framework/wcf/feature-details/web-services-protocols-interoperability-guide.md)
