---
title: 'Instrukcje: włączanie przesyłania strumieniowego'
description: Dowiedz się, jak włączyć przesyłanie strumieniowe komunikatów w programie WCF zamiast domyślnych transferów buforowanych, które muszą zostać całkowicie odebrane przed przetworzeniem.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 6ca2cf4b-c7a1-49d8-a79b-843a90556ba4
ms.openlocfilehash: 7f77c406e1cfd4def116a1abe24aa92be74c6abe
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/26/2020
ms.locfileid: "96237745"
---
# <a name="how-to-enable-streaming"></a><span data-ttu-id="e4a88-103">Instrukcje: włączanie przesyłania strumieniowego</span><span class="sxs-lookup"><span data-stu-id="e4a88-103">How to: Enable Streaming</span></span>

<span data-ttu-id="e4a88-104">Windows Communication Foundation (WCF) może wysyłać komunikaty przy użyciu buforowanych lub przesyłanych strumieniowo transferów.</span><span class="sxs-lookup"><span data-stu-id="e4a88-104">Windows Communication Foundation (WCF) can send messages using either buffered or streamed transfers.</span></span> <span data-ttu-id="e4a88-105">W domyślnym trybie transferu buforowanego komunikat musi zostać całkowicie dostarczony przed odczytaniem przez odbiorcę.</span><span class="sxs-lookup"><span data-stu-id="e4a88-105">In the default buffered-transfer mode, a message must be completely delivered before a receiver can read it.</span></span> <span data-ttu-id="e4a88-106">W trybie transferu strumieniowego odbiorca może zacząć przetwarzać komunikat, zanim zostanie on całkowicie dostarczony.</span><span class="sxs-lookup"><span data-stu-id="e4a88-106">In streaming transfer mode, the receiver can begin to process the message before it is completely delivered.</span></span> <span data-ttu-id="e4a88-107">Tryb przesyłania strumieniowego jest przydatny, gdy przesyłane informacje są długie i mogą być przetwarzane sekwencyjnie.</span><span class="sxs-lookup"><span data-stu-id="e4a88-107">The streaming mode is useful when the information that is passed is lengthy and can be processed serially.</span></span> <span data-ttu-id="e4a88-108">Tryb przesyłania strumieniowego jest również przydatny, gdy komunikat jest zbyt duży, aby był całkowicie buforowany.</span><span class="sxs-lookup"><span data-stu-id="e4a88-108">Streaming mode is also useful when the message is too large to be entirely buffered.</span></span>  
  
 <span data-ttu-id="e4a88-109">Aby włączyć przesyłanie strumieniowe, zdefiniuj odpowiednie `OperationContract` i Włącz przesyłanie strumieniowe na poziomie transportu.</span><span class="sxs-lookup"><span data-stu-id="e4a88-109">To enable streaming, define the `OperationContract` appropriately and enable streaming at the transport level.</span></span>  
  
### <a name="to-stream-data"></a><span data-ttu-id="e4a88-110">Aby przesłać strumieniowo dane</span><span class="sxs-lookup"><span data-stu-id="e4a88-110">To stream data</span></span>  
  
1. <span data-ttu-id="e4a88-111">Aby przesłać strumieniowo dane, `OperationContract` dla usługi muszą być spełnione dwa wymagania:</span><span class="sxs-lookup"><span data-stu-id="e4a88-111">To stream data, the `OperationContract` for the service must satisfy two requirements:</span></span>  
  
    1. <span data-ttu-id="e4a88-112">Parametr, który przechowuje dane przeznaczone do przesyłania strumieniowego, musi być jedynym parametrem w metodzie.</span><span class="sxs-lookup"><span data-stu-id="e4a88-112">The parameter that holds the data to be streamed must be the only parameter in the method.</span></span> <span data-ttu-id="e4a88-113">Na przykład jeśli komunikat wejściowy jest przesyłany strumieniowo, operacja musi mieć dokładnie jeden parametr wejściowy.</span><span class="sxs-lookup"><span data-stu-id="e4a88-113">For example, if the input message is the one to be streamed, the operation must have exactly one input parameter.</span></span> <span data-ttu-id="e4a88-114">Podobnie, jeśli wiadomość wyjściowa ma być przesyłana strumieniowo, operacja musi mieć dokładnie jeden parametr wyjściowy lub wartość zwracaną.</span><span class="sxs-lookup"><span data-stu-id="e4a88-114">Similarly, if the output message is to be streamed, the operation must have either exactly one output parameter or a return value.</span></span>  
  
    2. <span data-ttu-id="e4a88-115">Co najmniej jeden z typów parametru i zwracanej wartości musi być albo <xref:System.IO.Stream> , <xref:System.ServiceModel.Channels.Message> lub <xref:System.Xml.Serialization.IXmlSerializable> .</span><span class="sxs-lookup"><span data-stu-id="e4a88-115">At least one of the types of the parameter and return value must be either <xref:System.IO.Stream>, <xref:System.ServiceModel.Channels.Message>, or <xref:System.Xml.Serialization.IXmlSerializable>.</span></span>  
  
     <span data-ttu-id="e4a88-116">Poniżej znajduje się przykład kontraktu dla danych przesyłanych strumieniowo.</span><span class="sxs-lookup"><span data-stu-id="e4a88-116">The following is an example of a contract for streamed data.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#1)]
     [!code-vb[c_HowTo_EnableStreaming#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#1)]  
  
     <span data-ttu-id="e4a88-117">`GetStream`Operacja otrzymuje pewne buforowane dane wejściowe jako `string` , które są buforowane i zwraca obiekt `Stream` , który jest przesyłany strumieniowo.</span><span class="sxs-lookup"><span data-stu-id="e4a88-117">The `GetStream` operation receives some buffered input data as a `string`, which is buffered, and returns a `Stream`, which is streamed.</span></span> <span data-ttu-id="e4a88-118">Odwrotnie `UploadStream` przyjmuje `Stream` (przesyłane strumieniowo) i zwraca `bool` (buforowana).</span><span class="sxs-lookup"><span data-stu-id="e4a88-118">Conversely `UploadStream` takes in a `Stream` (streamed) and returns a `bool` (buffered).</span></span> <span data-ttu-id="e4a88-119">`EchoStream` przyjmuje i zwraca `Stream` i jest przykładem operacji, której przesyłanie strumieniowe danych wejściowych i wyjściowych odbywa się jednocześnie.</span><span class="sxs-lookup"><span data-stu-id="e4a88-119">`EchoStream` takes and returns `Stream` and is an example of an operation whose input and output messages are both streamed.</span></span> <span data-ttu-id="e4a88-120">Na koniec `GetReversedStream` nie przyjmuje danych wejściowych i zwraca `Stream` (strumieniowo).</span><span class="sxs-lookup"><span data-stu-id="e4a88-120">Finally, `GetReversedStream` takes no inputs and returns a `Stream` (streamed).</span></span>  
  
2. <span data-ttu-id="e4a88-121">W powiązaniu musi być włączone przesyłanie strumieniowe.</span><span class="sxs-lookup"><span data-stu-id="e4a88-121">Streaming must be enabled on the binding.</span></span> <span data-ttu-id="e4a88-122">Ustawiasz `TransferMode` Właściwość, która może przyjmować jedną z następujących wartości:</span><span class="sxs-lookup"><span data-stu-id="e4a88-122">You set a `TransferMode` property, which can take one of the following values:</span></span>  
  
    1. <span data-ttu-id="e4a88-123">`Buffered`,</span><span class="sxs-lookup"><span data-stu-id="e4a88-123">`Buffered`,</span></span>  
  
    2. <span data-ttu-id="e4a88-124">`Streamed`, co umożliwia komunikację przesyłania strumieniowego w obu kierunkach.</span><span class="sxs-lookup"><span data-stu-id="e4a88-124">`Streamed`, which enables streaming communication in both directions.</span></span>  
  
    3. <span data-ttu-id="e4a88-125">`StreamedRequest`, co umożliwia przesyłanie strumieniowe tylko żądania.</span><span class="sxs-lookup"><span data-stu-id="e4a88-125">`StreamedRequest`, which enables streaming the request only.</span></span>  
  
    4. <span data-ttu-id="e4a88-126">`StreamedResponse`, co umożliwia przesyłanie strumieniowe tylko odpowiedzi.</span><span class="sxs-lookup"><span data-stu-id="e4a88-126">`StreamedResponse`, which enables streaming the response only.</span></span>  
  
     <span data-ttu-id="e4a88-127">`BasicHttpBinding`Uwidacznia `TransferMode` Właściwość dla powiązania, tak jak `NetTcpBinding` i `NetNamedPipeBinding` .</span><span class="sxs-lookup"><span data-stu-id="e4a88-127">The `BasicHttpBinding` exposes the `TransferMode` property on the binding, as does `NetTcpBinding` and `NetNamedPipeBinding`.</span></span> <span data-ttu-id="e4a88-128">`TransferMode`Właściwość można również ustawić dla elementu powiązania transportu i użyć w niestandardowym powiązaniu.</span><span class="sxs-lookup"><span data-stu-id="e4a88-128">The `TransferMode` property can also be set on the transport binding element and used in a custom binding.</span></span>  
  
     <span data-ttu-id="e4a88-129">W poniższych przykładach pokazano, jak ustawić `TransferMode` kod i zmienić plik konfiguracji.</span><span class="sxs-lookup"><span data-stu-id="e4a88-129">The following samples show how to set `TransferMode` by code and by changing the configuration file.</span></span> <span data-ttu-id="e4a88-130">Te próbki również ustawiają `maxReceivedMessageSize` Właściwość na 64 MB, co powoduje umieszczenie limitu maksymalnego dozwolonego rozmiaru komunikatów podczas odbierania.</span><span class="sxs-lookup"><span data-stu-id="e4a88-130">The samples also both set the `maxReceivedMessageSize` property to 64 MB, which places a cap on the maximum allowable size of messages on receive.</span></span> <span data-ttu-id="e4a88-131">Wartość domyślna `maxReceivedMessageSize` to 64 KB, która jest zwykle zbyt niska dla scenariuszy przesyłania strumieniowego.</span><span class="sxs-lookup"><span data-stu-id="e4a88-131">The default `maxReceivedMessageSize` is 64 KB, which is usually too low for streaming scenarios.</span></span> <span data-ttu-id="e4a88-132">Ustaw odpowiednie ustawienie limitu przydziału w zależności od maksymalnego rozmiaru komunikatów, które oczekuje na otrzymywanie przez aplikację.</span><span class="sxs-lookup"><span data-stu-id="e4a88-132">Set this quota setting as appropriate depending on the maximum size of messages your application expects to receive.</span></span> <span data-ttu-id="e4a88-133">Należy również zauważyć, że `maxBufferSize` steruje maksymalnym rozmiarem buforowanym i odpowiednio go ustawia.</span><span class="sxs-lookup"><span data-stu-id="e4a88-133">Also note that `maxBufferSize` controls the maximum size that is buffered, and set it appropriately.</span></span>  
  
    1. <span data-ttu-id="e4a88-134">Poniższy fragment konfiguracji z przykładu przedstawia Ustawianie `TransferMode` właściwości na potrzeby przesyłania strumieniowego `basicHttpBinding` i NIESTANDARDOWEGO powiązania HTTP.</span><span class="sxs-lookup"><span data-stu-id="e4a88-134">The following configuration snippet from the sample shows setting the `TransferMode` property to streaming on the `basicHttpBinding` and a custom HTTP binding.</span></span>  
  
         [!code-xml[c_HowTo_EnableStreaming#103](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/common/app.config#103)]
  
    2. <span data-ttu-id="e4a88-135">Poniższy fragment kodu przedstawia Ustawianie `TransferMode` właściwości na potrzeby przesyłania strumieniowego `basicHttpBinding` i NIESTANDARDOWEGO powiązania HTTP.</span><span class="sxs-lookup"><span data-stu-id="e4a88-135">The following code snippet shows setting the `TransferMode` property to streaming on the `basicHttpBinding` and a custom HTTP binding.</span></span>  
  
         [!code-csharp[c_HowTo_EnableStreaming_code#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming_code/cs/c_howto_enablestreaming_code.cs#2)]
         [!code-vb[c_HowTo_EnableStreaming_code#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming_code/vb/c_howto_enablestreaming_code.vb#2)]  
  
    3. <span data-ttu-id="e4a88-136">Poniższy fragment kodu przedstawia Ustawianie `TransferMode` właściwości na potrzeby przesyłania strumieniowego na niestandardowe powiązanie TCP.</span><span class="sxs-lookup"><span data-stu-id="e4a88-136">The following code snippet shows setting the `TransferMode` property to streaming on a custom TCP binding.</span></span>  
  
         [!code-csharp[c_HowTo_EnableStreaming_code#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming_code/cs/c_howto_enablestreaming_code.cs#3)]
         [!code-vb[c_HowTo_EnableStreaming_code#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming_code/vb/c_howto_enablestreaming_code.vb#3)]  
  
3. <span data-ttu-id="e4a88-137">Operacje `GetStream` , `UploadStream` i wszystkie związane `EchoStream` z wysyłaniem danych bezpośrednio z pliku lub zapisywanie danych odebranych bezpośrednio do pliku.</span><span class="sxs-lookup"><span data-stu-id="e4a88-137">The operations `GetStream`, `UploadStream`, and `EchoStream` all deal with sending data directly from a file or saving received data directly to a file.</span></span> <span data-ttu-id="e4a88-138">Poniższy kod dotyczy `GetStream` .</span><span class="sxs-lookup"><span data-stu-id="e4a88-138">The following code is for `GetStream`.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#4)]
     [!code-vb[c_HowTo_EnableStreaming#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#4)]  
  
### <a name="writing-a-custom-stream"></a><span data-ttu-id="e4a88-139">Pisanie strumienia niestandardowego</span><span class="sxs-lookup"><span data-stu-id="e4a88-139">Writing a custom stream</span></span>  
  
1. <span data-ttu-id="e4a88-140">Aby wykonać specjalne przetwarzanie każdego fragmentu strumienia danych w trakcie jego wysyłania lub odbierania, Utwórz niestandardową klasę strumienia <xref:System.IO.Stream> .</span><span class="sxs-lookup"><span data-stu-id="e4a88-140">To do special processing on each chunk of a data stream as it is being sent or received, derive a custom stream class from <xref:System.IO.Stream>.</span></span> <span data-ttu-id="e4a88-141">Jako przykład niestandardowego strumienia, poniższy kod zawiera `GetReversedStream` metodę i `ReverseStream` klasę-.</span><span class="sxs-lookup"><span data-stu-id="e4a88-141">As an example of a custom stream, the following code contains a `GetReversedStream` method and a `ReverseStream` class-.</span></span>  
  
     <span data-ttu-id="e4a88-142">`GetReversedStream` tworzy i zwraca nowe wystąpienie `ReverseStream` .</span><span class="sxs-lookup"><span data-stu-id="e4a88-142">`GetReversedStream` creates and returns a new instance of `ReverseStream`.</span></span> <span data-ttu-id="e4a88-143">Rzeczywiste przetwarzanie odbywa się, gdy system odczytuje z `ReverseStream` obiektu.</span><span class="sxs-lookup"><span data-stu-id="e4a88-143">The actual processing happens as the system reads from the `ReverseStream` object.</span></span> <span data-ttu-id="e4a88-144">`ReverseStream.Read`Metoda odczytuje fragmenty bajtów z pliku bazowego, odwraca je, a następnie zwraca odwrócone bajty.</span><span class="sxs-lookup"><span data-stu-id="e4a88-144">The `ReverseStream.Read` method reads a chunk of bytes from the underlying file, reverses them, then returns the reversed bytes.</span></span> <span data-ttu-id="e4a88-145">Ta metoda nie powoduje odwrócenia całej zawartości pliku; powoduje odwrócenie jednego fragmentu bajtów w danym momencie.</span><span class="sxs-lookup"><span data-stu-id="e4a88-145">This method does not reverse the entire file content; it reverses one chunk of bytes at a time.</span></span> <span data-ttu-id="e4a88-146">Ten przykład pokazuje, jak można wykonać przetwarzanie strumienia, ponieważ zawartość jest odczytywana lub zapisywana ze strumienia.</span><span class="sxs-lookup"><span data-stu-id="e4a88-146">This example shows how you can perform stream processing as the content is being read to or written from the stream.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#2)]
     [!code-vb[c_HowTo_EnableStreaming#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#2)]  
  
## <a name="see-also"></a><span data-ttu-id="e4a88-147">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="e4a88-147">See also</span></span>

- [<span data-ttu-id="e4a88-148">Duże ilości danych i przesyłanie strumieniowe</span><span class="sxs-lookup"><span data-stu-id="e4a88-148">Large Data and Streaming</span></span>](large-data-and-streaming.md)
- [<span data-ttu-id="e4a88-149">Strumień</span><span class="sxs-lookup"><span data-stu-id="e4a88-149">Stream</span></span>](../samples/stream.md)
