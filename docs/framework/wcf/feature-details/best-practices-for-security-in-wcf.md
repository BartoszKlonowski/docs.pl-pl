---
title: Najlepsze rozwiązania dotyczące zabezpieczeń programu WCF
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: ''
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- best practices [WCF], security
ms.assetid: 3639de41-1fa7-4875-a1d7-f393e4c8bd69
caps.latest.revision: 19
author: BrucePerlerMS
ms.author: bruceper
manager: mbaldwin
ms.workload:
- dotnet
ms.openlocfilehash: 19bb6d4a172568611f73e3a50d0c526016c65aac
ms.sourcegitcommit: 03ee570f6f528a7d23a4221dcb26a9498edbdf8c
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/28/2018
---
# <a name="best-practices-for-security-in-wcf"></a><span data-ttu-id="8f332-102">Najlepsze rozwiązania dotyczące zabezpieczeń programu WCF</span><span class="sxs-lookup"><span data-stu-id="8f332-102">Best Practices for Security in WCF</span></span>
<span data-ttu-id="8f332-103">W poniższych sekcjach wymieniono najważniejsze wskazówki wziąć pod uwagę podczas tworzenia bezpiecznego aplikacji przy użyciu [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)].</span><span class="sxs-lookup"><span data-stu-id="8f332-103">The following sections list the best practices to consider when creating secure applications using [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)].</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="8f332-104"> zabezpieczenia, zobacz [zagadnienia dotyczące zabezpieczeń](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md), [zagadnienia dotyczące zabezpieczeń dla danych](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md), i [zagadnienia dotyczące zabezpieczeń obejmujące metadane](../../../../docs/framework/wcf/feature-details/security-considerations-with-metadata.md).</span><span class="sxs-lookup"><span data-stu-id="8f332-104"> security, see [Security Considerations](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md), [Security Considerations for Data](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md), and [Security Considerations with Metadata](../../../../docs/framework/wcf/feature-details/security-considerations-with-metadata.md).</span></span>  
  
## <a name="identify-services-performing-windows-authentication-with-spns"></a><span data-ttu-id="8f332-105">Identyfikacja usług uwierzytelniania systemu Windows na nazwy SPN</span><span class="sxs-lookup"><span data-stu-id="8f332-105">Identify Services Performing Windows Authentication with SPNs</span></span>  
 <span data-ttu-id="8f332-106">Usługi można określić nazwy głównej użytkownika (UPN) lub głównych nazw usług (SPN).</span><span class="sxs-lookup"><span data-stu-id="8f332-106">Services can be identified with either user principal names (UPNs) or service principal names (SPNs).</span></span> <span data-ttu-id="8f332-107">Usługi uruchomiony w ramach konta komputera, na przykład usługi sieciowej mają tożsamością SPN odpowiadającego na komputerze, na którym jest na nich uruchomione.</span><span class="sxs-lookup"><span data-stu-id="8f332-107">Services running under machine accounts such as network service have an SPN identity corresponding to the machine they're running.</span></span> <span data-ttu-id="8f332-108">Usługi uruchomione na kontach użytkowników ma tożsamością UPN odpowiadający użytkownika nich uruchomiony, mimo że `setspn` narzędzia można przypisać nazwę SPN konta użytkownika.</span><span class="sxs-lookup"><span data-stu-id="8f332-108">Services running under user accounts have a UPN identity corresponding to the user they're running as, although the `setspn` tool can be used to assign an SPN to the user account.</span></span> <span data-ttu-id="8f332-109">Konfigurowanie usługi, dzięki czemu można zidentyfikować za pomocą głównej nazwy usługi i konfigurowanie klientów połączenie z usługą, aby użyć tej nazwy SPN może upewnić się, ataki trudniejsze.</span><span class="sxs-lookup"><span data-stu-id="8f332-109">Configuring a service so it can be identified via SPN and configuring the clients connecting to the service to use that SPN can make certain attacks more difficult.</span></span> <span data-ttu-id="8f332-110">Niniejsze wytyczne mają zastosowanie do wiązania za pomocą negocjowania protokołu Kerberos lub interfejs SSPI.</span><span class="sxs-lookup"><span data-stu-id="8f332-110">This guidance applies to bindings using Kerberos or SSPI negotiation.</span></span>  <span data-ttu-id="8f332-111">Klienci nadal należy określić nazwę SPN w przypadku, gdy SSPI powraca do uwierzytelniania NTLM.</span><span class="sxs-lookup"><span data-stu-id="8f332-111">Clients should still specify an SPN in the case where SSPI falls back to NTLM.</span></span>  
  
## <a name="verify-service-identities-in-wsdl"></a><span data-ttu-id="8f332-112">Sprawdź tożsamości usługi w języku WSDL</span><span class="sxs-lookup"><span data-stu-id="8f332-112">Verify Service Identities in WSDL</span></span>  
 <span data-ttu-id="8f332-113">WS-SecurityPolicy umożliwia usługom do publikowania informacji o własną tożsamość w metadanych.</span><span class="sxs-lookup"><span data-stu-id="8f332-113">WS-SecurityPolicy allows services to publish information about their own identities in metadata.</span></span> <span data-ttu-id="8f332-114">Po pobraniu przez `svcutil` lub innych metod, takich jak <xref:System.ServiceModel.Description.WsdlImporter>, informacje o tożsamości jest translacja do właściwości identity [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] adresy punktów końcowych usługi.</span><span class="sxs-lookup"><span data-stu-id="8f332-114">When retrieved via `svcutil` or other methods such as <xref:System.ServiceModel.Description.WsdlImporter>, this identity information is translated to the identity properties of the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service endpoint addresses.</span></span> <span data-ttu-id="8f332-115">Klientów, które sprawdza, czy te tożsamości usługi są poprawne i prawidłowe skutecznego obejścia uwierzytelniania usługi.</span><span class="sxs-lookup"><span data-stu-id="8f332-115">Clients which do not verify that these service identities are correct and valid effectively bypass service authentication.</span></span> <span data-ttu-id="8f332-116">Złośliwe usługi mogą wykorzystać takich klientów można wykonać przekazywania poświadczeń i innymi atakami "man w środku" przez zmianę tożsamości zastrzeżonego w WSDL.</span><span class="sxs-lookup"><span data-stu-id="8f332-116">A malicious service can exploit such clients to execute credential forwarding and other "man in the middle" attacks by changing the identity claimed in its WSDL.</span></span>  
  
## <a name="use-x509-certificates-instead-of-ntlm"></a><span data-ttu-id="8f332-117">Użyj X509 certyfikatów zamiast protokołu NTLM</span><span class="sxs-lookup"><span data-stu-id="8f332-117">Use X509 Certificates Instead of NTLM</span></span>  
 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="8f332-118"> dostępne są dwa mechanizmy uwierzytelniania peer-to-peer: X509 certyfikatów (używanych przez kanał elementu równorzędnego) i uwierzytelniania systemu Windows, gdy negocjowanie interfejsu SSPI obniży z protokołu Kerberos do uwierzytelniania NTLM.</span><span class="sxs-lookup"><span data-stu-id="8f332-118"> offers two mechanisms for peer-to-peer authentication: X509 certificates (used by peer channel) and Windows authentication where an SSPI negotiation downgrades from Kerberos to NTLM.</span></span>  <span data-ttu-id="8f332-119">Uwierzytelnianie oparte na certyfikatach przy użyciu klucza rozmiary najmniej 1024 bity jest preferowana względem NTLM z kilku powodów:</span><span class="sxs-lookup"><span data-stu-id="8f332-119">Certificate-based authentication using key sizes of 1024 bits or more is preferred to NTLM for several reasons:</span></span>  
  
-   <span data-ttu-id="8f332-120">dostępność wzajemnego uwierzytelniania</span><span class="sxs-lookup"><span data-stu-id="8f332-120">the availability of mutual authentication,</span></span>  
  
-   <span data-ttu-id="8f332-121">Użycie silniejszych algorytmów kryptograficznych, i</span><span class="sxs-lookup"><span data-stu-id="8f332-121">the use of stronger cryptographic algorithms, and</span></span>  
  
-   <span data-ttu-id="8f332-122">X509 przekazywane większa trudności przy użyciu poświadczeń.</span><span class="sxs-lookup"><span data-stu-id="8f332-122">the greater difficulty of utilizing forwarded X509 credentials.</span></span>  
  
 <span data-ttu-id="8f332-123">Omówienie uwierzytelniania NTLM przekazywania ataków, przejdź do [ http://msdn.microsoft.com/msdnmag/issues/06/09/SecureByDesign/default.aspx ](http://go.microsoft.com/fwlink/?LinkId=109571).</span><span class="sxs-lookup"><span data-stu-id="8f332-123">For an overview of NTLM forwarding attacks, go to [http://msdn.microsoft.com/msdnmag/issues/06/09/SecureByDesign/default.aspx](http://go.microsoft.com/fwlink/?LinkId=109571).</span></span>  
  
## <a name="always-revert-after-impersonation"></a><span data-ttu-id="8f332-124">Zawsze przywrócić po personifikacji</span><span class="sxs-lookup"><span data-stu-id="8f332-124">Always Revert After Impersonation</span></span>  
 <span data-ttu-id="8f332-125">Podczas korzystania z interfejsów API, które umożliwiają personifikacja klienta, pamiętaj powrócić do oryginalnej tożsamości.</span><span class="sxs-lookup"><span data-stu-id="8f332-125">When using APIs that enable impersonation of a client, be sure to revert to the original identity.</span></span> <span data-ttu-id="8f332-126">Na przykład w przypadku korzystania z <xref:System.Security.Principal.WindowsIdentity> i <xref:System.Security.Principal.WindowsImpersonationContext>, użyj C# `using` instrukcji lub Visual Basic`Using` instrukcji, jak pokazano w poniższym kodzie.</span><span class="sxs-lookup"><span data-stu-id="8f332-126">For example, when using the <xref:System.Security.Principal.WindowsIdentity> and <xref:System.Security.Principal.WindowsImpersonationContext>, use the C# `using` statement or the Visual Basic`Using` statement, as shown in the following code.</span></span> <span data-ttu-id="8f332-127"><xref:System.Security.Principal.WindowsImpersonationContext> Klasa implementuje <xref:System.IDisposable> interfejsu i dlatego środowisko uruchomieniowe języka wspólnego (CLR) automatycznie zostanie przywrócona do oryginalnego tożsamości po kodzie pozostawia `using` bloku.</span><span class="sxs-lookup"><span data-stu-id="8f332-127">The <xref:System.Security.Principal.WindowsImpersonationContext> class implements the <xref:System.IDisposable> interface, and therefore the common language runtime (CLR) automatically reverts to the original identity once the code leaves the `using` block.</span></span>  
  
 [!code-csharp[c_SecurityBestPractices#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securitybestpractices/cs/source.cs#1)]
 [!code-vb[c_SecurityBestPractices#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securitybestpractices/vb/source.vb#1)]  
  
## <a name="impersonate-only-as-needed"></a><span data-ttu-id="8f332-128">Tylko w razie potrzeby personifikacji</span><span class="sxs-lookup"><span data-stu-id="8f332-128">Impersonate Only as Needed</span></span>  
 <span data-ttu-id="8f332-129">Przy użyciu <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> metody <xref:System.Security.Principal.WindowsIdentity> klasa, jest możliwe w zakresie bardzo kontrolowane należy używać personifikacji.</span><span class="sxs-lookup"><span data-stu-id="8f332-129">Using the <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> method of the <xref:System.Security.Principal.WindowsIdentity> class, it is possible to use impersonation in a very controlled scope.</span></span> <span data-ttu-id="8f332-130">Dzięki temu nie trzeba przy użyciu <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> właściwość <xref:System.ServiceModel.OperationBehaviorAttribute>, co umożliwia personifikacji dla zakresu całej operacji.</span><span class="sxs-lookup"><span data-stu-id="8f332-130">This is in contrast to using the <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property of the <xref:System.ServiceModel.OperationBehaviorAttribute>, which allows impersonation for the scope of the entire operation.</span></span> <span data-ttu-id="8f332-131">Jeśli to możliwe, za pomocą bardziej precyzyjne kontrolowanie zakresu personifikacji <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="8f332-131">Whenever possible, control the scope of impersonation by using the more precise <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> method.</span></span>  
  
## <a name="obtain-metadata-from-trusted-sources"></a><span data-ttu-id="8f332-132">Uzyskiwanie metadanych z zaufanych źródeł</span><span class="sxs-lookup"><span data-stu-id="8f332-132">Obtain Metadata from Trusted Sources</span></span>  
 <span data-ttu-id="8f332-133">Upewnij się zaufania do źródła metadanych i upewnij się, że nikt nie został zmieniony przez niepowołane metadanych.</span><span class="sxs-lookup"><span data-stu-id="8f332-133">Be sure you trust the source of your metadata and make sure that no one has tampered with the metadata.</span></span> <span data-ttu-id="8f332-134">Metadane pobrany przy użyciu protokołu HTTP są wysyłane w postaci zwykłego tekstu i może zostać naruszone.</span><span class="sxs-lookup"><span data-stu-id="8f332-134">Metadata retrieved using the HTTP protocol is sent in clear text and can be tampered with.</span></span> <span data-ttu-id="8f332-135">Jeśli usługa używa <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetEnabled%2A> i <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetUrl%2A> właściwości, użyj adresu URL dostarczony przez autora usługi podczas pobierania danych przy użyciu protokołu HTTPS.</span><span class="sxs-lookup"><span data-stu-id="8f332-135">If the service uses the <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetEnabled%2A> and <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetUrl%2A> properties, use the URL supplied by the service creator to download the data using the HTTPS protocol.</span></span>  
  
## <a name="publish-metadata-using-security"></a><span data-ttu-id="8f332-136">Publikowanie metadanych przy użyciu zabezpieczeń</span><span class="sxs-lookup"><span data-stu-id="8f332-136">Publish Metadata Using Security</span></span>  
 <span data-ttu-id="8f332-137">Aby zapobiec modyfikowaniu z metadanymi opublikowane usługi, bezpieczny punkt końcowy wymiany metadanych z transportu lub zabezpieczenia na poziomie wiadomości.</span><span class="sxs-lookup"><span data-stu-id="8f332-137">To prevent tampering with a service's published metadata, secure the metadata exchange endpoint with transport or message-level security.</span></span> <span data-ttu-id="8f332-138">Aby uzyskać więcej informacji, zobacz [publikowanie punktów końcowych metadanych](../../../../docs/framework/wcf/publishing-metadata-endpoints.md) i [porady: Publikowanie metadanych dla kodu przy użyciu usługi](../../../../docs/framework/wcf/feature-details/how-to-publish-metadata-for-a-service-using-code.md).</span><span class="sxs-lookup"><span data-stu-id="8f332-138">For more information, see [Publishing Metadata Endpoints](../../../../docs/framework/wcf/publishing-metadata-endpoints.md) and [How to: Publish Metadata for a Service Using Code](../../../../docs/framework/wcf/feature-details/how-to-publish-metadata-for-a-service-using-code.md).</span></span>  
  
## <a name="ensure-use-of-local-issuer"></a><span data-ttu-id="8f332-139">Upewnij się, Użyj wystawcy lokalnego</span><span class="sxs-lookup"><span data-stu-id="8f332-139">Ensure Use of Local Issuer</span></span>  
 <span data-ttu-id="8f332-140">Jeśli adres wystawcy i powiązanie zostały określone dla danego powiązania, wystawcy lokalnego nie jest używany dla punktów końcowych, które używają tego powiązania.</span><span class="sxs-lookup"><span data-stu-id="8f332-140">If an issuer address and binding are specified for a given binding, the local issuer is not used for endpoints that use that binding.</span></span> <span data-ttu-id="8f332-141">Klienci, którzy oczekują, że zawsze używaj wystawcy lokalnego powinien upewnij się, że nie używaj takiego powiązania lub ich zmodyfikuj powiązanie w taki sposób, że adres wystawcy jest pusta.</span><span class="sxs-lookup"><span data-stu-id="8f332-141">Clients who expect to always use the local issuer should ensure that they do not use such a binding or that they modify the binding such that the issuer address is null.</span></span>  
  
## <a name="saml-token-size-quotas"></a><span data-ttu-id="8f332-142">Przydziały rozmiar tokenu SAML</span><span class="sxs-lookup"><span data-stu-id="8f332-142">SAML Token Size Quotas</span></span>  
 <span data-ttu-id="8f332-143">Gdy tokenów zabezpieczeń potwierdzenia Markup Language (SAML) są serializowane w wiadomości, wystawiane przez zabezpieczenia tokenu usługi (STS) lub, gdy klienci je do usług w ramach uwierzytelniania, maksymalny przydział rozmiaru komunikatu musi być wystarczająco duży, aby zmieścił się w tokenie SAML i innych części wiadomości.</span><span class="sxs-lookup"><span data-stu-id="8f332-143">When Security Assertions Markup Language (SAML) tokens are serialized in messages, either when they are issued by a Security Token Service (STS) or when clients present them to services as part of authentication, the maximum message size quota must be sufficiently large to accommodate the SAML token and the other message parts.</span></span> <span data-ttu-id="8f332-144">W przypadku normalnych przydziały rozmiar komunikatu domyślne są wystarczające.</span><span class="sxs-lookup"><span data-stu-id="8f332-144">In normal cases, the default message size quotas are sufficient.</span></span> <span data-ttu-id="8f332-145">Jednak w przypadku, gdy tokenu SAML jest duży, ponieważ zawiera on setki oświadczenia, przydziały powinny być zwiększyć Zserializowany token.</span><span class="sxs-lookup"><span data-stu-id="8f332-145">However, in cases where a SAML token is large because it contains hundreds of claims, the quotas should be increased to accommodate the serialized token.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="8f332-146"> przydziały, zobacz [zagadnienia dotyczące zabezpieczeń dla danych](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md).</span><span class="sxs-lookup"><span data-stu-id="8f332-146"> quotas, see [Security Considerations for Data](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md).</span></span>  
  
## <a name="set-securitybindingelementincludetimestamp-to-true-on-custom-bindings"></a><span data-ttu-id="8f332-147">Ustaw SecurityBindingElement.IncludeTimestamp wartość True na powiązania niestandardowe</span><span class="sxs-lookup"><span data-stu-id="8f332-147">Set SecurityBindingElement.IncludeTimestamp to True on Custom Bindings</span></span>  
 <span data-ttu-id="8f332-148">Podczas tworzenia niestandardowego powiązania, należy ustawić <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> do `true`.</span><span class="sxs-lookup"><span data-stu-id="8f332-148">When you create a custom binding, you must set <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> to `true`.</span></span> <span data-ttu-id="8f332-149">W przeciwnym razie, jeśli <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> ma ustawioną wartość `false`, a klient używa asymetrycznego token opartego na kluczach, takich jak X509 certyfikatu, komunikat nie zostanie podpisana.</span><span class="sxs-lookup"><span data-stu-id="8f332-149">Otherwise, if <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> is set to `false`, and the client is using an asymmetric key-based token such as an X509 certificate, the message will not be signed.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8f332-150">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="8f332-150">See Also</span></span>  
 [<span data-ttu-id="8f332-151">Zagadnienia dotyczące bezpieczeństwa</span><span class="sxs-lookup"><span data-stu-id="8f332-151">Security Considerations</span></span>](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md)  
 [<span data-ttu-id="8f332-152">Zagadnienia związane z zabezpieczeniami danych</span><span class="sxs-lookup"><span data-stu-id="8f332-152">Security Considerations for Data</span></span>](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md)  
 [<span data-ttu-id="8f332-153">Zagadnienia dotyczące zabezpieczeń obejmujące metadane</span><span class="sxs-lookup"><span data-stu-id="8f332-153">Security Considerations with Metadata</span></span>](../../../../docs/framework/wcf/feature-details/security-considerations-with-metadata.md)
