---
title: Określanie i obsługa błędów w kontraktach i usługach
ms.date: 03/30/2017
helpviewer_keywords:
- handling faults [WCF]
ms.assetid: a9696563-d404-4905-942d-1e0834c26dea
ms.openlocfilehash: bbc1ca97c8887ebdfbe30f7dd76549572367efbe
ms.sourcegitcommit: 628e8147ca10187488e6407dab4c4e6ebe0cac47
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/15/2019
ms.locfileid: "72321110"
---
# <a name="specifying-and-handling-faults-in-contracts-and-services"></a><span data-ttu-id="d226f-102">Określanie i obsługa błędów w kontraktach i usługach</span><span class="sxs-lookup"><span data-stu-id="d226f-102">Specifying and Handling Faults in Contracts and Services</span></span>

<span data-ttu-id="d226f-103">Aplikacje Windows Communication Foundation (WCF) obsługują sytuacje błędów, mapując zarządzane obiekty wyjątków do obiektów błędów SOAP i obiektów błędów SOAP na obiekty wyjątków zarządzanych.</span><span class="sxs-lookup"><span data-stu-id="d226f-103">Windows Communication Foundation (WCF) applications handle error situations by mapping managed exception objects to SOAP fault objects and SOAP fault objects to managed exception objects.</span></span> <span data-ttu-id="d226f-104">W tematach w tej sekcji omówiono sposób projektowania kontraktów w celu ujawnienia warunków błędów jako niestandardowych błędów SOAP, sposobu zwracania takich błędów w ramach implementacji usługi i sposobu, w jaki klienci przechwytują takie błędy.</span><span class="sxs-lookup"><span data-stu-id="d226f-104">The topics in this section discuss how to design contracts to expose error conditions as custom SOAP faults, how to return such faults as part of service implementation, and how clients catch such faults.</span></span>

## <a name="error-handling-overview"></a><span data-ttu-id="d226f-105">Omówienie obsługi błędów</span><span class="sxs-lookup"><span data-stu-id="d226f-105">Error Handling Overview</span></span>

<span data-ttu-id="d226f-106">W przypadku wszystkich aplikacji zarządzanych błędy przetwarzania są reprezentowane przez obiekty <xref:System.Exception>.</span><span class="sxs-lookup"><span data-stu-id="d226f-106">In all managed applications, processing errors are represented by <xref:System.Exception> objects.</span></span> <span data-ttu-id="d226f-107">W aplikacjach opartych na protokole SOAP, takich jak aplikacje WCF, metody obsługi komunikują informacje o błędach przy użyciu komunikatów błędów protokołu SOAP.</span><span class="sxs-lookup"><span data-stu-id="d226f-107">In SOAP-based applications such as WCF applications, service methods communicate processing error information using SOAP fault messages.</span></span> <span data-ttu-id="d226f-108">Błędy protokołu SOAP to typy komunikatów, które są uwzględnione w metadanych dla operacji usługi, dlatego należy utworzyć kontrakt błędów, za pomocą którego klienci mogą wykonywać działania bardziej niezawodne lub interaktywne.</span><span class="sxs-lookup"><span data-stu-id="d226f-108">SOAP faults are message types that are included in the metadata for a service operation and therefore create a fault contract that clients can use to make their operation more robust or interactive.</span></span> <span data-ttu-id="d226f-109">Ponadto, ponieważ błędy protokołu SOAP są wyrażane dla klientów w formularzu XML, jest to wysoce interoperacyjny system typów, który może być używany przez klientów na dowolnej platformie SOAP, zwiększając zasięg aplikacji WCF.</span><span class="sxs-lookup"><span data-stu-id="d226f-109">In addition, because SOAP faults are expressed to clients in XML form, it is a highly interoperable type system that clients on any SOAP platform can use, increasing the reach of your WCF application.</span></span>

<span data-ttu-id="d226f-110">Ponieważ aplikacje WCF działają w obu typach systemów błędów, wszelkie zarządzane informacje o wyjątkach, które są wysyłane do klienta programu, muszą być konwertowane z wyjątków na błędy protokołu SOAP w usłudze, wysyłane i konwertowane z błędów SOAP na wyjątki błędów w klientach WCF.</span><span class="sxs-lookup"><span data-stu-id="d226f-110">Because WCF applications run under both types of error systems, any managed exception information that is sent to the client must be converted from exceptions into SOAP faults on the service, sent, and converted from SOAP faults to fault exceptions in WCF clients.</span></span> <span data-ttu-id="d226f-111">W przypadku klientów z dupleksem umowy klienckie mogą również wysyłać błędy SOAP z powrotem do usługi.</span><span class="sxs-lookup"><span data-stu-id="d226f-111">In the case of duplex clients, client contracts can also send SOAP faults back to a service.</span></span> <span data-ttu-id="d226f-112">W obu przypadkach można użyć domyślnych zachowań wyjątku usługi lub można jawnie kontrolować, czy i w jaki sposób wyjątki są mapowane na komunikaty o błędach.</span><span class="sxs-lookup"><span data-stu-id="d226f-112">In either case, you can use the default service exception behaviors, or you can explicitly control whether—and how—exceptions are mapped to fault messages.</span></span>

<span data-ttu-id="d226f-113">Można wysyłać dwa typy błędów SOAP: *zadeklarowany* i *niezadeklarowany*.</span><span class="sxs-lookup"><span data-stu-id="d226f-113">Two types of SOAP faults can be sent: *declared* and *undeclared*.</span></span> <span data-ttu-id="d226f-114">Zadeklarowane błędy protokołu SOAP to te, w których operacja ma atrybut <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType>, który określa niestandardowy typ błędu SOAP.</span><span class="sxs-lookup"><span data-stu-id="d226f-114">Declared SOAP faults are those in which an operation has a <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> attribute that specifies a custom SOAP fault type.</span></span> <span data-ttu-id="d226f-115">*Niezadeklarowany* Błędy SOAP nie są określone w kontrakcie dla operacji.</span><span class="sxs-lookup"><span data-stu-id="d226f-115">*Undeclared* SOAP faults are not specified in the contract for an operation.</span></span>

<span data-ttu-id="d226f-116">Zdecydowanie zaleca się, aby operacje usługi deklarują swoje błędy przy użyciu atrybutu <xref:System.ServiceModel.FaultContractAttribute> do formalnego określenia wszystkich błędów SOAP, które klient może otrzymać w normalnym przebiegu operacji.</span><span class="sxs-lookup"><span data-stu-id="d226f-116">It is strongly recommended that service operations declare their faults by using the <xref:System.ServiceModel.FaultContractAttribute> attribute to formally specify all SOAP faults that a client can expect to receive in the normal course of an operation.</span></span> <span data-ttu-id="d226f-117">Zaleca się również zwrócenie informacji o błędach SOAP tylko wtedy, gdy klient musi wiedzieć, aby zminimalizować ujawnienie informacji.</span><span class="sxs-lookup"><span data-stu-id="d226f-117">It is also recommended that you return in a SOAP fault only the information that a client must know to minimize information disclosure.</span></span>

<span data-ttu-id="d226f-118">Zazwyczaj usługi (i klient dupleksu) wykonaj następujące kroki, aby pomyślnie zintegrować obsługę błędów w swoich aplikacjach:</span><span class="sxs-lookup"><span data-stu-id="d226f-118">Typically, services (and duplex clients) take the following steps to successfully integrate error handling into their applications:</span></span>

- <span data-ttu-id="d226f-119">Mapowanie warunków wyjątków na niestandardowe błędy SOAP.</span><span class="sxs-lookup"><span data-stu-id="d226f-119">Map exception conditions to custom SOAP faults.</span></span>

- <span data-ttu-id="d226f-120">Klienci i usługi wysyłają i odbierają błędy protokołu SOAP jako wyjątki.</span><span class="sxs-lookup"><span data-stu-id="d226f-120">Clients and services send and receive SOAP faults as exceptions.</span></span>

<span data-ttu-id="d226f-121">Ponadto klienci i usługi WCF mogą używać niezadeklarowanych błędów protokołu SOAP do celów debugowania i można zwiększyć domyślne zachowanie błędu.</span><span class="sxs-lookup"><span data-stu-id="d226f-121">In addition, WCF clients and services can use undeclared soap faults for debugging purposes and can extend the default error behavior.</span></span> <span data-ttu-id="d226f-122">W poniższych sekcjach omówiono te zadania i koncepcje.</span><span class="sxs-lookup"><span data-stu-id="d226f-122">The following sections discuss these tasks and concepts.</span></span>

## <a name="map-exceptions-to-soap-faults"></a><span data-ttu-id="d226f-123">Mapowanie wyjątków do błędów SOAP</span><span class="sxs-lookup"><span data-stu-id="d226f-123">Map Exceptions to SOAP Faults</span></span>

<span data-ttu-id="d226f-124">Pierwszym krokiem w tworzeniu operacji, która obsługuje warunki błędów, jest określenie, w jaki sposób mają być informowane aplikacje klienckie o błędach.</span><span class="sxs-lookup"><span data-stu-id="d226f-124">The first step in creating an operation that handles error conditions is to decide under what conditions a client application should be informed about errors.</span></span> <span data-ttu-id="d226f-125">Niektóre operacje mają warunki błędów specyficzne dla ich funkcjonalności.</span><span class="sxs-lookup"><span data-stu-id="d226f-125">Some operations have error conditions specific to their functionality.</span></span> <span data-ttu-id="d226f-126">Na przykład operacja `PurchaseOrder` może zwrócić określone informacje klientom, którzy nie będą już mogli inicjować zamówienia zakupu.</span><span class="sxs-lookup"><span data-stu-id="d226f-126">For example, a `PurchaseOrder` operation might return specific information to customers who are no longer permitted to initiate a purchase order.</span></span> <span data-ttu-id="d226f-127">W innych przypadkach, takich jak usługa `Calculator`, bardziej ogólny błąd protokołu SOAP `MathFault` może być w stanie opisać wszystkie warunki błędów w całej usłudze.</span><span class="sxs-lookup"><span data-stu-id="d226f-127">In other cases, such as a `Calculator` service, a more general `MathFault` SOAP fault may be able to describe all error conditions across an entire service.</span></span> <span data-ttu-id="d226f-128">Po zidentyfikowaniu warunków błędu klientów usługi można utworzyć niestandardowy błąd protokołu SOAP, a operacja może być oznaczona jako zwracająca ten błąd protokołu SOAP, gdy występuje odpowiedni warunek błędu.</span><span class="sxs-lookup"><span data-stu-id="d226f-128">Once the error conditions of clients of your service are identified, a custom SOAP fault can be constructed and the operation can be marked as returning that SOAP fault when its corresponding error condition arises.</span></span>

<span data-ttu-id="d226f-129">Aby uzyskać więcej informacji na temat tworzenia usługi lub klienta, zobacz [Definiowanie i określanie błędów](defining-and-specifying-faults.md).</span><span class="sxs-lookup"><span data-stu-id="d226f-129">For more information about this step of developing your service or client, see [Defining and Specifying Faults](defining-and-specifying-faults.md).</span></span>

## <a name="clients-and-services-handle-soap-faults-as-exceptions"></a><span data-ttu-id="d226f-130">Klienci i usługi obsługują błędy protokołu SOAP jako wyjątki</span><span class="sxs-lookup"><span data-stu-id="d226f-130">Clients and Services Handle SOAP Faults as Exceptions</span></span>

<span data-ttu-id="d226f-131">Identyfikowanie warunków błędów operacji, Definiowanie niestandardowych błędów protokołu SOAP i oznaczanie tych operacji jako zwracających te błędy to pierwsze kroki w przypadku pomyślnej obsługi błędów w aplikacjach WCF.</span><span class="sxs-lookup"><span data-stu-id="d226f-131">Identifying operation error conditions, defining custom SOAP faults, and marking those operations as returning those faults are the first steps in successful error handling in WCF applications.</span></span> <span data-ttu-id="d226f-132">Następnym krokiem jest poprawne zaimplementowanie wysyłania i otrzymywania tych błędów.</span><span class="sxs-lookup"><span data-stu-id="d226f-132">The next step is to properly implement the sending and receiving of these faults.</span></span> <span data-ttu-id="d226f-133">Zazwyczaj usługi wysyłają błędy, aby informować aplikacje klienckie o błędach, ale klienci dupleksowi mogą również wysyłać błędy SOAP do usług.</span><span class="sxs-lookup"><span data-stu-id="d226f-133">Typically services send faults to inform client applications about error conditions, but duplex clients can also send SOAP faults to services.</span></span>

<span data-ttu-id="d226f-134">Aby uzyskać więcej informacji, zobacz [wysyłanie i otrzymywanie błędów](sending-and-receiving-faults.md).</span><span class="sxs-lookup"><span data-stu-id="d226f-134">For more information, see [Sending and Receiving Faults](sending-and-receiving-faults.md).</span></span>

## <a name="undeclared-soap-faults-and-debugging"></a><span data-ttu-id="d226f-135">Niezadeklarowane błędy i debugowanie protokołu SOAP</span><span class="sxs-lookup"><span data-stu-id="d226f-135">Undeclared SOAP Faults and Debugging</span></span>

<span data-ttu-id="d226f-136">Zadeklarowane błędy protokołu SOAP są niezwykle przydatne do tworzenia niezawodnych, międzyoperacyjnych aplikacji rozproszonych.</span><span class="sxs-lookup"><span data-stu-id="d226f-136">Declared SOAP faults are extremely useful for building robust, interoperable, distributed applications.</span></span> <span data-ttu-id="d226f-137">Jednak w niektórych przypadkach jest to przydatne w przypadku wysyłania niezadeklarowanych błędów SOAP przez usługę (lub klienta dupleksowego), która nie jest wymieniona w Web Services Description Language (WSDL) dla tej operacji.</span><span class="sxs-lookup"><span data-stu-id="d226f-137">However, in some cases it is useful for a service (or duplex client) to send an undeclared SOAP fault, one that is not mentioned in the Web Services Description Language (WSDL) for that operation.</span></span> <span data-ttu-id="d226f-138">Na przykład podczas tworzenia usługi mogą wystąpić nieoczekiwane sytuacje, w których są przydatne do debugowania w celu wysyłania informacji z powrotem do klienta.</span><span class="sxs-lookup"><span data-stu-id="d226f-138">For example, when developing a service, unexpected situations can occur in which it is useful for debugging purposes to send information back to the client.</span></span> <span data-ttu-id="d226f-139">Ponadto można ustawić właściwość <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> lub właściwość <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> na `true`, aby zezwolić klientom WCF na uzyskanie informacji o wyjątkach operacji wewnętrznej usługi.</span><span class="sxs-lookup"><span data-stu-id="d226f-139">In addition, you can set the <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property or the <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property to `true` to permit WCF clients to obtain information about internal service operation exceptions.</span></span> <span data-ttu-id="d226f-140">Zarówno wysyłanie pojedynczych błędów, jak i Ustawianie właściwości zachowania debugowania są opisane w temacie [wysyłanie i otrzymywanie błędów](sending-and-receiving-faults.md).</span><span class="sxs-lookup"><span data-stu-id="d226f-140">Both sending individual faults and setting the debugging behavior properties are described in [Sending and Receiving Faults](sending-and-receiving-faults.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d226f-141">Ponieważ zarządzane wyjątki mogą uwidaczniać wewnętrzne informacje o aplikacji, ustawienie <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> lub <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> na `true` może pozwolić klientom WCF uzyskać informacje o wyjątkach operacji usługi wewnętrznej, w tym identyfikowalnych przez użytkownika lub innych poufnych zawartych.</span><span class="sxs-lookup"><span data-stu-id="d226f-141">Because managed exceptions can expose internal application information, setting <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> to `true` can permit WCF clients to obtain information about internal service operation exceptions, including personally identifiable or other sensitive information.</span></span>
>
> <span data-ttu-id="d226f-142">W związku z tym ustawienie <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> lub <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> do `true` jest zalecane tylko jako sposób tymczasowego debugowania aplikacji usługi.</span><span class="sxs-lookup"><span data-stu-id="d226f-142">Therefore, setting <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> to `true` is recommended only as a way to temporarily debug a service application.</span></span> <span data-ttu-id="d226f-143">Ponadto WSDL dla metody, która zwraca Nieobsłużone wyjątki zarządzane w ten sposób, nie zawiera kontraktu dla <xref:System.ServiceModel.FaultException%601> typu <xref:System.ServiceModel.ExceptionDetail>.</span><span class="sxs-lookup"><span data-stu-id="d226f-143">In addition, the WSDL for a method that returns unhandled managed exceptions in this way does not contain the contract for the <xref:System.ServiceModel.FaultException%601> of type <xref:System.ServiceModel.ExceptionDetail>.</span></span> <span data-ttu-id="d226f-144">Klienci muszą oczekiwać wystąpienia nieznanego błędu protokołu SOAP (zwracanego do klientów WCF jako obiektów <xref:System.ServiceModel.FaultException?displayProperty=nameWithType>) w celu poprawnego uzyskania informacji o debugowaniu.</span><span class="sxs-lookup"><span data-stu-id="d226f-144">Clients must expect the possibility of an unknown SOAP fault (returned to WCF clients as <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> objects) to obtain the debugging information properly.</span></span>

## <a name="customizing-error-handling-with-ierrorhandler"></a><span data-ttu-id="d226f-145">Dostosowywanie obsługi błędów za pomocą IErrorHandler</span><span class="sxs-lookup"><span data-stu-id="d226f-145">Customizing Error Handling with IErrorHandler</span></span>

<span data-ttu-id="d226f-146">Jeśli użytkownik ma specjalne wymagania, można dostosować komunikat odpowiedzi do klienta, gdy występuje wyjątek poziomu aplikacji lub wykonać niestandardowe przetwarzanie po zwróceniu komunikatu odpowiedzi, zaimplementować interfejs <xref:System.ServiceModel.Dispatcher.IErrorHandler?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d226f-146">If you have special requirements to either customize the response message to the client when an application-level exception happens or perform some custom processing after the response message is returned, implement the <xref:System.ServiceModel.Dispatcher.IErrorHandler?displayProperty=nameWithType> interface.</span></span>

## <a name="fault-serialization-issues"></a><span data-ttu-id="d226f-147">Problemy serializacji błędów</span><span class="sxs-lookup"><span data-stu-id="d226f-147">Fault Serialization Issues</span></span>

<span data-ttu-id="d226f-148">Podczas deserializacji kontraktu dotyczącego błędu usługa WCF najpierw próbuje dopasować nazwę kontraktu błędów w komunikacie protokołu SOAP z typem kontraktu błędu.</span><span class="sxs-lookup"><span data-stu-id="d226f-148">When deserializing a fault contract, WCF first attempts to match the fault contract name in the SOAP message with the fault contract type.</span></span> <span data-ttu-id="d226f-149">Jeśli nie można znaleźć dokładnego dopasowania, przeszukasz listę dostępnych kontraktów błędów w kolejności alfabetycznej dla zgodnego typu.</span><span class="sxs-lookup"><span data-stu-id="d226f-149">If it cannot find an exact match it will then search the list of available fault contracts in alphabetical order for a compatible type.</span></span> <span data-ttu-id="d226f-150">Jeśli dwa kontrakty błędów są zgodne z typami (jeden jest podklasą innego, na przykład) niewłaściwy typ może zostać użyty do deserializacji błędu.</span><span class="sxs-lookup"><span data-stu-id="d226f-150">If two fault contracts are compatible types (one is a subclass of another, for example) the wrong type may be used to de-serialize the fault.</span></span> <span data-ttu-id="d226f-151">Ta sytuacja występuje tylko wtedy, gdy kontrakt błędu nie określa nazwy, przestrzeni nazw i akcji.</span><span class="sxs-lookup"><span data-stu-id="d226f-151">This only occurs if the fault contract does not specify a name, namespace, and action.</span></span> <span data-ttu-id="d226f-152">Aby zapobiec wystąpieniu tego problemu, zawsze w pełni Zakwalifikuj kontrakty do błędów, określając nazwę, przestrzeń nazw i atrybuty akcji.</span><span class="sxs-lookup"><span data-stu-id="d226f-152">To prevent this issue from occurring, always fully qualify fault contracts by specifying the name, namespace, and action attributes.</span></span> <span data-ttu-id="d226f-153">Ponadto jeśli zdefiniowano wiele powiązanych umów o błędach pochodzących z udostępnionej klasy bazowej, upewnij się, że wszystkie nowe elementy członkowskie są oznaczone `[DataMember(IsRequired=true)]`.</span><span class="sxs-lookup"><span data-stu-id="d226f-153">Additionally if you have defined a number of related fault contracts derived from a shared base class, make sure to mark any new members with `[DataMember(IsRequired=true)]`.</span></span> <span data-ttu-id="d226f-154">Aby uzyskać więcej informacji na temat tego atrybutu `IsRequired`, zobacz <xref:System.Runtime.Serialization.DataMemberAttribute>.</span><span class="sxs-lookup"><span data-stu-id="d226f-154">For more information on this `IsRequired` attribute see, <xref:System.Runtime.Serialization.DataMemberAttribute>.</span></span> <span data-ttu-id="d226f-155">Uniemożliwi to, aby Klasa bazowa była zgodna z typem zgodnym i wymusić deserializacja błędu do poprawnego typu pochodnego.</span><span class="sxs-lookup"><span data-stu-id="d226f-155">This will prevent a base class from being a compatible type and force the fault to be deserialized into the correct derived type.</span></span>

## <a name="see-also"></a><span data-ttu-id="d226f-156">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="d226f-156">See also</span></span>

- <xref:System.ServiceModel.FaultException>
- <xref:System.ServiceModel.FaultContractAttribute>
- <xref:System.ServiceModel.FaultException>
- <xref:System.Xml.Serialization.XmlSerializer>
- <xref:System.ServiceModel.XmlSerializerFormatAttribute>
- <xref:System.ServiceModel.FaultContractAttribute>
- <xref:System.ServiceModel.CommunicationException>
- <xref:System.ServiceModel.FaultContractAttribute.Action%2A>
- <xref:System.ServiceModel.FaultException.Code%2A>
- <xref:System.ServiceModel.FaultException.Reason%2A>
- <xref:System.ServiceModel.FaultCode.SubCode%2A>
- <xref:System.ServiceModel.OperationContractAttribute.IsOneWay%2A>
- [<span data-ttu-id="d226f-157">Definiowanie i określanie błędów</span><span class="sxs-lookup"><span data-stu-id="d226f-157">Defining and Specifying Faults</span></span>](defining-and-specifying-faults.md)
