---
title: Konfigurowanie śledzenia przepływu komunikatów
ms.date: 03/30/2017
ms.assetid: 15571ca2-bee2-47fb-ba10-fcbc09152ad0
ms.openlocfilehash: 6c271c26eb4e57014b3aaebf306b283bd06c7119
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/26/2020
ms.locfileid: "96254886"
---
# <a name="configuring-message-flow-tracing"></a><span data-ttu-id="27948-102">Konfigurowanie śledzenia przepływu komunikatów</span><span class="sxs-lookup"><span data-stu-id="27948-102">Configuring Message Flow Tracing</span></span>

<span data-ttu-id="27948-103">Po włączeniu śledzenia działań Windows Communication Foundation (WCF) identyfikatory działań end-to-end są przypisywane do działań logicznych w ramach stosu WCF.</span><span class="sxs-lookup"><span data-stu-id="27948-103">When Windows Communication Foundation (WCF) activity tracing is enabled, End-To-End Activity IDs are assigned to logical activities throughout the WCF stack.</span></span> <span data-ttu-id="27948-104">W systemie [!INCLUDE[netfx_current_short](../../../../../includes/netfx-current-short-md.md)] jest teraz dostępna wyższa wersja wydajności tej funkcji, która działa ze śledzeniem zdarzeń systemu Windows (ETW) o nazwie śledzenie przepływu wiadomości.</span><span class="sxs-lookup"><span data-stu-id="27948-104">In [!INCLUDE[netfx_current_short](../../../../../includes/netfx-current-short-md.md)], there is now a higher performance version of this feature that works with Event Tracing for Windows (ETW) called message flow tracing.</span></span> <span data-ttu-id="27948-105">Gdy ta wartość jest włączona, identyfikatory działań end-to-end są pobierane z (lub przypisane do, jeśli są puste) komunikaty przychodzące i są propagowane do wszystkich zdarzeń śledzenia, które są emitowane po zdekodowaniu komunikatu przez kanał.</span><span class="sxs-lookup"><span data-stu-id="27948-105">When enabled, End-To-End activity IDs are taken from (or assigned to if empty) incoming messages and are propagated to all tracing events that are emitted after the message has been decoded by the channel.</span></span> <span data-ttu-id="27948-106">Klienci mogą używać tej funkcji do odbudowy przepływów komunikatów przy użyciu dzienników śledzenia z różnych usług po dekodowania.</span><span class="sxs-lookup"><span data-stu-id="27948-106">Customers can use this feature to reconstruct message flows with trace logs from different services after decoding.</span></span>  
  
 <span data-ttu-id="27948-107">Śledzenie można włączyć po wykryciu problemu w aplikacji, a następnie wyłączeniu po rozwiązaniu problemu.</span><span class="sxs-lookup"><span data-stu-id="27948-107">Tracing can be enabled after a problem is detected with the application and then disabled once the problem is resolved.</span></span>  
  
## <a name="enabling-tracing"></a><span data-ttu-id="27948-108">Włączenie debugowania</span><span class="sxs-lookup"><span data-stu-id="27948-108">Enabling Tracing</span></span>  

 <span data-ttu-id="27948-109">Możesz włączyć śledzenie przepływu komunikatów, ustawiając element konfiguracji .NET Framework 4 `messageFlowTracing` na `true` , jak pokazano w poniższym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="27948-109">You can enable message flow tracing by setting the .NET Framework 4 `messageFlowTracing` configuration element to `true`, as shown in the following example.</span></span>  
  
```xml  
<system.servicemodel>  
  <diagnostics>  
    <endToEndTracing propagateActivity="true" messageFlowTracing="true" />  
  </diagnostics>  
</system.servicemodel>  
```  
  
> [!NOTE]
> <span data-ttu-id="27948-110">Ponieważ `endToEndTracing` element konfiguracji znajduje się w pliku Web.config, nie można go skonfigurować dynamicznie w taki sam sposób jak ETW.</span><span class="sxs-lookup"><span data-stu-id="27948-110">Because the `endToEndTracing` configuration element resides in a Web.config file, it cannot be dynamically configured in the same way as ETW.</span></span> <span data-ttu-id="27948-111">Aby `endToEndTracing` element konfiguracji został uwzględniony, należy ponownie przetworzyć aplikację.</span><span class="sxs-lookup"><span data-stu-id="27948-111">For the `endToEndTracing` configuration element to take effect, the application must be recycled.</span></span>  
  
 <span data-ttu-id="27948-112">Działania są skorelowane przez wymianę identyfikatora zwanego IDENTYFIKATORem działania.</span><span class="sxs-lookup"><span data-stu-id="27948-112">Activities are correlated by the interchange of an identifier called the activity ID.</span></span> <span data-ttu-id="27948-113">Ten identyfikator jest identyfikatorem GUID i jest generowany przez klasę System. Diagnostics. korelacji.</span><span class="sxs-lookup"><span data-stu-id="27948-113">This identifier is a GUID, and is generated by the System.Diagnostics.CorrelationManager class.</span></span> <span data-ttu-id="27948-114">Jeśli manipulujesz system. Diagnostics. Trace. korelacji. ActivityID, upewnij się, że wartość jest ustawiona na oryginalna, gdy kontrola wykonywania przeniesie z powrotem do kodu WCF.</span><span class="sxs-lookup"><span data-stu-id="27948-114">If you manipulate System.Diagnostics.Trace.CorrelationManager.ActivityID, ensure that the value is set to original when execution control transfers back to WCF code.</span></span>  <span data-ttu-id="27948-115">Ponadto, jeśli używasz asynchronicznego modelu programowania WCF, upewnij się, że element System. Diagnostics. Trace. korelacji. ActivityID jest przekazywany między wątkami.</span><span class="sxs-lookup"><span data-stu-id="27948-115">Also, if you use an asynchronous WCF programming model ensure that System.Diagnostics.Trace.CorrelationManager.ActivityID is transferred between the threads.</span></span>  
  
## <a name="message-flow-tracing-and-rest-services"></a><span data-ttu-id="27948-116">Śledzenie przepływu komunikatów i usługi REST</span><span class="sxs-lookup"><span data-stu-id="27948-116">Message Flow Tracing and REST Services</span></span>  

 <span data-ttu-id="27948-117">Funkcja śledzenia przepływu komunikatów umożliwia śledzenie końca żądania.</span><span class="sxs-lookup"><span data-stu-id="27948-117">Message flow tracing allows you to trace a request end to end.</span></span>  <span data-ttu-id="27948-118">W przypadku usług opartych na protokole SOAP identyfikator działania jest wysyłany w nagłówku komunikatu protokołu SOAP.</span><span class="sxs-lookup"><span data-stu-id="27948-118">With SOAP-based services an Activity ID is sent in a SOAP message header.</span></span> <span data-ttu-id="27948-119">Żądania REST nie zawierają tego nagłówka, więc zamiast niego zostanie użyty specjalny nagłówek zdarzenia HTTP.</span><span class="sxs-lookup"><span data-stu-id="27948-119">REST requests do not contain this header so a special HTTP event header is used instead.</span></span> <span data-ttu-id="27948-120">Poniższy fragment kodu pokazuje, jak można programowo pobrać wartość identyfikatora działania:</span><span class="sxs-lookup"><span data-stu-id="27948-120">The following code snippet shows how you can programmatically retrieve the Activity ID value:</span></span>  
  
```csharp
Object output = null;
if (OperationContext.Current.IncomingMessageProperties.TryGetValue(HttpRequestMessageProperty.Name, out output))
{
   HttpRequestMessageProperty httpHeaders = output as HttpRequestMessageProperty;
   // Retrieve the Activity Id from the HTTP header    string e2eId = httpHeaders.Headers["E2EActivity"];
   // ...
}
```

 <span data-ttu-id="27948-121">Można programowo dodać nagłówek przy użyciu następującego kodu:</span><span class="sxs-lookup"><span data-stu-id="27948-121">You can programmatically add the header using the following code:</span></span>  
  
```csharp  
HttpContent content = new StreamContent(contentStream);  
Guid correlation = Guid.NewGuid();  
content.Headers.Add("E2EActivity", Convert.ToBase64String(correlation.ToByteArray()));  
```
