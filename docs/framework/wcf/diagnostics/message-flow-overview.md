---
title: Przegląd przepływu komunikatu
ms.date: 03/30/2017
ms.assetid: fb0899e1-84cc-4d90-b45b-dc5a50063943
ms.openlocfilehash: d75a535a601612196ef66151a4685723e048848f
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/23/2019
ms.locfileid: "61797489"
---
# <a name="message-flow-overview"></a><span data-ttu-id="96b29-102">Przegląd przepływu komunikatu</span><span class="sxs-lookup"><span data-stu-id="96b29-102">Message Flow Overview</span></span>
<span data-ttu-id="96b29-103">W rozproszonym systemie zawierający wzajemnie połączonych usług należy określić przyczynowego relacje między usługami.</span><span class="sxs-lookup"><span data-stu-id="96b29-103">In a distributed system containing interconnected services, it is necessary to determine causal relationships between the services.</span></span> <span data-ttu-id="96b29-104">Jest ważne poznać różne składniki, które były częścią przepływu żądania w celu obsługi scenariuszy o kluczowym znaczeniu, takich jak kondycja, monitorowanie, rozwiązywanie problemów i główny ustalić przyczynę problemu.</span><span class="sxs-lookup"><span data-stu-id="96b29-104">It is important to understand the various components that were part of a request flow to support critical scenarios such as health monitoring, troubleshooting, and root cause analysis.</span></span> <span data-ttu-id="96b29-105">Aby włączyć korelacja różnych usług w programie .NET Framework 4 ślady Dodaliśmy obsługę funkcji za pomocą następujących funkcji:</span><span class="sxs-lookup"><span data-stu-id="96b29-105">To enable the correlation of traces between various services, in the .NET Framework 4 we added support through the following features:</span></span>

- <span data-ttu-id="96b29-106">Śledzenie analityczne: Wysoka wydajność i funkcję śledzenia niski poziom szczegółowości przy użyciu śledzenie zdarzeń dla Windows (ETW).</span><span class="sxs-lookup"><span data-stu-id="96b29-106">Analytic tracing: A high performance and low verbosity tracing feature using Event Tracing for Windows (ETW).</span></span>

- <span data-ttu-id="96b29-107">Model działania end-to-end dla usług WCF/WF: Ta funkcja obsługuje korelacji śledzenia generowane przez <xref:System.ServiceModel> i <xref:System.Workflow.ComponentModel> przestrzeni nazw.</span><span class="sxs-lookup"><span data-stu-id="96b29-107">End-to-end activity model for WCF/WF services: This feature supports correlation of traces generated by the <xref:System.ServiceModel> and <xref:System.Workflow.ComponentModel> namespaces.</span></span>

- <span data-ttu-id="96b29-108">ETW śledzenia dla WF: Ta funkcja używa rekordów śledzenia generowanych przez usługi WF, aby zapewnić wgląd w bieżący stan i postęp przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="96b29-108">ETW tracking for WF: This feature uses tracking records generated by WF services to provide visibility into the workflow’s current state and progress.</span></span>

 <span data-ttu-id="96b29-109">Błędy zalogowany śledzenia i śledzenia rekordów może służyć do znalezienia usterek kodu lub niepoprawnie uformowane wiadomości.</span><span class="sxs-lookup"><span data-stu-id="96b29-109">Errors logged in a tracking or tracing record can be used to find code defects or incorrectly formed messages.</span></span> <span data-ttu-id="96b29-110">Właściwość Identyfikator korelacji węzła w nagłówku komunikatu zdarzenia może służyć do określenia łagodne działanie.</span><span class="sxs-lookup"><span data-stu-id="96b29-110">The ActivityId property of the Correlation node in the event’s message header can be used to determine the faulting activity.</span></span> <span data-ttu-id="96b29-111">Aby włączyć śledzenia przepływu komunikatów za pomocą Identyfikatora działania, zobacz [Konfigurowanie śledzenia przepływu komunikatów](../../../../docs/framework/wcf/diagnostics/etw/configuring-message-flow-tracing.md).</span><span class="sxs-lookup"><span data-stu-id="96b29-111">To enable message flow tracing by activity ID, see [Configuring Message Flow Tracing](../../../../docs/framework/wcf/diagnostics/etw/configuring-message-flow-tracing.md).</span></span> <span data-ttu-id="96b29-112">W tym temacie pokazano, jak włączyć śledzenie przepływu wiadomości w projekcie, utworzone w ramach samouczka Wprowadzenie.</span><span class="sxs-lookup"><span data-stu-id="96b29-112">This topic demonstrates how to enable message flow tracing in the project created in the Getting Started tutorial.</span></span>

### <a name="to-enable-message-flow-tracing-in-the-getting-started-tutorial"></a><span data-ttu-id="96b29-113">Aby włączyć śledzenia przepływu komunikatów w ramach samouczka Wprowadzenie</span><span class="sxs-lookup"><span data-stu-id="96b29-113">To enable message flow tracing in the Getting Started tutorial</span></span>

1. <span data-ttu-id="96b29-114">Otwórz Podgląd zdarzeń, klikając **Start**, **Uruchom**i wprowadzając `eventvwr.exe`.</span><span class="sxs-lookup"><span data-stu-id="96b29-114">Open Event Viewer by clicking **Start**, **Run**, and entering `eventvwr.exe`.</span></span>

2. <span data-ttu-id="96b29-115">Jeśli nie zostały włączone śledzenie danych analitycznych, rozwiń **Dzienniki aplikacji i usług**, **Microsoft**, **Windows**, **aplikacje serwera aplikacji** .</span><span class="sxs-lookup"><span data-stu-id="96b29-115">If you haven’t enabled analytic tracing, expand **Applications and Services Logs**, **Microsoft**, **Windows**, **Application Server-Applications**.</span></span> <span data-ttu-id="96b29-116">Wybierz **widoku**, **Pokaż analityczne i debugowania dzienniki**.</span><span class="sxs-lookup"><span data-stu-id="96b29-116">Select **View**, **Show Analytic and Debug Logs**.</span></span> <span data-ttu-id="96b29-117">Kliknij prawym przyciskiem myszy **analityczne** i wybierz **Włącz dziennik**.</span><span class="sxs-lookup"><span data-stu-id="96b29-117">Right-click **Analytic** and select **Enable Log**.</span></span> <span data-ttu-id="96b29-118">Pozostaw otwarte Podgląd zdarzeń, dzięki czemu można wyświetlić ślady.</span><span class="sxs-lookup"><span data-stu-id="96b29-118">Leave Event Viewer open so that traces can be viewed.</span></span>

3. <span data-ttu-id="96b29-119">Otwórz plik, który został utworzony w [Samouczek wprowadzający](../../../../docs/framework/wcf/getting-started-tutorial.md) w programie Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="96b29-119">Open the sample created in the [Getting Started Tutorial](../../../../docs/framework/wcf/getting-started-tutorial.md) in Visual Studio 2012.</span></span> <span data-ttu-id="96b29-120">Należy pamiętać, że należy uruchomić program Visual Studio 2012 jako administrator, aby tworzyć usługi.</span><span class="sxs-lookup"><span data-stu-id="96b29-120">Note that you must run Visual Studio 2012 as an administrator so that the service can be created.</span></span> <span data-ttu-id="96b29-121">Jeśli masz zainstalowanych przykładów WCF, możesz otworzyć [wprowadzenie](../../../../docs/framework/wcf/samples/getting-started-sample.md), zawierającą ukończone projekt utworzony w tym samouczku.</span><span class="sxs-lookup"><span data-stu-id="96b29-121">If you have the WCF samples installed, you can open the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md), which contains the completed project created in the tutorial.</span></span>

4. <span data-ttu-id="96b29-122">Kliknij prawym przyciskiem myszy **usługi** projektu, a następnie wybierz **Dodaj**, **nowy element**.</span><span class="sxs-lookup"><span data-stu-id="96b29-122">Right-click the **Service** project and select **Add**, **New Item**.</span></span> <span data-ttu-id="96b29-123">Wybierz **pliku konfiguracji aplikacji** i kliknij przycisk **OK**.</span><span class="sxs-lookup"><span data-stu-id="96b29-123">Select **Application Configuration File** and click **OK**.</span></span>

5. <span data-ttu-id="96b29-124">Dodaj następujący kod do pliku App.Config utworzonego w poprzednim kroku.</span><span class="sxs-lookup"><span data-stu-id="96b29-124">Add the following code to the App.Config file created in the previous step.</span></span>

    ```xml
    <system.serviceModel>
      <diagnostics>
        <endToEndTracing propagateActivity="true" messageFlowTracing="true"/>
      </diagnostics>
    </system.serviceModel>
    ```

6. <span data-ttu-id="96b29-125">Wykonywanie aplikacji serwera bez debugowania, naciskając klawisze CTRL + F5.</span><span class="sxs-lookup"><span data-stu-id="96b29-125">Execute the server application without debugging by pressing CTRL+F5.</span></span> <span data-ttu-id="96b29-126">Wykonaj projekt klienta, klikając prawym przyciskiem myszy **klienta** projektu i wybierając polecenie **debugowania**, **Uruchom nowe wystąpienie**.</span><span class="sxs-lookup"><span data-stu-id="96b29-126">Execute the client project by right-clicking the **Client** project and selecting **Debug**, **Start New Instance**.</span></span>

7. <span data-ttu-id="96b29-127">Aby śledzić zdarzenia od klienta do serwera, Dodaj następujący element do pliku konfiguracji aplikacji w projekcie klienta.</span><span class="sxs-lookup"><span data-stu-id="96b29-127">To trace the events from the client to the server, add the following to the application configuration file in the Client project.</span></span>

    ```xml
    <diagnostics>
      <endToEndTracing propagateActivity="true" messageFlowTracing="true"/>
    </diagnostics>
    ```

8. <span data-ttu-id="96b29-128">W pliku Program.cs w kliencie Dodaj następującą instrukcję Using.</span><span class="sxs-lookup"><span data-stu-id="96b29-128">In Program.cs in the client, add the following Using statement.</span></span>

    ```csharp
    using System.Diagnostics;
    ```

9. <span data-ttu-id="96b29-129">W ramach metody Main w pliku program.cs w projekcie klienta należy ustawić GUID śledzenia i propagowane w dzienniku zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="96b29-129">In the Main method in the program.cs file in the client project, set the Trace GUID to be propagated in the event log.</span></span>

    ```csharp
    Guid guid = Guid.NewGuid();
    Trace.CorrelationManager.ActivityId = guid;
    ```

10. <span data-ttu-id="96b29-130">Odśwież i zbadać **analityczne** dziennika.</span><span class="sxs-lookup"><span data-stu-id="96b29-130">Refresh and examine the **Analytic**  log.</span></span>  <span data-ttu-id="96b29-131">Wyszukaj zdarzenia z 220 identyfikator zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="96b29-131">Look for an event with Event ID 220.</span></span>  <span data-ttu-id="96b29-132">Wybierz zdarzenie, a następnie kliknij przycisk **szczegóły** tab w okienku podglądu.</span><span class="sxs-lookup"><span data-stu-id="96b29-132">Select the event, and click the **Details** tab in the preview pane.</span></span> <span data-ttu-id="96b29-133">To zdarzenie będzie zawierać identyfikator korelacji dla działania wywołania.</span><span class="sxs-lookup"><span data-stu-id="96b29-133">This event will contain the correlation ID for the calling activity.</span></span>

    ```xml
    <Correlation ActivityID="{A066CCF1-8AB3-459B-B62F-F79F957A5036}" />
    ```

    > [!NOTE]
    >  <span data-ttu-id="96b29-134">Wszystkie zdarzenia z tego samego identyfikatora GUID w identyfikator odnoszą się do jednego żądania.</span><span class="sxs-lookup"><span data-stu-id="96b29-134">All events with the same GUID in the ActivityID are related to one request.</span></span> <span data-ttu-id="96b29-135">To może służyć do skorelowania wiadomości z określonego klienta do określonej usługi.</span><span class="sxs-lookup"><span data-stu-id="96b29-135">This can be used to correlate messages from a specific client to a specific service.</span></span> <span data-ttu-id="96b29-136">Jeśli klient wywołuje inną usługę, ten sam klient może być identyfikowany przez identyfikator działania.</span><span class="sxs-lookup"><span data-stu-id="96b29-136">If the client called another service, then the same client could be identified by ActivityID.</span></span>

11. <span data-ttu-id="96b29-137">W niektórych przypadkach identyfikator można zmienić z oryginalnego identyfikatora GUID na nowy identyfikator działania.</span><span class="sxs-lookup"><span data-stu-id="96b29-137">In some cases, the ActivityID can change from the original GUID to a new ActivityID.</span></span> <span data-ttu-id="96b29-138">W takiej sytuacji jest emitowane transferuje zdarzenie.</span><span class="sxs-lookup"><span data-stu-id="96b29-138">In that case, a transfer event is emitted.</span></span> <span data-ttu-id="96b29-139">Ten identyfikator zdarzenia jest 499 i zdarzenie będzie zawierać następujące dane w nagłówku.</span><span class="sxs-lookup"><span data-stu-id="96b29-139">This event ID is 499, and the event will contain the following data in the header.</span></span>

    ```xml
    <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
        <System>
            <Provider Name="Microsoft-Windows-Application Server-Applications" Guid="{c651f5f6-1c0d-492e-8ae1-b4efd7c9d503}" />
            <EventID>499</EventID>
            ...
            <Correlation ActivityID="{A066CCF1-8AB3-459B-B62F-F79F957A5036}" RelatedActivityID="{85FC0930-9C49-42DA-804B-A7368104BD1B}" />
            ...
       </System>
    </Event>
    ```

    > [!NOTE]
    >  <span data-ttu-id="96b29-140">Zdarzenia transferu rejestruje zmiany active ActivityID z identyfikatorem GUID określony jako identyfikator działania zgodnie z identyfikatorem GUID określony jako RelatedActivityID.</span><span class="sxs-lookup"><span data-stu-id="96b29-140">The transfer event records the change of the active ActivityID from the GUID specified as the ActivityID to the GUID specified as RelatedActivityID.</span></span> <span data-ttu-id="96b29-141">Po transferuje zdarzenie jest emitowane, wszystkie zdarzenia będą zawierały nowy identyfikator GUID, jako identyfikator działania.</span><span class="sxs-lookup"><span data-stu-id="96b29-141">After the transfer event is emitted, all events will contain the new GUID as the ActivityID.</span></span>
