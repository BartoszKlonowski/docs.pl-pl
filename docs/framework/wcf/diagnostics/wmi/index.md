---
title: Używanie Instrumentacji zarządzania Windows na potrzeby diagnostyki
ms.date: 03/30/2017
ms.assetid: fe48738d-e31b-454d-b5ec-24c85c6bf79a
ms.openlocfilehash: 9acb1b280248f8552680ea3fbba831b3de53b2c3
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: HT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/18/2019
ms.locfileid: "59308591"
---
# <a name="using-windows-management-instrumentation-for-diagnostics"></a><span data-ttu-id="05d95-102">Używanie Instrumentacji zarządzania Windows na potrzeby diagnostyki</span><span class="sxs-lookup"><span data-stu-id="05d95-102">Using Windows Management Instrumentation for Diagnostics</span></span>
<span data-ttu-id="05d95-103">Windows Communication Foundation (WCF) uwidacznia dane inspekcji usługi w czasie wykonywania za pośrednictwem dostawcy Instrumentacji zarządzania Windows (WMI) WCF.</span><span class="sxs-lookup"><span data-stu-id="05d95-103">Windows Communication Foundation (WCF) exposes inspection data of a service at runtime through a WCF Windows Management Instrumentation (WMI) provider.</span></span>  
  
## <a name="enabling-wmi"></a><span data-ttu-id="05d95-104">Włączanie usługi WMI</span><span class="sxs-lookup"><span data-stu-id="05d95-104">Enabling WMI</span></span>  
 <span data-ttu-id="05d95-105">WMI jest implementacja firmy Microsoft opartego na sieci Web Enterprise Management (WBEM) standardowa.</span><span class="sxs-lookup"><span data-stu-id="05d95-105">WMI is Microsoft's implementation of the Web-Based Enterprise Management (WBEM) standard.</span></span> <span data-ttu-id="05d95-106">Aby uzyskać więcej informacji na temat zestawu SDK usługi WMI, zobacz [Instrumentacji zarządzania Windows](/windows/desktop/WmiSdk/wmi-start-page).</span><span class="sxs-lookup"><span data-stu-id="05d95-106">For more information about the WMI SDK, see [Windows Management Instrumentation](/windows/desktop/WmiSdk/wmi-start-page).</span></span> <span data-ttu-id="05d95-107">Technologia WBEM jest branżowy standard jak aplikacje uwidocznić Instrumentacji zarządzania do narzędzi zarządzania zewnętrznego.</span><span class="sxs-lookup"><span data-stu-id="05d95-107">WBEM is an industry standard for how applications expose management instrumentation to external management tools.</span></span>  
  
 <span data-ttu-id="05d95-108">Dostawca WMI jest składnik, który udostępnia Instrumentacji w czasie wykonywania za pomocą interfejsu WBEM zgodne.</span><span class="sxs-lookup"><span data-stu-id="05d95-108">A WMI provider is a component that exposes instrumentation at runtime through a WBEM-compatible interface.</span></span> <span data-ttu-id="05d95-109">Składa się z zestawu obiektów WMI, które mają atrybut/pary wartości.</span><span class="sxs-lookup"><span data-stu-id="05d95-109">It consists of a set of WMI objects that have attribute/value pairs.</span></span> <span data-ttu-id="05d95-110">Pary może mieć wiele typów prostych.</span><span class="sxs-lookup"><span data-stu-id="05d95-110">Pairs can be of a number of simple types.</span></span> <span data-ttu-id="05d95-111">Narzędzia do zarządzania może nawiązać połączenia usług za pośrednictwem interfejsu w czasie wykonywania.</span><span class="sxs-lookup"><span data-stu-id="05d95-111">Management tools can connect to the services through the interface at runtime.</span></span> <span data-ttu-id="05d95-112">Usługa WCF umożliwia atrybuty usługi, takie jak adresy, powiązania, zachowań i odbiorników.</span><span class="sxs-lookup"><span data-stu-id="05d95-112">WCF exposes attributes of services such as addresses, bindings, behaviors, and listeners.</span></span>  
  
 <span data-ttu-id="05d95-113">Wbudowany dostawca usługi WMI można aktywować w pliku konfiguracyjnym aplikacji.</span><span class="sxs-lookup"><span data-stu-id="05d95-113">The built-in WMI provider can be activated in the configuration file of the application.</span></span> <span data-ttu-id="05d95-114">Jest to realizowane `wmiProviderEnabled` atrybutu [ \<Diagnostyka >](../../../../../docs/framework/configure-apps/file-schema/wcf/diagnostics.md) w [ \<system.serviceModel >](../../../../../docs/framework/configure-apps/file-schema/wcf/system-servicemodel.md) sekcji, jak pokazano w następującym przykładzie Konfiguracja.</span><span class="sxs-lookup"><span data-stu-id="05d95-114">This is done through the `wmiProviderEnabled` attribute of the [\<diagnostics>](../../../../../docs/framework/configure-apps/file-schema/wcf/diagnostics.md) in the [\<system.serviceModel>](../../../../../docs/framework/configure-apps/file-schema/wcf/system-servicemodel.md) section, as shown in the following sample configuration.</span></span>  
  
```xml  
<system.serviceModel>  
    …  
    <diagnostics wmiProviderEnabled="true" />  
    …  
</system.serviceModel>  
```  
  
 <span data-ttu-id="05d95-115">Ten wpis konfiguracji udostępnia interfejs usługi WMI.</span><span class="sxs-lookup"><span data-stu-id="05d95-115">This configuration entry exposes a WMI interface.</span></span> <span data-ttu-id="05d95-116">Aplikacje do zarządzania można teraz nawiązać połączenie za pośrednictwem tego interfejsu i uzyskać dostęp z Instrumentacją zarządzania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="05d95-116">Management applications can now connect through this interface and access the management instrumentation of the application.</span></span>  
  
## <a name="accessing-wmi-data"></a><span data-ttu-id="05d95-117">Uzyskiwanie dostępu do danych usługi WMI</span><span class="sxs-lookup"><span data-stu-id="05d95-117">Accessing WMI Data</span></span>  
 <span data-ttu-id="05d95-118">Dane usługi WMI są dostępne na wiele różnych sposobów.</span><span class="sxs-lookup"><span data-stu-id="05d95-118">WMI data can be accessed in many different ways.</span></span> <span data-ttu-id="05d95-119">Firma Microsoft udostępnia interfejsy API usługi WMI dla skryptów, aplikacji Visual Basic, aplikacji w języku C++ i [!INCLUDE[dnprdnshort](../../../../../includes/dnprdnshort-md.md)].</span><span class="sxs-lookup"><span data-stu-id="05d95-119">Microsoft provides WMI APIs for scripts, Visual Basic applications, C++ applications, and the [!INCLUDE[dnprdnshort](../../../../../includes/dnprdnshort-md.md)].</span></span> <span data-ttu-id="05d95-120">Aby uzyskać więcej informacji, zobacz [przy użyciu usługi WMI](https://go.microsoft.com/fwlink/?LinkId=95183).</span><span class="sxs-lookup"><span data-stu-id="05d95-120">For more information, see [Using WMI](https://go.microsoft.com/fwlink/?LinkId=95183).</span></span>  
  
> [!CAUTION]
>  <span data-ttu-id="05d95-121">Jeśli używasz programu .NET Framework, pod warunkiem metody do programowego dostępu do danych usługi WMI, należy pamiętać, że tych metod może zgłaszają wyjątki, gdy połączenie zostanie nawiązane.</span><span class="sxs-lookup"><span data-stu-id="05d95-121">If you use the .NET Framework provided methods to programmatically access WMI data, you should be aware that such methods may throw exceptions when the connection is established.</span></span> <span data-ttu-id="05d95-122">Połączenie nie zostanie nawiązane podczas konstruowania <xref:System.Management.ManagementObject> wystąpienia, ale pierwszego żądania obejmujące rzeczywiste dane programu exchange.</span><span class="sxs-lookup"><span data-stu-id="05d95-122">The connection is not established during the construction of the <xref:System.Management.ManagementObject> instance, but on the first request involving actual data exchange.</span></span> <span data-ttu-id="05d95-123">Dlatego należy używać `try..catch` bloku catch możliwych wyjątków.</span><span class="sxs-lookup"><span data-stu-id="05d95-123">Therefore, you should use a `try..catch` block to catch the possible exceptions.</span></span>  
  
 <span data-ttu-id="05d95-124">Można zmienić, śledzenia i poziom rejestrowania wiadomości, a także opcje rejestrowania komunikatów dla `System.ServiceModel` źródła śledzenia w usłudze WMI.</span><span class="sxs-lookup"><span data-stu-id="05d95-124">You can change the trace and message logging level, as well as message logging options for the `System.ServiceModel` trace source in WMI.</span></span> <span data-ttu-id="05d95-125">Można to zrobić, uzyskując dostęp do [AppDomainInfo](../../../../../docs/framework/wcf/diagnostics/wmi/appdomaininfo.md) wystąpienia, który uwidacznia następujące właściwości logiczne: `LogMessagesAtServiceLevel`, `LogMessagesAtTransportLevel`, `LogMalformedMessages`, i `TraceLevel`.</span><span class="sxs-lookup"><span data-stu-id="05d95-125">This can be done by accessing the [AppDomainInfo](../../../../../docs/framework/wcf/diagnostics/wmi/appdomaininfo.md) instance, which exposes these Boolean properties: `LogMessagesAtServiceLevel`, `LogMessagesAtTransportLevel`, `LogMalformedMessages`, and `TraceLevel`.</span></span> <span data-ttu-id="05d95-126">W związku z tym, jeśli Konfigurowanie odbiornika śledzenia dla rejestrowania komunikatów, ale ustawiony korzystać z tych opcji do `false` w konfiguracji można później zmienić ich `true` gdy aplikacja jest uruchomiona.</span><span class="sxs-lookup"><span data-stu-id="05d95-126">Therefore, if you configure a trace listener for message logging, but set these options to `false` in configuration, you can later change them to `true` when the application is running.</span></span> <span data-ttu-id="05d95-127">Umożliwi to efektywne rejestrowanie komunikatów w czasie wykonywania.</span><span class="sxs-lookup"><span data-stu-id="05d95-127">This will effectively enable message logging at runtime.</span></span> <span data-ttu-id="05d95-128">Podobnie jeśli włączysz rejestrowanie w pliku konfiguracyjnym komunikatów, można ją wyłączyć w czasie wykonywania przy użyciu usługi WMI.</span><span class="sxs-lookup"><span data-stu-id="05d95-128">Similarly, if you enable message logging in your configuration file, you can disable it at runtime using WMI.</span></span>  
  
 <span data-ttu-id="05d95-129">Należy pamiętać, że jeśli nie rejestrowania komunikatów śledzenia, detektory rejestrowanie komunikatów lub nie `System.ServiceModel` detektorów śledzenia do śledzenia są określone w pliku konfiguracji, żadne zmiany wykonane w życie, nawet jeśli zmiany zostaną zaakceptowane przez usługę WMI.</span><span class="sxs-lookup"><span data-stu-id="05d95-129">You should be aware that if no message logging trace listeners for message logging, or no `System.ServiceModel` trace listeners for tracing are specified in the configuration file, none of your changes are taken into effect, even though the changes are accepted by WMI.</span></span> <span data-ttu-id="05d95-130">Aby uzyskać więcej informacji na temat prawidłowo konfigurowania odpowiednich odbiorników, zobacz [Konfigurowanie rejestrowania komunikatów](../../../../../docs/framework/wcf/diagnostics/configuring-message-logging.md) i [Konfigurowanie śledzenia](../../../../../docs/framework/wcf/diagnostics/tracing/configuring-tracing.md).</span><span class="sxs-lookup"><span data-stu-id="05d95-130">For more information on properly setting up the respective listeners, see [Configuring Message Logging](../../../../../docs/framework/wcf/diagnostics/configuring-message-logging.md) and [Configuring Tracing](../../../../../docs/framework/wcf/diagnostics/tracing/configuring-tracing.md).</span></span> <span data-ttu-id="05d95-131">Poziom śledzenia wszystkie inne źródła śledzenia określony w konfiguracji jest efektywne, podczas uruchamiania aplikacji i nie można zmienić.</span><span class="sxs-lookup"><span data-stu-id="05d95-131">The trace level of all other trace sources specified by configuration is effective when the application starts, and cannot be changed.</span></span>  
  
 <span data-ttu-id="05d95-132">Usługa WCF umożliwia `GetOperationCounterInstanceName` metody dla skryptów.</span><span class="sxs-lookup"><span data-stu-id="05d95-132">WCF exposes a `GetOperationCounterInstanceName` method for scripting.</span></span> <span data-ttu-id="05d95-133">Ta metoda zwraca nazwę wystąpienia licznika wydajności, jeśli podasz operacji o nazwie.</span><span class="sxs-lookup"><span data-stu-id="05d95-133">This method returns a performance counter instance name if you provide it with an operation name.</span></span> <span data-ttu-id="05d95-134">Dane wejściowe nie są jednak zweryfikować.</span><span class="sxs-lookup"><span data-stu-id="05d95-134">However, it does not validate your input.</span></span> <span data-ttu-id="05d95-135">W związku z tym Jeśli podasz nazwę operacji niepoprawne, zwracana jest nazwa licznika niepoprawne.</span><span class="sxs-lookup"><span data-stu-id="05d95-135">Therefore, if you provide an incorrect operation name, an incorrect counter name is returned.</span></span>  
  
 <span data-ttu-id="05d95-136">`OutgoingChannel` Właściwość `Service` wystąpienia nie są liczone otwierane przez usługę, aby nawiązać połączenie z innej usługi, jeśli klient WCF w usłudze docelowej nie jest tworzony w ramach kanałów `Service` metody.</span><span class="sxs-lookup"><span data-stu-id="05d95-136">The `OutgoingChannel` property of the `Service` instance does not count channels opened by a service to connect to another service, if the WCF client to the destination service is not created within the `Service` method.</span></span>  
  
 <span data-ttu-id="05d95-137">**Ostrzeżenie** obsługuje tylko WMI <xref:System.TimeSpan> wartość maksymalnie 3 separatorów dziesiętnych.</span><span class="sxs-lookup"><span data-stu-id="05d95-137">**Caution** WMI only supports a <xref:System.TimeSpan> value up to 3 decimal points.</span></span> <span data-ttu-id="05d95-138">Na przykład, jeśli Usługa ustawia jeden z jego właściwości w celu <xref:System.TimeSpan.MaxValue>, jego wartość zostanie obcięta po 3 dziesiętnymi, po wyświetleniu za pomocą usługi WMI.</span><span class="sxs-lookup"><span data-stu-id="05d95-138">For example, if your service sets one of its properties to <xref:System.TimeSpan.MaxValue>, its value is truncated after 3 decimal points when viewed through WMI.</span></span>  
  
## <a name="security"></a><span data-ttu-id="05d95-139">Zabezpieczenia</span><span class="sxs-lookup"><span data-stu-id="05d95-139">Security</span></span>  
 <span data-ttu-id="05d95-140">Ponieważ dostawca WCF WMI umożliwia odnajdowanie usług w środowisku, należy zachować ostrożność extreme przyznawania dostępu do niego.</span><span class="sxs-lookup"><span data-stu-id="05d95-140">Because the WCF WMI provider allows the discovery of services in an environment, you should exercise extreme caution for granting access to it.</span></span> <span data-ttu-id="05d95-141">Odpoczynku domyślnego dostępu tylko administrator może zezwolić na niższym poziomie zaufania strony dostępu do poufnych danych w danym środowisku.</span><span class="sxs-lookup"><span data-stu-id="05d95-141">If you relax the default administrator-only access, you may allow less-trusted parties access to sensitive data in your environment.</span></span> <span data-ttu-id="05d95-142">W szczególności jeśli uprawnienia dostępu zdalnego WMI jest Poluzuj, przepełnieniu ataków mogą wystąpić.</span><span class="sxs-lookup"><span data-stu-id="05d95-142">Specifically, if you loosen permissions on remote WMI access, flooding attacks can occur.</span></span> <span data-ttu-id="05d95-143">Jeśli proces jest wypełniony nadmierne żądań WMI, jego wydajność może być niższa.</span><span class="sxs-lookup"><span data-stu-id="05d95-143">If a process is flooded by excessive WMI requests, its performance can be degraded.</span></span>  
  
 <span data-ttu-id="05d95-144">Ponadto jeśli odpoczynku uprawnienia dostępu do pliku MOF niższym poziomie zaufania strony można manipulować zachowanie usługi WMI i zmienianie obiektów, które są ładowane w schemacie usługi WMI.</span><span class="sxs-lookup"><span data-stu-id="05d95-144">In addition, if you relax access permissions for the MOF file, less-trusted parties can manipulate the behavior of WMI and alter the objects that are loaded in the WMI schema.</span></span> <span data-ttu-id="05d95-145">Na przykład pola można usunąć w taki sposób, że krytyczne dane są ukrywane przez administratora lub pola, które nie wypełnić lub spowodować, że wyjątki są dodawane do pliku.</span><span class="sxs-lookup"><span data-stu-id="05d95-145">For example, fields can be removed such that critical data is concealed from the administrator or that fields that do not populate or cause exceptions are added to the file.</span></span>  
  
 <span data-ttu-id="05d95-146">Domyślnie dostawca WMI programu WCF zapewnia "wykonania metody", "Zapisywanie dostawcy" i "Włącz konto" uprawnień administratora i uprawnienia "Włącz konto" dla platformy ASP.NET, Usługa lokalna i Usługa sieciowa.</span><span class="sxs-lookup"><span data-stu-id="05d95-146">By default, the WCF WMI provider grants "execute method", "provider write", and "enable account" permission for Administrator, and "enable account" permission for ASP.NET, Local Service and Network Service.</span></span> <span data-ttu-id="05d95-147">W szczególności na non -[!INCLUDE[wv](../../../../../includes/wv-md.md)] platform, konto ASP.NET ma dostęp do odczytu do przestrzeni nazw usługi WMI elementu ServiceModel.</span><span class="sxs-lookup"><span data-stu-id="05d95-147">In particular, on non-[!INCLUDE[wv](../../../../../includes/wv-md.md)] platforms, the ASP.NET account has read access to the WMI ServiceModel namespace.</span></span> <span data-ttu-id="05d95-148">Jeśli użytkownik nie chce przyznać te uprawnienia do określonej grupy użytkowników, należy albo Dezaktywuj dostawca usługi WMI (go jest domyślnie wyłączona) lub wyłączenie dostępu do określonej grupy użytkowników.</span><span class="sxs-lookup"><span data-stu-id="05d95-148">If you do not want to grant these privileges to a particular user group, you should either deactivate the WMI provider (it is disabled by default), or disable access for the specific user group.</span></span>  
  
 <span data-ttu-id="05d95-149">Ponadto podczas próby włączenia usługi WMI za pomocą konfiguracji usługi WMI może nie być włączona ze względu na niewystarczające użytkownika uprawnień.</span><span class="sxs-lookup"><span data-stu-id="05d95-149">In addition, when you attempt to enable WMI through configuration, WMI may not be enabled due to insufficient user privilege.</span></span> <span data-ttu-id="05d95-150">Jednak żadne zdarzenie jest zapisywane w dzienniku zdarzeń, aby zarejestrować tego błędu.</span><span class="sxs-lookup"><span data-stu-id="05d95-150">However, no event is written to the event log to record this failure.</span></span>  
  
 <span data-ttu-id="05d95-151">Aby zmodyfikować poziomach uprawnień użytkownika, użyj następujących kroków.</span><span class="sxs-lookup"><span data-stu-id="05d95-151">To modify user privilege levels, use the following steps.</span></span>  
  
1. <span data-ttu-id="05d95-152">Kliknij przycisk Uruchom, uruchom i wpisz **compmgmt.msc**.</span><span class="sxs-lookup"><span data-stu-id="05d95-152">Click Start and then Run and type **compmgmt.msc**.</span></span>  
  
2. <span data-ttu-id="05d95-153">Kliknij prawym przyciskiem myszy **usług i aplikacji/WMI kontrolki** wybrać **właściwości**.</span><span class="sxs-lookup"><span data-stu-id="05d95-153">Right-click **Services and Application/WMI Controls** to select **Properties**.</span></span>  
  
3. <span data-ttu-id="05d95-154">Wybierz **zabezpieczeń** karcie i przejdź do **główny/ServiceModel** przestrzeni nazw.</span><span class="sxs-lookup"><span data-stu-id="05d95-154">Select the **Security** Tab, and navigate to the **Root/ServiceModel** namespace.</span></span> <span data-ttu-id="05d95-155">Kliknij przycisk **zabezpieczeń** przycisku.</span><span class="sxs-lookup"><span data-stu-id="05d95-155">Click the **Security** button.</span></span>  
  
4. <span data-ttu-id="05d95-156">Wybierz konkretną grupę lub użytkownika, który ma być kontroli dostępu i użycia **Zezwalaj** lub **Odmów** pole wyboru, aby skonfigurować uprawnienia.</span><span class="sxs-lookup"><span data-stu-id="05d95-156">Select the specific group or user that you want to control access and use the **Allow** or **Deny** checkbox to configure permissions.</span></span>  
  
## <a name="granting-wcf-wmi-registration-permissions-to-additional-users"></a><span data-ttu-id="05d95-157">Udzielanie uprawnień rejestracji WCF WMI do dodatkowych użytkowników</span><span class="sxs-lookup"><span data-stu-id="05d95-157">Granting WCF WMI Registration Permissions to Additional Users</span></span>  
 <span data-ttu-id="05d95-158">Usługa WCF umożliwia danych zarządzania usługą WMI.</span><span class="sxs-lookup"><span data-stu-id="05d95-158">WCF exposes management data to WMI.</span></span> <span data-ttu-id="05d95-159">Robi to dzięki hostowaniu dostawcę WMI w procesie, czasami nazywane "dostawca odłączony".</span><span class="sxs-lookup"><span data-stu-id="05d95-159">It does so by hosting an in-process WMI provider, sometimes called a "decoupled provider".</span></span> <span data-ttu-id="05d95-160">W przypadku danych zarządzania ujawnianie konta, które rejestruje ten dostawca musi mieć odpowiednie uprawnienia.</span><span class="sxs-lookup"><span data-stu-id="05d95-160">For the management data to be exposed, the account that registers this provider must have the appropriate permissions.</span></span> <span data-ttu-id="05d95-161">W Windows tylko niewielki zestaw uprzywilejowanych kont można zarejestrować dostawcy odłączeni domyślnie.</span><span class="sxs-lookup"><span data-stu-id="05d95-161">In Windows, only a small set of privileged accounts can register decoupled providers by default.</span></span> <span data-ttu-id="05d95-162">Jest to problem, ponieważ użytkownicy często chcą udostępnianie z usługi WCF, uruchomiony w ramach konta, które nie znajduje się w domyślnym zestawem danych usługi WMI.</span><span class="sxs-lookup"><span data-stu-id="05d95-162">This is a problem because users commonly want to expose WMI data from a WCF service running under an account that is not in the default set.</span></span>  
  
 <span data-ttu-id="05d95-163">Aby zapewnić dostęp, administrator musi Przyznaj następujące uprawnienia do dodatkowe konta w następującej kolejności:</span><span class="sxs-lookup"><span data-stu-id="05d95-163">To provide this access, an administrator must grant the following permissions to the additional account in the following order:</span></span>  
  
1. <span data-ttu-id="05d95-164">Uprawnienie do dostępu do usług WCF Namespace WMI.</span><span class="sxs-lookup"><span data-stu-id="05d95-164">Permission to access to the WCF WMI Namespace.</span></span>  
  
2. <span data-ttu-id="05d95-165">Uprawnienia do rejestrowania dostawcy WMI odłączone WCF.</span><span class="sxs-lookup"><span data-stu-id="05d95-165">Permission to register the WCF Decoupled WMI Provider.</span></span>  
  
#### <a name="to-grant-wmi-namespace-access-permission"></a><span data-ttu-id="05d95-166">Aby udzielić uprawnień dostępu do przestrzeni nazw usługi WMI</span><span class="sxs-lookup"><span data-stu-id="05d95-166">To grant WMI namespace access permission</span></span>  
  
1. <span data-ttu-id="05d95-167">Uruchom poniższy skrypt programu PowerShell.</span><span class="sxs-lookup"><span data-stu-id="05d95-167">Run the following PowerShell script.</span></span>  
  
    ```powershell  
    write-host ""  
    write-host "Granting Access to root/servicemodel WMI namespace to built in users group"  
    write-host ""  
  
    # Create the binary representation of the permissions to grant in SDDL  
    $newPermissions = "O:BAG:BAD:P(A;CI;CCDCLCSWRPWPRCWD;;;BA)(A;CI;CC;;;NS)(A;CI;CC;;;LS)(A;CI;CC;;;BU)"  
    $converter = new-object system.management.ManagementClass Win32_SecurityDescriptorHelper  
    $binarySD = $converter.SDDLToBinarySD($newPermissions)  
    $convertedPermissions = ,$binarySD.BinarySD  
  
    # Get the object used to set the permissions  
    $security = gwmi -namespace root/servicemodel -class __SystemSecurity  
  
    # Get and output the current settings  
    $binarySD = @($null)  
    $result = $security.PsBase.InvokeMethod("GetSD",$binarySD)  
  
    $outsddl = $converter.BinarySDToSDDL($binarySD[0])  
    write-host "Previous ACL: "$outsddl.SDDL  
  
    # Change the Access Control List (ACL) using SDDL  
    $result = $security.PsBase.InvokeMethod("SetSD",$convertedPermissions)   
  
    # Get and output the current settings  
    $binarySD = @($null)  
    $result = $security.PsBase.InvokeMethod("GetSD",$binarySD)  
  
    $outsddl = $converter.BinarySDToSDDL($binarySD[0])  
    write-host "New ACL:      "$outsddl.SDDL  
    write-host ""  
    ```  
  
     <span data-ttu-id="05d95-168">Ten skrypt programu PowerShell używa definicji języka SDDL (Security Descriptor), aby udzielić dostępu grupy wbudowane użytkowników do obszaru nazw WMI "główny/servicemodel".</span><span class="sxs-lookup"><span data-stu-id="05d95-168">This PowerShell script uses Security Descriptor Definition Language (SDDL) to grant the Built-In Users group access to the "root/servicemodel" WMI namespace.</span></span> <span data-ttu-id="05d95-169">Określa następujące listy ACL:</span><span class="sxs-lookup"><span data-stu-id="05d95-169">It specifies the following ACLs:</span></span>  
  
    -   <span data-ttu-id="05d95-170">Wbudowanego konta administratora (BA) — już masz dostęp.</span><span class="sxs-lookup"><span data-stu-id="05d95-170">Built-In Administrator (BA) - Already Had Access.</span></span>  
  
    -   <span data-ttu-id="05d95-171">(NS) — Usługa sieciowa ma już dostęp.</span><span class="sxs-lookup"><span data-stu-id="05d95-171">Network Service (NS) - Already Had Access.</span></span>  
  
    -   <span data-ttu-id="05d95-172">System lokalny (LS) - już masz dostęp.</span><span class="sxs-lookup"><span data-stu-id="05d95-172">Local System (LS) - Already Had Access.</span></span>  
  
    -   <span data-ttu-id="05d95-173">Wbudowani użytkownicy — grupy, aby udzielić dostępu do.</span><span class="sxs-lookup"><span data-stu-id="05d95-173">Built-In Users - The group to grant access to.</span></span>  
  
#### <a name="to-grant-provider-registration-access"></a><span data-ttu-id="05d95-174">Aby udzielić dostawcy dostępu rejestracji</span><span class="sxs-lookup"><span data-stu-id="05d95-174">To grant provider registration access</span></span>  
  
1. <span data-ttu-id="05d95-175">Uruchom poniższy skrypt programu PowerShell.</span><span class="sxs-lookup"><span data-stu-id="05d95-175">Run the following PowerShell script.</span></span>  
  
    ```powershell  
    write-host ""  
    write-host "Granting WCF provider registration access to built in users group"  
    write-host ""  
    # Set security on ServiceModel provider  
    $provider = get-WmiObject -namespace "root\servicemodel" __Win32Provider  
  
    write-host "Previous ACL: "$provider.SecurityDescriptor  
    $result = $provider.SecurityDescriptor = "O:BUG:BUD:(A;;0x1;;;BA)(A;;0x1;;;NS)(A;;0x1;;;LS)(A;;0x1;;;BU)"  
  
    # Commit the changes and display it to the console  
    $result = $provider.Put()  
    write-host "New ACL:      "$provider.SecurityDescriptor  
    write-host ""  
    ```  
  
### <a name="granting-access-to-arbitrary-users-or-groups"></a><span data-ttu-id="05d95-176">Udzielanie dostępu do dowolnych użytkowników lub grup</span><span class="sxs-lookup"><span data-stu-id="05d95-176">Granting Access to Arbitrary Users or Groups</span></span>  
 <span data-ttu-id="05d95-177">W przykładzie w tej sekcji spowoduje przydzielenie uprawnień rejestracji dostawcy WMI dla wszystkich użytkowników lokalnych.</span><span class="sxs-lookup"><span data-stu-id="05d95-177">The example in this section grants WMI Provider registration privileges to all local users.</span></span> <span data-ttu-id="05d95-178">Jeśli chcesz udzielić dostępu do użytkownika lub grupy, która nie jest wbudowany, następnie należy uzyskać tego użytkownika lub grupy identyfikator zabezpieczeń (SID).</span><span class="sxs-lookup"><span data-stu-id="05d95-178">If you want to grant access to a user or group that is not built in, then you must obtain that user or group’s Security Identifier (SID).</span></span> <span data-ttu-id="05d95-179">Nie jest prostym sposobem pobrania identyfikatora SID dla dowolnego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="05d95-179">There is no simple way to get the SID for an arbitrary user.</span></span> <span data-ttu-id="05d95-180">Jedną z metod jest zalogowanie się jako odpowiedniego użytkownika i następnie należy wydać następujące polecenie powłoki.</span><span class="sxs-lookup"><span data-stu-id="05d95-180">One method is to log on as the desired user and then issue the following shell command.</span></span>  
  
```  
Whoami /user  
```  
  
 <span data-ttu-id="05d95-181">Zapewnia to identyfikator SID bieżącego użytkownika, ale ta metoda nie może służyć do pobrania identyfikatora SID dla dowolnego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="05d95-181">This provides the SID of the current user, but this method cannot be used to get the SID on any arbitrary user.</span></span> <span data-ttu-id="05d95-182">Inną metodą do pobrania identyfikatora SID jest użycie [getsid.exe](https://go.microsoft.com/fwlink/?LinkId=186467) narzędzia z [Windows 2000 Resource Kit Tools do wykonywania zadań administracyjnych](https://go.microsoft.com/fwlink/?LinkId=178660).</span><span class="sxs-lookup"><span data-stu-id="05d95-182">Another method to get the SID is to use the [getsid.exe](https://go.microsoft.com/fwlink/?LinkId=186467) tool from the [Windows 2000 Resource Kit Tools for administrative tasks](https://go.microsoft.com/fwlink/?LinkId=178660).</span></span> <span data-ttu-id="05d95-183">To narzędzie porównuje identyfikator SID dwóch użytkowników (lokalnego lub domeny), a po stronie efekt drukuje dwa identyfikatory SID w wierszu polecenia.</span><span class="sxs-lookup"><span data-stu-id="05d95-183">This tool compares the SID of two users (local or domain), and as a side effect prints the two SIDs to the command line.</span></span> <span data-ttu-id="05d95-184">Aby uzyskać więcej informacji, zobacz [dobrze znane identyfikatory SID](https://go.microsoft.com/fwlink/?LinkId=186468).</span><span class="sxs-lookup"><span data-stu-id="05d95-184">For more information, see [Well Known SIDs](https://go.microsoft.com/fwlink/?LinkId=186468).</span></span>  
  
## <a name="accessing-remote-wmi-object-instances"></a><span data-ttu-id="05d95-185">Uzyskiwanie dostępu do wystąpienia obiektu zdalną usługę WMI</span><span class="sxs-lookup"><span data-stu-id="05d95-185">Accessing Remote WMI Object Instances</span></span>  
 <span data-ttu-id="05d95-186">Jeśli potrzebujesz dostępu do wystąpień usługi WCF WMI na komputerze zdalnym, należy włączyć prywatność pakietów w menu Narzędzia, których używasz do dostępu.</span><span class="sxs-lookup"><span data-stu-id="05d95-186">If you need to access WCF WMI instances on a remote machine, you must enable packet privacy on the tools that you use for access.</span></span> <span data-ttu-id="05d95-187">W poniższej sekcji opisano sposób osiągnięcia je przy użyciu usługi WMI CIM Studio, Tester oprzyrządowania Instrumentacji zarządzania Windows, jak również zestaw .NET SDK 2.0.</span><span class="sxs-lookup"><span data-stu-id="05d95-187">The following section describes how to achieve these using the WMI CIM Studio, Windows Management Instrumentation Tester, as well as .NET SDK 2.0.</span></span>  
  
### <a name="wmi-cim-studio"></a><span data-ttu-id="05d95-188">WMI CIM Studio</span><span class="sxs-lookup"><span data-stu-id="05d95-188">WMI CIM Studio</span></span>  
 <span data-ttu-id="05d95-189">Jeśli zainstalowano [narzędzia administracyjne WMI](https://go.microsoft.com/fwlink/?LinkId=95185), można użyć WMI CIM Studio do wystąpień WMI dostępu.</span><span class="sxs-lookup"><span data-stu-id="05d95-189">If you have installed [WMI Administrative Tools](https://go.microsoft.com/fwlink/?LinkId=95185), you can use the WMI CIM Studio to access WMI instances.</span></span> <span data-ttu-id="05d95-190">Narzędzia znajdują się w następującym folderze</span><span class="sxs-lookup"><span data-stu-id="05d95-190">The tools are in the following folder</span></span>  
  
 <span data-ttu-id="05d95-191">**Narzędzia Files\WMI %Windir%\Program\\**</span><span class="sxs-lookup"><span data-stu-id="05d95-191">**%windir%\Program Files\WMI Tools\\**</span></span>  
  
1. <span data-ttu-id="05d95-192">W **nawiązywanie połączenia z przestrzeni nazw:** okna, typ **root\ServiceModel** i kliknij przycisk **OK.**</span><span class="sxs-lookup"><span data-stu-id="05d95-192">In the **Connect to namespace:** window, type **root\ServiceModel** and click **OK.**</span></span>  
  
2. <span data-ttu-id="05d95-193">W **WMI CIM Studio logowania** okna, kliknij przycisk **Opcje >>** przycisk, aby rozwinąć w oknie.</span><span class="sxs-lookup"><span data-stu-id="05d95-193">In the **WMI CIM Studio Login** window, click the **Options >>** button to expand the window.</span></span> <span data-ttu-id="05d95-194">Wybierz **prywatność pakietów** dla **poziom uwierzytelniania**i kliknij przycisk **OK**.</span><span class="sxs-lookup"><span data-stu-id="05d95-194">Select **Packet privacy** for **Authentication level**, and click **OK**.</span></span>  
  
### <a name="windows-management-instrumentation-tester"></a><span data-ttu-id="05d95-195">Tester oprzyrządowania Instrumentacji zarządzania Windows</span><span class="sxs-lookup"><span data-stu-id="05d95-195">Windows Management Instrumentation Tester</span></span>  
 <span data-ttu-id="05d95-196">To narzędzie jest instalowane przez Windows.</span><span class="sxs-lookup"><span data-stu-id="05d95-196">This tool is installed by Windows.</span></span> <span data-ttu-id="05d95-197">Aby je uruchomić, należy uruchomić konsoli poleceń, wpisując polecenie **cmd.exe** w **uruchomienia/Start** dialogowym i kliknij przycisk **OK**.</span><span class="sxs-lookup"><span data-stu-id="05d95-197">To run it, launch a command console by typing **cmd.exe** in the **Start/Run** dialog box and click **OK**.</span></span> <span data-ttu-id="05d95-198">Następnie wpisz **wbemtest.exe** w oknie wiersza polecenia.</span><span class="sxs-lookup"><span data-stu-id="05d95-198">Then, type **wbemtest.exe** in the command window.</span></span> <span data-ttu-id="05d95-199">Następnie zostanie uruchomione Narzędzie Tester oprzyrządowania Instrumentacji zarządzania Windows.</span><span class="sxs-lookup"><span data-stu-id="05d95-199">The Windows Management Instrumentation Tester tool is then launched.</span></span>  
  
1. <span data-ttu-id="05d95-200">Kliknij przycisk **Connect** przycisk w prawym górnym rogu okna.</span><span class="sxs-lookup"><span data-stu-id="05d95-200">Click the **Connect** button on the top right corner of the window.</span></span>  
  
2. <span data-ttu-id="05d95-201">W nowym oknie wprowadź **root\ServiceModel** dla **Namespace** i wybierz przycisk **prywatność pakietów** dla **poziom uwierzytelniania**.</span><span class="sxs-lookup"><span data-stu-id="05d95-201">In the new window, enter **root\ServiceModel** for the **Namespace** field, and select **Packet privacy** for **Authentication level**.</span></span> <span data-ttu-id="05d95-202">Kliknij przycisk **Połącz**.</span><span class="sxs-lookup"><span data-stu-id="05d95-202">Click **Connect**.</span></span>  
  
### <a name="using-managed-code"></a><span data-ttu-id="05d95-203">Przy użyciu kodu zarządzanego</span><span class="sxs-lookup"><span data-stu-id="05d95-203">Using Managed Code</span></span>  
 <span data-ttu-id="05d95-204">Można również przejść zdalnego wystąpień WMI programowo przy użyciu klas dostarczonych przez <xref:System.Management> przestrzeni nazw.</span><span class="sxs-lookup"><span data-stu-id="05d95-204">You can also access remote WMI instances programmatically by using classes provided by the <xref:System.Management> namespace.</span></span> <span data-ttu-id="05d95-205">Poniższy przykład kodu pokazuje, jak to zrobić.</span><span class="sxs-lookup"><span data-stu-id="05d95-205">The following code sample demonstrates how to do this.</span></span>  
  
```csharp
String wcfNamespace = $@"\\{this.serviceMachineName}\Root\ServiceModel");
  
ConnectionOptions connection = new ConnectionOptions();  
connection.Authentication = AuthenticationLevel.PacketPrivacy;  
ManagementScope scope = new ManagementScope(this.wcfNamespace, connection);  
```
