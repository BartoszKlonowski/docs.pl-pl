---
title: Odzyskiwanie systemu
ms.date: 03/30/2017
ms.assetid: 6dd17bf6-ba42-460a-a44b-8046f52b10d0
ms.openlocfilehash: 149ac6b6162893de830f59b3d18008d8298eab56
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 05/04/2018
ms.locfileid: "33363933"
---
# <a name="performing-recovery"></a><span data-ttu-id="65651-102">Odzyskiwanie systemu</span><span class="sxs-lookup"><span data-stu-id="65651-102">Performing Recovery</span></span>
<span data-ttu-id="65651-103">Menedżer zasobów ułatwia rozwiązanie trwałych rejestracji w transakcji przez reenlisting uczestnika transakcji po awarii zasobu.</span><span class="sxs-lookup"><span data-stu-id="65651-103">A resource manager facilitates resolution of durable enlistments in a transaction by reenlisting the transaction participant after resource failure.</span></span>  
  
## <a name="the-recovery-process"></a><span data-ttu-id="65651-104">Proces odzyskiwania</span><span class="sxs-lookup"><span data-stu-id="65651-104">The Recovery Process</span></span>  
 <span data-ttu-id="65651-105">Można zarejestrować trwale zasobu (opisanego przez implementację <xref:System.Transactions.IEnlistmentNotification> interfejsu) który można później kwalifikować się do odzyskiwania, należy wywołać <xref:System.Transactions.Transaction.EnlistDurable%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="65651-105">To durably enlist a resource (described by an implementation of the <xref:System.Transactions.IEnlistmentNotification> interface) that can later be eligible for recovery, you should call the <xref:System.Transactions.Transaction.EnlistDurable%2A> method.</span></span> <span data-ttu-id="65651-106">Ponadto należy podać <xref:System.Transactions.Transaction.EnlistDurable%2A> metody z identyfikatorem Menedżera zasobów ( <xref:System.Guid>) używany do stale etykiety uczestnika transakcji w przypadku awarii zasobu.</span><span class="sxs-lookup"><span data-stu-id="65651-106">In addition, you must provide the <xref:System.Transactions.Transaction.EnlistDurable%2A> method with a resource manager identifier (a <xref:System.Guid>) that is used to consistently label the participant of the transaction in the event of a resource failure.</span></span> <span data-ttu-id="65651-107">Z tego powodu <xref:System.Guid> jest dostarczane do początkowej Enlist wywołania powinny być identyczne z *resourceManagerIdentifier* parametru w <xref:System.Transactions.TransactionManager.Reenlist%2A> wywołań podczas odzyskiwania.</span><span class="sxs-lookup"><span data-stu-id="65651-107">For this reason, the <xref:System.Guid> that is provided to the initial Enlist call should be identical to the *resourceManagerIdentifier* parameter in the <xref:System.Transactions.TransactionManager.Reenlist%2A> call during recovery.</span></span> <span data-ttu-id="65651-108">W przeciwnym razie <xref:System.Transactions.TransactionException> zgłaszany.</span><span class="sxs-lookup"><span data-stu-id="65651-108">Otherwise, <xref:System.Transactions.TransactionException> is thrown.</span></span> <span data-ttu-id="65651-109">Aby uzyskać więcej informacji o trwałych rejestracji, zobacz [rejestrowanie zasobów jako uczestnicy transakcji](../../../../docs/framework/data/transactions/enlisting-resources-as-participants-in-a-transaction.md) .</span><span class="sxs-lookup"><span data-stu-id="65651-109">For more information on durable enlistments, see [Enlisting Resources as Participants in a Transaction](../../../../docs/framework/data/transactions/enlisting-resources-as-participants-in-a-transaction.md) .</span></span>  
  
 <span data-ttu-id="65651-110">W fazie przygotowywania (faza 1) protokołu 2PC, gdy otrzyma implementacji Menedżera zasobów trwałe <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> powiadomień, jego rekordu przygotowanie go powinien logować się w tej fazie.</span><span class="sxs-lookup"><span data-stu-id="65651-110">In the prepare phase (phase 1) of the 2PC protocol, when your implementation of a durable resource manager receives the <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> notification, it should log its prepare record during this phase.</span></span> <span data-ttu-id="65651-111">Rekord powinien zawierać wszystkie informacje, które są niezbędne do ukończenia transakcji w zatwierdzeniu.</span><span class="sxs-lookup"><span data-stu-id="65651-111">The record should contain all the information that is necessary to complete the transaction on commit.</span></span> <span data-ttu-id="65651-112">Rekord prepare później może uzyskać dostęp podczas odzyskiwania, pobierając <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> właściwość *preparingEnlistment* wywołania zwrotnego.</span><span class="sxs-lookup"><span data-stu-id="65651-112">The prepare record can later be accessed during recovery by retrieving the <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> property of the *preparingEnlistment* callback.</span></span> <span data-ttu-id="65651-113">Rejestrowanie rekordu nie jest konieczne jest wykonywana w ramach <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> metody jako Menedżera zasobów można to zrobić w wątku roboczego.</span><span class="sxs-lookup"><span data-stu-id="65651-113">The record logging does not need to be performed within the <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> method as the RM can do this on a worker thread.</span></span>  
  
 <span data-ttu-id="65651-114">Proces odzyskiwania składa się z następujących dwóch kroków:</span><span class="sxs-lookup"><span data-stu-id="65651-114">The recovery process consists of the following two steps:</span></span>  
  
### <a name="step-1---reenlist"></a><span data-ttu-id="65651-115">Krok 1 - ReEnlist</span><span class="sxs-lookup"><span data-stu-id="65651-115">Step 1 - ReEnlist</span></span>  
 <span data-ttu-id="65651-116">Menedżer zasobów sprawdza, czy prepare rekordu informacji dla każdej rejestracji, który jest w stanie wątPLiwości.</span><span class="sxs-lookup"><span data-stu-id="65651-116">The resource manager examines the prepare information record for each enlistment that is in-doubt.</span></span> <span data-ttu-id="65651-117">Jest to wykonywane przez sprawdzenie <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> właściwości <xref:System.Transactions.PreparingEnlistment> wywołanie zwrotne, które są przekazywane do Menedżera zasobów w <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> powiadomień w fazie 1.</span><span class="sxs-lookup"><span data-stu-id="65651-117">This is done by examining the <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> property of the <xref:System.Transactions.PreparingEnlistment> callback, which is passed to the resource manager in the <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> notification during phase 1.</span></span>  
  
 <span data-ttu-id="65651-118">Dla każdego takiego rejestracji sprawdza, czy, wywołuje <xref:System.Transactions.TransactionManager.Reenlist%2A> na Menedżera transakcji.</span><span class="sxs-lookup"><span data-stu-id="65651-118">For each such enlistment it examines, it invokes <xref:System.Transactions.TransactionManager.Reenlist%2A> on the transaction manager.</span></span> <span data-ttu-id="65651-119">Ta metoda przekazuje unikatowego <xref:System.Guid> określający Menedżera zasobów, a także informacje o rejestracji w tablicy bajtów.</span><span class="sxs-lookup"><span data-stu-id="65651-119">This method passes on a unique <xref:System.Guid> that identifies the resource manager, as well as the enlistment's information in a byte array.</span></span> <span data-ttu-id="65651-120">Nowy <xref:System.Transactions.Enlistment> obiekt jest zwracany.</span><span class="sxs-lookup"><span data-stu-id="65651-120">A new <xref:System.Transactions.Enlistment> object is returned.</span></span> <span data-ttu-id="65651-121">Jeśli ponownej rejestracji nie powiedzie się z powodu wyjątku ponowić próbę później, konieczne będzie Menedżera zasobów.</span><span class="sxs-lookup"><span data-stu-id="65651-121">If the reenlistment fails with an exception, the resource manager will need to retry at a later time.</span></span>  
  
 <span data-ttu-id="65651-122">Należy wywołać tylko <xref:System.Transactions.TransactionManager.Reenlist%2A> metody po uruchomieniu Menedżera zasobów po awarii.</span><span class="sxs-lookup"><span data-stu-id="65651-122">You should only call the <xref:System.Transactions.TransactionManager.Reenlist%2A> method when a resource manager restarts from failure.</span></span> <span data-ttu-id="65651-123">Ponadto należy tylko reenlist rozwiązane transakcje zarejestrowane przez Menedżera zasobów w fazie przygotowania początkowego dwufazowego zatwierdzania.</span><span class="sxs-lookup"><span data-stu-id="65651-123">In addition, you should only reenlist unresolved transactions logged by a resource manager during the initial Prepare phase of a two-phase commit.</span></span> <span data-ttu-id="65651-124">Każda próba wywołania tej metody w czasie nieprawidłowy może utworzyć błędnych wyników.</span><span class="sxs-lookup"><span data-stu-id="65651-124">Any attempt to call this method at invalid times can produce erroneous results.</span></span>  
  
 <span data-ttu-id="65651-125">Gdy uczestnika, który jest reenlisted za pomocą tej metody, metody Faza 2 <xref:System.Transactions.IEnlistmentNotification> odpowiada wyniku transakcji (oznacza to, że <xref:System.Transactions.IEnlistmentNotification.Commit%2A> , <xref:System.Transactions.IEnlistmentNotification.Rollback%2A> lub <xref:System.Transactions.IEnlistmentNotification.InDoubt%2A> ) są nazywane odpowiednio.</span><span class="sxs-lookup"><span data-stu-id="65651-125">When a participant is reenlisted using this method, the phase 2 methods of <xref:System.Transactions.IEnlistmentNotification> that correspond to the transaction's outcome (that is, <xref:System.Transactions.IEnlistmentNotification.Commit%2A> , <xref:System.Transactions.IEnlistmentNotification.Rollback%2A> or <xref:System.Transactions.IEnlistmentNotification.InDoubt%2A> ) are called as appropriate.</span></span>  
  
### <a name="step-2---completing-the-recovery"></a><span data-ttu-id="65651-126">Krok 2 — wykonanie odzyskiwania</span><span class="sxs-lookup"><span data-stu-id="65651-126">Step 2 - Completing the recovery</span></span>  
 <span data-ttu-id="65651-127">Po zakończeniu wszystkich reenlistments, Menedżer zasobów wywołuje <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="65651-127">When all the reenlistments are finished, the resource manager calls the <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> method.</span></span> <span data-ttu-id="65651-128">Ta metoda kończy odzyskiwania i Menedżera transakcji informuje, że Menedżer zasobów ma już wątpliwych transakcji.</span><span class="sxs-lookup"><span data-stu-id="65651-128">This method completes the recovery and informs the transaction manager that the resource manager has no more in-doubt transactions.</span></span> <span data-ttu-id="65651-129">W ten sposób Menedżera zasobów gwarantuje, że nie będzie wywołania <xref:System.Transactions.TransactionManager.Reenlist%2A> ponownie metodą.</span><span class="sxs-lookup"><span data-stu-id="65651-129">By doing so, the resource manager guarantees that it will not invoke the <xref:System.Transactions.TransactionManager.Reenlist%2A> method again.</span></span>  
  
 <span data-ttu-id="65651-130">Menedżer zasobów nie jest wymagana, aby usunąć wszystkie transakcje w stanie wątPLiwości przed rejestrowanie w nowych transakcji.</span><span class="sxs-lookup"><span data-stu-id="65651-130">A resource manager is not required to resolve all in-doubt transactions before enlisting in new transactions.</span></span> <span data-ttu-id="65651-131">Pierwszy krok można wykonać w dowolnym momencie po Menedżera zasobów ustanawia relację z menedżerem transakcji, natomiast po <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> została wywołana (krok 2); nie można ponownie wykonać krok 1.</span><span class="sxs-lookup"><span data-stu-id="65651-131">The first step can be performed at any time after the resource manager establishes a relationship with the transaction manager, but after <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> has been invoked (step 2); step 1 cannot be performed again.</span></span> <span data-ttu-id="65651-132">Krok 2 może być powtarza się wielokrotnie bez wpływu na wynik transakcji.</span><span class="sxs-lookup"><span data-stu-id="65651-132">Step 2 can be repeated multiple times without affecting the outcome of transactions.</span></span>
