---
title: Zarządzanie kontekstem usługi danych (Usługi danych programu WCF)
ms.date: 03/30/2017
ms.assetid: 15b19d09-7de7-4638-9556-6ef396cc45ec
ms.openlocfilehash: 0278e8c31ffa7e9aaab5960c71cee091c9ea586a
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 09/07/2019
ms.locfileid: "70779858"
---
# <a name="managing-the-data-service-context-wcf-data-services"></a>Zarządzanie kontekstem usługi danych (Usługi danych programu WCF)
<xref:System.Data.Services.Client.DataServiceContext> Klasa hermetyzuje operacje, które są obsługiwane w odniesieniu do określonej usługi danych. Chociaż [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] usługi są bezstanowe, kontekst nie jest. Z tego względu można użyć <xref:System.Data.Services.Client.DataServiceContext> klasy do utrzymania stanu na kliencie między interakcjami z usługą danych w celu obsługi funkcji, takich jak zarządzanie zmianami. Ta klasa zarządza także tożsamościami i śledzi zmiany.  
  
## <a name="merge-options-and-identity-resolution"></a>Opcje scalania i rozpoznawanie tożsamości  
 <xref:System.Data.Services.Client.DataServiceQuery%601> Gdy jest wykonywane, jednostki w kanale informacyjnym odpowiedzi są uwzględniane w obiektach. Aby uzyskać więcej informacji, zobacz [obiekt materializację](object-materialization-wcf-data-services.md). Sposób, w jaki wpisy w komunikacie odpowiedzi są uwzględniane w obiektach, odbywa się na podstawie rozpoznawania tożsamości i zależy od opcji scalania, w której wykonano zapytanie. Gdy wiele zapytań lub żądań ładowania jest wykonywanych w zakresie pojedynczego <xref:System.Data.Services.Client.DataServiceContext> [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] , klient śledzi tylko pojedyncze wystąpienie obiektu, który ma określoną wartość klucza. Ten klucz, który jest używany do rozpoznawania tożsamości, jednoznacznie identyfikuje jednostkę.  
  
 Domyślnie klient materializuje tylko wpis w kanale informacyjnym odpowiedzi do obiektu dla jednostek, które nie są jeszcze śledzone przez <xref:System.Data.Services.Client.DataServiceContext>. Oznacza to, że zmiany w obiektach znajdujących się już w pamięci podręcznej nie są zastępowane. To zachowanie jest kontrolowane przez określenie <xref:System.Data.Services.Client.MergeOption> wartości dla zapytań i operacji ładowania. Ta opcja jest określona przez ustawienie <xref:System.Data.Services.Client.DataServiceContext.MergeOption%2A> właściwości <xref:System.Data.Services.Client.DataServiceContext>w. Domyślną wartością opcji scalania jest <xref:System.Data.Services.Client.MergeOption.AppendOnly>. To tylko obiekty materializuje dla jednostek, które nie są już śledzone, co oznacza, że istniejące obiekty nie są zastępowane. Inny sposób, aby zapobiec zastępowaniu zmian w obiektach na kliencie przed zastąpieniem ich przez aktualizacje z usługi <xref:System.Data.Services.Client.MergeOption.PreserveChanges>danych. Po określeniu <xref:System.Data.Services.Client.MergeOption.OverwriteChanges>wartości obiektów na kliencie są zamieniane na najnowsze wartości z wpisów w kanale informacyjnym odpowiedzi, nawet jeśli zostały już wprowadzone zmiany w tych obiektach. Gdy jest używana opcja <xref:System.Data.Services.Client.DataServiceContext> scalania,niemożnawysyłaćzmianwprowadzonychnaobiektachklientadousługidanych.<xref:System.Data.Services.Client.MergeOption.NoTracking> W przypadku tej opcji zmiany są zawsze zastępowane wartościami z usługi danych.  
  
## <a name="managing-concurrency"></a>Zarządzanie współbieżnością  
 [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]obsługuje optymistyczną współbieżność, która umożliwia usłudze danych wykrywanie konfliktów aktualizacji. Dostawcę usługi danych można skonfigurować w taki sposób, że usługa danych sprawdza zmiany w jednostkach za pomocą tokenu współbieżności. Ten token zawiera jedną lub więcej właściwości typu jednostki, które są sprawdzane przez usługę danych w celu ustalenia, czy zasób został zmieniony. Tokeny współbieżności, które są zawarte w nagłówku ETag żądań do i odpowiedzi z usługi danych, są zarządzane przez [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] klienta. Aby uzyskać więcej informacji, zobacz [Aktualizowanie usługi danych](updating-the-data-service-wcf-data-services.md).  
  
 <xref:System.Data.Services.Client.DataServiceContext.UpdateObject%2A> <xref:System.Data.Services.Client.DataServiceContext.AddObject%2A> <xref:System.Data.Services.Client.DataServiceCollection%601> <xref:System.Data.Services.Client.DataServiceContext.DeleteObject%2A>Śledzi zmiany wprowadzone w obiektach, które zostały zgłoszone ręcznie przy użyciu,, i lub przez. <xref:System.Data.Services.Client.DataServiceContext> Po wywołaniu <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> metody klient wysyła zmiany z powrotem do usługi danych. <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A>może się nie powieść, gdy zmiany danych w kliencie spowodują konflikt ze zmianami w usłudze danych. W takim przypadku należy ponownie wykonać zapytanie o zasób jednostki w celu uzyskania danych aktualizacji. Aby zastąpić zmiany w usłudze danych, wykonaj zapytanie przy użyciu <xref:System.Data.Services.Client.MergeOption.PreserveChanges> opcji scalania. Po ponownym <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> wywołaniu zmiany przechowywane na kliencie są utrwalane w usłudze danych, o ile inne zmiany nie zostały jeszcze wprowadzone do zasobu w usłudze danych.  
  
## <a name="saving-changes"></a>Zapisywanie zmian  
 Zmiany są śledzone w <xref:System.Data.Services.Client.DataServiceContext> wystąpieniu, ale nie są natychmiast wysyłane do serwera. Po zakończeniu pracy z wymaganymi zmianami dotyczącymi określonego działania Wywołaj <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> polecenie Prześlij wszystkie zmiany do usługi danych. Obiekt jest zwracany <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> po zakończeniu operacji. <xref:System.Data.Services.Client.DataServiceResponse> Obiekt zawiera <xref:System.Data.Services.Client.EntityDescriptor> sekwencję obiektów, które z kolei zawierają sekwencję lub <xref:System.Data.Services.Client.LinkDescriptor> wystąpienia, które reprezentują zmiany, które zostały utrwalone lub podjęto próbę. <xref:System.Data.Services.Client.OperationResponse> <xref:System.Data.Services.Client.DataServiceResponse> Gdy jednostka jest tworzona lub modyfikowana w usłudze danych, <xref:System.Data.Services.Client.EntityDescriptor> zawiera odwołanie do zaktualizowanej jednostki, w tym wszystkie wartości właściwości wygenerowane przez serwer, takie jak wygenerowana `ProductID` wartość w poprzednim przykładzie. Biblioteka klienta automatycznie aktualizuje obiekt .NET Framework tak, aby miał nowe wartości.  
  
 W przypadku pomyślnych operacji <xref:System.Data.Services.Client.EntityDescriptor> wstawiania i aktualizowania Właściwość State obiektu lub <xref:System.Data.Services.Client.LinkDescriptor> skojarzonego z operacją jest ustawiona na <xref:System.Data.Services.Client.EntityStates.Unchanged> wartość i nowe wartości są scalane przy użyciu <xref:System.Data.Services.Client.MergeOption.OverwriteChanges>. W przypadku niepowodzenia operacji INSERT, Update lub DELETE w usłudze danych stan jednostki pozostaje taki sam, <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> jak poprzednio został wywołany, <xref:System.Data.Services.Client.OperationResponse.Error%2A> a właściwość <xref:System.Data.Services.Client.OperationResponse> jest ustawiona na <xref:System.Data.Services.Client.DataServiceRequestException> wartość zawierającą informacje o Porn. Aby uzyskać więcej informacji, zobacz [Aktualizowanie usługi danych](updating-the-data-service-wcf-data-services.md).  
  
### <a name="setting-the-http-method-for-updates"></a>Ustawianie metody HTTP dla aktualizacji  
 Domyślnie Biblioteka klienta .NET Framework wysyła aktualizacje istniejących jednostek jako żądania SCALEnia. Żądanie scalania aktualizuje wybrane właściwości jednostki; jednak klient zawsze zawiera wszystkie właściwości w żądaniu scalania, nawet właściwości, które nie uległy zmianie. [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] Protokół obsługuje również wysyłanie żądań PUT do aktualizacji jednostek. W żądaniu PUT Istniejąca jednostka jest zasadniczo zastępowana nowym wystąpieniem jednostki z wartościami właściwości z klienta. Aby użyć żądań PUT, ustaw <xref:System.Data.Services.Client.SaveChangesOptions.ReplaceOnUpdate> flagę <xref:System.Data.Services.Client.SaveChangesOptions> dla wyliczenia podczas wywoływania <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A>.  
  
> [!NOTE]
> Żądanie PUT będzie zachowywać się inaczej niż żądanie scalania, gdy klient nie wie o wszystkich właściwościach jednostki. Taka sytuacja może wystąpić podczas projekcji typu jednostki w nowym typie na kliencie. Może się również zdarzyć, gdy nowe właściwości zostały dodane do jednostki w modelu danych usługi, a <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> Właściwość <xref:System.Data.Services.Client.DataServiceContext> w programie ma wartość `true` ignorowanie takich błędów mapowania klienta. W takich przypadkach żądanie PUT zresetuje wszystkie właściwości, które są nieznane dla klienta do wartości domyślnych.  
  
### <a name="post-tunneling"></a>Tunelowanie końcowe  
 Domyślnie Biblioteka kliencka wysyła żądania Create, Read, Update i DELETE do [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] usługi przy użyciu odpowiednich metod http polecenia post, get, Put/Merge/patch i DELETE. Ta funkcja zawiera podstawowe zasady przenoszenia stanu (REST). Jednak nie każda implementacja serwera sieci Web obsługuje pełny zestaw metod HTTP. W niektórych przypadkach obsługiwane metody mogą być ograniczone do tylko pobierania i publikowania. Taka sytuacja może wystąpić, gdy pośrednik, taki jak zapora, blokuje żądania przy użyciu określonych metod. Ponieważ metody get i post są najczęściej obsługiwane, program [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] określa sposób wykonywania nieobsługiwanych metod http przy użyciu żądania post. Nazywane *tunelowanie metody* lub tunelowanie, umożliwia klientowi wysłanie *żądania post z*rzeczywistą metodą określoną w nagłówku niestandardowym `X-HTTP-Method` . Aby włączyć tunelowanie końcowe dla żądań, należy ustawić <xref:System.Data.Services.Client.DataServiceContext.UsePostTunneling%2A> Właściwość <xref:System.Data.Services.Client.DataServiceContext> wystąpienia `true`na.  
  
## <a name="see-also"></a>Zobacz także

- [Biblioteka klienta usług danych WCF](wcf-data-services-client-library.md)
- [Aktualizacja usługi danych](updating-the-data-service-wcf-data-services.md)
- [Operacje asynchroniczne](asynchronous-operations-wcf-data-services.md)
- [Operacje przetwarzania wsadowego](batching-operations-wcf-data-services.md)
