---
title: "Zarządzanie kontekstu usługi danych (usługi danych WCF)"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework-oob
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 15b19d09-7de7-4638-9556-6ef396cc45ec
caps.latest.revision: "6"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: 12a0a0b93bfb944a3032cc171f97f411de5d2aab
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/21/2017
---
# <a name="managing-the-data-service-context-wcf-data-services"></a>Zarządzanie kontekstu usługi danych (usługi danych WCF)
<xref:System.Data.Services.Client.DataServiceContext> Klasa hermetyzuje operacje, które są obsługiwane z usługą określone dane. Mimo że [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] usługi są bezstanowych, kontekst nie jest. W związku z tym można użyć <xref:System.Data.Services.Client.DataServiceContext> klasy do zarządzania stanem na kliencie między interakcji z usługą danych, aby zapewnić obsługę funkcji, takich jak zarządzanie zmianami. Ta klasa również zarządza tożsamości i śledzi zmiany.  
  
## <a name="merge-options-and-identity-resolution"></a>Opcje scalania i rozpoznawania tożsamości  
 Gdy <xref:System.Data.Services.Client.DataServiceQuery%601> jest wykonywane, jednostek w odpowiedzi źródła danych są zmaterializowany do obiektów. Aby uzyskać więcej informacji, zobacz [Materialization obiektu](../../../../docs/framework/data/wcf/object-materialization-wcf-data-services.md). Sposób, w którym wpisów w komunikacie odpowiedzi są zmaterializowany na obiekty jest wykonywane na podstawie rozdzielczości tożsamości i zależy od opcji scalania, w którym wykonano zapytanie. Gdy wiele zapytań lub obciążenia żądań, są wykonywane w zasięgu pojedynczego <xref:System.Data.Services.Client.DataServiceContext>, [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] klienta śledzi tylko jedno wystąpienie obiektu, który ma określoną wartość klucza. Ten klucz, który służy do wykonywania rozpoznawania tożsamości, unikatowo identyfikuje jednostki.  
  
 Domyślnie klient zostaje tylko wpis w odpowiedzi źródła danych na dla jednostek, które nie są już są śledzone przez obiekt <xref:System.Data.Services.Client.DataServiceContext>. Oznacza to, zmiany w obiektach już w pamięci podręcznej nie zostaną zastąpione. To zachowanie jest kontrolowany przez określenie <xref:System.Data.Services.Client.MergeOption> wartość dla zapytań i załaduj operacji. Ta opcja jest określona przez ustawienie <xref:System.Data.Services.Client.DataServiceContext.MergeOption%2A> właściwość <xref:System.Data.Services.Client.DataServiceContext>. Domyślna wartość opcji scalania <xref:System.Data.Services.Client.MergeOption.AppendOnly>. To tylko zostaje obiektów dla jednostek, które nie są już śledzone, co oznacza, że istniejące obiekty nie zostaną zastąpione. Innym sposobem uniknięcia zmian do obiektów na komputerze klienckim przed zastąpieniem przez aktualizacje z usługi danych jest określenie <xref:System.Data.Services.Client.MergeOption.PreserveChanges>. Po określeniu <xref:System.Data.Services.Client.MergeOption.OverwriteChanges>, wartości obiektów na komputerze klienckim są zastępowane przez ostatnie wartości na podstawie wpisów w źródle danych odpowiedzi, nawet jeśli zmiany zostały wprowadzone do tych obiektów. Gdy <xref:System.Data.Services.Client.MergeOption.NoTracking> jest używana opcja scalania, <xref:System.Data.Services.Client.DataServiceContext> nie może wysłać zmiany wprowadzone w obiektach klienta do usługi danych. Po wybraniu tej opcji zmiany zawsze zostaną zastąpione wartościami z usługą danych.  
  
## <a name="managing-concurrency"></a>Zarządzanie współbieżności  
 [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]obsługuje optymistycznej współbieżności, które włącza usługę danych do wykrywania konfliktów aktualizacji. Dostawcy usług danych można skonfigurować w taki sposób, że usługa danych sprawdza zmiany jednostek przy użyciu tokenu współbieżności. Token ten zawiera co najmniej jednej właściwości typu jednostki, które zostały zweryfikowane przez usługę danych, aby ustalić, czy zasób został zmieniony. Tokeny współbieżności, które są dołączane do nagłówka eTag żądań i odpowiedzi z usług danych, są zarządzane przez firmę [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] klienta. Aby uzyskać więcej informacji, zobacz [aktualizacji usługi danych](../../../../docs/framework/data/wcf/updating-the-data-service-wcf-data-services.md).  
  
 <xref:System.Data.Services.Client.DataServiceContext> Śledzi zmiany wprowadzone w obiektach, które zostały zgłoszone ręcznie przy użyciu <xref:System.Data.Services.Client.DataServiceContext.AddObject%2A>, <xref:System.Data.Services.Client.DataServiceContext.UpdateObject%2A>, i <xref:System.Data.Services.Client.DataServiceContext.DeleteObject%2A>, lub <xref:System.Data.Services.Client.DataServiceCollection%601>. Gdy <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> metoda jest wywoływana, klient wysyła zmiany z powrotem do usługi danych. <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A>może się nie powieść, jeśli zmiany danych w kliencie w konflikcie ze zmianami w usłudze danych. W takiej sytuacji należy wysyłać zapytania dotyczące zasobu jednostki ponownie odbierać dane aktualizacji. Aby zastąpić zmiany w usłudze danych, wykonanie zapytania za pomocą <xref:System.Data.Services.Client.MergeOption.PreserveChanges> opcja scalania. Podczas wywoływania <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> ponownie, zmiany zachowane na komputerze klienckim są zachowywane z usługą danych tak długo, jak inne zmiany nie zostały już wprowadzone do zasobu w usłudze danych.  
  
## <a name="saving-changes"></a>Trwa zapisywanie zmian  
 Zmiany są śledzone w <xref:System.Data.Services.Client.DataServiceContext> wystąpienia, ale nie natychmiast wysyłane do serwera. Po zakończeniu zmiany wymagane dla określonego działania wywołać <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> do Prześlij wszystkie zmiany do usługi danych. A <xref:System.Data.Services.Client.DataServiceResponse> obiekt jest zwracany po <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> operacja została zakończona. <xref:System.Data.Services.Client.DataServiceResponse> Obiekt zawiera sekwencję <xref:System.Data.Services.Client.OperationResponse> obiektów, które z kolei zawierają sekwencję <xref:System.Data.Services.Client.EntityDescriptor> lub <xref:System.Data.Services.Client.LinkDescriptor> wystąpień, które reprezentują zmiany utrwalona lub próbowały. Po utworzeniu lub zmodyfikowaniu w usłudze danych jednostki <xref:System.Data.Services.Client.EntityDescriptor> zawiera odwołanie do zaktualizowaną jednostkę, łącznie z wartości właściwości wygenerowana przez serwer, takich jak wygenerowany `ProductID` wartość w poprzednim przykładzie. Biblioteka klienta automatycznie aktualizuje [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] obiekcie te nowe wartości.  
  
 Wstaw pomyślnie i operacji aktualizacji, właściwość state <xref:System.Data.Services.Client.EntityDescriptor> lub <xref:System.Data.Services.Client.LinkDescriptor> ustawiono obiekt skojarzony z operacją <xref:System.Data.Services.Client.EntityStates.Unchanged> i nowe wartości są łączone za pomocą <xref:System.Data.Services.Client.MergeOption.OverwriteChanges>. Po instrukcji insert, update lub delete operacja kończy się niepowodzeniem w usłudze danych stanu jednostki jest taka sama sprzed <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> została wywołana i <xref:System.Data.Services.Client.OperationResponse.Error%2A> właściwość <xref:System.Data.Services.Client.OperationResponse> ustawiono <xref:System.Data.Services.Client.DataServiceRequestException> zawierający informacje o Wystąpił błąd. Aby uzyskać więcej informacji, zobacz [aktualizacji usługi danych](../../../../docs/framework/data/wcf/updating-the-data-service-wcf-data-services.md).  
  
### <a name="setting-the-http-method-for-updates"></a>Ustawienie metoda HTTP służąca do aktualizacji  
 Domyślnie bibliotece klienta .NET Framework wysyła aktualizacje do istniejących jednostek jako żądania scalania. Żądanie scalania aktualizuje właściwości wybranej jednostki; Jednak klient zawsze zawiera wszystkie właściwości w żądaniu scalania, nawet właściwości, które nie zostały zmienione. [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] Protokół obsługuje również wysyłania żądań PUT do aktualizowania jednostek. W żądaniu PUT istniejącej jednostki zasadniczo jest zastępowany nowe wystąpienie obiektu z wartości właściwości z klienta. Aby użyć żądania PUT, ustaw <xref:System.Data.Services.Client.SaveChangesOptions.ReplaceOnUpdate> Flaga na <xref:System.Data.Services.Client.SaveChangesOptions> wyliczenie podczas wywoływania metody <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A>.  
  
> [!NOTE]
>  Żądanie PUT będzie działać inaczej niż żądanie scalania, gdy klient nie może określić dotyczących wszystkich właściwości jednostki. Taka sytuacja może wystąpić podczas wykonywania projekcji typu jednostki do nowego typu na kliencie. Może również wystąpić, gdy nowe właściwości zostały dodane do jednostki w modelu danych usługi i <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> właściwość <xref:System.Data.Services.Client.DataServiceContext> ustawiono `true` ignorowania takich klientów z błędami mapowania. W takich przypadkach żądanie PUT zostaną zresetowane wszystkie właściwości, które są nieznane do klienta z wartościami domyślnymi.  
  
### <a name="post-tunneling"></a>Tunelowanie POST  
 Domyślnie wysyła biblioteki klienta tworzenia, odczytu, aktualizacji i usuwania żądań do [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] usługi przy użyciu odpowiednich metod HTTP POST, GET, PUT/MERGE/poprawki i usuwania. Podtrzymuje to podstawowe zasady z Transfer REST (Representational State). Jednak nie wszystkie wdrożenia serwera sieci Web obsługuje pełny zestaw metod HTTP. W niektórych przypadkach obsługiwane metody mogą być tylko GET i POST. Może się to zdarzyć, gdy pośrednik, takie jak zapory, blokuje żądań z niektórych metod. Ponieważ metody GET i POST najczęściej są obsługiwane, [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] określa sposób wykonania żadnych nieobsługiwany metod HTTP przy użyciu żądania POST. Znany jako *tunelowania metod* lub *tunelowania POST*, umożliwia to klientowi wysłanie żądania POST z rzeczywistego metody określonej w niestandardowej `X-HTTP-Method` nagłówka. Aby włączyć tunelowanie POST dla żądania, ustaw <xref:System.Data.Services.Client.DataServiceContext.UsePostTunneling%2A> właściwość <xref:System.Data.Services.Client.DataServiceContext> wystąpienie do `true`.  
  
## <a name="see-also"></a>Zobacz też  
 [Biblioteka klienta usługi danych WCF](../../../../docs/framework/data/wcf/wcf-data-services-client-library.md)  
 [Aktualizowanie usługi danych](../../../../docs/framework/data/wcf/updating-the-data-service-wcf-data-services.md)  
 [Operacje asynchroniczne](../../../../docs/framework/data/wcf/asynchronous-operations-wcf-data-services.md)  
 [Przetwarzanie wsadowe operacji](../../../../docs/framework/data/wcf/batching-operations-wcf-data-services.md)
