---
title: Zarządzanie kontekstem usługi danych (WCF Data Services)
ms.date: 03/30/2017
ms.assetid: 15b19d09-7de7-4638-9556-6ef396cc45ec
ms.openlocfilehash: 33e7ce17eea5d534b941d778fd13144ad51b4094
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/23/2019
ms.locfileid: "61875800"
---
# <a name="managing-the-data-service-context-wcf-data-services"></a>Zarządzanie kontekstem usługi danych (WCF Data Services)
<xref:System.Data.Services.Client.DataServiceContext> Klasa hermetyzuje operacje, które są obsługiwane przez usługę określone dane. Mimo że [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] usług są bezstanowe, kontekst nie jest. W związku z tym, można użyć <xref:System.Data.Services.Client.DataServiceContext> klasy do zarządzania stanem na kliencie interakcji z usługi danych w celu obsługi funkcji, takich jak zarządzanie zmianami. Ta klasa również zarządza tożsamości i śledzenie zmian.  
  
## <a name="merge-options-and-identity-resolution"></a>Opcje scalania i rozwiązanie tożsamości  
 Gdy <xref:System.Data.Services.Client.DataServiceQuery%601> jest wykonywane, jednostki w źródle danych odpowiedzi są zmaterializowanego w obiektach. Aby uzyskać więcej informacji, zobacz [Materializacja obiektu](../../../../docs/framework/data/wcf/object-materialization-wcf-data-services.md). Sposób, w którym wpisów w komunikacie odpowiedzi są zmaterializowanego w obiektach jest wykonywane w oparciu o rozwiązanie tożsamości i zależy od opcji scalania w ramach której zostało wykonane zapytanie. Jeśli wiele zapytań lub ładowania żądań, są wykonywane w zakresie jednej <xref:System.Data.Services.Client.DataServiceContext>, [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] klienta śledzi tylko jedno wystąpienie obiektu, który ma określoną wartość klucza. Ten klucz, który jest używany do rozpoznawania tożsamości, unikatowo identyfikuje jednostki.  
  
 Domyślnie klient materializuje tylko wpis w źródle danych do obiektu dla jednostek, które nie są już są śledzone przez odpowiedzi <xref:System.Data.Services.Client.DataServiceContext>. Oznacza to, nie są zastępowane zmiany obiektów już w pamięci podręcznej. To zachowanie jest kontrolowany przez określenie <xref:System.Data.Services.Client.MergeOption> wartość dla zapytań i operacji ładowania. Ta opcja jest określona przez ustawienie <xref:System.Data.Services.Client.DataServiceContext.MergeOption%2A> właściwość <xref:System.Data.Services.Client.DataServiceContext>. Wartość domyślna opcja scalania to <xref:System.Data.Services.Client.MergeOption.AppendOnly>. To tylko materializuje obiektów dla obiektów, które nie są już śledzone, co oznacza, że istniejące obiekty nie są zastępowane. Innym sposobem, aby uniemożliwić zmiany do obiektów na komputerze klienckim przed zastąpieniem przez aktualizacje z usługi danych jest określenie <xref:System.Data.Services.Client.MergeOption.PreserveChanges>. Po określeniu <xref:System.Data.Services.Client.MergeOption.OverwriteChanges>, wartości obiektów na komputerze klienckim zastępuje najnowsze wartości z wpisów w źródle danych odpowiedzi, nawet jeśli wprowadzone zmiany do tych obiektów. Gdy <xref:System.Data.Services.Client.MergeOption.NoTracking> jest używana opcja scalania, <xref:System.Data.Services.Client.DataServiceContext> nie może wysłać zmiany wprowadzone w obiektach klienta usługi danych. Po wybraniu tej opcji zmiany zawsze są zastępowane wartościami z usługi danych.  
  
## <a name="managing-concurrency"></a>Zarządzanie współbieżnością  
 [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] obsługuje optymistycznej współbieżności, umożliwiająca usługi danych wykrywania konfliktów aktualizacji. Dostawca usługi danych można skonfigurować w taki sposób, że usługa danych sprawdza obecność zmian do jednostek przy użyciu tokenu współbieżności. Ten token zawiera jedną lub więcej właściwości typu jednostki, które są sprawdzane przez usługę danych, aby określić, czy zasób został zmieniony. Tokeny współbieżności, które są zawarte w nagłówka eTag z żądania i odpowiedzi z usługi danych, są zarządzane w programie [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] klienta. Aby uzyskać więcej informacji, zobacz [aktualizacja usługi danych](../../../../docs/framework/data/wcf/updating-the-data-service-wcf-data-services.md).  
  
 <xref:System.Data.Services.Client.DataServiceContext> Śledzi zmiany wprowadzone w obiektach, które zostały zgłoszone ręcznie przy użyciu <xref:System.Data.Services.Client.DataServiceContext.AddObject%2A>, <xref:System.Data.Services.Client.DataServiceContext.UpdateObject%2A>, i <xref:System.Data.Services.Client.DataServiceContext.DeleteObject%2A>, lub <xref:System.Data.Services.Client.DataServiceCollection%601>. Gdy <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> metoda jest wywoływana, klient wysyła zmiany z powrotem do usługi danych. <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> może zakończyć się niepowodzeniem, gdy zmiany danych w kliencie w konflikcie ze zmianami w usłudze danych. W takiej sytuacji należy wysyłać zapytania dotyczące zasobu jednostki ponownie w celu odbierania aktualizacji danych. Aby zastąpić zmiany w usłudze danych, wykonaj następujące zapytania za pomocą <xref:System.Data.Services.Client.MergeOption.PreserveChanges> opcja scalania. Gdy wywołujesz <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> ponownie, zmiany zachowane na komputerze klienckim są zachowywane do usługi danych, tak długo, jak inne zmiany nie zostały już wprowadzone do zasobu w usłudze danych.  
  
## <a name="saving-changes"></a>Zapisywanie zmian  
 Zmiany są śledzone w <xref:System.Data.Services.Client.DataServiceContext> wystąpienia, ale nie natychmiast wysyłane do serwera. Po zakończeniu wymagane zmiany dla określonego działania wywołać <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> przesłać wszystkie zmiany do usługi danych. A <xref:System.Data.Services.Client.DataServiceResponse> obiekt jest zwracany po <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> operacja została zakończona. <xref:System.Data.Services.Client.DataServiceResponse> Obiekt zawiera sekwencję <xref:System.Data.Services.Client.OperationResponse> obiekty, które z kolei zawierają sekwencję <xref:System.Data.Services.Client.EntityDescriptor> lub <xref:System.Data.Services.Client.LinkDescriptor> wystąpień, które reprezentują zmiany trwały, czy jedynie ją podjęto. Gdy jednostka zostanie utworzony lub zmodyfikowany w usłudze danych <xref:System.Data.Services.Client.EntityDescriptor> zawiera odwołanie do zaktualizowanego podmiotu, w tym wartości generowanych przez serwer właściwości, takie jak wygenerowany `ProductID` wartość w poprzednim przykładzie. Biblioteka klienta automatycznie aktualizuje [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] obiekt do tych nowych wartości.  
  
 Wstaw pomyślne i operacje aktualizacji, stan własności <xref:System.Data.Services.Client.EntityDescriptor> lub <xref:System.Data.Services.Client.LinkDescriptor> obiekt skojarzony z operacją jest ustawiona na <xref:System.Data.Services.Client.EntityStates.Unchanged> i nowe wartości są łączone ze sobą przy użyciu <xref:System.Data.Services.Client.MergeOption.OverwriteChanges>. Po instrukcji insert, update lub delete operacja kończy się niepowodzeniem w usłudze danych stanu jednostki pozostają takie same sprzed <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> została wywołana i <xref:System.Data.Services.Client.OperationResponse.Error%2A> właściwość <xref:System.Data.Services.Client.OperationResponse> ustawiono <xref:System.Data.Services.Client.DataServiceRequestException> zawierający informacje o Wystąpił błąd. Aby uzyskać więcej informacji, zobacz [aktualizacja usługi danych](../../../../docs/framework/data/wcf/updating-the-data-service-wcf-data-services.md).  
  
### <a name="setting-the-http-method-for-updates"></a>Ustawienie metody HTTP, aktualizacje  
 Domyślnie biblioteka klienta .NET Framework wysyła aktualizacje do istniejących jednostek jako żądania scalania. Żądanie scalania do aktualizacji właściwości wybranego obiektu; Jednak klient zawsze zawiera wszystkie właściwości w żądaniu scalania, a nawet właściwości, które nie uległy zmianie. [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] Protokół również obsługuje wysyłanie żądania PUT, aby zaktualizować jednostek. W żądaniu PUT istniejącej jednostki zasadniczo jest zastępowany nowe wystąpienie jednostki o wartości właściwości z klienta. Aby użyć żądania PUT, ustaw <xref:System.Data.Services.Client.SaveChangesOptions.ReplaceOnUpdate> flagą <xref:System.Data.Services.Client.SaveChangesOptions> wyliczenie podczas wywoływania <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A>.  
  
> [!NOTE]
>  Żądanie PUT będą zachowywać się inaczej, niż żądania scalania, gdy klient nie wie o wszystkich właściwości jednostki. Taka sytuacja może wystąpić podczas projekcji typu jednostki, do nowego typu na komputerze klienckim. Może również wystąpić, gdy zostały dodane nowe właściwości do jednostki w modelu danych usługi i <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> właściwość <xref:System.Data.Services.Client.DataServiceContext> ustawiono `true` ignorowanie takie błędy mapowania klienta. W takich przypadkach żądanie PUT zostaną zresetowane wszystkie właściwości, które są nieznane klientowi do wartości domyślnych.  
  
### <a name="post-tunneling"></a>KSIĘGUJ tunelowanie  
 Domyślnie klient przesyła biblioteki tworzenia, odczytu, aktualizacji i usuwania żądań do [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] usługi przy użyciu odpowiedniej metody HTTP POST i GET, PUT/scalania/poprawki i usuwania. Podtrzymuje to podstawowe zasady z REST Representational State Transfer (). Jednak nie wszystkie wdrożenia serwera sieci Web obsługuje pełny zestaw metod HTTP. W niektórych przypadkach obsługiwanych metod może być ograniczony do właśnie Pobierz i OPUBLIKUJ. Może to nastąpić, gdy pośrednika, takie jak zapory, blokuje żądań z niektórych metod. Ponieważ metody GET i POST w większości przypadków są obsługiwane, [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] określa sposób wykonania żadnych nieobsługiwanych metod HTTP za pomocą żądania POST. Znane jako *metoda tunelowania* lub *KSIĘGUJ tunelowanie*, umożliwia to klientowi wysłanie żądania POST z określonej w niestandardowej metody rzeczywiste `X-HTTP-Method` nagłówka. Aby włączyć KSIĘGUJ tunelowanie żądań, należy ustawić <xref:System.Data.Services.Client.DataServiceContext.UsePostTunneling%2A> właściwość <xref:System.Data.Services.Client.DataServiceContext> wystąpienia do `true`.  
  
## <a name="see-also"></a>Zobacz także

- [Biblioteka klienta usług danych WCF](../../../../docs/framework/data/wcf/wcf-data-services-client-library.md)
- [Aktualizacja usługi danych](../../../../docs/framework/data/wcf/updating-the-data-service-wcf-data-services.md)
- [Operacje asynchroniczne](../../../../docs/framework/data/wcf/asynchronous-operations-wcf-data-services.md)
- [Operacje przetwarzania wsadowego](../../../../docs/framework/data/wcf/batching-operations-wcf-data-services.md)
