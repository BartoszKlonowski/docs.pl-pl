---
title: Operacje usługi (Usługi danych programu WCF)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- service operations [WCF Data Services]
- WCF Data Services, service operations
ms.assetid: 583a690a-e60f-4990-8991-d6efce069d76
ms.openlocfilehash: 4f36081ef1a3eec84f3cc2ced3c629109acd6a38
ms.sourcegitcommit: 5ae5a1a9520b8b8b6164ad728d396717f30edafc
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 09/11/2019
ms.locfileid: "70894270"
---
# <a name="service-operations-wcf-data-services"></a><span data-ttu-id="0db37-102">Operacje usługi (Usługi danych programu WCF)</span><span class="sxs-lookup"><span data-stu-id="0db37-102">Service Operations (WCF Data Services)</span></span>

[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]<span data-ttu-id="0db37-103">umożliwia zdefiniowanie operacji usługi w usłudze danych w celu udostępnienia metod na serwerze.</span><span class="sxs-lookup"><span data-stu-id="0db37-103">enables you to define service operations on a data service to expose methods on the server.</span></span> <span data-ttu-id="0db37-104">Podobnie jak w przypadku innych zasobów usługi danych, operacje usługi są rozwiązywane przez identyfikatory URI.</span><span class="sxs-lookup"><span data-stu-id="0db37-104">Like other data service resources, service operations are addressed by URIs.</span></span> <span data-ttu-id="0db37-105">Operacje usługi umożliwiają uwidocznienie logiki biznesowej w usłudze danych, na przykład w celu zaimplementowania logiki walidacji, zastosowania zabezpieczeń opartych na rolach lub udostępnienia wyspecjalizowanych funkcji zapytań.</span><span class="sxs-lookup"><span data-stu-id="0db37-105">Service operations enable you to expose business logic in a data service, such as to implement validation logic, to apply role-based security, or to expose specialized querying capabilities.</span></span> <span data-ttu-id="0db37-106">Operacje usługi to metody dodawane do klasy usługi danych, która pochodzi od <xref:System.Data.Services.DataService%601>.</span><span class="sxs-lookup"><span data-stu-id="0db37-106">Service operations are methods added to the data service class that derives from <xref:System.Data.Services.DataService%601>.</span></span> <span data-ttu-id="0db37-107">Podobnie jak w przypadku wszystkich innych zasobów usługi danych, można dostarczyć parametry do metody operacji usługi.</span><span class="sxs-lookup"><span data-stu-id="0db37-107">Like all other data service resources, you can supply parameters to the service operation method.</span></span> <span data-ttu-id="0db37-108">Na przykład następujący identyfikator URI operacji usługi (oparty na usłudze danych [szybkiego startu](quickstart-wcf-data-services.md) ) przekazuje wartość `London` do `city` parametru:</span><span class="sxs-lookup"><span data-stu-id="0db37-108">For example, the following service operation URI (based on the [quickstart](quickstart-wcf-data-services.md) data service) passes the value `London` to the `city` parameter:</span></span>

```http
http://localhost:12345/Northwind.svc/GetOrdersByCity?city='London'
```

<span data-ttu-id="0db37-109">Definicja tej operacji usługi jest następująca:</span><span class="sxs-lookup"><span data-stu-id="0db37-109">The definition for this service operation is as follows:</span></span>

[!code-csharp[Astoria Northwind Service#ServiceOperationDef](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_service/cs/northwind2.svc.cs#serviceoperationdef)]
[!code-vb[Astoria Northwind Service#ServiceOperationDef](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_service/vb/northwind2.svc.vb#serviceoperationdef)]

<span data-ttu-id="0db37-110">Możesz użyć <xref:System.Data.Services.DataService%601.CurrentDataSource%2A> <xref:System.Data.Services.DataService%601> programu, aby uzyskać bezpośredni dostęp do źródła danych używanego przez usługę danych.</span><span class="sxs-lookup"><span data-stu-id="0db37-110">You can use the <xref:System.Data.Services.DataService%601.CurrentDataSource%2A> of the <xref:System.Data.Services.DataService%601> to directly access the data source that the data service is using.</span></span> <span data-ttu-id="0db37-111">Aby uzyskać więcej informacji, zobacz [jak: Zdefiniuj operację](how-to-define-a-service-operation-wcf-data-services.md)usługi.</span><span class="sxs-lookup"><span data-stu-id="0db37-111">For more information, see [How to: Define a Service Operation](how-to-define-a-service-operation-wcf-data-services.md).</span></span>

<span data-ttu-id="0db37-112">Aby uzyskać informacje na temat wywoływania operacji usługi z .NET Framework aplikacji klienckiej, zobacz [wywoływanie operacji usługi](calling-service-operations-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="0db37-112">For information on how to call a service operation from a .NET Framework client application, see [Calling Service Operations](calling-service-operations-wcf-data-services.md).</span></span>

## <a name="service-operation-requirements"></a><span data-ttu-id="0db37-113">Wymagania dotyczące operacji usługi</span><span class="sxs-lookup"><span data-stu-id="0db37-113">Service Operation Requirements</span></span>

<span data-ttu-id="0db37-114">Podczas definiowania operacji usługi w usłudze danych obowiązują następujące wymagania.</span><span class="sxs-lookup"><span data-stu-id="0db37-114">The following requirements apply when defining service operations on the data service.</span></span> <span data-ttu-id="0db37-115">Jeśli metoda nie spełnia tych wymagań, nie zostanie udostępniona jako operacja usługi dla usługi danych.</span><span class="sxs-lookup"><span data-stu-id="0db37-115">If a method does not meet these requirements, it will not be exposed as a service operation for the data service.</span></span>

- <span data-ttu-id="0db37-116">Operacja musi być publicznym wystąpieniem metody, która jest elementem członkowskim klasy usługi danych.</span><span class="sxs-lookup"><span data-stu-id="0db37-116">The operation must be a public instance method that is a member of the data service class.</span></span>

- <span data-ttu-id="0db37-117">Metoda operacji może akceptować tylko parametry wejściowe.</span><span class="sxs-lookup"><span data-stu-id="0db37-117">The operation method may only accept input parameters.</span></span> <span data-ttu-id="0db37-118">Usługa danych nie może uzyskać dostępu do danych wysłanych w treści komunikatu.</span><span class="sxs-lookup"><span data-stu-id="0db37-118">Data sent in the message body cannot be accessed by the data service.</span></span>

- <span data-ttu-id="0db37-119">Jeśli parametry są zdefiniowane, typ każdego parametru musi być typem pierwotnym.</span><span class="sxs-lookup"><span data-stu-id="0db37-119">If parameters are defined, the type of each parameter must be a primitive type.</span></span> <span data-ttu-id="0db37-120">Wszystkie dane typu niepierwotnego muszą być serializowane i przekazywać do parametru ciągu.</span><span class="sxs-lookup"><span data-stu-id="0db37-120">Any data of a non-primitive type must be serialized and passed into a string parameter.</span></span>

- <span data-ttu-id="0db37-121">Metoda musi zwracać jedną z następujących wartości:</span><span class="sxs-lookup"><span data-stu-id="0db37-121">The method must return one of the following:</span></span>

  - <span data-ttu-id="0db37-122">`void`(`Nothing` w Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="0db37-122">`void` (`Nothing` in Visual Basic)</span></span>

  - <xref:System.Collections.Generic.IEnumerable%601>

  - <xref:System.Linq.IQueryable%601>

  - <span data-ttu-id="0db37-123">Typ jednostki w modelu danych, który uwidacznia usługa danych.</span><span class="sxs-lookup"><span data-stu-id="0db37-123">An entity type in the data model that the data service exposes.</span></span>

  - <span data-ttu-id="0db37-124">Klasa pierwotna, taka jak liczba całkowita lub ciąg.</span><span class="sxs-lookup"><span data-stu-id="0db37-124">A primitive class such as integer or string.</span></span>

- <span data-ttu-id="0db37-125">W celu obsługi opcji zapytania, takich jak sortowanie, stronicowanie i filtrowanie, metody operacji usługi powinny zwrócić <xref:System.Linq.IQueryable%601>.</span><span class="sxs-lookup"><span data-stu-id="0db37-125">In order to support query options such as sorting, paging, and filtering, service operation methods should return <xref:System.Linq.IQueryable%601>.</span></span> <span data-ttu-id="0db37-126">Żądania dotyczące operacji usługi, które obejmują opcje zapytania, są odrzucane dla <xref:System.Collections.Generic.IEnumerable%601>operacji, które zwracają tylko.</span><span class="sxs-lookup"><span data-stu-id="0db37-126">Requests to service operations that include query options are rejected for operations that only return <xref:System.Collections.Generic.IEnumerable%601>.</span></span>

- <span data-ttu-id="0db37-127">Aby można było obsługiwać dostęp do powiązanych jednostek przy użyciu właściwości nawigacji, operacja usługi musi zwrócić <xref:System.Linq.IQueryable%601>.</span><span class="sxs-lookup"><span data-stu-id="0db37-127">In order to support accessing related entities by using navigation properties, the service operation must return <xref:System.Linq.IQueryable%601>.</span></span>

- <span data-ttu-id="0db37-128">Do metody należy dodać adnotację z `[WebGet]` atrybutem or. `[WebInvoke]`</span><span class="sxs-lookup"><span data-stu-id="0db37-128">The method must be annotated with the `[WebGet]` or `[WebInvoke]` attribute.</span></span>

  - <span data-ttu-id="0db37-129">`[WebGet]`umożliwia wywoływanie metody przy użyciu żądania GET.</span><span class="sxs-lookup"><span data-stu-id="0db37-129">`[WebGet]` enables the method to be invoked by using a GET request.</span></span>

  - <span data-ttu-id="0db37-130">`[WebInvoke(Method = "POST")]`umożliwia wywoływanie metody przy użyciu żądania POST.</span><span class="sxs-lookup"><span data-stu-id="0db37-130">`[WebInvoke(Method = "POST")]` enables the method to be invoked by using a POST request.</span></span> <span data-ttu-id="0db37-131">Inne <xref:System.ServiceModel.Web.WebInvokeAttribute> metody nie są obsługiwane.</span><span class="sxs-lookup"><span data-stu-id="0db37-131">Other <xref:System.ServiceModel.Web.WebInvokeAttribute> methods are not supported.</span></span>

- <span data-ttu-id="0db37-132">Do operacji usługi można dodać adnotację <xref:System.Data.Services.SingleResultAttribute> , która określa, że wartość zwracana z metody jest pojedynczą jednostką, a nie kolekcją jednostek.</span><span class="sxs-lookup"><span data-stu-id="0db37-132">A service operation may be annotated with the <xref:System.Data.Services.SingleResultAttribute> that specifies that the return value from the method is a single entity rather than a collection of entities.</span></span> <span data-ttu-id="0db37-133">To rozróżnienie określa powstającą serializację odpowiedzi i sposób, w jaki dodatkowe przechodzenie między właściwościami nawigacji jest reprezentowane w identyfikatorze URI.</span><span class="sxs-lookup"><span data-stu-id="0db37-133">This distinction dictates the resulting serialization of the response and the manner in which additional navigation property traversals are represented in the URI.</span></span> <span data-ttu-id="0db37-134">Na przykład podczas korzystania z serializacji AtomPub wystąpienie pojedynczego typu zasobu jest reprezentowane jako element wpisu i zestaw wystąpień jako element źródła danych.</span><span class="sxs-lookup"><span data-stu-id="0db37-134">For example, when using AtomPub serialization, a single resource type instance is represented as an entry element and a set of instances as a feed element.</span></span>

## <a name="addressing-service-operations"></a><span data-ttu-id="0db37-135">Operacje usługi Addressing</span><span class="sxs-lookup"><span data-stu-id="0db37-135">Addressing Service Operations</span></span>

<span data-ttu-id="0db37-136">Operacje na usłudze można rozwiązać, umieszczając nazwę metody w pierwszym segmencie ścieżki identyfikatora URI.</span><span class="sxs-lookup"><span data-stu-id="0db37-136">You can address service operations by placing the name of the method in the first path segment of a URI.</span></span> <span data-ttu-id="0db37-137">Na przykład następujący identyfikator URI uzyskuje dostęp `GetOrdersByState` do operacji <xref:System.Linq.IQueryable%601> zwracającej kolekcję `Orders` obiektów.</span><span class="sxs-lookup"><span data-stu-id="0db37-137">As an example, the following URI accesses a `GetOrdersByState` operation that returns an <xref:System.Linq.IQueryable%601> collection of `Orders` objects.</span></span>

```http
http://localhost:12345/Northwind.svc/GetOrdersByState?state='CA'&includeItems=true
```

<span data-ttu-id="0db37-138">Podczas wywoływania operacji usługi parametry są dostarczane jako opcje zapytania.</span><span class="sxs-lookup"><span data-stu-id="0db37-138">When calling a service operation, parameters are supplied as query options.</span></span> <span data-ttu-id="0db37-139">Poprzednia operacja usługi akceptuje zarówno parametr `state` ciągu, jak i `includeItems` wartość logiczną, która wskazuje, czy `Order_Detail` w odpowiedzi mają być dołączane obiekty pokrewne.</span><span class="sxs-lookup"><span data-stu-id="0db37-139">The previous service operation accepts both a string parameter `state` and a Boolean parameter `includeItems` that indicates whether to include related `Order_Detail` objects in the response.</span></span>

<span data-ttu-id="0db37-140">Następujące prawidłowe typy zwracane dla operacji usługi:</span><span class="sxs-lookup"><span data-stu-id="0db37-140">The following are valid return types for a service operation:</span></span>

|<span data-ttu-id="0db37-141">Prawidłowe zwracane typy</span><span class="sxs-lookup"><span data-stu-id="0db37-141">Valid Return Types</span></span>|<span data-ttu-id="0db37-142">Reguły identyfikatorów URI</span><span class="sxs-lookup"><span data-stu-id="0db37-142">URI Rules</span></span>|
|------------------------|---------------|
|<span data-ttu-id="0db37-143">`void`(`Nothing` w Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="0db37-143">`void` (`Nothing` in Visual Basic)</span></span><br /><br /> <span data-ttu-id="0db37-144">—lub—</span><span class="sxs-lookup"><span data-stu-id="0db37-144">-or-</span></span><br /><br /> <span data-ttu-id="0db37-145">Typy jednostek</span><span class="sxs-lookup"><span data-stu-id="0db37-145">Entity types</span></span><br /><br /> <span data-ttu-id="0db37-146">—lub—</span><span class="sxs-lookup"><span data-stu-id="0db37-146">-or-</span></span><br /><br /> <span data-ttu-id="0db37-147">Typy pierwotne</span><span class="sxs-lookup"><span data-stu-id="0db37-147">Primitive types</span></span>|<span data-ttu-id="0db37-148">Identyfikator URI musi być pojedynczym segmentem ścieżki, który jest nazwą operacji usługi.</span><span class="sxs-lookup"><span data-stu-id="0db37-148">The URI must be a single path segment that is the name of the service operation.</span></span> <span data-ttu-id="0db37-149">Opcje zapytania są niedozwolone.</span><span class="sxs-lookup"><span data-stu-id="0db37-149">Query options are not allowed.</span></span>|
|<xref:System.Collections.Generic.IEnumerable%601>|<span data-ttu-id="0db37-150">Identyfikator URI musi być pojedynczym segmentem ścieżki, który jest nazwą operacji usługi.</span><span class="sxs-lookup"><span data-stu-id="0db37-150">The URI must be a single path segment that is the name of the service operation.</span></span> <span data-ttu-id="0db37-151">Ponieważ typ wyniku nie <xref:System.Linq.IQueryable%601> jest typem, opcje zapytania są niedozwolone.</span><span class="sxs-lookup"><span data-stu-id="0db37-151">Because the result type is not an <xref:System.Linq.IQueryable%601> type, query options are not allowed.</span></span>|
|<xref:System.Linq.IQueryable%601>|<span data-ttu-id="0db37-152">Segmenty ścieżki zapytania oprócz ścieżki, która jest nazwą operacji usługi, są dozwolone.</span><span class="sxs-lookup"><span data-stu-id="0db37-152">Query path segments in addition to the path that is the name of the service operation are allowed.</span></span> <span data-ttu-id="0db37-153">Opcje zapytania są również dozwolone.</span><span class="sxs-lookup"><span data-stu-id="0db37-153">Query options are also allowed.</span></span>|

<span data-ttu-id="0db37-154">Do identyfikatora URI można dodać dodatkowe segmenty ścieżki lub opcje zapytania w zależności od typu zwracanego operacji usługi.</span><span class="sxs-lookup"><span data-stu-id="0db37-154">Additional path segments or query options may be added to the URI depending on the return type of the service operation.</span></span> <span data-ttu-id="0db37-155">Na przykład następujący identyfikator `GetOrdersByCity` URI uzyskuje dostęp do operacji <xref:System.Linq.IQueryable%601> zwracającej kolekcję `Orders` obiektów uporządkowaną według `RequiredDate` kolejności malejącej, wraz z pokrewnymi `Order_Details` obiektami:</span><span class="sxs-lookup"><span data-stu-id="0db37-155">For example, the following URI accesses a `GetOrdersByCity` operation that returns an <xref:System.Linq.IQueryable%601> collection of `Orders` objects, ordered by `RequiredDate` in descending order, along with the related `Order_Details` objects:</span></span>

```http
http://localhost:12345/Northwind.svc/GetOrdersByCity?city='London'&$expand=Order_Details&$orderby=RequiredDate desc
```

## <a name="service-operations-access-control"></a><span data-ttu-id="0db37-156">Access Control operacji usługi</span><span class="sxs-lookup"><span data-stu-id="0db37-156">Service Operations Access Control</span></span>

<span data-ttu-id="0db37-157">Widoczność operacji usługi w całej usłudze jest kontrolowana przez <xref:System.Data.Services.IDataServiceConfiguration.SetServiceOperationAccessRule%2A> metodę <xref:System.Data.Services.IDataServiceConfiguration> klasy w taki sam sposób, jak widoczność zestawu jednostek <xref:System.Data.Services.IDataServiceConfiguration.SetEntitySetAccessRule%2A> jest kontrolowana przy użyciu metody.</span><span class="sxs-lookup"><span data-stu-id="0db37-157">Service-wide visibility of service operations is controlled by the <xref:System.Data.Services.IDataServiceConfiguration.SetServiceOperationAccessRule%2A> method on the <xref:System.Data.Services.IDataServiceConfiguration> class in much the same way that entity set visibility is controlled by using the <xref:System.Data.Services.IDataServiceConfiguration.SetEntitySetAccessRule%2A> method.</span></span> <span data-ttu-id="0db37-158">Na przykład poniższy wiersz kodu w definicji usługi danych umożliwia dostęp do `CustomersByCity` operacji usługi.</span><span class="sxs-lookup"><span data-stu-id="0db37-158">For example, the following line of code in the data service definition enables access to the `CustomersByCity` service operation.</span></span>

[!code-csharp[Astoria Northwind Service#ServiceOperationConfig](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_service/cs/northwind2.svc.cs#serviceoperationconfig)]
[!code-vb[Astoria Northwind Service#ServiceOperationConfig](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_service/vb/northwind2.svc.vb#serviceoperationconfig)]

> [!NOTE]
> <span data-ttu-id="0db37-159">Jeśli operacja usługi ma zwracany typ, który został ukryty przez ograniczenie dostępu do zestawów jednostek źródłowych, operacja usługi nie będzie dostępna dla aplikacji klienckich.</span><span class="sxs-lookup"><span data-stu-id="0db37-159">If a service operation has a return type that has been hidden by restricting access on the underlying entity sets, then the service operation will not be available to client applications.</span></span>

<span data-ttu-id="0db37-160">Aby uzyskać więcej informacji, zobacz [jak: Zdefiniuj operację](how-to-define-a-service-operation-wcf-data-services.md)usługi.</span><span class="sxs-lookup"><span data-stu-id="0db37-160">For more information, see [How to: Define a Service Operation](how-to-define-a-service-operation-wcf-data-services.md).</span></span>

## <a name="raising-exceptions"></a><span data-ttu-id="0db37-161">Wywoływanie wyjątków</span><span class="sxs-lookup"><span data-stu-id="0db37-161">Raising Exceptions</span></span>

<span data-ttu-id="0db37-162">Zalecamy używanie <xref:System.Data.Services.DataServiceException> klasy za każdym razem, gdy wystąpi wyjątek w wykonywaniu usługi danych.</span><span class="sxs-lookup"><span data-stu-id="0db37-162">We recommend that you use the <xref:System.Data.Services.DataServiceException> class whenever you raise an exception in the data service execution.</span></span> <span data-ttu-id="0db37-163">Wynika to z faktu, że środowisko uruchomieniowe usługi danych wie, jak poprawnie zmapować właściwości tego obiektu wyjątku do komunikatu odpowiedzi HTTP.</span><span class="sxs-lookup"><span data-stu-id="0db37-163">This is because the data service runtime knows how to map properties of this exception object correctly to the HTTP response message.</span></span> <span data-ttu-id="0db37-164">Po podniesieniu <xref:System.Data.Services.DataServiceException> operacji w ramach usługi zwracany wyjątek jest opakowany <xref:System.Reflection.TargetInvocationException>w.</span><span class="sxs-lookup"><span data-stu-id="0db37-164">When you raise a <xref:System.Data.Services.DataServiceException> in a service operation, the returned exception is wrapped in a <xref:System.Reflection.TargetInvocationException>.</span></span> <span data-ttu-id="0db37-165"><xref:System.Data.Services.DataServiceException> Aby zwrócić bazę bez <xref:System.Reflection.TargetInvocationException>otaczającego <xref:System.Data.Services.DataService%601.HandleException%2A> , należy <xref:System.Data.Services.DataService%601> <xref:System.Data.Services.DataServiceException> zastąpić<xref:System.Reflection.TargetInvocationException>metodę w, wyodrębnić z i zwrócić go jako błąd najwyższego poziomu, jak w poniższym przykładzie:</span><span class="sxs-lookup"><span data-stu-id="0db37-165">To return the base <xref:System.Data.Services.DataServiceException> without the enclosing <xref:System.Reflection.TargetInvocationException>, you must override the <xref:System.Data.Services.DataService%601.HandleException%2A> method in the <xref:System.Data.Services.DataService%601>, extract the <xref:System.Data.Services.DataServiceException> from the <xref:System.Reflection.TargetInvocationException>, and return it as the top-level error, as in the following example:</span></span>

[!code-csharp[Astoria Northwind Service#HandleExceptions](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_service/cs/northwind2.svc.cs#handleexceptions)]
[!code-vb[Astoria Northwind Service#HandleExceptions](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_service/vb/northwind2.svc.vb#handleexceptions)]

## <a name="see-also"></a><span data-ttu-id="0db37-166">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="0db37-166">See also</span></span>

- [<span data-ttu-id="0db37-167">Interceptory</span><span class="sxs-lookup"><span data-stu-id="0db37-167">Interceptors</span></span>](interceptors-wcf-data-services.md)
