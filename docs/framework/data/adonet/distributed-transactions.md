---
title: Transakcje rozproszone
ms.date: 03/30/2017
ms.assetid: 718b257c-bcb2-408e-b004-a7b0adb1c176
ms.openlocfilehash: f5ed99928534dc31832ac0baf1bb1bfa7e83ded2
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/22/2019
ms.locfileid: "69956756"
---
# <a name="distributed-transactions"></a><span data-ttu-id="37e6a-102">Transakcje rozproszone</span><span class="sxs-lookup"><span data-stu-id="37e6a-102">Distributed Transactions</span></span>
<span data-ttu-id="37e6a-103">Transakcja to zestaw powiązanych zadań zakończonych powodzeniem (zatwierdzanie) lub niepowodzenie (przerwanie) jako jednostki, między innymi.</span><span class="sxs-lookup"><span data-stu-id="37e6a-103">A transaction is a set of related tasks that either succeeds (commit) or fails (abort) as a unit, among other things.</span></span> <span data-ttu-id="37e6a-104">*Transakcja rozproszona* to transakcja, która ma wpływ na kilka zasobów.</span><span class="sxs-lookup"><span data-stu-id="37e6a-104">A *distributed transaction* is a transaction that affects several resources.</span></span> <span data-ttu-id="37e6a-105">Aby transakcja rozproszona została zatwierdzona, wszyscy uczestnicy muszą zagwarantować, że jakakolwiek zmiana danych będzie trwała.</span><span class="sxs-lookup"><span data-stu-id="37e6a-105">For a distributed transaction to commit, all participants must guarantee that any change to data will be permanent.</span></span> <span data-ttu-id="37e6a-106">Zmiany muszą zostać zachowane niezależnie awarie systemu lub inne nieprzewidziane zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="37e6a-106">Changes must persist despite system crashes or other unforeseen events.</span></span> <span data-ttu-id="37e6a-107">Jeśli nawet pojedynczy uczestnik nie wykona tej gwarancji, cała transakcja zakończy się niepowodzeniem, a wszelkie zmiany danych w zakresie transakcji zostaną wycofane.</span><span class="sxs-lookup"><span data-stu-id="37e6a-107">If even a single participant fails to make this guarantee, the entire transaction fails, and any changes to data within the scope of the transaction are rolled back.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="37e6a-108">Wyjątek zostanie wygenerowany, jeśli zostanie podjęta próba zatwierdzenia lub wycofania transakcji, jeśli `DataReader` zostanie ona uruchomiona, gdy transakcja jest aktywna.</span><span class="sxs-lookup"><span data-stu-id="37e6a-108">An exception will be thrown if you attempt to commit or roll back a transaction if a `DataReader` is started while the transaction is active.</span></span>  
  
## <a name="working-with-systemtransactions"></a><span data-ttu-id="37e6a-109">Praca z System. Transactions</span><span class="sxs-lookup"><span data-stu-id="37e6a-109">Working with System.Transactions</span></span>  
 <span data-ttu-id="37e6a-110">W .NET Framework transakcje rozproszone są zarządzane za pomocą interfejsu API w <xref:System.Transactions> przestrzeni nazw.</span><span class="sxs-lookup"><span data-stu-id="37e6a-110">In the .NET Framework, distributed transactions are managed through the API in the <xref:System.Transactions> namespace.</span></span> <span data-ttu-id="37e6a-111"><xref:System.Transactions> Interfejs API przekaże obsługę transakcji rozproszonych do monitora transakcji, takiego jak Microsoft Distributed Transaction Coordinator (MS DTC), gdy jest używanych wiele menedżerów zasobów trwałych.</span><span class="sxs-lookup"><span data-stu-id="37e6a-111">The <xref:System.Transactions> API will delegate distributed transaction handling to a transaction monitor such as the Microsoft Distributed Transaction Coordinator (MS DTC) when multiple persistent resource managers are involved.</span></span> <span data-ttu-id="37e6a-112">Aby uzyskać więcej informacji, zobacz temat [podstawy transakcji](../../../../docs/framework/data/transactions/transaction-fundamentals.md).</span><span class="sxs-lookup"><span data-stu-id="37e6a-112">For more information, see [Transaction Fundamentals](../../../../docs/framework/data/transactions/transaction-fundamentals.md).</span></span>  
  
 <span data-ttu-id="37e6a-113">W ADO.NET 2,0 wprowadzono obsługę rejestrowania w transakcji rozproszonej przy użyciu `EnlistTransaction` metody, która powoduje zarejestrowanie połączenia <xref:System.Transactions.Transaction> w wystąpieniu.</span><span class="sxs-lookup"><span data-stu-id="37e6a-113">ADO.NET 2.0 introduced support for enlisting in a distributed transaction using the `EnlistTransaction` method, which enlists a connection in a <xref:System.Transactions.Transaction> instance.</span></span> <span data-ttu-id="37e6a-114">W poprzednich wersjach ADO.NET jawna Rejestracja w transakcjach rozproszonych została wykonana `EnlistDistributedTransaction` przy użyciu metody połączenia, aby zarejestrować połączenie <xref:System.EnterpriseServices.ITransaction> w wystąpieniu, które jest obsługiwane w celu zapewnienia zgodności z poprzednimi wersjami.</span><span class="sxs-lookup"><span data-stu-id="37e6a-114">In previous versions of ADO.NET, explicit enlistment in distributed transactions was performed using the `EnlistDistributedTransaction` method of a connection to enlist a connection in a <xref:System.EnterpriseServices.ITransaction> instance, which is supported for backwards compatibility.</span></span> <span data-ttu-id="37e6a-115">Aby uzyskać więcej informacji na temat transakcji usług przedsiębiorstwa, zobacz Współdziałanie [z usługami przedsiębiorstwa i transakcjami modelu COM+](../../../../docs/framework/data/transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span><span class="sxs-lookup"><span data-stu-id="37e6a-115">For more information on Enterprise Services transactions, see [Interoperability with Enterprise Services and COM+ Transactions](../../../../docs/framework/data/transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span></span>  
  
 <span data-ttu-id="37e6a-116">W przypadku korzystania <xref:System.Transactions> z transakcji z dostawcą .NET Framework dla SQL Server z bazą danych SQL Server zostanie użyta <xref:System.Transactions.Transaction> wartość uproszczona.</span><span class="sxs-lookup"><span data-stu-id="37e6a-116">When using a <xref:System.Transactions> transaction with the .NET Framework Provider for SQL Server against a SQL Server database, a lightweight <xref:System.Transactions.Transaction> will automatically be used.</span></span> <span data-ttu-id="37e6a-117">Transakcja może zostać następnie podwyższona do pełnej transakcji rozproszonej w razie potrzeby.</span><span class="sxs-lookup"><span data-stu-id="37e6a-117">The transaction can then be promoted to a full distributed transaction on an as-needed basis.</span></span> <span data-ttu-id="37e6a-118">Aby uzyskać więcej informacji, zobacz temat [integracja z usługą system. Transactions z SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="37e6a-118">For more information, see [System.Transactions Integration with SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="37e6a-119">Maksymalna liczba transakcji rozproszonych, w których jednocześnie może uczestniczyć baza danych Oracle, jest domyślnie ustawiona na 10.</span><span class="sxs-lookup"><span data-stu-id="37e6a-119">The maximum number of distributed transactions that an Oracle database can participate in at one time is set to 10 by default.</span></span> <span data-ttu-id="37e6a-120">Po dziesiątej transakcji po nawiązaniu połączenia z bazą danych Oracle zostanie zgłoszony wyjątek.</span><span class="sxs-lookup"><span data-stu-id="37e6a-120">After the 10th transaction when connected to an Oracle database, an exception is thrown.</span></span> <span data-ttu-id="37e6a-121">Firma Oracle nie obsługuje `DDL` transakcji rozproszonej.</span><span class="sxs-lookup"><span data-stu-id="37e6a-121">Oracle does not support `DDL` inside of a distributed transaction.</span></span>  
  
## <a name="automatically-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="37e6a-122">Automatyczne rejestrowanie w transakcji rozproszonej</span><span class="sxs-lookup"><span data-stu-id="37e6a-122">Automatically Enlisting in a Distributed Transaction</span></span>  
 <span data-ttu-id="37e6a-123">Automatyczna rejestracja jest domyślnym (i preferowanym) sposobem integrowania połączeń ADO.NET z `System.Transactions`usługą.</span><span class="sxs-lookup"><span data-stu-id="37e6a-123">Automatic enlistment is the default (and preferred) way of integrating ADO.NET connections with `System.Transactions`.</span></span> <span data-ttu-id="37e6a-124">Obiekt połączenia zostanie automatycznie zarejestrowany w istniejącej transakcji rozproszonej, jeśli ustali, że transakcja jest aktywna, co `System.Transaction` oznacza, że `Transaction.Current` nie ma wartości null.</span><span class="sxs-lookup"><span data-stu-id="37e6a-124">A connection object will automatically enlist in an existing distributed transaction if it determines that a transaction is active, which, in `System.Transaction` terms, means that `Transaction.Current` is not null.</span></span> <span data-ttu-id="37e6a-125">Automatyczne rejestracje transakcji odbywa się po otwarciu połączenia.</span><span class="sxs-lookup"><span data-stu-id="37e6a-125">Automatic transaction enlistment occurs when the connection is opened.</span></span> <span data-ttu-id="37e6a-126">Nie nastąpi to nawet wtedy, gdy polecenie jest wykonywane wewnątrz zakresu transakcji.</span><span class="sxs-lookup"><span data-stu-id="37e6a-126">It will not happen after that even if a command is executed inside of a transaction scope.</span></span> <span data-ttu-id="37e6a-127">Funkcję autorejestracji można wyłączyć w istniejących transakcjach, `Enlist=false` określając jako parametr parametrów połączenia <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType>dla parametru lub `OLE DB Services=-7` parametry połączenia dla elementu <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="37e6a-127">You can disable auto-enlistment in existing transactions by specifying `Enlist=false` as a connection string parameter for a <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType>, or `OLE DB Services=-7` as a connection string parameter for an <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="37e6a-128">Aby uzyskać więcej informacji o parametrach parametrów połączenia Oracle i ODBC <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> , <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>Zobacz i.</span><span class="sxs-lookup"><span data-stu-id="37e6a-128">For more information on Oracle and ODBC connection string parameters, see <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> and <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span>  
  
## <a name="manually-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="37e6a-129">Ręczne rejestrowanie w transakcji rozproszonej</span><span class="sxs-lookup"><span data-stu-id="37e6a-129">Manually Enlisting in a Distributed Transaction</span></span>  
 <span data-ttu-id="37e6a-130">Jeśli funkcja autorejestracji jest wyłączona lub konieczne jest zarejestrowanie transakcji, która została uruchomiona po otwarciu połączenia, można zarejestrować się w istniejącej transakcji rozproszonej przy użyciu `EnlistTransaction` metody <xref:System.Data.Common.DbConnection> obiektu dla dostawcy, z którym pracujesz. się.</span><span class="sxs-lookup"><span data-stu-id="37e6a-130">If auto-enlistment is disabled or you need to enlist a transaction that was started after the connection was opened, you can enlist in an existing distributed transaction using the `EnlistTransaction` method of the <xref:System.Data.Common.DbConnection> object for the provider you are working with.</span></span> <span data-ttu-id="37e6a-131">Rejestracja w istniejącej transakcji rozproszonej zapewnia, że jeśli transakcja zostanie zatwierdzona lub wycofana, modyfikacje wprowadzone przez kod w źródle danych zostaną zatwierdzone lub wycofane.</span><span class="sxs-lookup"><span data-stu-id="37e6a-131">Enlisting in an existing distributed transaction ensures that, if the transaction is committed or rolled back, modifications made by the code at the data source will be committed or rolled back as well.</span></span>  
  
 <span data-ttu-id="37e6a-132">Rejestrowanie w transakcjach rozproszonych jest szczególnie stosowane podczas puli obiektów firmowych.</span><span class="sxs-lookup"><span data-stu-id="37e6a-132">Enlisting in distributed transactions is particularly applicable when pooling business objects.</span></span> <span data-ttu-id="37e6a-133">Jeśli obiekt biznesowy jest w puli z otwartym połączeniem, automatyczne rejestrację transakcji odbywa się tylko wtedy, gdy to połączenie jest otwarte.</span><span class="sxs-lookup"><span data-stu-id="37e6a-133">If a business object is pooled with an open connection, automatic transaction enlistment only occurs when that connection is opened.</span></span> <span data-ttu-id="37e6a-134">Jeśli wiele transakcji jest wykonywanych przy użyciu obiektu biznesowego w puli, otwarte połączenie dla tego obiektu nie zostanie automatycznie zarejestrowane w nowo zainicjowanych transakcjach.</span><span class="sxs-lookup"><span data-stu-id="37e6a-134">If multiple transactions are performed using the pooled business object, the open connection for that object will not automatically enlist in newly initiated transactions.</span></span> <span data-ttu-id="37e6a-135">W takim przypadku można wyłączyć automatyczne rejestrowanie transakcji dla połączenia i zarejestrować połączenie w transakcjach za pomocą programu `EnlistTransaction`.</span><span class="sxs-lookup"><span data-stu-id="37e6a-135">In this case, you can disable automatic transaction enlistment for the connection and enlist the connection in transactions using `EnlistTransaction`.</span></span>  
  
 <span data-ttu-id="37e6a-136">`EnlistTransaction`przyjmuje pojedynczy argument typu <xref:System.Transactions.Transaction> , który jest odwołaniem do istniejącej transakcji.</span><span class="sxs-lookup"><span data-stu-id="37e6a-136">`EnlistTransaction` takes a single argument of type <xref:System.Transactions.Transaction> that is a reference to the existing transaction.</span></span> <span data-ttu-id="37e6a-137">Po wywołaniu `EnlistTransaction` metody połączenia wszystkie modyfikacje wprowadzone w źródle danych przy użyciu połączenia są uwzględniane w transakcji.</span><span class="sxs-lookup"><span data-stu-id="37e6a-137">After calling the connection's `EnlistTransaction` method, all modifications made at the data source using the connection are included in the transaction.</span></span> <span data-ttu-id="37e6a-138">Przekazanie wartości null umożliwia odrejestrowanie połączenia z bieżącej rejestracji transakcji rozproszonej.</span><span class="sxs-lookup"><span data-stu-id="37e6a-138">Passing a null value unenlists the connection from its current distributed transaction enlistment.</span></span> <span data-ttu-id="37e6a-139">Należy pamiętać, że połączenie musi zostać otwarte przed `EnlistTransaction`wywołaniem.</span><span class="sxs-lookup"><span data-stu-id="37e6a-139">Note that the connection must be opened before calling `EnlistTransaction`.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="37e6a-140">Gdy połączenie zostanie jawnie zarejestrowane w transakcji, nie można go wyrejestrować lub zarejestrować w innej transakcji do momentu zakończenia pierwszej transakcji.</span><span class="sxs-lookup"><span data-stu-id="37e6a-140">Once a connection is explicitly enlisted on a transaction, it cannot be un-enlisted or enlisted in another transaction until the first transaction finishes.</span></span>  
  
> [!CAUTION]
>  <span data-ttu-id="37e6a-141">`EnlistTransaction`zgłasza wyjątek, jeśli połączenie już rozpoczęło transakcję przy użyciu <xref:System.Data.Common.DbConnection.BeginTransaction%2A> metody połączenia.</span><span class="sxs-lookup"><span data-stu-id="37e6a-141">`EnlistTransaction` throws an exception if the connection has already begun a transaction using the connection's <xref:System.Data.Common.DbConnection.BeginTransaction%2A> method.</span></span> <span data-ttu-id="37e6a-142">Jeśli jednak transakcja jest transakcją lokalną uruchomioną w źródle danych (na przykład w przypadku wykonywania instrukcji BEGIN TRANSACTION jawnie używającej <xref:System.Data.SqlClient.SqlCommand>), `EnlistTransaction` program wycofa transakcję lokalną i zarejestrowany w istniejącej dystrybucji transakcja zgodnie z żądaniem.</span><span class="sxs-lookup"><span data-stu-id="37e6a-142">However, if the transaction is a local transaction started at the data source (for example, executing the BEGIN TRANSACTION statement explicitly using a <xref:System.Data.SqlClient.SqlCommand>), `EnlistTransaction` will roll back the local transaction and enlist in the existing distributed transaction as requested.</span></span> <span data-ttu-id="37e6a-143">Nie otrzymasz powiadomienia, że lokalna transakcja została wycofana, i musi zarządzać wszelkimi lokalnymi transakcjami, <xref:System.Data.Common.DbConnection.BeginTransaction%2A>które nie zostały rozpoczęte przy użyciu.</span><span class="sxs-lookup"><span data-stu-id="37e6a-143">You will not receive notice that the local transaction was rolled back, and must manage any local transactions not started using <xref:System.Data.Common.DbConnection.BeginTransaction%2A>.</span></span> <span data-ttu-id="37e6a-144">Jeśli używasz dostawca danych .NET Framework dla SQL Server (`SqlClient`) z SQL Server, próba zarejestrowania spowoduje zgłoszenie wyjątku.</span><span class="sxs-lookup"><span data-stu-id="37e6a-144">If you are using the .NET Framework Data Provider for SQL Server (`SqlClient`) with SQL Server, an attempt to enlist will throw an exception.</span></span> <span data-ttu-id="37e6a-145">Wszystkie inne przypadki nie zostaną wykryte.</span><span class="sxs-lookup"><span data-stu-id="37e6a-145">All other cases will go undetected.</span></span>  
  
## <a name="promotable-transactions-in-sql-server"></a><span data-ttu-id="37e6a-146">Promocja transakcji w SQL Server</span><span class="sxs-lookup"><span data-stu-id="37e6a-146">Promotable Transactions in SQL Server</span></span>  
 <span data-ttu-id="37e6a-147">SQL Server obsługuje operacje promocji, w których lokalna transakcja uproszczona może zostać automatycznie podwyższona do transakcji rozproszonej tylko wtedy, gdy jest to wymagane.</span><span class="sxs-lookup"><span data-stu-id="37e6a-147">SQL Server supports promotable transactions in which a local lightweight transaction can be automatically promoted to a distributed transaction only if it is required.</span></span> <span data-ttu-id="37e6a-148">Transakcja promocji nie wywołuje dodanego nakładu transakcji rozproszonej, chyba że jest wymagane dodatkowe obciążenie.</span><span class="sxs-lookup"><span data-stu-id="37e6a-148">A promotable transaction does not invoke the added overhead of a distributed transaction unless the added overhead is required.</span></span> <span data-ttu-id="37e6a-149">Aby uzyskać więcej informacji i przykład kodu, zobacz [System. Transactions Integration with SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="37e6a-149">For more information and a code sample, see [System.Transactions Integration with SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span></span>  
  
## <a name="configuring-distributed-transactions"></a><span data-ttu-id="37e6a-150">Konfigurowanie transakcji rozproszonych</span><span class="sxs-lookup"><span data-stu-id="37e6a-150">Configuring Distributed Transactions</span></span>  
 <span data-ttu-id="37e6a-151">Może być konieczne włączenie usługi MS DTC przez sieć w celu korzystania z transakcji rozproszonych.</span><span class="sxs-lookup"><span data-stu-id="37e6a-151">You may need to enable the MS DTC over the network in order to use distributed transactions.</span></span> <span data-ttu-id="37e6a-152">Jeśli Zapora systemu Windows jest włączona, należy zezwolić usłudze MS DTC na korzystanie z sieci lub otworzyć port usługi MS DTC.</span><span class="sxs-lookup"><span data-stu-id="37e6a-152">If have the Windows Firewall enabled, you must allow the MS DTC service to use the network or open the MS DTC port.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="37e6a-153">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="37e6a-153">See also</span></span>

- [<span data-ttu-id="37e6a-154">Transakcje i współbieżność</span><span class="sxs-lookup"><span data-stu-id="37e6a-154">Transactions and Concurrency</span></span>](../../../../docs/framework/data/adonet/transactions-and-concurrency.md)
- [<span data-ttu-id="37e6a-155">Integracja System.Transactions z programem SQL Server</span><span class="sxs-lookup"><span data-stu-id="37e6a-155">System.Transactions Integration with SQL Server</span></span>](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md)
- [<span data-ttu-id="37e6a-156">ADO.NET dostawcy zarządzani i centrum deweloperów zestawu danych</span><span class="sxs-lookup"><span data-stu-id="37e6a-156">ADO.NET Managed Providers and DataSet Developer Center</span></span>](https://go.microsoft.com/fwlink/?LinkId=217917)
