---
title: Transakcje rozproszone
ms.date: 03/30/2017
ms.assetid: 718b257c-bcb2-408e-b004-a7b0adb1c176
ms.openlocfilehash: 7792a719a73ca5183d57bcecc5d346153d824570
ms.sourcegitcommit: 11f11ca6cefe555972b3a5c99729d1a7523d8f50
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 05/03/2018
ms.locfileid: "32766091"
---
# <a name="distributed-transactions"></a><span data-ttu-id="8e26f-102">Transakcje rozproszone</span><span class="sxs-lookup"><span data-stu-id="8e26f-102">Distributed Transactions</span></span>
<span data-ttu-id="8e26f-103">Transakcja jest zestaw powiązanych zadań, który zakończy się powodzeniem (zatwierdzania) albo nie powiedzie się (przerwanie) jako jednostki, między innymi.</span><span class="sxs-lookup"><span data-stu-id="8e26f-103">A transaction is a set of related tasks that either succeeds (commit) or fails (abort) as a unit, among other things.</span></span> <span data-ttu-id="8e26f-104">A *transakcja rozproszona* transakcji, które ma wpływ na kilku zasobów.</span><span class="sxs-lookup"><span data-stu-id="8e26f-104">A *distributed transaction* is a transaction that affects several resources.</span></span> <span data-ttu-id="8e26f-105">Transakcji rozproszonych można przekazać wszystkich uczestników musi zapewniać każda zmiana danych będą trwałe.</span><span class="sxs-lookup"><span data-stu-id="8e26f-105">For a distributed transaction to commit, all participants must guarantee that any change to data will be permanent.</span></span> <span data-ttu-id="8e26f-106">Zmiany muszą zostać zachowane niezależnie awarie systemu lub inne nieprzewidziane zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="8e26f-106">Changes must persist despite system crashes or other unforeseen events.</span></span> <span data-ttu-id="8e26f-107">Jeśli jednego uczestnika nie powiedzie się gwarancji, cała transakcja nie powiedzie się i wycofać zmiany wprowadzone w danych w zakresie transakcji.</span><span class="sxs-lookup"><span data-stu-id="8e26f-107">If even a single participant fails to make this guarantee, the entire transaction fails, and any changes to data within the scope of the transaction are rolled back.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="8e26f-108">Zostanie wygenerowany wyjątek przy próbie przekazać ani wycofać transakcji, jeśli `DataReader` została uruchomiona, gdy transakcja jest aktywna.</span><span class="sxs-lookup"><span data-stu-id="8e26f-108">An exception will be thrown if you attempt to commit or roll back a transaction if a `DataReader` is started while the transaction is active.</span></span>  
  
## <a name="working-with-systemtransactions"></a><span data-ttu-id="8e26f-109">Praca z System.Transactions</span><span class="sxs-lookup"><span data-stu-id="8e26f-109">Working with System.Transactions</span></span>  
 <span data-ttu-id="8e26f-110">W programie .NET Framework, transakcje rozproszone są zarządzane za pośrednictwem interfejsu API w <xref:System.Transactions> przestrzeni nazw.</span><span class="sxs-lookup"><span data-stu-id="8e26f-110">In the .NET Framework, distributed transactions are managed through the API in the <xref:System.Transactions> namespace.</span></span> <span data-ttu-id="8e26f-111"><xref:System.Transactions> Interfejsu API będzie delegowane Obsługa monitorowania transakcji, takich jak Microsoft Distributed Transaction Coordinator (MS DTC) podczas obejmuje wiele menedżerowie zasobów trwałe transakcji rozproszonej.</span><span class="sxs-lookup"><span data-stu-id="8e26f-111">The <xref:System.Transactions> API will delegate distributed transaction handling to a transaction monitor such as the Microsoft Distributed Transaction Coordinator (MS DTC) when multiple persistent resource managers are involved.</span></span> <span data-ttu-id="8e26f-112">Aby uzyskać więcej informacji, zobacz [podstawy transakcji](../../../../docs/framework/data/transactions/transaction-fundamentals.md).</span><span class="sxs-lookup"><span data-stu-id="8e26f-112">For more information, see [Transaction Fundamentals](../../../../docs/framework/data/transactions/transaction-fundamentals.md).</span></span>  
  
 <span data-ttu-id="8e26f-113">ADO.NET 2.0 wprowadzono obsługę rejestracji w transakcji rozproszonej przy użyciu `EnlistTransaction` metodę, która współdziała z połączenia w <xref:System.Transactions.Transaction> wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="8e26f-113">ADO.NET 2.0 introduced support for enlisting in a distributed transaction using the `EnlistTransaction` method, which enlists a connection in a <xref:System.Transactions.Transaction> instance.</span></span> <span data-ttu-id="8e26f-114">W poprzednich wersjach programu ADO.NET, wykonano jawnej rejestracji w transakcji rozproszonych za pomocą `EnlistDistributedTransaction` metodę połączenia można zarejestrować połączenie w <xref:System.EnterpriseServices.ITransaction> wystąpienia, która jest obsługiwana w przypadku zapewnienia zgodności.</span><span class="sxs-lookup"><span data-stu-id="8e26f-114">In previous versions of ADO.NET, explicit enlistment in distributed transactions was performed using the `EnlistDistributedTransaction` method of a connection to enlist a connection in a <xref:System.EnterpriseServices.ITransaction> instance, which is supported for backwards compatibility.</span></span> <span data-ttu-id="8e26f-115">Aby uzyskać więcej informacji na transakcje usług dla przedsiębiorstw, zobacz [współdziałanie z usługami przedsiębiorstwa i transakcje COM +](../../../../docs/framework/data/transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span><span class="sxs-lookup"><span data-stu-id="8e26f-115">For more information on Enterprise Services transactions, see [Interoperability with Enterprise Services and COM+ Transactions](../../../../docs/framework/data/transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span></span>  
  
 <span data-ttu-id="8e26f-116">Korzystając z <xref:System.Transactions> transakcji z dostawcy programu .NET Framework dla programu SQL Server w bazie danych programu SQL Server, lekkie <xref:System.Transactions.Transaction> automatycznie będą używane.</span><span class="sxs-lookup"><span data-stu-id="8e26f-116">When using a <xref:System.Transactions> transaction with the .NET Framework Provider for SQL Server against a SQL Server database, a lightweight <xref:System.Transactions.Transaction> will automatically be used.</span></span> <span data-ttu-id="8e26f-117">Następnie można można podwyższyć poziomu transakcji do pełnego transakcji rozproszonej na zgodnie z potrzebami.</span><span class="sxs-lookup"><span data-stu-id="8e26f-117">The transaction can then be promoted to a full distributed transaction on an as-needed basis.</span></span> <span data-ttu-id="8e26f-118">Aby uzyskać więcej informacji, zobacz [System.Transactions integracji z programem SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="8e26f-118">For more information, see [System.Transactions Integration with SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="8e26f-119">Maksymalna liczba transakcji rozproszonych, które bazy danych programu Oracle mogą uczestniczyć w tym samym czasie jest ustawiony na 10 domyślnie.</span><span class="sxs-lookup"><span data-stu-id="8e26f-119">The maximum number of distributed transactions that an Oracle database can participate in at one time is set to 10 by default.</span></span> <span data-ttu-id="8e26f-120">Po 10 transakcji podczas połączenia z bazą danych Oracle, jest zgłaszany wyjątek.</span><span class="sxs-lookup"><span data-stu-id="8e26f-120">After the 10th transaction when connected to an Oracle database, an exception is thrown.</span></span> <span data-ttu-id="8e26f-121">Oracle nie obsługuje `DDL` wewnątrz transakcji rozproszonej.</span><span class="sxs-lookup"><span data-stu-id="8e26f-121">Oracle does not support `DDL` inside of a distributed transaction.</span></span>  
  
## <a name="automatically-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="8e26f-122">Automatyczne rejestrowanie transakcji rozproszonej</span><span class="sxs-lookup"><span data-stu-id="8e26f-122">Automatically Enlisting in a Distributed Transaction</span></span>  
 <span data-ttu-id="8e26f-123">Automatyczne umieszczanie jest ustawieniem domyślnym (i preferowany) sposób integrowania połączenia ADO.NET z `System.Transactions`.</span><span class="sxs-lookup"><span data-stu-id="8e26f-123">Automatic enlistment is the default (and preferred) way of integrating ADO.NET connections with `System.Transactions`.</span></span> <span data-ttu-id="8e26f-124">Obiekt połączenia zostanie automatycznie zarejestrować się w istniejącej transakcji rozproszonej, gdy ustali, że transakcja jest aktywna, która w `System.Transaction` warunki, oznacza, że `Transaction.Current` nie ma wartości null.</span><span class="sxs-lookup"><span data-stu-id="8e26f-124">A connection object will automatically enlist in an existing distributed transaction if it determines that a transaction is active, which, in `System.Transaction` terms, means that `Transaction.Current` is not null.</span></span> <span data-ttu-id="8e26f-125">Automatyczne transakcji rejestracji występuje po otwarciu połączenia.</span><span class="sxs-lookup"><span data-stu-id="8e26f-125">Automatic transaction enlistment occurs when the connection is opened.</span></span> <span data-ttu-id="8e26f-126">Go nie nastąpi po wykonaniu tej nawet, jeśli polecenie jest wykonywane w zakresie transakcji.</span><span class="sxs-lookup"><span data-stu-id="8e26f-126">It will not happen after that even if a command is executed inside of a transaction scope.</span></span> <span data-ttu-id="8e26f-127">Auto rejestracji w istniejącej transakcji można wyłączyć, określając `Enlist=false` jako parametr ciągu połączenia dla <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType>, lub `OLE DB Services=-7` jako parametr ciągu połączenia dla <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="8e26f-127">You can disable auto-enlistment in existing transactions by specifying `Enlist=false` as a connection string parameter for a <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType>, or `OLE DB Services=-7` as a connection string parameter for an <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="8e26f-128">Aby uzyskać więcej informacji na parametry ciągu połączenia Oracle i ODBC, zobacz <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> i <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="8e26f-128">For more information on Oracle and ODBC connection string parameters, see <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> and <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span>  
  
## <a name="manually-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="8e26f-129">Ręczne rejestrowanie transakcji rozproszonej</span><span class="sxs-lookup"><span data-stu-id="8e26f-129">Manually Enlisting in a Distributed Transaction</span></span>  
 <span data-ttu-id="8e26f-130">Jeśli automatycznej rejestracji jest wyłączona lub musisz zarejestrować transakcji, która została uruchomiona po połączenie zostało otwarte, można zarejestrować się w istniejących przy użyciu transakcji rozproszonej `EnlistTransaction` metody <xref:System.Data.Common.DbConnection> obiektu dla dostawcy pracy z.</span><span class="sxs-lookup"><span data-stu-id="8e26f-130">If auto-enlistment is disabled or you need to enlist a transaction that was started after the connection was opened, you can enlist in an existing distributed transaction using the `EnlistTransaction` method of the <xref:System.Data.Common.DbConnection> object for the provider you are working with.</span></span> <span data-ttu-id="8e26f-131">Rejestrowanie w istniejącej transakcji rozproszonych zapewnia, że w przypadku transakcji jest zatwierdzona lub wycofana, zmiany dokonane przez kod w źródle danych zatwierdzona lub wycofana również.</span><span class="sxs-lookup"><span data-stu-id="8e26f-131">Enlisting in an existing distributed transaction ensures that, if the transaction is committed or rolled back, modifications made by the code at the data source will be committed or rolled back as well.</span></span>  
  
 <span data-ttu-id="8e26f-132">Rejestrowanie w transakcjach rozproszonych jest szczególnie przydatny, gdy buforowanie obiektów biznesowych.</span><span class="sxs-lookup"><span data-stu-id="8e26f-132">Enlisting in distributed transactions is particularly applicable when pooling business objects.</span></span> <span data-ttu-id="8e26f-133">Jeśli z otwartego połączenia w puli jest obiekt biznesowy, transakcji automatycznej rejestracji występuje tylko po otwarciu tego połączenia.</span><span class="sxs-lookup"><span data-stu-id="8e26f-133">If a business object is pooled with an open connection, automatic transaction enlistment only occurs when that connection is opened.</span></span> <span data-ttu-id="8e26f-134">Jeśli wiele transakcji są wykonywane przy użyciu obiektu biznesowego puli, otwartego połączenia dla tego obiektu zostanie nie automatycznie zarejestrować nowo inicjowane transakcji.</span><span class="sxs-lookup"><span data-stu-id="8e26f-134">If multiple transactions are performed using the pooled business object, the open connection for that object will not automatically enlist in newly initiated transactions.</span></span> <span data-ttu-id="8e26f-135">W takim przypadku można wyłączyć automatyczne transakcji rejestracji dla połączenia i zarejestrować połączenie w transakcji za pomocą `EnlistTransaction`.</span><span class="sxs-lookup"><span data-stu-id="8e26f-135">In this case, you can disable automatic transaction enlistment for the connection and enlist the connection in transactions using `EnlistTransaction`.</span></span>  
  
 <span data-ttu-id="8e26f-136">`EnlistTransaction` pobiera jeden argument typu <xref:System.Transactions.Transaction> oznacza to odwołanie do istniejącej transakcji.</span><span class="sxs-lookup"><span data-stu-id="8e26f-136">`EnlistTransaction` takes a single argument of type <xref:System.Transactions.Transaction> that is a reference to the existing transaction.</span></span> <span data-ttu-id="8e26f-137">Po wywołaniu metody połączenia `EnlistTransaction` — metoda, wszystkie zmiany wprowadzone w źródła danych przy użyciu połączenia znajdują się w transakcji.</span><span class="sxs-lookup"><span data-stu-id="8e26f-137">After calling the connection's `EnlistTransaction` method, all modifications made at the data source using the connection are included in the transaction.</span></span> <span data-ttu-id="8e26f-138">Przekazana wartość null unenlists połączenie z jego bieżącym rejestracji transakcji rozproszonej.</span><span class="sxs-lookup"><span data-stu-id="8e26f-138">Passing a null value unenlists the connection from its current distributed transaction enlistment.</span></span> <span data-ttu-id="8e26f-139">Należy pamiętać, że można otworzyć połączenia przed wywołaniem `EnlistTransaction`.</span><span class="sxs-lookup"><span data-stu-id="8e26f-139">Note that the connection must be opened before calling `EnlistTransaction`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="8e26f-140">Gdy połączenie jest jawnie zarejestrowana w transakcji, nie może być usunięcie zarejestrowane lub zarejestrowane w innej transakcji zakończenie pierwszej transakcji.</span><span class="sxs-lookup"><span data-stu-id="8e26f-140">Once a connection is explicitly enlisted on a transaction, it cannot be un-enlisted or enlisted in another transaction until the first transaction finishes.</span></span>  
  
> [!CAUTION]
>  <span data-ttu-id="8e26f-141">`EnlistTransaction` zgłasza wyjątek, jeśli połączenie zostało już uruchomione transakcji za pomocą połączenia <xref:System.Data.Common.DbConnection.BeginTransaction%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="8e26f-141">`EnlistTransaction` throws an exception if the connection has already begun a transaction using the connection's <xref:System.Data.Common.DbConnection.BeginTransaction%2A> method.</span></span> <span data-ttu-id="8e26f-142">Jednak jeśli transakcja jest transakcji lokalnej rozpoczęty o godzinie źródło danych (na przykład wykonywania instrukcji BEGIN TRANSACTION, jawnie za pomocą <xref:System.Data.SqlClient.SqlCommand>), `EnlistTransaction` będzie wycofać transakcji lokalnej i zarejestrować w istniejących rozproszonych Transakcja zgodnie z żądaniem.</span><span class="sxs-lookup"><span data-stu-id="8e26f-142">However, if the transaction is a local transaction started at the data source (for example, executing the BEGIN TRANSACTION statement explicitly using a <xref:System.Data.SqlClient.SqlCommand>), `EnlistTransaction` will roll back the local transaction and enlist in the existing distributed transaction as requested.</span></span> <span data-ttu-id="8e26f-143">Nie będą otrzymywali Zwróć uwagę, że lokalne transakcja została wycofana i należy zarządzać wszystkich transakcji lokalnej nie uruchomiony przy użyciu <xref:System.Data.Common.DbConnection.BeginTransaction%2A>.</span><span class="sxs-lookup"><span data-stu-id="8e26f-143">You will not receive notice that the local transaction was rolled back, and must manage any local transactions not started using <xref:System.Data.Common.DbConnection.BeginTransaction%2A>.</span></span> <span data-ttu-id="8e26f-144">Jeśli używasz dostawcy danych programu .NET Framework dla programu SQL Server (`SqlClient`) z programem SQL Server, próba zarejestrować spowoduje zgłoszenie wyjątku.</span><span class="sxs-lookup"><span data-stu-id="8e26f-144">If you are using the .NET Framework Data Provider for SQL Server (`SqlClient`) with SQL Server, an attempt to enlist will throw an exception.</span></span> <span data-ttu-id="8e26f-145">Wszystkich innych przypadkach będzie zostać wykryte.</span><span class="sxs-lookup"><span data-stu-id="8e26f-145">All other cases will go undetected.</span></span>  
  
## <a name="promotable-transactions-in-sql-server"></a><span data-ttu-id="8e26f-146">Awansowanie transakcji w programie SQL Server</span><span class="sxs-lookup"><span data-stu-id="8e26f-146">Promotable Transactions in SQL Server</span></span>  
 <span data-ttu-id="8e26f-147">SQL Server obsługuje awansowanie transakcji, w których lekkich transakcji lokalnej może być automatycznie podwyższony do transakcji rozproszonej tylko wtedy, gdy jest to wymagane.</span><span class="sxs-lookup"><span data-stu-id="8e26f-147">SQL Server supports promotable transactions in which a local lightweight transaction can be automatically promoted to a distributed transaction only if it is required.</span></span> <span data-ttu-id="8e26f-148">Awansowanie transakcji nie jest wywoływany dodany narzutów transakcji rozproszonej, chyba że dodany jest wymagana.</span><span class="sxs-lookup"><span data-stu-id="8e26f-148">A promotable transaction does not invoke the added overhead of a distributed transaction unless the added overhead is required.</span></span> <span data-ttu-id="8e26f-149">Aby uzyskać więcej informacji i przykładowy kod, zobacz [System.Transactions integracji z programem SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="8e26f-149">For more information and a code sample, see [System.Transactions Integration with SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span></span>  
  
## <a name="configuring-distributed-transactions"></a><span data-ttu-id="8e26f-150">Konfigurowanie transakcji rozproszonych</span><span class="sxs-lookup"><span data-stu-id="8e26f-150">Configuring Distributed Transactions</span></span>  
 <span data-ttu-id="8e26f-151">Należy włączyć MS DTC za pośrednictwem sieci, aby można było używać transakcji rozproszonych.</span><span class="sxs-lookup"><span data-stu-id="8e26f-151">You may need to enable the MS DTC over the network in order to use distributed transactions.</span></span> <span data-ttu-id="8e26f-152">Jeśli systemu Windows jest włączona zapora, należy zezwolić na użycie sieci lub Otwórz port MS DTC usługi MS DTC.</span><span class="sxs-lookup"><span data-stu-id="8e26f-152">If have the Windows Firewall enabled, you must allow the MS DTC service to use the network or open the MS DTC port.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8e26f-153">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="8e26f-153">See Also</span></span>  
 [<span data-ttu-id="8e26f-154">Transakcje i współbieżność</span><span class="sxs-lookup"><span data-stu-id="8e26f-154">Transactions and Concurrency</span></span>](../../../../docs/framework/data/adonet/transactions-and-concurrency.md)  
 [<span data-ttu-id="8e26f-155">Integracja System.Transactions z programem SQL Server</span><span class="sxs-lookup"><span data-stu-id="8e26f-155">System.Transactions Integration with SQL Server</span></span>](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md)  
 [<span data-ttu-id="8e26f-156">ADO.NET zarządzanego dostawcy i zestawu danych w Centrum deweloperów</span><span class="sxs-lookup"><span data-stu-id="8e26f-156">ADO.NET Managed Providers and DataSet Developer Center</span></span>](http://go.microsoft.com/fwlink/?LinkId=217917)
