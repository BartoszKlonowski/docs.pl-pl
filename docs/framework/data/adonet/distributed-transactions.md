---
title: Transakcje rozproszone
ms.date: 03/30/2017
ms.assetid: 718b257c-bcb2-408e-b004-a7b0adb1c176
ms.openlocfilehash: 89d94e94ea74c73a7f68f6052291c95a7c96f0d6
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/18/2019
ms.locfileid: "59150205"
---
# <a name="distributed-transactions"></a><span data-ttu-id="c4a13-102">Transakcje rozproszone</span><span class="sxs-lookup"><span data-stu-id="c4a13-102">Distributed Transactions</span></span>
<span data-ttu-id="c4a13-103">Transakcja jest zestaw powiązanych zadań, który zakończy się powodzeniem (zatwierdzenie) albo kończy się niepowodzeniem (przerwanie) jako jednostki, między innymi.</span><span class="sxs-lookup"><span data-stu-id="c4a13-103">A transaction is a set of related tasks that either succeeds (commit) or fails (abort) as a unit, among other things.</span></span> <span data-ttu-id="c4a13-104">A *transakcja rozproszona* jest transakcji, która ma wpływ na kilka zasobów.</span><span class="sxs-lookup"><span data-stu-id="c4a13-104">A *distributed transaction* is a transaction that affects several resources.</span></span> <span data-ttu-id="c4a13-105">Dla rozproszonych można zatwierdzić transakcji wszyscy uczestnicy należy zagwarantować, że wszelkie zmiany danych będą trwałe.</span><span class="sxs-lookup"><span data-stu-id="c4a13-105">For a distributed transaction to commit, all participants must guarantee that any change to data will be permanent.</span></span> <span data-ttu-id="c4a13-106">Zmiany muszą zostać zachowane niezależnie awarie systemu lub inne nieprzewidziane zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="c4a13-106">Changes must persist despite system crashes or other unforeseen events.</span></span> <span data-ttu-id="c4a13-107">Jeśli pojedynczego uczestnika nie powiedzie się gwarancji, cała transakcja nie powiedzie się, a wszelkie zmiany danych w zakresie transakcji zostaną przywrócone.</span><span class="sxs-lookup"><span data-stu-id="c4a13-107">If even a single participant fails to make this guarantee, the entire transaction fails, and any changes to data within the scope of the transaction are rolled back.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="c4a13-108">Jeśli spróbujesz przekazać ani wycofać transakcji, jeśli zostanie zgłoszony wyjątek `DataReader` została uruchomiona, gdy transakcja jest aktywny.</span><span class="sxs-lookup"><span data-stu-id="c4a13-108">An exception will be thrown if you attempt to commit or roll back a transaction if a `DataReader` is started while the transaction is active.</span></span>  
  
## <a name="working-with-systemtransactions"></a><span data-ttu-id="c4a13-109">Praca z System.Transactions</span><span class="sxs-lookup"><span data-stu-id="c4a13-109">Working with System.Transactions</span></span>  
 <span data-ttu-id="c4a13-110">W .NET Framework, transakcje rozproszone są zarządzane za pośrednictwem interfejsu API w <xref:System.Transactions> przestrzeni nazw.</span><span class="sxs-lookup"><span data-stu-id="c4a13-110">In the .NET Framework, distributed transactions are managed through the API in the <xref:System.Transactions> namespace.</span></span> <span data-ttu-id="c4a13-111"><xref:System.Transactions> API oddeleguje transakcji rozproszonej, obsługa monitorowania transakcji, takich jak Microsoft Distributed Transaction Coordinator (MS DTC), w przypadku wielu menedżerów zasobów trwałe związane.</span><span class="sxs-lookup"><span data-stu-id="c4a13-111">The <xref:System.Transactions> API will delegate distributed transaction handling to a transaction monitor such as the Microsoft Distributed Transaction Coordinator (MS DTC) when multiple persistent resource managers are involved.</span></span> <span data-ttu-id="c4a13-112">Aby uzyskać więcej informacji, zobacz [podstawowe informacje dotyczące transakcji](../../../../docs/framework/data/transactions/transaction-fundamentals.md).</span><span class="sxs-lookup"><span data-stu-id="c4a13-112">For more information, see [Transaction Fundamentals](../../../../docs/framework/data/transactions/transaction-fundamentals.md).</span></span>  
  
 <span data-ttu-id="c4a13-113">ADO.NET w wersji 2.0 wprowadzono obsługę rejestrowanie w transakcji rozproszonych za pomocą `EnlistTransaction` metody, która pozyskuje połączenia w <xref:System.Transactions.Transaction> wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="c4a13-113">ADO.NET 2.0 introduced support for enlisting in a distributed transaction using the `EnlistTransaction` method, which enlists a connection in a <xref:System.Transactions.Transaction> instance.</span></span> <span data-ttu-id="c4a13-114">W poprzednich wersjach programu ADO.NET, wykonano jawnej rejestracji transakcji rozproszonych za pomocą `EnlistDistributedTransaction` metody połączenia, aby zarejestrować połączenie w <xref:System.EnterpriseServices.ITransaction> wystąpienia, która jest obsługiwana w przypadku zapewnienia zgodności.</span><span class="sxs-lookup"><span data-stu-id="c4a13-114">In previous versions of ADO.NET, explicit enlistment in distributed transactions was performed using the `EnlistDistributedTransaction` method of a connection to enlist a connection in a <xref:System.EnterpriseServices.ITransaction> instance, which is supported for backwards compatibility.</span></span> <span data-ttu-id="c4a13-115">Aby uzyskać więcej informacji na temat transakcji korporacyjnych usług, zobacz [współdziałanie z usługami przedsiębiorstwa i transakcjami COM +](../../../../docs/framework/data/transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span><span class="sxs-lookup"><span data-stu-id="c4a13-115">For more information on Enterprise Services transactions, see [Interoperability with Enterprise Services and COM+ Transactions](../../../../docs/framework/data/transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span></span>  
  
 <span data-ttu-id="c4a13-116">Korzystając z <xref:System.Transactions> transakcji przy użyciu dostawcy programu .NET Framework dla programu SQL Server względem bazy danych programu SQL Server, lekkie <xref:System.Transactions.Transaction> automatycznie będą używane.</span><span class="sxs-lookup"><span data-stu-id="c4a13-116">When using a <xref:System.Transactions> transaction with the .NET Framework Provider for SQL Server against a SQL Server database, a lightweight <xref:System.Transactions.Transaction> will automatically be used.</span></span> <span data-ttu-id="c4a13-117">Transakcja może być następnie podwyższony do pełnego transakcji rozproszonych na zgodnie z potrzebami.</span><span class="sxs-lookup"><span data-stu-id="c4a13-117">The transaction can then be promoted to a full distributed transaction on an as-needed basis.</span></span> <span data-ttu-id="c4a13-118">Aby uzyskać więcej informacji, zobacz [integracja System.Transactions z programem SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="c4a13-118">For more information, see [System.Transactions Integration with SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="c4a13-119">Maksymalna liczba transakcji rozproszonych, które bazy danych Oracle mogą uczestniczyć w tym samym czasie jest ustawiony na 10 domyślnie.</span><span class="sxs-lookup"><span data-stu-id="c4a13-119">The maximum number of distributed transactions that an Oracle database can participate in at one time is set to 10 by default.</span></span> <span data-ttu-id="c4a13-120">Po 10 transakcji po podłączeniu do bazy danych Oracle jest zgłaszany wyjątek.</span><span class="sxs-lookup"><span data-stu-id="c4a13-120">After the 10th transaction when connected to an Oracle database, an exception is thrown.</span></span> <span data-ttu-id="c4a13-121">Oracle nie obsługuje `DDL` wewnątrz transakcji rozproszonej.</span><span class="sxs-lookup"><span data-stu-id="c4a13-121">Oracle does not support `DDL` inside of a distributed transaction.</span></span>  
  
## <a name="automatically-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="c4a13-122">Automatyczne rejestrowanie w transakcji rozproszonych</span><span class="sxs-lookup"><span data-stu-id="c4a13-122">Automatically Enlisting in a Distributed Transaction</span></span>  
 <span data-ttu-id="c4a13-123">Automatyczne umieszczanie jest ustawieniem domyślnym (i preferowana) sposób integrowania połączenia ADO.NET z `System.Transactions`.</span><span class="sxs-lookup"><span data-stu-id="c4a13-123">Automatic enlistment is the default (and preferred) way of integrating ADO.NET connections with `System.Transactions`.</span></span> <span data-ttu-id="c4a13-124">Obiekt połączenia będą automatycznie zarejestrować się w istniejącej transakcji rozproszonych, gdy ustali, że transakcja jest aktywny, która w `System.Transaction` warunki, oznacza to, że `Transaction.Current` nie ma wartości null.</span><span class="sxs-lookup"><span data-stu-id="c4a13-124">A connection object will automatically enlist in an existing distributed transaction if it determines that a transaction is active, which, in `System.Transaction` terms, means that `Transaction.Current` is not null.</span></span> <span data-ttu-id="c4a13-125">Rejestracja automatyczna transakcja występuje, gdy połączenie jest otwarte.</span><span class="sxs-lookup"><span data-stu-id="c4a13-125">Automatic transaction enlistment occurs when the connection is opened.</span></span> <span data-ttu-id="c4a13-126">Go nie nastąpi po tym nawet, jeśli polecenie jest wykonywane wewnątrz zakresu transakcji.</span><span class="sxs-lookup"><span data-stu-id="c4a13-126">It will not happen after that even if a command is executed inside of a transaction scope.</span></span> <span data-ttu-id="c4a13-127">Funkcja automatycznego rejestracji w istniejących transakcji można wyłączyć, określając `Enlist=false` jako parametr ciągu połączenia dla <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType>, lub `OLE DB Services=-7` jako parametr ciągu połączenia dla <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="c4a13-127">You can disable auto-enlistment in existing transactions by specifying `Enlist=false` as a connection string parameter for a <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType>, or `OLE DB Services=-7` as a connection string parameter for an <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="c4a13-128">Aby uzyskać więcej informacji na temat bazy danych Oracle i ODBC parametry połączenia, zobacz <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> i <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="c4a13-128">For more information on Oracle and ODBC connection string parameters, see <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> and <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span>  
  
## <a name="manually-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="c4a13-129">Ręczne rejestrowanie w transakcji rozproszonych</span><span class="sxs-lookup"><span data-stu-id="c4a13-129">Manually Enlisting in a Distributed Transaction</span></span>  
 <span data-ttu-id="c4a13-130">Jeśli trzeba zarejestrować transakcji, która została uruchomiona po otwarto połączenie automatycznej rejestracji jest wyłączona, można zarejestrować się w istniejącej transakcji rozproszonych za pomocą `EnlistTransaction` metody <xref:System.Data.Common.DbConnection> obiektu dla dostawcy, w którym pracujesz za pomocą.</span><span class="sxs-lookup"><span data-stu-id="c4a13-130">If auto-enlistment is disabled or you need to enlist a transaction that was started after the connection was opened, you can enlist in an existing distributed transaction using the `EnlistTransaction` method of the <xref:System.Data.Common.DbConnection> object for the provider you are working with.</span></span> <span data-ttu-id="c4a13-131">Rejestrowanie w istniejącej transakcji rozproszonych zapewnia, że jeśli transakcja jest przekazana lub wycofana, zmiany dokonane przez kod w źródle danych będą się przekazana lub wycofana także.</span><span class="sxs-lookup"><span data-stu-id="c4a13-131">Enlisting in an existing distributed transaction ensures that, if the transaction is committed or rolled back, modifications made by the code at the data source will be committed or rolled back as well.</span></span>  
  
 <span data-ttu-id="c4a13-132">Rejestrowanie w transakcji rozproszonych jest szczególnie przydatny, gdy buforowanie obiektów biznesowych.</span><span class="sxs-lookup"><span data-stu-id="c4a13-132">Enlisting in distributed transactions is particularly applicable when pooling business objects.</span></span> <span data-ttu-id="c4a13-133">Jeśli obiektem biznesowym w puli za pomocą otwartego połączenia, rejestracji automatycznej transakcji występuje tylko po otwarciu tego połączenia.</span><span class="sxs-lookup"><span data-stu-id="c4a13-133">If a business object is pooled with an open connection, automatic transaction enlistment only occurs when that connection is opened.</span></span> <span data-ttu-id="c4a13-134">Jeśli wiele transakcji są wykonywane przy użyciu obiektu biznesowego pulpitów, otwartego połączenia dla tego obiektu zostanie nie automatycznie zarejestrować się w nowo inicjowane transakcji.</span><span class="sxs-lookup"><span data-stu-id="c4a13-134">If multiple transactions are performed using the pooled business object, the open connection for that object will not automatically enlist in newly initiated transactions.</span></span> <span data-ttu-id="c4a13-135">W takim przypadku można wyłączyć rejestracji automatycznej transakcji dla połączenia i zarejestrować połączenie w transakcji za pomocą `EnlistTransaction`.</span><span class="sxs-lookup"><span data-stu-id="c4a13-135">In this case, you can disable automatic transaction enlistment for the connection and enlist the connection in transactions using `EnlistTransaction`.</span></span>  
  
 <span data-ttu-id="c4a13-136">`EnlistTransaction` przyjmuje pojedynczy argument typu <xref:System.Transactions.Transaction> to znaczy odwołanie do istniejącej transakcji.</span><span class="sxs-lookup"><span data-stu-id="c4a13-136">`EnlistTransaction` takes a single argument of type <xref:System.Transactions.Transaction> that is a reference to the existing transaction.</span></span> <span data-ttu-id="c4a13-137">Po wywołaniu tego połączenia `EnlistTransaction` metody, wszelkich zmian wprowadzonych w źródła danych przy użyciu połączenia znajdują się w transakcji.</span><span class="sxs-lookup"><span data-stu-id="c4a13-137">After calling the connection's `EnlistTransaction` method, all modifications made at the data source using the connection are included in the transaction.</span></span> <span data-ttu-id="c4a13-138">Przekazywanie wartości null unenlists połączenie z jego bieżącej rejestracji transakcji rozproszonej.</span><span class="sxs-lookup"><span data-stu-id="c4a13-138">Passing a null value unenlists the connection from its current distributed transaction enlistment.</span></span> <span data-ttu-id="c4a13-139">Należy pamiętać, że można otworzyć połączenia przed wywołaniem `EnlistTransaction`.</span><span class="sxs-lookup"><span data-stu-id="c4a13-139">Note that the connection must be opened before calling `EnlistTransaction`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="c4a13-140">Gdy połączenie jest jawnie zarejestrowana w transakcji, nie może być niezaznaczone zobowiązaniom lub zobowiązaniom w innej transakcji aż do zakończenia pierwszej transakcji.</span><span class="sxs-lookup"><span data-stu-id="c4a13-140">Once a connection is explicitly enlisted on a transaction, it cannot be un-enlisted or enlisted in another transaction until the first transaction finishes.</span></span>  
  
> [!CAUTION]
>  <span data-ttu-id="c4a13-141">`EnlistTransaction` zgłasza wyjątek, jeśli połączenie już się rozpoczęło transakcji za pomocą połączenia <xref:System.Data.Common.DbConnection.BeginTransaction%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="c4a13-141">`EnlistTransaction` throws an exception if the connection has already begun a transaction using the connection's <xref:System.Data.Common.DbConnection.BeginTransaction%2A> method.</span></span> <span data-ttu-id="c4a13-142">Jednak jeśli transakcja jest transakcji lokalnej rozpoczęło się o źródle danych (na przykład wykonywania instrukcji BEGIN TRANSACTION, w sposób jawny przy użyciu <xref:System.Data.SqlClient.SqlCommand>), `EnlistTransaction` będzie wycofać transakcji lokalnej i zarejestrować w istniejących rozproszonych transakcji, zgodnie z żądaniem.</span><span class="sxs-lookup"><span data-stu-id="c4a13-142">However, if the transaction is a local transaction started at the data source (for example, executing the BEGIN TRANSACTION statement explicitly using a <xref:System.Data.SqlClient.SqlCommand>), `EnlistTransaction` will roll back the local transaction and enlist in the existing distributed transaction as requested.</span></span> <span data-ttu-id="c4a13-143">Nie będą otrzymywali Zwróć uwagę, że lokalne transakcja została wycofana, a musi zarządzać wszystkie transakcje lokalne Nierozpoczęte przy użyciu <xref:System.Data.Common.DbConnection.BeginTransaction%2A>.</span><span class="sxs-lookup"><span data-stu-id="c4a13-143">You will not receive notice that the local transaction was rolled back, and must manage any local transactions not started using <xref:System.Data.Common.DbConnection.BeginTransaction%2A>.</span></span> <span data-ttu-id="c4a13-144">Jeśli używasz dostawcy danych .NET Framework dla programu SQL Server (`SqlClient`) z programem SQL Server, próba zarejestrować spowoduje zgłoszenie wyjątku.</span><span class="sxs-lookup"><span data-stu-id="c4a13-144">If you are using the .NET Framework Data Provider for SQL Server (`SqlClient`) with SQL Server, an attempt to enlist will throw an exception.</span></span> <span data-ttu-id="c4a13-145">Wszystkich innych przypadkach zaczną niewykryte.</span><span class="sxs-lookup"><span data-stu-id="c4a13-145">All other cases will go undetected.</span></span>  
  
## <a name="promotable-transactions-in-sql-server"></a><span data-ttu-id="c4a13-146">Awansowanie transakcji w programie SQL Server</span><span class="sxs-lookup"><span data-stu-id="c4a13-146">Promotable Transactions in SQL Server</span></span>  
 <span data-ttu-id="c4a13-147">SQL Server obsługuje awansowanie transakcji, w których uproszczone transakcji lokalnej może być automatycznie podwyższony do transakcji rozproszonych tylko wtedy, gdy jest to wymagane.</span><span class="sxs-lookup"><span data-stu-id="c4a13-147">SQL Server supports promotable transactions in which a local lightweight transaction can be automatically promoted to a distributed transaction only if it is required.</span></span> <span data-ttu-id="c4a13-148">Awansowanie transakcji nie jest wywoływany dodano obciążenie z transakcji rozproszonych, chyba że dodany obciążenie jest wymagana.</span><span class="sxs-lookup"><span data-stu-id="c4a13-148">A promotable transaction does not invoke the added overhead of a distributed transaction unless the added overhead is required.</span></span> <span data-ttu-id="c4a13-149">Aby uzyskać więcej informacji i przykładowy kod, zobacz [integracja System.Transactions z programem SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="c4a13-149">For more information and a code sample, see [System.Transactions Integration with SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span></span>  
  
## <a name="configuring-distributed-transactions"></a><span data-ttu-id="c4a13-150">Konfigurowanie transakcje rozproszone</span><span class="sxs-lookup"><span data-stu-id="c4a13-150">Configuring Distributed Transactions</span></span>  
 <span data-ttu-id="c4a13-151">Może być konieczne Włączanie MS DTC za pośrednictwem sieci, aby można było używać transakcji rozproszonych.</span><span class="sxs-lookup"><span data-stu-id="c4a13-151">You may need to enable the MS DTC over the network in order to use distributed transactions.</span></span> <span data-ttu-id="c4a13-152">Jeśli masz Windows włączona zapora, musisz zezwolić na usługę MS DTC, aby używała sieci ani nie otwieraj portu MS DTC.</span><span class="sxs-lookup"><span data-stu-id="c4a13-152">If have the Windows Firewall enabled, you must allow the MS DTC service to use the network or open the MS DTC port.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c4a13-153">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="c4a13-153">See also</span></span>

- [<span data-ttu-id="c4a13-154">Transakcje i współbieżność</span><span class="sxs-lookup"><span data-stu-id="c4a13-154">Transactions and Concurrency</span></span>](../../../../docs/framework/data/adonet/transactions-and-concurrency.md)
- [<span data-ttu-id="c4a13-155">Integracja System.Transactions z programem SQL Server</span><span class="sxs-lookup"><span data-stu-id="c4a13-155">System.Transactions Integration with SQL Server</span></span>](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md)
- [<span data-ttu-id="c4a13-156">ADO.NET zarządzanego dostawcy i Centrum deweloperów zestawu danych</span><span class="sxs-lookup"><span data-stu-id="c4a13-156">ADO.NET Managed Providers and DataSet Developer Center</span></span>](https://go.microsoft.com/fwlink/?LinkId=217917)
