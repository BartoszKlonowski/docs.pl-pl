---
title: "Połączenie z serwerem SQL buforowanie (ADO.NET)"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-ado
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
ms.assetid: 7e51d44e-7c4e-4040-9332-f0190fe36f07
caps.latest.revision: "11"
author: douglaslMS
ms.author: douglasl
manager: craigg
ms.workload: dotnet
ms.openlocfilehash: 497ebbd573ea05568010485f04f08cdeddbf6041
ms.sourcegitcommit: ed26cfef4e18f6d93ab822d8c29f902cff3519d1
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 01/17/2018
---
# <a name="sql-server-connection-pooling-adonet"></a><span data-ttu-id="d5825-102">Połączenie z serwerem SQL buforowanie (ADO.NET)</span><span class="sxs-lookup"><span data-stu-id="d5825-102">SQL Server Connection Pooling (ADO.NET)</span></span>
<span data-ttu-id="d5825-103">Łączenie z serwerem bazy danych zazwyczaj składa się z kilku kroków czasochłonna.</span><span class="sxs-lookup"><span data-stu-id="d5825-103">Connecting to a database server typically consists of several time-consuming steps.</span></span> <span data-ttu-id="d5825-104">Kanału fizycznego, takie jak gniazda lub nazwanego potoku należy ustalić, musi nastąpić początkowego uzgadniania z serwerem, musi zostać przeanalizowany informacje o parametrach połączenia, połączenie musi zostać uwierzytelniony przez serwer, kontroli musi zostać uruchomione dla rejestrowanie w Bieżąca transakcja i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="d5825-104">A physical channel such as a socket or a named pipe must be established, the initial handshake with the server must occur, the connection string information must be parsed, the connection must be authenticated by the server, checks must be run for enlisting in the current transaction, and so on.</span></span>  
  
 <span data-ttu-id="d5825-105">W praktyce większość aplikacji, należy użyć tylko jednej lub kilku różnych konfiguracji dla połączenia.</span><span class="sxs-lookup"><span data-stu-id="d5825-105">In practice, most applications use only one or a few different configurations for connections.</span></span> <span data-ttu-id="d5825-106">Oznacza to, że podczas uruchamiania aplikacji i wiele połączeń identyczne będzie wielokrotnie otwierania i zamykania.</span><span class="sxs-lookup"><span data-stu-id="d5825-106">This means that during application execution, many identical connections will be repeatedly opened and closed.</span></span> <span data-ttu-id="d5825-107">Aby zminimalizować koszty otwarcia połączeń, [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)] korzysta z techniki optymalizacji o nazwie *puli połączeń*.</span><span class="sxs-lookup"><span data-stu-id="d5825-107">To minimize the cost of opening connections, [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)] uses an optimization technique called *connection pooling*.</span></span>  
  
 <span data-ttu-id="d5825-108">Pula połączeń zmniejsza liczbę razy, które muszą być otwarte nowe połączenia.</span><span class="sxs-lookup"><span data-stu-id="d5825-108">Connection pooling reduces the number of times that new connections must be opened.</span></span> <span data-ttu-id="d5825-109">*Pulę* zachowuje własność fizycznego połączenia.</span><span class="sxs-lookup"><span data-stu-id="d5825-109">The *pooler* maintains ownership of the physical connection.</span></span> <span data-ttu-id="d5825-110">Zarządza połączeń przy zachowaniu aktywności zestaw aktywnych połączeń dla każdej konfiguracji danego połączenia.</span><span class="sxs-lookup"><span data-stu-id="d5825-110">It manages connections by keeping alive a set of active connections for each given connection configuration.</span></span> <span data-ttu-id="d5825-111">Zawsze, gdy użytkownik wywołuje `Open` połączenia i pulę szuka dostępnych połączeń w puli.</span><span class="sxs-lookup"><span data-stu-id="d5825-111">Whenever a user calls `Open` on a connection, the pooler looks for an available connection in the pool.</span></span> <span data-ttu-id="d5825-112">Jeśli w puli połączeń jest dostępny, zwraca go do obiektu wywołującego, zamiast Otwieranie nowego połączenia.</span><span class="sxs-lookup"><span data-stu-id="d5825-112">If a pooled connection is available, it returns it to the caller instead of opening a new connection.</span></span> <span data-ttu-id="d5825-113">Gdy aplikacja wywołuje `Close` połączenia i pulę zwraca go do puli zestawów aktywnych połączeń zamiast jego zamknięciem.</span><span class="sxs-lookup"><span data-stu-id="d5825-113">When the application calls `Close` on the connection, the pooler returns it to the pooled set of active connections instead of closing it.</span></span> <span data-ttu-id="d5825-114">Gdy połączenie jest zwracany do puli, po wykonaniu tych czynności można użyć ponownie przy następnym `Open` wywołania.</span><span class="sxs-lookup"><span data-stu-id="d5825-114">Once the connection is returned to the pool, it is ready to be reused on the next `Open` call.</span></span>  
  
 <span data-ttu-id="d5825-115">Tylko połączenia z taką samą konfigurację można puli.</span><span class="sxs-lookup"><span data-stu-id="d5825-115">Only connections with the same configuration can be pooled.</span></span> [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)]<span data-ttu-id="d5825-116">zapewnia wiele pul w tym samym czasie, po jednej dla każdej konfiguracji.</span><span class="sxs-lookup"><span data-stu-id="d5825-116"> keeps several pools at the same time, one for each configuration.</span></span> <span data-ttu-id="d5825-117">Połączenia są podzielone na pule przez ciąg połączenia i tożsamości systemu Windows, gdy jest używane zintegrowane zabezpieczenia.</span><span class="sxs-lookup"><span data-stu-id="d5825-117">Connections are separated into pools by connection string, and by Windows identity when integrated security is used.</span></span> <span data-ttu-id="d5825-118">Połączenia są również puli według tego, czy są zarejestrowane w transakcji.</span><span class="sxs-lookup"><span data-stu-id="d5825-118">Connections are also pooled based on whether they are enlisted in a transaction.</span></span> <span data-ttu-id="d5825-119">Korzystając z <xref:System.Data.SqlClient.SqlConnection.ChangePassword%2A>, <xref:System.Data.SqlClient.SqlCredential> wystąpienie ma wpływ na puli połączeń.</span><span class="sxs-lookup"><span data-stu-id="d5825-119">When using <xref:System.Data.SqlClient.SqlConnection.ChangePassword%2A>, the <xref:System.Data.SqlClient.SqlCredential> instance affects the connection pool.</span></span> <span data-ttu-id="d5825-120">Różnych wystąpień <xref:System.Data.SqlClient.SqlCredential> użyje pule innego połączenia, nawet jeśli identyfikator użytkownika i hasło są takie same.</span><span class="sxs-lookup"><span data-stu-id="d5825-120">Different instances of <xref:System.Data.SqlClient.SqlCredential> will use different connection pools, even if the user ID and password are the same.</span></span>  
  
 <span data-ttu-id="d5825-121">Tworzenie puli połączeń może znacznie zwiększyć wydajność i skalowalność aplikacji.</span><span class="sxs-lookup"><span data-stu-id="d5825-121">Pooling connections can significantly enhance the performance and scalability of your application.</span></span> <span data-ttu-id="d5825-122">Domyślnie buforowanie połączeń jest włączone w [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d5825-122">By default, connection pooling is enabled in [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)].</span></span> <span data-ttu-id="d5825-123">Chyba że jawnie wyłączyć ją, pulę optymalizuje połączenia otwarte i zamknięte w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="d5825-123">Unless you explicitly disable it, the pooler optimizes the connections as they are opened and closed in your application.</span></span> <span data-ttu-id="d5825-124">Może też podawać wiele modyfikatorów ciąg połączenia kontrolowanie zachowania buforowania połączeń.</span><span class="sxs-lookup"><span data-stu-id="d5825-124">You can also supply several connection string modifiers to control connection pooling behavior.</span></span> <span data-ttu-id="d5825-125">Aby uzyskać więcej informacji zobacz "Kontrolowanie połączenia buforowanie ze słowami kluczowymi parametrów połączenia" w dalszej części tego tematu.</span><span class="sxs-lookup"><span data-stu-id="d5825-125">For more information, see "Controlling Connection Pooling with Connection String Keywords" later in this topic.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d5825-126">Gdy buforowanie połączeń jest włączone, jeśli wystąpi błąd upływu limitu czasu lub inny błąd logowania, zostanie wygenerowany wyjątek i kolejne próby połączenia zakończy się niepowodzeniem dla następnego pięć sekund, "okresu blokowania".</span><span class="sxs-lookup"><span data-stu-id="d5825-126">When connection pooling is enabled, and if a timeout error or other login error occurs, an exception will be thrown and subsequent connection attempts will fail for the next five seconds, the "blocking period".</span></span> <span data-ttu-id="d5825-127">Jeśli aplikacja próbuje nawiązać połączenia w okresie blokowania, pierwszy wyjątek zostanie ponownie wygenerowany.</span><span class="sxs-lookup"><span data-stu-id="d5825-127">If the application attempts to connect within the blocking period, the first exception will be thrown again.</span></span> <span data-ttu-id="d5825-128">Kolejne błędy po zakończeniu okresu blokowania spowoduje nowych okresów blokujące, które jest dwa razy tak długo, jak poprzedniego okresu blokowania maksymalnie jedną minutę.</span><span class="sxs-lookup"><span data-stu-id="d5825-128">Subsequent failures after a blocking period ends will result in a new blocking periods that is twice as long as the previous blocking period, up to a maximum of one minute.</span></span>  
  
## <a name="pool-creation-and-assignment"></a><span data-ttu-id="d5825-129">Tworzenie puli i przypisania</span><span class="sxs-lookup"><span data-stu-id="d5825-129">Pool Creation and Assignment</span></span>  
 <span data-ttu-id="d5825-130">Przy pierwszym otwarciu połączenia, puli połączeń jest utworzony oparte na dokładne algorytm dopasowania, które kojarzy puli przy użyciu parametrów połączenia dla połączenia.</span><span class="sxs-lookup"><span data-stu-id="d5825-130">When a connection is first opened, a connection pool is created based on an exact matching algorithm that associates the pool with the connection string in the connection.</span></span> <span data-ttu-id="d5825-131">Każdej puli połączeń jest skojarzony z ciągu połączenia distinct.</span><span class="sxs-lookup"><span data-stu-id="d5825-131">Each connection pool is associated with a distinct connection string.</span></span> <span data-ttu-id="d5825-132">Po otwarciu nowego połączenia, jeśli ciąg połączenia nie jest dokładnego dopasowania do istniejącej puli, jest tworzona nowa pula.</span><span class="sxs-lookup"><span data-stu-id="d5825-132">When a new connection is opened, if the connection string is not an exact match to an existing pool, a new pool is created.</span></span> <span data-ttu-id="d5825-133">Połączenia są grupowane w pulach jednego procesu, domena aplikacji, na ciąg połączenia i używane są zabezpieczenia zintegrowane na tożsamość systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="d5825-133">Connections are pooled per process, per application domain, per connection string and when integrated security is used, per Windows identity.</span></span> <span data-ttu-id="d5825-134">Parametry połączenia należy również dokładnego dopasowania; słowa kluczowe dostarczone w innej kolejności dla tego samego połączenia będzie można osobno puli.</span><span class="sxs-lookup"><span data-stu-id="d5825-134">Connection strings must also be an exact match; keywords supplied in a different order for the same connection will be pooled separately.</span></span>  
  
 <span data-ttu-id="d5825-135">W poniższym C# przykładzie trzy nowe <xref:System.Data.SqlClient.SqlConnection> obiekty są tworzone, ale tylko dwa pul połączeń są wymagane do zarządzania nimi.</span><span class="sxs-lookup"><span data-stu-id="d5825-135">In the following C# example, three new <xref:System.Data.SqlClient.SqlConnection> objects are created, but only two connection pools are required to manage them.</span></span> <span data-ttu-id="d5825-136">Należy pamiętać, że parametry połączenia pierwszego i drugiego różnią się wartość przypisana do `Initial Catalog`.</span><span class="sxs-lookup"><span data-stu-id="d5825-136">Note that the first and second connection strings differ by the value assigned for `Initial Catalog`.</span></span>  
  
```  
using (SqlConnection connection = new SqlConnection(  
  "Integrated Security=SSPI;Initial Catalog=Northwind"))  
    {  
        connection.Open();        
        // Pool A is created.  
    }  
  
using (SqlConnection connection = new SqlConnection(  
  "Integrated Security=SSPI;Initial Catalog=pubs"))  
    {  
        connection.Open();        
        // Pool B is created because the connection strings differ.  
    }  
  
using (SqlConnection connection = new SqlConnection(  
  "Integrated Security=SSPI;Initial Catalog=Northwind"))  
    {  
        connection.Open();        
        // The connection string matches pool A.  
    }  
```  
  
 <span data-ttu-id="d5825-137">Jeśli `MinPoolSize` nie została określona w parametrach połączenia lub określone jako zero, połączeń w puli, które zostaną zamknięte po okresie braku aktywności.</span><span class="sxs-lookup"><span data-stu-id="d5825-137">If `MinPoolSize` is either not specified in the connection string or is specified as zero, the connections in the pool will be closed after a period of inactivity.</span></span> <span data-ttu-id="d5825-138">Jednak jeśli określonego `MinPoolSize` jest większa od zera, dopóki nie jest niszczony puli połączeń `AppDomain` zostanie zwolniona i kończy proces.</span><span class="sxs-lookup"><span data-stu-id="d5825-138">However, if the specified `MinPoolSize` is greater than zero, the connection pool is not destroyed until the `AppDomain` is unloaded and the process ends.</span></span> <span data-ttu-id="d5825-139">Konserwacja pul nieaktywne lub jest pusty obejmuje koszty minimalny system.</span><span class="sxs-lookup"><span data-stu-id="d5825-139">Maintenance of inactive or empty pools involves minimal system overhead.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d5825-140">Puli są automatycznie usuwane, gdy wystąpi błąd krytyczny, takie jak tryb failover.</span><span class="sxs-lookup"><span data-stu-id="d5825-140">The pool is automatically cleared when a fatal error occurs, such as a failover.</span></span>  
  
## <a name="adding-connections"></a><span data-ttu-id="d5825-141">Dodawanie połączenia</span><span class="sxs-lookup"><span data-stu-id="d5825-141">Adding Connections</span></span>  
 <span data-ttu-id="d5825-142">Puli połączeń jest tworzona dla każdej parametry połączenia unikatowy.</span><span class="sxs-lookup"><span data-stu-id="d5825-142">A connection pool is created for each unique connection string.</span></span> <span data-ttu-id="d5825-143">Po utworzeniu puli wielu obiektów połączenia są tworzone i dodawane do puli, dzięki czemu puli minimalny wymagany rozmiar jest spełniony.</span><span class="sxs-lookup"><span data-stu-id="d5825-143">When a pool is created, multiple connection objects are created and added to the pool so that the minimum pool size requirement is satisfied.</span></span> <span data-ttu-id="d5825-144">Połączenia są dodawane do puli, zgodnie z potrzebami, maksymalnie maksymalny rozmiar puli określony (wartość domyślna to 100).</span><span class="sxs-lookup"><span data-stu-id="d5825-144">Connections are added to the pool as needed, up to the maximum pool size specified (100 is the default).</span></span> <span data-ttu-id="d5825-145">Połączenia są wydawane do puli, gdy są one zamknięty lub usunięty.</span><span class="sxs-lookup"><span data-stu-id="d5825-145">Connections are released back into the pool when they are closed or disposed.</span></span>  
  
 <span data-ttu-id="d5825-146">Gdy <xref:System.Data.SqlClient.SqlConnection> wymagany jest obiekt, są uzyskiwane z puli, jeśli jest dostępne połączenie można używać.</span><span class="sxs-lookup"><span data-stu-id="d5825-146">When a <xref:System.Data.SqlClient.SqlConnection> object is requested, it is obtained from the pool if a usable connection is available.</span></span> <span data-ttu-id="d5825-147">Może być używany, połączenie musi używana, mają pasujących kontekst transakcji lub być nieskojarzone z żadnym kontekstem transakcji i mają prawidłowe łącze do serwera.</span><span class="sxs-lookup"><span data-stu-id="d5825-147">To be usable, a connection must be unused, have a matching transaction context or be unassociated with any transaction context, and have a valid link to the server.</span></span>  
  
 <span data-ttu-id="d5825-148">Pulę połączeń spełnia żądań połączeń przez ponowne przydzielanie połączeń po ich wydaniu do puli.</span><span class="sxs-lookup"><span data-stu-id="d5825-148">The connection pooler satisfies requests for connections by reallocating connections as they are released back into the pool.</span></span> <span data-ttu-id="d5825-149">Jeśli został osiągnięty maksymalny rozmiar puli i nie można używać połączenie nie jest dostępne, żądanie jest przechowywane w kolejce.</span><span class="sxs-lookup"><span data-stu-id="d5825-149">If the maximum pool size has been reached and no usable connection is available, the request is queued.</span></span> <span data-ttu-id="d5825-150">Pulę próbuje odzyskać wszystkie połączenia, aż do osiągnięcia limitu czasu (wartość domyślna wynosi 15 sekund).</span><span class="sxs-lookup"><span data-stu-id="d5825-150">The pooler then tries to reclaim any connections until the time-out is reached (the default is 15 seconds).</span></span> <span data-ttu-id="d5825-151">Jeśli pulę nie może spełnić żądania, zanim upłynie limit czasu połączenia, jest zwracany wyjątek.</span><span class="sxs-lookup"><span data-stu-id="d5825-151">If the pooler cannot satisfy the request before the connection times out, an exception is thrown.</span></span>  
  
> [!CAUTION]
>  <span data-ttu-id="d5825-152">Zdecydowanie zaleca się zawsze zamknąć połączenie po zakończeniu używa go, tak aby połączenie zostanie zwrócony do puli.</span><span class="sxs-lookup"><span data-stu-id="d5825-152">We strongly recommend that you always close the connection when you are finished using it so that the connection will be returned to the pool.</span></span> <span data-ttu-id="d5825-153">Można to zrobić za pomocą `Close` lub `Dispose` metody `Connection` obiektu lub przez otwarcie wszystkich połączeń wewnątrz `using` instrukcji w języku C# lub `Using` instrukcji w [!INCLUDE[vbprvb](../../../../includes/vbprvb-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d5825-153">You can do this using either the `Close` or `Dispose` methods of the `Connection` object, or by opening all connections inside a `using` statement in C#, or a `Using` statement in [!INCLUDE[vbprvb](../../../../includes/vbprvb-md.md)].</span></span> <span data-ttu-id="d5825-154">Połączenia, które nie są jawnie zamknięty, nie może dodać lub zwrócony do puli.</span><span class="sxs-lookup"><span data-stu-id="d5825-154">Connections that are not explicitly closed might not be added or returned to the pool.</span></span> <span data-ttu-id="d5825-155">Aby uzyskać więcej informacji, zobacz [za pomocą instrukcji](~/docs/csharp/language-reference/keywords/using-statement.md) lub [porady: usuwanie zasobu systemu](~/docs/visual-basic/programming-guide/language-features/control-flow/how-to-dispose-of-a-system-resource.md) dla [!INCLUDE[vbprvb](../../../../includes/vbprvb-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d5825-155">For more information, see [using Statement](~/docs/csharp/language-reference/keywords/using-statement.md) or [How to: Dispose of a System Resource](~/docs/visual-basic/programming-guide/language-features/control-flow/how-to-dispose-of-a-system-resource.md) for [!INCLUDE[vbprvb](../../../../includes/vbprvb-md.md)].</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d5825-156">Nie wywołuj `Close` lub `Dispose` na `Connection`, `DataReader`, lub innego obiektu zarządzanego w `Finalize` metody klasy.</span><span class="sxs-lookup"><span data-stu-id="d5825-156">Do not call `Close` or `Dispose` on a `Connection`, a `DataReader`, or any other managed object in the `Finalize` method of your class.</span></span> <span data-ttu-id="d5825-157">W finalizator zwolnić tylko niezarządzane zasoby, które bezpośrednio należą do klasy.</span><span class="sxs-lookup"><span data-stu-id="d5825-157">In a finalizer, only release unmanaged resources that your class owns directly.</span></span> <span data-ttu-id="d5825-158">Jeśli klasa nie ma żadnych niezarządzanych zasobów, nie dołączaj `Finalize` metody w definicji klasy.</span><span class="sxs-lookup"><span data-stu-id="d5825-158">If your class does not own any unmanaged resources, do not include a `Finalize` method in your class definition.</span></span> <span data-ttu-id="d5825-159">Aby uzyskać więcej informacji, zobacz [wyrzucanie elementów bezużytecznych](../../../../docs/standard/garbage-collection/index.md).</span><span class="sxs-lookup"><span data-stu-id="d5825-159">For more information, see [Garbage Collection](../../../../docs/standard/garbage-collection/index.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d5825-160">Zdarzenia logowania i wylogowywania nie zostanie wygenerowany na serwerze, gdy połączenie jest pobranych z lub zwrócony do puli połączeń.</span><span class="sxs-lookup"><span data-stu-id="d5825-160">Login and logout events will not be raised on the server when a connection is fetched from or returned to the connection pool.</span></span> <span data-ttu-id="d5825-161">Jest tak, ponieważ połączenie nie jest w rzeczywistości zamknięte zwracanie do puli połączeń.</span><span class="sxs-lookup"><span data-stu-id="d5825-161">This is because the connection is not actually closed when it is returned to the connection pool.</span></span> <span data-ttu-id="d5825-162">Aby uzyskać więcej informacji, zobacz [klasa zdarzeń inspekcji logowania](http://msdn2.microsoft.com/library/ms190260.aspx) i [klasa zdarzeń inspekcji wylogowania](http://msdn2.microsoft.com/library/ms175827.aspx) w [!INCLUDE[ssNoVersion](../../../../includes/ssnoversion-md.md)] — książki Online.</span><span class="sxs-lookup"><span data-stu-id="d5825-162">For more information, see [Audit Login Event Class](http://msdn2.microsoft.com/library/ms190260.aspx) and [Audit Logout Event Class](http://msdn2.microsoft.com/library/ms175827.aspx) in [!INCLUDE[ssNoVersion](../../../../includes/ssnoversion-md.md)] Books Online.</span></span>  
  
## <a name="removing-connections"></a><span data-ttu-id="d5825-163">Usuwanie połączenia</span><span class="sxs-lookup"><span data-stu-id="d5825-163">Removing Connections</span></span>  
 <span data-ttu-id="d5825-164">Pulę połączeń usuwa połączenie z puli, po był bezczynny około 4-8 minut lub jeśli pulę wykryje, że zostały Przerwano połączenie z serwerem.</span><span class="sxs-lookup"><span data-stu-id="d5825-164">The connection pooler removes a connection from the pool after it has been idle for approximately 4-8 minutes, or if the pooler detects that the connection with the server has been severed.</span></span> <span data-ttu-id="d5825-165">Należy pamiętać, że ODCIĘTA połączenia można wykryć tylko po próbie do komunikowania się z serwerem.</span><span class="sxs-lookup"><span data-stu-id="d5825-165">Note that a severed connection can be detected only after attempting to communicate with the server.</span></span> <span data-ttu-id="d5825-166">Jeśli połączenie zostanie znaleziony, który nie jest już połączony z serwerem, jest oznaczony jako nieprawidłowy.</span><span class="sxs-lookup"><span data-stu-id="d5825-166">If a connection is found that is no longer connected to the server, it is marked as invalid.</span></span> <span data-ttu-id="d5825-167">Nieprawidłowy połączenia zostaną usunięte z puli połączeń, tylko wtedy, gdy są one zamknięte lub odzyskać.</span><span class="sxs-lookup"><span data-stu-id="d5825-167">Invalid connections are removed from the connection pool only when they are closed or reclaimed.</span></span>  
  
 <span data-ttu-id="d5825-168">Jeśli istnieje połączenie z serwerem nie zniknie, to połączenie można nakreślić z puli, nawet jeśli pulę połączeń nie wykryto połączenia ODCIĘTA i nie ona oznaczona jako niepoprawna.</span><span class="sxs-lookup"><span data-stu-id="d5825-168">If a connection exists to a server that has disappeared, this connection can be drawn from the pool even if the connection pooler has not detected the severed connection and marked it as invalid.</span></span> <span data-ttu-id="d5825-169">Jest to możliwe, ponieważ korzyści pulę powodując innego obiegu do serwera występuje wyeliminować koszty sprawdzanie, czy połączenie jest nadal ważny.</span><span class="sxs-lookup"><span data-stu-id="d5825-169">This is the case because the overhead of checking that the connection is still valid would eliminate the benefits of having a pooler by causing another round trip to the server to occur.</span></span> <span data-ttu-id="d5825-170">W takiej sytuacji pierwsza próba połączenia z wykryje połączenia zostały oddzielone, czy jest zgłaszany wyjątek.</span><span class="sxs-lookup"><span data-stu-id="d5825-170">When this occurs, the first attempt to use the connection will detect that the connection has been severed, and an exception is thrown.</span></span>  
  
## <a name="clearing-the-pool"></a><span data-ttu-id="d5825-171">Wyczyszczenie puli</span><span class="sxs-lookup"><span data-stu-id="d5825-171">Clearing the Pool</span></span>  
 [!INCLUDE[vstecado](../../../../includes/vstecado-md.md)]<span data-ttu-id="d5825-172">2.0 wprowadzono dwie nowe metody Wyczyść puli: <xref:System.Data.SqlClient.SqlConnection.ClearAllPools%2A> i <xref:System.Data.SqlClient.SqlConnection.ClearPool%2A>.</span><span class="sxs-lookup"><span data-stu-id="d5825-172"> 2.0 introduced two new methods to clear the pool: <xref:System.Data.SqlClient.SqlConnection.ClearAllPools%2A> and <xref:System.Data.SqlClient.SqlConnection.ClearPool%2A>.</span></span> <span data-ttu-id="d5825-173">`ClearAllPools`Czyści pul połączeń dla danego dostawcy i `ClearPool` czyści puli połączeń, który jest skojarzony z określonego połączenia.</span><span class="sxs-lookup"><span data-stu-id="d5825-173">`ClearAllPools` clears the connection pools for a given provider, and `ClearPool` clears the connection pool that is associated with a specific connection.</span></span> <span data-ttu-id="d5825-174">W przypadku połączeń używana w momencie wywołania one są odpowiednio oznaczone.</span><span class="sxs-lookup"><span data-stu-id="d5825-174">If there are connections being used at the time of the call, they are marked appropriately.</span></span> <span data-ttu-id="d5825-175">Po zamknięciu, są ignorowane zamiast zwracanych do puli.</span><span class="sxs-lookup"><span data-stu-id="d5825-175">When they are closed, they are discarded instead of being returned to the pool.</span></span>  
  
## <a name="transaction-support"></a><span data-ttu-id="d5825-176">Obsługa transakcji</span><span class="sxs-lookup"><span data-stu-id="d5825-176">Transaction Support</span></span>  
 <span data-ttu-id="d5825-177">Połączenia są pobierane z puli i przypisane transakcji na podstawie kontekstu.</span><span class="sxs-lookup"><span data-stu-id="d5825-177">Connections are drawn from the pool and assigned based on transaction context.</span></span> <span data-ttu-id="d5825-178">O ile `Enlist=false` określono w parametrach połączenia puli połączeń upewnia się, że połączenie jest zarejestrowane w <xref:System.Transactions.Transaction.Current%2A> kontekstu.</span><span class="sxs-lookup"><span data-stu-id="d5825-178">Unless `Enlist=false` is specified in the connection string, the connection pool makes sure that the connection is enlisted in the <xref:System.Transactions.Transaction.Current%2A> context.</span></span> <span data-ttu-id="d5825-179">Gdy połączenie jest zamknięte i zwrócony do puli z zarejestrowane `System.Transactions` transakcji, jest ustawiona Odłóż w taki sposób, że następne żądania dla tej puli połączeń z tym samym `System.Transactions` transakcji zwróci tego samego połączenia, jeśli jest dostępna.</span><span class="sxs-lookup"><span data-stu-id="d5825-179">When a connection is closed and returned to the pool with an enlisted `System.Transactions` transaction, it is set aside in such a way that the next request for that connection pool with the same `System.Transactions` transaction will return the same connection if it is available.</span></span> <span data-ttu-id="d5825-180">Jeśli takie żądania, a nie ma dostępnych żadnych puli połączeń, połączenie jest od nietransakcyjnej częścią puli i zarejestrowany.</span><span class="sxs-lookup"><span data-stu-id="d5825-180">If such a request is issued, and there are no pooled connections available, a connection is drawn from the non-transacted part of the pool and enlisted.</span></span> <span data-ttu-id="d5825-181">Jeśli żadne połączenia są dostępne w każdym obszarze puli, nowe połączenie jest tworzony i zarejestrowany.</span><span class="sxs-lookup"><span data-stu-id="d5825-181">If no connections are available in either area of the pool, a new connection is created and enlisted.</span></span>  
  
 <span data-ttu-id="d5825-182">Gdy połączenie jest zamknięte, zwolnieniu do puli, jak i w odpowiednich części, na podstawie jego kontekstu transakcji.</span><span class="sxs-lookup"><span data-stu-id="d5825-182">When a connection is closed, it is released back into the pool and into the appropriate subdivision based on its transaction context.</span></span> <span data-ttu-id="d5825-183">W związku z tym można zamknąć połączenia bez wygenerowaniem błędu, nawet jeśli transakcja rozproszona jest nadal oczekujące.</span><span class="sxs-lookup"><span data-stu-id="d5825-183">Therefore, you can close the connection without generating an error, even though a distributed transaction is still pending.</span></span> <span data-ttu-id="d5825-184">Dzięki temu można zatwierdzić lub przerwać transakcję rozproszoną później.</span><span class="sxs-lookup"><span data-stu-id="d5825-184">This allows you to commit or abort the distributed transaction later.</span></span>  
  
## <a name="controlling-connection-pooling-with-connection-string-keywords"></a><span data-ttu-id="d5825-185">Kontrolowanie użycia puli połączeń ze słowami kluczowymi parametrów połączenia</span><span class="sxs-lookup"><span data-stu-id="d5825-185">Controlling Connection Pooling with Connection String Keywords</span></span>  
 <span data-ttu-id="d5825-186">`ConnectionString` Właściwość <xref:System.Data.SqlClient.SqlConnection> obiekt obsługuje pary klucz wartość ciągu połączenia, które pozwalają dostosować zachowanie logiki buforowania połączeń.</span><span class="sxs-lookup"><span data-stu-id="d5825-186">The `ConnectionString` property of the <xref:System.Data.SqlClient.SqlConnection> object supports connection string key/value pairs that can be used to adjust the behavior of the connection pooling logic.</span></span> <span data-ttu-id="d5825-187">Aby uzyskać więcej informacji, zobacz <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span><span class="sxs-lookup"><span data-stu-id="d5825-187">For more information, see <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span></span>  
  
## <a name="pool-fragmentation"></a><span data-ttu-id="d5825-188">Fragmentacja puli</span><span class="sxs-lookup"><span data-stu-id="d5825-188">Pool Fragmentation</span></span>  
 <span data-ttu-id="d5825-189">Fragmentacja puli jest to powszechny problem w wiele aplikacji sieci Web, w której aplikacja może tworzyć wiele pul, które nie są zwalniane dopóki proces kończy się.</span><span class="sxs-lookup"><span data-stu-id="d5825-189">Pool fragmentation is a common problem in many Web applications where the application can create a large number of pools that are not freed until the process exits.</span></span> <span data-ttu-id="d5825-190">Duża liczba połączeń to pozostawia otwarty i spójniejsze pamięci, co prowadzi do niskiej wydajności.</span><span class="sxs-lookup"><span data-stu-id="d5825-190">This leaves a large number of connections open and consuming memory, which results in poor performance.</span></span>  
  
### <a name="pool-fragmentation-due-to-integrated-security"></a><span data-ttu-id="d5825-191">Fragmentacja puli z powodu zabezpieczeń zintegrowanych</span><span class="sxs-lookup"><span data-stu-id="d5825-191">Pool Fragmentation Due to Integrated Security</span></span>  
 <span data-ttu-id="d5825-192">Połączenia są grupowane w pulach zgodnie z parametrów połączenia i tożsamości użytkownika.</span><span class="sxs-lookup"><span data-stu-id="d5825-192">Connections are pooled according to the connection string plus the user identity.</span></span> <span data-ttu-id="d5825-193">W związku z tym użycie uwierzytelniania podstawowego lub uwierzytelniania systemu Windows w witrynie sieci Web i logowania zabezpieczeń zintegrowanych, Pobierz jedną pulę dla każdego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="d5825-193">Therefore, if you use Basic authentication or Windows Authentication on the Web site and an integrated security login, you get one pool per user.</span></span> <span data-ttu-id="d5825-194">Mimo że poprawia to wydajność żądań kolejnych bazy danych dla jednego użytkownika, ten użytkownik nie może korzystać z połączenia nawiązywane przez innych użytkowników.</span><span class="sxs-lookup"><span data-stu-id="d5825-194">Although this improves the performance of subsequent database requests for a single user, that user cannot take advantage of connections made by other users.</span></span> <span data-ttu-id="d5825-195">Powoduje ona również co najmniej jednego połączenia na użytkownika na serwerze bazy danych.</span><span class="sxs-lookup"><span data-stu-id="d5825-195">It also results in at least one connection per user to the database server.</span></span> <span data-ttu-id="d5825-196">To jest efektem ubocznym określonej architektury aplikacji sieci Web, który deweloperzy należy porównać przed inspekcji wymagania dotyczące zabezpieczeń i.</span><span class="sxs-lookup"><span data-stu-id="d5825-196">This is a side effect of a particular Web application architecture that developers must weigh against security and auditing requirements.</span></span>  
  
### <a name="pool-fragmentation-due-to-many-databases"></a><span data-ttu-id="d5825-197">Fragmentacja puli z powodu wielu baz danych</span><span class="sxs-lookup"><span data-stu-id="d5825-197">Pool Fragmentation Due to Many Databases</span></span>  
 <span data-ttu-id="d5825-198">Usługodawcy internetowi obsługiwać kilka witryn sieci Web na jednym serwerze.</span><span class="sxs-lookup"><span data-stu-id="d5825-198">Many Internet service providers host several Web sites on a single server.</span></span> <span data-ttu-id="d5825-199">Aby potwierdzić logowania uwierzytelniania formularzy, a następnie otworzyć połączenia z określoną bazą danych dla tego użytkownika lub grupy użytkowników mogą używać pojedynczej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="d5825-199">They may use a single database to confirm a Forms authentication login and then open a connection to a specific database for that user or group of users.</span></span> <span data-ttu-id="d5825-200">Połączenie z bazą danych uwierzytelniania jest buforowany i korzystanie z niej.</span><span class="sxs-lookup"><span data-stu-id="d5825-200">The connection to the authentication database is pooled and used by everyone.</span></span> <span data-ttu-id="d5825-201">Istnieje jednak oddzielne puli połączeń dla każdej bazy danych, które zwiększyć liczbę połączeń z serwerem.</span><span class="sxs-lookup"><span data-stu-id="d5825-201">However, there is a separate pool of connections to each database, which increase the number of connections to the server.</span></span>  
  
 <span data-ttu-id="d5825-202">Dotyczy to również efekt uboczny projektowania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="d5825-202">This is also a side-effect of the application design.</span></span> <span data-ttu-id="d5825-203">Istnieje stosunkowo proste sposób, aby uniknąć tego efektu ubocznego bez naruszania zabezpieczeń, gdy połączysz się [!INCLUDE[ssNoVersion](../../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="d5825-203">There is a relatively simple way to avoid this side effect without compromising security when you connect to [!INCLUDE[ssNoVersion](../../../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="d5825-204">Zamiast połączenie z oddzielnej bazy danych dla każdego użytkownika lub grupy, nawiązać połączenia z tej samej bazy danych na serwerze, a następnie wykonaj [!INCLUDE[tsql](../../../../includes/tsql-md.md)] użycie instrukcji, aby zmienić żądanej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="d5825-204">Instead of connecting to a separate database for each user or group, connect to the same database on the server and then execute the [!INCLUDE[tsql](../../../../includes/tsql-md.md)] USE statement to change to the desired database.</span></span> <span data-ttu-id="d5825-205">Poniższy fragment kodu pokazano tworzenie początkowego połączenia `master` bazy danych, a następnie przechodząc do żądanej bazy danych określonej w `databaseName` zmiennej ciągu.</span><span class="sxs-lookup"><span data-stu-id="d5825-205">The following code fragment demonstrates creating an initial connection to the `master` database and then switching to the desired database specified in the `databaseName` string variable.</span></span>  
  
```vb  
' Assumes that command is a valid SqlCommand object and that  
' connectionString connects to master.  
    command.Text = "USE DatabaseName"  
Using connection As New SqlConnection(connectionString)  
    connection.Open()  
    command.ExecuteNonQuery()  
End Using  
```  
  
```csharp  
// Assumes that command is a SqlCommand object and that  
// connectionString connects to master.  
command.Text = "USE DatabaseName";  
using (SqlConnection connection = new SqlConnection(  
  connectionString))  
  {  
    connection.Open();  
    command.ExecuteNonQuery();  
  }  
```  
  
## <a name="application-roles-and-connection-pooling"></a><span data-ttu-id="d5825-206">Role aplikacji i użycia puli połączeń</span><span class="sxs-lookup"><span data-stu-id="d5825-206">Application Roles and Connection Pooling</span></span>  
 <span data-ttu-id="d5825-207">Po [!INCLUDE[ssNoVersion](../../../../includes/ssnoversion-md.md)] roli aplikacji został aktywowany przez wywołanie metody `sp_setapprole` procedury składowanej systemu, nie można zresetować to połączenie w kontekście zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="d5825-207">After a [!INCLUDE[ssNoVersion](../../../../includes/ssnoversion-md.md)] application role has been activated by calling the `sp_setapprole` system stored procedure, the security context of that connection cannot be reset.</span></span> <span data-ttu-id="d5825-208">Jednak jeśli buforowanie jest włączone, połączenie jest zwracana do puli, a błąd występuje, gdy zostanie ponownie użyty puli połączeń.</span><span class="sxs-lookup"><span data-stu-id="d5825-208">However, if pooling is enabled, the connection is returned to the pool, and an error occurs when the pooled connection is reused.</span></span> <span data-ttu-id="d5825-209">Aby uzyskać więcej informacji, zobacz artykuł bazy wiedzy, "[błędów roli aplikacji SQL z puli zasobów OLE DB](http://support.microsoft.com/default.aspx?scid=KB;EN-US;Q229564)."</span><span class="sxs-lookup"><span data-stu-id="d5825-209">For more information, see the Knowledge Base article, "[SQL application role errors with OLE DB resource pooling](http://support.microsoft.com/default.aspx?scid=KB;EN-US;Q229564)."</span></span>  
  
### <a name="application-role-alternatives"></a><span data-ttu-id="d5825-210">Alternatywy roli aplikacji</span><span class="sxs-lookup"><span data-stu-id="d5825-210">Application Role Alternatives</span></span>  
 <span data-ttu-id="d5825-211">Zaleca się, że możesz korzystać z mechanizmów zabezpieczeń korzystających zamiast ról aplikacji.</span><span class="sxs-lookup"><span data-stu-id="d5825-211">We recommend that you take advantage of security mechanisms that you can use instead of application roles.</span></span> <span data-ttu-id="d5825-212">Aby uzyskać więcej informacji, zobacz [tworzenia ról aplikacji w programie SQL Server](../../../../docs/framework/data/adonet/sql/creating-application-roles-in-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="d5825-212">For more information, see [Creating Application Roles in SQL Server](../../../../docs/framework/data/adonet/sql/creating-application-roles-in-sql-server.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d5825-213">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="d5825-213">See Also</span></span>  
 [<span data-ttu-id="d5825-214">Pula połączeń</span><span class="sxs-lookup"><span data-stu-id="d5825-214">Connection Pooling</span></span>](../../../../docs/framework/data/adonet/connection-pooling.md)  
 [<span data-ttu-id="d5825-215">SQL Server i ADO.NET</span><span class="sxs-lookup"><span data-stu-id="d5825-215">SQL Server and ADO.NET</span></span>](../../../../docs/framework/data/adonet/sql/index.md)  
 [<span data-ttu-id="d5825-216">Liczniki wydajności</span><span class="sxs-lookup"><span data-stu-id="d5825-216">Performance Counters</span></span>](../../../../docs/framework/data/adonet/performance-counters.md)  
 [<span data-ttu-id="d5825-217">ADO.NET zarządzanego dostawcy i zestawu danych w Centrum deweloperów</span><span class="sxs-lookup"><span data-stu-id="d5825-217">ADO.NET Managed Providers and DataSet Developer Center</span></span>](http://go.microsoft.com/fwlink/?LinkId=217917)
