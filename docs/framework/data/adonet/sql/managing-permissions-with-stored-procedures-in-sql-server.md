---
title: Zarządzanie uprawnieniami za pomocą procedur składowanych w programie SQL Server
description: Dowiedz się, jak ograniczyć dostęp do obiektów danych i baz danych, implementując dostęp za pomocą procedur składowanych lub funkcji zdefiniowanych przez użytkownika.
ms.date: 03/30/2017
ms.assetid: 08fa34e8-2ffa-470d-ba62-e511a5f8558e
ms.openlocfilehash: 890c1c6dd7003f3abd684d6c827b6a77a3a019c1
ms.sourcegitcommit: 33deec3e814238fb18a49b2a7e89278e27888291
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 06/02/2020
ms.locfileid: "84286291"
---
# <a name="managing-permissions-with-stored-procedures-in-sql-server"></a><span data-ttu-id="86a60-103">Zarządzanie uprawnieniami za pomocą procedur składowanych w programie SQL Server</span><span class="sxs-lookup"><span data-stu-id="86a60-103">Managing Permissions with Stored Procedures in SQL Server</span></span>
<span data-ttu-id="86a60-104">Jedną z metod tworzenia wielu wierszy obrony bazy danych jest zaimplementowanie całego dostępu do danych za pomocą procedur składowanych lub funkcji zdefiniowanych przez użytkownika.</span><span class="sxs-lookup"><span data-stu-id="86a60-104">One method of creating multiple lines of defense around your database is to implement all data access using stored procedures or user-defined functions.</span></span> <span data-ttu-id="86a60-105">Wszystkie uprawnienia do obiektów bazowych, takie jak tabele, są odwoływane lub odrzucane.</span><span class="sxs-lookup"><span data-stu-id="86a60-105">You revoke or deny all permissions to underlying objects, such as tables, and grant EXECUTE permissions on stored procedures.</span></span> <span data-ttu-id="86a60-106">Dzięki temu powstaje obwód zabezpieczeń wokół obiektów danych i baz danych.</span><span class="sxs-lookup"><span data-stu-id="86a60-106">This effectively creates a security perimeter around your data and database objects.</span></span>  
  
## <a name="stored-procedure-benefits"></a><span data-ttu-id="86a60-107">Korzyści z procedury składowanej</span><span class="sxs-lookup"><span data-stu-id="86a60-107">Stored Procedure Benefits</span></span>  
 <span data-ttu-id="86a60-108">Procedury składowane mają następujące zalety:</span><span class="sxs-lookup"><span data-stu-id="86a60-108">Stored procedures have the following benefits:</span></span>  
  
- <span data-ttu-id="86a60-109">Reguły logiki danych i biznesowe mogą być hermetyzowane, dzięki czemu użytkownicy mogą uzyskiwać dostęp do danych i obiektów tylko w taki sposób, że deweloperzy i administratorzy baz danych mają.</span><span class="sxs-lookup"><span data-stu-id="86a60-109">Data logic and business rules can be encapsulated so that users can access data and objects only in ways that developers and database administrators intend.</span></span>  
  
- <span data-ttu-id="86a60-110">Sparametryzowane procedury składowane, które sprawdzają, czy wszystkie dane wejściowe użytkownika mogą być używane do zapamiętania ataków iniekcji SQL.</span><span class="sxs-lookup"><span data-stu-id="86a60-110">Parameterized stored procedures that validate all user input can be used to thwart SQL injection attacks.</span></span> <span data-ttu-id="86a60-111">Jeśli używasz dynamicznego języka SQL, pamiętaj, aby Sparametryzuj polecenia, i nigdy nie dodawaj wartości parametrów bezpośrednio do ciągu zapytania.</span><span class="sxs-lookup"><span data-stu-id="86a60-111">If you use dynamic SQL, be sure to parameterize your commands, and never include parameter values directly into a query string.</span></span>  
  
- <span data-ttu-id="86a60-112">Zapytania ad hoc i modyfikacje danych mogą być niedozwolone.</span><span class="sxs-lookup"><span data-stu-id="86a60-112">Ad hoc queries and data modifications can be disallowed.</span></span> <span data-ttu-id="86a60-113">Zapobiega to złośliwemu lub przypadkowemu zniszczeniu danych lub wykonywaniu zapytań, które ograniczają wydajność na serwerze lub w sieci.</span><span class="sxs-lookup"><span data-stu-id="86a60-113">This prevents users from maliciously or inadvertently destroying data or executing queries that impair performance on the server or the network.</span></span>  
  
- <span data-ttu-id="86a60-114">Błędy mogą być obsługiwane w kodzie procedury bez przekazywania ich bezpośrednio do aplikacji klienckich.</span><span class="sxs-lookup"><span data-stu-id="86a60-114">Errors can be handled in procedure code without being passed directly to client applications.</span></span> <span data-ttu-id="86a60-115">Zapobiega to zwracaniu komunikatów o błędach, które mogą pomóc w ataku typu badanie.</span><span class="sxs-lookup"><span data-stu-id="86a60-115">This prevents error messages from being returned that could aid in a probing attack.</span></span> <span data-ttu-id="86a60-116">Rejestruj błędy i obsługuj je na serwerze.</span><span class="sxs-lookup"><span data-stu-id="86a60-116">Log errors and handle them on the server.</span></span>  
  
- <span data-ttu-id="86a60-117">Procedury składowane można napisać raz i uzyskać do nich dostęp przez wiele aplikacji.</span><span class="sxs-lookup"><span data-stu-id="86a60-117">Stored procedures can be written once, and accessed by many applications.</span></span>  
  
- <span data-ttu-id="86a60-118">Aplikacje klienckie nie muszą wiedzieć niczego o podstawowych strukturach danych.</span><span class="sxs-lookup"><span data-stu-id="86a60-118">Client applications do not need to know anything about the underlying data structures.</span></span> <span data-ttu-id="86a60-119">Kod procedury składowanej można zmienić bez konieczności wprowadzania zmian w aplikacjach klienckich, o ile zmiany nie wpływają na listy parametrów lub zwracane typy danych.</span><span class="sxs-lookup"><span data-stu-id="86a60-119">Stored procedure code can be changed without requiring changes in client applications as long as the changes do not affect parameter lists or returned data types.</span></span>  
  
- <span data-ttu-id="86a60-120">Procedury składowane mogą zmniejszyć ruch sieciowy przez połączenie wielu operacji w jedno wywołanie procedury.</span><span class="sxs-lookup"><span data-stu-id="86a60-120">Stored procedures can reduce network traffic by combining multiple operations into one procedure call.</span></span>  
  
## <a name="stored-procedure-execution"></a><span data-ttu-id="86a60-121">Wykonywanie procedury składowanej</span><span class="sxs-lookup"><span data-stu-id="86a60-121">Stored Procedure Execution</span></span>  
 <span data-ttu-id="86a60-122">Procedury składowane wykorzystują tworzenie łańcucha własności, aby zapewnić dostęp do danych, dzięki czemu użytkownicy nie muszą mieć jawnego uprawnienia dostępu do obiektów bazy danych.</span><span class="sxs-lookup"><span data-stu-id="86a60-122">Stored procedures take advantage of ownership chaining to provide access to data so that users do not need to have explicit permission to access database objects.</span></span> <span data-ttu-id="86a60-123">Łańcuch własności istnieje, gdy obiekty, które uzyskują dostęp do siebie nawzajem, są własnością tego samego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="86a60-123">An ownership chain exists when objects that access each other sequentially are owned by the same user.</span></span> <span data-ttu-id="86a60-124">Na przykład procedura składowana może wywołać inne procedury składowane lub procedura składowana może uzyskać dostęp do wielu tabel.</span><span class="sxs-lookup"><span data-stu-id="86a60-124">For example, a stored procedure can call other stored procedures, or a stored procedure can access multiple tables.</span></span> <span data-ttu-id="86a60-125">Jeśli wszystkie obiekty w łańcuchu wykonywania mają tego samego właściciela, SQL Server sprawdza tylko uprawnienie EXECUTE dla obiektu wywołującego, a nie uprawnienia obiektu wywołującego na innych obiektach.</span><span class="sxs-lookup"><span data-stu-id="86a60-125">If all objects in the chain of execution have the same owner, then SQL Server only checks the EXECUTE permission for the caller, not the caller's permissions on other objects.</span></span> <span data-ttu-id="86a60-126">W związku z tym należy przyznać tylko uprawnienia do wykonywania w procedurach składowanych; Możesz odwołać lub odrzucić wszystkie uprawnienia do tabel źródłowych.</span><span class="sxs-lookup"><span data-stu-id="86a60-126">Therefore you need to grant only EXECUTE permissions on stored procedures; you can revoke or deny all permissions on the underlying tables.</span></span>  
  
## <a name="best-practices"></a><span data-ttu-id="86a60-127">Najlepsze rozwiązania</span><span class="sxs-lookup"><span data-stu-id="86a60-127">Best Practices</span></span>  
 <span data-ttu-id="86a60-128">Zwykłe pisanie procedur składowanych jest niewystarczające, aby odpowiednio zabezpieczyć aplikację.</span><span class="sxs-lookup"><span data-stu-id="86a60-128">Simply writing stored procedures isn't enough to adequately secure your application.</span></span> <span data-ttu-id="86a60-129">Należy również wziąć pod uwagę następujące potencjalne luki w zabezpieczeniach.</span><span class="sxs-lookup"><span data-stu-id="86a60-129">You should also consider the following potential security holes.</span></span>  
  
- <span data-ttu-id="86a60-130">Przyznaj uprawnienia do wykonywania w procedurach składowanych dla ról bazy danych, które mają mieć możliwość uzyskiwania dostępu do danych.</span><span class="sxs-lookup"><span data-stu-id="86a60-130">Grant EXECUTE permissions on the stored procedures for database roles you want to be able to access the data.</span></span>  
  
- <span data-ttu-id="86a60-131">Odwołaj lub Odmów wszystkich uprawnień do odpowiednich tabel dla wszystkich ról i użytkowników w bazie danych, w tym `public` roli.</span><span class="sxs-lookup"><span data-stu-id="86a60-131">Revoke or deny all permissions to the underlying tables for all roles and users in the database, including the `public` role.</span></span> <span data-ttu-id="86a60-132">Wszyscy użytkownicy dziedziczą uprawnienia od publicznego.</span><span class="sxs-lookup"><span data-stu-id="86a60-132">All users inherit permissions from public.</span></span> <span data-ttu-id="86a60-133">W związku z tym odmowa uprawnień `public` oznacza, że tylko właściciele i `sysadmin` członkowie mają dostęp; wszyscy inni użytkownicy nie będą mogli odziedziczyć uprawnień z członkostwa w innych rolach.</span><span class="sxs-lookup"><span data-stu-id="86a60-133">Therefore denying permissions to `public` means that only owners and `sysadmin` members have access; all other users will be unable to inherit permissions from membership in other roles.</span></span>  
  
- <span data-ttu-id="86a60-134">Nie należy dodawać użytkowników ani ról do `sysadmin` ról lub `db_owner` .</span><span class="sxs-lookup"><span data-stu-id="86a60-134">Do not add users or roles to the `sysadmin` or `db_owner` roles.</span></span> <span data-ttu-id="86a60-135">Administratorzy systemu i właściciele baz danych mogą uzyskać dostęp do wszystkich obiektów bazy danych.</span><span class="sxs-lookup"><span data-stu-id="86a60-135">System administrators and database owners can access all database objects.</span></span>  
  
- <span data-ttu-id="86a60-136">Wyłącz `guest` konto.</span><span class="sxs-lookup"><span data-stu-id="86a60-136">Disable the `guest` account.</span></span> <span data-ttu-id="86a60-137">Uniemożliwi to anonimowym użytkownikom łączenie się z bazą danych.</span><span class="sxs-lookup"><span data-stu-id="86a60-137">This will prevent anonymous users from connecting to the database.</span></span> <span data-ttu-id="86a60-138">Konto gościa jest domyślnie wyłączone w nowych bazach danych.</span><span class="sxs-lookup"><span data-stu-id="86a60-138">The guest account is disabled by default in new databases.</span></span>  
  
- <span data-ttu-id="86a60-139">Zaimplementuj obsługę błędów i Rejestruj błędy.</span><span class="sxs-lookup"><span data-stu-id="86a60-139">Implement error handling and log errors.</span></span>  
  
- <span data-ttu-id="86a60-140">Utwórz sparametryzowane procedury składowane, które weryfikują wszystkie dane wejściowe użytkownika.</span><span class="sxs-lookup"><span data-stu-id="86a60-140">Create parameterized stored procedures that validate all user input.</span></span> <span data-ttu-id="86a60-141">Traktuj wszystkie dane wprowadzane przez użytkownika jako niezaufane.</span><span class="sxs-lookup"><span data-stu-id="86a60-141">Treat all user input as untrusted.</span></span>  
  
- <span data-ttu-id="86a60-142">Unikaj dynamicznego SQL, chyba że jest to absolutnie konieczne.</span><span class="sxs-lookup"><span data-stu-id="86a60-142">Avoid dynamic SQL unless absolutely necessary.</span></span> <span data-ttu-id="86a60-143">Funkcja cudzysłowu Transact-SQL Quote () służy do ograniczania wartości ciągu i ucieczki dowolnego wystąpienia ogranicznika w ciągu wejściowym.</span><span class="sxs-lookup"><span data-stu-id="86a60-143">Use the Transact-SQL QUOTENAME() function to delimit a string value and escape any occurrence of the delimiter in the input string.</span></span>  
  
## <a name="external-resources"></a><span data-ttu-id="86a60-144">Zasoby zewnętrzne</span><span class="sxs-lookup"><span data-stu-id="86a60-144">External Resources</span></span>  
 <span data-ttu-id="86a60-145">Więcej informacji zawierają poniższe zasoby.</span><span class="sxs-lookup"><span data-stu-id="86a60-145">For more information, see the following resources.</span></span>  
  
|<span data-ttu-id="86a60-146">Zasób</span><span class="sxs-lookup"><span data-stu-id="86a60-146">Resource</span></span>|<span data-ttu-id="86a60-147">Opis</span><span class="sxs-lookup"><span data-stu-id="86a60-147">Description</span></span>|  
|--------------|-----------------|  
|<span data-ttu-id="86a60-148">[Procedury składowane](/sql/relational-databases/stored-procedures/stored-procedures-database-engine) i [iniekcja kodu SQL](/sql/relational-databases/security/sql-injection)</span><span class="sxs-lookup"><span data-stu-id="86a60-148">[Stored Procedures](/sql/relational-databases/stored-procedures/stored-procedures-database-engine) and [SQL Injection](/sql/relational-databases/security/sql-injection)</span></span>|<span data-ttu-id="86a60-149">Artykuły opisują sposób tworzenia procedur składowanych i sposobu działania iniekcji języka SQL.</span><span class="sxs-lookup"><span data-stu-id="86a60-149">Articles describe how to create stored procedures and how SQL Injection works.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="86a60-150">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="86a60-150">See also</span></span>

- [<span data-ttu-id="86a60-151">Zabezpieczanie aplikacji ADO.NET</span><span class="sxs-lookup"><span data-stu-id="86a60-151">Securing ADO.NET Applications</span></span>](../securing-ado-net-applications.md)
- [<span data-ttu-id="86a60-152">Przegląd zabezpieczeń serwera SQL</span><span class="sxs-lookup"><span data-stu-id="86a60-152">Overview of SQL Server Security</span></span>](overview-of-sql-server-security.md)
- [<span data-ttu-id="86a60-153">Scenariusze zabezpieczeń aplikacji w programie SQL Server</span><span class="sxs-lookup"><span data-stu-id="86a60-153">Application Security Scenarios in SQL Server</span></span>](application-security-scenarios-in-sql-server.md)
- [<span data-ttu-id="86a60-154">Pisanie bezpiecznego dynamicznego kodu SQL w programie SQL Server</span><span class="sxs-lookup"><span data-stu-id="86a60-154">Writing Secure Dynamic SQL in SQL Server</span></span>](writing-secure-dynamic-sql-in-sql-server.md)
- [<span data-ttu-id="86a60-155">Rejestrowanie procedur składowanych w programie SQL Server</span><span class="sxs-lookup"><span data-stu-id="86a60-155">Signing Stored Procedures in SQL Server</span></span>](signing-stored-procedures-in-sql-server.md)
- [<span data-ttu-id="86a60-156">Dostosowywanie uprawnień personifikacji w programie SQL Server</span><span class="sxs-lookup"><span data-stu-id="86a60-156">Customizing Permissions with Impersonation in SQL Server</span></span>](customizing-permissions-with-impersonation-in-sql-server.md)
- [<span data-ttu-id="86a60-157">Modyfikowanie danych za pomocą procedur składowanych</span><span class="sxs-lookup"><span data-stu-id="86a60-157">Modifying Data with Stored Procedures</span></span>](../modifying-data-with-stored-procedures.md)
- [<span data-ttu-id="86a60-158">Omówienie ADO.NET</span><span class="sxs-lookup"><span data-stu-id="86a60-158">ADO.NET Overview</span></span>](../ado-net-overview.md)
