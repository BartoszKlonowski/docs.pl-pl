---
title: Dostosowywanie uprawnieniami personifikacja w programie SQL Server
ms.date: 03/30/2017
ms.assetid: dc733d09-1d6d-4af0-9c4b-8d24504860f1
ms.openlocfilehash: ac2c6805a9ab49d95f68e56306d7d9fb8aab2a2c
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 05/04/2018
---
# <a name="customizing-permissions-with-impersonation-in-sql-server"></a><span data-ttu-id="c9929-102">Dostosowywanie uprawnieniami personifikacja w programie SQL Server</span><span class="sxs-lookup"><span data-stu-id="c9929-102">Customizing Permissions with Impersonation in SQL Server</span></span>
<span data-ttu-id="c9929-103">Wiele aplikacji korzysta procedur składowanych dostępu do danych polegania na własność łańcucha, aby ograniczyć dostęp do tabel podstawowych.</span><span class="sxs-lookup"><span data-stu-id="c9929-103">Many applications use stored procedures to access data, relying on ownership chaining to restrict access to base tables.</span></span> <span data-ttu-id="c9929-104">Można przyznać uprawnienia EXECUTE procedur składowanych, odwoływanie lub nie zezwalających na uprawnienia do tabel podstawowych.</span><span class="sxs-lookup"><span data-stu-id="c9929-104">You can grant EXECUTE permissions on stored procedures, revoking or denying permissions on the base tables.</span></span> <span data-ttu-id="c9929-105">SQL Server nie sprawdza uprawnienia obiektu wywołującego, jeśli procedura składowana i tabele mieć tego samego właściciela.</span><span class="sxs-lookup"><span data-stu-id="c9929-105">SQL Server does not check the permissions of the caller if the stored procedure and tables have the same owner.</span></span> <span data-ttu-id="c9929-106">Jednak łańcucha własności nie działa obiektów mieć różnych właścicieli lub w przypadku dynamicznego SQL.</span><span class="sxs-lookup"><span data-stu-id="c9929-106">However, ownership chaining doesn't work if objects have different owners or in the case of dynamic SQL.</span></span>  
  
 <span data-ttu-id="c9929-107">EXECUTE AS można użyć klauzuli w procedurze składowanej, gdy obiekt wywołujący nie ma uprawnień do obiektów bazy danych.</span><span class="sxs-lookup"><span data-stu-id="c9929-107">You can use the EXECUTE AS clause in a stored procedure when the caller doesn't have permissions on the referenced database objects.</span></span> <span data-ttu-id="c9929-108">Efekt EXECUTE AS klauzula jest, że przełączania kontekstu wykonywania dla użytkownika serwera proxy.</span><span class="sxs-lookup"><span data-stu-id="c9929-108">The effect of the EXECUTE AS clause is that the execution context is switched to the proxy user.</span></span> <span data-ttu-id="c9929-109">Cały kod, a także wszystkie wywołania zagnieżdżonych procedur składowanych lub wyzwalaczy, jest wykonywany w kontekście zabezpieczeń użytkownika serwera proxy.</span><span class="sxs-lookup"><span data-stu-id="c9929-109">All code, as well as any calls to nested stored procedures or triggers, executes under the security context of the proxy user.</span></span> <span data-ttu-id="c9929-110">Kontekst wykonywania zostanie przywrócony do oryginalnego obiektu wywołującego tylko po wykonaniu procedury lub po wygenerowaniu instrukcji REVERT.</span><span class="sxs-lookup"><span data-stu-id="c9929-110">Execution context is reverted to the original caller only after execution of the procedure or when a REVERT statement is issued.</span></span>  
  
## <a name="context-switching-with-the-execute-as-statement"></a><span data-ttu-id="c9929-111">Kontekst przełączenie EXECUTE AS — instrukcja</span><span class="sxs-lookup"><span data-stu-id="c9929-111">Context Switching with the EXECUTE AS Statement</span></span>  
 <span data-ttu-id="c9929-112">Języka Transact-SQL AS wykonania instrukcji umożliwia przełączanie kontekstu wykonywania instrukcji przez personifikowanie innego użytkownika logowania lub bazy danych.</span><span class="sxs-lookup"><span data-stu-id="c9929-112">The Transact-SQL EXECUTE AS statement allows you to switch the execution context of a statement by impersonating another login or database user.</span></span> <span data-ttu-id="c9929-113">Jest to przydatne technika testowanie zapytań i procedur jako inny użytkownik.</span><span class="sxs-lookup"><span data-stu-id="c9929-113">This is a useful technique for testing queries and procedures as another user.</span></span>  
  
```  
EXECUTE AS LOGIN = 'loginName';  
EXECUTE AS USER = 'userName';  
```  
  
 <span data-ttu-id="c9929-114">Musi mieć uprawnienia IMPERSONATE logowania lub użytkownika, które są personifikacji.</span><span class="sxs-lookup"><span data-stu-id="c9929-114">You must have IMPERSONATE permissions on the login or user you are impersonating.</span></span> <span data-ttu-id="c9929-115">To uprawnienie jest domniemane dla `sysadmin` dla wszystkich baz danych, i `db_owner` członków roli w bazach danych, które są właścicielami.</span><span class="sxs-lookup"><span data-stu-id="c9929-115">This permission is implied for `sysadmin` for all databases, and `db_owner` role members in databases that they own.</span></span>  
  
## <a name="granting-permissions-with-the-execute-as-clause"></a><span data-ttu-id="c9929-116">Udzielanie uprawnień z EXECUTE AS — klauzula</span><span class="sxs-lookup"><span data-stu-id="c9929-116">Granting Permissions with the EXECUTE AS Clause</span></span>  
 <span data-ttu-id="c9929-117">EXECUTE AS można użyć klauzuli w nagłówku definicji procedury przechowywanej, wyzwalacza lub funkcji zdefiniowanej przez użytkownika (z wyjątkiem funkcji śródwierszowych przechowywanymi w tabeli).</span><span class="sxs-lookup"><span data-stu-id="c9929-117">You can use the EXECUTE AS clause in the definition header of a stored procedure, trigger, or user-defined function (except for inline table-valued functions).</span></span> <span data-ttu-id="c9929-118">Powoduje to procedurę można wykonać w kontekście nazwa użytkownika lub słowa kluczowego, określonego w EXECUTE AS klauzuli.</span><span class="sxs-lookup"><span data-stu-id="c9929-118">This causes the procedure to execute in the context of the user name or keyword specified in the EXECUTE AS clause.</span></span> <span data-ttu-id="c9929-119">Utwórz użytkownika serwera proxy w bazie danych, która nie jest zamapowany na nazwę logowania udzielanie go tylko wymagane uprawnienia na obiekty używane przez procedurę.</span><span class="sxs-lookup"><span data-stu-id="c9929-119">You can create a proxy user in the database that is not mapped to a login, granting it only the necessary permissions on the objects accessed by the procedure.</span></span> <span data-ttu-id="c9929-120">Dostęp do wszystkich obiektów tylko użytkownika serwera proxy, określony w poleceniu EXECUTE jako klauzuli musi mieć uprawnienia przez moduł.</span><span class="sxs-lookup"><span data-stu-id="c9929-120">Only the proxy user specified in the EXECUTE AS clause must have permissions on all objects accessed by the module.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="c9929-121">Niektóre akcje, takie jak TRUNCATE TABLE nie masz uprawnień możliwy.</span><span class="sxs-lookup"><span data-stu-id="c9929-121">Some actions, such as TRUNCATE TABLE, do not have grantable permissions.</span></span> <span data-ttu-id="c9929-122">Dołączanie instrukcji w procedurze i określając użytkownika serwera proxy, który ma uprawnienia ALTER TABLE, można rozszerzyć uprawnienia do obcięcia tabeli dla kodu wywołującego, którzy mają tylko uprawnienia EXECUTE w procedurze.</span><span class="sxs-lookup"><span data-stu-id="c9929-122">By incorporating the statement within a procedure and specifying a proxy user who has ALTER TABLE permissions, you can extend the permissions to truncate the table to callers who have only EXECUTE permissions on the procedure.</span></span>  
  
 <span data-ttu-id="c9929-123">Kontekst określony w poleceniu EXECUTE jako klauzula jest ważny przez czas trwania procedury, w tym zagnieżdżonych procedury i wyzwalaczy.</span><span class="sxs-lookup"><span data-stu-id="c9929-123">The context specified in the EXECUTE AS clause is valid for the duration of the procedure, including nested procedures and triggers.</span></span> <span data-ttu-id="c9929-124">Kontekst wraca do wywołującego po zakończeniu wykonywania lub wystawienia instrukcji REVERT.</span><span class="sxs-lookup"><span data-stu-id="c9929-124">Context reverts to the caller when execution is complete or the REVERT statement is issued.</span></span>  
  
 <span data-ttu-id="c9929-125">Istnieją trzy kroki związane ze stosowaniem EXECUTE AS klauzuli w procedurze.</span><span class="sxs-lookup"><span data-stu-id="c9929-125">There are three steps involved in using the EXECUTE AS clause in a procedure.</span></span>  
  
1.  <span data-ttu-id="c9929-126">Utwórz użytkownika serwera proxy w bazie danych, który nie jest zamapowany na nazwę logowania.</span><span class="sxs-lookup"><span data-stu-id="c9929-126">Create a proxy user in the database that is not mapped to a login.</span></span> <span data-ttu-id="c9929-127">Nie jest to wymagane, ale pomaga podczas zarządzania uprawnieniami.</span><span class="sxs-lookup"><span data-stu-id="c9929-127">This is not required, but it helps when managing permissions.</span></span>  
  
```  
CREATE USER proxyUser WITHOUT LOGIN  
```  
  
1.  <span data-ttu-id="c9929-128">Przyznaj uprawnienia użytkownika serwera proxy.</span><span class="sxs-lookup"><span data-stu-id="c9929-128">Grant the proxy user the necessary permissions.</span></span>  
  
2.  <span data-ttu-id="c9929-129">Dodaj EXECUTE AS klauzuli do procedury składowanej lub funkcji zdefiniowanej przez użytkownika.</span><span class="sxs-lookup"><span data-stu-id="c9929-129">Add the EXECUTE AS clause to the stored procedure or user-defined function.</span></span>  
  
```  
CREATE PROCEDURE [procName] WITH EXECUTE AS 'proxyUser' AS ...  
```  
  
> [!NOTE]
>  <span data-ttu-id="c9929-130">Aplikacje, które wymagają inspekcji mogą być dzielone, ponieważ nie jest zachowywana oryginalna kontekstu zabezpieczeń wywołującego.</span><span class="sxs-lookup"><span data-stu-id="c9929-130">Applications that require auditing can break because the original security context of the caller is not retained.</span></span> <span data-ttu-id="c9929-131">Wbudowane funkcje, które zwracają tożsamości bieżącego użytkownika, takie jak SESSION_USER, użytkownika lub nazwa_użytkownika, zwraca użytkownika skojarzonego z EXECUTE AS klauzuli, nie oryginalny obiekt wywołujący.</span><span class="sxs-lookup"><span data-stu-id="c9929-131">Built-in functions that return the identity of the current user, such as SESSION_USER, USER, or USER_NAME, return the user associated with the EXECUTE AS clause, not the original caller.</span></span>  
  
### <a name="using-execute-as-with-revert"></a><span data-ttu-id="c9929-132">Używanie EXECUTE AS z przywracania</span><span class="sxs-lookup"><span data-stu-id="c9929-132">Using EXECUTE AS with REVERT</span></span>  
 <span data-ttu-id="c9929-133">Instrukcji języka Transact-SQL PRZYWRÓCIĆ umożliwia przywrócenie oryginalnego kontekstu wykonywania.</span><span class="sxs-lookup"><span data-stu-id="c9929-133">You can use the Transact-SQL REVERT statement to revert to the original execution context.</span></span>  
  
 <span data-ttu-id="c9929-134">Opcjonalna klauzula, z nie PRZYWRÓCENIE pliku COOKIE = @variableName, umożliwia przełączenie kontekstu wykonywania powrotem do wywołującego, jeśli @variableName zmienna zawiera poprawną wartość.</span><span class="sxs-lookup"><span data-stu-id="c9929-134">The optional clause, WITH NO REVERT COOKIE = @variableName, allows you switch the execution context back to the caller if the @variableName variable contains the correct value.</span></span> <span data-ttu-id="c9929-135">Dzięki temu można przełączyć się do obiektu wywołującego w środowiskach, w którym jest używane buforowanie połączenia kontekstu wykonywania.</span><span class="sxs-lookup"><span data-stu-id="c9929-135">This allows you to switch the execution context back to the caller in environments where connection pooling is used.</span></span> <span data-ttu-id="c9929-136">Ponieważ wartość @variableName jest znany tylko do wywołującego EXECUTE AS instrukcji, wywołujący może zagwarantować, że nie można zmienić kontekstu wykonywania przez użytkownika końcowego, który wywołuje aplikację.</span><span class="sxs-lookup"><span data-stu-id="c9929-136">Because the value of @variableName is known only to the caller of the EXECUTE AS statement, the caller can guarantee that the execution context cannot be changed by the end user that invokes the application.</span></span> <span data-ttu-id="c9929-137">Gdy połączenie jest zamknięte, jest zwracana do puli.</span><span class="sxs-lookup"><span data-stu-id="c9929-137">When the connection is closed, it is returned to the pool.</span></span> <span data-ttu-id="c9929-138">Aby uzyskać więcej informacji na temat połączenia buforowanie w ADO.NET, zobacz [programu SQL Server połączenia buforowanie (ADO.NET)](../../../../../docs/framework/data/adonet/sql-server-connection-pooling.md).</span><span class="sxs-lookup"><span data-stu-id="c9929-138">For more information on connection pooling in ADO.NET, see [SQL Server Connection Pooling (ADO.NET)](../../../../../docs/framework/data/adonet/sql-server-connection-pooling.md).</span></span>  
  
### <a name="specifying-the-execution-context"></a><span data-ttu-id="c9929-139">Określanie kontekstu wykonywania</span><span class="sxs-lookup"><span data-stu-id="c9929-139">Specifying the Execution Context</span></span>  
 <span data-ttu-id="c9929-140">Oprócz określenia użytkownika, można również używać EXECUTE AS z żadnego z następujących słów kluczowych.</span><span class="sxs-lookup"><span data-stu-id="c9929-140">In addition to specifying a user, you can also use EXECUTE AS with any of the following keywords.</span></span>  
  
-   <span data-ttu-id="c9929-141">OBIEKT WYWOŁUJĄCY.</span><span class="sxs-lookup"><span data-stu-id="c9929-141">CALLER.</span></span> <span data-ttu-id="c9929-142">Wykonywanie jako obiekt WYWOŁUJĄCY jest domyślnie; Jeśli zostanie określona żadna inna opcja, następnie procedura jest wykonywana w kontekście zabezpieczeń obiektu wywołującego.</span><span class="sxs-lookup"><span data-stu-id="c9929-142">Executing as CALLER is the default; if no other option is specified, then the procedure executes in the security context of the caller.</span></span>  
  
-   <span data-ttu-id="c9929-143">WŁAŚCICIEL.</span><span class="sxs-lookup"><span data-stu-id="c9929-143">OWNER.</span></span> <span data-ttu-id="c9929-144">W kontekście właściciela procedury wykonywania jako właściciela wykonuje procedurę.</span><span class="sxs-lookup"><span data-stu-id="c9929-144">Executing as OWNER executes the procedure in the context of the procedure owner.</span></span> <span data-ttu-id="c9929-145">Jeśli procedura jest tworzona w schemacie własnością `dbo` lub właściciela bazy danych z nieograniczonych uprawnień wykona procedurę.</span><span class="sxs-lookup"><span data-stu-id="c9929-145">If the procedure is created in a schema owned by `dbo` or the database owner, the procedure will execute with unrestricted permissions.</span></span>  
  
-   <span data-ttu-id="c9929-146">SELF.</span><span class="sxs-lookup"><span data-stu-id="c9929-146">SELF.</span></span> <span data-ttu-id="c9929-147">Wykonywanie jako SELF wykonywane w kontekście zabezpieczeń Twórcy procedury składowanej.</span><span class="sxs-lookup"><span data-stu-id="c9929-147">Executing as SELF executes in the security context of the creator of the stored procedure.</span></span> <span data-ttu-id="c9929-148">Jest to równoważne wykonywania jako dla określonego użytkownika, jeśli określony użytkownik jest osoba, utworzenie lub modyfikacja procedury.</span><span class="sxs-lookup"><span data-stu-id="c9929-148">This is equivalent to executing as a specified user, where the specified user is the person creating or altering the procedure.</span></span>  
  
## <a name="external-resources"></a><span data-ttu-id="c9929-149">Zasoby zewnętrzne</span><span class="sxs-lookup"><span data-stu-id="c9929-149">External Resources</span></span>  
 <span data-ttu-id="c9929-150">Aby uzyskać więcej informacji zobacz następujące zasoby.</span><span class="sxs-lookup"><span data-stu-id="c9929-150">For more information, see the following resources.</span></span>  
  
|<span data-ttu-id="c9929-151">Zasób</span><span class="sxs-lookup"><span data-stu-id="c9929-151">Resource</span></span>|<span data-ttu-id="c9929-152">Opis</span><span class="sxs-lookup"><span data-stu-id="c9929-152">Description</span></span>|  
|--------------|-----------------|  
|<span data-ttu-id="c9929-153">[Przełączanie kontekstu](http://msdn.microsoft.com/library/ms188268.aspx) w dokumentacji SQL Server Books Online</span><span class="sxs-lookup"><span data-stu-id="c9929-153">[Context Switching](http://msdn.microsoft.com/library/ms188268.aspx) in SQL Server Books Online</span></span>|<span data-ttu-id="c9929-154">Zawiera łącza do tematów opisujących sposób użycia EXECUTE AS klauzuli.</span><span class="sxs-lookup"><span data-stu-id="c9929-154">Contains links to topics describing how to use the EXECUTE AS clause.</span></span>|  
|<span data-ttu-id="c9929-155">[Tworzenie zestawów uprawnień niestandardowych za pomocą EXECUTE AS](http://msdn.microsoft.com/library/ms190384.aspx) i [przy użyciu EXECUTE AS w modułach](http://msdn.microsoft.com/library/ms178106.aspx) w dokumentacji SQL Server Books Online</span><span class="sxs-lookup"><span data-stu-id="c9929-155">[Using EXECUTE AS to Create Custom Permission Sets](http://msdn.microsoft.com/library/ms190384.aspx) and [Using EXECUTE AS in Modules](http://msdn.microsoft.com/library/ms178106.aspx) in SQL Server Books Online</span></span>|<span data-ttu-id="c9929-156">Tematy opisują sposób użycia EXECUTE AS klauzuli.</span><span class="sxs-lookup"><span data-stu-id="c9929-156">Topics describe how to use the EXECUTE AS clause.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="c9929-157">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="c9929-157">See Also</span></span>  
 [<span data-ttu-id="c9929-158">Zabezpieczanie aplikacji ADO.NET</span><span class="sxs-lookup"><span data-stu-id="c9929-158">Securing ADO.NET Applications</span></span>](../../../../../docs/framework/data/adonet/securing-ado-net-applications.md)  
 [<span data-ttu-id="c9929-159">Przegląd zabezpieczeń serwera SQL</span><span class="sxs-lookup"><span data-stu-id="c9929-159">Overview of SQL Server Security</span></span>](../../../../../docs/framework/data/adonet/sql/overview-of-sql-server-security.md)  
 [<span data-ttu-id="c9929-160">Scenariusze zabezpieczeń aplikacji w programie SQL Server</span><span class="sxs-lookup"><span data-stu-id="c9929-160">Application Security Scenarios in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/application-security-scenarios-in-sql-server.md)  
 [<span data-ttu-id="c9929-161">Zarządzanie uprawnieniami za pomocą procedur składowanych w programie SQL Server</span><span class="sxs-lookup"><span data-stu-id="c9929-161">Managing Permissions with Stored Procedures in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/managing-permissions-with-stored-procedures-in-sql-server.md)  
 [<span data-ttu-id="c9929-162">Pisanie bezpiecznego dynamicznego kodu SQL w programie SQL Server</span><span class="sxs-lookup"><span data-stu-id="c9929-162">Writing Secure Dynamic SQL in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/writing-secure-dynamic-sql-in-sql-server.md)  
 [<span data-ttu-id="c9929-163">Rejestrowanie procedur składowanych w programie SQL Server</span><span class="sxs-lookup"><span data-stu-id="c9929-163">Signing Stored Procedures in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/signing-stored-procedures-in-sql-server.md)  
 [<span data-ttu-id="c9929-164">Modyfikowanie danych za pomocą procedur składowanych</span><span class="sxs-lookup"><span data-stu-id="c9929-164">Modifying Data with Stored Procedures</span></span>](../../../../../docs/framework/data/adonet/modifying-data-with-stored-procedures.md)  
 [<span data-ttu-id="c9929-165">ADO.NET zarządzanego dostawcy i zestawu danych w Centrum deweloperów</span><span class="sxs-lookup"><span data-stu-id="c9929-165">ADO.NET Managed Providers and DataSet Developer Center</span></span>](http://go.microsoft.com/fwlink/?LinkId=217917)
