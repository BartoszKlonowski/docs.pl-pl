---
title: Dublowanie bazy danych w programie SQL Server
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 89befaff-bb46-4290-8382-e67cdb0e3de9
ms.openlocfilehash: 31fb8af4653cefc8027f4061b46b9a29d8d07f8c
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/22/2019
ms.locfileid: "69963987"
---
# <a name="database-mirroring-in-sql-server"></a><span data-ttu-id="b49ae-102">Dublowanie bazy danych w programie SQL Server</span><span class="sxs-lookup"><span data-stu-id="b49ae-102">Database Mirroring in SQL Server</span></span>
<span data-ttu-id="b49ae-103">Funkcja dublowania baz danych w programie SQL Server umożliwia przechowywanie kopii bazy danych SQL Server na serwerze rezerwy lub jej dublowanie.</span><span class="sxs-lookup"><span data-stu-id="b49ae-103">Database mirroring in SQL Server allows you to keep a copy, or mirror, of a SQL Server database on a standby server.</span></span> <span data-ttu-id="b49ae-104">Funkcja dublowania gwarantuje, że w każdym momencie istnieją dwie oddzielne kopie danych, zapewniając wysoką dostępność i pełną nadmiarowość danych.</span><span class="sxs-lookup"><span data-stu-id="b49ae-104">Mirroring ensures that two separate copies of the data exist at all times, providing high availability and complete data redundancy.</span></span> <span data-ttu-id="b49ae-105">Program .NET Dostawca danych dla SQL Server zapewnia niejawną obsługę funkcji dublowania baz danych, dzięki czemu Deweloper nie musi podejmować żadnych działań ani pisać kodu po skonfigurowaniu go dla bazy danych SQL Server.</span><span class="sxs-lookup"><span data-stu-id="b49ae-105">The .NET Data Provider for SQL Server provides implicit support for database mirroring, so that the developer does not need to take any action or write any code once it has been configured for a SQL Server database.</span></span> <span data-ttu-id="b49ae-106">Ponadto <xref:System.Data.SqlClient.SqlConnection> obiekt obsługuje tryb połączenia jawnego, który umożliwia podawanie nazwy serwera partnerskiego trybu failover <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>w programie.</span><span class="sxs-lookup"><span data-stu-id="b49ae-106">In addition, the <xref:System.Data.SqlClient.SqlConnection> object supports an explicit connection mode that allows supplying the name of a failover partner server in the <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span></span>  
  
 <span data-ttu-id="b49ae-107">Następująca uproszczona sekwencja zdarzeń występuje dla <xref:System.Data.SqlClient.SqlConnection> obiektu, który jest przeznaczony dla bazy danych skonfigurowanej do dublowania:</span><span class="sxs-lookup"><span data-stu-id="b49ae-107">The following simplified sequence of events occurs for a <xref:System.Data.SqlClient.SqlConnection> object that targets a database configured for mirroring:</span></span>  
  
1. <span data-ttu-id="b49ae-108">Aplikacja kliencka pomyślnie nawiąże połączenie z główną bazą danych, a serwer wysyła do niej nazwę serwera partnerskiego, która jest następnie buforowana na kliencie.</span><span class="sxs-lookup"><span data-stu-id="b49ae-108">The client application successfully connects to the principal database, and the server sends back the name of the partner server, which is then cached on the client.</span></span>  
  
2. <span data-ttu-id="b49ae-109">Jeśli serwer zawierający podstawową bazę danych ulegnie awarii lub połączenie zostanie przerwane, stan połączenia i transakcji zostanie utracony.</span><span class="sxs-lookup"><span data-stu-id="b49ae-109">If the server containing the principal database fails or connectivity is interrupted, connection and transaction state is lost.</span></span> <span data-ttu-id="b49ae-110">Aplikacja kliencka próbuje ponownie nawiązać połączenie z główną bazą danych i kończy się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="b49ae-110">The client application attempts to re-establish a connection to the principal database and fails.</span></span>  
  
3. <span data-ttu-id="b49ae-111">Aplikacja kliencka w sposób przezroczysty próbuje nawiązać połączenie z duplikatową bazą danych na serwerze partnerskim.</span><span class="sxs-lookup"><span data-stu-id="b49ae-111">The client application then transparently attempts to establish a connection to the mirror database on the partner server.</span></span> <span data-ttu-id="b49ae-112">Jeśli to się powiedzie, nastąpi przekierowanie do duplikatu bazy danych, która następnie będzie nową podstawową bazą danych.</span><span class="sxs-lookup"><span data-stu-id="b49ae-112">If it succeeds, the connection is redirected to the mirror database, which then becomes the new principal database.</span></span>  
  
## <a name="specifying-the-failover-partner-in-the-connection-string"></a><span data-ttu-id="b49ae-113">Określanie partnera trybu failover w parametrach połączenia</span><span class="sxs-lookup"><span data-stu-id="b49ae-113">Specifying the Failover Partner in the Connection String</span></span>  
 <span data-ttu-id="b49ae-114">W przypadku podania nazwy serwera partnerskiego trybu failover w parametrach połączenia klient będzie w sposób niewidoczny dla próby nawiązania połączenia z partnerem trybu failover, jeśli główna baza danych jest niedostępna, gdy aplikacja kliencka łączy się po raz pierwszy.</span><span class="sxs-lookup"><span data-stu-id="b49ae-114">If you supply the name of a failover partner server in the connection string, the client will transparently attempt a connection with the failover partner if the principal database is unavailable when the client application first connects.</span></span>  
  
```  
";Failover Partner=PartnerServerName"  
```  
  
 <span data-ttu-id="b49ae-115">Jeśli pominięto nazwę serwera partnerskiego trybu failover, a główna baza danych jest niedostępna, gdy aplikacja kliencka po <xref:System.Data.SqlClient.SqlException> raz pierwszy łączy się, zostanie zgłoszony.</span><span class="sxs-lookup"><span data-stu-id="b49ae-115">If you omit the name of the failover partner server and the principal database is unavailable when the client application first connects then a <xref:System.Data.SqlClient.SqlException> is raised.</span></span>  
  
 <span data-ttu-id="b49ae-116"><xref:System.Data.SqlClient.SqlConnection> Po pomyślnym otwarciu nazwy partnera trybu failover są zwracane przez serwer i zastępują wszystkie wartości podane w parametrach połączenia.</span><span class="sxs-lookup"><span data-stu-id="b49ae-116">When a <xref:System.Data.SqlClient.SqlConnection> is successfully opened, the failover partner name is returned by the server and supersedes any values supplied in the connection string.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="b49ae-117">Należy jawnie określić początkowy katalog lub nazwę bazy danych w parametrach połączenia dla scenariuszy dublowania baz danych.</span><span class="sxs-lookup"><span data-stu-id="b49ae-117">You must explicitly specify the initial catalog or database name in the connection string for database mirroring scenarios.</span></span> <span data-ttu-id="b49ae-118">Jeśli klient odbiera informacje o trybie failover dla połączenia, które nie ma jawnie określonego katalogu początkowego lub bazy danych, informacje o pracy awaryjnej nie są buforowane, a aplikacja nie podejmuje próby przełączenia w tryb failover w przypadku awarii serwera głównego.</span><span class="sxs-lookup"><span data-stu-id="b49ae-118">If the client receives failover information on a connection that doesn't have an explicitly specified initial catalog or database, the failover information is not cached and the application does not attempt to fail over if the principal server fails.</span></span> <span data-ttu-id="b49ae-119">Jeśli parametry połączenia mają wartość dla partnera trybu failover, ale nie `InvalidArgumentException` zostanie wyniesiona żadna wartość dla początkowego katalogu lub bazy danych.</span><span class="sxs-lookup"><span data-stu-id="b49ae-119">If a connection string has a value for the failover partner, but no value for the initial catalog or database, an `InvalidArgumentException` is raised.</span></span>  
  
## <a name="retrieving-the-current-server-name"></a><span data-ttu-id="b49ae-120">Pobieranie bieżącej nazwy serwera</span><span class="sxs-lookup"><span data-stu-id="b49ae-120">Retrieving the Current Server Name</span></span>  
 <span data-ttu-id="b49ae-121">W przypadku przełączenia w tryb failover można pobrać nazwę serwera, z którym bieżące połączenie jest rzeczywiście połączone przy użyciu <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> właściwości <xref:System.Data.SqlClient.SqlConnection> obiektu.</span><span class="sxs-lookup"><span data-stu-id="b49ae-121">In the event of a failover, you can retrieve the name of the server to which the current connection is actually connected by using the <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> property of a <xref:System.Data.SqlClient.SqlConnection> object.</span></span> <span data-ttu-id="b49ae-122">Poniższy fragment kodu pobiera nazwę aktywnego serwera, przy założeniu, że zmienna połączenia odwołuje się do otwartej <xref:System.Data.SqlClient.SqlConnection>.</span><span class="sxs-lookup"><span data-stu-id="b49ae-122">The following code fragment retrieves the name of the active server, assuming that the connection variable references an open <xref:System.Data.SqlClient.SqlConnection>.</span></span>  
  
 <span data-ttu-id="b49ae-123">Po wystąpieniu zdarzenia trybu failover i połączeniu z serwerem dublowanym Właściwość **DataSource** jest aktualizowana w celu odzwierciedlenia nazwy duplikatu.</span><span class="sxs-lookup"><span data-stu-id="b49ae-123">When a failover event occurs and the connection is switched to the mirror server, the **DataSource** property is updated to reflect the mirror name.</span></span>  
  
```vb  
Dim activeServer As String = connection.DataSource  
```  
  
```csharp  
string activeServer = connection.DataSource;  
```  
  
## <a name="sqlclient-mirroring-behavior"></a><span data-ttu-id="b49ae-124">Zachowanie funkcji dublowania SqlClient</span><span class="sxs-lookup"><span data-stu-id="b49ae-124">SqlClient Mirroring Behavior</span></span>  
 <span data-ttu-id="b49ae-125">Klient zawsze próbuje nawiązać połączenie z bieżącym serwerem głównym.</span><span class="sxs-lookup"><span data-stu-id="b49ae-125">The client always tries to connect to the current principal server.</span></span> <span data-ttu-id="b49ae-126">Jeśli to się nie powiedzie, podejmie próbę partnera trybu failover.</span><span class="sxs-lookup"><span data-stu-id="b49ae-126">If it fails, it tries the failover partner.</span></span> <span data-ttu-id="b49ae-127">Jeśli zdublowana baza danych została już przełączona do roli podmiotu zabezpieczeń na serwerze partnerskim, nawiązanie połączenia zakończy się pomyślnie, a nowe mapowanie dublowanego podmiotu zabezpieczeń jest wysyłane do klienta i buforowane przez <xref:System.AppDomain>okres istnienia wywołania.</span><span class="sxs-lookup"><span data-stu-id="b49ae-127">If the mirror database has already been switched to the principal role on the partner server, the connection succeeds and the new principal-mirror mapping is sent to the client and cached for the lifetime of the calling <xref:System.AppDomain>.</span></span> <span data-ttu-id="b49ae-128">Nie jest on przechowywany w magazynie trwałym i nie jest dostępny dla kolejnych połączeń w innej **domenie aplikacji** lub procesie.</span><span class="sxs-lookup"><span data-stu-id="b49ae-128">It is not stored in persistent storage and is not available for subsequent connections in a different **AppDomain** or process.</span></span> <span data-ttu-id="b49ae-129">Jest to jednak dostępne dla kolejnych połączeń w ramach tej samej **domeny aplikacji**.</span><span class="sxs-lookup"><span data-stu-id="b49ae-129">However, it is available for subsequent connections within the same **AppDomain**.</span></span> <span data-ttu-id="b49ae-130">Należy zauważyć, że inna **domena aplikacji** lub proces uruchomiony na tym samym lub innym komputerze zawsze ma swoją pulę połączeń i te połączenia nie są resetowane.</span><span class="sxs-lookup"><span data-stu-id="b49ae-130">Note that another **AppDomain** or process running on the same or a different computer always has its pool of connections, and those connections are not reset.</span></span> <span data-ttu-id="b49ae-131">W takim przypadku, jeśli podstawowa baza danych przestanie działać, każdy proces lub element **AppDomain** zakończy się niepowodzeniem, a pula zostanie automatycznie wyczyszczona.</span><span class="sxs-lookup"><span data-stu-id="b49ae-131">In that case, if the primary database goes down, each process or **AppDomain** fails once, and the pool is automatically cleared.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="b49ae-132">Obsługa dublowania na serwerze jest konfigurowana dla poszczególnych baz danych.</span><span class="sxs-lookup"><span data-stu-id="b49ae-132">Mirroring support on the server is configured on a per-database basis.</span></span> <span data-ttu-id="b49ae-133">Jeśli operacje manipulowania danymi są wykonywane w odniesieniu do innych baz danych, które nie znajdują się w zestawie główny/dublowany, przy użyciu nazw wieloczęściowych lub poprzez zmianę bieżącej bazy danych, zmiany tych innych baz danych nie są propagowane w przypadku awarii.</span><span class="sxs-lookup"><span data-stu-id="b49ae-133">If data manipulation operations are executed against other databases not included in the principal/mirror set, either by using multipart names or by changing the current database, the changes to these other databases do not propagate in the event of failure.</span></span> <span data-ttu-id="b49ae-134">Nie Wygenerowano żadnego błędu, gdy dane są modyfikowane w bazie danych, która nie jest dublowana.</span><span class="sxs-lookup"><span data-stu-id="b49ae-134">No error is generated when data is modified in a database that is not mirrored.</span></span> <span data-ttu-id="b49ae-135">Deweloper musi oszacować możliwy wpływ takich operacji.</span><span class="sxs-lookup"><span data-stu-id="b49ae-135">The developer must evaluate the possible impact of such operations.</span></span>  
  
## <a name="database-mirroring-resources"></a><span data-ttu-id="b49ae-136">Zasoby dublowania baz danych</span><span class="sxs-lookup"><span data-stu-id="b49ae-136">Database Mirroring Resources</span></span>  
 <span data-ttu-id="b49ae-137">Aby uzyskać dokumentację koncepcyjną i informacje dotyczące konfigurowania, wdrażania i administrowania dublowaniem, zobacz następujące zasoby w dokumentacji SQL Server.</span><span class="sxs-lookup"><span data-stu-id="b49ae-137">For conceptual documentation and information on configuring, deploying and administering mirroring, see the following resources in SQL Server documentation.</span></span>  
  
|<span data-ttu-id="b49ae-138">Zasób</span><span class="sxs-lookup"><span data-stu-id="b49ae-138">Resource</span></span>|<span data-ttu-id="b49ae-139">Opis</span><span class="sxs-lookup"><span data-stu-id="b49ae-139">Description</span></span>|  
|--------------|-----------------|  
|[<span data-ttu-id="b49ae-140">Dublowanie bazy danych</span><span class="sxs-lookup"><span data-stu-id="b49ae-140">Database Mirroring</span></span>](/sql/database-engine/database-mirroring/database-mirroring-sql-server)|<span data-ttu-id="b49ae-141">Opisuje sposób konfigurowania i konfigurowania dublowania w programie SQL Server.</span><span class="sxs-lookup"><span data-stu-id="b49ae-141">Describes how to set up and configure mirroring in SQL Server.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="b49ae-142">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="b49ae-142">See also</span></span>

- [<span data-ttu-id="b49ae-143">ADO.NET dostawcy zarządzani i centrum deweloperów zestawu danych</span><span class="sxs-lookup"><span data-stu-id="b49ae-143">ADO.NET Managed Providers and DataSet Developer Center</span></span>](https://go.microsoft.com/fwlink/?LinkId=217917)
