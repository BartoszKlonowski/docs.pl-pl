---
title: Dublowania w programie SQL Server bazy danych
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-ado
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
ms.assetid: 89befaff-bb46-4290-8382-e67cdb0e3de9
caps.latest.revision: "6"
author: JennieHubbard
ms.author: jhubbard
manager: jhubbard
ms.workload: dotnet
ms.openlocfilehash: 6956d48163f9b9da66258c0dbb3452beab5420d9
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 12/22/2017
---
# <a name="database-mirroring-in-sql-server"></a><span data-ttu-id="6cc4c-102">Dublowania w programie SQL Server bazy danych</span><span class="sxs-lookup"><span data-stu-id="6cc4c-102">Database Mirroring in SQL Server</span></span>
<span data-ttu-id="6cc4c-103">Funkcja dublowania baz danych w programie SQL Server pozwala na zachowanie kopiowania lub dublowania bazy danych programu SQL Server na serwerze wstrzymania.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-103">Database mirroring in SQL Server allows you to keep a copy, or mirror, of a SQL Server database on a standby server.</span></span> <span data-ttu-id="6cc4c-104">Dublowanie gwarantuje, że dwa osobne kopie danych istnieje przez cały czas, wysokiej dostępności i ukończyć nadmiarowość danych.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-104">Mirroring ensures that two separate copies of the data exist at all times, providing high availability and complete data redundancy.</span></span> <span data-ttu-id="6cc4c-105">Dostawcy danych programu .NET dla programu SQL Server obsługuje niejawne dublowania bazy danych, dzięki czemu deweloper nie trzeba podejmować żadnych działań lub pisania kodu, gdy została skonfigurowana dla bazy danych programu SQL Server.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-105">The .NET Data Provider for SQL Server provides implicit support for database mirroring, so that the developer does not need to take any action or write any code once it has been configured for a SQL Server database.</span></span> <span data-ttu-id="6cc4c-106">Ponadto <xref:System.Data.SqlClient.SqlConnection> obiektu obsługuje tryb jawne połączenie, który umożliwia podanie nazwy serwera partnerskiego trybu failover w <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-106">In addition, the <xref:System.Data.SqlClient.SqlConnection> object supports an explicit connection mode that allows supplying the name of a failover partner server in the <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span></span>  
  
 <span data-ttu-id="6cc4c-107">Ma miejsce następująca sekwencja uproszczony zdarzeń dla <xref:System.Data.SqlClient.SqlConnection> obiektu, którego celem jest skonfigurowany dla funkcji dublowania bazy danych:</span><span class="sxs-lookup"><span data-stu-id="6cc4c-107">The following simplified sequence of events occurs for a <xref:System.Data.SqlClient.SqlConnection> object that targets a database configured for mirroring:</span></span>  
  
1.  <span data-ttu-id="6cc4c-108">Aplikacja kliencka połączy się z główną bazą danych, a serwer odsyła nazwę serwera partnerskiego, które następnie są buforowane na kliencie.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-108">The client application successfully connects to the principal database, and the server sends back the name of the partner server, which is then cached on the client.</span></span>  
  
2.  <span data-ttu-id="6cc4c-109">Jeśli serwer zawierający główna baza danych nie powiedzie się lub połączenie zostanie przerwane, stan połączenia i transakcji zostaną utracone.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-109">If the server containing the principal database fails or connectivity is interrupted, connection and transaction state is lost.</span></span> <span data-ttu-id="6cc4c-110">Aplikacja kliencka próbuje ponownie ustanowić połączenia z główną bazą danych i nie powiedzie się.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-110">The client application attempts to re-establish a connection to the principal database and fails.</span></span>  
  
3.  <span data-ttu-id="6cc4c-111">Przezroczysty następnie aplikacja kliencka próbuje nawiązać połączenie z duplikatu bazy danych na serwer partnerski.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-111">The client application then transparently attempts to establish a connection to the mirror database on the partner server.</span></span> <span data-ttu-id="6cc4c-112">Jeśli próba powiedzie się, połączenie jest przekierowywany do duplikatu bazy danych, która staje się nowego podmiotu zabezpieczeń bazy danych.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-112">If it succeeds, the connection is redirected to the mirror database, which then becomes the new principal database.</span></span>  
  
## <a name="specifying-the-failover-partner-in-the-connection-string"></a><span data-ttu-id="6cc4c-113">Określanie serwer partnerski trybu Failover w parametrach połączenia</span><span class="sxs-lookup"><span data-stu-id="6cc4c-113">Specifying the Failover Partner in the Connection String</span></span>  
 <span data-ttu-id="6cc4c-114">Jeśli podasz nazwę serwera partnerskiego trybu failover w parametrach połączenia klienta niewidocznie prób połączenia z serwer partnerski trybu failover, jeśli główna baza danych jest niedostępna, jeśli aplikacja kliencka pierwszy raz łączy.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-114">If you supply the name of a failover partner server in the connection string, the client will transparently attempt a connection with the failover partner if the principal database is unavailable when the client application first connects.</span></span>  
  
```  
";Failover Partner=PartnerServerName"  
```  
  
 <span data-ttu-id="6cc4c-115">Jeśli pominięto nazwę serwera partnerskiego trybu failover i główna baza danych jest niedostępny podczas aplikacja kliencka pierwszy raz łączy następnie <xref:System.Data.SqlClient.SqlException> jest wywoływane.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-115">If you omit the name of the failover partner server and the principal database is unavailable when the client application first connects then a <xref:System.Data.SqlClient.SqlException> is raised.</span></span>  
  
 <span data-ttu-id="6cc4c-116">Gdy <xref:System.Data.SqlClient.SqlConnection> jest poprawnie otwarty, jest zwracany przez serwer Nazwa partnera pracy awaryjnej i zastępuje wszelkie wartości dostarczone w parametrach połączenia.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-116">When a <xref:System.Data.SqlClient.SqlConnection> is successfully opened, the failover partner name is returned by the server and supersedes any values supplied in the connection string.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6cc4c-117">Nazwa początkowego wykazu lub bazy danych należy jawnie określić w parametrach połączenia dla scenariuszy dublowania bazy danych.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-117">You must explicitly specify the initial catalog or database name in the connection string for database mirroring scenarios.</span></span> <span data-ttu-id="6cc4c-118">Jeśli klient otrzymuje informacje trybu failover na połączenie, które nie mają jawnie określona początkowego wykazu lub bazy danych, informacje trybu failover nie są buforowane, a aplikacja nie będzie podejmował prób w przypadku awarii podmiotu zabezpieczeń serwera w trybie Failover.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-118">If the client receives failover information on a connection that doesn't have an explicitly specified initial catalog or database, the failover information is not cached and the application does not attempt to fail over if the principal server fails.</span></span> <span data-ttu-id="6cc4c-119">Jeśli parametry połączenia ma wartość serwer partnerski trybu failover, ale żadnej wartości dla początkowego wykazu lub bazy danych, `InvalidArgumentException` jest wywoływane.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-119">If a connection string has a value for the failover partner, but no value for the initial catalog or database, an `InvalidArgumentException` is raised.</span></span>  
  
## <a name="retrieving-the-current-server-name"></a><span data-ttu-id="6cc4c-120">Pobieranie bieżącej nazwy serwera</span><span class="sxs-lookup"><span data-stu-id="6cc4c-120">Retrieving the Current Server Name</span></span>  
 <span data-ttu-id="6cc4c-121">W przypadku trybu failover, możesz pobrać nazwę serwera, do którego bieżące połączenie jest rzeczywiście połączony przy użyciu <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> właściwość <xref:System.Data.SqlClient.SqlConnection> obiektu.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-121">In the event of a failover, you can retrieve the name of the server to which the current connection is actually connected by using the <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> property of a <xref:System.Data.SqlClient.SqlConnection> object.</span></span> <span data-ttu-id="6cc4c-122">Poniższy fragment kodu pobiera nazwę aktywnego serwera, przy założeniu, że zmienna połączenia odwołuje się do otwartego <xref:System.Data.SqlClient.SqlConnection>.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-122">The following code fragment retrieves the name of the active server, assuming that the connection variable references an open <xref:System.Data.SqlClient.SqlConnection>.</span></span>  
  
 <span data-ttu-id="6cc4c-123">Po wystąpieniu zdarzenia pracy awaryjnej i połączenia się przełączone do serwer duplikatu **źródła danych** właściwości jest aktualizowana w celu odzwierciedlenia nazwy duplikatu.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-123">When a failover event occurs and the connection is switched to the mirror server, the **DataSource** property is updated to reflect the mirror name.</span></span>  
  
```vb  
Dim activeServer As String = connection.DataSource  
```  
  
```csharp  
string activeServer = connection.DataSource;  
```  
  
## <a name="sqlclient-mirroring-behavior"></a><span data-ttu-id="6cc4c-124">Zachowanie funkcji dublowania SqlClient</span><span class="sxs-lookup"><span data-stu-id="6cc4c-124">SqlClient Mirroring Behavior</span></span>  
 <span data-ttu-id="6cc4c-125">Klient zawsze próbuje nawiązać połączenia z bieżącym serwerze dublowanym.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-125">The client always tries to connect to the current principal server.</span></span> <span data-ttu-id="6cc4c-126">W przypadku niepowodzenia podejmuje serwer partnerski trybu failover.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-126">If it fails, it tries the failover partner.</span></span> <span data-ttu-id="6cc4c-127">Jeśli już duplikatu bazy danych została przełączona na głównej roli na serwerze partnerskim, połączenie powiedzie się i nowe mapowanie dublowany podmiot zabezpieczeń są wysyłane do klienta i w pamięci podręcznej przez czas ich istnienia wywołujący <xref:System.AppDomain>.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-127">If the mirror database has already been switched to the principal role on the partner server, the connection succeeds and the new principal-mirror mapping is sent to the client and cached for the lifetime of the calling <xref:System.AppDomain>.</span></span> <span data-ttu-id="6cc4c-128">Nie są przechowywane w magazynie trwałe i nie jest dostępna dla kolejnych połączeń w innej **elementu AppDomain** lub inny proces.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-128">It is not stored in persistent storage and is not available for subsequent connections in a different **AppDomain** or process.</span></span> <span data-ttu-id="6cc4c-129">Jednak nie jest dostępny do kolejnych połączeń, w tym samym **elementu AppDomain**.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-129">However, it is available for subsequent connections within the same **AppDomain**.</span></span> <span data-ttu-id="6cc4c-130">Uwaga to inny **elementu AppDomain** lub proces uruchomiony na tym samym lub innym komputerze zawsze ma puli połączeń, a te połączenia nie są resetowane.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-130">Note that another **AppDomain** or process running on the same or a different computer always has its pool of connections, and those connections are not reset.</span></span> <span data-ttu-id="6cc4c-131">W takim przypadku głównej bazy danych ulegnie awarii, każdy proces lub **elementu AppDomain** raz kończy się niepowodzeniem i puli są automatycznie usuwane.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-131">In that case, if the primary database goes down, each process or **AppDomain** fails once, and the pool is automatically cleared.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6cc4c-132">Funkcja dublowania obsługi na serwerze jest skonfigurowana na podstawie na bazę danych.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-132">Mirroring support on the server is configured on a per-database basis.</span></span> <span data-ttu-id="6cc4c-133">Jeśli operacje manipulacji danych są wykonywane w innych bazach danych nie są uwzględniane w zestawie principal/duplikatu, przy użyciu nazwy wieloczęściowej lub zmieniając bieżącej bazy danych zmiany tych baz danych nie są propagowane w przypadku awarii.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-133">If data manipulation operations are executed against other databases not included in the principal/mirror set, either by using multipart names or by changing the current database, the changes to these other databases do not propagate in the event of failure.</span></span> <span data-ttu-id="6cc4c-134">Nie zostanie wygenerowany błąd modyfikacji danych w bazie danych, która nie jest dublowana.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-134">No error is generated when data is modified in a database that is not mirrored.</span></span> <span data-ttu-id="6cc4c-135">Deweloper musi być możliwy wpływ takich operacji.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-135">The developer must evaluate the possible impact of such operations.</span></span>  
  
## <a name="database-mirroring-resources"></a><span data-ttu-id="6cc4c-136">Zasoby dublowania bazy danych</span><span class="sxs-lookup"><span data-stu-id="6cc4c-136">Database Mirroring Resources</span></span>  
 <span data-ttu-id="6cc4c-137">Dokumentacja koncepcyjna i informacji na temat konfigurowania wdrażania i administrowania dublowania, zobacz następujące zasoby w programie SQL Server — książki Online.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-137">For conceptual documentation and information on configuring, deploying and administering mirroring, see the following resources in SQL Server Books Online.</span></span>  
  
|<span data-ttu-id="6cc4c-138">Zasób</span><span class="sxs-lookup"><span data-stu-id="6cc4c-138">Resource</span></span>|<span data-ttu-id="6cc4c-139">Opis</span><span class="sxs-lookup"><span data-stu-id="6cc4c-139">Description</span></span>|  
|--------------|-----------------|  
|<span data-ttu-id="6cc4c-140">[Funkcja dublowania baz danych](http://msdn.microsoft.com/library/bb934127.aspx) w dokumentacji SQL Server Books Online</span><span class="sxs-lookup"><span data-stu-id="6cc4c-140">[Database Mirroring](http://msdn.microsoft.com/library/bb934127.aspx) in SQL Server Books Online</span></span>|<span data-ttu-id="6cc4c-141">Opisuje sposób instalowania i konfigurowania funkcji dublowania w programie SQL Server.</span><span class="sxs-lookup"><span data-stu-id="6cc4c-141">Describes how to set up and configure mirroring in SQL Server.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="6cc4c-142">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="6cc4c-142">See Also</span></span>  
 [<span data-ttu-id="6cc4c-143">ADO.NET zarządzanego dostawcy i zestawu danych w Centrum deweloperów</span><span class="sxs-lookup"><span data-stu-id="6cc4c-143">ADO.NET Managed Providers and DataSet Developer Center</span></span>](http://go.microsoft.com/fwlink/?LinkId=217917)
