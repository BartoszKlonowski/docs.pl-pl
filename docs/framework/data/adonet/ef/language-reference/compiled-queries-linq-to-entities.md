---
title: Zapytania skompilowane (LINQ to Entities)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 8025ba1d-29c7-4407-841b-d5a3bed40b7a
ms.openlocfilehash: b4594932b6ed21de98faab57d80404a7b763067d
ms.sourcegitcommit: 488aced39b5f374bc0a139a4993616a54d15baf0
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 05/12/2020
ms.locfileid: "83207916"
---
# <a name="compiled-queries--linq-to-entities"></a><span data-ttu-id="95347-102">Skompilowane zapytania (LINQ to Entities)</span><span class="sxs-lookup"><span data-stu-id="95347-102">Compiled queries  (LINQ to Entities)</span></span>

<span data-ttu-id="95347-103">W przypadku aplikacji, która wykonuje zapytania podobne do strukturalnie w Entity Framework, można często zwiększyć wydajność, kompilując zapytanie jeden raz i wykonując je kilka razy z innymi parametrami.</span><span class="sxs-lookup"><span data-stu-id="95347-103">When you have an application that executes structurally similar queries many times in the Entity Framework, you can frequently increase performance by compiling the query one time and executing it several times with different parameters.</span></span> <span data-ttu-id="95347-104">Na przykład aplikacja może wymagać pobrania wszystkich klientów z określonego miasta. Miasto jest określone w czasie wykonywania przez użytkownika w formularzu.</span><span class="sxs-lookup"><span data-stu-id="95347-104">For example, an application might have to retrieve all the customers in a particular city; the city is specified at runtime by the user in a form.</span></span> <span data-ttu-id="95347-105">LINQ to Entities obsługuje w tym celu używanie skompilowanych zapytań.</span><span class="sxs-lookup"><span data-stu-id="95347-105">LINQ to Entities supports using compiled queries for this purpose.</span></span>  
  
 <span data-ttu-id="95347-106">Począwszy od .NET Framework 4,5, zapytania LINQ są buforowane automatycznie.</span><span class="sxs-lookup"><span data-stu-id="95347-106">Starting with .NET Framework 4.5, LINQ queries are cached automatically.</span></span> <span data-ttu-id="95347-107">Można jednak nadal używać skompilowanych zapytań LINQ, aby ograniczyć ten koszt do późniejszych wykonań, a skompilowane zapytania mogą być bardziej wydajne niż zapytania LINQ, które są automatycznie buforowane.</span><span class="sxs-lookup"><span data-stu-id="95347-107">However, you can still use compiled LINQ queries to reduce this cost in later executions and compiled queries can be more efficient than LINQ queries that are automatically cached.</span></span> <span data-ttu-id="95347-108">LINQ to Entities zapytania, które stosują `Enumerable.Contains` operator do kolekcji w pamięci, nie są automatycznie buforowane.</span><span class="sxs-lookup"><span data-stu-id="95347-108">LINQ to Entities queries that apply the `Enumerable.Contains` operator to in-memory collections are not automatically cached.</span></span> <span data-ttu-id="95347-109">Ponadto parametryzacja kolekcje w pamięci w skompilowanych zapytaniach LINQ są niedozwolone.</span><span class="sxs-lookup"><span data-stu-id="95347-109">Also, parameterizing in-memory collections in compiled LINQ queries is not allowed.</span></span>  
  
 <span data-ttu-id="95347-110"><xref:System.Data.Objects.CompiledQuery>Klasa zawiera kompilację i buforowanie zapytań do ponownego użycia.</span><span class="sxs-lookup"><span data-stu-id="95347-110">The <xref:System.Data.Objects.CompiledQuery> class provides compilation and caching of queries for reuse.</span></span> <span data-ttu-id="95347-111">Koncepcyjnie, ta klasa zawiera <xref:System.Data.Objects.CompiledQuery> `Compile` metodę z kilkoma przeciążeniami.</span><span class="sxs-lookup"><span data-stu-id="95347-111">Conceptually, this class contains a <xref:System.Data.Objects.CompiledQuery>'s `Compile` method with several overloads.</span></span> <span data-ttu-id="95347-112">Wywołaj `Compile` metodę, aby utworzyć nowy delegat reprezentujący skompilowane zapytanie.</span><span class="sxs-lookup"><span data-stu-id="95347-112">Call the `Compile` method to create a new delegate to represent the compiled query.</span></span> <span data-ttu-id="95347-113">`Compile`Metody, dostarczone z <xref:System.Data.Objects.ObjectContext> wartościami parametrów i zwracają delegata, który tworzy jakiś wynik (na przykład <xref:System.Linq.IQueryable%601> wystąpienie).</span><span class="sxs-lookup"><span data-stu-id="95347-113">The `Compile` methods, provided with a <xref:System.Data.Objects.ObjectContext> and parameter values, return a delegate that produces some result (such as an <xref:System.Linq.IQueryable%601> instance).</span></span> <span data-ttu-id="95347-114">Zapytanie kompiluje się raz podczas pierwszego wykonania.</span><span class="sxs-lookup"><span data-stu-id="95347-114">The query compiles once during only the first execution.</span></span> <span data-ttu-id="95347-115">Opcji scalania ustawionych dla zapytania w czasie kompilacji nie można później zmienić.</span><span class="sxs-lookup"><span data-stu-id="95347-115">The merge options set for the query at the time of the compilation cannot be changed later.</span></span> <span data-ttu-id="95347-116">Po skompilowaniu zapytania można dostarczyć tylko parametry typu pierwotnego, ale nie można zastąpić części zapytania, które mogłyby spowodować zmianę wygenerowanej bazy danych SQL.</span><span class="sxs-lookup"><span data-stu-id="95347-116">Once the query is compiled, you can only supply parameters of primitive type but you cannot replace parts of the query that would change the generated SQL.</span></span> <span data-ttu-id="95347-117">Aby uzyskać więcej informacji, zobacz sekcję dotyczącą [scalania opcji i skompilowanych zapytań](https://docs.microsoft.com/archive/blogs/dsimmons/ef-merge-options-and-compiled-queries).</span><span class="sxs-lookup"><span data-stu-id="95347-117">For more information, see [EF Merge Options and Compiled Queries](https://docs.microsoft.com/archive/blogs/dsimmons/ef-merge-options-and-compiled-queries).</span></span>
  
 <span data-ttu-id="95347-118">Wyrażenie zapytania LINQ to Entities, które jest <xref:System.Data.Objects.CompiledQuery> `Compile` kompilowane Metoda jest reprezentowane przez jeden z `Func` delegatów ogólnych, takich jak <xref:System.Func%605> .</span><span class="sxs-lookup"><span data-stu-id="95347-118">The LINQ to Entities query expression that the <xref:System.Data.Objects.CompiledQuery>'s `Compile` method compiles is represented by one of the generic `Func` delegates, such as <xref:System.Func%605>.</span></span> <span data-ttu-id="95347-119">Co więcej, wyrażenie zapytania może hermetyzować `ObjectContext` parametr, parametr Return i 16 parametrów zapytania.</span><span class="sxs-lookup"><span data-stu-id="95347-119">At most, the query expression can encapsulate an `ObjectContext` parameter, a return parameter, and 16 query parameters.</span></span> <span data-ttu-id="95347-120">Jeśli wymagane są więcej niż 16 parametrów zapytania, można utworzyć strukturę, której właściwości reprezentują parametry zapytania.</span><span class="sxs-lookup"><span data-stu-id="95347-120">If more than 16 query parameters are required, you can create a structure whose properties represent query parameters.</span></span> <span data-ttu-id="95347-121">Po ustawieniu właściwości można użyć właściwości struktury w wyrażeniu zapytania.</span><span class="sxs-lookup"><span data-stu-id="95347-121">You can then use the properties on the structure in the query expression after you set the properties.</span></span>  
  
## <a name="example-1"></a><span data-ttu-id="95347-122">Przykład 1</span><span class="sxs-lookup"><span data-stu-id="95347-122">Example 1</span></span>  
 <span data-ttu-id="95347-123">Poniższy przykład kompiluje, a następnie wywołuje zapytanie, które akceptuje <xref:System.Decimal> parametr wejściowy i zwraca sekwencję zamówień, w których całkowita liczba operacji jest większa lub równa $200,00:</span><span class="sxs-lookup"><span data-stu-id="95347-123">The following example compiles and then invokes a query that accepts a <xref:System.Decimal> input parameter and returns a sequence of orders where the total due is greater than or equal to $200.00:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query 2](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery2)]
 [!code-vb[DP L2E Conceptual Examples - compiled query2](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery2)]  
  
## <a name="example-2"></a><span data-ttu-id="95347-124">Przykład 2</span><span class="sxs-lookup"><span data-stu-id="95347-124">Example 2</span></span>  
 <span data-ttu-id="95347-125">Poniższy przykład kompiluje, a następnie wywołuje zapytanie zwracające <xref:System.Data.Objects.ObjectQuery%601> wystąpienie:</span><span class="sxs-lookup"><span data-stu-id="95347-125">The following example compiles and then invokes a query that returns an <xref:System.Data.Objects.ObjectQuery%601> instance:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query1_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery1_mq)]
 [!code-vb[DP L2E Conceptual Examples - compiled query1_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery1_mq)]  
  
## <a name="example-3"></a><span data-ttu-id="95347-126">Przykład 3</span><span class="sxs-lookup"><span data-stu-id="95347-126">Example 3</span></span>  
 <span data-ttu-id="95347-127">Poniższy przykład kompiluje, a następnie wywołuje zapytanie, które zwraca średnią cen z listy produktów jako <xref:System.Decimal> wartość:</span><span class="sxs-lookup"><span data-stu-id="95347-127">The following example compiles and then invokes a query that returns the average of the product list prices as a <xref:System.Decimal> value:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query3_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery3_mq)]
 [!code-vb[DP L2E Conceptual Examples - compiled query3_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery3_mq)]  
  
## <a name="example-4"></a><span data-ttu-id="95347-128">Przykład 4</span><span class="sxs-lookup"><span data-stu-id="95347-128">Example 4</span></span>  
 <span data-ttu-id="95347-129">Poniższy przykład kompiluje, a następnie wywołuje kwerendę akceptującą <xref:System.String> parametr wejściowy, a następnie zwraca wartość, `Contact` której adres e-mail rozpoczyna się od określonego ciągu:</span><span class="sxs-lookup"><span data-stu-id="95347-129">The following example compiles and then invokes a query that accepts a <xref:System.String> input parameter and then returns a `Contact` whose email address starts with the specified string:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query4_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery4_mq)]
 [!code-vb[DP L2E Conceptual Examples - compiled query4_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery4_mq)]  
  
## <a name="example-5"></a><span data-ttu-id="95347-130">Przykład 5</span><span class="sxs-lookup"><span data-stu-id="95347-130">Example 5</span></span>  
 <span data-ttu-id="95347-131">Poniższy przykład kompiluje, a następnie wywołuje kwerendę akceptującą <xref:System.DateTime> i <xref:System.Decimal> wejściową parametrów oraz zwraca sekwencję zamówień, w których Data zamówienia jest późniejsza niż 8 marca 2003, a łączna kwota jest mniejsza niż $300,00:</span><span class="sxs-lookup"><span data-stu-id="95347-131">The following example compiles and then invokes a query that accepts <xref:System.DateTime> and <xref:System.Decimal> input parameters and returns a sequence of orders where the order date is later than March 8, 2003, and the total due is less than $300.00:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query5](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery5)]
 [!code-vb[DP L2E Conceptual Examples - compiled query5](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery5)]  
  
## <a name="example-6"></a><span data-ttu-id="95347-132">Przykład 6</span><span class="sxs-lookup"><span data-stu-id="95347-132">Example 6</span></span>  
 <span data-ttu-id="95347-133">Poniższy przykład kompiluje, a następnie wywołuje kwerendę akceptującą <xref:System.DateTime> parametr wejściowy i zwraca sekwencję zamówień, w których Data zamówienia jest późniejsza niż 8 marca 2004.</span><span class="sxs-lookup"><span data-stu-id="95347-133">The following example compiles and then invokes a query that accepts a <xref:System.DateTime> input parameter and returns a sequence of orders where the order date is later than March 8, 2004.</span></span> <span data-ttu-id="95347-134">To zapytanie zwraca informacje o kolejności jako sekwencję typów anonimowych.</span><span class="sxs-lookup"><span data-stu-id="95347-134">This query returns the order information as a sequence of anonymous types.</span></span> <span data-ttu-id="95347-135">Typy anonimowe są wywnioskowane przez kompilator, dlatego nie można określić parametrów typu w <xref:System.Data.Objects.CompiledQuery> `Compile` metodzie, a typ jest zdefiniowany w zapytaniu.</span><span class="sxs-lookup"><span data-stu-id="95347-135">Anonymous types are inferred by the compiler, so you cannot specify type parameters in the <xref:System.Data.Objects.CompiledQuery>'s `Compile` method and the type is defined in the query itself.</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query6](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery6)]
 [!code-vb[DP L2E Conceptual Examples - compiled query6](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery6)]  
  
## <a name="example-7"></a><span data-ttu-id="95347-136">Przykład 7</span><span class="sxs-lookup"><span data-stu-id="95347-136">Example 7</span></span>  
 <span data-ttu-id="95347-137">Poniższy przykład kompiluje, a następnie wywołuje kwerendę akceptującą parametr wejściowy struktury zdefiniowanej przez użytkownika i zwraca sekwencję zamówień.</span><span class="sxs-lookup"><span data-stu-id="95347-137">The following example compiles and then invokes a query that accepts a user-defined structure input parameter and returns a sequence of orders.</span></span> <span data-ttu-id="95347-138">Struktura definiuje datę początkową, datę końcową i łączną liczbę parametrów zapytania, a zapytanie zwraca zamówienia wysłane między 3 marca i 8 marca 2003 ze wszystkimi wynikami przekraczającymi $700,00.</span><span class="sxs-lookup"><span data-stu-id="95347-138">The structure defines start date, end date, and total due query parameters, and the query returns orders shipped between March 3 and March 8, 2003 with a total due greater than $700.00.</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - compiled query7](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery7)]
 [!code-vb[DP L2E Conceptual Examples - compiled query7](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery7)]  
  
 <span data-ttu-id="95347-139">Struktura, która definiuje parametry zapytania:</span><span class="sxs-lookup"><span data-stu-id="95347-139">The structure that defines the query parameters:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples - MyParamsStruct](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#myparamsstruct)]
 [!code-vb[DP L2E Conceptual Examples - MyParamsStruct](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#myparamsstruct)]  
  
## <a name="see-also"></a><span data-ttu-id="95347-140">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="95347-140">See also</span></span>

- [<span data-ttu-id="95347-141">Program Entity Framework na platformie ADO.NET</span><span class="sxs-lookup"><span data-stu-id="95347-141">ADO.NET Entity Framework</span></span>](../index.md)
- [<span data-ttu-id="95347-142">LINQ to Entities</span><span class="sxs-lookup"><span data-stu-id="95347-142">LINQ to Entities</span></span>](linq-to-entities.md)
- [<span data-ttu-id="95347-143">Opcje scalania EF i skompilowane zapytania</span><span class="sxs-lookup"><span data-stu-id="95347-143">EF Merge Options and Compiled Queries</span></span>](https://docs.microsoft.com/archive/blogs/dsimmons/ef-merge-options-and-compiled-queries)
