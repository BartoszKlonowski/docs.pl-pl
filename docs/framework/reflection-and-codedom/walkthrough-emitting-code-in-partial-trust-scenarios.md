---
title: "Wskazówki: emitowanie kodu w scenariuszach częściowo zaufanych"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- reflection emit, anonymously hosted dynamic methods
- partial trust, reflection
- partial trust, emitting dynamic methods
- reflection emit, partial trust scenarios
- anonymously hosted dynamic methods [.NET Framework]
- emitting dynamic assemblies,partial trust scenarios
- reflection emit, dynamic methods
- dynamic methods
ms.assetid: c45be261-2a9d-4c4e-9bd6-27f0931b7d25
caps.latest.revision: "15"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 835483d740b60f98c3170a590edbfbfbe970d783
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 12/22/2017
---
# <a name="walkthrough-emitting-code-in-partial-trust-scenarios"></a><span data-ttu-id="91107-102">Wskazówki: emitowanie kodu w scenariuszach częściowo zaufanych</span><span class="sxs-lookup"><span data-stu-id="91107-102">Walkthrough: Emitting Code in Partial Trust Scenarios</span></span>
<span data-ttu-id="91107-103">Emisja odbicia używa tego samego interfejsu API w pełnej lub częściowej relacji zaufania, ale niektóre funkcje wymagają szczególnych uprawnień w częściowo zaufany kod.</span><span class="sxs-lookup"><span data-stu-id="91107-103">Reflection emit uses the same API set in full or partial trust, but some features require special permissions in partially trusted code.</span></span> <span data-ttu-id="91107-104">Ponadto emisja odbicia ma funkcji hostowanej anonimowo metody dynamicznej, który jest przeznaczony do użycia z częściowa relacja zaufania i zestawy przezroczystym poziomie bezpieczeństwa.</span><span class="sxs-lookup"><span data-stu-id="91107-104">In addition, reflection emit has a feature, anonymously hosted dynamic methods, that is designed to be used with partial trust and by security-transparent assemblies.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="91107-105">Przed [!INCLUDE[net_v35_long](../../../includes/net-v35-long-md.md)], emitowanie kodu wymagane <xref:System.Security.Permissions.ReflectionPermission> z <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit?displayProperty=nameWithType> flagi.</span><span class="sxs-lookup"><span data-stu-id="91107-105">Before [!INCLUDE[net_v35_long](../../../includes/net-v35-long-md.md)], emitting code required <xref:System.Security.Permissions.ReflectionPermission> with the <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit?displayProperty=nameWithType> flag.</span></span> <span data-ttu-id="91107-106">To uprawnienie jest domyślnie włączone w `FullTrust` i `Intranet` ustawia uprawnienia nazwanego, ale nie w `Internet` zestaw uprawnień.</span><span class="sxs-lookup"><span data-stu-id="91107-106">This permission is included by default in the `FullTrust` and `Intranet` named permission sets, but not in the `Internet` permission set.</span></span> <span data-ttu-id="91107-107">W związku z tym biblioteki można używać z częściowa relacja zaufania tylko w przypadku, gdyby <xref:System.Security.SecurityCriticalAttribute> atrybutu i również wykonywane <xref:System.Security.PermissionSet.Assert%2A> metodę <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit>.</span><span class="sxs-lookup"><span data-stu-id="91107-107">Therefore, a library could be used from partial trust only if it had the <xref:System.Security.SecurityCriticalAttribute> attribute and also executed an <xref:System.Security.PermissionSet.Assert%2A> method for <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit>.</span></span> <span data-ttu-id="91107-108">Takie biblioteki wymagają przeglądu zabezpieczeń zachować ostrożność, ponieważ błędy kodowania może skutkować luk w zabezpieczeniach.</span><span class="sxs-lookup"><span data-stu-id="91107-108">Such libraries require careful security review because coding errors could result in security holes.</span></span> <span data-ttu-id="91107-109">[!INCLUDE[net_v35_short](../../../includes/net-v35-short-md.md)] Umożliwia kod, aby emitować w scenariuszach częściowo zaufanych bez wystawiania wszystkie żądania kontroli zabezpieczeń, ponieważ generowanie kodu nie jest z założenia uprzywilejowanych operacji.</span><span class="sxs-lookup"><span data-stu-id="91107-109">The [!INCLUDE[net_v35_short](../../../includes/net-v35-short-md.md)] allows code to be emitted in partial trust scenarios without issuing any security demands, because generating code is not inherently a privileged operation.</span></span> <span data-ttu-id="91107-110">Oznacza to, że wygenerowany kod nie ma więcej uprawnień niż zestaw, który emituje go.</span><span class="sxs-lookup"><span data-stu-id="91107-110">That is, the generated code has no more permissions than the assembly that emits it.</span></span> <span data-ttu-id="91107-111">Dzięki temu biblioteki, w których Emituj kod jest przezroczystym poziomie bezpieczeństwa i eliminuje potrzebę do potwierdzenia <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit>, dzięki czemu zapisywania bezpiecznego biblioteki nie wymaga przeglądu względem zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="91107-111">This enables libraries that emit code to be security-transparent and removes the need to assert <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit>, so that writing a secure library does not require such a thorough security review.</span></span>  
  
 <span data-ttu-id="91107-112">W instruktażu przedstawiono następujące zagadnienia:</span><span class="sxs-lookup"><span data-stu-id="91107-112">This walkthrough illustrates the following tasks:</span></span>  
  
-   <span data-ttu-id="91107-113">[Konfigurowanie prostego piaskownicy testowania częściowo zaufany kod](#Setting_up).</span><span class="sxs-lookup"><span data-stu-id="91107-113">[Setting up a simple sandbox for testing partially trusted code](#Setting_up).</span></span>  
  
    > [!IMPORTANT]
    >  <span data-ttu-id="91107-114">Jest to prosty sposób na wypróbowanie kodu w częściowej relacji zaufania.</span><span class="sxs-lookup"><span data-stu-id="91107-114">This is a simple way to experiment with code in partial trust.</span></span> <span data-ttu-id="91107-115">Aby uruchomić kod, który faktycznie pochodzi z niezaufanej lokalizacji, zobacz [porady: uruchamianie częściowo zaufanego kodu w bibliotece](../../../docs/framework/misc/how-to-run-partially-trusted-code-in-a-sandbox.md).</span><span class="sxs-lookup"><span data-stu-id="91107-115">To run code that actually comes from untrusted locations, see [How to: Run Partially Trusted Code in a Sandbox](../../../docs/framework/misc/how-to-run-partially-trusted-code-in-a-sandbox.md).</span></span>  
  
-   <span data-ttu-id="91107-116">[Uruchamianie kodu w aplikacji częściowo zaufanej domeny](#Running_code).</span><span class="sxs-lookup"><span data-stu-id="91107-116">[Running code in partially trusted application domains](#Running_code).</span></span>  
  
-   <span data-ttu-id="91107-117">[Przy użyciu anonimowo hostowane metody dynamiczne Emituj i wykonanie kodu w częściowej relacji zaufania](#Using_methods).</span><span class="sxs-lookup"><span data-stu-id="91107-117">[Using anonymously hosted dynamic methods to emit and execute code in partial trust](#Using_methods).</span></span>  
  
 <span data-ttu-id="91107-118">Aby uzyskać więcej informacji na temat emitowanie kodu w scenariuszach częściowo zaufanych, zobacz [problemy z zabezpieczeniami w emisji odbicia](../../../docs/framework/reflection-and-codedom/security-issues-in-reflection-emit.md).</span><span class="sxs-lookup"><span data-stu-id="91107-118">For more information about emitting code in partial trust scenarios, see [Security Issues in Reflection Emit](../../../docs/framework/reflection-and-codedom/security-issues-in-reflection-emit.md).</span></span>  
  
 <span data-ttu-id="91107-119">Aby uzyskać pełną listę kodem przedstawionym w tych procedurach, zobacz [przykład sekcji](#Example) na końcu tego przewodnika.</span><span class="sxs-lookup"><span data-stu-id="91107-119">For a complete listing of the code shown in these procedures, see the [Example section](#Example) at the end of this walkthrough.</span></span>  
  
<a name="Setting_up"></a>   
## <a name="setting-up-partially-trusted-locations"></a><span data-ttu-id="91107-120">Konfigurowanie częściowo zaufanych lokalizacji</span><span class="sxs-lookup"><span data-stu-id="91107-120">Setting up Partially Trusted Locations</span></span>  
 <span data-ttu-id="91107-121">Poniższe dwie procedury pokazują, jak skonfigurować lokalizacje, z których można sprawdzić kod w częściowej relacji zaufania.</span><span class="sxs-lookup"><span data-stu-id="91107-121">The following two procedures show how to set up locations from which you can test code with partial trust.</span></span>  
  
-   <span data-ttu-id="91107-122">Pierwsza procedura przedstawia sposób tworzenia domeny aplikacji w trybie piaskownicy, w którym kod jest uprawnień internetowych.</span><span class="sxs-lookup"><span data-stu-id="91107-122">The first procedure shows how to create a sandboxed application domain in which code is granted Internet permissions.</span></span>  
  
-   <span data-ttu-id="91107-123">Druga procedura przedstawia sposób dodawania <xref:System.Security.Permissions.ReflectionPermission> z <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> Flaga aplikacji częściowo zaufanej domeny, aby włączyć dostęp do danych w zestawach zaufania równa lub mniejsza.</span><span class="sxs-lookup"><span data-stu-id="91107-123">The second procedure shows how to add <xref:System.Security.Permissions.ReflectionPermission> with the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> flag to a partially trusted application domain, to enable access to private data in assemblies of equal or lesser trust.</span></span>  
  
### <a name="creating-sandboxed-application-domains"></a><span data-ttu-id="91107-124">Tworzenie domeny aplikacji w trybie piaskownicy</span><span class="sxs-lookup"><span data-stu-id="91107-124">Creating Sandboxed Application Domains</span></span>  
 <span data-ttu-id="91107-125">Aby utworzyć domenę aplikacji, w którym są uruchomione ponownie zestawy z częściowa relacja zaufania, należy podać zestaw uprawnień, aby można mu było przydzielić do zestawów przy użyciu <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> przeciążenie metody tworzenia domeny aplikacji.</span><span class="sxs-lookup"><span data-stu-id="91107-125">To create an application domain in which your assemblies run with partial trust, you must specify the set of permissions to be granted to the assemblies by using the <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> method overload to create the application domain.</span></span> <span data-ttu-id="91107-126">Najprostszym sposobem, aby określić zestaw uprawnień jest można pobrać zestawu z zasad zabezpieczeń o nazwie uprawnień.</span><span class="sxs-lookup"><span data-stu-id="91107-126">The easiest way to specify the grant set is to retrieve a named permission set from security policy.</span></span>  
  
 <span data-ttu-id="91107-127">Poniższa procedura dotyczy tworzenia domeny aplikacji w trybie piaskownicy, która uruchamia kod z częściowej relacji zaufania, aby przetestować scenariusze, w których emitowany kodu można uzyskać dostęp tylko publiczne elementy członkowskie typy publiczne.</span><span class="sxs-lookup"><span data-stu-id="91107-127">The following procedure creates a sandboxed application domain that runs your code with partial trust, to test scenarios in which emitted code can access only public members of public types.</span></span> <span data-ttu-id="91107-128">Kolejne procedury przedstawiono sposób dodawania <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess>, aby przetestować scenariusze, w których emitowany kodu można uzyskać dostępu do niepubliczne typy i składniki w zestawy, które są przyznawane uprawnienia równa lub mniejsza.</span><span class="sxs-lookup"><span data-stu-id="91107-128">A subsequent procedure shows how to add <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess>, to test scenarios in which emitted code can access nonpublic types and members in assemblies that are granted equal or lesser permissions.</span></span>  
  
##### <a name="to-create-an-application-domain-with-partial-trust"></a><span data-ttu-id="91107-129">Aby utworzyć domenę aplikacji z częściowa relacja zaufania</span><span class="sxs-lookup"><span data-stu-id="91107-129">To create an application domain with partial trust</span></span>  
  
1.  <span data-ttu-id="91107-130">Utwórz uprawnienia do zestawów w domenie aplikacji piaskownicy.</span><span class="sxs-lookup"><span data-stu-id="91107-130">Create a permission set to grant to the assemblies in the sandboxed application domain.</span></span> <span data-ttu-id="91107-131">W takim przypadku służy strefy Internetu zestaw uprawnień.</span><span class="sxs-lookup"><span data-stu-id="91107-131">In this case, the permission set of the Internet zone is used.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#2](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#2)]
     [!code-vb[HowToEmitCodeInPartialTrust#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#2)]  
  
2.  <span data-ttu-id="91107-132">Utwórz <xref:System.AppDomainSetup> obiekt do zainicjowania domeny aplikacji z ścieżkę aplikacji.</span><span class="sxs-lookup"><span data-stu-id="91107-132">Create an <xref:System.AppDomainSetup> object to initialize the application domain with an application path.</span></span>  
  
    > [!IMPORTANT]
    >  <span data-ttu-id="91107-133">Dla uproszczenia w tym przykładzie kodu używane bieżącego folderu.</span><span class="sxs-lookup"><span data-stu-id="91107-133">For simplicity, this code example uses the current folder.</span></span> <span data-ttu-id="91107-134">Aby uruchomić kod, który faktycznie pochodzą z Internetu, używać oddzielnego folderu dla niezaufanych kodu, zgodnie z opisem w [porady: uruchamianie częściowo zaufanego kodu w bibliotece](../../../docs/framework/misc/how-to-run-partially-trusted-code-in-a-sandbox.md).</span><span class="sxs-lookup"><span data-stu-id="91107-134">To run code that actually comes from the Internet, use a separate folder for the untrusted code, as described in [How to: Run Partially Trusted Code in a Sandbox](../../../docs/framework/misc/how-to-run-partially-trusted-code-in-a-sandbox.md).</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#3](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#3)]
     [!code-vb[HowToEmitCodeInPartialTrust#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#3)]  
  
3.  <span data-ttu-id="91107-135">Tworzenie domeny aplikacji, określania informacji o konfiguracji domeny aplikacji i grant dla wszystkich zestawów, które są wykonywane w domenie aplikacji.</span><span class="sxs-lookup"><span data-stu-id="91107-135">Create the application domain, specifying the application domain setup information and the grant set for all assemblies that execute in the application domain.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#5](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#5)]
     [!code-vb[HowToEmitCodeInPartialTrust#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#5)]  
  
     <span data-ttu-id="91107-136">Ostatni parametr <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> przeciążenie metody można określić zbiór zestawów, które będą mieli pełne zaufanie, zamiast zestawu domeny aplikacji.</span><span class="sxs-lookup"><span data-stu-id="91107-136">The last parameter of the <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> method overload enables you to specify a set of assemblies that are to be granted full trust, instead of the grant set of the application domain.</span></span> <span data-ttu-id="91107-137">Nie trzeba określać [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] zestawy, które Twoja aplikacja używa, ponieważ te zestawy są w globalnej pamięci podręcznej zestawów.</span><span class="sxs-lookup"><span data-stu-id="91107-137">You do not have to specify the [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] assemblies that your application uses, because those assemblies are in the global assembly cache.</span></span> <span data-ttu-id="91107-138">Zestawów w globalnej pamięci podręcznej zestawów są zawsze całkowicie zaufane.</span><span class="sxs-lookup"><span data-stu-id="91107-138">Assemblies in the global assembly cache are always fully trusted.</span></span> <span data-ttu-id="91107-139">Ten parametr umożliwia określenie zestawy o silnych nazwach, które nie znajdują się w globalnej pamięci podręcznej zestawów.</span><span class="sxs-lookup"><span data-stu-id="91107-139">You can use this parameter to specify strong-named assemblies that are not in the global assembly cache.</span></span>  
  
### <a name="adding-restrictedmemberaccess-to-sandboxed-domains"></a><span data-ttu-id="91107-140">Dodawanie RestrictedMemberAccess do domeny w trybie piaskownicy</span><span class="sxs-lookup"><span data-stu-id="91107-140">Adding RestrictedMemberAccess to Sandboxed Domains</span></span>  
 <span data-ttu-id="91107-141">Można zezwolić na obsługę aplikacji hostowanej anonimowo metody dynamicznej mają dostęp do danych w zestawach, do których poziomy zaufania równa lub mniejsza niż poziom zaufania zestawu, który emituje kod.</span><span class="sxs-lookup"><span data-stu-id="91107-141">Host applications can allow anonymously hosted dynamic methods to have access to private data in assemblies that have trust levels equal to or less than the trust level of the assembly that emits the code.</span></span> <span data-ttu-id="91107-142">Aby włączyć tę możliwość ograniczone do pominięcia just in time (JIT) widoczność kontroli, dodaje aplikacji hosta <xref:System.Security.Permissions.ReflectionPermission> obiekt z <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> flagi zestawu (autoryzacji).</span><span class="sxs-lookup"><span data-stu-id="91107-142">To enable this restricted ability to skip just-in-time (JIT) visibility checks, the host application adds a <xref:System.Security.Permissions.ReflectionPermission> object with the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> (RMA) flag to the grant set.</span></span>  
  
 <span data-ttu-id="91107-143">Na przykład host może udzielić uprawnienia Internet aplikacji internetowych oraz autoryzacji, dzięki czemu aplikacji internetowej można wyemitować kodu, który uzyskuje dostęp do danych prywatnych w ich własnych zestawach.</span><span class="sxs-lookup"><span data-stu-id="91107-143">For example, a host might grant Internet applications Internet permissions plus RMA, so that an Internet application can emit code that accesses private data in its own assemblies.</span></span> <span data-ttu-id="91107-144">Ponieważ dostęp jest ograniczony do zestawów zaufania równa lub mniejsza, aplikację internetową nie takich jak dostęp do elementów członkowskich całkowicie zaufanych zestawów [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] zestawów.</span><span class="sxs-lookup"><span data-stu-id="91107-144">Because the access is limited to assemblies of equal or lesser trust, an Internet application cannot access members of fully trusted assemblies such as [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] assemblies.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="91107-145">Aby zapobiec podniesienie uprawnień, informacje stosu dla zestawu emisji jest dołączana w przypadku zbudowanych hostowanej anonimowo metody dynamicznej.</span><span class="sxs-lookup"><span data-stu-id="91107-145">To prevent elevation of privilege, stack information for the emitting assembly is included when anonymously hosted dynamic methods are constructed.</span></span> <span data-ttu-id="91107-146">Po wywołaniu metody informacje stosu jest zaznaczone.</span><span class="sxs-lookup"><span data-stu-id="91107-146">When the method is invoked, the stack information is checked.</span></span> <span data-ttu-id="91107-147">W związku z tym hostowanej anonimowo metody dynamicznej, który jest wywoływany z całkowicie zaufanego kodu jest nadal ograniczone do poziomu zaufania emisji zestawu.</span><span class="sxs-lookup"><span data-stu-id="91107-147">Thus, an anonymously hosted dynamic method that is invoked from fully trusted code is still limited to the trust level of the emitting assembly.</span></span>  
  
##### <a name="to-create-an-application-domain-with-partial-trust-plus-rma"></a><span data-ttu-id="91107-148">Aby utworzyć domenę aplikacji z częściowa relacja zaufania oraz autoryzacji</span><span class="sxs-lookup"><span data-stu-id="91107-148">To create an application domain with partial trust plus RMA</span></span>  
  
1.  <span data-ttu-id="91107-149">Utwórz nową <xref:System.Security.Permissions.ReflectionPermission> obiekt z <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess> (autoryzacji) Flaga i użyj <xref:System.Security.PermissionSet.SetPermission%2A?displayProperty=nameWithType> metody, aby dodać uprawnienia do zestaw uprawnień.</span><span class="sxs-lookup"><span data-stu-id="91107-149">Create a new <xref:System.Security.Permissions.ReflectionPermission> object with the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess> (RMA) flag, and use the <xref:System.Security.PermissionSet.SetPermission%2A?displayProperty=nameWithType> method to add the permission to the grant set.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#7](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#7)]
     [!code-vb[HowToEmitCodeInPartialTrust#7](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#7)]  
  
     <span data-ttu-id="91107-150"><xref:System.Security.PermissionSet.AddPermission%2A> Metoda dodaje uprawnienia grant ustawić, jeśli nie jest już dołączony.</span><span class="sxs-lookup"><span data-stu-id="91107-150">The <xref:System.Security.PermissionSet.AddPermission%2A> method adds the permission to the grant set if it is not already included.</span></span> <span data-ttu-id="91107-151">Jeśli uprawnienie jest już uwzględniony w zestawie grant, określone flagi są dodawane do istniejących uprawnień.</span><span class="sxs-lookup"><span data-stu-id="91107-151">If the permission is already included in the grant set, the specified flags are added to the existing permission.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="91107-152">Autoryzacji jest funkcją hostowanej anonimowo metody dynamicznej.</span><span class="sxs-lookup"><span data-stu-id="91107-152">RMA is a feature of anonymously hosted dynamic methods.</span></span> <span data-ttu-id="91107-153">W przypadku zwykłej metod dynamicznych pominąć sprawdzanie widoczność JIT, emitowany kodu wymaga pełnego zaufania.</span><span class="sxs-lookup"><span data-stu-id="91107-153">When ordinary dynamic methods skip JIT visibility checks, the emitted code requires full trust.</span></span>  
  
2.  <span data-ttu-id="91107-154">Tworzenie domeny aplikacji, określania informacji o konfiguracji domeny aplikacji i przyznania ustawić.</span><span class="sxs-lookup"><span data-stu-id="91107-154">Create the application domain, specifying the application domain setup information and the grant set.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#8](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#8)]
     [!code-vb[HowToEmitCodeInPartialTrust#8](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#8)]  
  
<a name="Running_code"></a>   
## <a name="running-code-in-sandboxed-application-domains"></a><span data-ttu-id="91107-155">Uruchamianie kodu w trybie piaskownicy aplikacji domenach</span><span class="sxs-lookup"><span data-stu-id="91107-155">Running Code in Sandboxed Application Domains</span></span>  
 <span data-ttu-id="91107-156">W poniższej procedurze wyjaśniono, jak można zdefiniować klasę przy użyciu metod, które mogą być wykonywane w domenie aplikacji, jak można utworzyć wystąpienia klasy w domenie i jak wykonać jego metody.</span><span class="sxs-lookup"><span data-stu-id="91107-156">The following procedure explains how to define a class by using methods that can be executed in an application domain, how to create an instance of the class in the domain, and how to execute its methods.</span></span>  
  
#### <a name="to-define-and-execute-a-method-in-an-application-domain"></a><span data-ttu-id="91107-157">Aby zdefiniować i wykonania metody w domenie aplikacji</span><span class="sxs-lookup"><span data-stu-id="91107-157">To define and execute a method in an application domain</span></span>  
  
1.  <span data-ttu-id="91107-158">Definiowanie klasy, która jest pochodną <xref:System.MarshalByRefObject>.</span><span class="sxs-lookup"><span data-stu-id="91107-158">Define a class that derives from <xref:System.MarshalByRefObject>.</span></span> <span data-ttu-id="91107-159">Dzięki temu można utworzyć wystąpienia klasy w innych domenach aplikacji i do wykonywania wywołań metody poza granice domeny aplikacji.</span><span class="sxs-lookup"><span data-stu-id="91107-159">This enables you to create instances of the class in other application domains and to make method calls across application domain boundaries.</span></span> <span data-ttu-id="91107-160">Nosi nazwę klasy w tym przykładzie `Worker`.</span><span class="sxs-lookup"><span data-stu-id="91107-160">The class in this example is named `Worker`.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#10](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#10)]
     [!code-vb[HowToEmitCodeInPartialTrust#10](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#10)]  
  
2.  <span data-ttu-id="91107-161">Zdefiniuj metodę publiczną, która zawiera kod, który chcesz wykonać.</span><span class="sxs-lookup"><span data-stu-id="91107-161">Define a public method that contains the code you want to execute.</span></span> <span data-ttu-id="91107-162">W tym przykładzie kodu emituje to prosta metoda dynamicznych, tworzy delegata można wykonać metody i wywołuje delegata.</span><span class="sxs-lookup"><span data-stu-id="91107-162">In this example, the code emits a simple dynamic method, creates a delegate to execute the method, and invokes the delegate.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#11](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#11)]
     [!code-vb[HowToEmitCodeInPartialTrust#11](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#11)]  
  
3.  <span data-ttu-id="91107-163">W programie głównego ustalić nazwę wyświetlaną z zestawu.</span><span class="sxs-lookup"><span data-stu-id="91107-163">In your main program, get the display name of your assembly.</span></span> <span data-ttu-id="91107-164">Ta nazwa jest używana podczas tworzenia wystąpienia `Worker` klasy w domenie aplikacji piaskownicy.</span><span class="sxs-lookup"><span data-stu-id="91107-164">This name is used when you create instances of the `Worker` class in the sandboxed application domain.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#14](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#14)]
     [!code-vb[HowToEmitCodeInPartialTrust#14](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#14)]  
  
4.  <span data-ttu-id="91107-165">W programie głównego tworzenia domeny aplikacji w trybie piaskownicy, zgodnie z opisem w [Pierwsza procedura](#Setting_up) w tym przewodniku.</span><span class="sxs-lookup"><span data-stu-id="91107-165">In your main program, create a sandboxed application domain, as described in [the first procedure](#Setting_up) in this walkthrough.</span></span> <span data-ttu-id="91107-166">Nie masz uprawnień do dodawania `Internet` ustawić uprawnienia, ponieważ `SimpleEmitDemo` metoda używa tylko metody publiczne.</span><span class="sxs-lookup"><span data-stu-id="91107-166">You do not have to add any permissions to the `Internet` permission set, because the `SimpleEmitDemo` method uses only public methods.</span></span>  
  
5.  <span data-ttu-id="91107-167">W programie główne utworzenia wystąpienia `Worker` klasy w domenie aplikacji piaskownicy.</span><span class="sxs-lookup"><span data-stu-id="91107-167">In your main program, create an instance of the `Worker` class in the sandboxed application domain.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#12](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#12)]
     [!code-vb[HowToEmitCodeInPartialTrust#12](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#12)]  
  
     <span data-ttu-id="91107-168"><xref:System.AppDomain.CreateInstanceAndUnwrap%2A> Metoda tworzy obiekt w docelowej domenie aplikacji i zwraca serwera proxy, który może służyć do wywołania, właściwości i metody obiektu.</span><span class="sxs-lookup"><span data-stu-id="91107-168">The <xref:System.AppDomain.CreateInstanceAndUnwrap%2A> method creates the object in the target application domain and returns a proxy that can be used to call the properties and methods of the object.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="91107-169">Jeśli używasz tego kodu w [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], należy zmienić nazwę klasy, aby uwzględnić przestrzeni nazw.</span><span class="sxs-lookup"><span data-stu-id="91107-169">If you use this code in [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], you must change the name of the class to include the namespace.</span></span> <span data-ttu-id="91107-170">Domyślnie przestrzeń nazw jest nazwa projektu.</span><span class="sxs-lookup"><span data-stu-id="91107-170">By default, the namespace is the name of the project.</span></span> <span data-ttu-id="91107-171">Na przykład jeśli projekt jest "PartialTrust", nazwa klasy musi być "PartialTrust.Worker".</span><span class="sxs-lookup"><span data-stu-id="91107-171">For example, if the project is "PartialTrust", the class name must be "PartialTrust.Worker".</span></span>  
  
6.  <span data-ttu-id="91107-172">Dodaj kod, aby wywołać `SimpleEmitDemo` metody.</span><span class="sxs-lookup"><span data-stu-id="91107-172">Add code to call the `SimpleEmitDemo` method.</span></span> <span data-ttu-id="91107-173">Wywołanie jest organizowanego między granicami domeny aplikacji i kod jest wykonywany w domenie aplikacji piaskownicy.</span><span class="sxs-lookup"><span data-stu-id="91107-173">The call is marshaled across the application domain boundary, and the code is executed in the sandboxed application domain.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#13](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#13)]
     [!code-vb[HowToEmitCodeInPartialTrust#13](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#13)]  
  
<a name="Using_methods"></a>   
## <a name="using-anonymously-hosted-dynamic-methods"></a><span data-ttu-id="91107-174">Przy użyciu anonimowo hostowane metody dynamiczne</span><span class="sxs-lookup"><span data-stu-id="91107-174">Using Anonymously Hosted Dynamic Methods</span></span>  
 <span data-ttu-id="91107-175">Hostowanej anonimowo metody dynamicznej są skojarzone z przezroczystym zestawu, który jest udostępniany przez system.</span><span class="sxs-lookup"><span data-stu-id="91107-175">Anonymously hosted dynamic methods are associated with a transparent assembly that is provided by the system.</span></span> <span data-ttu-id="91107-176">W związku z tym kodu, które zawierają jest niewidoczny.</span><span class="sxs-lookup"><span data-stu-id="91107-176">Therefore, the code they contain is transparent.</span></span> <span data-ttu-id="91107-177">Zwykłe metody dynamiczne, z drugiej strony, musi być skojarzony z istniejący moduł (na bezpośrednio określony lub wywnioskować na podstawie skojarzonego typu) i wykonać ich poziom zabezpieczeń z tego modułu.</span><span class="sxs-lookup"><span data-stu-id="91107-177">Ordinary dynamic methods, on the other hand, must be associated with an existing module (whether directly specified or inferred from an associated type), and take their security level from that module.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="91107-178">Jedynym sposobem, aby skojarzyć dynamiczne — metoda z zestawu, który udostępnia hosting anonimowego jest użyj konstruktorów, które zostały opisane w poniższej procedurze.</span><span class="sxs-lookup"><span data-stu-id="91107-178">The only way to associate a dynamic method with the assembly that provides anonymous hosting is to use the constructors that are described in the following procedure.</span></span> <span data-ttu-id="91107-179">Nie można jawnie określić moduł w zestawie hostingu anonimowe.</span><span class="sxs-lookup"><span data-stu-id="91107-179">You cannot explicitly specify a module in the anonymous hosting assembly.</span></span>  
  
 <span data-ttu-id="91107-180">Zwykłe metod dynamicznych ma dostęp do wewnętrznych elementów członkowskich moduł, który skojarzonych z nimi, lub prywatne elementy członkowskie tego typu, które są skojarzone.</span><span class="sxs-lookup"><span data-stu-id="91107-180">Ordinary dynamic methods have access to the internal members of the module they are associated with, or to the private members of the type they are associated with.</span></span> <span data-ttu-id="91107-181">Ponieważ hostowanej anonimowo metody dynamicznej są odizolowane od innego kodu, nie mają dostępu do danych.</span><span class="sxs-lookup"><span data-stu-id="91107-181">Because anonymously hosted dynamic methods are isolated from other code, they do not have access to private data.</span></span> <span data-ttu-id="91107-182">Jednak mają ograniczone możliwości Aby pominąć sprawdzanie widoczność JIT do uzyskania dostępu do danych.</span><span class="sxs-lookup"><span data-stu-id="91107-182">However, they do have a restricted ability to skip JIT visibility checks to gain access to private data.</span></span> <span data-ttu-id="91107-183">Ta możliwość jest ograniczona do zestawów, które mają poziomy zaufania równa lub mniejsza niż poziom zaufania zestawu, który emituje kod.</span><span class="sxs-lookup"><span data-stu-id="91107-183">This ability is limited to assemblies that have trust levels equal to or less than the trust level of the assembly that emits the code.</span></span>  
  
 <span data-ttu-id="91107-184">Aby zapobiec podniesienie uprawnień, informacje stosu dla zestawu emisji jest dołączana w przypadku zbudowanych hostowanej anonimowo metody dynamicznej.</span><span class="sxs-lookup"><span data-stu-id="91107-184">To prevent elevation of privilege, stack information for the emitting assembly is included when anonymously hosted dynamic methods are constructed.</span></span> <span data-ttu-id="91107-185">Po wywołaniu metody informacje stosu jest zaznaczone.</span><span class="sxs-lookup"><span data-stu-id="91107-185">When the method is invoked, the stack information is checked.</span></span> <span data-ttu-id="91107-186">Hostowanej anonimowo metody dynamicznej, który jest wywoływany z całkowicie zaufanego kodu jest nadal ograniczone do zestawu, który go wysyłanego poziom zaufania.</span><span class="sxs-lookup"><span data-stu-id="91107-186">An anonymously hosted dynamic method that is invoked from fully trusted code is still limited to the trust level of the assembly that emitted it.</span></span>  
  
#### <a name="to-use-anonymously-hosted-dynamic-methods"></a><span data-ttu-id="91107-187">Aby użyć anonimowo hostowane metody dynamiczne</span><span class="sxs-lookup"><span data-stu-id="91107-187">To use anonymously hosted dynamic methods</span></span>  
  
-   <span data-ttu-id="91107-188">Tworzenie hostowanej anonimowo metody dynamicznej za pomocą konstruktora, który nie określa skojarzone modułu lub typu.</span><span class="sxs-lookup"><span data-stu-id="91107-188">Create an anonymously hosted dynamic method by using a constructor that does not specify an associated module or type.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#15](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#15)]
     [!code-vb[HowToEmitCodeInPartialTrust#15](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#15)]  
  
     <span data-ttu-id="91107-189">Jeśli hostowanej anonimowo metody dynamicznej używane są tylko typy publiczne i metody, nie wymaga dostępu do elementu członkowskiego ograniczonym i nie ma pomijania sprawdzania widoczność JIT.</span><span class="sxs-lookup"><span data-stu-id="91107-189">If an anonymously hosted dynamic method uses only public types and methods, it does not require restricted member access and does not have to skip JIT visibility checks.</span></span>  
  
     <span data-ttu-id="91107-190">Żadne specjalne uprawnienia są wymagane do emisji dynamicznego metody, ale emitowany kod wymaga uprawnienia, które są wymagane przez typy i metody, które są używane.</span><span class="sxs-lookup"><span data-stu-id="91107-190">No special permissions are required to emit a dynamic method, but the emitted code requires the permissions that are demanded by the types and methods it uses.</span></span> <span data-ttu-id="91107-191">Na przykład, jeśli emitowany kod wywołuje metodę, która uzyskuje dostęp do pliku, wymaga <xref:System.Security.Permissions.FileIOPermission>.</span><span class="sxs-lookup"><span data-stu-id="91107-191">For example, if the emitted code calls a method that accesses a file, it requires <xref:System.Security.Permissions.FileIOPermission>.</span></span> <span data-ttu-id="91107-192">Jeśli poziom zaufania nie ma te uprawnienia, wyjątek zabezpieczeń jest generowany po emitowany kod jest wykonywany.</span><span class="sxs-lookup"><span data-stu-id="91107-192">If the trust level does not include that permission, a security exception is thrown when the emitted code is executed.</span></span> <span data-ttu-id="91107-193">Dynamiczne metody, która używa tylko emituje kod pokazane <xref:System.Console.WriteLine%2A?displayProperty=nameWithType> metody.</span><span class="sxs-lookup"><span data-stu-id="91107-193">The code shown here emits a dynamic method that uses only the <xref:System.Console.WriteLine%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="91107-194">W związku z tym można wykonać kod z częściowo zaufanych lokalizacji.</span><span class="sxs-lookup"><span data-stu-id="91107-194">Therefore, the code can be executed from partially trusted locations.</span></span>  
  
-   <span data-ttu-id="91107-195">Można również utworzyć hostowanej anonimowo metody dynamicznej z ograniczeniami możliwość pominąć sprawdzanie widoczność JIT, za pomocą <xref:System.Reflection.Emit.DynamicMethod.%23ctor%28System.String%2CSystem.Type%2CSystem.Type%5B%5D%2CSystem.Boolean%29> Konstruktor i określanie `true` dla `restrictedSkipVisibility` parametru.</span><span class="sxs-lookup"><span data-stu-id="91107-195">Alternatively, create an anonymously hosted dynamic method with restricted ability to skip JIT visibility checks, by using the <xref:System.Reflection.Emit.DynamicMethod.%23ctor%28System.String%2CSystem.Type%2CSystem.Type%5B%5D%2CSystem.Boolean%29> constructor and specifying `true` for the `restrictedSkipVisibility` parameter.</span></span>  
  
     [!code-csharp[HowToEmitCodeInPartialTrust#16](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#16)]
     [!code-vb[HowToEmitCodeInPartialTrust#16](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#16)]  
  
     <span data-ttu-id="91107-196">Ograniczenie to, że hostowanej anonimowo metody dynamicznej mają dostęp do danych prywatnych tylko w zestawach z poziomami zaufania równa lub mniejsza niż poziom zaufania emisji zestawu.</span><span class="sxs-lookup"><span data-stu-id="91107-196">The restriction is that the anonymously hosted dynamic method can access private data only in assemblies with trust levels equal to or less than the trust level of the emitting assembly.</span></span> <span data-ttu-id="91107-197">Na przykład, jeśli wykonanie metody dynamicznej z Internetu zaufania, można uzyskać dostępu do danych prywatnych w innych zestawów, które także są wykonywane z zaufaniem Internet, ale nie ma dostępu do danych prywatnych od [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] zestawów.</span><span class="sxs-lookup"><span data-stu-id="91107-197">For example, if the dynamic method is executing with Internet trust, it can access private data in other assemblies that are also executing with Internet trust, but it cannot access private data of [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] assemblies.</span></span> [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)]<span data-ttu-id="91107-198">zestawy są zainstalowane w globalnej pamięci podręcznej zestawów i są zawsze w pełni zaufany.</span><span class="sxs-lookup"><span data-stu-id="91107-198"> assemblies are installed in the global assembly cache and are always fully trusted.</span></span>  
  
     <span data-ttu-id="91107-199">Hostowanej anonimowo metody dynamicznej można pominąć JIT widoczność kontroli tylko wtedy, gdy aplikacja hosta udziela za pomocą tej funkcji ograniczeniami <xref:System.Security.Permissions.ReflectionPermission> z <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> flagi.</span><span class="sxs-lookup"><span data-stu-id="91107-199">Anonymously hosted dynamic methods can use this restricted ability to skip JIT visibility checks only if the host application grants <xref:System.Security.Permissions.ReflectionPermission> with the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> flag.</span></span> <span data-ttu-id="91107-200">Żądanie w celu uzyskania tego uprawnienia następuje po wywołaniu metody.</span><span class="sxs-lookup"><span data-stu-id="91107-200">The demand for this permission is made when the method is invoked.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="91107-201">Informacje stosu wywołań dla zestawu emisji jest dołączana w przypadku metody dynamicznej jest tworzony.</span><span class="sxs-lookup"><span data-stu-id="91107-201">Call stack information for the emitting assembly is included when the dynamic method is constructed.</span></span> <span data-ttu-id="91107-202">W związku z tym żądanie jest wykonywana przed uprawnienia emisji zestawu zamiast zestawu, który wywołuje metodę.</span><span class="sxs-lookup"><span data-stu-id="91107-202">Therefore, the demand is made against the permissions of the emitting assembly instead of the assembly that invokes the method.</span></span> <span data-ttu-id="91107-203">Uniemożliwia to emitowany kod wykonywany z podwyższonym poziomem uprawnień.</span><span class="sxs-lookup"><span data-stu-id="91107-203">This prevents the emitted code from being executed with elevated permissions.</span></span>  
  
     <span data-ttu-id="91107-204">[Pełny przykład kodu](#Example) na końcu tego przewodnika przedstawia użycie i ograniczenia dostępu do elementu członkowskiego ograniczone.</span><span class="sxs-lookup"><span data-stu-id="91107-204">The [complete code example](#Example) at the end of this walkthrough demonstrates the use and limitations of restricted member access.</span></span> <span data-ttu-id="91107-205">Jego `Worker` klasa zawiera metodę, którą może utworzyć hostowanej anonimowo metody dynamicznej z lub bez ograniczone możliwości pominąć sprawdzanie widoczność i przykładzie wynik wykonania tej metody w domenach aplikacji, które mają różne poziomy zaufania.</span><span class="sxs-lookup"><span data-stu-id="91107-205">Its `Worker` class includes a method that can create anonymously hosted dynamic methods with or without the restricted ability to skip visibility checks, and the example shows the result of executing this method in application domains that have different trust levels.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="91107-206">Ograniczona możliwość pominąć sprawdzanie widoczność jest funkcją hostowanej anonimowo metody dynamicznej.</span><span class="sxs-lookup"><span data-stu-id="91107-206">The restricted ability to skip visibility checks is a feature of anonymously hosted dynamic methods.</span></span> <span data-ttu-id="91107-207">W przypadku zwykłej metod dynamicznych pominąć sprawdzanie widoczność JIT, ich musi mieć przyznane pełne zaufanie.</span><span class="sxs-lookup"><span data-stu-id="91107-207">When ordinary dynamic methods skip JIT visibility checks, they must be granted full trust.</span></span>  
  
<a name="Example"></a>   
## <a name="example"></a><span data-ttu-id="91107-208">Przykład</span><span class="sxs-lookup"><span data-stu-id="91107-208">Example</span></span>  
  
### <a name="description"></a><span data-ttu-id="91107-209">Opis</span><span class="sxs-lookup"><span data-stu-id="91107-209">Description</span></span>  
 <span data-ttu-id="91107-210">Poniższy przykład kodu pokazuje użycie <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess> flagę anonimowo hostowane metody dynamiczne, aby pominąć sprawdzanie widoczność JIT, ale tylko wtedy, gdy element docelowy jest na poziomie zaufania niż zestaw, który emituje kod równa lub mniejsza.</span><span class="sxs-lookup"><span data-stu-id="91107-210">The following code example demonstrates the use of the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess> flag to allow anonymously hosted dynamic methods to skip JIT visibility checks, but only when the target member is at an equal or lower level of trust than the assembly that emits the code.</span></span>  
  
 <span data-ttu-id="91107-211">W przykładzie zdefiniowano `Worker` klasy, które mogą być przekazywane między granicami domeny aplikacji.</span><span class="sxs-lookup"><span data-stu-id="91107-211">The example defines a `Worker` class that can be marshaled across application domain boundaries.</span></span> <span data-ttu-id="91107-212">Klasa ma dwa `AccessPrivateMethod` przeciążenia metody, które Emituj i wykonywanie metod dynamicznych.</span><span class="sxs-lookup"><span data-stu-id="91107-212">The class has two `AccessPrivateMethod` method overloads that emit and execute dynamic methods.</span></span> <span data-ttu-id="91107-213">Pierwszy przeciążenia emituje dynamiczne metodę, która wywołuje prywatna `PrivateMethod` metody `Worker` klasy i może emitować metody dynamicznej z lub bez kontroli widoczność JIT.</span><span class="sxs-lookup"><span data-stu-id="91107-213">The first overload emits a dynamic method that calls the private `PrivateMethod` method of the `Worker` class, and it can emit the dynamic method with or without JIT visibility checks.</span></span> <span data-ttu-id="91107-214">Drugi przeciążenia emituje dynamiczne metodę, która uzyskuje dostęp do `internal` właściwości (`Friend` właściwość w języku Visual Basic) z <xref:System.String> klasy.</span><span class="sxs-lookup"><span data-stu-id="91107-214">The second overload emits a dynamic method that accesses an `internal` property (`Friend` property in Visual Basic) of the <xref:System.String> class.</span></span>  
  
 <span data-ttu-id="91107-215">W przykładzie użyto metody pomocniczej, aby utworzyć zestaw ograniczone do uprawnień `Internet` uprawnienia, a następnie tworzy domenę aplikacji przy użyciu <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> przeciążenie metody, aby określić, że cały kod, który wykonuje w domenie korzysta z tego zestawu.</span><span class="sxs-lookup"><span data-stu-id="91107-215">The example uses a helper method to create a grant set limited to `Internet` permissions, and then creates an application domain, using the <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> method overload to specify that all code that executes in the domain uses this grant set.</span></span> <span data-ttu-id="91107-216">W przykładzie jest tworzony wystąpienia `Worker` klasy w domenie aplikacji, a następnie wykonuje `AccessPrivateMethod` metody dwa razy.</span><span class="sxs-lookup"><span data-stu-id="91107-216">The example creates an instance of the `Worker` class in the application domain, and executes the `AccessPrivateMethod` method two times.</span></span>  
  
-   <span data-ttu-id="91107-217">Po raz pierwszy `AccessPrivateMethod` metoda jest wykonywana, JIT widoczność kontroli są wymuszane.</span><span class="sxs-lookup"><span data-stu-id="91107-217">The first time the `AccessPrivateMethod` method is executed, JIT visibility checks are enforced.</span></span> <span data-ttu-id="91107-218">Metody dynamicznej kończy się niepowodzeniem podczas jest wywoływana, ponieważ kontroli widoczność JIT uniemożliwić dostęp do metody prywatnej.</span><span class="sxs-lookup"><span data-stu-id="91107-218">The dynamic method fails when it is invoked, because JIT visibility checks prevent it from accessing the private method.</span></span>  
  
-   <span data-ttu-id="91107-219">Po raz drugi `AccessPrivateMethod` metoda jest wykonywana, są pomijane sprawdzanie widoczność JIT.</span><span class="sxs-lookup"><span data-stu-id="91107-219">The second time the `AccessPrivateMethod` method is executed, JIT visibility checks are skipped.</span></span> <span data-ttu-id="91107-220">Metody dynamicznej nie działa, gdy jest on skompilowany, ponieważ `Internet` przyznać zestawu nie powoduje przyznania wystarczających uprawnień, aby pominąć sprawdzanie widoczności.</span><span class="sxs-lookup"><span data-stu-id="91107-220">The dynamic method fails when it is compiled, because the `Internet` grant set does not grant sufficient permissions to skip visibility checks.</span></span>  
  
 <span data-ttu-id="91107-221">W przykładzie dodano <xref:System.Security.Permissions.ReflectionPermission> z <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> udzielania ustawić.</span><span class="sxs-lookup"><span data-stu-id="91107-221">The example adds <xref:System.Security.Permissions.ReflectionPermission> with <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> to the grant set.</span></span> <span data-ttu-id="91107-222">Tworzona jest następnie druga domena, określający, że cały kod, który jest wykonywany w domenie otrzymuje uprawnienia w nowym zestawie grant.</span><span class="sxs-lookup"><span data-stu-id="91107-222">The example then creates a second domain, specifying that all code that executes in the domain is granted the permissions in the new grant set.</span></span> <span data-ttu-id="91107-223">W przykładzie jest tworzony wystąpienia `Worker` klasy w nowej domenie aplikacji, a następnie wykonuje zarówno przeciążeń `AccessPrivateMethod` metody.</span><span class="sxs-lookup"><span data-stu-id="91107-223">The example creates an instance of the `Worker` class in the new application domain, and executes both overloads of the `AccessPrivateMethod` method.</span></span>  
  
-   <span data-ttu-id="91107-224">Pierwszy przeciążenia `AccessPrivateMethod` metoda jest wykonywana i widoczności JIT sprawdza są pomijane.</span><span class="sxs-lookup"><span data-stu-id="91107-224">The first overload of the `AccessPrivateMethod` method is executed, and JIT visibility checks are skipped.</span></span> <span data-ttu-id="91107-225">Metody dynamicznej kompiluje i wykonuje pomyślnie, ponieważ zestaw, który emituje kod jest taka sama jak zestaw zawierający Metoda prywatna.</span><span class="sxs-lookup"><span data-stu-id="91107-225">The dynamic method compiles and executes successfully, because the assembly that emits the code is the same as the assembly that contains the private method.</span></span> <span data-ttu-id="91107-226">W związku z tym poziomy zaufania są takie same.</span><span class="sxs-lookup"><span data-stu-id="91107-226">Therefore, the trust levels are equal.</span></span> <span data-ttu-id="91107-227">Jeśli aplikacja zawiera `Worker` klasa ma kilka zestawów, ten sam proces powiedzie się dla każdego z tych zestawów, ponieważ wszystkie się na tym samym poziomie zaufania.</span><span class="sxs-lookup"><span data-stu-id="91107-227">If the application that contains the `Worker` class had several assemblies, the same process would succeed for any one of those assemblies, because they would all be at the same trust level.</span></span>  
  
-   <span data-ttu-id="91107-228">Drugi przeciążenia `AccessPrivateMethod` metoda jest wykonywana, a następnie ponownie widoczność JIT sprawdza są pomijane.</span><span class="sxs-lookup"><span data-stu-id="91107-228">The second overload of the `AccessPrivateMethod` method is executed, and again JIT visibility checks are skipped.</span></span> <span data-ttu-id="91107-229">Teraz metody dynamicznej nie powiedzie się, gdy jest on skompilowany, ponieważ próbuje uzyskać dostęp `internal` `FirstChar` właściwość <xref:System.String> klasy.</span><span class="sxs-lookup"><span data-stu-id="91107-229">This time the dynamic method fails when it is compiled, because it tries to access the `internal` `FirstChar` property of the <xref:System.String> class.</span></span> <span data-ttu-id="91107-230">Zestaw zawierający <xref:System.String> klasy jest w pełni zaufany.</span><span class="sxs-lookup"><span data-stu-id="91107-230">The assembly that contains the <xref:System.String> class is fully trusted.</span></span> <span data-ttu-id="91107-231">W związku z tym jest na wyższym poziomie zaufania niż zestaw, który emituje kod.</span><span class="sxs-lookup"><span data-stu-id="91107-231">Therefore, it is at a higher level of trust than the assembly that emits the code.</span></span>  
  
 <span data-ttu-id="91107-232">To porównanie pokazuje sposób <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> umożliwia częściowo zaufany kod, aby pominąć widoczność sprawdza, czy inne częściowo zaufanego kodu bez uszczerbku dla bezpieczeństwa zaufanego kodu.</span><span class="sxs-lookup"><span data-stu-id="91107-232">This comparison shows how <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> enables partially trusted code to skip visibility checks for other partially trusted code without compromising the security of trusted code.</span></span>  
  
### <a name="code"></a><span data-ttu-id="91107-233">Kod</span><span class="sxs-lookup"><span data-stu-id="91107-233">Code</span></span>  
 [!code-csharp[HowToEmitCodeInPartialTrust#1](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#1)]
 [!code-vb[HowToEmitCodeInPartialTrust#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#1)]  
  
## <a name="compiling-the-code"></a><span data-ttu-id="91107-234">Kompilowanie kodu</span><span class="sxs-lookup"><span data-stu-id="91107-234">Compiling the Code</span></span>  
  
-   <span data-ttu-id="91107-235">W przypadku tworzenia tym przykładzie kodu [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], należy zmienić nazwę klasy do dołączenia przestrzeni nazw, gdy przekaż go do <xref:System.AppDomain.CreateInstanceAndUnwrap%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="91107-235">If you build this code example in [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], you must change the name of the class to include the namespace when you pass it to the <xref:System.AppDomain.CreateInstanceAndUnwrap%2A> method.</span></span> <span data-ttu-id="91107-236">Domyślnie przestrzeń nazw jest nazwa projektu.</span><span class="sxs-lookup"><span data-stu-id="91107-236">By default, the namespace is the name of the project.</span></span> <span data-ttu-id="91107-237">Na przykład jeśli projekt jest "PartialTrust", nazwa klasy musi być "PartialTrust.Worker".</span><span class="sxs-lookup"><span data-stu-id="91107-237">For example, if the project is "PartialTrust", the class name must be "PartialTrust.Worker".</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="91107-238">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="91107-238">See Also</span></span>  
 [<span data-ttu-id="91107-239">Problemy związane z zabezpieczeniami w emisji odbicia</span><span class="sxs-lookup"><span data-stu-id="91107-239">Security Issues in Reflection Emit</span></span>](../../../docs/framework/reflection-and-codedom/security-issues-in-reflection-emit.md)  
 [<span data-ttu-id="91107-240">Porady: uruchamianie częściowo zaufanego kodu w bibliotece</span><span class="sxs-lookup"><span data-stu-id="91107-240">How to: Run Partially Trusted Code in a Sandbox</span></span>](../../../docs/framework/misc/how-to-run-partially-trusted-code-in-a-sandbox.md)
