---
title: Zestawy kolekcjonowane dla dynamicznego generowania typów
description: Rozpocznij pracę z zestawami kolekcjonowanymi dla dynamicznego generowania typów w programie .NET. Przeczytaj informacje o okresach istnienia zestawów i ograniczeniach.
ms.date: 08/29/2017
helpviewer_keywords:
- reflection, dynamic assembly
- assemblies, collectible
- collectible assemblies, retrieving
ms.openlocfilehash: 4981b93dbd49a6da96740bebed0f2ed7b89036c8
ms.sourcegitcommit: cf5a800a33de64d0aad6d115ffcc935f32375164
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 07/20/2020
ms.locfileid: "86475128"
---
# <a name="collectible-assemblies-for-dynamic-type-generation"></a><span data-ttu-id="c9b25-104">Zestawy kolekcjonowane dla dynamicznego generowania typów</span><span class="sxs-lookup"><span data-stu-id="c9b25-104">Collectible assemblies for dynamic type generation</span></span>

<span data-ttu-id="c9b25-105">*Zestawy kolekcjonowane* to zestawy dynamiczne, które można zwolnić bez zwalniania domeny aplikacji, w której zostały utworzone.</span><span class="sxs-lookup"><span data-stu-id="c9b25-105">*Collectible assemblies* are dynamic assemblies that can be unloaded without unloading the application domain in which they were created.</span></span> <span data-ttu-id="c9b25-106">Cała zarządzana i niezarządzana pamięć używana przez zestaw kolekcjonowany i typy, które zawiera, można odzyskiwać.</span><span class="sxs-lookup"><span data-stu-id="c9b25-106">All managed and unmanaged memory used by a collectible assembly and the types it contains can be reclaimed.</span></span> <span data-ttu-id="c9b25-107">Informacje, takie jak nazwa zestawu, są usuwane z tabel wewnętrznych.</span><span class="sxs-lookup"><span data-stu-id="c9b25-107">Information such as the assembly name is removed from internal tables.</span></span>

<span data-ttu-id="c9b25-108">Aby włączyć zwalnianie, użyj <xref:System.Reflection.Emit.AssemblyBuilderAccess.RunAndCollect?displayProperty=nameWithType> flagi podczas tworzenia zestawu dynamicznego.</span><span class="sxs-lookup"><span data-stu-id="c9b25-108">To enable unloading, use the <xref:System.Reflection.Emit.AssemblyBuilderAccess.RunAndCollect?displayProperty=nameWithType> flag when you create a dynamic assembly.</span></span> <span data-ttu-id="c9b25-109">Zestaw jest przejściowy (oznacza to, że nie można go zapisać) i podlega ograniczeniom opisanym w sekcji [ograniczenia dotyczące zestawów kolekcjonowanych](#restrictions-on-collectible-assemblies) .</span><span class="sxs-lookup"><span data-stu-id="c9b25-109">The assembly is transient (that is, it cannot be saved) and is subject to limitations described in the [Restrictions on Collectible Assemblies](#restrictions-on-collectible-assemblies) section.</span></span> <span data-ttu-id="c9b25-110">Środowisko uruchomieniowe języka wspólnego (CLR) zwalnia zestaw kolekcjonowany automatycznie po zwolnieniu wszystkich obiektów skojarzonych z zestawem.</span><span class="sxs-lookup"><span data-stu-id="c9b25-110">The common language runtime (CLR) unloads a collectible assembly automatically when you release all objects associated with the assembly.</span></span> <span data-ttu-id="c9b25-111">We wszystkich innych aspektach zestawy kolekcjonowane są tworzone i używane w taki sam sposób jak inne zestawy dynamiczne.</span><span class="sxs-lookup"><span data-stu-id="c9b25-111">In all other respects, collectible assemblies are created and used in the same way as other dynamic assemblies.</span></span>

## <a name="lifetime-of-collectible-assemblies"></a><span data-ttu-id="c9b25-112">Okres istnienia zestawów kolekcjonowanych</span><span class="sxs-lookup"><span data-stu-id="c9b25-112">Lifetime of collectible assemblies</span></span>

<span data-ttu-id="c9b25-113">Okres istnienia zestawu kolekcjonowanego jest kontrolowany przez istnienie odwołań do typów, które zawiera, oraz obiektów, które są tworzone na podstawie tych typów.</span><span class="sxs-lookup"><span data-stu-id="c9b25-113">The lifetime of a collectible assembly is controlled by the existence of references to the types it contains and the objects that are created from those types.</span></span> <span data-ttu-id="c9b25-114">Środowisko uruchomieniowe języka wspólnego nie zwalnia zestawu, tak długo, jak istnieje co najmniej jeden z następujących elementów ( `T` jest dowolnym typem zdefiniowanym w zestawie):</span><span class="sxs-lookup"><span data-stu-id="c9b25-114">The common language runtime does not unload an assembly as long as one or more of the following exist (`T` is any type that is defined in the assembly):</span></span>

- <span data-ttu-id="c9b25-115">Wystąpienie elementu `T`.</span><span class="sxs-lookup"><span data-stu-id="c9b25-115">An instance of `T`.</span></span>

- <span data-ttu-id="c9b25-116">Wystąpienie tablicy `T` .</span><span class="sxs-lookup"><span data-stu-id="c9b25-116">An instance of an array of `T`.</span></span>

- <span data-ttu-id="c9b25-117">Wystąpienie typu ogólnego, który ma `T` jeden z argumentów typu.</span><span class="sxs-lookup"><span data-stu-id="c9b25-117">An instance of a generic type that has `T` as one of its type arguments.</span></span> <span data-ttu-id="c9b25-118">Obejmuje to ogólne kolekcje `T` , nawet jeśli ta kolekcja jest pusta.</span><span class="sxs-lookup"><span data-stu-id="c9b25-118">This includes generic collections of `T`, even if that collection is empty.</span></span>

- <span data-ttu-id="c9b25-119">Wystąpienie <xref:System.Type> lub <xref:System.Reflection.Emit.TypeBuilder> reprezentujące `T` .</span><span class="sxs-lookup"><span data-stu-id="c9b25-119">An instance of <xref:System.Type> or <xref:System.Reflection.Emit.TypeBuilder> that represents `T`.</span></span>

   > [!IMPORTANT]
   > <span data-ttu-id="c9b25-120">Należy zwolnić wszystkie obiekty, które reprezentują części zestawu.</span><span class="sxs-lookup"><span data-stu-id="c9b25-120">You must release all objects that represent parts of the assembly.</span></span> <span data-ttu-id="c9b25-121"><xref:System.Reflection.Emit.ModuleBuilder>Definiuje, że `T` utrzymuje odwołanie do <xref:System.Reflection.Emit.TypeBuilder> , a <xref:System.Reflection.Emit.AssemblyBuilder> obiekt zachowuje odwołanie do <xref:System.Reflection.Emit.ModuleBuilder> , więc odwołania do tych obiektów muszą zostać wydane.</span><span class="sxs-lookup"><span data-stu-id="c9b25-121">The <xref:System.Reflection.Emit.ModuleBuilder> that defines `T` keeps a reference to the <xref:System.Reflection.Emit.TypeBuilder>, and the <xref:System.Reflection.Emit.AssemblyBuilder> object keeps a reference to the <xref:System.Reflection.Emit.ModuleBuilder>, so references to these objects must be released.</span></span> <span data-ttu-id="c9b25-122">Nawet istnienie <xref:System.Reflection.Emit.LocalBuilder> lub <xref:System.Reflection.Emit.ILGenerator> użycie w konstrukcji `T` zapobiega wyładowaniu.</span><span class="sxs-lookup"><span data-stu-id="c9b25-122">Even the existence of a <xref:System.Reflection.Emit.LocalBuilder> or an <xref:System.Reflection.Emit.ILGenerator> used in the construction of `T` prevents unloading.</span></span>

- <span data-ttu-id="c9b25-123">Statyczne odwołanie do `T` przez inny dynamicznie zdefiniowany typ `T1` , który jest nadal osiągalny przez wykonanie kodu.</span><span class="sxs-lookup"><span data-stu-id="c9b25-123">A static reference to `T` by another dynamically defined type `T1` that is still reachable by executing code.</span></span> <span data-ttu-id="c9b25-124">Na przykład, `T1` może pochodzić od `T` , lub `T` być typem parametru w metodzie `T1` .</span><span class="sxs-lookup"><span data-stu-id="c9b25-124">For example, `T1` might derive from `T`, or `T` might be the type of a parameter in a method of `T1`.</span></span>

- <span data-ttu-id="c9b25-125">Element **ByRef** do pola statycznego, do którego należy `T` .</span><span class="sxs-lookup"><span data-stu-id="c9b25-125">A **ByRef** to a static field that belongs to `T`.</span></span>

- <span data-ttu-id="c9b25-126">A <xref:System.RuntimeTypeHandle> , <xref:System.RuntimeFieldHandle> lub <xref:System.RuntimeMethodHandle> który odwołuje się do `T` lub do składnika `T` .</span><span class="sxs-lookup"><span data-stu-id="c9b25-126">A <xref:System.RuntimeTypeHandle>, <xref:System.RuntimeFieldHandle>, or <xref:System.RuntimeMethodHandle> that refers to `T` or to a component of `T`.</span></span>

- <span data-ttu-id="c9b25-127">Wystąpienie dowolnego obiektu odbicia, które może być używane pośrednio lub bezpośrednio w celu uzyskania dostępu do <xref:System.Type> obiektu, który reprezentuje `T` .</span><span class="sxs-lookup"><span data-stu-id="c9b25-127">An instance of any reflection object that could be used indirectly or directly to access the <xref:System.Type> object that represents `T`.</span></span> <span data-ttu-id="c9b25-128">Na przykład <xref:System.Type> obiekt dla można uzyskać `T` z typu tablicy, którego typem elementu jest `T` lub z typu ogólnego, który ma `T` jako argument typu.</span><span class="sxs-lookup"><span data-stu-id="c9b25-128">For example, the <xref:System.Type> object for `T` can be obtained from an array type whose element type is `T`, or from a generic type that has `T` as a type argument.</span></span>

- <span data-ttu-id="c9b25-129">Metoda `M` w stosie wywołań dowolnego wątku, gdzie `M` to metoda `T` lub metoda na poziomie modułu zdefiniowana w zestawie.</span><span class="sxs-lookup"><span data-stu-id="c9b25-129">A method `M` on the call stack of any thread, where `M` is a method of `T` or a module-level method that is defined in the assembly.</span></span>

- <span data-ttu-id="c9b25-130">Delegat do statycznej metody, która jest zdefiniowana w module zestawu.</span><span class="sxs-lookup"><span data-stu-id="c9b25-130">A delegate to a static method that is defined in a module of the assembly.</span></span>

<span data-ttu-id="c9b25-131">Jeśli istnieje tylko jeden element z tej listy tylko dla jednego typu lub jednej metody w zestawie, środowisko uruchomieniowe nie może zwolnić zestawu.</span><span class="sxs-lookup"><span data-stu-id="c9b25-131">If only one item from this list exists for only one type or one method in the assembly, the runtime cannot unload the assembly.</span></span>

> [!NOTE]
> <span data-ttu-id="c9b25-132">Środowisko uruchomieniowe nie zwalnia zestawu, dopóki nie zostaną uruchomione finalizatory dla wszystkich elementów na liście.</span><span class="sxs-lookup"><span data-stu-id="c9b25-132">The runtime does not actually unload the assembly until finalizers have run for all items in the list.</span></span>

<span data-ttu-id="c9b25-133">Dla celów śledzenia okresu istnienia, skonstruowany typ ogólny, taki jak `List<int>` (w języku C#) lub `List(Of Integer)` (w Visual Basic), który jest tworzony i używany w generacji zestawu kolekcjonowanego, jest uznawany za zdefiniowany w zestawie, który zawiera definicję typu ogólnego lub w zestawie, który zawiera definicję jednego z argumentów typu.</span><span class="sxs-lookup"><span data-stu-id="c9b25-133">For purposes of tracking lifetime, a constructed generic type such as `List<int>` (in C#) or `List(Of Integer)` (in Visual Basic) that is created and used in the generation of a collectible assembly is considered to have been defined either in the assembly that contains the generic type definition or in an assembly that contains the definition of one of its type arguments.</span></span> <span data-ttu-id="c9b25-134">Dokładny zestaw, który jest używany jest szczegółami implementacji i może ulec zmianie.</span><span class="sxs-lookup"><span data-stu-id="c9b25-134">The exact assembly that is used is an implementation detail and subject to change.</span></span>

## <a name="restrictions-on-collectible-assemblies"></a><span data-ttu-id="c9b25-135">Ograniczenia dotyczące zestawów kolekcjonowanych</span><span class="sxs-lookup"><span data-stu-id="c9b25-135">Restrictions on collectible assemblies</span></span>

<span data-ttu-id="c9b25-136">Do zestawów kolekcjonowanych dotyczą następujące ograniczenia:</span><span class="sxs-lookup"><span data-stu-id="c9b25-136">The following restrictions apply to collectible assemblies:</span></span>

- <span data-ttu-id="c9b25-137">**Odwołania statyczne** Typy w zwykłym zestawie dynamicznym nie mogą zawierać statycznych odwołań do typów, które są zdefiniowane w zestawie kolekcjonowania.</span><span class="sxs-lookup"><span data-stu-id="c9b25-137">**Static references** Types in an ordinary dynamic assembly cannot have static references to types that are defined in a collectible assembly.</span></span> <span data-ttu-id="c9b25-138">Na przykład, jeśli zdefiniujesz zwykły typ, który dziedziczy z typu w zestawie kolekcjonowanym, <xref:System.NotSupportedException> zostanie zgłoszony wyjątek.</span><span class="sxs-lookup"><span data-stu-id="c9b25-138">For example, if you define an ordinary type that inherits from a type in a collectible assembly, a <xref:System.NotSupportedException> exception is thrown.</span></span> <span data-ttu-id="c9b25-139">Typ w zestawie kolekcjonowania może mieć statyczne odwołania do typu w innym zestawie kolekcjonowanym, ale wydłuży okres istnienia przywoływanego zestawu do okresu istnienia zestawu, do którego się odwołuje.</span><span class="sxs-lookup"><span data-stu-id="c9b25-139">A type in a collectible assembly can have static references to a type in another collectible assembly, but this extends the lifetime of the referenced assembly to the lifetime of the referencing assembly.</span></span>

- <span data-ttu-id="c9b25-140">**Międzyoperacyjność modelu COM** W obrębie zestawu kolekcjonowanego nie można definiować interfejsów COM, a żadne wystąpienia typów w ramach zestawu kolekcjonowanego nie mogą być konwertowane na obiekty COM.</span><span class="sxs-lookup"><span data-stu-id="c9b25-140">**COM interop** No COM interfaces can be defined within a collectible assembly, and no instances of types within a collectible assembly can be converted into COM objects.</span></span> <span data-ttu-id="c9b25-141">Typ w zestawie kolekcjonowania nie może być obiektem, który jest wywoływany przez COM otokę (CCW) lub otokę wywoływaną przez środowisko uruchomieniowe (RCW).</span><span class="sxs-lookup"><span data-stu-id="c9b25-141">A type in a collectible assembly cannot serve as a COM callable wrapper (CCW) or runtime callable wrapper (RCW).</span></span> <span data-ttu-id="c9b25-142">Jednak typy w zestawach kolekcjonowanych mogą korzystać z obiektów, które implementują interfejsy COM.</span><span class="sxs-lookup"><span data-stu-id="c9b25-142">However, types in collectible assemblies can use objects that implement COM interfaces.</span></span>

- <span data-ttu-id="c9b25-143">**Wywołanie platformy** Metody, które mają <xref:System.Runtime.InteropServices.DllImportAttribute> atrybut nie zostaną skompilowane, gdy są zadeklarowane w zestawie kolekcjonowanym.</span><span class="sxs-lookup"><span data-stu-id="c9b25-143">**Platform invoke** Methods that have the <xref:System.Runtime.InteropServices.DllImportAttribute> attribute will not compile when they are declared in a collectible assembly.</span></span> <span data-ttu-id="c9b25-144"><xref:System.Reflection.Emit.OpCodes.Calli?displayProperty=nameWithType>Instrukcji nie można użyć w implementacji typu w zestawie kolekcjonowanym, a takie typy nie mogą być organizowane w kodzie niezarządzanym.</span><span class="sxs-lookup"><span data-stu-id="c9b25-144">The <xref:System.Reflection.Emit.OpCodes.Calli?displayProperty=nameWithType> instruction cannot be used in the implementation of a type in a collectible assembly, and such types cannot be marshaled to unmanaged code.</span></span> <span data-ttu-id="c9b25-145">Można jednak wywołać kod natywny przy użyciu punktu wejścia zadeklarowanego w niekolekcjonowanym zestawie.</span><span class="sxs-lookup"><span data-stu-id="c9b25-145">However, you can call into native code by using an entry point that is declared in a non-collectible assembly.</span></span>

- <span data-ttu-id="c9b25-146">**Kierowanie** Obiektów (w szczególności delegatów), które są zdefiniowane w zestawach kolekcjonowanych nie można zorganizować.</span><span class="sxs-lookup"><span data-stu-id="c9b25-146">**Marshaling** Objects (in particular, delegates) that are defined in collectible assemblies cannot be marshaled.</span></span> <span data-ttu-id="c9b25-147">Jest to ograniczenie dla wszystkich typów emisji przejściowych.</span><span class="sxs-lookup"><span data-stu-id="c9b25-147">This is a restriction on all transient emitted types.</span></span>

- <span data-ttu-id="c9b25-148">**Ładowanie zestawu** Emisja odbicia jest jedynym mechanizmem, który jest obsługiwany w przypadku ładowania zestawów kolekcjonowanych.</span><span class="sxs-lookup"><span data-stu-id="c9b25-148">**Assembly loading** Reflection emit is the only mechanism that is supported for loading collectible assemblies.</span></span> <span data-ttu-id="c9b25-149">Zestawy, które są ładowane przy użyciu jakiejkolwiek innej formy ładowania zestawu nie mogą zostać zwolnione.</span><span class="sxs-lookup"><span data-stu-id="c9b25-149">Assemblies that are loaded by using any other form of assembly loading cannot be unloaded.</span></span>

- <span data-ttu-id="c9b25-150">**Obiekty powiązane z kontekstem** Zmienne kontekstowe nie są obsługiwane.</span><span class="sxs-lookup"><span data-stu-id="c9b25-150">**Context-bound objects** Context-static variables are not supported.</span></span> <span data-ttu-id="c9b25-151">Nie można rozciągnąć typów w zestawie kolekcjonowania <xref:System.ContextBoundObject> .</span><span class="sxs-lookup"><span data-stu-id="c9b25-151">Types in a collectible assembly cannot extend <xref:System.ContextBoundObject>.</span></span> <span data-ttu-id="c9b25-152">Jednak kod w zestawach kolekcjonowanych może korzystać z obiektów powiązanych z kontekstem, które są zdefiniowane w innym miejscu.</span><span class="sxs-lookup"><span data-stu-id="c9b25-152">However, code in collectible assemblies can use context-bound objects that are defined elsewhere.</span></span>

- <span data-ttu-id="c9b25-153">**Dane statyczne wątku** Zmienne statyczne wątku nie są obsługiwane.</span><span class="sxs-lookup"><span data-stu-id="c9b25-153">**Thread-static data** Thread-static variables are not supported.</span></span>

## <a name="see-also"></a><span data-ttu-id="c9b25-154">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="c9b25-154">See also</span></span>

- [<span data-ttu-id="c9b25-155">Emitowanie dynamicznych metod i zestawów</span><span class="sxs-lookup"><span data-stu-id="c9b25-155">Emitting Dynamic Methods and Assemblies</span></span>](emitting-dynamic-methods-and-assemblies.md)
