---
title: Zarządzanie sesjami programu WIF
ms.date: 03/30/2017
ms.assetid: 98bce126-18a9-401b-b20d-67ee462a5f8a
author: BrucePerlerMS
ms.openlocfilehash: 980d0c6dca9b0b5fadf2d4a841e4c95a9acaff52
ms.sourcegitcommit: fb78d8abbdb87144a3872cf154930157090dd933
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 09/26/2018
ms.locfileid: "47237439"
---
# <a name="wif-session-management"></a>Zarządzanie sesjami programu WIF
Gdy klient po raz pierwszy próbuje uzyskać dostęp do chronionego zasobu, obsługiwanej przez jednostkę uzależnioną, klient muszą najpierw zostać uwierzytelnione sama usługa tokenu zabezpieczającego (STS), który jest zaufany przez jednostkę uzależnioną. Usługa STS wystawia token zabezpieczający dla klienta. Klient przedstawia ten token do jednostki uzależnionej, która udziela dostępu klienta do chronionego zasobu. Jednak nie chcesz od klienta konieczność ponownego uwierzytelnienia do usługi STS, dla każdego żądania, szczególnie w przypadku, ponieważ na tym samym komputerze lub w tej samej domeny, jednostki uzależnionej ze stron nie może jeszcze być. Zamiast tego Windows Identity Foundation (WIF) ma klienta i ustanowić sesję, w którym klient używa tokenu zabezpieczającego sesji do samodzielnego uwierzytelnienia do jednostki uzależnionej dla wszystkich żądań, po pierwszym żądaniu jednostki uzależnionej. Uzależnionej można użyć ten token zabezpieczający sesji, który jest przechowywany w pliku cookie, aby odtworzyć klienta <xref:System.Security.Claims.ClaimsPrincipal?displayProperty=nameWithType>.  
  
 Usługa STS definiuje rodzaju uwierzytelniania, klient musi podać. Klient może jednak wiele poświadczeń za pomocą których mogła uwierzytelnić się do usługi STS. Na przykład może mieć tokenu z Windows Live, nazwę użytkownika i hasło, certyfikatu i smartkey. W takiej sytuacji Usługa STS przyznaje klienta kilka tożsamości za pomocą każdej tożsamości odpowiadającej poświadczenia, które klient przedstawia. Uzależnionej można użyć co najmniej jeden z tych tożsamości, gdy decyduje, jaki poziom dostępu klienta.  
  
 <xref:System.IdentityModel.Tokens.SessionSecurityToken?displayProperty=nameWithType> Umożliwia odtworzenie klienta <xref:System.Security.Claims.ClaimsPrincipal?displayProperty=nameWithType>, który zawiera wszystkie tożsamości klienta w <xref:System.Security.Claims.ClaimsPrincipal.Identities%2A>. Każdy <xref:System.Security.Claims.ClaimsIdentity?displayProperty=nameWithType> w kolekcji zawiera bootstrap tokenów, które są skojarzone z tą tożsamością.  
  
 Jeśli token nowa sesja zostanie wyświetlone z Identyfikatorem sesji, oryginalnym tokenu sesji, <xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler?displayProperty=nameWithType> nie powoduje aktualizacji tokenu sesji w pamięci podręcznej tokenu. Należy zawsze tworzyć wystąpienie tokenu sesji przy użyciu unikalny identyfikator sesji.  
  
> [!NOTE]
>  Zgłasza Session.SecurityTokenHandler.ReadToken <xref:System.Xml.XmlException> wyjątek, jeśli otrzymuje nieprawidłowe dane wejściowe; na przykład, jeśli plik cookie zawierający tokenu sesji jest uszkodzony. Firma Microsoft zaleca przechwycić wyjątek i zapewnia zachowanie specyficzne dla aplikacji.  
  
 Jeśli chronione strony sieci Web zawiera wiele zasobów (na przykład małych obrazów), które znajdują się również w domenę chronioną, klient musi zostać ponownie uwierzytelniony się do jednostki uzależnionej można pobrać każdy z tych zasobów. Użyj tokenu uwierzytelniania sesji pozwala uniknąć konieczności uwierzytelnienia do usługi STS, dla każdego żądania, ale nadal oznacza, że pakiety są wysyłane za pośrednictwem wielu plików cookie. Można skonfigurować stronę sieci Web tak, aby istotne dane i zasoby są przechowywane w domenie chronione, podczas gdy pomocnicze elementy są przechowywane w domenie niechronionych i połączone z głównej strony sieci Web. Ponadto można ustawić ścieżki pliku cookie, aby odwoływać się tylko domenę chronioną.  
  
 Do działania w trybie odwołań, firma Microsoft zaleca zapewnienie obsługi dla <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SessionSecurityTokenCreated> zdarzenia w **global.asax.cs** plików i ustawienie **IsReferenceMode** przekazanych właściwości w tokenie <xref:System.IdentityModel.Services.SessionSecurityTokenCreatedEventArgs.SessionToken%2A> właściwości. Te aktualizacje będą upewnij się, że tokenu sesji działa w trybie odwołań dla każdego żądania jest faworytem za pośrednictwem jedynie ustawienie <xref:System.IdentityModel.Services.SessionAuthenticationModule.IsReferenceMode%2A> właściwości modułu sesji uwierzytelniania.  
  
## <a name="extensibility"></a>Rozszerzalność  
 Możesz rozszerzyć mechanizm zarządzania sesji. Jest jedną z przyczyn to poprawić wydajność. Na przykład można utworzyć procedury obsługi niestandardowych plików cookie, które przekształcają lub optymalizuje token zabezpieczający sesji między jego stan w pamięci i co jest umieszczane w pliku cookie. Aby to zrobić, można skonfigurować <xref:System.IdentityModel.Services.SessionAuthenticationModule.CookieHandler%2A?displayProperty=nameWithType> właściwość <xref:System.IdentityModel.Services.SessionAuthenticationModule?displayProperty=nameWithType> używać obsługi niestandardowych plików cookie, pochodzącą z <xref:System.IdentityModel.Services.CookieHandler?displayProperty=nameWithType>. <xref:System.IdentityModel.Services.ChunkedCookieHandler?displayProperty=nameWithType> jest domyślny program obsługi plików cookie, ponieważ pliki cookie przekracza dozwolony rozmiar dla protokołu HTTP (Hypertext Transfer); Jeśli zamiast tego użyj obsługi niestandardowych plików cookie należy zaimplementować segmentu.  
  
 Aby uzyskać więcej informacji, zobacz [ClaimsAwareWebFarm](https://go.microsoft.com/fwlink/?LinkID=248408) próbki. W tym przykładzie pokazano pamięci podręcznej sesji gotowe farmy (w przeciwieństwie do tokenreplycache) tak, aby można było używać sesje według odwołania, zamiast wymieniać dużych plików cookie. Niniejszy przykład pokazuje także łatwiejszy sposób zabezpieczania plików cookie w farmie. Pamięci podręcznej sesji jest oparte na WCF. W odniesieniu do zabezpieczania sesji w przykładzie pokazano nową funkcję w wersji WIF 4.5 przekształcenia pliku cookie oparte na MachineKey, który może być uruchomiony po prostu wklejając odpowiedni fragment kodu w pliku web.config. Przykładowe, sama jest nie "przez człowieka", ale pokazuje, co jest potrzebne do tworzenia aplikacji gotowych do farmy.
