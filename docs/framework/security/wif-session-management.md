---
title: Zarządzanie sesjami programu WIF
ms.date: 03/30/2017
ms.assetid: 98bce126-18a9-401b-b20d-67ee462a5f8a
author: BrucePerlerMS
ms.openlocfilehash: 141eda509530cab1120d519c3cbc94693ef1cc51
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/22/2019
ms.locfileid: "69946236"
---
# <a name="wif-session-management"></a>Zarządzanie sesjami programu WIF
Gdy klient próbuje uzyskać dostęp do chronionego zasobu, który jest obsługiwany przez jednostkę uzależnioną, klient musi najpierw się uwierzytelnić w usłudze tokenu zabezpieczającego (STS), która jest zaufana przez jednostkę uzależnioną. Usługa STS wystawia klientowi token zabezpieczający. Klient przedstawia ten token jednostce uzależnionej, która następnie udziela Klientowi dostępu do chronionego zasobu. Nie ma jednak potrzeby ponownego uwierzytelnienia klienta w usłudze STS dla każdego żądania, szczególnie dlatego, że może to nie być nawet na tym samym komputerze lub w tej samej domenie co Jednostka uzależniona. Zamiast tego program Windows Identity Foundation (WIF) ma klienta i jednostki uzależnionej ustanawiają sesję, w której klient używa tokenu zabezpieczeń sesji do samodzielnego uwierzytelnienia w jednostce uzależnionej dla wszystkich żądań po pierwszym żądaniu. Jednostka uzależniona może używać tego tokenu zabezpieczeń sesji, który jest przechowywany w pliku cookie, aby odtworzyć klienta <xref:System.Security.Claims.ClaimsPrincipal?displayProperty=nameWithType>.  
  
 Usługa STS definiuje, jakie uwierzytelnianie musi dostarczyć klient. Jednak klient może mieć wiele poświadczeń, z którymi może się uwierzytelnić w usłudze STS. Na przykład może mieć token z usługi Windows Live, nazwę użytkownika i hasło, certyfikat i SmartKey. W takim przypadku usługa STS przyznaje klientowi kilka tożsamości z każdą tożsamością odpowiadającą jednemu z poświadczeń prezentowanym przez klienta. Jednostka uzależniona może korzystać z jednej lub więcej z tych tożsamości, gdy decyduje o tym, jaki poziom dostępu ma udzielić klientowi.  
  
 Służy do rekonstruowania <xref:System.Security.Claims.ClaimsPrincipal?displayProperty=nameWithType>klienta programu, który zawiera wszystkie tożsamości klienta w programie <xref:System.Security.Claims.ClaimsPrincipal.Identities%2A>. <xref:System.IdentityModel.Tokens.SessionSecurityToken?displayProperty=nameWithType> Każda <xref:System.Security.Claims.ClaimsIdentity?displayProperty=nameWithType> z kolekcji zawiera tokeny ładowania początkowego skojarzone z tą tożsamością.  
  
 W przypadku wystawienia nowego tokenu sesji z identyfikatorem sesji oryginalnego tokenu sesji program <xref:System.IdentityModel.Tokens.SessionSecurityTokenHandler?displayProperty=nameWithType> nie aktualizuje tokenu sesji w pamięci podręcznej tokenów. Należy zawsze utworzyć wystąpienie tokenu sesji z unikatowym IDENTYFIKATORem sesji.  
  
> [!NOTE]
> Session. SecurityTokenHandler. ReadToken zgłasza <xref:System.Xml.XmlException> wyjątek, jeśli otrzymuje nieprawidłowe dane wejściowe; na przykład, jeśli plik cookie zawierający token sesji jest uszkodzony. Zalecamy, aby przechwytywać ten wyjątek i zapewnić zachowanie specyficzne dla aplikacji.  
  
 Jeśli chroniona Strona sieci Web zawiera wiele zasobów (takich jak małe grafiki), które są również w domenie chronionej, klient musi ponownie uwierzytelnić się w jednostce uzależnionej, aby pobrać każdy z tych zasobów. Użycie tokenu uwierzytelniania sesji pozwala uniknąć konieczności uwierzytelniania do usługi STS dla każdego żądania, ale nadal oznacza, że wiele plików cookie jest wysyłanych za pośrednictwem. Można skonfigurować stronę sieci Web tak, aby ważne dane i zasoby były przechowywane w chronionej domenie, podczas gdy elementy pomocnicze są przechowywane w niechronionej domenie i połączone z główną stroną sieci Web. Ponadto należy ustawić ścieżkę pliku cookie, aby odwoływała się tylko do chronionej domeny.  
  
 Aby działać w trybie odwołania, firma Microsoft <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SessionSecurityTokenCreated> zaleca dostarczenie obsługi zdarzenia w pliku **Global.asax.cs** i ustawienie właściwości IsReferenceMode <xref:System.IdentityModel.Services.SessionSecurityTokenCreatedEventArgs.SessionToken%2A> dla tokenu przesłanego we właściwości. Te aktualizacje zapewniają, że token sesji działa w trybie odwołania dla każdego żądania i jest preferowany tylko przez ustawienie <xref:System.IdentityModel.Services.SessionAuthenticationModule.IsReferenceMode%2A> właściwości w module uwierzytelniania sesji.  
  
## <a name="extensibility"></a>Rozszerzalność  
 Można zwiększyć mechanizm zarządzania sesją. Jedną z przyczyn tego problemu jest poprawa wydajności. Można na przykład utworzyć niestandardową obsługę plików cookie, która przekształca lub optymalizuje token zabezpieczeń sesji między jego stanem w pamięci i co prowadzi do pliku cookie. W tym celu można skonfigurować <xref:System.IdentityModel.Services.SessionAuthenticationModule.CookieHandler%2A?displayProperty=nameWithType> Właściwość <xref:System.IdentityModel.Services.SessionAuthenticationModule?displayProperty=nameWithType> do używania niestandardowego programu obsługi plików cookie, który pochodzi od <xref:System.IdentityModel.Services.CookieHandler?displayProperty=nameWithType>. <xref:System.IdentityModel.Services.ChunkedCookieHandler?displayProperty=nameWithType>jest domyślnym programem obsługi plików cookie, ponieważ pliki cookie przekraczają dozwolony rozmiar protokołu HTTP (Hypertext Transfer Protocol); Jeśli zamiast tego używasz niestandardowej obsługi plików cookie, musisz zaimplementować dzielenie.  
  
 Aby uzyskać więcej informacji, zobacz przykład [ClaimsAwareWebFarm](https://go.microsoft.com/fwlink/?LinkID=248408) . Ten przykład pokazuje pamięć podręczną sesji w farmie (w przeciwieństwie do tokenreplycache), tak aby można było używać sesji przez odwołanie zamiast wymieniać duże pliki cookie; Ten przykład pokazuje również łatwiejszy sposób zabezpieczania plików cookie w farmie. Pamięć podręczna sesji jest oparta na technologii WCF. W odniesieniu do zabezpieczania sesji przykład ilustruje nową funkcję w WIF 4,5 przekształcenia plików cookie w oparciu o MachineKey, który można aktywować, po prostu wklejając odpowiedni fragment kodu w pliku Web. config. Sam przykład nie jest "w farmie", ale pokazuje, co jest potrzebne do przygotowania farmy aplikacji.
