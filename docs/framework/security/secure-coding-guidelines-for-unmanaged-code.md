---
title: Wytyczne dotyczące bezpiecznego programowania dla niezarządzanego kodu
ms.date: 03/30/2017
helpviewer_keywords:
- code security, unmanaged code
- unmanaged code, securing
- security [.NET Framework], unmanaged code
- secure coding, unmanaged code
ms.assetid: a8d15139-d368-4c9c-a747-ba757781117c
author: mairaw
ms.author: mairaw
ms.openlocfilehash: 867157b329218b79c8cc1255b2158bbe83666531
ms.sourcegitcommit: 289e06e904b72f34ac717dbcc5074239b977e707
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 09/17/2019
ms.locfileid: "71045369"
---
# <a name="secure-coding-guidelines-for-unmanaged-code"></a><span data-ttu-id="4d549-102">Wytyczne dotyczące bezpiecznego programowania dla niezarządzanego kodu</span><span class="sxs-lookup"><span data-stu-id="4d549-102">Secure Coding Guidelines for Unmanaged Code</span></span>
<span data-ttu-id="4d549-103">Kod biblioteki musi być wywoływany w kodzie niezarządzanym (na przykład interfejsy API kodu natywnego, takie jak Win32).</span><span class="sxs-lookup"><span data-stu-id="4d549-103">Some library code needs to call into unmanaged code (for example, native code APIs, such as Win32).</span></span> <span data-ttu-id="4d549-104">Ponieważ oznacza to przechodzenie poza obwód zabezpieczeń dla kodu zarządzanego, wymagane jest zachowanie ostrożności.</span><span class="sxs-lookup"><span data-stu-id="4d549-104">Because this means going outside the security perimeter for managed code, due caution is required.</span></span> <span data-ttu-id="4d549-105">Jeśli kod jest neutralny pod względem zabezpieczeń, zarówno kod, jak i kod, który wywołuje ten element musi mieć uprawnienia<xref:System.Security.Permissions.SecurityPermission> <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> do kodu niezarządzanego (z określoną flagą).</span><span class="sxs-lookup"><span data-stu-id="4d549-105">If your code is security-neutral, both your code and any code that calls it must have unmanaged code permission (<xref:System.Security.Permissions.SecurityPermission> with the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> flag specified).</span></span>  
  
 <span data-ttu-id="4d549-106">Jednak często jest to nieuzasadnione, aby obiekt wywołujący miał takie zaawansowane uprawnienia.</span><span class="sxs-lookup"><span data-stu-id="4d549-106">However, it is often unreasonable for your caller to have such powerful permissions.</span></span> <span data-ttu-id="4d549-107">W takich przypadkach zaufany kod może być przechodzeniem między elementami, podobnymi do zarządzanej otoki lub kodu biblioteki opisanym w artykule [Zabezpieczanie kodu otoki](../misc/securing-wrapper-code.md).</span><span class="sxs-lookup"><span data-stu-id="4d549-107">In such cases, your trusted code can be the go-between, similar to the managed wrapper or library code described in [Securing Wrapper Code](../misc/securing-wrapper-code.md).</span></span> <span data-ttu-id="4d549-108">Jeśli podstawowa funkcja kodu niezarządzanego jest całkowicie bezpieczna, można ją bezpośrednio uwidocznić; w przeciwnym razie najpierw wymagane jest odpowiednie sprawdzenie uprawnień (żądanie).</span><span class="sxs-lookup"><span data-stu-id="4d549-108">If the underlying unmanaged code functionality is totally safe, it can be directly exposed; otherwise, a suitable permission check (demand) is required first.</span></span>  
  
 <span data-ttu-id="4d549-109">Gdy kod wywołuje się w niezarządzanym kodzie, ale nie chcesz wymagać od wywołujących uprawnień dostępu do niezarządzanego kodu, musisz pomusić to prawo.</span><span class="sxs-lookup"><span data-stu-id="4d549-109">When your code calls into unmanaged code but you do not want to require your callers to have permission to access unmanaged code, you must assert that right.</span></span> <span data-ttu-id="4d549-110">Potwierdzenie blokuje stos w ramce.</span><span class="sxs-lookup"><span data-stu-id="4d549-110">An assertion blocks the stack walk at your frame.</span></span> <span data-ttu-id="4d549-111">Należy zachować ostrożność, aby w tym procesie nie utworzyć otworu zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="4d549-111">You must be careful that you do not create a security hole in this process.</span></span> <span data-ttu-id="4d549-112">Zazwyczaj oznacza to, że należy zażądać odpowiednich uprawnień dla obiektów wywołujących, a następnie użyć kodu niezarządzanego do wykonania tylko tego, co zezwala na to uprawnienie i nie tylko.</span><span class="sxs-lookup"><span data-stu-id="4d549-112">Usually, this means that you must demand a suitable permission of your callers and then use unmanaged code to perform only what that permission allows and no more.</span></span> <span data-ttu-id="4d549-113">W niektórych przypadkach (na przykład funkcja Get of Day) kod niezarządzany może być bezpośrednio narażony na wywołujących bez żadnych kontroli zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="4d549-113">In some cases (for example, a get time-of-day function), unmanaged code can be directly exposed to callers without any security checks.</span></span> <span data-ttu-id="4d549-114">W każdym przypadku każdy kod, który potwierdza, musi być odpowiedzialny za zabezpieczenia.</span><span class="sxs-lookup"><span data-stu-id="4d549-114">In any case, any code that asserts must take responsibility for security.</span></span>  
  
 <span data-ttu-id="4d549-115">Ponieważ kod zarządzany, który zapewnia ścieżkę kodu do kodu natywnego, jest potencjalnym celem złośliwego kodu, co określa, który kod niezarządzany może być bezpiecznie używany i jak musi być używany, wymaga najwyższej staranności.</span><span class="sxs-lookup"><span data-stu-id="4d549-115">Because any managed code that provides a code path into native code is a potential target for malicious code, determining which unmanaged code can be safely used and how it must be used requires extreme care.</span></span> <span data-ttu-id="4d549-116">Ogólnie rzecz biorąc, kod niezarządzany nigdy nie powinien być bezpośrednio narażony na częściowo zaufane obiekty wywołujące.</span><span class="sxs-lookup"><span data-stu-id="4d549-116">Generally, unmanaged code should never be directly exposed to partially trusted callers.</span></span> <span data-ttu-id="4d549-117">Istnieją dwa podstawowe zagadnienia dotyczące oceny bezpieczeństwa niezarządzanego kodu w bibliotekach, które są wywoływane za pomocą częściowo zaufanego kodu:</span><span class="sxs-lookup"><span data-stu-id="4d549-117">There are two primary considerations in evaluating the safety of unmanaged code use in libraries that are callable by partially trusted code:</span></span>  
  
- <span data-ttu-id="4d549-118">**Funkcja**.</span><span class="sxs-lookup"><span data-stu-id="4d549-118">**Functionality**.</span></span> <span data-ttu-id="4d549-119">Czy niezarządzany interfejs API udostępnia funkcje, które nie zezwalają wywołującym na wykonywanie potencjalnie niebezpiecznych operacji?</span><span class="sxs-lookup"><span data-stu-id="4d549-119">Does the unmanaged API provide functionality that does not allow callers to perform potentially dangerous operations?</span></span> <span data-ttu-id="4d549-120">Zabezpieczenia dostępu kodu używają uprawnień, aby wymusić dostęp do zasobów, dlatego należy rozważyć, czy interfejs API używa plików, interfejsu użytkownika lub wątków, czy udostępnia chronione informacje.</span><span class="sxs-lookup"><span data-stu-id="4d549-120">Code access security uses permissions to enforce access to resources, so consider whether the API uses files, a user interface, or threading, or whether it exposes protected information.</span></span> <span data-ttu-id="4d549-121">W takim przypadku kod zarządzany musi wymagać wymaganych uprawnień przed zezwoleniem na jego wprowadzenie.</span><span class="sxs-lookup"><span data-stu-id="4d549-121">If it does, the managed code wrapping it must demand the necessary permissions before allowing it to be entered.</span></span> <span data-ttu-id="4d549-122">Ponadto, chociaż nie jest chroniony przez uprawnienie, dostęp do pamięci musi być ograniczony do rygorystycznego bezpieczeństwa typów.</span><span class="sxs-lookup"><span data-stu-id="4d549-122">Additionally, while not protected by a permission, memory access must be confined to strict type safety.</span></span>  
  
- <span data-ttu-id="4d549-123">**Sprawdzanie parametrów**.</span><span class="sxs-lookup"><span data-stu-id="4d549-123">**Parameter checking**.</span></span> <span data-ttu-id="4d549-124">Typowy atak polega na przejęciu nieoczekiwanych parametrów do wbudowanych metod interfejsu API kodu niezarządzanego w wyniku próby ich przeprowadzenia poza specyfikacją.</span><span class="sxs-lookup"><span data-stu-id="4d549-124">A common attack passes unexpected parameters to exposed unmanaged code API methods in an attempt to cause them to operate out of specification.</span></span> <span data-ttu-id="4d549-125">Przepełnienia buforów przy użyciu indeksu out-of-Range lub wartości przesunięcia to jeden typowy przykład tego typu ataku, jak wszystkie parametry, które mogą wykorzystać usterkę w kodzie źródłowym.</span><span class="sxs-lookup"><span data-stu-id="4d549-125">Buffer overruns using out-of-range index or offset values are one common example of this type of attack, as are any parameters that might exploit a bug in the underlying code.</span></span> <span data-ttu-id="4d549-126">W takim przypadku, nawet jeśli interfejs API kodu niezarządzanego jest funkcjonalnie bezpieczny (po wymaganym zapotrzebowaniu) dla częściowo zaufanych obiektów wywołujących, kod zarządzany musi również sprawdzać ważność parametrów, aby upewnić się, że żadne nieprzewidziane wywołania nie są możliwe przed złośliwym kodem przy użyciu zarządzanego warstwa otoki kodu.</span><span class="sxs-lookup"><span data-stu-id="4d549-126">Thus, even if the unmanaged code API is functionally safe (after necessary demands) for partially trusted callers, managed code must also check parameter validity exhaustively to ensure that no unintended calls are possible from malicious code using the managed code wrapper layer.</span></span>  
  
## <a name="using-suppressunmanagedcodesecurityattribute"></a><span data-ttu-id="4d549-127">Korzystanie z SuppressUnmanagedCodeSecurityAttribute</span><span class="sxs-lookup"><span data-stu-id="4d549-127">Using SuppressUnmanagedCodeSecurityAttribute</span></span>  
 <span data-ttu-id="4d549-128">Istnieje aspekt wydajności służący do potwierdzania, a następnie wywoływania kodu niezarządzanego.</span><span class="sxs-lookup"><span data-stu-id="4d549-128">There is a performance aspect to asserting and then calling unmanaged code.</span></span> <span data-ttu-id="4d549-129">Dla każdego takiego wywołania system zabezpieczeń automatycznie wymaga uprawnień do kodu niezarządzanego, co spowoduje, że każdy z nich jest przeszukiwany przez stos.</span><span class="sxs-lookup"><span data-stu-id="4d549-129">For every such call, the security system automatically demands unmanaged code permission, resulting in a stack walk each time.</span></span> <span data-ttu-id="4d549-130">Jeśli postanowisz i natychmiast wywołasz kod niezarządzany, przeszukiwanie stosu może być bez znaczenia: składa się z potwierdzenia i niezarządzanego wywołania kodu.</span><span class="sxs-lookup"><span data-stu-id="4d549-130">If you assert and immediately call unmanaged code, the stack walk can be meaningless: it consists of your assert and your unmanaged code call.</span></span>  
  
 <span data-ttu-id="4d549-131">Atrybut niestandardowy o nazwie <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute> można zastosować do punktów wejścia kodu niezarządzanego, aby wyłączyć normalne sprawdzanie zabezpieczeń, <xref:System.Security.Permissions.SecurityPermission> które wymaga <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> określonego uprawnienia.</span><span class="sxs-lookup"><span data-stu-id="4d549-131">A custom attribute called <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute> can be applied to unmanaged code entry points to disable the normal security check that demands <xref:System.Security.Permissions.SecurityPermission> with the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> permission specified.</span></span> <span data-ttu-id="4d549-132">W tym celu należy zawsze wykonać wyjątkową ostrożność, ponieważ ta akcja tworzy otwarte drzwi w niezarządzanym kodzie bez sprawdzania zabezpieczeń środowiska uruchomieniowego.</span><span class="sxs-lookup"><span data-stu-id="4d549-132">Extreme caution must always be taken when doing this, because this action creates an open door into unmanaged code with no runtime security checks.</span></span> <span data-ttu-id="4d549-133">Należy zauważyć, że nawet w przypadku zastosowania **SuppressUnmanagedCodeSecurityAttribute** istnieje jednorazowe sprawdzenie zabezpieczeń, które odbywa się w kompilacji just-in-Time (JIT), aby upewnić się, że bezpośredni obiekt wywołujący ma uprawnienia do wywoływania kodu niezarządzanego.</span><span class="sxs-lookup"><span data-stu-id="4d549-133">It should be noted that even with **SuppressUnmanagedCodeSecurityAttribute** applied, there is a one-time security check that happens at just-in-time (JIT) compilation to ensure that the immediate caller has permission to call unmanaged code.</span></span>  
  
 <span data-ttu-id="4d549-134">Jeśli używasz **SuppressUnmanagedCodeSecurityAttribute**, sprawdź następujące kwestie:</span><span class="sxs-lookup"><span data-stu-id="4d549-134">If you use the **SuppressUnmanagedCodeSecurityAttribute**, check the following points:</span></span>  
  
- <span data-ttu-id="4d549-135">Ustaw niezarządzany punkt wejścia kodu wewnętrznie lub w inny sposób niedostępny poza kodem.</span><span class="sxs-lookup"><span data-stu-id="4d549-135">Make the unmanaged code entry point internal or otherwise inaccessible outside your code.</span></span>  
  
- <span data-ttu-id="4d549-136">Wszelkie wywołania w kodzie niezarządzanym to potencjalna Luka w zabezpieczeniach.</span><span class="sxs-lookup"><span data-stu-id="4d549-136">Any call into unmanaged code is a potential security hole.</span></span> <span data-ttu-id="4d549-137">Upewnij się, że Twój kod nie jest portalem złośliwego kodu do pośredniego wywołania kodu niezarządzanego i uniknięcia kontroli zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="4d549-137">Make sure your code is not a portal for malicious code to indirectly call into unmanaged code and avoid a security check.</span></span> <span data-ttu-id="4d549-138">Uprawnienia na żądanie, jeśli jest to konieczne.</span><span class="sxs-lookup"><span data-stu-id="4d549-138">Demand permissions, if appropriate.</span></span>  
  
- <span data-ttu-id="4d549-139">Użyj konwencji nazewnictwa, aby jawnie określić, kiedy tworzysz niebezpieczną ścieżkę do kodu niezarządzanego, zgodnie z opisem w sekcji poniżej.</span><span class="sxs-lookup"><span data-stu-id="4d549-139">Use a naming convention to explicitly identify when you are creating a dangerous path into unmanaged code, as described in the section below..</span></span>  
  
## <a name="naming-convention-for-unmanaged-code-methods"></a><span data-ttu-id="4d549-140">Konwencja nazewnictwa dla metod kodu niezarządzanego</span><span class="sxs-lookup"><span data-stu-id="4d549-140">Naming convention for unmanaged code methods</span></span>  
 <span data-ttu-id="4d549-141">Do nazewnictwa metod kodu niezarządzanego zostały ustanowione użyteczne i zdecydowanie zalecane konwencje.</span><span class="sxs-lookup"><span data-stu-id="4d549-141">A useful and highly recommended convention has been established for naming unmanaged code methods.</span></span> <span data-ttu-id="4d549-142">Wszystkie metody kodu niezarządzanego są rozdzielone na trzy kategorie: **bezpieczne**, **natywne**i **niebezpieczne**.</span><span class="sxs-lookup"><span data-stu-id="4d549-142">All unmanaged code methods are separated into three categories: **safe**, **native**, and **unsafe**.</span></span> <span data-ttu-id="4d549-143">Słowa kluczowe mogą służyć jako nazwy klas, w których są zdefiniowane różne rodzaje punktów wejścia kodu niezarządzanego.</span><span class="sxs-lookup"><span data-stu-id="4d549-143">These keywords can be used as class names within which the various kinds of unmanaged code entry points are defined.</span></span> <span data-ttu-id="4d549-144">W kodzie źródłowym te słowa kluczowe powinny być dodawane do nazwy klasy, jak w `Safe.GetTimeOfDay`, `Native.Xyz`lub `Unsafe.DangerousAPI`, na przykład.</span><span class="sxs-lookup"><span data-stu-id="4d549-144">In source code, these keywords should be added to the class name, as in `Safe.GetTimeOfDay`, `Native.Xyz`, or `Unsafe.DangerousAPI`, for example.</span></span> <span data-ttu-id="4d549-145">Każdy z tych słów kluczowych zapewnia przydatne informacje o zabezpieczeniach dla deweloperów korzystających z tej klasy, zgodnie z opisem w poniższej tabeli.</span><span class="sxs-lookup"><span data-stu-id="4d549-145">Each of these keywords provides useful security information for developers using that class, as described in the following table.</span></span>  
  
|<span data-ttu-id="4d549-146">Słowo kluczowe</span><span class="sxs-lookup"><span data-stu-id="4d549-146">Keyword</span></span>|<span data-ttu-id="4d549-147">Zagadnienia dotyczące bezpieczeństwa</span><span class="sxs-lookup"><span data-stu-id="4d549-147">Security considerations</span></span>|  
|-------------|-----------------------------|  
|<span data-ttu-id="4d549-148">**sejf**</span><span class="sxs-lookup"><span data-stu-id="4d549-148">**safe**</span></span>|<span data-ttu-id="4d549-149">Całkowicie nieszkodliwe dla dowolnego kodu, nawet złośliwego kodu, aby wywołać.</span><span class="sxs-lookup"><span data-stu-id="4d549-149">Completely harmless for any code, even malicious code, to call.</span></span> <span data-ttu-id="4d549-150">Może być używany podobnie jak inny kod zarządzany.</span><span class="sxs-lookup"><span data-stu-id="4d549-150">Can be used just like other managed code.</span></span> <span data-ttu-id="4d549-151">Na przykład funkcja, która pobiera godzinę dnia, jest zazwyczaj bezpieczna.</span><span class="sxs-lookup"><span data-stu-id="4d549-151">For example, a function that gets the time of day is typically safe.</span></span>|  
|<span data-ttu-id="4d549-152">**trybu**</span><span class="sxs-lookup"><span data-stu-id="4d549-152">**native**</span></span>|<span data-ttu-id="4d549-153">Zabezpieczenia neutralne; to jest kod niezarządzany, który wymaga uprawnień do kodu niezarządzanego do wywołania.</span><span class="sxs-lookup"><span data-stu-id="4d549-153">Security-neutral; that is, unmanaged code that requires unmanaged code permission to call.</span></span> <span data-ttu-id="4d549-154">Jest zaznaczone pole wyboru zabezpieczenia, które powoduje zatrzymanie nieautoryzowanego elementu wywołującego.</span><span class="sxs-lookup"><span data-stu-id="4d549-154">Security is checked, which stops an unauthorized caller.</span></span>|  
|<span data-ttu-id="4d549-155">**unsafe**</span><span class="sxs-lookup"><span data-stu-id="4d549-155">**unsafe**</span></span>|<span data-ttu-id="4d549-156">Potencjalnie niebezpieczny punkt wejścia niezarządzanego kodu z pominięciem zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="4d549-156">Potentially dangerous unmanaged code entry point with security suppressed.</span></span> <span data-ttu-id="4d549-157">Deweloperzy powinni przy użyciu takiego kodu niezarządzanego korzystać z tego, aby upewnić się, że istnieją inne zabezpieczenia, aby zapobiec luki w zabezpieczeniach.</span><span class="sxs-lookup"><span data-stu-id="4d549-157">Developers should use the greatest caution when using such unmanaged code, making sure that other protections are in place to prevent a security vulnerability.</span></span> <span data-ttu-id="4d549-158">Deweloperzy muszą być odpowiedzialni, ponieważ to słowo kluczowe zastępuje system zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="4d549-158">Developers must be responsible, as this keyword overrides the security system.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="4d549-159">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="4d549-159">See also</span></span>

- [<span data-ttu-id="4d549-160">Wytyczne dotyczące bezpiecznego programowania</span><span class="sxs-lookup"><span data-stu-id="4d549-160">Secure Coding Guidelines</span></span>](../../standard/security/secure-coding-guidelines.md)
