---
title: Wytyczne dotyczące bezpiecznego programowania dla niezarządzanego kodu
ms.date: 03/30/2017
helpviewer_keywords:
- code security, unmanaged code
- unmanaged code, securing
- security [.NET Framework], unmanaged code
- secure coding, unmanaged code
ms.assetid: a8d15139-d368-4c9c-a747-ba757781117c
author: mairaw
ms.author: mairaw
ms.openlocfilehash: 138713c4a1397369ea18792a3b2742389b107a6b
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/08/2019
ms.locfileid: "59143770"
---
# <a name="secure-coding-guidelines-for-unmanaged-code"></a><span data-ttu-id="09231-102">Wytyczne dotyczące bezpiecznego programowania dla niezarządzanego kodu</span><span class="sxs-lookup"><span data-stu-id="09231-102">Secure Coding Guidelines for Unmanaged Code</span></span>
<span data-ttu-id="09231-103">Kod biblioteki musi wywoływać kod niezarządzany (na przykład kodu natywnego interfejsów API, taką jak system Win32).</span><span class="sxs-lookup"><span data-stu-id="09231-103">Some library code needs to call into unmanaged code (for example, native code APIs, such as Win32).</span></span> <span data-ttu-id="09231-104">Ponieważ oznacza to, że zewnętrzne obwodu zabezpieczeń dla kodu zarządzanego, właściwym Uwaga jest wymagana.</span><span class="sxs-lookup"><span data-stu-id="09231-104">Because this means going outside the security perimeter for managed code, due caution is required.</span></span> <span data-ttu-id="09231-105">Jeśli swój kod neutralnym poziomie bezpieczeństwa, zarówno kod, jak i wszelki kod, który ją wywołuje musi mieć niezarządzanych uprawnień kodu (<xref:System.Security.Permissions.SecurityPermission> z <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> określono flagę).</span><span class="sxs-lookup"><span data-stu-id="09231-105">If your code is security-neutral, both your code and any code that calls it must have unmanaged code permission (<xref:System.Security.Permissions.SecurityPermission> with the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> flag specified).</span></span>  
  
 <span data-ttu-id="09231-106">Jednak często jest nieuzasadnione dla Twojego obiekt wywołujący musi mieć takie uprawnienia zaawansowane.</span><span class="sxs-lookup"><span data-stu-id="09231-106">However, it is often unreasonable for your caller to have such powerful permissions.</span></span> <span data-ttu-id="09231-107">W takich przypadkach zaufany kod może być łącząca, podobnie jak zarządzanych otoka lub kod biblioteki opisanych w [Zabezpieczanie kodu otoki](../../../docs/framework/misc/securing-wrapper-code.md).</span><span class="sxs-lookup"><span data-stu-id="09231-107">In such cases, your trusted code can be the go-between, similar to the managed wrapper or library code described in [Securing Wrapper Code](../../../docs/framework/misc/securing-wrapper-code.md).</span></span> <span data-ttu-id="09231-108">Jeśli podstawową funkcjonalność kodu niezarządzanego jest całkowicie bezpieczne, można bezpośrednio uwidaczniać; w przeciwnym razie sprawdź odpowiednie uprawnienia (żądanie) jest wymagana najpierw.</span><span class="sxs-lookup"><span data-stu-id="09231-108">If the underlying unmanaged code functionality is totally safe, it can be directly exposed; otherwise, a suitable permission check (demand) is required first.</span></span>  
  
 <span data-ttu-id="09231-109">Gdy kod wywołuje kod niezarządzany, ale nie chcesz wymagać wywołujących usługi ma uprawnienia dostępu kodu niezarządzanego, musi assert prawo.</span><span class="sxs-lookup"><span data-stu-id="09231-109">When your code calls into unmanaged code but you do not want to require your callers to have permission to access unmanaged code, you must assert that right.</span></span> <span data-ttu-id="09231-110">Potwierdzenie blokuje przejście przez stos w swojej ramki.</span><span class="sxs-lookup"><span data-stu-id="09231-110">An assertion blocks the stack walk at your frame.</span></span> <span data-ttu-id="09231-111">Należy uważać, aby nie utworzyć lukę w zabezpieczeniach w ramach tego procesu.</span><span class="sxs-lookup"><span data-stu-id="09231-111">You must be careful that you do not create a security hole in this process.</span></span> <span data-ttu-id="09231-112">Zwykle oznacza to, musi popytu odpowiednie uprawnienie swoje obiekty wywołujące i następnie wykonywać tylko pozwala to uprawnienie i nie więcej za pomocą kodu niezarządzanego.</span><span class="sxs-lookup"><span data-stu-id="09231-112">Usually, this means that you must demand a suitable permission of your callers and then use unmanaged code to perform only what that permission allows and no more.</span></span> <span data-ttu-id="09231-113">W niektórych przypadkach (na przykład, pory dnia funkcji get) niezarządzanego kodu mogą bezpośrednio łączyć się z wywołującym bez żadnych kontroli zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="09231-113">In some cases (for example, a get time-of-day function), unmanaged code can be directly exposed to callers without any security checks.</span></span> <span data-ttu-id="09231-114">W każdym przypadku wszelki kod, który potwierdza musi ponosi odpowiedzialność za zabezpieczenia.</span><span class="sxs-lookup"><span data-stu-id="09231-114">In any case, any code that asserts must take responsibility for security.</span></span>  
  
 <span data-ttu-id="09231-115">Ponieważ dowolnego kodu zarządzanego, który zawiera ścieżkę kodu do kodu macierzystego potencjalnych celów dla złośliwego kodu, określania niezarządzanego kodu można go bezpiecznie używać i jak należy użyć wymaga rozwagą.</span><span class="sxs-lookup"><span data-stu-id="09231-115">Because any managed code that provides a code path into native code is a potential target for malicious code, determining which unmanaged code can be safely used and how it must be used requires extreme care.</span></span> <span data-ttu-id="09231-116">Ogólnie rzecz biorąc kodem niezarządzanym powinno nigdy bezpośrednio uwidaczniać częściowo zaufanych wywołań.</span><span class="sxs-lookup"><span data-stu-id="09231-116">Generally, unmanaged code should never be directly exposed to partially trusted callers.</span></span> <span data-ttu-id="09231-117">Istnieją dwa podstawowych zagadnień podczas oceny bezpieczeństwa użytkowania kodu niezarządzanego w bibliotekach, które są wywoływane przez częściowo zaufany kod:</span><span class="sxs-lookup"><span data-stu-id="09231-117">There are two primary considerations in evaluating the safety of unmanaged code use in libraries that are callable by partially trusted code:</span></span>  
  
-   <span data-ttu-id="09231-118">**Funkcje**.</span><span class="sxs-lookup"><span data-stu-id="09231-118">**Functionality**.</span></span> <span data-ttu-id="09231-119">Niezarządzany interfejs API zapewnia funkcje, które nie zezwala na obiekty wywołujące do wykonywania operacji potencjalnie niebezpiecznych?</span><span class="sxs-lookup"><span data-stu-id="09231-119">Does the unmanaged API provide functionality that does not allow callers to perform potentially dangerous operations?</span></span> <span data-ttu-id="09231-120">Zabezpieczenia dostępu kodu używa uprawnień do wymuszenia dostępu do zasobów, dlatego należy rozważyć czy interfejs API korzysta z plików, interfejs użytkownika lub wątkowości, lub czy uwidacznia on informacje chronione.</span><span class="sxs-lookup"><span data-stu-id="09231-120">Code access security uses permissions to enforce access to resources, so consider whether the API uses files, a user interface, or threading, or whether it exposes protected information.</span></span> <span data-ttu-id="09231-121">Jeśli tak jest, kod zarządzany, zawijanie go musi popytu niezbędne uprawnienia przed zezwoleniem na jego ma zostać nawiązane.</span><span class="sxs-lookup"><span data-stu-id="09231-121">If it does, the managed code wrapping it must demand the necessary permissions before allowing it to be entered.</span></span> <span data-ttu-id="09231-122">Ponadto gdy nie są chronione przez uprawnienia, dostęp do pamięci musi być ograniczone do ścisłe zasady bezpieczeństwa.</span><span class="sxs-lookup"><span data-stu-id="09231-122">Additionally, while not protected by a permission, memory access must be confined to strict type safety.</span></span>  
  
-   <span data-ttu-id="09231-123">**Sprawdzanie parametrów**.</span><span class="sxs-lookup"><span data-stu-id="09231-123">**Parameter checking**.</span></span> <span data-ttu-id="09231-124">Typowe przebiegów ataku nieoczekiwany parametry, aby widoczne metod kodu niezarządzanego interfejsu API w celu podjęcia próby spowoduje ich działają poza specyfikacji.</span><span class="sxs-lookup"><span data-stu-id="09231-124">A common attack passes unexpected parameters to exposed unmanaged code API methods in an attempt to cause them to operate out of specification.</span></span> <span data-ttu-id="09231-125">Przy użyciu indeksu spoza zakresu przekroczenia buforu lub wartości przesunięcia są jednym z typowych przykładów ten rodzaj ataku, są wszystkie parametry, które mogą wykorzystać usterki w kodzie podstawowym.</span><span class="sxs-lookup"><span data-stu-id="09231-125">Buffer overruns using out-of-range index or offset values are one common example of this type of attack, as are any parameters that might exploit a bug in the underlying code.</span></span> <span data-ttu-id="09231-126">W związku z tym nawet jeśli kodu niezarządzanego interfejsu API jest funkcjonalnie bezpieczne (po niezbędne wymagania) dla częściowo zaufanego obiektów wywołujących, zarządzane kodu musi również wyboru parametr ważności wyczerpująco, aby upewnić się, że nie wywołuje niepożądanych możliwe od złośliwego kodu za pomocą zarządzanych Kod otoki warstwy.</span><span class="sxs-lookup"><span data-stu-id="09231-126">Thus, even if the unmanaged code API is functionally safe (after necessary demands) for partially trusted callers, managed code must also check parameter validity exhaustively to ensure that no unintended calls are possible from malicious code using the managed code wrapper layer.</span></span>  
  
## <a name="using-suppressunmanagedcodesecurityattribute"></a><span data-ttu-id="09231-127">Korzystanie z SuppressUnmanagedCodeSecurityAttribute</span><span class="sxs-lookup"><span data-stu-id="09231-127">Using SuppressUnmanagedCodeSecurityAttribute</span></span>  
 <span data-ttu-id="09231-128">Jest aspektem wydajności potwierdzające i następnie wywoływania niezarządzanego kodu.</span><span class="sxs-lookup"><span data-stu-id="09231-128">There is a performance aspect to asserting and then calling unmanaged code.</span></span> <span data-ttu-id="09231-129">Za każde wywołanie systemu zabezpieczeń automatycznie zażąda uprawnień kodu niezarządzanego, wynikiem przeszukiwania stosu każdorazowo.</span><span class="sxs-lookup"><span data-stu-id="09231-129">For every such call, the security system automatically demands unmanaged code permission, resulting in a stack walk each time.</span></span> <span data-ttu-id="09231-130">Jeśli potwierdzenia i natychmiast wywoływać kod niezarządzany, przejście przez stos może być całkowicie nieprzydatna: składa się z Twojego assert i wywołania kodu niezarządzanego.</span><span class="sxs-lookup"><span data-stu-id="09231-130">If you assert and immediately call unmanaged code, the stack walk can be meaningless: it consists of your assert and your unmanaged code call.</span></span>  
  
 <span data-ttu-id="09231-131">Niestandardowy atrybut o nazwie <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute> mogą być stosowane do kodu niezarządzanego punktami wejściowymi umożliwiającymi Wyłącz sprawdzanie zabezpieczeń normalne, która żąda <xref:System.Security.Permissions.SecurityPermission> z <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> określone uprawnienie.</span><span class="sxs-lookup"><span data-stu-id="09231-131">A custom attribute called <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute> can be applied to unmanaged code entry points to disable the normal security check that demands <xref:System.Security.Permissions.SecurityPermission> with the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> permission specified.</span></span> <span data-ttu-id="09231-132">Należy zachować wyjątkową ostrożność zawsze muszą zostać podjęte, gdy to zrobić, ponieważ ta akcja powoduje utworzenie Otwieranie drzwi do kodu niezarządzanego z żadnych zabezpieczeń środowisko uruchomieniowe sprawdza.</span><span class="sxs-lookup"><span data-stu-id="09231-132">Extreme caution must always be taken when doing this, because this action creates an open door into unmanaged code with no runtime security checks.</span></span> <span data-ttu-id="09231-133">Należy zauważyć, że nawet w przypadku **SuppressUnmanagedCodeSecurityAttribute** stosowany, jest sprawdzanie jednorazowe zabezpieczeń, które odbywa się na kompilacji just-in-time (JIT), aby upewnić się, że bezpośredniego obiektu wywołującego ma uprawnienia do wywołania kod niezarządzany.</span><span class="sxs-lookup"><span data-stu-id="09231-133">It should be noted that even with **SuppressUnmanagedCodeSecurityAttribute** applied, there is a one-time security check that happens at just-in-time (JIT) compilation to ensure that the immediate caller has permission to call unmanaged code.</span></span>  
  
 <span data-ttu-id="09231-134">Jeśli używasz **SuppressUnmanagedCodeSecurityAttribute**, sprawdź następujące kwestie:</span><span class="sxs-lookup"><span data-stu-id="09231-134">If you use the **SuppressUnmanagedCodeSecurityAttribute**, check the following points:</span></span>  
  
-   <span data-ttu-id="09231-135">Wprowadź punkt wejścia do kodu niezarządzanego wewnętrznych lub w inny sposób niedostępny poza kodem.</span><span class="sxs-lookup"><span data-stu-id="09231-135">Make the unmanaged code entry point internal or otherwise inaccessible outside your code.</span></span>  
  
-   <span data-ttu-id="09231-136">Każde wywołanie do kodu niezarządzanego jest potencjalnym lukę w zabezpieczeniach.</span><span class="sxs-lookup"><span data-stu-id="09231-136">Any call into unmanaged code is a potential security hole.</span></span> <span data-ttu-id="09231-137">Upewnij się, że Twój kod nie jest portal dla złośliwego kodu pośrednio wywołania kodu niezarządzanego i unikanie sprawdzanie zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="09231-137">Make sure your code is not a portal for malicious code to indirectly call into unmanaged code and avoid a security check.</span></span> <span data-ttu-id="09231-138">Wymaga uprawnień, jeśli to stosowne.</span><span class="sxs-lookup"><span data-stu-id="09231-138">Demand permissions, if appropriate.</span></span>  
  
-   <span data-ttu-id="09231-139">Użyj konwencji nazewnictwa, aby jawnie identyfikować podczas tworzenia niebezpiecznych ścieżkę do kodu niezarządzanego, zgodnie z opisem w dalszej części tego artykułu...</span><span class="sxs-lookup"><span data-stu-id="09231-139">Use a naming convention to explicitly identify when you are creating a dangerous path into unmanaged code, as described in the section below..</span></span>  
  
## <a name="naming-convention-for-unmanaged-code-methods"></a><span data-ttu-id="09231-140">Konwencje nazewnictwa dla metod kodu niezarządzanego</span><span class="sxs-lookup"><span data-stu-id="09231-140">Naming convention for unmanaged code methods</span></span>  
 <span data-ttu-id="09231-141">Konwencja przydatne i zdecydowanie zalecane została ustanowiona dla nazw metod kodu niezarządzanego.</span><span class="sxs-lookup"><span data-stu-id="09231-141">A useful and highly recommended convention has been established for naming unmanaged code methods.</span></span> <span data-ttu-id="09231-142">Wszystkie metody niezarządzanego kodu są podzielone na trzy kategorie: **bezpieczne**, **natywnych**, i **niebezpieczne**.</span><span class="sxs-lookup"><span data-stu-id="09231-142">All unmanaged code methods are separated into three categories: **safe**, **native**, and **unsafe**.</span></span> <span data-ttu-id="09231-143">Tych słów kluczowych mogą służyć jako nazwy klas, w których zdefiniowano różne rodzaje punkty wejścia kodu niezarządzanego.</span><span class="sxs-lookup"><span data-stu-id="09231-143">These keywords can be used as class names within which the various kinds of unmanaged code entry points are defined.</span></span> <span data-ttu-id="09231-144">W kodzie źródłowym, te słowa kluczowe należy dodać do nazwy klasy, podobnie jak w `Safe.GetTimeOfDay`, `Native.Xyz`, lub `Unsafe.DangerousAPI`, na przykład.</span><span class="sxs-lookup"><span data-stu-id="09231-144">In source code, these keywords should be added to the class name, as in `Safe.GetTimeOfDay`, `Native.Xyz`, or `Unsafe.DangerousAPI`, for example.</span></span> <span data-ttu-id="09231-145">Każda z tych słów kluczowych zawiera informacje o zabezpieczeniach przydatny dla deweloperów korzystających z tej klasy, zgodnie z opisem w poniższej tabeli.</span><span class="sxs-lookup"><span data-stu-id="09231-145">Each of these keywords provides useful security information for developers using that class, as described in the following table.</span></span>  
  
|<span data-ttu-id="09231-146">Słowo kluczowe</span><span class="sxs-lookup"><span data-stu-id="09231-146">Keyword</span></span>|<span data-ttu-id="09231-147">Zagadnienia dotyczące bezpieczeństwa</span><span class="sxs-lookup"><span data-stu-id="09231-147">Security considerations</span></span>|  
|-------------|-----------------------------|  
|**<span data-ttu-id="09231-148">Bezpieczne</span><span class="sxs-lookup"><span data-stu-id="09231-148">safe</span></span>**|<span data-ttu-id="09231-149">Nieszkodliwy całkowicie dowolnego kodu, nawet złośliwego kodu, aby wywołać.</span><span class="sxs-lookup"><span data-stu-id="09231-149">Completely harmless for any code, even malicious code, to call.</span></span> <span data-ttu-id="09231-150">Może służyć podobnie jak inne kodu zarządzanego.</span><span class="sxs-lookup"><span data-stu-id="09231-150">Can be used just like other managed code.</span></span> <span data-ttu-id="09231-151">Na przykład funkcja, która pobiera godzinę jest zazwyczaj bezpieczne.</span><span class="sxs-lookup"><span data-stu-id="09231-151">For example, a function that gets the time of day is typically safe.</span></span>|  
|**<span data-ttu-id="09231-152">natywne</span><span class="sxs-lookup"><span data-stu-id="09231-152">native</span></span>**|<span data-ttu-id="09231-153">Neutralnym poziomie bezpieczeństwa; oznacza to, że kod niezarządzany, który wymaga niezarządzany kod uprawnienia do wywołania.</span><span class="sxs-lookup"><span data-stu-id="09231-153">Security-neutral; that is, unmanaged code that requires unmanaged code permission to call.</span></span> <span data-ttu-id="09231-154">Zabezpieczenia są sprawdzane, co uniemożliwia nieautoryzowanym obiektu wywołującego.</span><span class="sxs-lookup"><span data-stu-id="09231-154">Security is checked, which stops an unauthorized caller.</span></span>|  
|**<span data-ttu-id="09231-155">unsafe</span><span class="sxs-lookup"><span data-stu-id="09231-155">unsafe</span></span>**|<span data-ttu-id="09231-156">Niebezpieczny kod niezarządzany punkt wejścia z zabezpieczeniami pominięte.</span><span class="sxs-lookup"><span data-stu-id="09231-156">Potentially dangerous unmanaged code entry point with security suppressed.</span></span> <span data-ttu-id="09231-157">Deweloperzy należy zachować ostrożność największy podczas korzystania z takiego kodu niezarządzanego, upewniając się, że innych mechanizmów ochrony znajdują się w miejscu, aby uniemożliwić luki w zabezpieczeniach.</span><span class="sxs-lookup"><span data-stu-id="09231-157">Developers should use the greatest caution when using such unmanaged code, making sure that other protections are in place to prevent a security vulnerability.</span></span> <span data-ttu-id="09231-158">Deweloperzy muszą być odpowiedzialne, to słowo kluczowe zastępuje system zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="09231-158">Developers must be responsible, as this keyword overrides the security system.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="09231-159">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="09231-159">See also</span></span>

- [<span data-ttu-id="09231-160">Wytyczne dotyczące bezpiecznego programowania</span><span class="sxs-lookup"><span data-stu-id="09231-160">Secure Coding Guidelines</span></span>](../../../docs/standard/security/secure-coding-guidelines.md)
