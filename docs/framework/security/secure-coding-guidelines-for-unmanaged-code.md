---
title: Wytyczne dotyczące bezpiecznego programowania dla niezarządzanego kodu
ms.date: 03/30/2017
helpviewer_keywords:
- code security, unmanaged code
- unmanaged code, securing
- security [.NET Framework], unmanaged code
- secure coding, unmanaged code
ms.assetid: a8d15139-d368-4c9c-a747-ba757781117c
author: mairaw
ms.author: mairaw
ms.openlocfilehash: 60e293ac8c9100876aa5a524bb5dda04e9f4183f
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 05/04/2018
ms.locfileid: "33408154"
---
# <a name="secure-coding-guidelines-for-unmanaged-code"></a><span data-ttu-id="5fd53-102">Wytyczne dotyczące bezpiecznego programowania dla niezarządzanego kodu</span><span class="sxs-lookup"><span data-stu-id="5fd53-102">Secure Coding Guidelines for Unmanaged Code</span></span>
<span data-ttu-id="5fd53-103">Kod biblioteki musi wywoływać kodu niezarządzanego (na przykład kodu natywnego interfejsów API, takich jak Win32).</span><span class="sxs-lookup"><span data-stu-id="5fd53-103">Some library code needs to call into unmanaged code (for example, native code APIs, such as Win32).</span></span> <span data-ttu-id="5fd53-104">Ponieważ oznacza to, że zewnętrzne granicznej zabezpieczeń dla zarządzanego kodu właściwym ostrożność jest wymagana.</span><span class="sxs-lookup"><span data-stu-id="5fd53-104">Because this means going outside the security perimeter for managed code, due caution is required.</span></span> <span data-ttu-id="5fd53-105">Jeśli kod jest neutralnym poziomie bezpieczeństwa, zarówno w kodzie, jak i każdy kod wywołujący go musi mieć niezarządzanych uprawnień kodu (<xref:System.Security.Permissions.SecurityPermission> z <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> określona flaga).</span><span class="sxs-lookup"><span data-stu-id="5fd53-105">If your code is security-neutral, both your code and any code that calls it must have unmanaged code permission (<xref:System.Security.Permissions.SecurityPermission> with the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> flag specified).</span></span>  
  
 <span data-ttu-id="5fd53-106">Często jest jednak nieuzasadnione z obiektu wywołującego takie zaawansowanych uprawnień.</span><span class="sxs-lookup"><span data-stu-id="5fd53-106">However, it is often unreasonable for your caller to have such powerful permissions.</span></span> <span data-ttu-id="5fd53-107">W takim przypadku zaufany kod może być łącząca, podobnie jak zarządzany otok lub kod biblioteki opisanych w [Zabezpieczanie kodu otoki](../../../docs/framework/misc/securing-wrapper-code.md).</span><span class="sxs-lookup"><span data-stu-id="5fd53-107">In such cases, your trusted code can be the go-between, similar to the managed wrapper or library code described in [Securing Wrapper Code](../../../docs/framework/misc/securing-wrapper-code.md).</span></span> <span data-ttu-id="5fd53-108">W przypadku całkowicie bezpieczne funkcjonalność kodu niezarządzanego, można bezpośrednio widoczne; w przeciwnym razie sprawdź odpowiednie uprawnienia (żądanie) jest wymagana najpierw.</span><span class="sxs-lookup"><span data-stu-id="5fd53-108">If the underlying unmanaged code functionality is totally safe, it can be directly exposed; otherwise, a suitable permission check (demand) is required first.</span></span>  
  
 <span data-ttu-id="5fd53-109">Jeśli kod wywołuje do kodu niezarządzanego, ale nie chcesz wymagać Twojej wywołującym ma uprawnienia dostępu do kodu niezarządzanego, musi assert prawo.</span><span class="sxs-lookup"><span data-stu-id="5fd53-109">When your code calls into unmanaged code but you do not want to require your callers to have permission to access unmanaged code, you must assert that right.</span></span> <span data-ttu-id="5fd53-110">Potwierdzenie blokuje przeszukiwania stosu w Twojej ramki.</span><span class="sxs-lookup"><span data-stu-id="5fd53-110">An assertion blocks the stack walk at your frame.</span></span> <span data-ttu-id="5fd53-111">Należy zachować ostrożność, że nie należy tworzyć luka w zabezpieczeniach w tym procesie.</span><span class="sxs-lookup"><span data-stu-id="5fd53-111">You must be careful that you do not create a security hole in this process.</span></span> <span data-ttu-id="5fd53-112">Zwykle oznacza to, należy zażądać odpowiednie uprawnienia z obiektów wywołujących i następnie użyć kodu niezarządzanego, aby wykonać tylko umożliwia uprawnienie i nie więcej.</span><span class="sxs-lookup"><span data-stu-id="5fd53-112">Usually, this means that you must demand a suitable permission of your callers and then use unmanaged code to perform only what that permission allows and no more.</span></span> <span data-ttu-id="5fd53-113">W niektórych przypadkach (na przykład funkcję czasu dnia get) kodu niezarządzanego może bezpośrednio widoczne dla wywołań bez kontroli zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="5fd53-113">In some cases (for example, a get time-of-day function), unmanaged code can be directly exposed to callers without any security checks.</span></span> <span data-ttu-id="5fd53-114">W każdym przypadku kodu, który potwierdza, należy wykonać odpowiedzialność za bezpieczeństwo.</span><span class="sxs-lookup"><span data-stu-id="5fd53-114">In any case, any code that asserts must take responsibility for security.</span></span>  
  
 <span data-ttu-id="5fd53-115">Ponieważ zarządzanego kodu, który zawiera ścieżkę kodu do kodu macierzystego potencjalnych celu złośliwego kodu, określania, które niezarządzanego kodu może być bezpiecznie stosowany, i jak należy go używać wymaga rozwagą.</span><span class="sxs-lookup"><span data-stu-id="5fd53-115">Because any managed code that provides a code path into native code is a potential target for malicious code, determining which unmanaged code can be safely used and how it must be used requires extreme care.</span></span> <span data-ttu-id="5fd53-116">Ogólnie rzecz biorąc niezarządzany kod powinien nigdy być bezpośrednio widoczne dla częściowo zaufanych wywołań.</span><span class="sxs-lookup"><span data-stu-id="5fd53-116">Generally, unmanaged code should never be directly exposed to partially trusted callers.</span></span> <span data-ttu-id="5fd53-117">Istnieją dwa podstawowe zagadnienia dotyczące podczas obliczania bezpieczeństwa niezarządzany kod używany w bibliotekach, które zostały wywołane przez częściowo zaufany kod:</span><span class="sxs-lookup"><span data-stu-id="5fd53-117">There are two primary considerations in evaluating the safety of unmanaged code use in libraries that are callable by partially trusted code:</span></span>  
  
-   <span data-ttu-id="5fd53-118">**Funkcje**.</span><span class="sxs-lookup"><span data-stu-id="5fd53-118">**Functionality**.</span></span> <span data-ttu-id="5fd53-119">Niezarządzanego API oferuje funkcje, które nie zezwala na obiekty wywołujące do wykonywania operacji potencjalnie niebezpiecznych?</span><span class="sxs-lookup"><span data-stu-id="5fd53-119">Does the unmanaged API provide functionality that does not allow callers to perform potentially dangerous operations?</span></span> <span data-ttu-id="5fd53-120">Zabezpieczenia dostępu kodu używa uprawnień do wymuszenia dostępu do zasobów, dlatego należy rozważyć czy interfejs API korzysta z plików, interfejs użytkownika lub wątkowość, lub czy ujawnia chronione informacje.</span><span class="sxs-lookup"><span data-stu-id="5fd53-120">Code access security uses permissions to enforce access to resources, so consider whether the API uses files, a user interface, or threading, or whether it exposes protected information.</span></span> <span data-ttu-id="5fd53-121">Jeśli tak, kodu zarządzanego zawijania go musi żądać niezbędne uprawnienia przed dzięki któremu można wprowadzić.</span><span class="sxs-lookup"><span data-stu-id="5fd53-121">If it does, the managed code wrapping it must demand the necessary permissions before allowing it to be entered.</span></span> <span data-ttu-id="5fd53-122">Ponadto gdy nie jest chroniony przez uprawnienia, dostęp do pamięci musi być ograniczone do ścisłe zasady zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="5fd53-122">Additionally, while not protected by a permission, memory access must be confined to strict type safety.</span></span>  
  
-   <span data-ttu-id="5fd53-123">**Sprawdzanie parametru**.</span><span class="sxs-lookup"><span data-stu-id="5fd53-123">**Parameter checking**.</span></span> <span data-ttu-id="5fd53-124">Typowe przekazuje ataku nieoczekiwany parametry widoczne metody kodu niezarządzanego API próby spowodować działać poza specyfikacji.</span><span class="sxs-lookup"><span data-stu-id="5fd53-124">A common attack passes unexpected parameters to exposed unmanaged code API methods in an attempt to cause them to operate out of specification.</span></span> <span data-ttu-id="5fd53-125">Przepełnienia buforów przy użyciu indeksu out-of-range lub wartości przesunięcia są typowe przykładem takiego ataku, jak to wszystkie parametry, które może wykorzystać usterkę kodu źródłowego.</span><span class="sxs-lookup"><span data-stu-id="5fd53-125">Buffer overruns using out-of-range index or offset values are one common example of this type of attack, as are any parameters that might exploit a bug in the underlying code.</span></span> <span data-ttu-id="5fd53-126">W związku z tym nawet jeśli kodu niezarządzanego interfejsu API jest funkcjonalnie bezpieczne (po niezbędne wymagania) częściowo zaufany wywołań zarządzanych kodu musi również wyboru parametr ważności wyczerpujący w celu zapewnienia możliwości z złośliwego kodu za pomocą zarządzanego nie niezamierzone wywołań Kod otoki warstwy.</span><span class="sxs-lookup"><span data-stu-id="5fd53-126">Thus, even if the unmanaged code API is functionally safe (after necessary demands) for partially trusted callers, managed code must also check parameter validity exhaustively to ensure that no unintended calls are possible from malicious code using the managed code wrapper layer.</span></span>  
  
## <a name="using-suppressunmanagedcodesecurityattribute"></a><span data-ttu-id="5fd53-127">Korzystanie z SuppressUnmanagedCodeSecurityAttribute</span><span class="sxs-lookup"><span data-stu-id="5fd53-127">Using SuppressUnmanagedCodeSecurityAttribute</span></span>  
 <span data-ttu-id="5fd53-128">Jest elementem wydajności zostanie i następnie wywoływanie kodu niezarządzanego.</span><span class="sxs-lookup"><span data-stu-id="5fd53-128">There is a performance aspect to asserting and then calling unmanaged code.</span></span> <span data-ttu-id="5fd53-129">Dla każdego wywołania systemu zabezpieczeń automatycznie wymaga uprawnień kodu niezarządzanego, co przeszukiwania stosu zawsze.</span><span class="sxs-lookup"><span data-stu-id="5fd53-129">For every such call, the security system automatically demands unmanaged code permission, resulting in a stack walk each time.</span></span> <span data-ttu-id="5fd53-130">Jeśli Potwierdzaj i natychmiast wywoływanie kodu niezarządzanego, przeszukiwania stosu może być znaczenia: składa się z Twojego assert i wywołania kodu niezarządzanego.</span><span class="sxs-lookup"><span data-stu-id="5fd53-130">If you assert and immediately call unmanaged code, the stack walk can be meaningless: it consists of your assert and your unmanaged code call.</span></span>  
  
 <span data-ttu-id="5fd53-131">Niestandardowy atrybut o nazwie <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute> może odnosić się do punktów wejścia kodu niezarządzanego, aby wyłączyć sprawdzanie zabezpieczeń normalne, która żąda <xref:System.Security.Permissions.SecurityPermission> z <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> uprawnienia określone.</span><span class="sxs-lookup"><span data-stu-id="5fd53-131">A custom attribute called <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute> can be applied to unmanaged code entry points to disable the normal security check that demands <xref:System.Security.Permissions.SecurityPermission> with the <xref:System.Security.Permissions.SecurityPermissionFlag.UnmanagedCode> permission specified.</span></span> <span data-ttu-id="5fd53-132">Zawsze należy podjąć wyjątkową ostrożność podczas sprawdza temu, ponieważ ta akcja powoduje otwieranie drzwi do kodu niezarządzanego z żadnych zabezpieczeń środowiska wykonawczego.</span><span class="sxs-lookup"><span data-stu-id="5fd53-132">Extreme caution must always be taken when doing this, because this action creates an open door into unmanaged code with no runtime security checks.</span></span> <span data-ttu-id="5fd53-133">Należy zauważyć, że nawet w przypadku **SuppressUnmanagedCodeSecurityAttribute** zastosowane, Brak wyboru jednorazowe zabezpieczeń, wykonywanej w kompilacji just-in-time (JIT), aby upewnić się, że bezpośredniego obiektu wywołującego ma uprawnienia do wywoływania niezarządzany kod.</span><span class="sxs-lookup"><span data-stu-id="5fd53-133">It should be noted that even with **SuppressUnmanagedCodeSecurityAttribute** applied, there is a one-time security check that happens at just-in-time (JIT) compilation to ensure that the immediate caller has permission to call unmanaged code.</span></span>  
  
 <span data-ttu-id="5fd53-134">Jeśli używasz **SuppressUnmanagedCodeSecurityAttribute**, sprawdź następujące kwestie:</span><span class="sxs-lookup"><span data-stu-id="5fd53-134">If you use the **SuppressUnmanagedCodeSecurityAttribute**, check the following points:</span></span>  
  
-   <span data-ttu-id="5fd53-135">Należy punktu wejścia kodu niezarządzanego wewnętrznych lub w inny sposób niedostępny poza swój kod.</span><span class="sxs-lookup"><span data-stu-id="5fd53-135">Make the unmanaged code entry point internal or otherwise inaccessible outside your code.</span></span>  
  
-   <span data-ttu-id="5fd53-136">Wszystkie wywołania do kodu niezarządzanego jest potencjalnych luka w zabezpieczeniach.</span><span class="sxs-lookup"><span data-stu-id="5fd53-136">Any call into unmanaged code is a potential security hole.</span></span> <span data-ttu-id="5fd53-137">Upewnij się, że kod nie jest portal dla złośliwego kodu pośrednio wywoływać kodu niezarządzanego i uniknąć sprawdzanie zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="5fd53-137">Make sure your code is not a portal for malicious code to indirectly call into unmanaged code and avoid a security check.</span></span> <span data-ttu-id="5fd53-138">Żądanie uprawnienia, w razie potrzeby.</span><span class="sxs-lookup"><span data-stu-id="5fd53-138">Demand permissions, if appropriate.</span></span>  
  
-   <span data-ttu-id="5fd53-139">Użyj konwencji nazewnictwa, aby jednoznacznie zidentyfikować podczas tworzenia niebezpiecznych ścieżki do kodu niezarządzanego, zgodnie z opisem w poniższej sekcji..</span><span class="sxs-lookup"><span data-stu-id="5fd53-139">Use a naming convention to explicitly identify when you are creating a dangerous path into unmanaged code, as described in the section below..</span></span>  
  
## <a name="naming-convention-for-unmanaged-code-methods"></a><span data-ttu-id="5fd53-140">Konwencja nazewnictwa dla metod niezarządzany kod</span><span class="sxs-lookup"><span data-stu-id="5fd53-140">Naming convention for unmanaged code methods</span></span>  
 <span data-ttu-id="5fd53-141">Konwencja przydatne i zdecydowanie zalecane została ustanowiona dla nazwy metody kodu niezarządzanego.</span><span class="sxs-lookup"><span data-stu-id="5fd53-141">A useful and highly recommended convention has been established for naming unmanaged code methods.</span></span> <span data-ttu-id="5fd53-142">Wszystkie metody kodu niezarządzanego są podzielone na trzy kategorie: **bezpieczne**, **natywnego**, i **niebezpieczne**.</span><span class="sxs-lookup"><span data-stu-id="5fd53-142">All unmanaged code methods are separated into three categories: **safe**, **native**, and **unsafe**.</span></span> <span data-ttu-id="5fd53-143">Słowa kluczowe może służyć jako nazwy klasy, w których zdefiniowano różne rodzaje punkty wejścia kodu niezarządzanego.</span><span class="sxs-lookup"><span data-stu-id="5fd53-143">These keywords can be used as class names within which the various kinds of unmanaged code entry points are defined.</span></span> <span data-ttu-id="5fd53-144">W kodzie źródłowym słowa kluczowe powinny zostać dodane do nazwy klasy, jak w `Safe.GetTimeOfDay`, `Native.Xyz`, lub `Unsafe.DangerousAPI`, np.</span><span class="sxs-lookup"><span data-stu-id="5fd53-144">In source code, these keywords should be added to the class name, as in `Safe.GetTimeOfDay`, `Native.Xyz`, or `Unsafe.DangerousAPI`, for example.</span></span> <span data-ttu-id="5fd53-145">Każda z następujących słów kluczowych informacje przydatne zabezpieczeń dla deweloperów korzystających z tej klasy, zgodnie z opisem w poniższej tabeli.</span><span class="sxs-lookup"><span data-stu-id="5fd53-145">Each of these keywords provides useful security information for developers using that class, as described in the following table.</span></span>  
  
|<span data-ttu-id="5fd53-146">Słowo kluczowe</span><span class="sxs-lookup"><span data-stu-id="5fd53-146">Keyword</span></span>|<span data-ttu-id="5fd53-147">Zagadnienia dotyczące bezpieczeństwa</span><span class="sxs-lookup"><span data-stu-id="5fd53-147">Security considerations</span></span>|  
|-------------|-----------------------------|  
|<span data-ttu-id="5fd53-148">**Bezpieczne**</span><span class="sxs-lookup"><span data-stu-id="5fd53-148">**safe**</span></span>|<span data-ttu-id="5fd53-149">Całkowicie nieszkodliwe dla żadnego kodu nawet złośliwy kod, aby wywołać.</span><span class="sxs-lookup"><span data-stu-id="5fd53-149">Completely harmless for any code, even malicious code, to call.</span></span> <span data-ttu-id="5fd53-150">Można tak samo jak inne kodu zarządzanego.</span><span class="sxs-lookup"><span data-stu-id="5fd53-150">Can be used just like other managed code.</span></span> <span data-ttu-id="5fd53-151">Na przykład funkcja, która pobiera godzinę jest zazwyczaj bezpieczne.</span><span class="sxs-lookup"><span data-stu-id="5fd53-151">For example, a function that gets the time of day is typically safe.</span></span>|  
|<span data-ttu-id="5fd53-152">**Natywny**</span><span class="sxs-lookup"><span data-stu-id="5fd53-152">**native**</span></span>|<span data-ttu-id="5fd53-153">Neutralnym poziomie bezpieczeństwa; oznacza to, że kodu niezarządzanego, który wymaga niezarządzany kod uprawnienia do wywoływania.</span><span class="sxs-lookup"><span data-stu-id="5fd53-153">Security-neutral; that is, unmanaged code that requires unmanaged code permission to call.</span></span> <span data-ttu-id="5fd53-154">Zabezpieczenia są sprawdzane, co uniemożliwia nieautoryzowanym wywołującego.</span><span class="sxs-lookup"><span data-stu-id="5fd53-154">Security is checked, which stops an unauthorized caller.</span></span>|  
|<span data-ttu-id="5fd53-155">**unsafe**</span><span class="sxs-lookup"><span data-stu-id="5fd53-155">**unsafe**</span></span>|<span data-ttu-id="5fd53-156">Niebezpieczny kod niezarządzany punkt wejścia z zabezpieczeniami pomijane.</span><span class="sxs-lookup"><span data-stu-id="5fd53-156">Potentially dangerous unmanaged code entry point with security suppressed.</span></span> <span data-ttu-id="5fd53-157">Deweloperzy należy zachować ostrożność największy podczas korzystania z takich kodu niezarządzanego, upewniając się, że inne ochrony znajdują się w miejscu, aby uniemożliwić luki w zabezpieczeniach.</span><span class="sxs-lookup"><span data-stu-id="5fd53-157">Developers should use the greatest caution when using such unmanaged code, making sure that other protections are in place to prevent a security vulnerability.</span></span> <span data-ttu-id="5fd53-158">Deweloperzy muszą być odpowiedzialne, jak system zabezpieczeń zastępuje to słowo kluczowe.</span><span class="sxs-lookup"><span data-stu-id="5fd53-158">Developers must be responsible, as this keyword overrides the security system.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="5fd53-159">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="5fd53-159">See Also</span></span>  
 [<span data-ttu-id="5fd53-160">Wytyczne dotyczące bezpiecznego programowania</span><span class="sxs-lookup"><span data-stu-id="5fd53-160">Secure Coding Guidelines</span></span>](../../../docs/standard/security/secure-coding-guidelines.md)
