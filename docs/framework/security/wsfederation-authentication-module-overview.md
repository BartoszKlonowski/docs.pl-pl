---
title: "Omówienie modułu uwierzytelniania WSFederation"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 02c4d5e8-f0a7-49ee-9cf5-3647578510ad
caps.latest.revision: "6"
author: BrucePerlerMS
ms.author: bruceper
manager: mbaldwin
ms.workload: dotnet
ms.openlocfilehash: b9e76cbfc0afc682f6a7cd0bc95c254d25f77954
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 12/22/2017
---
# <a name="wsfederation-authentication-module-overview"></a><span data-ttu-id="f8be2-102">Omówienie modułu uwierzytelniania WSFederation</span><span class="sxs-lookup"><span data-stu-id="f8be2-102">WSFederation Authentication Module Overview</span></span>
<span data-ttu-id="f8be2-103">Windows Identity Foundation (WIF) obejmuje obsługę uwierzytelniania federacyjnego w aplikacjach ASP.NET za pośrednictwem modułu uwierzytelniania WS-Federated (WS-FARMA).</span><span class="sxs-lookup"><span data-stu-id="f8be2-103">Windows Identity Foundation (WIF) includes support for federated authentication in ASP.NET applications through the WS-Federated Authentication Module (WS-FAM).</span></span> <span data-ttu-id="f8be2-104">Ten temat pomoże Ci zrozumieć sposób federacyjnych działania uwierzytelniania i jak z niego korzystać.</span><span class="sxs-lookup"><span data-stu-id="f8be2-104">This topic will help you understand how federated authentication works and how to use it.</span></span>  
  
### <a name="overview-of-federated-authentication"></a><span data-ttu-id="f8be2-105">Omówienie uwierzytelniania federacyjnego</span><span class="sxs-lookup"><span data-stu-id="f8be2-105">Overview of Federated Authentication</span></span>  
 <span data-ttu-id="f8be2-106">Uwierzytelnianie Sfederowane umożliwia zabezpieczeń tokenu usługi (STS) w jednej domenie zaufania zapewnienie informacji o uwierzytelnianiu usługi tokenu Zabezpieczającego w innej domenie zaufania, gdy istnieje relacja zaufania między tymi dwiema domenami.</span><span class="sxs-lookup"><span data-stu-id="f8be2-106">Federated authentication allows a Security Token Service (STS) in one trust domain to provide authentication information to an STS in another trust domain when there is a trust relationship between the two domains.</span></span> <span data-ttu-id="f8be2-107">Na przykład przedstawiono na poniższej ilustracji.</span><span class="sxs-lookup"><span data-stu-id="f8be2-107">An example of this is shown in the following illustration.</span></span>  
  
 <span data-ttu-id="f8be2-108">![Scenariusz uwierzytelniania federacyjnego](../../../docs/framework/security/media/federatedauthentication.gif "FederatedAuthentication")</span><span class="sxs-lookup"><span data-stu-id="f8be2-108">![Federation Authentication Scenario](../../../docs/framework/security/media/federatedauthentication.gif "FederatedAuthentication")</span></span>  
  
1.  <span data-ttu-id="f8be2-109">Klient w domenie zaufania firmy Fabrikam wysyła żądanie do aplikacji w domenie Contoso zaufania jednostki uzależnionej strony (RP).</span><span class="sxs-lookup"><span data-stu-id="f8be2-109">A client in the Fabrikam trust domain sends a request to a Relying Party (RP) application in the Contoso trust domain.</span></span>  
  
2.  <span data-ttu-id="f8be2-110">RP przekierowuje klienta do usługi tokenu Zabezpieczającego w relacji zaufania domeny Contoso.</span><span class="sxs-lookup"><span data-stu-id="f8be2-110">The RP redirects the client to an STS in the Contoso trust domain.</span></span> <span data-ttu-id="f8be2-111">Tej usługi STS nie ma informacji o kliencie.</span><span class="sxs-lookup"><span data-stu-id="f8be2-111">This STS has no knowledge of the client.</span></span>  
  
3.  <span data-ttu-id="f8be2-112">Usługa tokenu Zabezpieczającego firmy Contoso przekierowuje klienta do usługi tokenu Zabezpieczającego w domenie zaufania firmy Fabrikam, z którym zaufania domeny Contoso ma relację zaufania.</span><span class="sxs-lookup"><span data-stu-id="f8be2-112">The Contoso STS redirects the client to an STS in the Fabrikam trust domain, with which the Contoso trust domain has a trust relationship.</span></span>  
  
4.  <span data-ttu-id="f8be2-113">Usługa tokenu Zabezpieczającego firmy Fabrikam weryfikuje tożsamości klienta i wystawia token zabezpieczający Contoso STS.</span><span class="sxs-lookup"><span data-stu-id="f8be2-113">The Fabrikam STS verifies the client’s identity and issues a security token to the Contoso STS.</span></span>  
  
5.  <span data-ttu-id="f8be2-114">Usługa tokenu Zabezpieczającego firmy Contoso używa tokenu Fabrikam do utworzenia własnego tokenu, które mogą być używane przez planu odzyskiwania i wysyła je do planu odzyskiwania.</span><span class="sxs-lookup"><span data-stu-id="f8be2-114">The Contoso STS uses the Fabrikam token to create its own token that can be used by the RP and sends it to the RP.</span></span>  
  
6.  <span data-ttu-id="f8be2-115">RP wyodrębnia oświadczeń klienta z tokenu zabezpieczeń i sprawia, że decyzję dotyczącą autoryzacji.</span><span class="sxs-lookup"><span data-stu-id="f8be2-115">The RP extracts the client’s claims from the security token and makes an authorization decision.</span></span>  
  
### <a name="using-the-federated-authentication-module-with-aspnet"></a><span data-ttu-id="f8be2-116">Program ASP.NET przy użyciu modułu uwierzytelniania federacyjnego</span><span class="sxs-lookup"><span data-stu-id="f8be2-116">Using the Federated Authentication Module with ASP.NET</span></span>  
 <span data-ttu-id="f8be2-117"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule>(WS-FARMA) jest moduł protokołu HTTP, które umożliwia dodanie uwierzytelniania federacyjnego do [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f8be2-117"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule> (WS-FAM) is an HTTP module that lets you add federated authentication to an [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] application.</span></span> <span data-ttu-id="f8be2-118">Uwierzytelnianie Sfederowane umożliwia logika uwierzytelniania są obsługiwane przez usługę STS i pozwala skupić się na temat pisania logiki biznesowej.</span><span class="sxs-lookup"><span data-stu-id="f8be2-118">Federated authentication lets authentication logic be handled by the STS and lets you focus on writing business logic.</span></span>  
  
 <span data-ttu-id="f8be2-119">Możesz skonfigurować WS-FARMA, aby określić STS, do których mają być przekierowywane nieuwierzytelnione żądania.</span><span class="sxs-lookup"><span data-stu-id="f8be2-119">You configure the WS-FAM to specify the STS to which non-authenticated requests should be redirected.</span></span> <span data-ttu-id="f8be2-120">WIF umożliwia uwierzytelnianie użytkowników na dwa sposoby:</span><span class="sxs-lookup"><span data-stu-id="f8be2-120">WIF lets you authenticate a user in two ways:</span></span>  
  
1.  <span data-ttu-id="f8be2-121">Przekierowanie pasywnym: gdy nieuwierzytelniony użytkownik próbuje uzyskać dostęp do chronionych zasobów i chcesz po prostu przekierowanie do usługi tokenu Zabezpieczającego bez konieczności strony logowania, a następnie jest prawo podejście.</span><span class="sxs-lookup"><span data-stu-id="f8be2-121">Passive redirect: When an unauthenticated user tries to access a protected resource, and you want to simply redirect them to an STS without requiring a login page, then this is the right approach.</span></span> <span data-ttu-id="f8be2-122">Usługa tokenu Zabezpieczającego weryfikuje tożsamość użytkownika i wystawia token zabezpieczający, który zawiera oświadczenia właściwe dla tego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="f8be2-122">The STS verifies the user’s identity, and issues a security token that contains the appropriate claims for that user.</span></span> <span data-ttu-id="f8be2-123">Ta opcja wymaga protokołu WS-FARMA do dodania w potoku moduły HTTP.</span><span class="sxs-lookup"><span data-stu-id="f8be2-123">This option requires the WS-FAM to be added in the HTTP Modules pipeline.</span></span> <span data-ttu-id="f8be2-124">Tożsamość i narzędzie dostępu do programu Visual Studio 2012 służy do modyfikowania pliku konfiguracji aplikacji do użycia protokołu WS-FARMA i możliwości utworzenia federacji z usługi tokenu Zabezpieczającego.</span><span class="sxs-lookup"><span data-stu-id="f8be2-124">You can use the Identity and Access Tool for Visual Studio 2012 to modify your application’s configuration file to use the WS-FAM and to federate with an STS.</span></span> <span data-ttu-id="f8be2-125">Aby uzyskać więcej informacji, zobacz [tożsamości i dostępu do narzędzi dla programu Visual Studio 2012](../../../docs/framework/security/identity-and-access-tool-for-vs.md).</span><span class="sxs-lookup"><span data-stu-id="f8be2-125">For more information, see [Identity and Access Tool for Visual Studio 2012](../../../docs/framework/security/identity-and-access-tool-for-vs.md).</span></span>  
  
2.  <span data-ttu-id="f8be2-126">Możesz wywołać <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignIn%2A?displayProperty=nameWithType> metody lub <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectToIdentityProvider%2A> metody z kodu powiązanego do strony logowania w aplikacji planu odzyskiwania.</span><span class="sxs-lookup"><span data-stu-id="f8be2-126">You can call the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignIn%2A?displayProperty=nameWithType> method or the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectToIdentityProvider%2A> method from the code-behind for a sign-in page in your RP application.</span></span>  
  
 <span data-ttu-id="f8be2-127">W pasywnym przekierowania cała komunikacja odbywa się za pośrednictwem odpowiedzi/przekierowanie z klienta (zazwyczaj przeglądarki).</span><span class="sxs-lookup"><span data-stu-id="f8be2-127">In passive redirect, all communication is performed through response/redirect from the client (typically a browser).</span></span> <span data-ttu-id="f8be2-128">FARMA WS można dodać do potoku HTTP aplikacji, w którym go oczekuje dla nieuwierzytelniony użytkownik zażąda i przekierowuje użytkowników do usługi STS określisz.</span><span class="sxs-lookup"><span data-stu-id="f8be2-128">You can add the WS-FAM to your application’s HTTP pipeline, where it watches for unauthenticated user requests and redirects users to the STS you specify.</span></span>  
  
 <span data-ttu-id="f8be2-129">FARMA WS zgłasza również kilka zdarzeń, które pozwalają dostosować jego funkcjonalność w [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f8be2-129">The WS-FAM also raises several events that let you customize its functionality in an [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] application.</span></span>  
  
### <a name="how-the-ws-fam-works"></a><span data-ttu-id="f8be2-130">Jak działa FARMA WS</span><span class="sxs-lookup"><span data-stu-id="f8be2-130">How the WS-FAM Works</span></span>  
 <span data-ttu-id="f8be2-131">FARMA WS jest zaimplementowana w <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> klasy.</span><span class="sxs-lookup"><span data-stu-id="f8be2-131">The WS-FAM is implemented in the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> class.</span></span> <span data-ttu-id="f8be2-132">Zazwyczaj dodaje się FARMA WS do potoku HTTP z Twojej [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] RP aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f8be2-132">Typically, you add the WS-FAM to the HTTP pipeline of your [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] RP application.</span></span> <span data-ttu-id="f8be2-133">Gdy nieuwierzytelniony użytkownik próbuje uzyskać dostęp do chronionych zasobów, RP zwraca odpowiedź HTTP "401 Odmowa autoryzacji".</span><span class="sxs-lookup"><span data-stu-id="f8be2-133">When an unauthenticated user tries to access a protected resource, the RP returns a "401 authorization denied" HTTP response.</span></span> <span data-ttu-id="f8be2-134">FARMA WS przechwytuje tej odpowiedzi zamiast zezwalać otrzymywanie go, a następnie go przekierowuje użytkownika do określonej usługi STS.</span><span class="sxs-lookup"><span data-stu-id="f8be2-134">The WS-FAM intercepts this response instead of allowing the client to receive it, then it redirects the user to the specified STS.</span></span> <span data-ttu-id="f8be2-135">Usługa tokenu Zabezpieczającego wystawia token zabezpieczający, który ponownie przechwytuje WS-FARMA.</span><span class="sxs-lookup"><span data-stu-id="f8be2-135">The STS issues a security token, which the WS-FAM again intercepts.</span></span> <span data-ttu-id="f8be2-136">FARMA WS używa tokenu do utworzenia wystąpienia <xref:System.Security.Claims.ClaimsPrincipal> dla tego uwierzytelnionego użytkownika, co pozwala regular [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] mechanizmów autoryzacji do działania.</span><span class="sxs-lookup"><span data-stu-id="f8be2-136">The WS-FAM uses the token to create an instance of <xref:System.Security.Claims.ClaimsPrincipal> for the authenticated user, which enables regular [!INCLUDE[dnprdnshort](../../../includes/dnprdnshort-md.md)] authorization mechanisms to function.</span></span>  
  
 <span data-ttu-id="f8be2-137">Ponieważ HTTP jest bezstanowych, potrzebujemy sposób, aby uniknąć powtarzania całego tego procesu za każdym razem, gdy użytkownik spróbuje uzyskać dostęp do innego zasobu chronionego.</span><span class="sxs-lookup"><span data-stu-id="f8be2-137">Because HTTP is stateless, we need a way to avoid repeating this whole process every time that the user tries to access another protected resource.</span></span> <span data-ttu-id="f8be2-138">Jest to, gdy <xref:System.IdentityModel.Services.SessionAuthenticationModule> polega na.</span><span class="sxs-lookup"><span data-stu-id="f8be2-138">This is where the <xref:System.IdentityModel.Services.SessionAuthenticationModule> comes in.</span></span> <span data-ttu-id="f8be2-139">Gdy usługa tokenu Zabezpieczającego wystawia token zabezpieczający dla użytkownika, <xref:System.IdentityModel.Services.SessionAuthenticationModule> również tworzy tokenu zabezpieczającego sesji użytkownika i umieszczenie go w pliku cookie.</span><span class="sxs-lookup"><span data-stu-id="f8be2-139">When the STS issues a security token for the user, <xref:System.IdentityModel.Services.SessionAuthenticationModule> also creates a session security token for the user and puts it in a cookie.</span></span> <span data-ttu-id="f8be2-140">W kolejnych żądań <xref:System.IdentityModel.Services.SessionAuthenticationModule> przechwytuje ten plik cookie i używa go do rekonstrukcji użytkownika <xref:System.Security.Claims.ClaimsPrincipal>.</span><span class="sxs-lookup"><span data-stu-id="f8be2-140">On subsequent requests, the <xref:System.IdentityModel.Services.SessionAuthenticationModule> intercepts this cookie and uses it to reconstruct the user’s <xref:System.Security.Claims.ClaimsPrincipal>.</span></span>  
  
 <span data-ttu-id="f8be2-141">Na poniższym diagramie przedstawiono ogólny przepływ informacji w przypadku przekierowania pasywnych.</span><span class="sxs-lookup"><span data-stu-id="f8be2-141">The following diagram shows the overall flow of information in the passive redirect case.</span></span> <span data-ttu-id="f8be2-142">Żądanie jest automatycznie przekierowywane za pośrednictwem usługi STS ustanowienie poświadczenia bez strony logowania:</span><span class="sxs-lookup"><span data-stu-id="f8be2-142">The request is automatically redirected via the STS to establish credentials without a login page:</span></span>  
  
 <span data-ttu-id="f8be2-143">![Diagram czasowa znaku &#45; za pomocą przekierowania pasywnym](../../../docs/framework/security/media/signinusingpassiveredirect.gif "SignInUsingPassiveRedirect")</span><span class="sxs-lookup"><span data-stu-id="f8be2-143">![Timing diagram for sign&#45;in with passive redirect](../../../docs/framework/security/media/signinusingpassiveredirect.gif "SignInUsingPassiveRedirect")</span></span>  
  
 <span data-ttu-id="f8be2-144">Na poniższym diagramie przedstawiono bardziej szczegółowo na co się dzieje, gdy użytkownik został uwierzytelniony za pomocą usługi STS i ich tokeny zabezpieczające są przetwarzane przez <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>:</span><span class="sxs-lookup"><span data-stu-id="f8be2-144">The following diagram shows more detail on what happens when the user has authenticated to the STS and their security tokens are processed by the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>:</span></span>  
  
 <span data-ttu-id="f8be2-145">![Czasy do przetwarzania tokenu przy użyciu przekierowania pasywnym](../../../docs/framework/security/media/signinusingpassiveredirect-tokenprocessing.gif "SignInUsingPassiveRedirect_TokenProcessing")</span><span class="sxs-lookup"><span data-stu-id="f8be2-145">![Timing for token processing with passive redirect](../../../docs/framework/security/media/signinusingpassiveredirect-tokenprocessing.gif "SignInUsingPassiveRedirect_TokenProcessing")</span></span>  
  
 <span data-ttu-id="f8be2-146">Na poniższym diagramie przedstawiono bardziej szczegółowo na co się dzieje, gdy tokeny zabezpieczające użytkownika ma zostać zserializowane do plików cookie i są przechwytywane przez <xref:System.IdentityModel.Services.SessionAuthenticationModule>:</span><span class="sxs-lookup"><span data-stu-id="f8be2-146">The following diagram shows more detail on what happens when the user’s security tokens have been serialized into cookies and are intercepted by the <xref:System.IdentityModel.Services.SessionAuthenticationModule>:</span></span>  
  
 <span data-ttu-id="f8be2-147">![SAM chronometrażu diagram przedstawiający znak &#45; za pomocą formantów](../../../docs/framework/security/media/signinusingconrols-sam.gif "SignInUsingConrols_SAM")</span><span class="sxs-lookup"><span data-stu-id="f8be2-147">![SAM timing diagram showing sign&#45;in using controls](../../../docs/framework/security/media/signinusingconrols-sam.gif "SignInUsingConrols_SAM")</span></span>  
  
### <a name="events"></a><span data-ttu-id="f8be2-148">Zdarzenia</span><span class="sxs-lookup"><span data-stu-id="f8be2-148">Events</span></span>  
 <span data-ttu-id="f8be2-149"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule>, <xref:System.IdentityModel.Services.SessionAuthenticationModule>i ich klasy nadrzędnej <xref:System.IdentityModel.Services.HttpModuleBase>, wywoływanie zdarzeń na różnych etapach przetwarzania żądania HTTP.</span><span class="sxs-lookup"><span data-stu-id="f8be2-149"><xref:System.IdentityModel.Services.WSFederationAuthenticationModule>, <xref:System.IdentityModel.Services.SessionAuthenticationModule>, and their parent class, <xref:System.IdentityModel.Services.HttpModuleBase>, raise events at various stages of processing of an HTTP request.</span></span> <span data-ttu-id="f8be2-150">Można obsługiwać te zdarzenia w `global.asax` pliku z [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f8be2-150">You can handle these events in the `global.asax` file of your [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] application.</span></span>  
  
-   <span data-ttu-id="f8be2-151">Infrastruktury ASP.NET wywołuje modułu <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> metody można zainicjować modułu.</span><span class="sxs-lookup"><span data-stu-id="f8be2-151">The ASP.NET infrastructure invokes the module’s <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> method to initialize the module.</span></span>  
  
-   <span data-ttu-id="f8be2-152"><xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfigurationCreated?displayProperty=nameWithType> Zdarzenie jest zgłaszane, gdy wywołuje infrastruktury ASP.NET <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> metody po raz pierwszy na jeden z modułów aplikacji, które pochodzą z <xref:System.IdentityModel.Services.HttpModuleBase>.</span><span class="sxs-lookup"><span data-stu-id="f8be2-152">The <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfigurationCreated?displayProperty=nameWithType> event is raised when the ASP.NET infrastructure invokes the <xref:System.IdentityModel.Services.HttpModuleBase.Init%2A> method for the first time on one of the application’s modules that derive from <xref:System.IdentityModel.Services.HttpModuleBase>.</span></span> <span data-ttu-id="f8be2-153">Ta metoda uzyskuje dostęp do statycznych <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfiguration%2A?displayProperty=nameWithType> właściwość, która powoduje, że konfiguracja załadować z pliku Web.config.</span><span class="sxs-lookup"><span data-stu-id="f8be2-153">This method accesses the static <xref:System.IdentityModel.Services.FederatedAuthentication.FederationConfiguration%2A?displayProperty=nameWithType> property, which causes configuration to be loaded from the Web.config file.</span></span> <span data-ttu-id="f8be2-154">To zdarzenie jest wywoływane tylko po raz pierwszy uzyskać dostępu do tej właściwości.</span><span class="sxs-lookup"><span data-stu-id="f8be2-154">This event is only raised the first time this property is accessed.</span></span> <span data-ttu-id="f8be2-155"><xref:System.IdentityModel.Services.Configuration.FederationConfiguration> Obiekt, który został zainicjowany z konfiguracji jest możliwy za pośrednictwem <xref:System.IdentityModel.Services.Configuration.FederationConfigurationCreatedEventArgs.FederationConfiguration%2A?displayProperty=nameWithType> właściwości w obsłudze zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="f8be2-155">The <xref:System.IdentityModel.Services.Configuration.FederationConfiguration> object that is initialized from configuration can be accessed through the <xref:System.IdentityModel.Services.Configuration.FederationConfigurationCreatedEventArgs.FederationConfiguration%2A?displayProperty=nameWithType> property in an event handler.</span></span> <span data-ttu-id="f8be2-156">To zdarzenie służy do modyfikowania konfiguracji przed jej zastosowaniem do żadnych modułów.</span><span class="sxs-lookup"><span data-stu-id="f8be2-156">You can use this event to modify the configuration before it is applied to any modules.</span></span> <span data-ttu-id="f8be2-157">Można dodać obsługi dla tego zdarzenia w metody Application_Start:</span><span class="sxs-lookup"><span data-stu-id="f8be2-157">You can add a handler for this event in the Application_Start method:</span></span>  
  
    ```  
    void Application_Start(object sender, EventArgs e)  
    {  
        FederatedAuthentication.FederationConfigurationCreated += new EventHandler<FederationConfigurationCreatedEventArgs>(FederatedAuthentication_FederationConfigurationCreated);  
    }  
    ```  
  
     <span data-ttu-id="f8be2-158">Każdy moduł zastępuje <xref:System.IdentityModel.Services.HttpModuleBase.InitializeModule%2A?displayProperty=nameWithType> i <xref:System.IdentityModel.Services.HttpModuleBase.InitializePropertiesFromConfiguration%2A?displayProperty=nameWithType> metody abstrakcyjnej.</span><span class="sxs-lookup"><span data-stu-id="f8be2-158">Each module overrides the <xref:System.IdentityModel.Services.HttpModuleBase.InitializeModule%2A?displayProperty=nameWithType> and <xref:System.IdentityModel.Services.HttpModuleBase.InitializePropertiesFromConfiguration%2A?displayProperty=nameWithType> abstract methods.</span></span> <span data-ttu-id="f8be2-159">Pierwsza z tych metod dodaje obsługę zdarzeń potoku platformy ASP.NET, które mogą być przydatne do modułu.</span><span class="sxs-lookup"><span data-stu-id="f8be2-159">The first of these methods adds handlers for ASP.NET pipeline events that are of interest to the module.</span></span> <span data-ttu-id="f8be2-160">W większości przypadków wystarczy modułu domyślną implementację.</span><span class="sxs-lookup"><span data-stu-id="f8be2-160">In most cases the module’s default implementation will suffice.</span></span> <span data-ttu-id="f8be2-161">Drugi z tych metod inicjuje właściwości modułu z jego <xref:System.IdentityModel.Services.HttpModuleBase.FederationConfiguration%2A?displayProperty=nameWithType> właściwości.</span><span class="sxs-lookup"><span data-stu-id="f8be2-161">The second of these methods initializes the module’s properties from its <xref:System.IdentityModel.Services.HttpModuleBase.FederationConfiguration%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="f8be2-162">(Jest to kopia konfiguracji, który został wcześniej załadowany). Należy przesłonić tę metodę drugiego, jeśli mają być obsługiwane w klasach pochodzących od inicjowania nowe właściwości z konfiguracji <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> lub <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span><span class="sxs-lookup"><span data-stu-id="f8be2-162">(This is a copy of the configuration that was loaded previously.) You may need to override this second method if you want to support the initialization of new properties from configuration in classes that you derive from <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> or <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span></span> <span data-ttu-id="f8be2-163">W takich przypadkach również konieczne będzie dziedziczyć odpowiednia konfiguracja obiekty obsługują właściwości konfiguracji dodano; na przykład z <xref:System.IdentityModel.Configuration.IdentityConfiguration>, <xref:System.IdentityModel.Services.Configuration.WsFederationConfiguration>, lub <xref:System.IdentityModel.Services.Configuration.FederationConfiguration>.</span><span class="sxs-lookup"><span data-stu-id="f8be2-163">In such cases you would also need to derive from the appropriate configuration objects to support the added configuration properties; for example, from <xref:System.IdentityModel.Configuration.IdentityConfiguration>, <xref:System.IdentityModel.Services.Configuration.WsFederationConfiguration>, or <xref:System.IdentityModel.Services.Configuration.FederationConfiguration>.</span></span>  
  
-   <span data-ttu-id="f8be2-164">FARMA WS zgłasza <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenReceived> zdarzenie, gdy jego przechwytuje tokenu zabezpieczającego, które zostały wystawione przez usługę STS.</span><span class="sxs-lookup"><span data-stu-id="f8be2-164">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenReceived> event when it intercepts a security token that has been issued by the STS.</span></span>  
  
-   <span data-ttu-id="f8be2-165">FARMA WS zgłasza <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenValidated> zdarzenia po został zweryfikowany tokenu.</span><span class="sxs-lookup"><span data-stu-id="f8be2-165">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SecurityTokenValidated> event after it has validated the token.</span></span>  
  
-   <span data-ttu-id="f8be2-166"><xref:System.IdentityModel.Services.SessionAuthenticationModule> Zgłasza <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenCreated> zdarzeń podczas tworzenia tokenu zabezpieczającego sesji użytkownika.</span><span class="sxs-lookup"><span data-stu-id="f8be2-166">The <xref:System.IdentityModel.Services.SessionAuthenticationModule> raises the <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenCreated> event when it creates a session security token for the user.</span></span>  
  
-   <span data-ttu-id="f8be2-167"><xref:System.IdentityModel.Services.SessionAuthenticationModule> Zgłasza <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenReceived> zdarzenie, gdy przechwytuje on kolejne żądania z pliku cookie, który zawiera token zabezpieczający sesji.</span><span class="sxs-lookup"><span data-stu-id="f8be2-167">The <xref:System.IdentityModel.Services.SessionAuthenticationModule> raises the <xref:System.IdentityModel.Services.SessionAuthenticationModule.SessionSecurityTokenReceived> event when it intercepts subsequent requests with the cookie that contains the session security token.</span></span>  
  
-   <span data-ttu-id="f8be2-168">Przed FARMA WS przekierowuje użytkownika do wystawcy, zgłasza <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider> zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="f8be2-168">Before the WS-FAM redirects the user to the issuer, it raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider> event.</span></span> <span data-ttu-id="f8be2-169">WS-Federation żądania logowania jest dostępna za pośrednictwem <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs.SignInRequestMessage%2A> właściwość <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs> przekazany w zdarzeniu.</span><span class="sxs-lookup"><span data-stu-id="f8be2-169">The WS-Federation sign-in request is available through the <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs.SignInRequestMessage%2A> property of the <xref:System.IdentityModel.Services.RedirectingToIdentityProviderEventArgs> passed in the event.</span></span> <span data-ttu-id="f8be2-170">Można zmodyfikować żądanie przed wysłaniem to wystawcy.</span><span class="sxs-lookup"><span data-stu-id="f8be2-170">You may choose to modify the request before sending this out to the issuer.</span></span>  
  
-   <span data-ttu-id="f8be2-171">FARMA WS zgłasza <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignedIn> zdarzenie, gdy plik cookie jest pomyślnie zapisane i użytkownik jest zalogowany.</span><span class="sxs-lookup"><span data-stu-id="f8be2-171">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SignedIn> event when the cookie is successfully written and the user is signed in.</span></span>  
  
-   <span data-ttu-id="f8be2-172">FARMA WS zgłasza <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SigningOut> zdarzeń jeden raz w każdym sesji jako sesja zostaje zamknięte w dół dla każdego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="f8be2-172">The WS-FAM raises the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.SigningOut> event one time per session as the session is being closed down for each user.</span></span> <span data-ttu-id="f8be2-173">Nie jest wywoływane, gdy sesja jest zamknięte po stronie klienta (na przykład przez usunięcie pliku cookie sesji).</span><span class="sxs-lookup"><span data-stu-id="f8be2-173">It is not raised if the session is closed down on the client-side (for example, by deleting the session cookie).</span></span> <span data-ttu-id="f8be2-174">W środowisku logowania jednokrotnego usługi STS protokołu IP mogą żądać każdego planu odzyskiwania, aby się wylogować, zbyt.</span><span class="sxs-lookup"><span data-stu-id="f8be2-174">In an SSO environment, the IP-STS can request each RP to sign out, too.</span></span> <span data-ttu-id="f8be2-175">To spowoduje również zgłosić to zdarzenie, z <xref:System.IdentityModel.Services.SigningOutEventArgs.IsIPInitiated%2A> ustawioną `true`.</span><span class="sxs-lookup"><span data-stu-id="f8be2-175">This will also raise this event, with <xref:System.IdentityModel.Services.SigningOutEventArgs.IsIPInitiated%2A> set to `true`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f8be2-176">Nie należy używać <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> właściwości podczas wszystkie zdarzenia wygenerowane przez <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> lub <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span><span class="sxs-lookup"><span data-stu-id="f8be2-176">You should not use the <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> property during any event raised by <xref:System.IdentityModel.Services.WSFederationAuthenticationModule> or <xref:System.IdentityModel.Services.SessionAuthenticationModule>.</span></span> <span data-ttu-id="f8be2-177">Jest to spowodowane <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> jest ustawiany po procesie uwierzytelniania, gdy zdarzenia są wywoływane podczas procesu uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="f8be2-177">This is because <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=nameWithType> is set after the authentication process, while events are raised during the authentication process.</span></span>  
  
### <a name="configuration-of-federated-authentication"></a><span data-ttu-id="f8be2-178">Konfiguracja uwierzytelniania federacyjnego</span><span class="sxs-lookup"><span data-stu-id="f8be2-178">Configuration of Federated Authentication</span></span>  
 <span data-ttu-id="f8be2-179">FARMA WS i SAM są skonfigurowane za pomocą [ \<federationConfiguration >](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md) elementu.</span><span class="sxs-lookup"><span data-stu-id="f8be2-179">The WS-FAM and SAM are configured through the [\<federationConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md) element.</span></span> <span data-ttu-id="f8be2-180">[ \<WsFederation >](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/wsfederation.md) element podrzędny konfiguruje domyślne wartości dla właściwości WS-FARMA; takich jak <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Issuer%2A> właściwości i <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Realm%2A> właściwości.</span><span class="sxs-lookup"><span data-stu-id="f8be2-180">The [\<wsFederation>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/wsfederation.md) child element configures default values for the WS-FAM properties; such as the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Issuer%2A> property and the <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.Realm%2A> property.</span></span> <span data-ttu-id="f8be2-181">(Te wartości można zmieniać na podstawie danego żądania przez zapewnienie obsługi dla niektórych zdarzeń usługi WS-FARMA; na przykład <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider>.) Program obsługi plików cookie, który jest używany przez Menedżera kont zabezpieczeń są konfigurowane za pomocą [ \<cookieHandler >](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/cookiehandler.md) element podrzędny.</span><span class="sxs-lookup"><span data-stu-id="f8be2-181">(These values can be changed on a per request basis by providing handlers for some of the WS-FAM events; for example, <xref:System.IdentityModel.Services.WSFederationAuthenticationModule.RedirectingToIdentityProvider>.) The cookie handler that is used by the SAM is configured through the [\<cookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/cookiehandler.md) child element.</span></span> <span data-ttu-id="f8be2-182">WIF udostępnia domyślny plik cookie program obsługi w <xref:System.IdentityModel.Services.ChunkedCookieHandler> klasy, która może mieć rozmiaru fragmentu ustawiana za pośrednictwem [ \<chunkedCookieHandler >](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/chunkedcookiehandler.md) elementu.</span><span class="sxs-lookup"><span data-stu-id="f8be2-182">WIF provides a default cookie handler implemented in the <xref:System.IdentityModel.Services.ChunkedCookieHandler> class that can have its chunk size set through the [\<chunkedCookieHandler>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/chunkedcookiehandler.md) element.</span></span> <span data-ttu-id="f8be2-183">`<federationConfiguration>` Odwołania do elementu <xref:System.IdentityModel.Configuration.IdentityConfiguration>, który udostępnia konfigurację dla innych składników WIF używane w aplikacji, takich jak <xref:System.Security.Claims.ClaimsAuthenticationManager> i <xref:System.Security.Claims.ClaimsAuthorizationManager>.</span><span class="sxs-lookup"><span data-stu-id="f8be2-183">The `<federationConfiguration>` element references an <xref:System.IdentityModel.Configuration.IdentityConfiguration>, which provides configuration for other WIF components used in the application, such as the <xref:System.Security.Claims.ClaimsAuthenticationManager> and the <xref:System.Security.Claims.ClaimsAuthorizationManager>.</span></span> <span data-ttu-id="f8be2-184">Konfiguracja tożsamości odwołania mogą dotyczyć jawnie określając nazwane [ \<identityConfiguration >](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/identityconfiguration.md) element `identityConfigurationName` atrybutu `<federationConfiguration>` elementu.</span><span class="sxs-lookup"><span data-stu-id="f8be2-184">The identity configuration may be referenced explicitly by specifying a named [\<identityConfiguration>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/identityconfiguration.md) element in the `identityConfigurationName` attribute of the `<federationConfiguration>` element.</span></span> <span data-ttu-id="f8be2-185">Jeśli konfiguracja tożsamości nie jest wywoływane jawnie, będzie używany domyślnej konfiguracji tożsamości.</span><span class="sxs-lookup"><span data-stu-id="f8be2-185">If the identity configuration is not referenced explicitly, the default identity configuration will be used.</span></span>  
  
 <span data-ttu-id="f8be2-186">Następujący kod XML zawiera konfigurację programu ASP.NET jednostki uzależnionej (RP) aplikacji.</span><span class="sxs-lookup"><span data-stu-id="f8be2-186">The following XML shows a configuration of an ASP.NET relying party (RP) application.</span></span> <span data-ttu-id="f8be2-187"><xref:System.IdentityModel.Configuration.SystemIdentityModelSection> i <xref:System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection> sekcji konfiguracji są dodawane w obszarze `<configSections>` elementu.</span><span class="sxs-lookup"><span data-stu-id="f8be2-187">The <xref:System.IdentityModel.Configuration.SystemIdentityModelSection> and <xref:System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection> configuration sections are added under the `<configSections>` element.</span></span> <span data-ttu-id="f8be2-188">SAM i WS-FARMA są dodawane do modułów HTTP w obszarze `<system.webServer>` / `<modules>` elementu.</span><span class="sxs-lookup"><span data-stu-id="f8be2-188">The SAM and WS-FAM are added to the HTTP Modules under the `<system.webServer>`/`<modules>` element.</span></span> <span data-ttu-id="f8be2-189">Na koniec składników WIF są skonfigurowane w obszarze `<system.identityModel>` / `<identityConfiguration>` i `<system.identityModel.services>` / `<federationConfiguration>` elementów.</span><span class="sxs-lookup"><span data-stu-id="f8be2-189">Finally the WIF components are configured under the `<system.identityModel>`/`<identityConfiguration>` and `<system.identityModel.services>`/`<federationConfiguration>` elements.</span></span> <span data-ttu-id="f8be2-190">Ta konfiguracja określa obsługi podzielony plik cookie jest domyślny program obsługi plików cookie i nie jest typem obsługi plików cookie określona w `<cookieHandler>` elementu.</span><span class="sxs-lookup"><span data-stu-id="f8be2-190">This configuration specifies the chunked cookie handler as it is the default cookie handler and there is not a cookie handler type specified in the `<cookieHandler>` element.</span></span>  
  
> [!WARNING]
>  <span data-ttu-id="f8be2-191">W poniższym przykładzie zarówno `requireHttps` atrybutu `<wsFederation>` elementu i `requireSsl` atrybutu `<cookieHandler>` są elementu `false`.</span><span class="sxs-lookup"><span data-stu-id="f8be2-191">In the following example, both the `requireHttps` attribute of the `<wsFederation>` element and the `requireSsl` attribute of the `<cookieHandler>` element are `false`.</span></span> <span data-ttu-id="f8be2-192">Stanowi to potencjalne zagrożenie bezpieczeństwa.</span><span class="sxs-lookup"><span data-stu-id="f8be2-192">This presents a potential security threat.</span></span> <span data-ttu-id="f8be2-193">W środowisku produkcyjnym, należy ustawić obie te wartości `true`.</span><span class="sxs-lookup"><span data-stu-id="f8be2-193">In production, both these values should be set `true`.</span></span>  
  
```xml  
<configuration>  
  <configSections>  
    <section name="system.identityModel" type="System.IdentityModel.Configuration.SystemIdentityModelSection, System.IdentityModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089" />  
    <section name="system.identityModel.services" type="System.IdentityModel.Services.Configuration.SystemIdentityModelServicesSection, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089" />  
  </configSections>  
  
  ...  
  
  <system.webServer>  
    <modules>  
      <add name="WSFederationAuthenticationModule" type="System.IdentityModel.Services.WSFederationAuthenticationModule, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" preCondition="managedHandler" />  
      <add name="SessionAuthenticationModule" type="System.IdentityModel.Services.SessionAuthenticationModule, System.IdentityModel.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" preCondition="managedHandler" />  
    </modules>  
  </system.webServer>  
  
  <system.identityModel>  
    <identityConfiguration>  
      <audienceUris>  
        <add value="http://localhost:50969/" />  
      </audienceUris>  
      <certificateValidation certificateValidationMode="None" />  
      <issuerNameRegistry type="System.IdentityModel.Tokens.ConfigurationBasedIssuerNameRegistry, System.IdentityModel, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089">  
        <trustedIssuers>  
          <add thumbprint="9B74CB2F320F7AAFC156E1252270B1DC01EF40D0" name="LocalSTS" />  
        </trustedIssuers>  
      </issuerNameRegistry>  
    </identityConfiguration>  
  </system.identityModel>  
  <system.identityModel.services>  
    <federationConfiguration>  
      <wsFederation passiveRedirectEnabled="true" issuer="http://localhost:15839/wsFederationSTS/Issue" realm="http://localhost:50969/" reply="http://localhost:50969/" requireHttps="false" />  
      <cookieHandler requireSsl="false" />  
    </federationConfiguration>  
  </system.identityModel.services>  
</configuration>  
```  
  
## <a name="see-also"></a><span data-ttu-id="f8be2-194">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="f8be2-194">See Also</span></span>  
 <xref:System.IdentityModel.Services.SessionAuthenticationModule>  
 <xref:System.IdentityModel.Services.WSFederationAuthenticationModule>  
 [<span data-ttu-id="f8be2-195">\<federationConfiguration ></span><span class="sxs-lookup"><span data-stu-id="f8be2-195">\<federationConfiguration></span></span>](../../../docs/framework/configure-apps/file-schema/windows-identity-foundation/federationconfiguration.md)
