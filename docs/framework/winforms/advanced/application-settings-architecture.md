---
title: Architektura ustawień aplikacji
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- application settings [Windows Forms], architecture
ms.assetid: c8eb2ad0-fac6-4ea2-9140-675a4a44d562
ms.openlocfilehash: 078b5f3fc1cd4273af282580f41e68ca9bd8ff51
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/12/2020
ms.locfileid: "79182626"
---
# <a name="application-settings-architecture"></a><span data-ttu-id="e072b-102">Architektura ustawień aplikacji</span><span class="sxs-lookup"><span data-stu-id="e072b-102">Application Settings Architecture</span></span>
<span data-ttu-id="e072b-103">W tym temacie opisano, jak działa architektura Ustawień aplikacji i eksploruje zaawansowane funkcje architektury, takie jak zgrupowane ustawienia i klucze ustawień.</span><span class="sxs-lookup"><span data-stu-id="e072b-103">This topic describes how the Application Settings architecture works, and explores advanced features of the architecture, such as grouped settings and settings keys.</span></span>

 <span data-ttu-id="e072b-104">Architektura ustawień aplikacji obsługuje definiowanie silnie wpisanych ustawień za pomocą aplikacji lub zakresu użytkownika i utrwalanie ustawień między sesjami aplikacji.</span><span class="sxs-lookup"><span data-stu-id="e072b-104">The application settings architecture supports defining strongly typed settings with either application or user scope, and persisting the settings between application sessions.</span></span> <span data-ttu-id="e072b-105">Architektura zapewnia domyślny aparat trwałości do zapisywania ustawień i ładowania ich z lokalnego systemu plików.</span><span class="sxs-lookup"><span data-stu-id="e072b-105">The architecture provides a default persistence engine for saving settings to and loading them from the local file system.</span></span> <span data-ttu-id="e072b-106">Architektura definiuje również interfejsy do dostarczania aparatu trwałości niestandardowe.</span><span class="sxs-lookup"><span data-stu-id="e072b-106">The architecture also defines interfaces for supplying a custom persistence engine.</span></span>

 <span data-ttu-id="e072b-107">Interfejsy są dostarczane, które umożliwiają składniki niestandardowe do utrwalenia własnych ustawień, gdy są one hostowane w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="e072b-107">Interfaces are provided that enable custom components to persist their own settings when they are hosted in an application.</span></span> <span data-ttu-id="e072b-108">Za pomocą klawiszy ustawień, składniki mogą zachować ustawienia dla wielu wystąpień składnika oddzielne.</span><span class="sxs-lookup"><span data-stu-id="e072b-108">By using settings keys, components can keep settings for multiple instances of the component separate.</span></span>

## <a name="defining-settings"></a><span data-ttu-id="e072b-109">Definiowanie ustawień</span><span class="sxs-lookup"><span data-stu-id="e072b-109">Defining Settings</span></span>
 <span data-ttu-id="e072b-110">Architektura ustawień aplikacji jest używana zarówno w ASP.NET, jak i windows forms i zawiera wiele klas podstawowych, które są współużytkowane w obu środowiskach.</span><span class="sxs-lookup"><span data-stu-id="e072b-110">The application settings architecture is used within both ASP.NET and Windows Forms, and it contains a number of base classes that are shared across both environments.</span></span> <span data-ttu-id="e072b-111">Najważniejsze jest <xref:System.Configuration.SettingsBase>, który zapewnia dostęp do ustawień za pośrednictwem kolekcji i zapewnia niski poziom metod ładowania i zapisywania ustawień.</span><span class="sxs-lookup"><span data-stu-id="e072b-111">The most important is <xref:System.Configuration.SettingsBase>, which provides access to settings through a collection, and provides low-level methods for loading and saving settings.</span></span> <span data-ttu-id="e072b-112">Każde środowisko implementuje własną klasę <xref:System.Configuration.SettingsBase> pochodną, aby zapewnić dodatkowe funkcje ustawień dla tego środowiska.</span><span class="sxs-lookup"><span data-stu-id="e072b-112">Each environment implements its own class derived from <xref:System.Configuration.SettingsBase> to provide additional settings functionality for that environment.</span></span> <span data-ttu-id="e072b-113">W aplikacji opartej na formularzach systemu Windows wszystkie ustawienia aplikacji <xref:System.Configuration.ApplicationSettingsBase> muszą być zdefiniowane w klasie pochodzącej z klasy, która dodaje następujące funkcje do klasy podstawowej:</span><span class="sxs-lookup"><span data-stu-id="e072b-113">In a Windows Forms-based application, all application settings must be defined on a class derived from the <xref:System.Configuration.ApplicationSettingsBase> class, which adds the following functionality to the base class:</span></span>

- <span data-ttu-id="e072b-114">Operacje ładowania i zapisywania wyższego poziomu</span><span class="sxs-lookup"><span data-stu-id="e072b-114">Higher-level loading and saving operations</span></span>

- <span data-ttu-id="e072b-115">Obsługa ustawień o zakresie użytkownika</span><span class="sxs-lookup"><span data-stu-id="e072b-115">Support for user-scoped settings</span></span>

- <span data-ttu-id="e072b-116">Przywracanie ustawień użytkownika do wstępnie zdefiniowanych ustawień domyślnych</span><span class="sxs-lookup"><span data-stu-id="e072b-116">Reverting a user's settings to the predefined defaults</span></span>

- <span data-ttu-id="e072b-117">Uaktualnianie ustawień z poprzedniej wersji aplikacji</span><span class="sxs-lookup"><span data-stu-id="e072b-117">Upgrading settings from a previous application version</span></span>

- <span data-ttu-id="e072b-118">Sprawdzanie poprawności ustawień przed ich zmianą lub przed zapisaniem</span><span class="sxs-lookup"><span data-stu-id="e072b-118">Validating settings, either before they are changed or before they are saved</span></span>

 <span data-ttu-id="e072b-119">Ustawienia można opisać przy użyciu liczby atrybutów <xref:System.Configuration> zdefiniowanych w obszarze nazw; są one opisane w [atrybutach ustawień aplikacji](application-settings-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="e072b-119">The settings can be described using a number of attributes defined within the <xref:System.Configuration> namespace; these are described in [Application Settings Attributes](application-settings-attributes.md).</span></span> <span data-ttu-id="e072b-120">Podczas definiowania ustawienia należy zastosować je <xref:System.Configuration.ApplicationScopedSettingAttribute> z <xref:System.Configuration.UserScopedSettingAttribute>jednym z nich lub , który opisuje, czy ustawienie ma zastosowanie do całej aplikacji, czy tylko do bieżącego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="e072b-120">When you define a setting, you must apply it with either <xref:System.Configuration.ApplicationScopedSettingAttribute> or <xref:System.Configuration.UserScopedSettingAttribute>, which describes whether the setting applies to the entire application or just to the current user.</span></span>

 <span data-ttu-id="e072b-121">Poniższy przykład kodu definiuje klasę ustawień niestandardowych `BackgroundColor`z jednym ustawieniem.</span><span class="sxs-lookup"><span data-stu-id="e072b-121">The following code example defines a custom settings class with a single setting, `BackgroundColor`.</span></span>

 [!code-csharp[ApplicationSettings.Create#1](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Create/CS/MyAppSettings.cs#1)]
 [!code-vb[ApplicationSettings.Create#1](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Create/VB/MyAppSettings.vb#1)]

## <a name="settings-persistence"></a><span data-ttu-id="e072b-122">Trwałość ustawień</span><span class="sxs-lookup"><span data-stu-id="e072b-122">Settings Persistence</span></span>
 <span data-ttu-id="e072b-123">Klasa <xref:System.Configuration.ApplicationSettingsBase> sama nie utrwala lub nie ładuje ustawień; to zadanie należy do dostawcy ustawień, klasy, która wywodzi się z <xref:System.Configuration.SettingsProvider>.</span><span class="sxs-lookup"><span data-stu-id="e072b-123">The <xref:System.Configuration.ApplicationSettingsBase> class does not itself persist or load settings; this job falls to the settings provider, a class that derives from <xref:System.Configuration.SettingsProvider>.</span></span> <span data-ttu-id="e072b-124">Jeśli klasa <xref:System.Configuration.ApplicationSettingsBase> pochodna nie określa dostawcy ustawień <xref:System.Configuration.SettingsProviderAttribute>za pośrednictwem , <xref:System.Configuration.LocalFileSettingsProvider>a następnie domyślnego dostawcy, jest używany.</span><span class="sxs-lookup"><span data-stu-id="e072b-124">If a derived class of <xref:System.Configuration.ApplicationSettingsBase> does not specify a settings provider through the <xref:System.Configuration.SettingsProviderAttribute>, then the default provider, <xref:System.Configuration.LocalFileSettingsProvider>, is used.</span></span>

 <span data-ttu-id="e072b-125">System konfiguracji, który został pierwotnie wydany z programem .NET Framework obsługuje dostarczanie danych konfiguracji aplikacji statycznych `app.`za pośrednictwem pliku machine.config komputera lokalnego lub w pliku exe.config, który można wdrożyć z aplikacją.</span><span class="sxs-lookup"><span data-stu-id="e072b-125">The configuration system that was originally released with the .NET Framework supports providing static application configuration data through either the local computer's machine.config file or within an `app.`exe.config file that you deploy with your application.</span></span> <span data-ttu-id="e072b-126">Klasa <xref:System.Configuration.LocalFileSettingsProvider> rozszerza tę natywną obsługę w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="e072b-126">The <xref:System.Configuration.LocalFileSettingsProvider> class expands this native support in the following ways:</span></span>

- <span data-ttu-id="e072b-127">Ustawienia o zakresie aplikacji mogą być przechowywane w plikach machine.config lub `app.`exe.config.</span><span class="sxs-lookup"><span data-stu-id="e072b-127">Application-scoped settings can be stored in either the machine.config or `app.`exe.config files.</span></span> <span data-ttu-id="e072b-128">Plik Machine.config jest zawsze `app`tylko do odczytu, podczas gdy plik .exe.config jest ograniczony przez zagadnienia dotyczące zabezpieczeń do tylko do odczytu dla większości aplikacji.</span><span class="sxs-lookup"><span data-stu-id="e072b-128">Machine.config is always read-only, while `app`.exe.config is restricted by security considerations to read-only for most applications.</span></span>

- <span data-ttu-id="e072b-129">Ustawienia o zakresie użytkownika mogą `app`być przechowywane w plikach .exe.config, w którym to przypadku są traktowane jako statyczne ustawienia domyślne.</span><span class="sxs-lookup"><span data-stu-id="e072b-129">User-scoped settings can be stored in `app`.exe.config files, in which case they are treated as static defaults.</span></span>

- <span data-ttu-id="e072b-130">Ustawienia o zakresie użytkownika nieobe domyślnie są przechowywane w nowym pliku *user*.config, gdzie *użytkownik* jest nazwą użytkownika osoby aktualnie wykonującej aplikację.</span><span class="sxs-lookup"><span data-stu-id="e072b-130">Non-default user-scoped settings are stored in a new file, *user*.config, where *user* is the user name of the person currently executing the application.</span></span> <span data-ttu-id="e072b-131">Można określić ustawienie domyślne dla ustawienia <xref:System.Configuration.DefaultSettingValueAttribute>o zakresie użytkownika za pomocą pliku .</span><span class="sxs-lookup"><span data-stu-id="e072b-131">You can specify a default for a user-scoped setting with <xref:System.Configuration.DefaultSettingValueAttribute>.</span></span> <span data-ttu-id="e072b-132">Ponieważ ustawienia o zakresie użytkownika często `user`zmieniają się podczas wykonywania aplikacji, .config jest zawsze odczyt/zapis.</span><span class="sxs-lookup"><span data-stu-id="e072b-132">Because user-scoped settings often change during application execution, `user`.config is always read/write.</span></span>

 <span data-ttu-id="e072b-133">Wszystkie trzy pliki konfiguracyjne przechowują ustawienia w formacie XML.</span><span class="sxs-lookup"><span data-stu-id="e072b-133">All three configuration files store settings in XML format.</span></span> <span data-ttu-id="e072b-134">Element XML najwyższego poziomu dla ustawień `<appSettings>`o `<userSettings>` zakresie aplikacji jest , podczas gdy jest używany do ustawień o zakresie użytkownika.</span><span class="sxs-lookup"><span data-stu-id="e072b-134">The top-level XML element for application-scoped settings is `<appSettings>`, while `<userSettings>` is used for user-scoped settings.</span></span> <span data-ttu-id="e072b-135">Plik `app`.exe.config zawierający zarówno ustawienia o zakresie aplikacji, jak i ustawienia domyślne dla ustawień o zakresie użytkownika wygląda następująco:</span><span class="sxs-lookup"><span data-stu-id="e072b-135">An `app`.exe.config file which contains both application-scoped settings and defaults for user-scoped settings would look like this:</span></span>

```xml
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <configSections>
        <sectionGroup name="applicationSettings" type="System.Configuration.ApplicationSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >
            <section name="WindowsApplication1.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />
        </sectionGroup>
        <sectionGroup name="userSettings" type="System.Configuration.UserSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >
            <section name="WindowsApplication1.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" allowExeDefinition="MachineToLocalUser" />
        </sectionGroup>
    </configSections>
    <applicationSettings>
        <WindowsApplication1.Properties.Settings>
            <setting name="Cursor" serializeAs="String">
                <value>Default</value>
            </setting>
            <setting name="DoubleBuffering" serializeAs="String">
                <value>False</value>
            </setting>
        </WindowsApplication1.Properties.Settings>
    </applicationSettings>
    <userSettings>
        <WindowsApplication1.Properties.Settings>
            <setting name="FormTitle" serializeAs="String">
                <value>Form1</value>
            </setting>
            <setting name="FormSize" serializeAs="String">
                <value>595, 536</value>
            </setting>
        </WindowsApplication1.Properties.Settings>
    </userSettings>
</configuration>
```

 <span data-ttu-id="e072b-136">Aby uzyskać definicję elementów w sekcji ustawień aplikacji pliku konfiguracyjnego, zobacz [Schemat ustawień aplikacji](../../configure-apps/file-schema/application-settings-schema.md).</span><span class="sxs-lookup"><span data-stu-id="e072b-136">For a definition of the elements within the application settings section of a configuration file, see [Application Settings Schema](../../configure-apps/file-schema/application-settings-schema.md).</span></span>

### <a name="settings-bindings"></a><span data-ttu-id="e072b-137">Powiązania ustawień</span><span class="sxs-lookup"><span data-stu-id="e072b-137">Settings Bindings</span></span>
 <span data-ttu-id="e072b-138">Ustawienia aplikacji używają architektury wiązania danych formularzy systemu Windows, aby zapewnić dwukierunkową komunikację aktualizacji ustawień między obiektem ustawień i składnikami.</span><span class="sxs-lookup"><span data-stu-id="e072b-138">Application settings uses the Windows Forms data binding architecture to provide two-way communication of settings updates between the settings object and components.</span></span> <span data-ttu-id="e072b-139">Jeśli używasz programu Visual Studio do tworzenia ustawień aplikacji i przypisywania ich do właściwości składnika, te powiązania są generowane automatycznie.</span><span class="sxs-lookup"><span data-stu-id="e072b-139">If you use Visual Studio to create application settings and assign them to component properties, these bindings are generated automatically.</span></span>

 <span data-ttu-id="e072b-140">Ustawienie aplikacji można powiązać tylko ze <xref:System.Windows.Forms.IBindableComponent> składnikiem obsługującym interfejs.</span><span class="sxs-lookup"><span data-stu-id="e072b-140">You can only bind an application setting to a component that supports the <xref:System.Windows.Forms.IBindableComponent> interface.</span></span> <span data-ttu-id="e072b-141">Ponadto składnik musi implementować zdarzenie zmiany dla określonej właściwości powiązanej lub powiadamiać ustawienia aplikacji, że właściwość została zmieniona <xref:System.ComponentModel.INotifyPropertyChanged> za pośrednictwem interfejsu.</span><span class="sxs-lookup"><span data-stu-id="e072b-141">Also, the component must implement a change event for a specific bound property, or notify application settings that the property has changed through the <xref:System.ComponentModel.INotifyPropertyChanged> interface.</span></span> <span data-ttu-id="e072b-142">Jeśli składnik nie <xref:System.Windows.Forms.IBindableComponent> implementuje i są wiążące za pośrednictwem programu Visual Studio, właściwości powiązane zostaną ustawione po raz pierwszy, ale nie zostanie zaktualizowany.</span><span class="sxs-lookup"><span data-stu-id="e072b-142">If the component does not implement <xref:System.Windows.Forms.IBindableComponent> and you are binding through Visual Studio, the bound properties will be set the first time, but will not update.</span></span> <span data-ttu-id="e072b-143">Jeśli składnik implementuje, <xref:System.Windows.Forms.IBindableComponent> ale nie obsługuje powiadomień o zmianie właściwości, powiązanie nie zostanie zaktualizowane w pliku ustawień po zmianie właściwości.</span><span class="sxs-lookup"><span data-stu-id="e072b-143">If the component implements <xref:System.Windows.Forms.IBindableComponent> but does not support property change notifications, the binding will not update in the settings file when the property is changed.</span></span>

 <span data-ttu-id="e072b-144">Niektóre składniki formularzy <xref:System.Windows.Forms.ToolStripItem>systemu Windows, takie jak , nie obsługują powiązań ustawień.</span><span class="sxs-lookup"><span data-stu-id="e072b-144">Some Windows Forms components, such as <xref:System.Windows.Forms.ToolStripItem>, do not support settings bindings.</span></span>

### <a name="settings-serialization"></a><span data-ttu-id="e072b-145">Ustawienia Serializacji</span><span class="sxs-lookup"><span data-stu-id="e072b-145">Settings Serialization</span></span>
 <span data-ttu-id="e072b-146">Gdy <xref:System.Configuration.LocalFileSettingsProvider> należy zapisać ustawienia na dysku, wykonuje następujące akcje:</span><span class="sxs-lookup"><span data-stu-id="e072b-146">When <xref:System.Configuration.LocalFileSettingsProvider> must save settings to disk, it performs the following actions:</span></span>

1. <span data-ttu-id="e072b-147">Używa odbicia, aby zbadać wszystkie właściwości <xref:System.Configuration.ApplicationSettingsBase> zdefiniowane w klasie pochodnej, znajdując <xref:System.Configuration.ApplicationScopedSettingAttribute> te, które są stosowane z jedną lub <xref:System.Configuration.UserScopedSettingAttribute>.</span><span class="sxs-lookup"><span data-stu-id="e072b-147">Uses reflection to examine all of the properties defined on your <xref:System.Configuration.ApplicationSettingsBase> derived class, finding those that are applied with either <xref:System.Configuration.ApplicationScopedSettingAttribute> or <xref:System.Configuration.UserScopedSettingAttribute>.</span></span>

2. <span data-ttu-id="e072b-148">Serializuje właściwość na dysku.</span><span class="sxs-lookup"><span data-stu-id="e072b-148">Serializes the property to disk.</span></span> <span data-ttu-id="e072b-149">Najpierw próbuje wywołać <xref:System.ComponentModel.TypeConverter.ConvertToString%2A> <xref:System.ComponentModel.TypeConverter.ConvertFromString%2A> lub na typ skojarzony <xref:System.ComponentModel.TypeConverter>.</span><span class="sxs-lookup"><span data-stu-id="e072b-149">It first attempts to call the <xref:System.ComponentModel.TypeConverter.ConvertToString%2A> or <xref:System.ComponentModel.TypeConverter.ConvertFromString%2A> on the type's associated <xref:System.ComponentModel.TypeConverter>.</span></span> <span data-ttu-id="e072b-150">Jeśli to się nie powiedzie, używa serializacji XML zamiast tego.</span><span class="sxs-lookup"><span data-stu-id="e072b-150">If this does not succeed, it uses XML serialization instead.</span></span>

3. <span data-ttu-id="e072b-151">Określa, które ustawienia są w których plikach, na podstawie atrybutu ustawienia.</span><span class="sxs-lookup"><span data-stu-id="e072b-151">Determines which settings go in which files, based on the setting's attribute.</span></span>

 <span data-ttu-id="e072b-152">Jeśli zaimplementujesz własną klasę <xref:System.Configuration.SettingsSerializeAsAttribute> ustawień, można użyć, aby oznaczyć <xref:System.Configuration.SettingsSerializeAs> ustawienie dla serializacji binarnej lub niestandardowej przy użyciu wyliczenia.</span><span class="sxs-lookup"><span data-stu-id="e072b-152">If you implement your own settings class, you can use the <xref:System.Configuration.SettingsSerializeAsAttribute> to mark a setting for either binary or custom serialization using the <xref:System.Configuration.SettingsSerializeAs> enumeration.</span></span> <span data-ttu-id="e072b-153">Aby uzyskać więcej informacji na temat tworzenia własnej klasy ustawień w kodzie, zobacz [Jak: Tworzenie ustawień aplikacji](how-to-create-application-settings.md).</span><span class="sxs-lookup"><span data-stu-id="e072b-153">For more information on creating your own settings class in code, see [How to: Create Application Settings](how-to-create-application-settings.md).</span></span>

### <a name="settings-file-locations"></a><span data-ttu-id="e072b-154">Ustawienia lokalizacje plików</span><span class="sxs-lookup"><span data-stu-id="e072b-154">Settings File Locations</span></span>
 <span data-ttu-id="e072b-155">Lokalizacja plików `app`.exe.config i *user*.config będzie się różnić w zależności od sposobu zainstalowania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="e072b-155">The location of the `app`.exe.config and *user*.config files will differ based on how the application is installed.</span></span> <span data-ttu-id="e072b-156">W przypadku aplikacji opartej na formularzach `app`systemu Windows skopiowanej na komputer lokalny plik .exe.config będzie rezydować w tym samym katalogu co podstawowy katalog <xref:System.Windows.Forms.Application.LocalUserAppDataPath%2A?displayProperty=nameWithType> głównego pliku wykonywalnego aplikacji, a *użytkownik*.config będzie rezydować w lokalizacji określonej przez właściwość.</span><span class="sxs-lookup"><span data-stu-id="e072b-156">For a Windows Forms-based application copied onto the local computer, `app`.exe.config will reside in the same directory as the base directory of the application's main executable file, and *user*.config will reside in the location specified by the <xref:System.Windows.Forms.Application.LocalUserAppDataPath%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="e072b-157">Dla aplikacji zainstalowanej za pomocą ClickOnce oba te pliki będą znajdowały się w katalogu danych ClickOnce\\pod %InstallRoot%\Documents and Settings*username*\Local Settings.</span><span class="sxs-lookup"><span data-stu-id="e072b-157">For an application installed by means of ClickOnce, both of these files will reside in the ClickOnce Data Directory underneath %InstallRoot%\Documents and Settings\\*username*\Local Settings.</span></span>

 <span data-ttu-id="e072b-158">Lokalizacja przechowywania tych plików jest nieco inna, jeśli użytkownik włączył profile mobilne, co umożliwia użytkownikowi definiowanie różnych ustawień systemu Windows i aplikacji, gdy korzysta z innych komputerów w domenie.</span><span class="sxs-lookup"><span data-stu-id="e072b-158">The storage location of these files is slightly different if a user has enabled roaming profiles, which enables a user to define different Windows and application settings when they are using other computers within a domain.</span></span> <span data-ttu-id="e072b-159">W takim przypadku zarówno aplikacje ClickOnce, jak i `app`aplikacje inne niż ClickOnce będą miały swoje pliki .exe.config i *user*.config przechowywane w obszarze %InstallRoot%\Documents and Settings\\*username*\Application Data.</span><span class="sxs-lookup"><span data-stu-id="e072b-159">In that case, both ClickOnce applications and non-ClickOnce applications will have their `app`.exe.config and *user*.config files stored under %InstallRoot%\Documents and Settings\\*username*\Application Data.</span></span>

 <span data-ttu-id="e072b-160">Aby uzyskać więcej informacji o tym, jak funkcja Ustawienia aplikacji działa z nową technologią wdrażania, zobacz [ClickOnce i Ustawienia aplikacji](/visualstudio/deployment/clickonce-and-application-settings).</span><span class="sxs-lookup"><span data-stu-id="e072b-160">For more information about how the Application Settings feature works with the new deployment technology, see [ClickOnce and Application Settings](/visualstudio/deployment/clickonce-and-application-settings).</span></span> <span data-ttu-id="e072b-161">Aby uzyskać więcej informacji na temat katalogu danych ClickOnce, zobacz [Uzyskiwanie dostępu do danych lokalnych i zdalnych w aplikacjach ClickOnce](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications).</span><span class="sxs-lookup"><span data-stu-id="e072b-161">For more information about the ClickOnce Data Directory, see [Accessing Local and Remote Data in ClickOnce Applications](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications).</span></span>

## <a name="application-settings-and-security"></a><span data-ttu-id="e072b-162">Ustawienia aplikacji i zabezpieczenia</span><span class="sxs-lookup"><span data-stu-id="e072b-162">Application Settings and Security</span></span>
 <span data-ttu-id="e072b-163">Ustawienia aplikacji są przeznaczone do pracy w częściowym zaufaniu, ograniczonym środowisku, które jest domyślnym dla aplikacji Windows Forms hostowanych przez Internet lub intranet.</span><span class="sxs-lookup"><span data-stu-id="e072b-163">Application settings are designed to work in partial trust, a restricted environment that is the default for Windows Forms applications hosted over the Internet or an intranet.</span></span> <span data-ttu-id="e072b-164">Żadne specjalne uprawnienia poza częściowym zaufaniem nie są potrzebne do używania ustawień aplikacji z dostawcą ustawień domyślnych.</span><span class="sxs-lookup"><span data-stu-id="e072b-164">No special permissions beyond partial trust are needed to use application settings with the default settings provider.</span></span>

 <span data-ttu-id="e072b-165">Gdy ustawienia aplikacji są używane w aplikacji `user`ClickOnce, plik .config jest przechowywany w katalogu danych ClickOnce.</span><span class="sxs-lookup"><span data-stu-id="e072b-165">When application settings are used in a ClickOnce application, the `user`.config file is stored in the ClickOnce data directory.</span></span> <span data-ttu-id="e072b-166">Rozmiar pliku `user`.config aplikacji nie może przekraczać przydziału katalogu danych ustawionego przez ClickOnce.</span><span class="sxs-lookup"><span data-stu-id="e072b-166">The size of the application's `user`.config file cannot exceed the data directory quota set by ClickOnce.</span></span> <span data-ttu-id="e072b-167">Aby uzyskać więcej informacji, zobacz [ClickOnce i Ustawienia aplikacji](/visualstudio/deployment/clickonce-and-application-settings).</span><span class="sxs-lookup"><span data-stu-id="e072b-167">For more information, see [ClickOnce and Application Settings](/visualstudio/deployment/clickonce-and-application-settings).</span></span>

## <a name="custom-settings-providers"></a><span data-ttu-id="e072b-168">Dostawcy ustawień niestandardowych</span><span class="sxs-lookup"><span data-stu-id="e072b-168">Custom Settings Providers</span></span>
 <span data-ttu-id="e072b-169">W architekturze Ustawienia aplikacji istnieje luźne sprzężenie między klasą <xref:System.Configuration.ApplicationSettingsBase>otoki ustawień aplikacji, pochodzącą <xref:System.Configuration.SettingsProvider>od programu , a skojarzonym dostawcą lub dostawcami ustawień, pochodzącymi z .</span><span class="sxs-lookup"><span data-stu-id="e072b-169">In the Application Settings architecture, there is a loose coupling between the applications settings wrapper class, derived from <xref:System.Configuration.ApplicationSettingsBase>, and the associated settings provider or providers, derived from <xref:System.Configuration.SettingsProvider>.</span></span> <span data-ttu-id="e072b-170">To skojarzenie jest <xref:System.Configuration.SettingsProviderAttribute> definiowane tylko przez zastosowane do klasy otoki lub jej indywidualne właściwości.</span><span class="sxs-lookup"><span data-stu-id="e072b-170">This association is defined only by the <xref:System.Configuration.SettingsProviderAttribute> applied to the wrapper class or its individual properties.</span></span> <span data-ttu-id="e072b-171">Jeśli dostawca ustawień nie jest jawnie określony, używany jest dostawca domyślny. <xref:System.Configuration.LocalFileSettingsProvider></span><span class="sxs-lookup"><span data-stu-id="e072b-171">If a settings provider is not explicitly specified, the default provider, <xref:System.Configuration.LocalFileSettingsProvider>, is used.</span></span> <span data-ttu-id="e072b-172">W rezultacie ta architektura obsługuje tworzenie i używanie dostawców ustawień niestandardowych.</span><span class="sxs-lookup"><span data-stu-id="e072b-172">As a result, this architecture supports creating and using custom settings providers.</span></span>

 <span data-ttu-id="e072b-173">Załóżmy na przykład, że `SqlSettingsProvider`chcesz opracować i używać dostawcy, który będzie przechowywać wszystkie dane ustawień w bazie danych programu Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e072b-173">For example, suppose that you want to develop and use `SqlSettingsProvider`, a provider that will store all settings data in a Microsoft SQL Server database.</span></span> <span data-ttu-id="e072b-174">Klasa <xref:System.Configuration.SettingsProvider>pochodna otrzyma te informacje `Initialize` w swojej metodzie <xref:System.Collections.Specialized.NameValueCollection?displayProperty=nameWithType>jako parametr typu .</span><span class="sxs-lookup"><span data-stu-id="e072b-174">Your <xref:System.Configuration.SettingsProvider>-derived class would receive this information in its `Initialize` method as a parameter of type <xref:System.Collections.Specialized.NameValueCollection?displayProperty=nameWithType>.</span></span> <span data-ttu-id="e072b-175">Następnie należy zaimplementować <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> metodę pobierania ustawień z <xref:System.Configuration.SettingsProvider.SetPropertyValues%2A> magazynu danych i zapisywania ich.</span><span class="sxs-lookup"><span data-stu-id="e072b-175">You would then implement the <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> method to retrieve your settings from the data store, and <xref:System.Configuration.SettingsProvider.SetPropertyValues%2A> to save them.</span></span> <span data-ttu-id="e072b-176">Dostawca może użyć <xref:System.Configuration.SettingsPropertyCollection> dostarczone <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> do określenia nazwy właściwości, typu i zakresu, a także inne atrybuty ustawień zdefiniowane dla tej właściwości.</span><span class="sxs-lookup"><span data-stu-id="e072b-176">Your provider can use the <xref:System.Configuration.SettingsPropertyCollection> supplied to <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> to determine the property's name, type, and scope, as well as any other settings attributes defined for that property.</span></span>

 <span data-ttu-id="e072b-177">Dostawca będzie musiał zaimplementować jedną właściwość i jedną metodę, której implementacje mogą nie być oczywiste.</span><span class="sxs-lookup"><span data-stu-id="e072b-177">Your provider will need to implement one property and one method whose implementations may not be obvious.</span></span> <span data-ttu-id="e072b-178">Właściwość <xref:System.Configuration.SettingsProvider.ApplicationName%2A> jest abstrakcyjną <xref:System.Configuration.SettingsProvider>właściwością ; należy zaprogramować go, aby zwrócić następujące elementy:</span><span class="sxs-lookup"><span data-stu-id="e072b-178">The <xref:System.Configuration.SettingsProvider.ApplicationName%2A> property is an abstract property of <xref:System.Configuration.SettingsProvider>; you should program it to return the following:</span></span>

 [!code-csharp[ApplicationSettings.Architecture#2](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Architecture/CS/DummyClass.cs#2)]
 [!code-vb[ApplicationSettings.Architecture#2](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Architecture/VB/DummyProviderClass.vb#2)]

 <span data-ttu-id="e072b-179">Klasa pochodna musi również `Initialize` implementować metodę, która nie przyjmuje żadnych argumentów i zwraca wartość.</span><span class="sxs-lookup"><span data-stu-id="e072b-179">Your derived class must also implement an `Initialize` method that takes no arguments and returns no value.</span></span> <span data-ttu-id="e072b-180">Ta metoda nie <xref:System.Configuration.SettingsProvider>jest zdefiniowana przez .</span><span class="sxs-lookup"><span data-stu-id="e072b-180">This method is not defined by <xref:System.Configuration.SettingsProvider>.</span></span>

 <span data-ttu-id="e072b-181">Na koniec zaimplementować <xref:System.Configuration.IApplicationSettingsProvider> na dostawcy, aby zapewnić obsługę odświeżania ustawień, przywracanie ustawień do ich ustawień domyślnych i uaktualnianie ustawień z jednej wersji aplikacji do innej.</span><span class="sxs-lookup"><span data-stu-id="e072b-181">Finally, you implement <xref:System.Configuration.IApplicationSettingsProvider> on your provider to provide support for refreshing settings, reverting settings to their defaults, and upgrading settings from one application version to another.</span></span>

 <span data-ttu-id="e072b-182">Po zaimplementowaniu i skompilowaniu dostawcy należy poinstruować klasę ustawień, aby używała tego dostawcy zamiast wartości domyślnej.</span><span class="sxs-lookup"><span data-stu-id="e072b-182">Once you have implemented and compiled your provider, you need to instruct your settings class to use this provider instead of the default.</span></span> <span data-ttu-id="e072b-183">Można to osiągnąć <xref:System.Configuration.SettingsProviderAttribute>poprzez .</span><span class="sxs-lookup"><span data-stu-id="e072b-183">You accomplish this through the <xref:System.Configuration.SettingsProviderAttribute>.</span></span> <span data-ttu-id="e072b-184">Jeśli zastosowano do całej klasy ustawień, dostawca jest używany dla każdego ustawienia, które definiuje klasa; jeśli są stosowane do poszczególnych ustawień, architektura Ustawienia aplikacji używa <xref:System.Configuration.LocalFileSettingsProvider> tego dostawcy tylko dla tych ustawień i używa dla pozostałych.</span><span class="sxs-lookup"><span data-stu-id="e072b-184">If applied to an entire settings class, the provider is used for each setting that the class defines; if applied to individual settings, Application Settings architecture uses that provider for those settings only, and uses <xref:System.Configuration.LocalFileSettingsProvider> for the rest.</span></span> <span data-ttu-id="e072b-185">Poniższy przykład kodu pokazuje, jak poinstruować klasy ustawień, aby użyć dostawcy niestandardowego.</span><span class="sxs-lookup"><span data-stu-id="e072b-185">The following code example shows how to instruct the settings class to use your custom provider.</span></span>

 [!code-csharp[ApplicationSettings.Architecture#1](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Architecture/CS/DummyClass.cs#1)]
 [!code-vb[ApplicationSettings.Architecture#1](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Architecture/VB/DummyProviderClass.vb#1)]

 <span data-ttu-id="e072b-186">Dostawca może być wywoływany z wielu wątków jednocześnie, ale zawsze będzie zapisywać w tej samej lokalizacji magazynu; w związku z tym architektura ustawienia aplikacji będzie tylko kiedykolwiek utworzyć wystąpienie pojedynczego wystąpienia klasy dostawcy.</span><span class="sxs-lookup"><span data-stu-id="e072b-186">A provider may be called from multiple threads simultaneously, but it will always write to the same storage location; therefore, the Application Settings architecture will only ever instantiate a single instance of your provider class.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e072b-187">Należy upewnić się, że dostawca jest bezpieczny dla wątków i umożliwia tylko jeden wątek naraz do zapisu do plików konfiguracyjnych.</span><span class="sxs-lookup"><span data-stu-id="e072b-187">You should ensure that your provider is thread-safe, and only allows one thread at a time to write to the configuration files.</span></span>

 <span data-ttu-id="e072b-188">Dostawca nie musi obsługiwać wszystkich atrybutów ustawień <xref:System.Configuration?displayProperty=nameWithType> zdefiniowanych w obszarze nazw, <xref:System.Configuration.ApplicationScopedSettingAttribute> <xref:System.Configuration.UserScopedSettingAttribute>chociaż musi on <xref:System.Configuration.DefaultSettingValueAttribute>mieć minimalne wsparcie i , a także powinien obsługiwać.</span><span class="sxs-lookup"><span data-stu-id="e072b-188">Your provider does not need to support all of the settings attributes defined in the <xref:System.Configuration?displayProperty=nameWithType> namespace, though it must at a minimum support <xref:System.Configuration.ApplicationScopedSettingAttribute> and <xref:System.Configuration.UserScopedSettingAttribute>, and should also support <xref:System.Configuration.DefaultSettingValueAttribute>.</span></span> <span data-ttu-id="e072b-189">Dla tych atrybutów, które nie obsługuje, dostawca powinien po prostu nie bez powiadomienia; nie należy zgłaszać wyjątek.</span><span class="sxs-lookup"><span data-stu-id="e072b-189">For those attributes that it does not support, your provider should just fail without notification; it should not throw an exception.</span></span> <span data-ttu-id="e072b-190">Jeśli klasa ustawień używa nieprawidłowej kombinacji atrybutów, jednak <xref:System.Configuration.ApplicationScopedSettingAttribute> <xref:System.Configuration.UserScopedSettingAttribute> — takie jak stosowanie i do tego samego ustawienia — dostawca powinien zgłosić wyjątek i zaprzestać działania.</span><span class="sxs-lookup"><span data-stu-id="e072b-190">If the settings class uses an invalid combination of attributes, however — such as applying <xref:System.Configuration.ApplicationScopedSettingAttribute> and <xref:System.Configuration.UserScopedSettingAttribute> to the same setting — your provider should throw an exception and cease operation.</span></span>

## <a name="see-also"></a><span data-ttu-id="e072b-191">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="e072b-191">See also</span></span>

- <xref:System.Configuration.ApplicationSettingsBase>
- <xref:System.Configuration.SettingsProvider>
- <xref:System.Configuration.LocalFileSettingsProvider>
- [<span data-ttu-id="e072b-192">Przegląd ustawień aplikacji</span><span class="sxs-lookup"><span data-stu-id="e072b-192">Application Settings Overview</span></span>](application-settings-overview.md)
- [<span data-ttu-id="e072b-193">Ustawienia aplikacji dotyczące kontrolek niestandardowych</span><span class="sxs-lookup"><span data-stu-id="e072b-193">Application Settings for Custom Controls</span></span>](application-settings-for-custom-controls.md)
- [<span data-ttu-id="e072b-194">ClickOnce i ustawienia aplikacji</span><span class="sxs-lookup"><span data-stu-id="e072b-194">ClickOnce and Application Settings</span></span>](/visualstudio/deployment/clickonce-and-application-settings)
- [<span data-ttu-id="e072b-195">Schemat ustawień aplikacji</span><span class="sxs-lookup"><span data-stu-id="e072b-195">Application Settings Schema</span></span>](../../configure-apps/file-schema/application-settings-schema.md)
