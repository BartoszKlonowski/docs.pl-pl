---
title: Komunikacja między usługami
description: Dowiedz się, jak zaplecza chmury natywnych mikrousług komunikować się z innymi mikrousług zaplecza.
author: robvet
ms.date: 09/09/2019
ms.openlocfilehash: 926be3c2eb4513c89ebcd1f31dceb7d58639dc6f
ms.sourcegitcommit: 79b0dd8bfc63f33a02137121dd23475887ecefda
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/01/2020
ms.locfileid: "80523562"
---
# <a name="service-to-service-communication"></a><span data-ttu-id="4a93f-103">Komunikacja między usługami</span><span class="sxs-lookup"><span data-stu-id="4a93f-103">Service-to-service communication</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="4a93f-104">Przechodząc od klienta front-end, teraz adres mikrousług zaplecza komunikować się ze sobą.</span><span class="sxs-lookup"><span data-stu-id="4a93f-104">Moving from the front-end client, we now address back-end microservices communicate with each other.</span></span>

<span data-ttu-id="4a93f-105">Podczas tworzenia aplikacji natywnej dla chmury, należy być poufne, jak usługi zaplecza komunikować się ze sobą.</span><span class="sxs-lookup"><span data-stu-id="4a93f-105">When constructing a cloud-native application, you'll want to be sensitive to how back-end services communicate with each other.</span></span> <span data-ttu-id="4a93f-106">Najlepiej, im mniej komunikacji między usługami, tym lepiej.</span><span class="sxs-lookup"><span data-stu-id="4a93f-106">Ideally, the less inter-service communication, the better.</span></span> <span data-ttu-id="4a93f-107">Jednak unikanie nie zawsze jest możliwe, ponieważ usługi zaplecza często polegają na sobie nawzajem, aby zakończyć operację.</span><span class="sxs-lookup"><span data-stu-id="4a93f-107">However, avoidance isn't always possible as back-end services often rely on one another to complete an operation.</span></span>

<span data-ttu-id="4a93f-108">Istnieje kilka powszechnie akceptowanych podejść do wdrażania komunikacji między usługami.</span><span class="sxs-lookup"><span data-stu-id="4a93f-108">There are several widely accepted approaches to implementing cross-service communication.</span></span> <span data-ttu-id="4a93f-109">*Rodzaj interakcji komunikacyjnej* często określa najlepsze podejście.</span><span class="sxs-lookup"><span data-stu-id="4a93f-109">The *type of communication interaction* will often determine the best approach.</span></span>

<span data-ttu-id="4a93f-110">Należy wziąć pod uwagę następujące typy interakcji:</span><span class="sxs-lookup"><span data-stu-id="4a93f-110">Consider the following interaction types:</span></span>

- <span data-ttu-id="4a93f-111">*Zapytanie* — gdy wywołanie mikrousługi wymaga odpowiedzi z o nazwie mikrousługi, takich jak "Hej, daj mi informacje kupującego dla danego identyfikatora klienta."</span><span class="sxs-lookup"><span data-stu-id="4a93f-111">*Query* – when a calling microservice requires a response from a called microservice, such as, "Hey, give me the buyer information for a given customer Id."</span></span>

- <span data-ttu-id="4a93f-112">*Polecenie* — gdy wywołanie mikrousługi potrzebuje innej mikrousługi do wykonania akcji, ale nie wymaga odpowiedzi, takich jak "Hej, po prostu wyślij to zamówienie."</span><span class="sxs-lookup"><span data-stu-id="4a93f-112">*Command* – when the calling microservice needs another microservice to execute an action but doesn't require a response, such as, "Hey, just ship this order."</span></span>

- <span data-ttu-id="4a93f-113">*Zdarzenie* — gdy mikrousługi, o nazwie wydawca, wywołuje zdarzenie, że stan został zmieniony lub wystąpiła akcja.</span><span class="sxs-lookup"><span data-stu-id="4a93f-113">*Event* – when a microservice, called the publisher, raises an event that state has changed or an action has occurred.</span></span> <span data-ttu-id="4a93f-114">Inne mikrousługi, o nazwie subskrybentów, którzy są zainteresowani, można odpowiednio reagować na zdarzenie.</span><span class="sxs-lookup"><span data-stu-id="4a93f-114">Other microservices, called subscribers, who are interested, can react to the event appropriately.</span></span> <span data-ttu-id="4a93f-115">Wydawca i subskrybenci nie są świadomi siebie nawzajem.</span><span class="sxs-lookup"><span data-stu-id="4a93f-115">The publisher and the subscribers aren't aware of each other.</span></span>

<span data-ttu-id="4a93f-116">Systemy mikrousług zazwyczaj używają kombinacji tych typów interakcji podczas wykonywania operacji, które wymagają interakcji między usługami.</span><span class="sxs-lookup"><span data-stu-id="4a93f-116">Microservice systems typically use a combination of these interaction types when executing operations that require cross-service interaction.</span></span> <span data-ttu-id="4a93f-117">Przyjrzyjmy się uważnie każdemu i temu, jak możesz je zaimplementować.</span><span class="sxs-lookup"><span data-stu-id="4a93f-117">Let's take a close look at each and how you might implement them.</span></span>

## <a name="queries"></a><span data-ttu-id="4a93f-118">Zapytania</span><span class="sxs-lookup"><span data-stu-id="4a93f-118">Queries</span></span>

<span data-ttu-id="4a93f-119">Wiele razy jedna mikrousługa może wymagać *kwerendy* innego, wymagając natychmiastowej odpowiedzi, aby zakończyć operację.</span><span class="sxs-lookup"><span data-stu-id="4a93f-119">Many times, one microservice might need to *query* another, requiring an immediate response to complete an operation.</span></span> <span data-ttu-id="4a93f-120">Mikrousługa koszyka zakupów może wymagać informacji o produkcie i ceny, aby dodać element do koszyka.</span><span class="sxs-lookup"><span data-stu-id="4a93f-120">A shopping basket microservice may need product information and a price to add an item to its basket.</span></span> <span data-ttu-id="4a93f-121">Istnieje wiele podejść do implementowania operacji kwerendy.</span><span class="sxs-lookup"><span data-stu-id="4a93f-121">There are a number of approaches for implementing query operations.</span></span>

### <a name="requestresponse-messaging"></a><span data-ttu-id="4a93f-122">Wiadomości z prośbą/odpowiedzią</span><span class="sxs-lookup"><span data-stu-id="4a93f-122">Request/Response Messaging</span></span>

<span data-ttu-id="4a93f-123">Jedną z opcji implementacji tego scenariusza jest dla wywoływania mikrousług zaplecza do bezpośredniego żądania HTTP do mikrousług, które należy zbadać, pokazano na rysunku 4-8.</span><span class="sxs-lookup"><span data-stu-id="4a93f-123">One option for implementing this scenario is for the calling back-end microservice to make direct HTTP requests to the microservices it needs to query, shown in Figure 4-8.</span></span>

![Bezpośrednia komunikacja HTTP](./media/direct-http-communication.png)

<span data-ttu-id="4a93f-125">**Rysunek 4-8**.</span><span class="sxs-lookup"><span data-stu-id="4a93f-125">**Figure 4-8**.</span></span> <span data-ttu-id="4a93f-126">Bezpośrednia komunikacja HTTP</span><span class="sxs-lookup"><span data-stu-id="4a93f-126">Direct HTTP communication</span></span>

<span data-ttu-id="4a93f-127">Podczas gdy bezpośrednie wywołania HTTP między mikrousługami są stosunkowo proste do zaimplementowania, należy zwrócić uwagę, aby zminimalizować tę praktykę.</span><span class="sxs-lookup"><span data-stu-id="4a93f-127">While direct HTTP calls between microservices are relatively simple to implement, care should be taken to minimize this practice.</span></span> <span data-ttu-id="4a93f-128">Aby rozpocząć, te wywołania są zawsze *synchroniczne* i zablokuje operację, dopóki wynik nie zostanie zwrócony lub outs czasu żądania.</span><span class="sxs-lookup"><span data-stu-id="4a93f-128">To start, these calls are always *synchronous* and will block the operation until a result is returned or the request times outs.</span></span> <span data-ttu-id="4a93f-129">To, co kiedyś było samodzielnymi, niezależnymi służbami, zdolnymi do samodzielnego rozwoju i częstego wdrażania, teraz staje się ze sobą powiązane.</span><span class="sxs-lookup"><span data-stu-id="4a93f-129">What were once self-contained, independent services, able to evolve independently and deploy frequently, now become coupled to each other.</span></span> <span data-ttu-id="4a93f-130">Wraz ze wzrostem sprzężenia między mikrousługami ich korzyści architektoniczne zmniejszają się.</span><span class="sxs-lookup"><span data-stu-id="4a93f-130">As coupling among microservices increase, their architectural benefits diminish.</span></span>

<span data-ttu-id="4a93f-131">Wykonywanie rzadkich żądań, które sprawia, że pojedyncze bezpośrednie wywołanie HTTP do innej mikrousługi może być dopuszczalne dla niektórych systemów.</span><span class="sxs-lookup"><span data-stu-id="4a93f-131">Executing an infrequent request that makes a single direct HTTP call to another microservice might be acceptable for some systems.</span></span> <span data-ttu-id="4a93f-132">Jednak wywołania dużej ilości, które wywołują bezpośrednie wywołania HTTP do wielu mikrousług nie są wskazane.</span><span class="sxs-lookup"><span data-stu-id="4a93f-132">However, high-volume calls that invoke direct HTTP calls to multiple microservices aren't advisable.</span></span> <span data-ttu-id="4a93f-133">Mogą one zwiększyć opóźnienia i negatywnie wpłynąć na wydajność, skalowalność i dostępność systemu.</span><span class="sxs-lookup"><span data-stu-id="4a93f-133">They can increase latency and negatively impact the performance, scalability, and availability of your system.</span></span> <span data-ttu-id="4a93f-134">Co gorsza, długa seria bezpośredniej komunikacji HTTP może prowadzić do głębokich i złożonych łańcuchów wywołań mikrousług synchronicznych, pokazano na rysunku 4-9:</span><span class="sxs-lookup"><span data-stu-id="4a93f-134">Even worse, a long series of direct HTTP communication can lead to deep and complex chains of synchronous microservices calls, shown in Figure 4-9:</span></span>

![Tworzenie łańcucha zapytań HTTP](./media/chaining-http-queries.png)

<span data-ttu-id="4a93f-136">**Rysunek 4-9**.</span><span class="sxs-lookup"><span data-stu-id="4a93f-136">**Figure 4-9**.</span></span> <span data-ttu-id="4a93f-137">Tworzenie łańcucha zapytań HTTP</span><span class="sxs-lookup"><span data-stu-id="4a93f-137">Chaining HTTP queries</span></span>

<span data-ttu-id="4a93f-138">Z pewnością można sobie wyobrazić ryzyko w projekcie pokazanym na poprzednim obrazie.</span><span class="sxs-lookup"><span data-stu-id="4a93f-138">You can certainly imagine the risk in the design shown in the previous image.</span></span> <span data-ttu-id="4a93f-139">Co się \#stanie, jeśli krok 3 nie powiedzie się?</span><span class="sxs-lookup"><span data-stu-id="4a93f-139">What happens if Step \#3 fails?</span></span> <span data-ttu-id="4a93f-140">Albo \#krok 8 nie powiedzie się?</span><span class="sxs-lookup"><span data-stu-id="4a93f-140">Or Step \#8 fails?</span></span> <span data-ttu-id="4a93f-141">Jak odzyskać?</span><span class="sxs-lookup"><span data-stu-id="4a93f-141">How do you recover?</span></span> <span data-ttu-id="4a93f-142">Co zrobić, jeśli krok \#6 jest powolny, ponieważ podstawowa usługa jest zajęta?</span><span class="sxs-lookup"><span data-stu-id="4a93f-142">What if Step \#6 is slow because the underlying service is busy?</span></span> <span data-ttu-id="4a93f-143">Jak kontynuować?</span><span class="sxs-lookup"><span data-stu-id="4a93f-143">How do you continue?</span></span> <span data-ttu-id="4a93f-144">Nawet jeśli wszystkie działa poprawnie, pomyśl o opóźnieniu to wywołanie spowoduje, która jest sumą opóźnienia każdego kroku.</span><span class="sxs-lookup"><span data-stu-id="4a93f-144">Even if all works correctly, think of the latency this call would incur, which is the sum of the latency of each step.</span></span>

<span data-ttu-id="4a93f-145">Duży stopień sprzężenia na poprzednim obrazie sugeruje, że usługi nie były optymalnie modelowane.</span><span class="sxs-lookup"><span data-stu-id="4a93f-145">The large degree of coupling in the previous image suggests the services weren't optimally modeled.</span></span> <span data-ttu-id="4a93f-146">Byłoby behoove zespół do ponownego ich projektu.</span><span class="sxs-lookup"><span data-stu-id="4a93f-146">It would behoove the team to revisit their design.</span></span>

### <a name="materialized-view-pattern"></a><span data-ttu-id="4a93f-147">Wzorzec zmaterializowanego widoku</span><span class="sxs-lookup"><span data-stu-id="4a93f-147">Materialized View pattern</span></span>

<span data-ttu-id="4a93f-148">Popularną opcją usuwania sprzężenia mikrousług jest [wzorzec Widok materializowany.](https://docs.microsoft.com/azure/architecture/patterns/materialized-view)</span><span class="sxs-lookup"><span data-stu-id="4a93f-148">A popular option for removing microservice coupling is the [Materialized View pattern](https://docs.microsoft.com/azure/architecture/patterns/materialized-view).</span></span> <span data-ttu-id="4a93f-149">Za pomocą tego wzorca mikrousługi przechowuje własną lokalną, zdenormalizowane kopię danych, która jest własnością innych usług.</span><span class="sxs-lookup"><span data-stu-id="4a93f-149">With this pattern, a microservice stores its own local, denormalized copy of data that's owned by other services.</span></span> <span data-ttu-id="4a93f-150">Zamiast mikrousług koszyka zakupów kwerendy katalogu produktów i mikrousług cenowych, przechowuje własną lokalną kopię tych danych.</span><span class="sxs-lookup"><span data-stu-id="4a93f-150">Instead of the Shopping Basket microservice querying the Product Catalog and Pricing microservices, it maintains its own local copy of that data.</span></span> <span data-ttu-id="4a93f-151">Ten wzór eliminuje niepotrzebne sprzężenie i poprawia niezawodność i czas reakcji.</span><span class="sxs-lookup"><span data-stu-id="4a93f-151">This pattern eliminates unnecessary coupling and improves reliability and response time.</span></span> <span data-ttu-id="4a93f-152">Cała operacja jest wykonywana wewnątrz pojedynczego procesu.</span><span class="sxs-lookup"><span data-stu-id="4a93f-152">The entire operation executes inside a single process.</span></span> <span data-ttu-id="4a93f-153">Badamy ten wzorzec i inne problemy związane z danymi w rozdziale 5.</span><span class="sxs-lookup"><span data-stu-id="4a93f-153">We explore this pattern and other data concerns in Chapter 5.</span></span>

### <a name="service-aggregator-pattern"></a><span data-ttu-id="4a93f-154">Wzorzec agregatora usług</span><span class="sxs-lookup"><span data-stu-id="4a93f-154">Service Aggregator Pattern</span></span>

<span data-ttu-id="4a93f-155">Inną opcją eliminowania sprzężenia mikrousług do mikrousług jest [mikrousługa agregatora,](https://devblogs.microsoft.com/cesardelatorre/designing-and-implementing-api-gateways-with-ocelot-in-a-microservices-and-container-based-architecture/)pokazana w kolorze fioletowym na rysunku 4-10.</span><span class="sxs-lookup"><span data-stu-id="4a93f-155">Another option for eliminating microservice-to-microservice coupling is an [Aggregator microservice](https://devblogs.microsoft.com/cesardelatorre/designing-and-implementing-api-gateways-with-ocelot-in-a-microservices-and-container-based-architecture/), shown in purple in Figure 4-10.</span></span>

![Usługa agregatora](./media/aggregator-service.png)

<span data-ttu-id="4a93f-157">**Rysunek 4-10**.</span><span class="sxs-lookup"><span data-stu-id="4a93f-157">**Figure 4-10**.</span></span> <span data-ttu-id="4a93f-158">Mikrousługa agregatora</span><span class="sxs-lookup"><span data-stu-id="4a93f-158">Aggregator microservice</span></span>

<span data-ttu-id="4a93f-159">Wzorzec izoluje operację, która sprawia, że wywołania wielu mikrousług zaplecza, centralizując jego logiki do specjalistycznych mikrousług.</span><span class="sxs-lookup"><span data-stu-id="4a93f-159">The pattern isolates an operation that makes calls to multiple back-end microservices, centralizing its logic into a specialized microservice.</span></span>  <span data-ttu-id="4a93f-160">Fioletowy mikrousługi agregatora wyewidencjonowania w poprzednim rysunku organizuje przepływ pracy dla operacji Wyewidencjonowania.</span><span class="sxs-lookup"><span data-stu-id="4a93f-160">The purple checkout aggregator microservice in the previous figure orchestrates the workflow for the Checkout operation.</span></span> <span data-ttu-id="4a93f-161">Zawiera wywołania kilku mikrousług zaplecza w kolejności sekwencjonowane.</span><span class="sxs-lookup"><span data-stu-id="4a93f-161">It includes calls to several back-end microservices in a sequenced order.</span></span> <span data-ttu-id="4a93f-162">Dane z przepływu pracy są agregowane i zwracane do obiektu wywołującego.</span><span class="sxs-lookup"><span data-stu-id="4a93f-162">Data from the workflow is aggregated and returned to the caller.</span></span> <span data-ttu-id="4a93f-163">Chociaż nadal implementuje bezpośrednie wywołania HTTP, mikrousługi agregatora zmniejsza bezpośrednie zależności między mikrousług zaplecza.</span><span class="sxs-lookup"><span data-stu-id="4a93f-163">While it still implements direct HTTP calls, the aggregator microservice reduces direct dependencies among back-end microservices.</span></span>

### <a name="requestreply-pattern"></a><span data-ttu-id="4a93f-164">Wzorzec żądania/odpowiedzi</span><span class="sxs-lookup"><span data-stu-id="4a93f-164">Request/Reply Pattern</span></span>

<span data-ttu-id="4a93f-165">Innym podejściem do oddzielenia synchronicznych wiadomości HTTP jest [wzorzec żądania i odpowiedzi,](https://www.enterpriseintegrationpatterns.com/patterns/messaging/RequestReply.html)który używa komunikacji kolejkowania.</span><span class="sxs-lookup"><span data-stu-id="4a93f-165">Another approach for decoupling synchronous HTTP messages is a [Request-Reply Pattern](https://www.enterpriseintegrationpatterns.com/patterns/messaging/RequestReply.html), which uses queuing communication.</span></span> <span data-ttu-id="4a93f-166">Komunikacja przy użyciu kolejki jest zawsze kanałem jednokierunkowym, a producent wysyła wiadomość, a konsument ją odbiera.</span><span class="sxs-lookup"><span data-stu-id="4a93f-166">Communication using a queue is always a one-way channel, with a producer sending the message and consumer receiving it.</span></span> <span data-ttu-id="4a93f-167">Za pomocą tego wzorca zaimplementowano zarówno kolejkę żądań, jak i kolejkę odpowiedzi, przedstawioną na rysunku 4-11.</span><span class="sxs-lookup"><span data-stu-id="4a93f-167">With this pattern, both a request queue and response queue are implemented, shown in Figure 4-11.</span></span>

![Wzorzec żądania odpowiedzi](./media/request-reply-pattern.png)

<span data-ttu-id="4a93f-169">**Rysunek 4-11**.</span><span class="sxs-lookup"><span data-stu-id="4a93f-169">**Figure 4-11**.</span></span> <span data-ttu-id="4a93f-170">Wzorzec żądania odpowiedzi</span><span class="sxs-lookup"><span data-stu-id="4a93f-170">Request-reply pattern</span></span>

<span data-ttu-id="4a93f-171">W tym miejscu producent komunikatów tworzy komunikat oparty na kwerendach, który zawiera unikatowy identyfikator korelacji i umieszcza go w kolejce żądań.</span><span class="sxs-lookup"><span data-stu-id="4a93f-171">Here, the message producer creates a query-based message that contains a unique correlation ID and places it into a request queue.</span></span> <span data-ttu-id="4a93f-172">Usługa zużywająca usuwa wiadomości, przetwarza ją i umieszcza odpowiedź w kolejce odpowiedzi o tym samym identyfikatorze korelacji.</span><span class="sxs-lookup"><span data-stu-id="4a93f-172">The consuming service dequeues the messages, processes it and places the response into the response queue with the same correlation ID.</span></span> <span data-ttu-id="4a93f-173">Usługa producenta usuwa komunikat w kolejce, dopasowuje ją do identyfikatora korelacji i kontynuuje przetwarzanie.</span><span class="sxs-lookup"><span data-stu-id="4a93f-173">The producer service dequeues the message, matches it with the correlation ID and continues processing.</span></span> <span data-ttu-id="4a93f-174">Szczegółowo opisujemy kolejki w następnej sekcji.</span><span class="sxs-lookup"><span data-stu-id="4a93f-174">We cover queues in detail in the next section.</span></span>

## <a name="commands"></a><span data-ttu-id="4a93f-175">Polecenia</span><span class="sxs-lookup"><span data-stu-id="4a93f-175">Commands</span></span>

<span data-ttu-id="4a93f-176">Innym rodzajem interakcji komunikacyjnej jest *polecenie*.</span><span class="sxs-lookup"><span data-stu-id="4a93f-176">Another type of communication interaction is a *command*.</span></span> <span data-ttu-id="4a93f-177">Mikrousługi może wymagać innej mikrousługi do wykonania akcji.</span><span class="sxs-lookup"><span data-stu-id="4a93f-177">A microservice may need another microservice to perform an action.</span></span> <span data-ttu-id="4a93f-178">Mikrousługa zamawiania może wymagać mikrousługi wysyłkowej do utworzenia przesyłki dla zatwierdzonego zamówienia.</span><span class="sxs-lookup"><span data-stu-id="4a93f-178">The Ordering microservice may need the Shipping microservice to create a shipment for an approved order.</span></span> <span data-ttu-id="4a93f-179">Na rysunku 4-12 jednej mikrousługi, o nazwie Producent, wysyła wiadomość do innej mikrousługi, konsumenta, nakazując jej coś zrobić.</span><span class="sxs-lookup"><span data-stu-id="4a93f-179">In Figure 4-12, one microservice, called a Producer, sends a message to another microservice, the Consumer, commanding it to do something.</span></span>

![Interakcja polecenia z kolejką](./media/command-interaction-with-queue.png)

<span data-ttu-id="4a93f-181">**Rysunek 4-12**.</span><span class="sxs-lookup"><span data-stu-id="4a93f-181">**Figure 4-12**.</span></span> <span data-ttu-id="4a93f-182">Interakcja polecenia z kolejką</span><span class="sxs-lookup"><span data-stu-id="4a93f-182">Command interaction with a queue</span></span>

<span data-ttu-id="4a93f-183">Najczęściej Producent nie wymaga odpowiedzi i może *fire-and-forget* wiadomości.</span><span class="sxs-lookup"><span data-stu-id="4a93f-183">Most often, the Producer doesn't require a response and can *fire-and-forget* the message.</span></span> <span data-ttu-id="4a93f-184">Jeśli odpowiedź jest potrzebna, konsument wysyła osobną wiadomość z powrotem do producenta na innym kanale.</span><span class="sxs-lookup"><span data-stu-id="4a93f-184">If a reply is needed, the Consumer sends a separate message back to Producer on another channel.</span></span> <span data-ttu-id="4a93f-185">Komunikat polecenia najlepiej jest wysyłać asynchronicznie z kolejką wiadomości.</span><span class="sxs-lookup"><span data-stu-id="4a93f-185">A command message is best sent asynchronously with a message queue.</span></span> <span data-ttu-id="4a93f-186">obsługiwane przez lekki broker wiadomości.</span><span class="sxs-lookup"><span data-stu-id="4a93f-186">supported by a lightweight message broker.</span></span> <span data-ttu-id="4a93f-187">Na poprzednim diagramie należy zwrócić uwagę, jak kolejka oddziela i oddziela obie usługi.</span><span class="sxs-lookup"><span data-stu-id="4a93f-187">In the previous diagram, note how a queue separates and decouples both services.</span></span>

<span data-ttu-id="4a93f-188">Kolejka komunikatów jest konstrukcją pośredniczącą, za pośrednictwem której producent i konsument przekazują wiadomość.</span><span class="sxs-lookup"><span data-stu-id="4a93f-188">A message queue is an intermediary construct through which a producer and consumer pass a message.</span></span> <span data-ttu-id="4a93f-189">Kolejki implementują asynchroniczne wzorzec obsługi wiadomości typu point-to-point.</span><span class="sxs-lookup"><span data-stu-id="4a93f-189">Queues implement an asynchronous, point-to-point messaging pattern.</span></span> <span data-ttu-id="4a93f-190">Producent wie, gdzie należy wysłać polecenie i odpowiednio trasuje.</span><span class="sxs-lookup"><span data-stu-id="4a93f-190">The Producer knows where a command needs to be sent and routes appropriately.</span></span> <span data-ttu-id="4a93f-191">Kolejka gwarantuje, że wiadomość jest przetwarzana przez dokładnie jedno z wystąpień konsumenta, które są odczytywały z kanału.</span><span class="sxs-lookup"><span data-stu-id="4a93f-191">The queue guarantees that a message is processed by exactly one of the consumer instances that are reading from the channel.</span></span> <span data-ttu-id="4a93f-192">W tym scenariuszu producent lub usługa konsumenta można skalować w poziomie bez wpływu na inne.</span><span class="sxs-lookup"><span data-stu-id="4a93f-192">In this scenario, either the producer or consumer service can scale out without affecting the other.</span></span> <span data-ttu-id="4a93f-193">Jak również technologie mogą być różne z każdej strony, co oznacza, że możemy mieć mikrousługi Java wywołując mikrousługi [Golang.](https://golang.org)</span><span class="sxs-lookup"><span data-stu-id="4a93f-193">As well, technologies can be disparate on each side, meaning that we might have a Java microservice calling a [Golang](https://golang.org) microservice.</span></span>

<span data-ttu-id="4a93f-194">W rozdziale 1 rozmawialiśmy o *usługach wspierających.*</span><span class="sxs-lookup"><span data-stu-id="4a93f-194">In chapter 1, we talked about *backing services*.</span></span> <span data-ttu-id="4a93f-195">Usługi pomocnicze to zasoby pomocnicze, od których zależą systemy natywne dla chmury.</span><span class="sxs-lookup"><span data-stu-id="4a93f-195">Backing services are ancillary resources upon which cloud-native systems depend.</span></span> <span data-ttu-id="4a93f-196">Kolejki komunikatów są tworzeniem kopii zapasowych usług.</span><span class="sxs-lookup"><span data-stu-id="4a93f-196">Message queues are backing services.</span></span> <span data-ttu-id="4a93f-197">Chmura platformy Azure obsługuje dwa typy kolejek komunikatów, które systemy natywne w chmurze mogą korzystać w celu zaimplementowania obsługi poleceń: kolejek usługi Azure Storage i kolejek usługi Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="4a93f-197">The Azure cloud supports two types of message queues that your cloud-native systems can consume to implement command messaging: Azure Storage Queues and Azure Service Bus Queues.</span></span>

### <a name="azure-storage-queues"></a><span data-ttu-id="4a93f-198">Kolejki usługi Azure Storage</span><span class="sxs-lookup"><span data-stu-id="4a93f-198">Azure Storage Queues</span></span>

<span data-ttu-id="4a93f-199">Kolejki magazynu platformy Azure oferują prostą infrastrukturę kolejkowania, która jest szybka, przystępna cenowo i wspierana przez konta magazynu platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="4a93f-199">Azure storage queues offer a simple queueing infrastructure that is fast, affordable, and backed by Azure storage accounts.</span></span>

<span data-ttu-id="4a93f-200">[Kolejki usługi Azure Storage](https://docs.microsoft.com/azure/storage/queues/storage-queues-introduction) są wyposażone w mechanizm kolejkowania oparty na rest z niezawodnymi i trwałymi wiadomościami.</span><span class="sxs-lookup"><span data-stu-id="4a93f-200">[Azure Storage Queues](https://docs.microsoft.com/azure/storage/queues/storage-queues-introduction) feature a REST-based queuing mechanism with reliable and persistent messaging.</span></span> <span data-ttu-id="4a93f-201">Zapewniają minimalny zestaw funkcji, ale są niedrogie i przechowują miliony wiadomości.</span><span class="sxs-lookup"><span data-stu-id="4a93f-201">They provide a minimal feature set, but are inexpensive and store millions of messages.</span></span> <span data-ttu-id="4a93f-202">Ich pojemność wynosi do 500 TB.</span><span class="sxs-lookup"><span data-stu-id="4a93f-202">Their capacity ranges up to 500 TB.</span></span> <span data-ttu-id="4a93f-203">Pojedyncza wiadomość może mieć rozmiar do 64 KB.</span><span class="sxs-lookup"><span data-stu-id="4a93f-203">A single message can be up to 64 KB in size.</span></span>

<span data-ttu-id="4a93f-204">Możesz uzyskiwać dostęp do wiadomości z dowolnego miejsca na świecie za pośrednictwem uwierzytelnionych połączeń przy użyciu protokołu HTTP lub HTTPS.</span><span class="sxs-lookup"><span data-stu-id="4a93f-204">You can access messages from anywhere in the world via authenticated calls using HTTP or HTTPS.</span></span> <span data-ttu-id="4a93f-205">Kolejki magazynu można skalować w poziomie do dużej liczby równoczesnych klientów do obsługi skoków ruchu.</span><span class="sxs-lookup"><span data-stu-id="4a93f-205">Storage queues can scale out to large numbers of concurrent clients to handle traffic spikes.</span></span>

<span data-ttu-id="4a93f-206">To powiedziawszy, istnieją ograniczenia związane z usługą:</span><span class="sxs-lookup"><span data-stu-id="4a93f-206">That said, there are limitations with the service:</span></span>

- <span data-ttu-id="4a93f-207">Kolejność wiadomości nie jest gwarantowana.</span><span class="sxs-lookup"><span data-stu-id="4a93f-207">Message order isn't guaranteed.</span></span>

- <span data-ttu-id="4a93f-208">Wiadomość może być zachowywana tylko przez siedem dni, zanim zostanie automatycznie usunięta.</span><span class="sxs-lookup"><span data-stu-id="4a93f-208">A message can only persist for seven days before it's automatically removed.</span></span>

- <span data-ttu-id="4a93f-209">Obsługa zarządzania stanem, wykrywania duplikatów lub transakcji nie jest dostępna.</span><span class="sxs-lookup"><span data-stu-id="4a93f-209">Support for state management, duplicate detection, or transactions isn't available.</span></span>

<span data-ttu-id="4a93f-210">Rysunek 4-13 przedstawia hierarchię kolejki usługi Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="4a93f-210">Figure 4-13 shows the hierarchy of an Azure Storage Queue.</span></span>

![Hierarchia kolejek magazynu](./media/storage-queue-hierarchy.png)

<span data-ttu-id="4a93f-212">**Rysunek 4-13**.</span><span class="sxs-lookup"><span data-stu-id="4a93f-212">**Figure 4-13**.</span></span> <span data-ttu-id="4a93f-213">Hierarchia kolejek magazynu</span><span class="sxs-lookup"><span data-stu-id="4a93f-213">Storage queue hierarchy</span></span>

<span data-ttu-id="4a93f-214">Na poprzedniej ilustracji należy zwrócić uwagę, jak kolejki magazynu przechowywać swoje wiadomości na podstawowym koncie usługi Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="4a93f-214">In the previous figure, note how storage queues store their messages in the underlying Azure Storage account.</span></span>

<span data-ttu-id="4a93f-215">Dla deweloperów firma Microsoft udostępnia kilka bibliotek po stronie klienta i serwera do przetwarzania kolejek magazynu.</span><span class="sxs-lookup"><span data-stu-id="4a93f-215">For developers, Microsoft provides several client and server-side libraries for Storage queue processing.</span></span> <span data-ttu-id="4a93f-216">Większość głównych platform są obsługiwane w tym .NET, Java, JavaScript, Ruby, Python i Go.</span><span class="sxs-lookup"><span data-stu-id="4a93f-216">Most major platforms are supported including .NET, Java, JavaScript, Ruby, Python, and Go.</span></span> <span data-ttu-id="4a93f-217">Deweloperzy nigdy nie powinni komunikować się bezpośrednio z tymi bibliotekami.</span><span class="sxs-lookup"><span data-stu-id="4a93f-217">Developers should never communicate directly with these libraries.</span></span> <span data-ttu-id="4a93f-218">W ten sposób będzie ściśle łącze kodu mikrousług do usługi Azure Storage Queue.</span><span class="sxs-lookup"><span data-stu-id="4a93f-218">Doing so will tightly couple your microservice code to the Azure Storage Queue service.</span></span> <span data-ttu-id="4a93f-219">Jest to lepsza praktyka, aby ocieplić szczegóły implementacji interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="4a93f-219">It's a better practice to insulate the implementation details of the API.</span></span> <span data-ttu-id="4a93f-220">Wprowadzenie warstwy pośrednictwa lub pośredniego interfejsu API, który udostępnia operacje ogólne i hermetyzuje bibliotekę betonu.</span><span class="sxs-lookup"><span data-stu-id="4a93f-220">Introduce an intermediation layer, or intermediate API, that exposes generic operations and encapsulates the concrete library.</span></span> <span data-ttu-id="4a93f-221">To luźne sprzężenie umożliwia zamianę jednej usługi kolejkowania na inną bez konieczności wprowadzania zmian w kodzie usługi mainline.</span><span class="sxs-lookup"><span data-stu-id="4a93f-221">This loose coupling enables you to swap out one queuing service for another without having to make changes to the mainline service code.</span></span>

<span data-ttu-id="4a93f-222">Kolejki usługi Azure Storage są ekonomiczną opcją implementacji obsługi wiadomości poleceń w aplikacjach natywnych dla chmury.</span><span class="sxs-lookup"><span data-stu-id="4a93f-222">Azure Storage queues are an economical option to implement command messaging in your cloud-native applications.</span></span> <span data-ttu-id="4a93f-223">Zwłaszcza, gdy rozmiar kolejki przekroczy 80 GB lub dopuszczalny jest prosty zestaw funkcji.</span><span class="sxs-lookup"><span data-stu-id="4a93f-223">Especially when a queue size will exceed 80 GB, or a simple feature set is acceptable.</span></span> <span data-ttu-id="4a93f-224">Płacisz tylko za przechowywanie wiadomości; nie ma stałych opłat godzinowych.</span><span class="sxs-lookup"><span data-stu-id="4a93f-224">You only pay for the storage of the messages; there are no fixed hourly charges.</span></span>

### <a name="azure-service-bus-queues"></a><span data-ttu-id="4a93f-225">Kolejki usługi Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="4a93f-225">Azure Service Bus Queues</span></span>

<span data-ttu-id="4a93f-226">Aby uzyskać bardziej złożone wymagania dotyczące obsługi wiadomości, należy wziąć pod uwagę kolejki usługi Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="4a93f-226">For more complex messaging requirements, consider Azure Service Bus queues.</span></span>

<span data-ttu-id="4a93f-227">Siedząc na szczycie niezawodnej infrastruktury komunikatów, [usługa Azure Service Bus](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-messaging-overview) obsługuje model obsługi wiadomości z *brokerem.*</span><span class="sxs-lookup"><span data-stu-id="4a93f-227">Sitting atop a robust message infrastructure, [Azure Service Bus](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-messaging-overview) supports a *brokered messaging model*.</span></span> <span data-ttu-id="4a93f-228">Wiadomości są niezawodnie przechowywane w brokera (kolejki) do momentu odebrania przez konsumenta.</span><span class="sxs-lookup"><span data-stu-id="4a93f-228">Messages are reliably stored in a broker (the queue) until received by the consumer.</span></span> <span data-ttu-id="4a93f-229">Kolejka gwarantuje dostarczanie wiadomości FIFO (First-In/First-Out), respektując kolejność, w jakiej wiadomości zostały dodane do kolejki.</span><span class="sxs-lookup"><span data-stu-id="4a93f-229">The queue guarantees First-In/First-Out (FIFO) message delivery, respecting the order in which messages were added to the queue.</span></span>

<span data-ttu-id="4a93f-230">Rozmiar wiadomości może być znacznie większy, do 256 KB.</span><span class="sxs-lookup"><span data-stu-id="4a93f-230">The size of a message can be much larger, up to 256 KB.</span></span> <span data-ttu-id="4a93f-231">Wiadomości są zachowywane w kolejce przez nieograniczony okres czasu.</span><span class="sxs-lookup"><span data-stu-id="4a93f-231">Messages are persisted in the queue for an unlimited period of time.</span></span> <span data-ttu-id="4a93f-232">Usługa Service Bus obsługuje nie tylko wywołania oparte na protokole HTTP, ale także zapewnia pełną obsługę [protokołu AMPQ.](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-amqp-overview)</span><span class="sxs-lookup"><span data-stu-id="4a93f-232">Service Bus supports not only HTTP-based calls, but also provides full support for the [AMPQ protocol](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-amqp-overview).</span></span> <span data-ttu-id="4a93f-233">AMPQ jest otwartym standardem dla dostawców, który obsługuje protokół binarny i wyższy stopień niezawodności.</span><span class="sxs-lookup"><span data-stu-id="4a93f-233">AMPQ is an open-standard across vendors that supports a binary protocol and higher degrees of reliability.</span></span>

<span data-ttu-id="4a93f-234">Usługa Service Bus oferuje bogaty zestaw funkcji, w tym [obsługę transakcji](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-transactions) i [funkcję wykrywania duplikatów.](https://docs.microsoft.com/azure/service-bus-messaging/duplicate-detection)</span><span class="sxs-lookup"><span data-stu-id="4a93f-234">Service Bus provides a rich set of features, including [transaction support](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-transactions) and a [duplicate detection feature](https://docs.microsoft.com/azure/service-bus-messaging/duplicate-detection).</span></span> <span data-ttu-id="4a93f-235">Kolejka gwarantuje "co najwyżej raz dostarczanie" na wiadomość.</span><span class="sxs-lookup"><span data-stu-id="4a93f-235">The queue guarantees "at most once delivery" per message.</span></span> <span data-ttu-id="4a93f-236">Automatycznie odrzuca wiadomość, która została już wysłana.</span><span class="sxs-lookup"><span data-stu-id="4a93f-236">It automatically discards a message that has already been sent.</span></span> <span data-ttu-id="4a93f-237">Jeśli producent ma wątpliwości, może ponownie wysłać tę samą wiadomość, a usługa Service Bus gwarantuje, że tylko jedna kopia zostanie przetworzona.</span><span class="sxs-lookup"><span data-stu-id="4a93f-237">If a producer is in doubt, it can resend the same message, and Service Bus guarantees that only one copy will be processed.</span></span> <span data-ttu-id="4a93f-238">Wykrywanie duplikatów uwalnia cię od konieczności budowy dodatkowej infrastruktury wodociągowej.</span><span class="sxs-lookup"><span data-stu-id="4a93f-238">Duplicate detection frees you from  having to build additional infrastructure plumbing.</span></span>

<span data-ttu-id="4a93f-239">Dwie kolejne funkcje przedsiębiorstwa są partycjonowanie i sesje.</span><span class="sxs-lookup"><span data-stu-id="4a93f-239">Two more enterprise features are partitioning and sessions.</span></span> <span data-ttu-id="4a93f-240">Konwencjonalna kolejka usługi Service Bus jest obsługiwana przez brokera pojedynczych wiadomości i przechowywana w magazynie pojedynczych wiadomości.</span><span class="sxs-lookup"><span data-stu-id="4a93f-240">A conventional Service Bus queue is handled by a single message broker and stored in a single message store.</span></span> <span data-ttu-id="4a93f-241">Ale [usługa Service Bus partycjonowanie](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-partitioning) rozprzestrzenia kolejki w wielu brokerów wiadomości i magazynów komunikatów.</span><span class="sxs-lookup"><span data-stu-id="4a93f-241">But, [Service Bus Partitioning](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-partitioning) spreads the queue across multiple message brokers and message stores.</span></span> <span data-ttu-id="4a93f-242">Ogólna przepływność nie jest już ograniczona przez wydajność jednego brokera wiadomości lub magazynu wiadomości.</span><span class="sxs-lookup"><span data-stu-id="4a93f-242">The overall throughput is no longer limited by the performance of a single message broker or messaging store.</span></span> <span data-ttu-id="4a93f-243">Tymczasowa awaria magazynu obsługi wiadomości nie powoduje, że kolejka podzielona na partycje jest niedostępna.</span><span class="sxs-lookup"><span data-stu-id="4a93f-243">A temporary outage of a messaging store doesn't render a partitioned queue unavailable.</span></span>

<span data-ttu-id="4a93f-244">[Sesje usługi Service Bus](https://codingcanvas.com/azure-service-bus-sessions/) umożliwiają dostarczanie wiadomości związanych z grupą.</span><span class="sxs-lookup"><span data-stu-id="4a93f-244">[Service Bus Sessions](https://codingcanvas.com/azure-service-bus-sessions/) provide a way to group-related messages.</span></span> <span data-ttu-id="4a93f-245">Wyobraź sobie scenariusz przepływu pracy, w którym wiadomości muszą być przetwarzane razem i operacja zakończona na końcu.</span><span class="sxs-lookup"><span data-stu-id="4a93f-245">Imagine a workflow scenario where messages must be processed together and the operation completed at the end.</span></span> <span data-ttu-id="4a93f-246">Aby skorzystać, sesje muszą być jawnie włączone dla kolejki i każdy związany z messaged musi zawierać ten sam identyfikator sesji.</span><span class="sxs-lookup"><span data-stu-id="4a93f-246">To take advantage, sessions must be explicitly enabled for the queue and each related messaged must contain the same session ID.</span></span>

<span data-ttu-id="4a93f-247">Istnieją jednak pewne ważne zastrzeżenia: rozmiar kolejek usługi Service Bus jest ograniczony do 80 GB, co jest znacznie mniejsze niż dostępne w kolejkach sklepu.</span><span class="sxs-lookup"><span data-stu-id="4a93f-247">However, there are some important caveats: Service Bus queues size is limited to 80 GB, which is much smaller than what's available from store queues.</span></span> <span data-ttu-id="4a93f-248">Ponadto kolejki usługi Service Bus ponoszą koszt podstawowy i obciążenie za operację.</span><span class="sxs-lookup"><span data-stu-id="4a93f-248">Additionally, Service Bus queues incur a base cost and charge per operation.</span></span>

<span data-ttu-id="4a93f-249">Rysunek 4-14 przedstawia architekturę wysokiego poziomu kolejki usługi Service Bus.</span><span class="sxs-lookup"><span data-stu-id="4a93f-249">Figure 4-14 outlines the high-level architecture of a Service Bus queue.</span></span>

![Kolejka usługi Service Bus](./media/service-bus-queue.png)

<span data-ttu-id="4a93f-251">**Rysunek 4-14**.</span><span class="sxs-lookup"><span data-stu-id="4a93f-251">**Figure 4-14**.</span></span> <span data-ttu-id="4a93f-252">Kolejka usługi Service Bus</span><span class="sxs-lookup"><span data-stu-id="4a93f-252">Service Bus queue</span></span>

<span data-ttu-id="4a93f-253">Na poprzednim rysunku zanotuj relację punkt-punkt.</span><span class="sxs-lookup"><span data-stu-id="4a93f-253">In the previous figure, note the point-to-point relationship.</span></span> <span data-ttu-id="4a93f-254">Dwa wystąpienia tego samego dostawcy są umieszczania w kolejce wiadomości w jednej kolejce usługi Service Bus.</span><span class="sxs-lookup"><span data-stu-id="4a93f-254">Two instances of the same provider are enqueuing messages into a single Service Bus queue.</span></span> <span data-ttu-id="4a93f-255">Każda wiadomość jest zużywana tylko przez jedno z trzech wystąpień konsumenta po prawej stronie.</span><span class="sxs-lookup"><span data-stu-id="4a93f-255">Each message is consumed by only one of three consumer instances on the right.</span></span> <span data-ttu-id="4a93f-256">Następnie omówimy sposób implementowania wiadomości, w których różni konsumenci mogą być zainteresowani tą samą wiadomością.</span><span class="sxs-lookup"><span data-stu-id="4a93f-256">Next, we discuss how to implement messaging where different consumers may all be interested the same message.</span></span>

## <a name="events"></a><span data-ttu-id="4a93f-257">Zdarzenia</span><span class="sxs-lookup"><span data-stu-id="4a93f-257">Events</span></span>

<span data-ttu-id="4a93f-258">Kolejkowanie wiadomości jest skutecznym sposobem implementacji komunikacji, w której producent może asynchronicznie wysłać do konsumenta wiadomość.</span><span class="sxs-lookup"><span data-stu-id="4a93f-258">Message queuing is an effective way to implement communication where a producer can asynchronously send a consumer a message.</span></span> <span data-ttu-id="4a93f-259">Co się jednak dzieje, gdy *wielu różnych konsumentów* jest zainteresowanych tą samą wiadomością?</span><span class="sxs-lookup"><span data-stu-id="4a93f-259">However, what happens when *many different consumers* are interested in the same message?</span></span> <span data-ttu-id="4a93f-260">Dedykowana kolejka komunikatów dla każdego konsumenta nie będzie dobrze skalowana i stałaby się trudna do zarządzania.</span><span class="sxs-lookup"><span data-stu-id="4a93f-260">A dedicated message queue for each consumer wouldn't scale well and would become difficult to manage.</span></span>

<span data-ttu-id="4a93f-261">Aby rozwiązać ten scenariusz, przechodzimy do trzeciego typu interakcji wiadomości, *zdarzenia*.</span><span class="sxs-lookup"><span data-stu-id="4a93f-261">To address this scenario, we move to the third type of message interaction, the *event*.</span></span> <span data-ttu-id="4a93f-262">Jedna mikrousługa informuje, że wystąpiła akcja.</span><span class="sxs-lookup"><span data-stu-id="4a93f-262">One microservice announces that an action had occurred.</span></span> <span data-ttu-id="4a93f-263">Inne mikrousługi, jeśli są zainteresowane, reagować na akcję lub zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="4a93f-263">Other microservices, if interested, react to the action, or event.</span></span>

<span data-ttu-id="4a93f-264">Eventing jest procesem dwuetapowym.</span><span class="sxs-lookup"><span data-stu-id="4a93f-264">Eventing is a two-step process.</span></span> <span data-ttu-id="4a93f-265">Dla danej zmiany stanu mikrousługi publikuje zdarzenie do brokera komunikatów, udostępniając go do innych zainteresowanych mikrousług.</span><span class="sxs-lookup"><span data-stu-id="4a93f-265">For a given state change, a microservice publishes an event to a message broker, making it available to any other interested microservice.</span></span> <span data-ttu-id="4a93f-266">Zainteresowanych mikrousługi jest powiadamiany przez subskrybowanie zdarzenia w brokera komunikatów.</span><span class="sxs-lookup"><span data-stu-id="4a93f-266">The interested microservice is notified by subscribing to the event in the message broker.</span></span> <span data-ttu-id="4a93f-267">Wzorzec [publikowania/subskrybowania](https://docs.microsoft.com/azure/architecture/patterns/publisher-subscriber) służy do implementowania [komunikacji opartej na zdarzeniach](https://docs.microsoft.com/dotnet/standard/microservices-architecture/multi-container-microservice-net-applications/integration-event-based-microservice-communications).</span><span class="sxs-lookup"><span data-stu-id="4a93f-267">You use the [Publish/Subscribe](https://docs.microsoft.com/azure/architecture/patterns/publisher-subscriber) pattern to implement [event-based communication](https://docs.microsoft.com/dotnet/standard/microservices-architecture/multi-container-microservice-net-applications/integration-event-based-microservice-communications).</span></span>

<span data-ttu-id="4a93f-268">Rysunek 4-15 przedstawia mikrousługi koszyka zakupów publikowania zdarzenia z dwóch innych mikrousług subskrybujących go.</span><span class="sxs-lookup"><span data-stu-id="4a93f-268">Figure 4-15 shows a shopping basket microservice publishing an event with two other microservices subscribing to it.</span></span>

![Wiadomości sterowane zdarzeniami](./media/event-driven-messaging.png)

<span data-ttu-id="4a93f-270">**Rysunek 4-15**.</span><span class="sxs-lookup"><span data-stu-id="4a93f-270">**Figure 4-15**.</span></span> <span data-ttu-id="4a93f-271">Wiadomości sterowane zdarzeniami</span><span class="sxs-lookup"><span data-stu-id="4a93f-271">Event-Driven messaging</span></span>

<span data-ttu-id="4a93f-272">Zwróć uwagę na składnik *magistrali zdarzeń,* który znajduje się w środku kanału komunikacyjnego.</span><span class="sxs-lookup"><span data-stu-id="4a93f-272">Note the *event bus* component that sits in the middle of the communication channel.</span></span> <span data-ttu-id="4a93f-273">Jest to klasa niestandardowa, która hermetyzuje brokera komunikatów i oddziela go od podstawowej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="4a93f-273">It's a custom class that encapsulates the message broker and decouples it from the underlying application.</span></span> <span data-ttu-id="4a93f-274">Mikrousługi zamawiania i zapasów niezależnie obsługują zdarzenie bez znajomości siebie nawzajem, ani mikrousług koszyka zakupów.</span><span class="sxs-lookup"><span data-stu-id="4a93f-274">The ordering and inventory microservices independently operate the event with no knowledge of each other, nor the shopping basket microservice.</span></span> <span data-ttu-id="4a93f-275">Gdy zarejestrowane zdarzenie zostanie opublikowane w autobusie zdarzeń, działają na nim.</span><span class="sxs-lookup"><span data-stu-id="4a93f-275">When the registered event is published to the event bus, they act upon it.</span></span>

<span data-ttu-id="4a93f-276">Wraz z eventingiem przechodzimy od technologii kolejkowania do *tematów.*</span><span class="sxs-lookup"><span data-stu-id="4a93f-276">With eventing, we move from queuing technology to *topics*.</span></span> <span data-ttu-id="4a93f-277">[Temat](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions) jest podobny do kolejki, ale obsługuje wzorzec obsługi wiadomości jeden do wielu.</span><span class="sxs-lookup"><span data-stu-id="4a93f-277">A [topic](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions) is similar to a queue, but supports a one-to-many messaging pattern.</span></span> <span data-ttu-id="4a93f-278">Jedna mikrousługa publikuje komunikat.</span><span class="sxs-lookup"><span data-stu-id="4a93f-278">One microservice publishes a message.</span></span> <span data-ttu-id="4a93f-279">Wiele mikrousług subskrybujących można wybrać do odbierania i działania na tej wiadomości.</span><span class="sxs-lookup"><span data-stu-id="4a93f-279">Multiple subscribing microservices can choose to receive and act upon that message.</span></span> <span data-ttu-id="4a93f-280">Rysunek 4-16 przedstawia architekturę tematu.</span><span class="sxs-lookup"><span data-stu-id="4a93f-280">Figure 4-16 shows a topic architecture.</span></span>

![Architektura tematu](./media/topic-architecture.png)

<span data-ttu-id="4a93f-282">**Rysunek 4-16**.</span><span class="sxs-lookup"><span data-stu-id="4a93f-282">**Figure 4-16**.</span></span> <span data-ttu-id="4a93f-283">Architektura tematu</span><span class="sxs-lookup"><span data-stu-id="4a93f-283">Topic architecture</span></span>

<span data-ttu-id="4a93f-284">Na poprzedniej ilustracji wydawcy wysyłają wiadomości do tematu.</span><span class="sxs-lookup"><span data-stu-id="4a93f-284">In the previous figure, publishers send messages to the topic.</span></span> <span data-ttu-id="4a93f-285">Na końcu subskrybenci otrzymują wiadomości z subskrypcji.</span><span class="sxs-lookup"><span data-stu-id="4a93f-285">At the end, subscribers receive messages from subscriptions.</span></span> <span data-ttu-id="4a93f-286">W środku temat przekazuje wiadomości do subskrypcji na podstawie zestawu *reguł,* wyświetlanych w ciemnoniebieskich polach.</span><span class="sxs-lookup"><span data-stu-id="4a93f-286">In the middle, the topic forwards messages to subscriptions based on a set of *rules*, shown in dark blue boxes.</span></span> <span data-ttu-id="4a93f-287">Reguły działają jako filtr, który przekazuje określone wiadomości do subskrypcji.</span><span class="sxs-lookup"><span data-stu-id="4a93f-287">Rules act as a filter that forward specific messages to a subscription.</span></span> <span data-ttu-id="4a93f-288">W tym miejscu zdarzenie "CreateOrder" \#zostanie wysłane \#do subskrypcji 1 \#i subskrypcji 3, ale nie do subskrypcji 2.</span><span class="sxs-lookup"><span data-stu-id="4a93f-288">Here, a "CreateOrder" event would be sent to Subscription \#1 and Subscription \#3, but not to Subscription \#2.</span></span> <span data-ttu-id="4a93f-289">Zdarzenie "OrderCompleted" zostanie wysłane \#do subskrypcji \#2 i subskrypcji 3.</span><span class="sxs-lookup"><span data-stu-id="4a93f-289">An "OrderCompleted" event would be sent to Subscription \#2 and Subscription \#3.</span></span>

<span data-ttu-id="4a93f-290">Chmura platformy Azure obsługuje dwie różne usługi tematu: Tematy usługi Azure Service Bus i Usługi Azure EventGrid.</span><span class="sxs-lookup"><span data-stu-id="4a93f-290">The Azure cloud supports two different topic services: Azure Service Bus Topics and Azure EventGrid.</span></span>

### <a name="azure-service-bus-topics"></a><span data-ttu-id="4a93f-291">Tematy usługi Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="4a93f-291">Azure Service Bus Topics</span></span>

<span data-ttu-id="4a93f-292">Obok tego samego niezawodnego modelu wiadomości obsługiwanych przez brokera kolejek usługi Azure Service Bus znajdują się [tematy usługi Azure Service Bus.](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions)</span><span class="sxs-lookup"><span data-stu-id="4a93f-292">Sitting on top of the same robust brokered message model of Azure Service Bus queues are [Azure Service Bus Topics](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions).</span></span> <span data-ttu-id="4a93f-293">Temat może odbierać wiadomości od wielu niezależnych wydawców i wysyłać wiadomości do maksymalnie 2000 subskrybentów.</span><span class="sxs-lookup"><span data-stu-id="4a93f-293">A topic can receive messages from multiple independent publishers and send messages to up to 2,000 subscribers.</span></span> <span data-ttu-id="4a93f-294">Subskrypcje mogą być dynamicznie dodawane lub usuwane w czasie wykonywania bez zatrzymywania systemu lub ponownego tworzenia tematu.</span><span class="sxs-lookup"><span data-stu-id="4a93f-294">Subscriptions can be dynamically added or removed at runtime without stopping the system or recreating the topic.</span></span>

<span data-ttu-id="4a93f-295">Wiele zaawansowanych funkcji kolejek usługi Azure Service Bus jest również dostępnych dla tematów, w tym [wykrywania duplikatów](https://docs.microsoft.com/azure/service-bus-messaging/duplicate-detection) i [obsługi transakcji.](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-transactions)</span><span class="sxs-lookup"><span data-stu-id="4a93f-295">Many advanced features from Azure Service Bus queues are also available for topics, including [Duplicate Detection](https://docs.microsoft.com/azure/service-bus-messaging/duplicate-detection) and [Transaction support](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-transactions).</span></span> <span data-ttu-id="4a93f-296">Domyślnie tematy usługi Service Bus są obsługiwane przez brokera pojedynczych wiadomości i przechowywane w magazynie pojedynczych wiadomości.</span><span class="sxs-lookup"><span data-stu-id="4a93f-296">By default, Service Bus topics are handled by a single message broker and stored in a single message store.</span></span> <span data-ttu-id="4a93f-297">Ale [usługa Service Bus partycjonowanie](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-partitioning) skaluje temat, rozprzestrzeniając go na wielu brokerów wiadomości i magazynów wiadomości.</span><span class="sxs-lookup"><span data-stu-id="4a93f-297">But, [Service Bus Partitioning](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-partitioning) scales a topic by spreading it across many message brokers and message stores.</span></span>

<span data-ttu-id="4a93f-298">[Zaplanowane dostarczanie wiadomości](https://docs.microsoft.com/azure/service-bus-messaging/message-sequencing) oznacza wiadomość z określonym czasem przetwarzania.</span><span class="sxs-lookup"><span data-stu-id="4a93f-298">[Scheduled Message Delivery](https://docs.microsoft.com/azure/service-bus-messaging/message-sequencing) tags a message with a specific time for processing.</span></span> <span data-ttu-id="4a93f-299">Komunikat nie pojawi się w temacie przed tym czasem.</span><span class="sxs-lookup"><span data-stu-id="4a93f-299">The message won't appear in the topic before that time.</span></span> <span data-ttu-id="4a93f-300">[Odroczenie wiadomości](https://docs.microsoft.com/azure/service-bus-messaging/message-deferral) umożliwia odroczenie pobierania wiadomości do późniejszego czasu.</span><span class="sxs-lookup"><span data-stu-id="4a93f-300">[Message Deferral](https://docs.microsoft.com/azure/service-bus-messaging/message-deferral) enables you to defer a retrieval of a message to a later time.</span></span> <span data-ttu-id="4a93f-301">Oba są powszechnie używane w scenariuszach przetwarzania przepływu pracy, w których operacje są przetwarzane w określonej kolejności.</span><span class="sxs-lookup"><span data-stu-id="4a93f-301">Both are commonly used in workflow processing scenarios where operations are processed in a particular order.</span></span> <span data-ttu-id="4a93f-302">Przetwarzanie odebranych wiadomości można odroczyć do czasu zakończenia wcześniejszej pracy.</span><span class="sxs-lookup"><span data-stu-id="4a93f-302">You can postpone processing of received messages until prior work has been completed.</span></span>

<span data-ttu-id="4a93f-303">Tematy usługi Service Bus to niezawodna i sprawdzona technologia umożliwiająca publikowanie/subskrybowanie komunikacji w systemach natywnych dla chmury.</span><span class="sxs-lookup"><span data-stu-id="4a93f-303">Service Bus topics are a robust and proven technology for enabling publish/subscribe communication in your cloud-native systems.</span></span>

### <a name="azure-event-grid"></a><span data-ttu-id="4a93f-304">Azure Event Grid</span><span class="sxs-lookup"><span data-stu-id="4a93f-304">Azure Event Grid</span></span>

<span data-ttu-id="4a93f-305">Usługa Azure Service Bus jest testowanym w bitwa brokerem obsługi wiadomości z pełnym zestawem funkcji przedsiębiorstwa, [usługa Azure Event Grid](https://docs.microsoft.com/azure/event-grid/overview) jest nowym elementem programu typu kid w bloku.</span><span class="sxs-lookup"><span data-stu-id="4a93f-305">While Azure Service Bus is a battle-tested messaging broker with a full set of enterprise features, [Azure Event Grid](https://docs.microsoft.com/azure/event-grid/overview) is the new kid on the block.</span></span>

<span data-ttu-id="4a93f-306">Na pierwszy rzut oka usługa Event Grid może wyglądać jak inny system obsługi wiadomości oparty na temacie.</span><span class="sxs-lookup"><span data-stu-id="4a93f-306">At first glance, Event Grid may look like just another topic-based messaging system.</span></span> <span data-ttu-id="4a93f-307">Jednak pod wieloma względami jest inny.</span><span class="sxs-lookup"><span data-stu-id="4a93f-307">However, it's different in many ways.</span></span> <span data-ttu-id="4a93f-308">Koncentruje się na obciążeniach opartych na zdarzeniach, umożliwia przetwarzanie zdarzeń w czasie rzeczywistym, głęboką integrację z platformą Azure i otwartą platformę — wszystko na infrastrukturze bezserwerowej.</span><span class="sxs-lookup"><span data-stu-id="4a93f-308">Focused on event-driven workloads, it enables real-time event processing, deep Azure integration, and an open-platform - all on serverless infrastructure.</span></span> <span data-ttu-id="4a93f-309">Jest przeznaczony do nowoczesnych aplikacji natywnych dla chmury i bezserwerowych</span><span class="sxs-lookup"><span data-stu-id="4a93f-309">It's designed for contemporary cloud-native and serverless applications</span></span>

<span data-ttu-id="4a93f-310">Jako scentralizowana *zasuń i*potoku usługa Event Grid reaguje na zdarzenia wewnątrz zasobów platformy Azure i z własnych usług.</span><span class="sxs-lookup"><span data-stu-id="4a93f-310">As a centralized *eventing backplane*, or pipe, Event Grid reacts to events inside Azure resources and from your own services.</span></span>

<span data-ttu-id="4a93f-311">Powiadomienia o zdarzeniach są publikowane w temacie siatki zdarzeń, który z kolei kieruje każde zdarzenie do subskrypcji.</span><span class="sxs-lookup"><span data-stu-id="4a93f-311">Event notifications are published to an Event Grid Topic, which, in turn, routes each event to a subscription.</span></span> <span data-ttu-id="4a93f-312">Subskrybenci mapują subskrypcje i korzystają ze zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="4a93f-312">Subscribers map to subscriptions and consume the events.</span></span> <span data-ttu-id="4a93f-313">Podobnie jak usługa Service Bus, usługa Event Grid obsługuje *filtrowany model subskrybenta,* w którym reguła subskrypcji ustawia dla zdarzeń, które chce otrzymać.</span><span class="sxs-lookup"><span data-stu-id="4a93f-313">Like Service Bus, Event Grid supports a *filtered subscriber model* where a subscription sets rule for the events it wishes to receive.</span></span> <span data-ttu-id="4a93f-314">Usługa Event Grid zapewnia szybką przepływność z gwarancją 10 milionów zdarzeń na sekundę, umożliwiając dostarczanie w pobliżu czasu rzeczywistego — znacznie więcej niż może generować usługa Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="4a93f-314">Event Grid provides fast throughput with a guarantee of 10 million events per second enabling near real-time delivery - far more than what Azure Service Bus can generate.</span></span>

<span data-ttu-id="4a93f-315">Sweet spot dla usługi Event Grid jest jego głębokiej integracji z sieci szkieletowej infrastruktury platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="4a93f-315">A sweet spot for Event Grid is its deep integration into the fabric of Azure infrastructure.</span></span> <span data-ttu-id="4a93f-316">Zasób platformy Azure, taki jak Usługa Cosmos DB, może publikować wbudowane zdarzenia bezpośrednio do innych zainteresowanych zasobów platformy Azure — bez konieczności stosowania kodu niestandardowego.</span><span class="sxs-lookup"><span data-stu-id="4a93f-316">An Azure resource, such as Cosmos DB, can publish built-in events directly to other interested Azure resources - without the need for custom code.</span></span> <span data-ttu-id="4a93f-317">Usługa Event Grid może publikować zdarzenia z subskrypcji platformy Azure, grupy zasobów lub usługi, zapewniając deweloperom szczegółową kontrolę nad cyklem życia zasobów w chmurze.</span><span class="sxs-lookup"><span data-stu-id="4a93f-317">Event Grid can publish events from an Azure Subscription, Resource Group, or Service, giving developers fine-grained control over the lifecycle of cloud resources.</span></span> <span data-ttu-id="4a93f-318">Jednak usługa Event Grid nie jest ograniczona do platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="4a93f-318">However, Event Grid isn't limited to Azure.</span></span> <span data-ttu-id="4a93f-319">Jest to otwarta platforma, która może korzystać z niestandardowych zdarzeń HTTP opublikowanych z aplikacji lub usług innych firm i kierować zdarzenia do subskrybentów zewnętrznych.</span><span class="sxs-lookup"><span data-stu-id="4a93f-319">It's an open platform that can consume custom HTTP events published from applications or third-party services and route events to external subscribers.</span></span>

<span data-ttu-id="4a93f-320">Podczas publikowania i subskrybowania zdarzeń natywnych z zasobów platformy Azure nie jest wymagane kodowanie.</span><span class="sxs-lookup"><span data-stu-id="4a93f-320">When publishing and subscribing to native events from Azure resources, no coding is required.</span></span> <span data-ttu-id="4a93f-321">Za pomocą prostej konfiguracji można integrować zdarzenia z jednego zasobu platformy Azure do innego, wykorzystując wbudowaną instalację wodno-kanalizacyjną dla tematów i subskrypcji.</span><span class="sxs-lookup"><span data-stu-id="4a93f-321">With simple configuration, you can integrate events from one Azure resource to another leveraging built-in plumbing for Topics and Subscriptions.</span></span> <span data-ttu-id="4a93f-322">Rysunek 4-17 przedstawia anatomię siatki zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="4a93f-322">Figure 4-17 shows the anatomy of Event Grid.</span></span>

![Anatomia siatki zdarzeń](./media/event-grid-anatomy.png)

<span data-ttu-id="4a93f-324">**Rysunek 4-17**.</span><span class="sxs-lookup"><span data-stu-id="4a93f-324">**Figure 4-17**.</span></span> <span data-ttu-id="4a93f-325">Anatomia siatki zdarzeń</span><span class="sxs-lookup"><span data-stu-id="4a93f-325">Event Grid anatomy</span></span>

<span data-ttu-id="4a93f-326">Główną różnicą między EventGrid i Service Bus jest podstawowy *wzorzec wymiany komunikatów*.</span><span class="sxs-lookup"><span data-stu-id="4a93f-326">A major difference between EventGrid and Service Bus is the underlying *message exchange pattern*.</span></span>

<span data-ttu-id="4a93f-327">Usługa Service Bus implementuje *model ściągania* starszego stylu, w którym subskrybent podrzędny aktywnie sonduje subskrypcję tematu dla nowych wiadomości.</span><span class="sxs-lookup"><span data-stu-id="4a93f-327">Service Bus implements an older style *pull model* in which the downstream subscriber actively polls the topic subscription for new messages.</span></span> <span data-ttu-id="4a93f-328">Z drugiej strony takie podejście daje subskrybentowi pełną kontrolę nad tempem, w jakim przetwarza wiadomości.</span><span class="sxs-lookup"><span data-stu-id="4a93f-328">On the upside, this approach gives the subscriber full control of the pace at which it processes messages.</span></span> <span data-ttu-id="4a93f-329">Kontroluje, kiedy i ile wiadomości do przetworzenia w danym momencie.</span><span class="sxs-lookup"><span data-stu-id="4a93f-329">It controls when and how many messages to process at any given time.</span></span> <span data-ttu-id="4a93f-330">Nieprzeczytane wiadomości pozostają w subskrypcji do czasu przetworzenia.</span><span class="sxs-lookup"><span data-stu-id="4a93f-330">Unread messages remain in the subscription until processed.</span></span> <span data-ttu-id="4a93f-331">Istotnym mankamentem jest opóźnienie między czasem generowania zdarzenia a operacją sondowania, która pobiera tę wiadomość do subskrybenta w celu przetworzenia.</span><span class="sxs-lookup"><span data-stu-id="4a93f-331">A significant shortcoming is the latency between the time the event is generated and the polling operation that pulls that message to the subscriber for processing.</span></span> <span data-ttu-id="4a93f-332">Ponadto obciążenie ciągłego sondowania dla następnego zdarzenia zużywa zasoby i pieniądze.</span><span class="sxs-lookup"><span data-stu-id="4a93f-332">Also, the overhead of constant polling for the next event consumes resources and money.</span></span>

<span data-ttu-id="4a93f-333">EventGrid jest jednak inny.</span><span class="sxs-lookup"><span data-stu-id="4a93f-333">EventGrid, however, is different.</span></span> <span data-ttu-id="4a93f-334">Implementuje *model wypychania,* w którym zdarzenia są wysyłane do EventHandlers jako odebrane, dając niemal w czasie rzeczywistym dostarczania zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="4a93f-334">It implements a *push model* in which events are sent to the EventHandlers as received, giving near real-time event delivery.</span></span> <span data-ttu-id="4a93f-335">Zmniejsza również koszty, ponieważ usługa jest wyzwalana tylko wtedy, gdy jest to potrzebne do korzystania ze zdarzenia — nie stale, jak w przypadku sondowania.</span><span class="sxs-lookup"><span data-stu-id="4a93f-335">It also reduces cost as the service is triggered only when it's needed to consume an event – not continually as with polling.</span></span> <span data-ttu-id="4a93f-336">Mimo to program obsługi zdarzeń musi obsługiwać obciążenia przychodzącego i zapewnić mechanizmy ograniczania przepustowości, aby chronić się przed przeciążeniem.</span><span class="sxs-lookup"><span data-stu-id="4a93f-336">That said, an event handler must handle the incoming load and provide throttling mechanisms to protect itself from becoming overwhelmed.</span></span> <span data-ttu-id="4a93f-337">Wiele usług platformy Azure, które korzystają z tych zdarzeń, takich jak usługi Azure Functions i aplikacje logiki zapewniają możliwości automatycznego skalowania automatycznego do obsługi zwiększonych obciążeń.</span><span class="sxs-lookup"><span data-stu-id="4a93f-337">Many Azure services that consume these events, such as Azure Functions and Logic Apps provide automatic autoscaling capabilities to handle increased loads.</span></span>  

<span data-ttu-id="4a93f-338">Event Grid to w pełni zarządzana usługa w chmurze bezserwerowa.</span><span class="sxs-lookup"><span data-stu-id="4a93f-338">Event Grid is a fully managed serverless cloud service.</span></span> <span data-ttu-id="4a93f-339">Dynamicznie skaluje się w zależności od ruchu i pobiera opłaty tylko za rzeczywiste użycie, a nie za wcześniej zakupioną pojemność.</span><span class="sxs-lookup"><span data-stu-id="4a93f-339">It dynamically scales based on your traffic and charges you only for your actual usage, not pre-purchased capacity.</span></span> <span data-ttu-id="4a93f-340">Pierwsze 100 000 operacji miesięcznie jest bezpłatnych — operacje są definiowane jako przychodzące zdarzenia (powiadomienia o zdarzeniach przychodzących), próby dostarczenia subskrypcji, wywołania zarządzania i filtrowanie według tematu.</span><span class="sxs-lookup"><span data-stu-id="4a93f-340">The first 100,000 operations per month are free – operations being defined as event ingress (incoming event notifications), subscription delivery attempts, management calls, and filtering by subject.</span></span> <span data-ttu-id="4a93f-341">Dzięki dostępności 99,99% EventGrid gwarantuje dostarczenie zdarzenia w ciągu 24 godzin, z wbudowaną funkcją ponawiania prób w przypadku nieudanej dostawy.</span><span class="sxs-lookup"><span data-stu-id="4a93f-341">With 99.99% availability, EventGrid guarantees the delivery of an event within a 24-hour period, with built-in retry functionality for unsuccessful delivery.</span></span> <span data-ttu-id="4a93f-342">Niedostarczone wiadomości można przenieść do kolejki "ślepej wiadomości" do rozwiązania.</span><span class="sxs-lookup"><span data-stu-id="4a93f-342">Undelivered messages can be moved to a "dead-letter" queue for resolution.</span></span>  <span data-ttu-id="4a93f-343">W przeciwieństwie do usługi Azure Service Bus, usługa Event Grid jest dostrojona pod kątem szybkiej wydajności i nie obsługuje funkcji, takich jak uporządkowane wiadomości, transakcje i sesje.</span><span class="sxs-lookup"><span data-stu-id="4a93f-343">Unlike Azure Service Bus, Event Grid is tuned for fast performance and doesn't support features like ordered messaging, transactions, and sessions.</span></span>

### <a name="streaming-messages-in-the-azure-cloud"></a><span data-ttu-id="4a93f-344">Przesyłanie strumieniowe wiadomości w chmurze platformy Azure</span><span class="sxs-lookup"><span data-stu-id="4a93f-344">Streaming messages in the Azure cloud</span></span>

<span data-ttu-id="4a93f-345">Usługa Azure Service Bus i event grid zapewniają doskonałą obsługę aplikacji, które udostępniają pojedyncze, dyskretne zdarzenia, takie jak nowy dokument został wstawiony do usługi Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4a93f-345">Azure Service Bus and Event Grid provide great support for applications that expose single, discrete events like a new document has been inserted into a Cosmos DB.</span></span> <span data-ttu-id="4a93f-346">Ale co zrobić, jeśli system natywny dla chmury musi przetwarzać *strumień powiązanych zdarzeń?*</span><span class="sxs-lookup"><span data-stu-id="4a93f-346">But, what if your cloud-native system needs to process a *stream of related events*?</span></span> <span data-ttu-id="4a93f-347">[Strumienie zdarzeń](https://docs.microsoft.com/archive/msdn-magazine/2015/february/microsoft-azure-the-rise-of-event-stream-oriented-systems) są bardziej złożone.</span><span class="sxs-lookup"><span data-stu-id="4a93f-347">[Event streams](https://docs.microsoft.com/archive/msdn-magazine/2015/february/microsoft-azure-the-rise-of-event-stream-oriented-systems) are more complex.</span></span> <span data-ttu-id="4a93f-348">Są one zazwyczaj uporządkowane w czasie, powiązane ze sobą i muszą być przetwarzane jako grupa.</span><span class="sxs-lookup"><span data-stu-id="4a93f-348">They're typically time-ordered, interrelated, and must be processed as a group.</span></span>

<span data-ttu-id="4a93f-349">[Usługa Azure Event Hub](https://azure.microsoft.com/services/event-hubs/) to platforma przesyłania strumieniowego danych i usługa pozyskiwania zdarzeń, która zbiera, przekształca i przechowuje zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="4a93f-349">[Azure Event Hub](https://azure.microsoft.com/services/event-hubs/) is a data streaming platform and event ingestion service that collects, transforms, and stores events.</span></span> <span data-ttu-id="4a93f-350">Jest dostrojony do przechwytywania danych przesyłania strumieniowego, takich jak powiadomienia o zdarzeniach ciągłych emitowane z kontekstu telemetrycznego.</span><span class="sxs-lookup"><span data-stu-id="4a93f-350">It's fine-tuned to capture streaming data, such as continuous event notifications emitted from a telemetry context.</span></span> <span data-ttu-id="4a93f-351">Usługa jest wysoce skalowalna i może przechowywać i [przetwarzać miliony zdarzeń na sekundę.](https://docs.microsoft.com/azure/event-hubs/event-hubs-about)</span><span class="sxs-lookup"><span data-stu-id="4a93f-351">The service is highly scalable and can store and [process millions of events per second](https://docs.microsoft.com/azure/event-hubs/event-hubs-about).</span></span> <span data-ttu-id="4a93f-352">Pokazano na rysunku 4-18, często jest drzwiami frontowymi dla potoku zdarzeń, odłączając strumień pozyskiwania od zużycia zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="4a93f-352">Shown in Figure 4-18, it's often a front door for an event pipeline, decoupling ingest stream from event consumption.</span></span>

![Centrum zdarzeń Azure](./media/azure-event-hub.png)

<span data-ttu-id="4a93f-354">**Rysunek 4-18**.</span><span class="sxs-lookup"><span data-stu-id="4a93f-354">**Figure 4-18**.</span></span> <span data-ttu-id="4a93f-355">Centrum zdarzeń Azure</span><span class="sxs-lookup"><span data-stu-id="4a93f-355">Azure Event Hub</span></span>

<span data-ttu-id="4a93f-356">Usługa Event Hub obsługuje małe opóźnienia i konfigurowalne przechowywanie czasu.</span><span class="sxs-lookup"><span data-stu-id="4a93f-356">Event Hub supports low latency and configurable time retention.</span></span> <span data-ttu-id="4a93f-357">W przeciwieństwie do kolejek i tematów centra zdarzeń przechowują dane zdarzeń po ich odczytywanie przez konsumenta.</span><span class="sxs-lookup"><span data-stu-id="4a93f-357">Unlike queues and topics, Event Hubs keep event data after it's been read by a consumer.</span></span> <span data-ttu-id="4a93f-358">Ta funkcja umożliwia innym usługom analitycznym danych, zarówno wewnętrznym, jak i zewnętrznym, odtwarzanie danych w celu dalszej analizy.</span><span class="sxs-lookup"><span data-stu-id="4a93f-358">This feature enables other data analytic services, both internal and external, to replay the data for further analysis.</span></span> <span data-ttu-id="4a93f-359">Zdarzenia przechowywane w Centrum zdarzeń są usuwane tylko po upływie okresu przechowywania, który jest domyślnie jeden dzień, ale konfigurowalne.</span><span class="sxs-lookup"><span data-stu-id="4a93f-359">Events stored in event hub are only deleted upon expiration of the retention period, which is one day by default, but configurable.</span></span>

<span data-ttu-id="4a93f-360">Centrum zdarzeń obsługuje typowe protokoły publikowania zdarzeń, w tym HTTPS i AMQP.</span><span class="sxs-lookup"><span data-stu-id="4a93f-360">Event Hub supports common event publishing protocols including HTTPS and AMQP.</span></span> <span data-ttu-id="4a93f-361">Obsługuje również platformę Kafka 1.0.</span><span class="sxs-lookup"><span data-stu-id="4a93f-361">It also supports Kafka 1.0.</span></span> <span data-ttu-id="4a93f-362">[Istniejące aplikacje platformy Kafka mogą komunikować się z Centrum zdarzeń](https://docs.microsoft.com/azure/event-hubs/event-hubs-for-kafka-ecosystem-overview) przy użyciu protokołu platformy Kafka, zapewniając alternatywę dla zarządzania dużymi klastrami platformy Kafka.</span><span class="sxs-lookup"><span data-stu-id="4a93f-362">[Existing Kafka applications can communicate with Event Hub](https://docs.microsoft.com/azure/event-hubs/event-hubs-for-kafka-ecosystem-overview) using the Kafka protocol providing an alternative to managing large Kafka clusters.</span></span> <span data-ttu-id="4a93f-363">Wiele systemów typu open source natywnych dla chmury obejmuje platformę Kafka.</span><span class="sxs-lookup"><span data-stu-id="4a93f-363">Many open-source cloud-native systems embrace Kafka.</span></span>

<span data-ttu-id="4a93f-364">Usługa Event Hubs implementuje przesyłanie strumieniowe wiadomości za pośrednictwem [modelu konsumenta na partycje,](https://docs.microsoft.com/azure/event-hubs/event-hubs-features) w którym każdy konsument odczytuje tylko określony podzbiór lub partycję strumienia komunikatów.</span><span class="sxs-lookup"><span data-stu-id="4a93f-364">Event Hubs implements message streaming through a [partitioned consumer model](https://docs.microsoft.com/azure/event-hubs/event-hubs-features) in which each consumer only reads a specific subset, or partition, of the message stream.</span></span> <span data-ttu-id="4a93f-365">Ten wzorzec umożliwia ogromną skalę poziomą do przetwarzania zdarzeń i zapewnia inne funkcje skoncentrowane na strumieniu, które są niedostępne w kolejkach i tematach.</span><span class="sxs-lookup"><span data-stu-id="4a93f-365">This pattern enables tremendous horizontal scale for event processing and provides other stream-focused features that are unavailable in queues and topics.</span></span> <span data-ttu-id="4a93f-366">Partycja to uporządkowana sekwencja zdarzeń przechowywana w centrum zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="4a93f-366">A partition is an ordered sequence of events that is held in an event hub.</span></span> <span data-ttu-id="4a93f-367">W miarę pojawiania się nowszych zdarzeń są one dodawane na końcu tej sekwencji.</span><span class="sxs-lookup"><span data-stu-id="4a93f-367">As newer events arrive, they're added to the end of this sequence.</span></span><span data-ttu-id="4a93f-368">Rysunek 4-19 przedstawia partycjonowanie w Centrum zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="4a93f-368"> Figure 4-19 shows partitioning in an Event Hub.</span></span>

![Partycjonowanie Centrum zdarzeń](./media/event-hub-partitioning.png)

<span data-ttu-id="4a93f-370">**Rysunek 4-19**.</span><span class="sxs-lookup"><span data-stu-id="4a93f-370">**Figure 4-19**.</span></span> <span data-ttu-id="4a93f-371">Partycjonowanie Centrum zdarzeń</span><span class="sxs-lookup"><span data-stu-id="4a93f-371">Event Hub partitioning</span></span>

<span data-ttu-id="4a93f-372">Zamiast odczytywania z tego samego zasobu, każda grupa odbiorców odczytuje w podzbiorze lub partycji strumienia komunikatów.</span><span class="sxs-lookup"><span data-stu-id="4a93f-372">Instead of reading from the same resource, each consumer group reads across a subset, or partition, of the message stream.</span></span>

<span data-ttu-id="4a93f-373">W przypadku aplikacji natywnych dla chmury, które muszą przesyłać strumieniowo dużą liczbę zdarzeń, usługa Azure Event Hub może być niezawodnym i przystępnym cenowo rozwiązaniem.</span><span class="sxs-lookup"><span data-stu-id="4a93f-373">For cloud-native applications that must stream large numbers of events, Azure Event Hub can be a robust and affordable solution.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="4a93f-374">[Poprzedni](front-end-communication.md)
>[następny](grpc.md)</span><span class="sxs-lookup"><span data-stu-id="4a93f-374">[Previous](front-end-communication.md)
[Next](grpc.md)</span></span>
