---
title: Komunikacja między usługami
description: Dowiedz się, jak mikrousługi zaplecza w chmurze komunikują się z innymi mikrousługami zaplecza.
author: robvet
ms.date: 09/09/2019
ms.openlocfilehash: 0917ae8bf38b117619cec63411ea8f4f084ae6f2
ms.sourcegitcommit: 628e8147ca10187488e6407dab4c4e6ebe0cac47
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/15/2019
ms.locfileid: "72315865"
---
# <a name="service-to-service-communication"></a><span data-ttu-id="ec704-103">Komunikacja między usługami</span><span class="sxs-lookup"><span data-stu-id="ec704-103">Service-to-service communication</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="ec704-104">Po przeniesieniu się z klienta frontonu firma Microsoft komunikuje się ze sobą.</span><span class="sxs-lookup"><span data-stu-id="ec704-104">Moving from the front-end client, we now address back-end microservices communicate with each other.</span></span>

<span data-ttu-id="ec704-105">Podczas konstruowania aplikacji natywnej w chmurze warto mieć szczególną ostrożność, jak usługi zaplecza komunikują się ze sobą.</span><span class="sxs-lookup"><span data-stu-id="ec704-105">When constructing a cloud-native application, you'll want to be sensitive to how back-end services communicate with each other.</span></span> <span data-ttu-id="ec704-106">W idealnym przypadku mniejsza komunikacja między usługami jest lepsza.</span><span class="sxs-lookup"><span data-stu-id="ec704-106">Ideally, the less inter-service communication, the better.</span></span> <span data-ttu-id="ec704-107">Jednak unikanie nie zawsze jest możliwe, ponieważ usługi zaplecza często korzystają ze sobą, aby ukończyć operację.</span><span class="sxs-lookup"><span data-stu-id="ec704-107">However, avoidance isn't always possible as back-end services often rely on one another to complete an operation.</span></span>

<span data-ttu-id="ec704-108">Istnieje kilka powszechnie zaakceptowanych podejścia do implementowania komunikacji między usługami.</span><span class="sxs-lookup"><span data-stu-id="ec704-108">There are several widely accepted approaches to implementing cross-service communication.</span></span> <span data-ttu-id="ec704-109">*Typ interakcji komunikacji* często decyduje o najlepszym podejściu.</span><span class="sxs-lookup"><span data-stu-id="ec704-109">The *type of communication interaction* will often determine the best approach.</span></span>

<span data-ttu-id="ec704-110">Należy wziąć pod uwagę następujące typy interakcji:</span><span class="sxs-lookup"><span data-stu-id="ec704-110">Consider the following interaction types:</span></span>

- <span data-ttu-id="ec704-111">*Query* — gdy wywołująca mikrousługa wymaga odpowiedzi z wywołanej mikrousługi, np. "Hej, podaj informacje o kupującym dla danego identyfikatora klienta".</span><span class="sxs-lookup"><span data-stu-id="ec704-111">*Query* – when a calling microservice requires a response from a called microservice, such as, "Hey, give me the buyer information for a given customer Id."</span></span>

- <span data-ttu-id="ec704-112">*Polecenie* — gdy wywołująca mikrousługa potrzebuje innej mikrousługi do wykonania akcji, ale nie wymaga odpowiedzi, takiej jak "Hej, po prostu Wyślij tę kolejność".</span><span class="sxs-lookup"><span data-stu-id="ec704-112">*Command* – when the calling microservice needs another microservice to execute an action but doesn't require a response, such as, "Hey, just ship this order."</span></span>

- <span data-ttu-id="ec704-113">*Event* — gdy mikrousługa, nazywana wydawcą, wywołuje zdarzenie, że stan zmienił się lub wystąpił akcja.</span><span class="sxs-lookup"><span data-stu-id="ec704-113">*Event* – when a microservice, called the publisher, raises an event that state has changed or an action has occurred.</span></span> <span data-ttu-id="ec704-114">Inne mikrousługi, nazywane abonentami, które interesują się, mogą odpowiednio reagować na zdarzenie.</span><span class="sxs-lookup"><span data-stu-id="ec704-114">Other microservices, called subscribers, who are interested, can react to the event appropriately.</span></span> <span data-ttu-id="ec704-115">Wydawca i Subskrybenci nie są od siebie nawzajem świadomi.</span><span class="sxs-lookup"><span data-stu-id="ec704-115">The publisher and the subscribers aren't aware of each other.</span></span>

<span data-ttu-id="ec704-116">Systemy mikrousług zazwyczaj używają kombinacji tych typów interakcji podczas wykonywania operacji wymagających interakcji między usługami.</span><span class="sxs-lookup"><span data-stu-id="ec704-116">Microservice systems typically use a combination of these interaction types when executing operations that require cross-service interaction.</span></span> <span data-ttu-id="ec704-117">Przyjrzyjmy się, jak można je wdrożyć.</span><span class="sxs-lookup"><span data-stu-id="ec704-117">Let's take a close look at each and how you might implement them.</span></span>

## <a name="queries"></a><span data-ttu-id="ec704-118">Kwerendy</span><span class="sxs-lookup"><span data-stu-id="ec704-118">Queries</span></span>

<span data-ttu-id="ec704-119">Wiele mikrousług może wymagać wykonania *zapytania* do innej, co wymaga natychmiastowej reakcji na ukończenie operacji.</span><span class="sxs-lookup"><span data-stu-id="ec704-119">Many times, one microservice might need to *query* another, requiring an immediate response to complete an operation.</span></span> <span data-ttu-id="ec704-120">Mikrousługa koszyka zakupów może potrzebować informacji o produkcie i ceny, aby dodać element do jego koszyka.</span><span class="sxs-lookup"><span data-stu-id="ec704-120">A shopping basket microservice may need product information and a price to add an item to its basket.</span></span> <span data-ttu-id="ec704-121">Istnieje kilka podejścia do implementowania operacji zapytań.</span><span class="sxs-lookup"><span data-stu-id="ec704-121">There are a number of approaches for implementing query operations.</span></span>

### <a name="requestresponse-messaging"></a><span data-ttu-id="ec704-122">Komunikaty żądania/odpowiedzi</span><span class="sxs-lookup"><span data-stu-id="ec704-122">Request/Response Messaging</span></span>

<span data-ttu-id="ec704-123">Jedną z opcji implementowania tego scenariusza jest wywoływanie mikrousług zaplecza w celu skierowania żądań HTTP do mikrousług potrzebnych do wykonywania zapytań, jak pokazano na rysunku 4-8.</span><span class="sxs-lookup"><span data-stu-id="ec704-123">One option for implementing this scenario is for the calling back-end microservice to make direct HTTP requests to the microservices it needs to query, shown in Figure 4-8.</span></span>

![Bezpośrednia komunikacja HTTP](./media/direct-http-communication.png)

<span data-ttu-id="ec704-125">**Rysunek 4-8**.</span><span class="sxs-lookup"><span data-stu-id="ec704-125">**Figure 4-8**.</span></span> <span data-ttu-id="ec704-126">Bezpośrednia komunikacja HTTP</span><span class="sxs-lookup"><span data-stu-id="ec704-126">Direct HTTP communication</span></span>

<span data-ttu-id="ec704-127">Mimo że bezpośrednie wywołania protokołu HTTP między mikrousługami są stosunkowo proste do wdrożenia, należy wziąć pod uwagę, aby zminimalizować to rozwiązanie.</span><span class="sxs-lookup"><span data-stu-id="ec704-127">While direct HTTP calls between microservices are relatively simple to implement, care should be taken to minimize this practice.</span></span> <span data-ttu-id="ec704-128">Aby rozpocząć, te wywołania są zawsze *synchroniczne* i blokują operację do momentu zwrócenia wyniku lub przekroczenia limitu czasu żądania.</span><span class="sxs-lookup"><span data-stu-id="ec704-128">To start, these calls are always *synchronous* and will block the operation until a result is returned or the request times outs.</span></span> <span data-ttu-id="ec704-129">Co się stało z samodzielnymi, niezależnymi usługami, które można rozdzielić niezależnie i wdrażać, są teraz połączone ze sobą.</span><span class="sxs-lookup"><span data-stu-id="ec704-129">What were once self-contained, independent services, able to evolve independently and deploy frequently, now become coupled to each other.</span></span> <span data-ttu-id="ec704-130">W miarę zwiększania się sprzężenia między mikrousługami ich zalety architektury zmniejszają się.</span><span class="sxs-lookup"><span data-stu-id="ec704-130">As coupling among microservices increase, their architectural benefits diminish.</span></span>

<span data-ttu-id="ec704-131">Wykonywanie sporadycznego żądania, które powoduje, że jedno bezpośrednie wywołanie protokołu HTTP do innej mikrousługi może być akceptowalne dla niektórych systemów.</span><span class="sxs-lookup"><span data-stu-id="ec704-131">Executing an infrequent request that makes a single direct HTTP call to another microservice might be acceptable for some systems.</span></span> <span data-ttu-id="ec704-132">Jednak wywołania dużej ilości, które wywołują bezpośrednie wywołania protokołu HTTP do wielu mikrousług, nie są zalecane.</span><span class="sxs-lookup"><span data-stu-id="ec704-132">However, high-volume calls that invoke direct HTTP calls to multiple microservices aren't advisable.</span></span> <span data-ttu-id="ec704-133">Mogą zwiększyć opóźnienia i mieć negatywny wpływ na wydajność, skalowalność i dostępność systemu.</span><span class="sxs-lookup"><span data-stu-id="ec704-133">They can increase latency and negatively impact the performance, scalability, and availability of your system.</span></span> <span data-ttu-id="ec704-134">Nawet gorsza, długa seria bezpośredniej komunikacji HTTP może prowadzić do głębokiego i złożonego łańcucha synchronicznych wywołań mikrousług, jak pokazano na rysunku 4-9:</span><span class="sxs-lookup"><span data-stu-id="ec704-134">Even worse, a long series of direct HTTP communication can lead to deep and complex chains of synchronous microservices calls, shown in Figure 4-9:</span></span>

![Łączenie kwerend HTTP](./media/chaining-http-queries.png)

<span data-ttu-id="ec704-136">**Rysunek 4-9**.</span><span class="sxs-lookup"><span data-stu-id="ec704-136">**Figure 4-9**.</span></span> <span data-ttu-id="ec704-137">Łączenie kwerend HTTP</span><span class="sxs-lookup"><span data-stu-id="ec704-137">Chaining HTTP queries</span></span>

<span data-ttu-id="ec704-138">Można wyobrazić ryzyko związane z projektem pokazanym na powyższym obrazie.</span><span class="sxs-lookup"><span data-stu-id="ec704-138">You can certainly imagine the risk in the design shown in the previous image.</span></span> <span data-ttu-id="ec704-139">Co się stanie w przypadku niepowodzenia kroku \#3?</span><span class="sxs-lookup"><span data-stu-id="ec704-139">What happens if Step \#3 fails?</span></span> <span data-ttu-id="ec704-140">Lub krok \#8 kończy się niepowodzeniem?</span><span class="sxs-lookup"><span data-stu-id="ec704-140">Or Step \#8 fails?</span></span> <span data-ttu-id="ec704-141">Jak odzyskać?</span><span class="sxs-lookup"><span data-stu-id="ec704-141">How do you recover?</span></span> <span data-ttu-id="ec704-142">Co zrobić, jeśli krok \#6 jest wolny, ponieważ podstawowa usługa jest zajęta?</span><span class="sxs-lookup"><span data-stu-id="ec704-142">What if Step \#6 is slow because the underlying service is busy?</span></span> <span data-ttu-id="ec704-143">Jak kontynuować?</span><span class="sxs-lookup"><span data-stu-id="ec704-143">How do you continue?</span></span> <span data-ttu-id="ec704-144">Nawet jeśli wszystkie działania działają prawidłowo, należy wziąć pod uwagę opóźnienie tego wywołania, czyli sumę opóźnienia każdego kroku.</span><span class="sxs-lookup"><span data-stu-id="ec704-144">Even if all works correctly, think of the latency this call would incur, which is the sum of the latency of each step.</span></span>

<span data-ttu-id="ec704-145">Duży stopień sprzęgania w poprzednim obrazie sugeruje, że usługi nie były optymalnie modelowane.</span><span class="sxs-lookup"><span data-stu-id="ec704-145">The large degree of coupling in the previous image suggests the services weren't optimally modeled.</span></span> <span data-ttu-id="ec704-146">Behoove zespół do ponownego odwiedzania projektu.</span><span class="sxs-lookup"><span data-stu-id="ec704-146">It would behoove the team to revisit their design.</span></span>

### <a name="materialized-view-pattern"></a><span data-ttu-id="ec704-147">Wzorzec widoku materiałowego</span><span class="sxs-lookup"><span data-stu-id="ec704-147">Materialized View pattern</span></span>

<span data-ttu-id="ec704-148">Popularną opcją usunięcia sprzęgu mikrousług jest [wzorzec widoku materiału](https://docs.microsoft.com/azure/architecture/patterns/materialized-view).</span><span class="sxs-lookup"><span data-stu-id="ec704-148">A popular option for removing microservice coupling is the [Materialized View pattern](https://docs.microsoft.com/azure/architecture/patterns/materialized-view).</span></span> <span data-ttu-id="ec704-149">W tym wzorcu mikrousługa przechowuje własną, nieznormalizowaną kopię danych, która jest własnością innych usług.</span><span class="sxs-lookup"><span data-stu-id="ec704-149">With this pattern, a microservice stores its own local, denormalized copy of data that's owned by other services.</span></span> <span data-ttu-id="ec704-150">W przypadku mikrousług w koszyku zakupów i mikrousług do obsługi cennika usługa ta utrzymuje własną lokalną kopię tych danych.</span><span class="sxs-lookup"><span data-stu-id="ec704-150">Instead of the Shopping Basket microservice querying the Product Catalog and Pricing microservices, it maintains its own local copy of that data.</span></span> <span data-ttu-id="ec704-151">Ten wzorzec eliminuje zbędny sprzężenie i zwiększa niezawodność i czas odpowiedzi.</span><span class="sxs-lookup"><span data-stu-id="ec704-151">This pattern eliminates unnecessary coupling and improves reliability and response time.</span></span> <span data-ttu-id="ec704-152">Cała operacja jest wykonywana w ramach jednego procesu.</span><span class="sxs-lookup"><span data-stu-id="ec704-152">The entire operation executes inside a single process.</span></span> <span data-ttu-id="ec704-153">Omawiamy ten wzorzec i inne zagadnienia dotyczące danych w rozdziale 5.</span><span class="sxs-lookup"><span data-stu-id="ec704-153">We explore this pattern and other data concerns in Chapter 5.</span></span>

### <a name="service-aggregator-pattern"></a><span data-ttu-id="ec704-154">Wzorzec agregatora usług</span><span class="sxs-lookup"><span data-stu-id="ec704-154">Service Aggregator Pattern</span></span>

<span data-ttu-id="ec704-155">Kolejną opcją wyeliminowania mikrousług na mikrousługach jest mikrousługa [agregatora](https://devblogs.microsoft.com/cesardelatorre/designing-and-implementing-api-gateways-with-ocelot-in-a-microservices-and-container-based-architecture/), pokazana w kolorze purpurowym na rysunku 4-10.</span><span class="sxs-lookup"><span data-stu-id="ec704-155">Another option for eliminating microservice-to-microservice coupling is an [Aggregator microservice](https://devblogs.microsoft.com/cesardelatorre/designing-and-implementing-api-gateways-with-ocelot-in-a-microservices-and-container-based-architecture/), shown in purple in Figure 4-10.</span></span> 

![Usługa agregatora](./media/aggregator-service.png)

<span data-ttu-id="ec704-157">**Rysunek 4-10**.</span><span class="sxs-lookup"><span data-stu-id="ec704-157">**Figure 4-10**.</span></span> <span data-ttu-id="ec704-158">Mikrousługa agregatora</span><span class="sxs-lookup"><span data-stu-id="ec704-158">Aggregator microservice</span></span>

<span data-ttu-id="ec704-159">Wzorzec izoluje operację, która polega na wywołaniach do wielu mikrousług zaplecza, co pozwala na scentralizowanie jej logiki do wyspecjalizowanej mikrousługi.</span><span class="sxs-lookup"><span data-stu-id="ec704-159">The pattern isolates an operation that makes calls to multiple back-end microservices, centralizing its logic into a specialized microservice.</span></span>  <span data-ttu-id="ec704-160">Fioletowa funkcja agregatora wyewidencjonowania na poprzedniej ilustracji organizuje przepływ pracy dla operacji wyewidencjonowania.</span><span class="sxs-lookup"><span data-stu-id="ec704-160">The purple checkout aggregator microservice in the previous figure orchestrates the workflow for the Checkout operation.</span></span> <span data-ttu-id="ec704-161">Obejmuje to wywołania kilku mikrousług zaplecza w kolejności sekwencyjnej.</span><span class="sxs-lookup"><span data-stu-id="ec704-161">It includes calls to several back-end microservices in a sequenced order.</span></span> <span data-ttu-id="ec704-162">Dane z przepływu pracy są agregowane i zwracane do obiektu wywołującego.</span><span class="sxs-lookup"><span data-stu-id="ec704-162">Data from the workflow is aggregated and returned to the caller.</span></span> <span data-ttu-id="ec704-163">Mimo że nadal implementuje bezpośrednie wywołania protokołu HTTP, mikrousługa agregatora zmniejsza bezpośrednie zależności między mikrousługami zaplecza.</span><span class="sxs-lookup"><span data-stu-id="ec704-163">While it still implements direct HTTP calls, the aggregator microservice reduces direct dependencies among back-end microservices.</span></span> 

### <a name="requestreply-pattern"></a><span data-ttu-id="ec704-164">Wzorzec żądania/odpowiedzi</span><span class="sxs-lookup"><span data-stu-id="ec704-164">Request/Reply Pattern</span></span>

<span data-ttu-id="ec704-165">Innym podejściem do oddzielania synchronicznych komunikatów HTTP jest [wzorzec żądanie-odpowiedź](https://www.enterpriseintegrationpatterns.com/patterns/messaging/RequestReply.html), który używa komunikacji kolejkowania.</span><span class="sxs-lookup"><span data-stu-id="ec704-165">Another approach for decoupling synchronous HTTP messages is a [Request-Reply Pattern](https://www.enterpriseintegrationpatterns.com/patterns/messaging/RequestReply.html), which uses queuing communication.</span></span> <span data-ttu-id="ec704-166">Komunikacja przy użyciu kolejki jest zawsze jednokierunkowym kanałem, przez co producent wysyła wiadomość i odbiorcę.</span><span class="sxs-lookup"><span data-stu-id="ec704-166">Communication using a queue is always a one-way channel, with a producer sending the message and consumer receiving it.</span></span> <span data-ttu-id="ec704-167">W tym wzorcu są zaimplementowane kolejki żądań i kolejki odpowiedzi, pokazane na rysunku 4-11.</span><span class="sxs-lookup"><span data-stu-id="ec704-167">With this pattern, both a request queue and response queue are implemented, shown in Figure 4-11.</span></span>

![Wzorzec żądanie-odpowiedź](./media/request-reply-pattern.png)

<span data-ttu-id="ec704-169">**Rysunek 4-11**.</span><span class="sxs-lookup"><span data-stu-id="ec704-169">**Figure 4-11**.</span></span> <span data-ttu-id="ec704-170">Wzorzec żądanie-odpowiedź</span><span class="sxs-lookup"><span data-stu-id="ec704-170">Request-reply pattern</span></span>

<span data-ttu-id="ec704-171">W tym miejscu producent komunikatu tworzy komunikat oparty na zapytaniach zawierający unikatowy identyfikator korelacji i umieszcza go w kolejce żądań.</span><span class="sxs-lookup"><span data-stu-id="ec704-171">Here, the message producer creates a query-based message that contains a unique correlation ID and places it into a request queue.</span></span> <span data-ttu-id="ec704-172">Usługa korzystająca z kolejkowania komunikatów, przetwarza je i umieszcza w kolejce odpowiedzi ten sam identyfikator korelacji.</span><span class="sxs-lookup"><span data-stu-id="ec704-172">The consuming service dequeues the messages, processes it and places the response into the response queue with the same correlation ID.</span></span> <span data-ttu-id="ec704-173">Usługa producenta usuwa komunikat, dopasowuje go wraz z IDENTYFIKATORem korelacji i kontynuuje przetwarzanie.</span><span class="sxs-lookup"><span data-stu-id="ec704-173">The producer service dequeues the message, matches it with the correlation ID and continues processing.</span></span> <span data-ttu-id="ec704-174">W następnej sekcji omówiono kolejki szczegółowo.</span><span class="sxs-lookup"><span data-stu-id="ec704-174">We cover queues in detail in the next section.</span></span>

## <a name="commands"></a><span data-ttu-id="ec704-175">Polecenia</span><span class="sxs-lookup"><span data-stu-id="ec704-175">Commands</span></span>

<span data-ttu-id="ec704-176">Innym typem interakcji komunikacji jest *polecenie*.</span><span class="sxs-lookup"><span data-stu-id="ec704-176">Another type of communication interaction is a *command*.</span></span> <span data-ttu-id="ec704-177">Mikrousługa może potrzebować innej mikrousługi do wykonania akcji.</span><span class="sxs-lookup"><span data-stu-id="ec704-177">A microservice may need another microservice to perform an action.</span></span> <span data-ttu-id="ec704-178">Mikrousługa porządkowania może potrzebować mikrousługi wysyłkowej w celu utworzenia wysyłki dla zatwierdzonej kolejności.</span><span class="sxs-lookup"><span data-stu-id="ec704-178">The Ordering microservice may need the Shipping microservice to create a shipment for an approved order.</span></span> <span data-ttu-id="ec704-179">Na rysunku 4-12 jedna mikrousługa, nazywana producentem, wysyła komunikat do innej mikrousługi, a konsument, polecenia, aby wykonać coś.</span><span class="sxs-lookup"><span data-stu-id="ec704-179">In Figure 4-12, one microservice, called a Producer, sends a message to another microservice, the Consumer, commanding it to do something.</span></span> 

![Interakcja z poleceniem z kolejką](./media/command-interaction-with-queue.png)

<span data-ttu-id="ec704-181">**Rysunek 4-12**.</span><span class="sxs-lookup"><span data-stu-id="ec704-181">**Figure 4-12**.</span></span> <span data-ttu-id="ec704-182">Interakcja z poleceniem z kolejką</span><span class="sxs-lookup"><span data-stu-id="ec704-182">Command interaction with a queue</span></span>

<span data-ttu-id="ec704-183">Najczęściej producenci nie wymagają odpowiedzi i mogą ją *uruchamiać i zapominać* .</span><span class="sxs-lookup"><span data-stu-id="ec704-183">Most often, the Producer doesn't require a response and can *fire-and-forget* the message.</span></span> <span data-ttu-id="ec704-184">Jeśli wymagana jest odpowiedź, odbiorca wysyła oddzielny komunikat z powrotem do producenta w innym kanale.</span><span class="sxs-lookup"><span data-stu-id="ec704-184">If a reply is needed, the Consumer sends a separate message back to Producer on another channel.</span></span> <span data-ttu-id="ec704-185">Komunikat polecenia jest najlepiej wysyłany asynchronicznie z kolejką komunikatów.</span><span class="sxs-lookup"><span data-stu-id="ec704-185">A command message is best sent asynchronously with a message queue.</span></span> <span data-ttu-id="ec704-186">obsługiwane przez uproszczony Broker komunikatów.</span><span class="sxs-lookup"><span data-stu-id="ec704-186">supported by a lightweight message broker.</span></span> <span data-ttu-id="ec704-187">Na poprzednim diagramie należy zwrócić uwagę, jak Kolejka oddzieli i oddziela obie usługi.</span><span class="sxs-lookup"><span data-stu-id="ec704-187">In the previous diagram, note how a queue separates and decouples both services.</span></span>

<span data-ttu-id="ec704-188">Kolejka komunikatów to pośrednik pośredniczący, za pomocą którego producent i odbiorca przekazują komunikat.</span><span class="sxs-lookup"><span data-stu-id="ec704-188">A message queue is an intermediary construct through which a producer and consumer pass a message.</span></span> <span data-ttu-id="ec704-189">Kolejki implementują wzorzec komunikatów typu punkt-punkt.</span><span class="sxs-lookup"><span data-stu-id="ec704-189">Queues implement an asynchronous, point-to-point messaging pattern.</span></span> <span data-ttu-id="ec704-190">Producent wie, gdzie należy odpowiednio wysłać polecenie i trasy.</span><span class="sxs-lookup"><span data-stu-id="ec704-190">The Producer knows where a command needs to be sent and routes appropriately.</span></span> <span data-ttu-id="ec704-191">Kolejka gwarantuje, że komunikat jest przetwarzany dokładnie jednym z wystąpień konsumenta odczytywanych z kanału.</span><span class="sxs-lookup"><span data-stu-id="ec704-191">The queue guarantees that a message is processed by exactly one of the consumer instances that are reading from the channel.</span></span> <span data-ttu-id="ec704-192">W tym scenariuszu Usługa producent lub konsument może skalować w poziomie bez wpływu na inne.</span><span class="sxs-lookup"><span data-stu-id="ec704-192">In this scenario, either the producer or consumer service can scale out without affecting the other.</span></span> <span data-ttu-id="ec704-193">Technologie te mogą być również różne po obu stronach, co oznacza, że firma Microsoft może korzystać z mikrousługi w języku Java wywołującej mikrousługę [golang](https://golang.org) .</span><span class="sxs-lookup"><span data-stu-id="ec704-193">As well, technologies can be disparate on each side, meaning that we might have a Java microservice calling a [Golang](https://golang.org) microservice.</span></span> 

<span data-ttu-id="ec704-194">W rozdziale 1 zostały omówione *usługi zapasowe*.</span><span class="sxs-lookup"><span data-stu-id="ec704-194">In chapter 1, we talked about *backing services*.</span></span> <span data-ttu-id="ec704-195">Usługi zapasowe są zasobami dodatkowymi, na których zależą systemy natywne w chmurze.</span><span class="sxs-lookup"><span data-stu-id="ec704-195">Backing services are ancillary resources upon which cloud-native systems depend.</span></span> <span data-ttu-id="ec704-196">Kolejki komunikatów to usługi zapasowe.</span><span class="sxs-lookup"><span data-stu-id="ec704-196">Message queues are backing services.</span></span> <span data-ttu-id="ec704-197">Chmura systemu Azure obsługuje dwa typy kolejek komunikatów, których systemy natywne w chmurze mogą wykorzystać do implementacji komunikatów poleceń: kolejki usługi Azure Storage i kolejki Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="ec704-197">The Azure cloud supports two types of message queues that your cloud-native systems can consume to implement command messaging: Azure Storage Queues and Azure Service Bus Queues.</span></span>

### <a name="azure-storage-queues"></a><span data-ttu-id="ec704-198">Kolejki usługi Azure Storage</span><span class="sxs-lookup"><span data-stu-id="ec704-198">Azure Storage Queues</span></span>

<span data-ttu-id="ec704-199">Kolejki usługi Azure Storage oferują prostą infrastrukturę obejmującą szybkie, niedrogie i obsługiwane przez konta usługi Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ec704-199">Azure storage queues offer a simple queueing infrastructure that is fast, affordable, and backed by Azure storage accounts.</span></span>

<span data-ttu-id="ec704-200">[Kolejki usługi Azure Storage](https://docs.microsoft.com/azure/storage/queues/storage-queues-introduction) to mechanizm kolejkowania oparty na protokole REST z niezawodnymi i trwałymi wiadomościami.</span><span class="sxs-lookup"><span data-stu-id="ec704-200">[Azure Storage Queues](https://docs.microsoft.com/azure/storage/queues/storage-queues-introduction) feature a REST-based queuing mechanism with reliable and persistent messaging.</span></span> <span data-ttu-id="ec704-201">Zapewniają one minimalny zestaw funkcji, ale są niedrogie i przechowują miliony komunikatów.</span><span class="sxs-lookup"><span data-stu-id="ec704-201">They provide a minimal feature set, but are inexpensive and store millions of messages.</span></span> <span data-ttu-id="ec704-202">Zakresy pojemności do 500 TB.</span><span class="sxs-lookup"><span data-stu-id="ec704-202">Their capacity ranges up to 500 TB.</span></span> <span data-ttu-id="ec704-203">Pojedynczy komunikat może mieć rozmiar do 64 KB.</span><span class="sxs-lookup"><span data-stu-id="ec704-203">A single message can be up to 64 KB in size.</span></span>

<span data-ttu-id="ec704-204">Możesz uzyskiwać dostęp do komunikatów z dowolnego miejsca na świecie za pośrednictwem uwierzytelnionych połączeń przy użyciu protokołu HTTP lub HTTPS.</span><span class="sxs-lookup"><span data-stu-id="ec704-204">You can access messages from anywhere in the world via authenticated calls using HTTP or HTTPS.</span></span> <span data-ttu-id="ec704-205">Kolejki magazynu można skalować w poziomie do dużej liczby współbieżnych klientów, aby obsługiwać skoki ruchu.</span><span class="sxs-lookup"><span data-stu-id="ec704-205">Storage queues can scale out to large numbers of concurrent clients to handle traffic spikes.</span></span>

<span data-ttu-id="ec704-206">Wspomniane istnieją pewne ograniczenia dotyczące usługi:</span><span class="sxs-lookup"><span data-stu-id="ec704-206">That said, there are limitations with the service:</span></span>

- <span data-ttu-id="ec704-207">Kolejność wiadomości nie jest gwarantowana.</span><span class="sxs-lookup"><span data-stu-id="ec704-207">Message order isn't guaranteed.</span></span>

- <span data-ttu-id="ec704-208">Komunikat może się utrzymywać tylko przez siedem dni, zanim zostanie automatycznie usunięty.</span><span class="sxs-lookup"><span data-stu-id="ec704-208">A message can only persist for seven days before it's automatically removed.</span></span>

- <span data-ttu-id="ec704-209">Obsługa zarządzania stanami, wykrywania duplikatów lub transakcji jest niedostępna.</span><span class="sxs-lookup"><span data-stu-id="ec704-209">Support for state management, duplicate detection, or transactions isn't available.</span></span>

<span data-ttu-id="ec704-210">Rysunek 4-13 przedstawia hierarchię kolejki usługi Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ec704-210">Figure 4-13 shows the hierarchy of an Azure Storage Queue.</span></span>

![Hierarchia kolejki magazynu](./media/storage-queue-hierarchy.png)

<span data-ttu-id="ec704-212">**Rysunek 4-13**.</span><span class="sxs-lookup"><span data-stu-id="ec704-212">**Figure 4-13**.</span></span> <span data-ttu-id="ec704-213">Hierarchia kolejki magazynu</span><span class="sxs-lookup"><span data-stu-id="ec704-213">Storage queue hierarchy</span></span>

<span data-ttu-id="ec704-214">Na poprzedniej ilustracji Zauważ, jak kolejki magazynu przechowują swoje wiadomości na podstawowym koncie usługi Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ec704-214">In the previous figure, note how storage queues store their messages in the underlying Azure Storage account.</span></span>

<span data-ttu-id="ec704-215">W przypadku deweloperów firma Microsoft udostępnia kilka bibliotek po stronie klienta i serwera na potrzeby przetwarzania kolejki magazynu.</span><span class="sxs-lookup"><span data-stu-id="ec704-215">For developers, Microsoft provides several client and server-side libraries for Storage queue processing.</span></span> <span data-ttu-id="ec704-216">Obsługiwane są większość najważniejszych platform, w tym .NET, Java, JavaScript, Ruby, Python i go.</span><span class="sxs-lookup"><span data-stu-id="ec704-216">Most major platforms are supported including .NET, Java, JavaScript, Ruby, Python, and Go.</span></span> <span data-ttu-id="ec704-217">Deweloperzy nigdy nie muszą komunikować się bezpośrednio z tymi bibliotekami.</span><span class="sxs-lookup"><span data-stu-id="ec704-217">Developers should never communicate directly with these libraries.</span></span> <span data-ttu-id="ec704-218">Spowoduje to ścisłe przełączenie kodu mikrousług do usługa kolejki usługi Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="ec704-218">Doing so will tightly couple your microservice code to the Azure Storage Queue service.</span></span> <span data-ttu-id="ec704-219">Lepszym rozwiązaniem jest izolowanie szczegółów implementacji interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="ec704-219">It's a better practice to insulate the implementation details of the API.</span></span> <span data-ttu-id="ec704-220">Wprowadzenie do warstwy biokorekty lub pośredniego interfejsu API, który uwidacznia operacje ogólne i hermetyzuje konkretną bibliotekę.</span><span class="sxs-lookup"><span data-stu-id="ec704-220">Introduce an intermediation layer, or intermediate API, that exposes generic operations and encapsulates the concrete library.</span></span> <span data-ttu-id="ec704-221">Ten luźny sprzężenie umożliwia zamianę jednej usługi kolejkowania na inną bez konieczności wprowadzania zmian w kodzie usługi linii głównej.</span><span class="sxs-lookup"><span data-stu-id="ec704-221">This loose coupling enables you to swap out one queuing service for another without having to make changes to the mainline service code.</span></span> 

<span data-ttu-id="ec704-222">Kolejki usługi Azure Storage to ekonomiczne rozwiązanie do implementowania komunikatów poleceń w aplikacjach natywnych w chmurze.</span><span class="sxs-lookup"><span data-stu-id="ec704-222">Azure Storage queues are an economical option to implement command messaging in your cloud-native applications.</span></span> <span data-ttu-id="ec704-223">Szczególnie w przypadku, gdy rozmiar kolejki przekroczy 80 GB lub jest akceptowalny prosty zestaw funkcji.</span><span class="sxs-lookup"><span data-stu-id="ec704-223">Especially when a queue size will exceed 80 GB, or a simple feature set is acceptable.</span></span> <span data-ttu-id="ec704-224">Płacisz tylko za magazyn komunikatów; nie są naliczane żadne opłaty godzinowe.</span><span class="sxs-lookup"><span data-stu-id="ec704-224">You only pay for the storage of the messages; there are no fixed hourly charges.</span></span>

### <a name="azure-service-bus-queues"></a><span data-ttu-id="ec704-225">Kolejki Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="ec704-225">Azure Service Bus Queues</span></span>

<span data-ttu-id="ec704-226">Aby uzyskać bardziej złożone wymagania dotyczące komunikatów, należy wziąć pod uwagę Azure Service Bus kolejki.</span><span class="sxs-lookup"><span data-stu-id="ec704-226">For more complex messaging requirements, consider Azure Service Bus queues.</span></span>

<span data-ttu-id="ec704-227">Zakorzystającego się z niezawodną infrastrukturą komunikatów, [Azure Service Bus](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-messaging-overview) obsługuje *model komunikatów obsługiwanych przez brokera*.</span><span class="sxs-lookup"><span data-stu-id="ec704-227">Sitting atop a robust message infrastructure, [Azure Service Bus](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-messaging-overview) supports a *brokered messaging model*.</span></span> <span data-ttu-id="ec704-228">Komunikaty są niezawodnie przechowywane w brokerze (kolejce) do momentu odebrania przez konsumenta.</span><span class="sxs-lookup"><span data-stu-id="ec704-228">Messages are reliably stored in a broker (the queue) until received by the consumer.</span></span> <span data-ttu-id="ec704-229">Kolejka gwarantuje dostarczanie komunikatów First-In/First-Out (FIFO), z uwzględnieniem kolejności, w jakiej komunikaty zostały dodane do kolejki.</span><span class="sxs-lookup"><span data-stu-id="ec704-229">The queue guarantees First-In/First-Out (FIFO) message delivery, respecting the order in which messages were added to the queue.</span></span>

<span data-ttu-id="ec704-230">Rozmiar wiadomości może być znacznie większy, do 256 KB.</span><span class="sxs-lookup"><span data-stu-id="ec704-230">The size of a message can be much larger, up to 256 KB.</span></span> <span data-ttu-id="ec704-231">Komunikaty są utrwalane w kolejce przez nieograniczony okres.</span><span class="sxs-lookup"><span data-stu-id="ec704-231">Messages are persisted in the queue for an unlimited period of time.</span></span> <span data-ttu-id="ec704-232">Service Bus obsługuje nie tylko wywołania oparte na protokole HTTP, ale również zapewnia pełną obsługę [protokołu AMPQ](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-amqp-overview).</span><span class="sxs-lookup"><span data-stu-id="ec704-232">Service Bus supports not only HTTP-based calls, but also provides full support for the [AMPQ protocol](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-amqp-overview).</span></span> <span data-ttu-id="ec704-233">AMPQ to wersja typu Open-Standard dla wielu dostawców, która obsługuje protokół binarny i wyższy poziom niezawodności.</span><span class="sxs-lookup"><span data-stu-id="ec704-233">AMPQ is an open-standard across vendors that supports a binary protocol and higher degrees of reliability.</span></span>

<span data-ttu-id="ec704-234">Service Bus oferuje bogaty zestaw funkcji, w tym [obsługę transakcji](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-transactions) i [funkcję wykrywania duplikatów](https://docs.microsoft.com/azure/service-bus-messaging/duplicate-detection).</span><span class="sxs-lookup"><span data-stu-id="ec704-234">Service Bus provides a rich set of features, including [transaction support](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-transactions) and a [duplicate detection feature](https://docs.microsoft.com/azure/service-bus-messaging/duplicate-detection).</span></span> <span data-ttu-id="ec704-235">Kolejka "co najwyżej raz zagwarantuje" w przypadku wiadomości.</span><span class="sxs-lookup"><span data-stu-id="ec704-235">The queue guarantees "at most once delivery" per message.</span></span> <span data-ttu-id="ec704-236">Automatycznie odrzuca już wysłany komunikat.</span><span class="sxs-lookup"><span data-stu-id="ec704-236">It automatically discards a message that has already been sent.</span></span> <span data-ttu-id="ec704-237">Jeśli producent jest w stanie wątpliwości, może ponownie wysłać ten sam komunikat, a Service Bus gwarantuje, że tylko jedna kopia zostanie przetworzona.</span><span class="sxs-lookup"><span data-stu-id="ec704-237">If a producer is in doubt, it can resend the same message, and Service Bus guarantees that only one copy will be processed.</span></span> <span data-ttu-id="ec704-238">Wykrywanie duplikatów zwalnia użytkownika z konieczności tworzenia dodatkowej infrastruktury instalacji.</span><span class="sxs-lookup"><span data-stu-id="ec704-238">Duplicate detection frees you from  having to build additional infrastructure plumbing.</span></span>

<span data-ttu-id="ec704-239">Dwie więcej funkcji przedsiębiorstwa to partycjonowanie i sesje.</span><span class="sxs-lookup"><span data-stu-id="ec704-239">Two more enterprise features are partitioning and sessions.</span></span> <span data-ttu-id="ec704-240">Kolejka konwencjonalnych Service Bus jest obsługiwana przez jednego brokera komunikatów i przechowywana w jednym magazynie komunikatów.</span><span class="sxs-lookup"><span data-stu-id="ec704-240">A conventional Service Bus queue is handled by a single message broker and stored in a single message store.</span></span> <span data-ttu-id="ec704-241">Jednak [Service Bus partycjonowanie](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-partitioning) rozkłada kolejkę na wiele brokerów komunikatów i magazynów komunikatów.</span><span class="sxs-lookup"><span data-stu-id="ec704-241">But, [Service Bus Partitioning](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-partitioning) spreads the queue across multiple message brokers and message stores.</span></span> <span data-ttu-id="ec704-242">Ogólna przepływność nie jest już ograniczona przez wydajność jednego brokera komunikatów lub magazynu komunikatów.</span><span class="sxs-lookup"><span data-stu-id="ec704-242">The overall throughput is no longer limited by the performance of a single message broker or messaging store.</span></span> <span data-ttu-id="ec704-243">Tymczasowa awaria magazynu komunikatów nie powoduje niedostępności kolejki partycjonowanej.</span><span class="sxs-lookup"><span data-stu-id="ec704-243">A temporary outage of a messaging store doesn't render a partitioned queue unavailable.</span></span>

<span data-ttu-id="ec704-244">[Sesje Service Bus](https://codingcanvas.com/azure-service-bus-sessions/) zapewniają sposób grupowania komunikatów związanych z grupą.</span><span class="sxs-lookup"><span data-stu-id="ec704-244">[Service Bus Sessions](https://codingcanvas.com/azure-service-bus-sessions/) provide a way to group-related messages.</span></span> <span data-ttu-id="ec704-245">Wyobraź sobie scenariusz przepływu pracy, w którym wiadomości muszą być przetwarzane razem, a operacja zakończona na końcu.</span><span class="sxs-lookup"><span data-stu-id="ec704-245">Imagine a workflow scenario where messages must be processed together and the operation completed at the end.</span></span> <span data-ttu-id="ec704-246">Aby skorzystać z zalet, należy jawnie włączyć sesje dla kolejki, a każdy powiązany komunikat musi zawierać ten sam identyfikator sesji.</span><span class="sxs-lookup"><span data-stu-id="ec704-246">To take advantage, sessions must be explicitly enabled for the queue and each related messaged must contain the same session ID.</span></span>

<span data-ttu-id="ec704-247">Istnieją jednak pewne istotne zastrzeżenia: rozmiar kolejek Service Bus jest ograniczony do 80 GB, co jest znacznie mniejsze niż dostępne w kolejkach magazynu.</span><span class="sxs-lookup"><span data-stu-id="ec704-247">However, there are some important caveats: Service Bus queues size is limited to 80 GB, which is much smaller than what's available from store queues.</span></span> <span data-ttu-id="ec704-248">Ponadto kolejki Service Bus powodują koszt podstawowy i opłaty za operację.</span><span class="sxs-lookup"><span data-stu-id="ec704-248">Additionally, Service Bus queues incur a base cost and charge per operation.</span></span>

<span data-ttu-id="ec704-249">Rysunek 4-14 przedstawia architekturę wysokiego poziomu kolejki Service Bus.</span><span class="sxs-lookup"><span data-stu-id="ec704-249">Figure 4-14 outlines the high-level architecture of a Service Bus queue.</span></span>

![Kolejka Service Bus](./media/service-bus-queue.png)

<span data-ttu-id="ec704-251">**Rysunek 4-14**.</span><span class="sxs-lookup"><span data-stu-id="ec704-251">**Figure 4-14**.</span></span> <span data-ttu-id="ec704-252">Kolejka Service Bus</span><span class="sxs-lookup"><span data-stu-id="ec704-252">Service Bus queue</span></span>

<span data-ttu-id="ec704-253">Na poprzedniej ilustracji należy zwrócić uwagę na relację punkt-punkt.</span><span class="sxs-lookup"><span data-stu-id="ec704-253">In the previous figure, note the point-to-point relationship.</span></span> <span data-ttu-id="ec704-254">Dwa wystąpienia tego samego dostawcy są umieszczenie komunikatów w jednej kolejce Service Bus.</span><span class="sxs-lookup"><span data-stu-id="ec704-254">Two instances of the same provider are enqueuing messages into a single Service Bus queue.</span></span> <span data-ttu-id="ec704-255">Każdy komunikat jest zużywany przez tylko jeden z trzech wystąpień konsumentów po prawej stronie.</span><span class="sxs-lookup"><span data-stu-id="ec704-255">Each message is consumed by only one of three consumer instances on the right.</span></span> <span data-ttu-id="ec704-256">Następnie omawiamy sposób implementacji komunikatów, w przypadku których różni konsumenci mogą korzystać z tego samego komunikatu.</span><span class="sxs-lookup"><span data-stu-id="ec704-256">Next, we discuss how to implement messaging where different consumers may all be interested the same message.</span></span>

## <a name="events"></a><span data-ttu-id="ec704-257">Zdarzenia</span><span class="sxs-lookup"><span data-stu-id="ec704-257">Events</span></span>

<span data-ttu-id="ec704-258">Usługa kolejkowania komunikatów jest efektywnym sposobem na wdrożenie komunikacji, w której producent może asynchronicznie wysyłać do niego wiadomość.</span><span class="sxs-lookup"><span data-stu-id="ec704-258">Message queuing is an effective way to implement communication where a producer can asynchronously send a consumer a message.</span></span> <span data-ttu-id="ec704-259">Jednak co się stanie, gdy *wielu różnych konsumentów* interesuje ten sam komunikat?</span><span class="sxs-lookup"><span data-stu-id="ec704-259">However, what happens when *many different consumers* are interested in the same message?</span></span> <span data-ttu-id="ec704-260">Dedykowana kolejka komunikatów dla każdego konsumenta nie będzie dobrze skalowana i utrudnia zarządzanie nimi.</span><span class="sxs-lookup"><span data-stu-id="ec704-260">A dedicated message queue for each consumer wouldn't scale well and would become difficult to manage.</span></span> 

<span data-ttu-id="ec704-261">Aby rozwiązać ten scenariusz, przejdziemy do innego typu interakcji z komunikatem, *zdarzenie*.</span><span class="sxs-lookup"><span data-stu-id="ec704-261">To address this scenario, we move to the third type of message interaction, the *event*.</span></span> <span data-ttu-id="ec704-262">Jedna mikrousług ogłasza, że wystąpiła akcja.</span><span class="sxs-lookup"><span data-stu-id="ec704-262">One microservice announces that an action had occurred.</span></span> <span data-ttu-id="ec704-263">Inne mikrousługi, jeśli są zainteresowane, reagują na działanie lub zdarzenie.</span><span class="sxs-lookup"><span data-stu-id="ec704-263">Other microservices, if interested, react to the action, or event.</span></span> 

<span data-ttu-id="ec704-264">Tworzenie zdarzeń jest procesem dwuetapowym.</span><span class="sxs-lookup"><span data-stu-id="ec704-264">Eventing is a two-step process.</span></span> <span data-ttu-id="ec704-265">Dla danej zmiany stanu mikrousługa publikuje zdarzenie w brokerze komunikatów, udostępniając go innym zainteresowanym mikrousługom.</span><span class="sxs-lookup"><span data-stu-id="ec704-265">For a given state change, a microservice publishes an event to a message broker, making it available to any other interested microservice.</span></span> <span data-ttu-id="ec704-266">Zainteresowana mikrousługa jest powiadamiana przez zasubskrybowanie zdarzenia w brokerze komunikatów.</span><span class="sxs-lookup"><span data-stu-id="ec704-266">The interested microservice is notified by subscribing to the event in the message broker.</span></span> <span data-ttu-id="ec704-267">Wzorzec [publikowania/subskrybowania](https://docs.microsoft.com/azure/architecture/patterns/publisher-subscriber) służy do implementowania [komunikacji opartej na zdarzeniach](https://docs.microsoft.com/dotnet/standard/microservices-architecture/multi-container-microservice-net-applications/integration-event-based-microservice-communications).</span><span class="sxs-lookup"><span data-stu-id="ec704-267">You use the [Publish/Subscribe](https://docs.microsoft.com/azure/architecture/patterns/publisher-subscriber) pattern to implement [event-based communication](https://docs.microsoft.com/dotnet/standard/microservices-architecture/multi-container-microservice-net-applications/integration-event-based-microservice-communications).</span></span>

<span data-ttu-id="ec704-268">Na rysunku 4-15 przedstawiono mikrousługi koszyka zakupów wydarzenie z dwoma innymi subskrybowanymi mikrousług.</span><span class="sxs-lookup"><span data-stu-id="ec704-268">Figure 4-15 shows a shopping basket microservice publishing an event with two other microservices subscribing to it.</span></span>

![Obsługa komunikatów opartych na zdarzeniach](./media/event-driven-messaging.png)

<span data-ttu-id="ec704-270">**Rysunek 4-15**.</span><span class="sxs-lookup"><span data-stu-id="ec704-270">**Figure 4-15**.</span></span> <span data-ttu-id="ec704-271">Obsługa komunikatów opartych na zdarzeniach</span><span class="sxs-lookup"><span data-stu-id="ec704-271">Event-Driven messaging</span></span>

<span data-ttu-id="ec704-272">Zanotuj składnik *magistrali zdarzeń* , który znajduje się w środku kanału komunikacyjnego.</span><span class="sxs-lookup"><span data-stu-id="ec704-272">Note the *event bus* component that sits in the middle of the communication channel.</span></span> <span data-ttu-id="ec704-273">Jest to Klasa niestandardowa, która hermetyzuje brokera komunikatów i oddziela ją od aplikacji źródłowej.</span><span class="sxs-lookup"><span data-stu-id="ec704-273">It's a custom class that encapsulates the message broker and decouples it from the underlying application.</span></span> <span data-ttu-id="ec704-274">Mikrousługi zamawiania i spisu niezależnie obsługują zdarzenia bez znajomości siebie ani do mikrousługi koszyka zakupów.</span><span class="sxs-lookup"><span data-stu-id="ec704-274">The ordering and inventory microservices independently operate the event with no knowledge of each other, nor the shopping basket microservice.</span></span> <span data-ttu-id="ec704-275">Po opublikowaniu zarejestrowanego zdarzenia w usłudze Event Bus działają one na nim.</span><span class="sxs-lookup"><span data-stu-id="ec704-275">When the registered event is published to the event bus, they act upon it.</span></span>

<span data-ttu-id="ec704-276">Dzięki zdarzeniom przechodźmy od technologii kolejkowania do *tematów*.</span><span class="sxs-lookup"><span data-stu-id="ec704-276">With eventing, we move from queuing technology to *topics*.</span></span> <span data-ttu-id="ec704-277">[Temat](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions) jest podobny do kolejki, ale obsługuje wzorzec obsługi komunikatów jeden-do-wielu.</span><span class="sxs-lookup"><span data-stu-id="ec704-277">A [topic](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions) is similar to a queue, but supports a one-to-many messaging pattern.</span></span> <span data-ttu-id="ec704-278">Jedna mikrousługa publikuje komunikat.</span><span class="sxs-lookup"><span data-stu-id="ec704-278">One microservice publishes a message.</span></span> <span data-ttu-id="ec704-279">Wiele zasubskrybowanych mikrousług może być w stanie otrzymywać i korzystać z tego komunikatu.</span><span class="sxs-lookup"><span data-stu-id="ec704-279">Multiple subscribing microservices can choose to receive and act upon that message.</span></span> <span data-ttu-id="ec704-280">Rysunek 4-16 przedstawia architekturę tematu.</span><span class="sxs-lookup"><span data-stu-id="ec704-280">Figure 4-16 shows a topic architecture.</span></span>

![Architektura tematu](./media/topic-architecture.png)

<span data-ttu-id="ec704-282">**Rysunek 4-16**.</span><span class="sxs-lookup"><span data-stu-id="ec704-282">**Figure 4-16**.</span></span> <span data-ttu-id="ec704-283">Architektura tematu</span><span class="sxs-lookup"><span data-stu-id="ec704-283">Topic architecture</span></span>

<span data-ttu-id="ec704-284">Na powyższym rysunku wydawcy wysyłają komunikaty do tematu.</span><span class="sxs-lookup"><span data-stu-id="ec704-284">In the previous figure, publishers send messages to the topic.</span></span> <span data-ttu-id="ec704-285">Na koniec Subskrybenci odbierają wiadomości z subskrypcji.</span><span class="sxs-lookup"><span data-stu-id="ec704-285">At the end, subscribers receive messages from subscriptions.</span></span> <span data-ttu-id="ec704-286">W środku tematu przekazuje komunikaty do subskrypcji na podstawie zestawu *reguł*, które są wyświetlane w ciemnych polach.</span><span class="sxs-lookup"><span data-stu-id="ec704-286">In the middle, the topic forwards messages to subscriptions based on a set of *rules*, shown in dark blue boxes.</span></span> <span data-ttu-id="ec704-287">Reguły działają jako filtr, który przekazuje dalej określone wiadomości do subskrypcji.</span><span class="sxs-lookup"><span data-stu-id="ec704-287">Rules act as a filter that forward specific messages to a subscription.</span></span> <span data-ttu-id="ec704-288">W tym miejscu zostanie wysłane zdarzenie "onOrder" do subskrypcji \#1 i subskrypcji \#3, ale nie do subskrypcji \#2.</span><span class="sxs-lookup"><span data-stu-id="ec704-288">Here, a "CreateOrder" event would be sent to Subscription \#1 and Subscription \#3, but not to Subscription \#2.</span></span> <span data-ttu-id="ec704-289">Zdarzenie "OrderCompleted" zostanie wysłane do subskrypcji \#2 i subskrypcji \#3.</span><span class="sxs-lookup"><span data-stu-id="ec704-289">An "OrderCompleted" event would be sent to Subscription \#2 and Subscription \#3.</span></span>

<span data-ttu-id="ec704-290">Chmura systemu Azure obsługuje dwie różne usługi tematu: Tematy Azure Service Bus i Azure EventGrid.</span><span class="sxs-lookup"><span data-stu-id="ec704-290">The Azure cloud supports two different topic services: Azure Service Bus Topics and Azure EventGrid.</span></span>

### <a name="azure-service-bus-topics"></a><span data-ttu-id="ec704-291">Tematy Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="ec704-291">Azure Service Bus Topics</span></span>

<span data-ttu-id="ec704-292">W oparciu o ten sam niezawodny model komunikatów obsługiwanych przez brokera Azure Service Bus kolejek są [Azure Service Bus tematy](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions).</span><span class="sxs-lookup"><span data-stu-id="ec704-292">Sitting on top of the same robust brokered message model of Azure Service Bus queues are [Azure Service Bus Topics](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-dotnet-how-to-use-topics-subscriptions).</span></span> <span data-ttu-id="ec704-293">Temat może odbierać komunikaty od wielu niezależnych wydawców i wysyłać komunikaty do 2 000 subskrybentów.</span><span class="sxs-lookup"><span data-stu-id="ec704-293">A topic can receive messages from multiple independent publishers and send messages to up to 2,000 subscribers.</span></span> <span data-ttu-id="ec704-294">Subskrypcje mogą być dynamicznie dodawane lub usuwane w czasie wykonywania bez zatrzymywania systemu ani ponownego tworzenia tematu.</span><span class="sxs-lookup"><span data-stu-id="ec704-294">Subscriptions can be dynamically added or removed at runtime without stopping the system or recreating the topic.</span></span>

<span data-ttu-id="ec704-295">Wiele zaawansowanych funkcji z kolejek Azure Service Busych są również dostępne dla tematów, takich jak [Wykrywanie duplikatów](https://docs.microsoft.com/azure/service-bus-messaging/duplicate-detection) i [Obsługa transakcji](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-transactions).</span><span class="sxs-lookup"><span data-stu-id="ec704-295">Many advanced features from Azure Service Bus queues are also available for topics, including [Duplicate Detection](https://docs.microsoft.com/azure/service-bus-messaging/duplicate-detection) and [Transaction support](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-transactions).</span></span> <span data-ttu-id="ec704-296">Domyślnie tematy Service Bus są obsługiwane przez jednego brokera komunikatów i przechowywane w jednym magazynie komunikatów.</span><span class="sxs-lookup"><span data-stu-id="ec704-296">By default, Service Bus topics are handled by a single message broker and stored in a single message store.</span></span> <span data-ttu-id="ec704-297">Ale [Service Bus partycjonowanie](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-partitioning) skaluje temat, rozkładając go na wielu brokerów komunikatów i magazynów komunikatów.</span><span class="sxs-lookup"><span data-stu-id="ec704-297">But, [Service Bus Partitioning](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-partitioning) scales a topic by spreading it across many message brokers and message stores.</span></span>

<span data-ttu-id="ec704-298">[Zaplanowana dostarczanie komunikatów](https://docs.microsoft.com/azure/service-bus-messaging/message-sequencing) oznacza komunikat z określonym czasem do przetwarzania.</span><span class="sxs-lookup"><span data-stu-id="ec704-298">[Scheduled Message Delivery](https://docs.microsoft.com/azure/service-bus-messaging/message-sequencing) tags a message with a specific time for processing.</span></span> <span data-ttu-id="ec704-299">Wiadomość nie zostanie wyświetlona w temacie przed upływem tego czasu.</span><span class="sxs-lookup"><span data-stu-id="ec704-299">The message won't appear in the topic before that time.</span></span> <span data-ttu-id="ec704-300">[Odroczenie komunikatów](https://docs.microsoft.com/azure/service-bus-messaging/message-deferral) pozwala na odroczenie pobierania komunikatu w późniejszym czasie.</span><span class="sxs-lookup"><span data-stu-id="ec704-300">[Message Deferral](https://docs.microsoft.com/azure/service-bus-messaging/message-deferral) enables you to defer a retrieval of a message to a later time.</span></span> <span data-ttu-id="ec704-301">Oba są często używane w scenariuszach przetwarzania przepływu pracy, w których operacje są przetwarzane w określonej kolejności.</span><span class="sxs-lookup"><span data-stu-id="ec704-301">Both are commonly used in workflow processing scenarios where operations are processed in a particular order.</span></span> <span data-ttu-id="ec704-302">Możesz odroczyć przetwarzanie odebranych komunikatów do momentu ukończenia wcześniejszej pracy.</span><span class="sxs-lookup"><span data-stu-id="ec704-302">You can postpone processing of received messages until prior work has been completed.</span></span>

<span data-ttu-id="ec704-303">Tematy Service Bus to niezawodna i sprawdzona technologia umożliwiająca umożliwienie komunikacji z publikowaniem/subskrypcją w systemach natywnych w chmurze.</span><span class="sxs-lookup"><span data-stu-id="ec704-303">Service Bus topics are a robust and proven technology for enabling publish/subscribe communication in your cloud-native systems.</span></span>

### <a name="azure-event-grid"></a><span data-ttu-id="ec704-304">Azure Event Grid</span><span class="sxs-lookup"><span data-stu-id="ec704-304">Azure Event Grid</span></span>

<span data-ttu-id="ec704-305">Mimo że Azure Service Bus jest przetestowanym sprawdzonej brokerem obsługi komunikatów z pełnym zestawem funkcji dla przedsiębiorstw, [Azure Event Grid](https://docs.microsoft.com/azure/event-grid/overview) jest nowym dzieciem w bloku.</span><span class="sxs-lookup"><span data-stu-id="ec704-305">While Azure Service Bus is a battle-tested messaging broker with a full set of enterprise features, [Azure Event Grid](https://docs.microsoft.com/azure/event-grid/overview) is the new kid on the block.</span></span>

<span data-ttu-id="ec704-306">Na pierwszy rzut oka Event Grid może wyglądać podobnie jak w przypadku innego systemu obsługi komunikatów opartego na temacie.</span><span class="sxs-lookup"><span data-stu-id="ec704-306">At first glance, Event Grid may look like just another topic-based messaging system.</span></span> <span data-ttu-id="ec704-307">Jest to jednak różne na wiele sposobów.</span><span class="sxs-lookup"><span data-stu-id="ec704-307">However, it's different in many ways.</span></span> <span data-ttu-id="ec704-308">Skoncentrowanie się na obciążeniach opartych na zdarzeniach pozwala na przetwarzanie zdarzeń w czasie rzeczywistym, integrację z platformą Azure oraz platformę Open-All w infrastrukturze bezserwerowej.</span><span class="sxs-lookup"><span data-stu-id="ec704-308">Focused on event-driven workloads, it enables real-time event processing, deep Azure integration, and an open-platform - all on serverless infrastructure.</span></span> <span data-ttu-id="ec704-309">Jest ona przeznaczona do współczesnych aplikacji natywnych dla chmury i bezserwerowych</span><span class="sxs-lookup"><span data-stu-id="ec704-309">It's designed for contemporary cloud-native and serverless applications</span></span>

<span data-ttu-id="ec704-310">Jako scentralizowany *plan zdarzeń*lub potok, Event Grid reaguje na zdarzenia wewnątrz zasobów platformy Azure i z własnych usług.</span><span class="sxs-lookup"><span data-stu-id="ec704-310">As a centralized *eventing backplane*, or pipe, Event Grid reacts to events inside Azure resources and from your own services.</span></span>

<span data-ttu-id="ec704-311">Powiadomienia o zdarzeniach są publikowane w temacie Event Grid, co z kolei kieruje każde zdarzenie do subskrypcji.</span><span class="sxs-lookup"><span data-stu-id="ec704-311">Event notifications are published to an Event Grid Topic, which, in turn, routes each event to a subscription.</span></span> <span data-ttu-id="ec704-312">Subskrybenci są zamapowane na subskrypcje i zużywają zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="ec704-312">Subscribers map to subscriptions and consume the events.</span></span> <span data-ttu-id="ec704-313">Podobnie jak Service Bus, Event Grid obsługuje *filtrowany model subskrybenta* , w którym zestaw subskrypcji ma regułę dla zdarzeń, które chce otrzymywać.</span><span class="sxs-lookup"><span data-stu-id="ec704-313">Like Service Bus, Event Grid supports a *filtered subscriber model* where a subscription sets rule for the events it wishes to receive.</span></span> <span data-ttu-id="ec704-314">Event Grid zapewnia szybką przepływność z gwarancją 10 000 000 zdarzeń na sekundę, co pozwala na dostarczanie niemal w czasie rzeczywistym więcej niż to, co Azure Service Bus może generować.</span><span class="sxs-lookup"><span data-stu-id="ec704-314">Event Grid provides fast throughput with a guarantee of 10 million events per second enabling near real-time delivery - far more than what Azure Service Bus can generate.</span></span>

<span data-ttu-id="ec704-315">Słodka plamka dla Event Grid jest jej głębokiej integracji z siecią szkieletową infrastruktury platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="ec704-315">A sweet spot for Event Grid is its deep integration into the fabric of Azure infrastructure.</span></span> <span data-ttu-id="ec704-316">Zasób platformy Azure, taki jak Cosmos DB, może publikować wbudowane zdarzenia bezpośrednio do innych interesujących zasobów platformy Azure — bez konieczności stosowania kodu niestandardowego.</span><span class="sxs-lookup"><span data-stu-id="ec704-316">An Azure resource, such as Cosmos DB, can publish built-in events directly to other interested Azure resources - without the need for custom code.</span></span> <span data-ttu-id="ec704-317">Event Grid mogą publikować zdarzenia z subskrypcji platformy Azure, grupy zasobów lub usługi, zapewniając precyzyjne sterowanie cyklem życia zasobów w chmurze przez deweloperów.</span><span class="sxs-lookup"><span data-stu-id="ec704-317">Event Grid can publish events from an Azure Subscription, Resource Group, or Service, giving developers fine-grained control over the lifecycle of cloud resources.</span></span> <span data-ttu-id="ec704-318">Event Grid nie jest jednak ograniczona do platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="ec704-318">However, Event Grid isn't limited to Azure.</span></span> <span data-ttu-id="ec704-319">Jest to otwarta platforma, która może zużywać niestandardowe zdarzenia HTTP publikowane z aplikacji lub usług innych firm i kierować zdarzenia do subskrybentów zewnętrznych.</span><span class="sxs-lookup"><span data-stu-id="ec704-319">It's an open platform that can consume custom HTTP events published from applications or third-party services and route events to external subscribers.</span></span>

<span data-ttu-id="ec704-320">W przypadku publikowania i subskrybowania zdarzeń natywnych z zasobów platformy Azure nie jest wymagane kodowanie.</span><span class="sxs-lookup"><span data-stu-id="ec704-320">When publishing and subscribing to native events from Azure resources, no coding is required.</span></span> <span data-ttu-id="ec704-321">Przy użyciu prostej konfiguracji możesz zintegrować zdarzenia z jednego zasobu platformy Azure z innym wykorzystując wbudowaną instalację wodociągową dla tematów i subskrypcji.</span><span class="sxs-lookup"><span data-stu-id="ec704-321">With simple configuration, you can integrate events from one Azure resource to another leveraging built-in plumbing for Topics and Subscriptions.</span></span> <span data-ttu-id="ec704-322">Na rysunku 4-17 przedstawiono anatomię Event Grid.</span><span class="sxs-lookup"><span data-stu-id="ec704-322">Figure 4-17 shows the anatomy of Event Grid.</span></span>

![Event Grid Anatomia](./media/event-grid-anatomy.png)

<span data-ttu-id="ec704-324">**Rysunek 4-17**.</span><span class="sxs-lookup"><span data-stu-id="ec704-324">**Figure 4-17**.</span></span> <span data-ttu-id="ec704-325">Event Grid Anatomia</span><span class="sxs-lookup"><span data-stu-id="ec704-325">Event Grid anatomy</span></span>

<span data-ttu-id="ec704-326">Główna różnica między EventGrid i Service Bus jest *wzorcem wymiany komunikatów*.</span><span class="sxs-lookup"><span data-stu-id="ec704-326">A major difference between EventGrid and Service Bus is the underlying *message exchange pattern*.</span></span>

<span data-ttu-id="ec704-327">Service Bus implementuje *model ściągania* starszego stylu, w którym subskrybent podrzędny aktywnie sonduje subskrypcję tematu pod kątem nowych komunikatów.</span><span class="sxs-lookup"><span data-stu-id="ec704-327">Service Bus implements an older style *pull model* in which the downstream subscriber actively polls the topic subscription for new messages.</span></span> <span data-ttu-id="ec704-328">Na odniesieniu do osi odnoszącej się do siebie, ta metoda zapewnia subskrybentowi pełną kontrolę nad tym, w jaki sposób proces przetwarza komunikaty.</span><span class="sxs-lookup"><span data-stu-id="ec704-328">On the upside, this approach gives the subscriber full control of the pace at which it processes messages.</span></span> <span data-ttu-id="ec704-329">Określa, kiedy i ile komunikatów ma być przetwarzanych w danym momencie.</span><span class="sxs-lookup"><span data-stu-id="ec704-329">It controls when and how many messages to process at any given time.</span></span> <span data-ttu-id="ec704-330">Nieprzeczytane wiadomości pozostają w subskrypcji do momentu przetworzenia.</span><span class="sxs-lookup"><span data-stu-id="ec704-330">Unread messages remain in the subscription until processed.</span></span> <span data-ttu-id="ec704-331">Znaczący brak to opóźnienie między czasem wygenerowania zdarzenia a operacją sondowania, która ściąga ten komunikat do subskrybenta w celu przetworzenia.</span><span class="sxs-lookup"><span data-stu-id="ec704-331">A significant shortcoming is the latency between the time the event is generated and the polling operation that pulls that message to the subscriber for processing.</span></span> <span data-ttu-id="ec704-332">Ponadto narzuty stałe sondowania dla następnego zdarzenia zużywa zasoby i pieniądze.</span><span class="sxs-lookup"><span data-stu-id="ec704-332">Also, the overhead of constant polling for the next event consumes resources and money.</span></span>

<span data-ttu-id="ec704-333">EventGrid, jednak różni się.</span><span class="sxs-lookup"><span data-stu-id="ec704-333">EventGrid, however, is different.</span></span> <span data-ttu-id="ec704-334">Implementuje *model wypychania* , w którym zdarzenia są wysyłane do EventHandlers jako otrzymane, co pozwala na dostarczanie zdarzeń niemal w czasie rzeczywistym.</span><span class="sxs-lookup"><span data-stu-id="ec704-334">It implements a *push model* in which events are sent to the EventHandlers as received, giving near real-time event delivery.</span></span> <span data-ttu-id="ec704-335">Zmniejsza to również koszty, ponieważ usługa jest wyzwalana tylko wtedy, gdy jest wymagana do użycia zdarzenia — nie jest to stale zgodne z sondowaniem.</span><span class="sxs-lookup"><span data-stu-id="ec704-335">It also reduces cost as the service is triggered only when it's needed to consume an event – not continually as with polling.</span></span> <span data-ttu-id="ec704-336">Tak samo, program obsługi zdarzeń musi obsłużyć obciążenie przychodzące i zapewnić mechanizmy ograniczania przepustowości w celu samodzielnego zabezpieczenia.</span><span class="sxs-lookup"><span data-stu-id="ec704-336">That said, an event handler must handle the incoming load and provide throttling mechanisms to protect itself from becoming overwhelmed.</span></span> <span data-ttu-id="ec704-337">Wiele usług platformy Azure, które zużywa te zdarzenia, takich jak Azure Functions i Logic Apps, zapewniają automatyczne skalowanie w celu obsługi zwiększonych obciążeń.</span><span class="sxs-lookup"><span data-stu-id="ec704-337">Many Azure services that consume these events, such as Azure Functions and Logic Apps provide automatic autoscaling capabilities to handle increased loads.</span></span>  

<span data-ttu-id="ec704-338">Event Grid to w pełni zarządzana usługa w chmurze bezserwerowej.</span><span class="sxs-lookup"><span data-stu-id="ec704-338">Event Grid is a fully managed serverless cloud service.</span></span> <span data-ttu-id="ec704-339">Dynamicznie skaluje się w oparciu o ruch i opłaty tylko za rzeczywiste użycie, a nie zakupione wcześniej.</span><span class="sxs-lookup"><span data-stu-id="ec704-339">It dynamically scales based on your traffic and charges you only for your actual usage, not pre-purchased capacity.</span></span> <span data-ttu-id="ec704-340">Pierwsze 100 000 operacji miesięcznie są bezpłatne — operacje są definiowane jako zdarzenia związane z ruchem przychodzącym (powiadomienia o zdarzeniach przychodzących), próby dostarczenia subskrypcji, wywołania zarządzania i filtrowanie według podmiotu.</span><span class="sxs-lookup"><span data-stu-id="ec704-340">The first 100,000 operations per month are free – operations being defined as event ingress (incoming event notifications), subscription delivery attempts, management calls, and filtering by subject.</span></span> <span data-ttu-id="ec704-341">Dzięki dostępności na 99,99% EventGrid gwarantuje dostarczenie zdarzenia w ciągu 24-godzinnym i wbudowaną funkcję ponawiania prób w przypadku niepowodzenia dostawy.</span><span class="sxs-lookup"><span data-stu-id="ec704-341">With 99.99% availability, EventGrid guarantees the delivery of an event within a 24-hour period, with built-in retry functionality for unsuccessful delivery.</span></span> <span data-ttu-id="ec704-342">Komunikaty niedostarczone można przenieść do kolejki "utraconych" w celu rozwiązania problemu.</span><span class="sxs-lookup"><span data-stu-id="ec704-342">Undelivered messages can be moved to a "dead-letter" queue for resolution.</span></span>  <span data-ttu-id="ec704-343">W przeciwieństwie do Azure Service Bus, Event Grid jest dostrojony do szybkiej wydajności i nie obsługuje funkcji, takich jak uporządkowane wiadomości, transakcje i sesje.</span><span class="sxs-lookup"><span data-stu-id="ec704-343">Unlike Azure Service Bus, Event Grid is tuned for fast performance and doesn't support features like ordered messaging, transactions, and sessions.</span></span>

### <a name="streaming-messages-in-the-azure-cloud"></a><span data-ttu-id="ec704-344">Przesyłanie strumieniowe komunikatów w chmurze platformy Azure</span><span class="sxs-lookup"><span data-stu-id="ec704-344">Streaming messages in the Azure cloud</span></span>

<span data-ttu-id="ec704-345">Azure Service Bus i Event Grid zapewniają doskonałą pomoc techniczną dla aplikacji, które uwidaczniają pojedyncze, dyskretne zdarzenia, takie jak nowy dokument został wstawiony do Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="ec704-345">Azure Service Bus and Event Grid provide great support for applications that expose single, discrete events like a new document has been inserted into a Cosmos DB.</span></span> <span data-ttu-id="ec704-346">Ale co zrobić, jeśli system natywny w chmurze musi przetworzyć *strumień powiązanych zdarzeń*?</span><span class="sxs-lookup"><span data-stu-id="ec704-346">But, what if your cloud-native system needs to process a *stream of related events*?</span></span> <span data-ttu-id="ec704-347">[Strumienie zdarzeń](https://msdn.microsoft.com/magazine/dn904671) są bardziej skomplikowane.</span><span class="sxs-lookup"><span data-stu-id="ec704-347">[Event streams](https://msdn.microsoft.com/magazine/dn904671) are more complex.</span></span> <span data-ttu-id="ec704-348">Są one zazwyczaj uporządkowane według czasu, wzajemnie powiązane i muszą być przetwarzane jako Grupa.</span><span class="sxs-lookup"><span data-stu-id="ec704-348">They're typically time-ordered, interrelated, and must be processed as a group.</span></span>

<span data-ttu-id="ec704-349">[Azure Event Hub](https://azure.microsoft.com/services/event-hubs/) to usługa przesyłania strumieniowego danych i usługi pozyskiwania zdarzeń, która gromadzi, przekształca i zapisuje zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="ec704-349">[Azure Event Hub](https://azure.microsoft.com/services/event-hubs/) is a data streaming platform and event ingestion service that collects, transforms, and stores events.</span></span> <span data-ttu-id="ec704-350">Jest to dostrajane do przechwytywania danych przesyłanych strumieniowo, takich jak ciągłe powiadomienia o zdarzeniach emitowane z kontekstu telemetrii.</span><span class="sxs-lookup"><span data-stu-id="ec704-350">It's fine-tuned to capture streaming data, such as continuous event notifications emitted from a telemetry context.</span></span> <span data-ttu-id="ec704-351">Usługa jest wysoce skalowalna i może przechowywać i [przetwarzać miliony zdarzeń na sekundę](https://docs.microsoft.com/azure/event-hubs/event-hubs-about).</span><span class="sxs-lookup"><span data-stu-id="ec704-351">The service is highly scalable and can store and [process millions of events per second](https://docs.microsoft.com/azure/event-hubs/event-hubs-about).</span></span> <span data-ttu-id="ec704-352">Pokazano na rysunku 4-18, często są to drzwi czołowe dla potoku zdarzeń, oddzielania strumienia pozyskiwania od zużycia zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="ec704-352">Shown in Figure 4-18, it's often a front door for an event pipeline, decoupling ingest stream from event consumption.</span></span>

![Centrum zdarzeń platformy Azure](./media/azure-event-hub.png)

<span data-ttu-id="ec704-354">**Rysunek 4-18**.</span><span class="sxs-lookup"><span data-stu-id="ec704-354">**Figure 4-18**.</span></span> <span data-ttu-id="ec704-355">Centrum zdarzeń platformy Azure</span><span class="sxs-lookup"><span data-stu-id="ec704-355">Azure Event Hub</span></span>

<span data-ttu-id="ec704-356">Centrum zdarzeń obsługuje małe opóźnienia i konfigurowalne przechowywanie czasu.</span><span class="sxs-lookup"><span data-stu-id="ec704-356">Event Hub supports low latency and configurable time retention.</span></span> <span data-ttu-id="ec704-357">W przeciwieństwie do kolejek i tematów Event Hubs zachować dane zdarzenia po ich odczytaniu przez konsumenta.</span><span class="sxs-lookup"><span data-stu-id="ec704-357">Unlike queues and topics, Event Hubs keep event data after it's been read by a consumer.</span></span> <span data-ttu-id="ec704-358">Ta funkcja umożliwia innym usługom analitycznym danych, zarówno wewnętrznym, jak i zewnętrznym, odtwarzanie danych w celu dalszej analizy.</span><span class="sxs-lookup"><span data-stu-id="ec704-358">This feature enables other data analytic services, both internal and external, to replay the data for further analysis.</span></span> <span data-ttu-id="ec704-359">Zdarzenia przechowywane w centrum zdarzeń są usuwane dopiero po upływie okresu przechowywania, który jest domyślnie jeden dzień, ale konfigurowalne.</span><span class="sxs-lookup"><span data-stu-id="ec704-359">Events stored in event hub are only deleted upon expiration of the retention period, which is one day by default, but configurable.</span></span>

<span data-ttu-id="ec704-360">Centrum zdarzeń obsługuje typowe protokoły publikowania zdarzeń, w tym HTTPS i AMQP.</span><span class="sxs-lookup"><span data-stu-id="ec704-360">Event Hub supports common event publishing protocols including HTTPS and AMQP.</span></span> <span data-ttu-id="ec704-361">Obsługuje także Kafka 1,0.</span><span class="sxs-lookup"><span data-stu-id="ec704-361">It also supports Kafka 1.0.</span></span> <span data-ttu-id="ec704-362">[Istniejące aplikacje Kafka mogą komunikować się z centrum zdarzeń](https://docs.microsoft.com/azure/event-hubs/event-hubs-for-kafka-ecosystem-overview) przy użyciu protokołu Kafka, co zapewnia alternatywę dla zarządzania dużymi klastrami Kafka.</span><span class="sxs-lookup"><span data-stu-id="ec704-362">[Existing Kafka applications can communicate with Event Hub](https://docs.microsoft.com/azure/event-hubs/event-hubs-for-kafka-ecosystem-overview) using the Kafka protocol providing an alternative to managing large Kafka clusters.</span></span> <span data-ttu-id="ec704-363">Wiele systemów natywnych dla chmury "open source" obejmuje Kafka.</span><span class="sxs-lookup"><span data-stu-id="ec704-363">Many open-source cloud-native systems embrace Kafka.</span></span>

<span data-ttu-id="ec704-364">Event Hubs implementuje przesyłanie strumieniowe komunikatów za pomocą [partycjonowanego modelu konsumenta](https://docs.microsoft.com/azure/event-hubs/event-hubs-features) , w którym każdy odbiorca odczytuje tylko konkretny podzbiór lub partycję strumienia komunikatów.</span><span class="sxs-lookup"><span data-stu-id="ec704-364">Event Hubs implements message streaming through a [partitioned consumer model](https://docs.microsoft.com/azure/event-hubs/event-hubs-features) in which each consumer only reads a specific subset, or partition, of the message stream.</span></span> <span data-ttu-id="ec704-365">Ten wzorzec zapewnia nieogromne skalowanie w poziomie na potrzeby przetwarzania zdarzeń oraz udostępnia inne funkcje ukierunkowane na przesyłanie strumieniowe, które są niedostępne w kolejkach i tematach.</span><span class="sxs-lookup"><span data-stu-id="ec704-365">This pattern enables tremendous horizontal scale for event processing and provides other stream-focused features that are unavailable in queues and topics.</span></span> <span data-ttu-id="ec704-366">Partycja to uporządkowana sekwencja zdarzeń, które są przechowywane w centrum zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="ec704-366">A partition is an ordered sequence of events that is held in an event hub.</span></span> <span data-ttu-id="ec704-367">Po nadejściu nowszych zdarzeń są one dodawane na końcu tej sekwencji.</span><span class="sxs-lookup"><span data-stu-id="ec704-367">As newer events arrive, they're added to the end of this sequence.</span></span><span data-ttu-id="ec704-368"> Rysunek 4-19 pokazuje partycjonowanie w centrum zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="ec704-368"> Figure 4-19 shows partitioning in an Event Hub.</span></span>

![Partycjonowanie centrum zdarzeń](./media/event-hub-partitioning.png)

<span data-ttu-id="ec704-370">**Rysunek 4-19**.</span><span class="sxs-lookup"><span data-stu-id="ec704-370">**Figure 4-19**.</span></span> <span data-ttu-id="ec704-371">Partycjonowanie centrum zdarzeń</span><span class="sxs-lookup"><span data-stu-id="ec704-371">Event Hub partitioning</span></span>

<span data-ttu-id="ec704-372">Zamiast odczytywania z tego samego zasobu, każda grupa odbiorców odczytuje między podzbiorem lub partycją strumienia komunikatów.</span><span class="sxs-lookup"><span data-stu-id="ec704-372">Instead of reading from the same resource, each consumer group reads across a subset, or partition, of the message stream.</span></span> 

<span data-ttu-id="ec704-373">W przypadku aplikacji natywnych w chmurze, które muszą przesyłać strumieniowo dużą liczbę zdarzeń, usługa Azure Event Hub może być niezawodna i niedrogie rozwiązanie.</span><span class="sxs-lookup"><span data-stu-id="ec704-373">For cloud-native applications that must stream large numbers of events, Azure Event Hub can be a robust and affordable solution.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="ec704-374">[Poprzedni](front-end-communication.md)
>[Następny](rest-grpc.md)</span><span class="sxs-lookup"><span data-stu-id="ec704-374">[Previous](front-end-communication.md)
[Next](rest-grpc.md)</span></span>
