---
title: Komunikacja odporna
description: Tworzenie architektury natywnych aplikacji .NET w chmurze dla platformy Azure | Komunikacja odporna
ms.date: 06/30/2019
ms.openlocfilehash: 75a2ffe611ad0cf4bfa20efb49a6993bdbe6b073
ms.sourcegitcommit: 55f438d4d00a34b9aca9eedaac3f85590bb11565
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 09/23/2019
ms.locfileid: "71184849"
---
# <a name="resilient-communications"></a><span data-ttu-id="ef58c-103">Komunikacja odporna</span><span class="sxs-lookup"><span data-stu-id="ef58c-103">Resilient communications</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="ef58c-104">W tej książce evangelized się korzyści związane z przechodzeniem poza tradycyjne, monolityczne projektowanie aplikacji i wdrażanie architektury opartej na mikrousługach, w której zestaw rozproszonych, samodzielnych usług działa niezależnie i komunikuje się z każdym inne przy użyciu standardowych protokołów komunikacyjnych, takich jak HTTP i HTTPS.</span><span class="sxs-lookup"><span data-stu-id="ef58c-104">Throughout this book, we've evangelized the merits of moving beyond traditional monolithic application design and embracing a microservice-based architecture where a set of distributed, self-contained services run independently and communicate with each other using standard communication protocols such as HTTP and HTTPS.</span></span> <span data-ttu-id="ef58c-105">Chociaż taka architektura kupuje wiele ważnych korzyści, oferuje również wiele wyzwań.</span><span class="sxs-lookup"><span data-stu-id="ef58c-105">While such an architecture buys you many important benefits, it also presents many challenges.</span></span> <span data-ttu-id="ef58c-106">Rozważmy na przykład następujące kwestie:</span><span class="sxs-lookup"><span data-stu-id="ef58c-106">Consider, for example, the following concerns:</span></span>

- <span data-ttu-id="ef58c-107">*Komunikacja sieciowa poza procesem.*</span><span class="sxs-lookup"><span data-stu-id="ef58c-107">*Out-of-process network communication.*</span></span> <span data-ttu-id="ef58c-108">Każda usługa komunikuje się za pośrednictwem protokołu sieciowego, który wprowadza Przeciążenie sieci, opóźnienia i błędy przejściowe.</span><span class="sxs-lookup"><span data-stu-id="ef58c-108">Each service communicates over a network protocol that introduces network congestion, latency, and transient faults.</span></span>
- <span data-ttu-id="ef58c-109">*Odnajdowanie usług.*</span><span class="sxs-lookup"><span data-stu-id="ef58c-109">*Service discovery.*</span></span> <span data-ttu-id="ef58c-110">W jaki sposób usługi są wykrywane i komunikują się ze sobą za pomocą każdej usługi uruchomionej w klastrze maszyn z własnym adresem IP i portem?</span><span class="sxs-lookup"><span data-stu-id="ef58c-110">With each service running across a cluster of machines with its own IP address and port, how do services discover and communicate with each other?</span></span>
- <span data-ttu-id="ef58c-111">*Odporności.*</span><span class="sxs-lookup"><span data-stu-id="ef58c-111">*Resiliency.*</span></span> <span data-ttu-id="ef58c-112">Jak zarządzać awariami krótko-i zachować stabilność systemu?</span><span class="sxs-lookup"><span data-stu-id="ef58c-112">How do you manage short-lived failures and keep the system stable?</span></span>
- <span data-ttu-id="ef58c-113">*Równoważenie obciążenia.*</span><span class="sxs-lookup"><span data-stu-id="ef58c-113">*Load balancing.*</span></span> <span data-ttu-id="ef58c-114">Jak ruch przychodzący jest dystrybuowany między wieloma wystąpieniami usługi?</span><span class="sxs-lookup"><span data-stu-id="ef58c-114">How does inbound traffic get distributed across multiple instances of a service?</span></span>
- <span data-ttu-id="ef58c-115">*Bezpieczeństw.*</span><span class="sxs-lookup"><span data-stu-id="ef58c-115">*Security.*</span></span> <span data-ttu-id="ef58c-116">Jak są problemy z bezpieczeństwem, takie jak szyfrowanie na poziomie transportu i zarządzanie certyfikatami?</span><span class="sxs-lookup"><span data-stu-id="ef58c-116">How are security concerns such as transport-level encryption and certificate management enforced?</span></span>
- <span data-ttu-id="ef58c-117">\* Monitorowanie rozproszone.</span><span class="sxs-lookup"><span data-stu-id="ef58c-117">\*Distributed Monitoring.</span></span> <span data-ttu-id="ef58c-118">-Jak skorelować i przechwytywać możliwości śledzenia i monitorowania pojedynczego żądania w wielu usługach korzystających z usług?</span><span class="sxs-lookup"><span data-stu-id="ef58c-118">- How do you correlate and capture traceability and monitoring for a single request across multiple consuming services?</span></span>

<span data-ttu-id="ef58c-119">Chociaż te problemy mogą być rozwiązywane z różnymi bibliotekami i strukturami, implementacja ich wewnątrz bazy kodu może być kosztowna, złożona i czasochłonna.</span><span class="sxs-lookup"><span data-stu-id="ef58c-119">While these concerns can be addressed with various libraries and frameworks, implementing them inside your codebase can be expensive, complex, and time-consuming.</span></span> <span data-ttu-id="ef58c-120">Ponadto można dokończyć rozwiązanie, w którym zagadnienia dotyczące infrastruktury są połączone z logiką biznesową.</span><span class="sxs-lookup"><span data-stu-id="ef58c-120">Moreover, you end up with a solution where infrastructure concerns are coupled to business logic.</span></span>

## <a name="service-mesh"></a><span data-ttu-id="ef58c-121">Siatka usług</span><span class="sxs-lookup"><span data-stu-id="ef58c-121">Service mesh</span></span>

<span data-ttu-id="ef58c-122">Lepszym rozwiązaniem jest uwzględnienie nowej i szybko rozwijanej technologii zatytułowanej *sieci*.</span><span class="sxs-lookup"><span data-stu-id="ef58c-122">A better approach is to consider a new and rapidly evolving technology entitled *Service Mesh*.</span></span> <span data-ttu-id="ef58c-123">[Siatka usług](https://www.nginx.com/blog/what-is-a-service-mesh/) to konfigurowalna warstwa infrastruktury z wbudowanymi funkcjami do obsługi komunikacji z usługą i wielu wyzwań wymienionych powyżej.</span><span class="sxs-lookup"><span data-stu-id="ef58c-123">A [service mesh](https://www.nginx.com/blog/what-is-a-service-mesh/) is a configurable infrastructure layer with built-in capabilities to handle service communication and many of the challenges mentioned above.</span></span> <span data-ttu-id="ef58c-124">Oddziely te problemy od kodu biznesowego i przenosi je do serwera proxy usługi, którego wystąpienie towarzyszy każdej z Twoich usług.</span><span class="sxs-lookup"><span data-stu-id="ef58c-124">It decouples these concerns from your business code and moves them into a service proxy, an instance of which accompanies each of your services.</span></span> <span data-ttu-id="ef58c-125">Często określany jako [wzorzec przyczepki](https://docs.microsoft.com/azure/architecture/patterns/sidecar), serwer proxy siatki usługi jest wdrażany w osobnym procesie, aby zapewnić izolację i hermetyzację z kodu biznesowego.</span><span class="sxs-lookup"><span data-stu-id="ef58c-125">Often referred to as the [Sidecar pattern](https://docs.microsoft.com/azure/architecture/patterns/sidecar), the service mesh proxy is deployed into a separate process to provide isolation and encapsulation from your business code.</span></span> <span data-ttu-id="ef58c-126">Jednak serwer proxy jest ściśle połączony z utworzoną usługą wraz z nią i udostępnia cykl życia.</span><span class="sxs-lookup"><span data-stu-id="ef58c-126">However, the proxy is closely linked to the service being created along with it and sharing its lifecycle.</span></span> <span data-ttu-id="ef58c-127">Na rysunku 6-9 przedstawiono ten scenariusz.</span><span class="sxs-lookup"><span data-stu-id="ef58c-127">Figure 6-9 shows this scenario.</span></span>

![Siatka usług z samochodem bocznym](./media/service-mesh-with-side-car.png)

<span data-ttu-id="ef58c-129">**Rysunek 6-9**.</span><span class="sxs-lookup"><span data-stu-id="ef58c-129">**Figure 6-9**.</span></span> <span data-ttu-id="ef58c-130">Siatka usług z samochodem bocznym</span><span class="sxs-lookup"><span data-stu-id="ef58c-130">Service mesh with a side car</span></span>

<span data-ttu-id="ef58c-131">Na poprzedniej ilustracji należy zwrócić uwagę na to, jak serwer proxy przechwytuje i zarządza komunikacją między mikrousługami i klastrem.</span><span class="sxs-lookup"><span data-stu-id="ef58c-131">In the previous figure, note how the proxy intercepts and manages communication among the microservices and the cluster.</span></span>

<span data-ttu-id="ef58c-132">Siatka usługi jest logicznie dzielona na dwa różne składniki: Płaszczyzna [danych](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc) i [płaszczyzna kontroli](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc).</span><span class="sxs-lookup"><span data-stu-id="ef58c-132">A service mesh is logically split into two disparate components: A [data plane](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc) and [control plane](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc).</span></span> <span data-ttu-id="ef58c-133">Na rysunku 6-10 przedstawiono te składniki i ich obowiązki.</span><span class="sxs-lookup"><span data-stu-id="ef58c-133">Figure 6-10 shows these components and their responsibilities.</span></span>

![Sterowanie siatką usług i płaszczyzna danych](./media/istio-control-and-data-plane.png)

<span data-ttu-id="ef58c-135">**Rysunek 6-10.**</span><span class="sxs-lookup"><span data-stu-id="ef58c-135">**Figure 6-10.**</span></span> <span data-ttu-id="ef58c-136">Sterowanie siatką usług i płaszczyzna danych</span><span class="sxs-lookup"><span data-stu-id="ef58c-136">Service mesh control and data plane</span></span>

<span data-ttu-id="ef58c-137">Po skonfigurowaniu usługi siatka jest wysoce funkcjonalna.</span><span class="sxs-lookup"><span data-stu-id="ef58c-137">Once configured, a service mesh is highly functional.</span></span> <span data-ttu-id="ef58c-138">Może pobrać odpowiadającą pulę wystąpień z punktu końcowego odnajdowania usług.</span><span class="sxs-lookup"><span data-stu-id="ef58c-138">It can retrieve a corresponding pool of instances from a service discovery endpoint.</span></span> <span data-ttu-id="ef58c-139">Następnie może wysłać żądanie do określonego wystąpienia, rejestrując czas oczekiwania i typ odpowiedzi wyniku.</span><span class="sxs-lookup"><span data-stu-id="ef58c-139">It can then send a request to a specific instance, recording the latency and response type of the result.</span></span> <span data-ttu-id="ef58c-140">Siatka może wybrać wystąpienie najlepiej zwracające szybką odpowiedź w oparciu o wiele czynników, w tym ich zaobserwowany czas oczekiwania na ostatnie żądania.</span><span class="sxs-lookup"><span data-stu-id="ef58c-140">A mesh can choose the instance most likely to return a fast response based on many factors, including its observed latency for recent requests.</span></span>

<span data-ttu-id="ef58c-141">Jeśli wystąpienie nie odpowiada lub kończy się niepowodzeniem, Siatka może ponowić żądanie w innym wystąpieniu.</span><span class="sxs-lookup"><span data-stu-id="ef58c-141">If an instance is unresponsive or fails, the mesh can retry the request on another instance.</span></span> <span data-ttu-id="ef58c-142">Jeśli pula zwraca błędy, Siatka może wykluczyć ją z puli równoważenia obciążenia, aby ponowić próbę w późniejszym czasie po wprowadzeniu błędów.</span><span class="sxs-lookup"><span data-stu-id="ef58c-142">If a pool consistently returns errors, a mesh can evict it from the load-balancing pool to be retried periodically later after it heals.</span></span> <span data-ttu-id="ef58c-143">Jeśli upłynął limit czasu żądania, Siatka może zakończyć się niepowodzeniem, a następnie ponowić próbę żądania.</span><span class="sxs-lookup"><span data-stu-id="ef58c-143">If a request times out, a mesh can fail and then retry the request.</span></span> <span data-ttu-id="ef58c-144">Siatka przechwytuje zachowanie w formie metryk i rozproszonego śledzenia, które następnie można emitować do scentralizowanego systemu metryk.</span><span class="sxs-lookup"><span data-stu-id="ef58c-144">A mesh captures behavior in the form of metrics and distributed tracing, which then can be emitted to a centralized metrics system.</span></span>

## <a name="istio-and-envoy"></a><span data-ttu-id="ef58c-145">Istio i wysłannika</span><span class="sxs-lookup"><span data-stu-id="ef58c-145">Istio and Envoy</span></span>

<span data-ttu-id="ef58c-146">Mimo że niektóre opcje sieci usługi są obecnie dostępne, [Istio](https://istio.io/docs/concepts/what-is-istio/) jest najpopularniejsze w czasie tego pisania.</span><span class="sxs-lookup"><span data-stu-id="ef58c-146">While a few service mesh options currently exist, [Istio](https://istio.io/docs/concepts/what-is-istio/) is the most popular as of the time of this writing.</span></span> <span data-ttu-id="ef58c-147">Wspólnym przedsiębiorstwem firmy IBM, Google i LYFT jest oferta typu "open source", którą można zintegrować z nową lub istniejącą aplikacją rozproszoną.</span><span class="sxs-lookup"><span data-stu-id="ef58c-147">A joint venture from IBM, Google, and Lyft, it's an open-source offering that can be integrated into a new or existing distributed application.</span></span> <span data-ttu-id="ef58c-148">Zapewnia spójne i kompletne rozwiązanie do zabezpieczania, łączenia i monitorowania mikrousług.</span><span class="sxs-lookup"><span data-stu-id="ef58c-148">It provides a consistent and complete solution to secure, connect, and monitor microservices.</span></span> <span data-ttu-id="ef58c-149">Dostępne są następujące funkcje:</span><span class="sxs-lookup"><span data-stu-id="ef58c-149">Its features include:</span></span>

- <span data-ttu-id="ef58c-150">Zabezpieczanie komunikacji między usługami w klastrze z silnym uwierzytelnianiem i autoryzacją w oparciu o tożsamość.</span><span class="sxs-lookup"><span data-stu-id="ef58c-150">Secure service-to-service communication in a cluster with strong identity-based authentication and authorization.</span></span>
- <span data-ttu-id="ef58c-151">Automatyczne równoważenie obciążenia dla ruchu HTTP, [gRPC](https://grpc.io/), WEBSOCKET i TCP.</span><span class="sxs-lookup"><span data-stu-id="ef58c-151">Automatic load balancing for HTTP, [gRPC](https://grpc.io/), WebSocket, and TCP traffic.</span></span>
- <span data-ttu-id="ef58c-152">Szczegółową kontrolę nad zachowaniem ruchu przy użyciu zaawansowanych reguł routingu, ponownych prób, przełączeń do trybu failover i iniekcji błędów.</span><span class="sxs-lookup"><span data-stu-id="ef58c-152">Fine-grained control of traffic behavior with rich routing rules, retries, failovers, and fault injection.</span></span>
- <span data-ttu-id="ef58c-153">Podłączana warstwa zasad i interfejs API konfiguracji obsługujący kontrolę dostępu, limity szybkości i przydziały.</span><span class="sxs-lookup"><span data-stu-id="ef58c-153">A pluggable policy layer and configuration API supporting access controls, rate limits, and quotas.</span></span>
- <span data-ttu-id="ef58c-154">Automatyczne metryki, dzienniki i ślady dla całego ruchu w klastrze, w tym dane przychodzące i wychodzące klastra.</span><span class="sxs-lookup"><span data-stu-id="ef58c-154">Automatic metrics, logs, and traces for all traffic within a cluster, including cluster ingress and egress.</span></span>

<span data-ttu-id="ef58c-155">Kluczowy składnik implementacji Istio to usługa serwera proxy uprawniona do [serwera proxy wysłannika](https://www.envoyproxy.io/docs/envoy/latest/intro/what_is_envoy).</span><span class="sxs-lookup"><span data-stu-id="ef58c-155">A key component for an Istio implementation is a proxy service entitled the [Envoy proxy](https://www.envoyproxy.io/docs/envoy/latest/intro/what_is_envoy).</span></span> <span data-ttu-id="ef58c-156">Pochodzące z LYFT, a następnie do [natywnej podstawy obliczeniowej w chmurze](https://www.cncf.io/) (omówione w rozdziale 1), serwer proxy wysłannika działa obok każdej usługi i udostępnia platformę niezależny od Foundation dla następujących funkcji:</span><span class="sxs-lookup"><span data-stu-id="ef58c-156">Originating from Lyft and subsequently contributed to the [Cloud Native Computing Foundation](https://www.cncf.io/) (discussed in chapter 1), the Envoy proxy runs alongside each service and provides a platform-agnostic foundation for the following features:</span></span>

- <span data-ttu-id="ef58c-157">Odnajdywanie usługi dynamicznej.</span><span class="sxs-lookup"><span data-stu-id="ef58c-157">Dynamic service discovery.</span></span>
- <span data-ttu-id="ef58c-158">Równoważenie obciążenia.</span><span class="sxs-lookup"><span data-stu-id="ef58c-158">Load balancing.</span></span>
- <span data-ttu-id="ef58c-159">Zakończenie protokołu TLS.</span><span class="sxs-lookup"><span data-stu-id="ef58c-159">TLS termination.</span></span>
- <span data-ttu-id="ef58c-160">Serwery proxy HTTP i gRPC.</span><span class="sxs-lookup"><span data-stu-id="ef58c-160">HTTP and gRPC proxies.</span></span>
- <span data-ttu-id="ef58c-161">Odporność wyłącznika.</span><span class="sxs-lookup"><span data-stu-id="ef58c-161">Circuit breaker resiliency.</span></span>
- <span data-ttu-id="ef58c-162">Kontrole kondycji.</span><span class="sxs-lookup"><span data-stu-id="ef58c-162">Health checks.</span></span>
- <span data-ttu-id="ef58c-163">Aktualizacje stopniowe przy użyciu wdrożeń [Kanaryjskich](https://martinfowler.com/bliki/CanaryRelease.html) .</span><span class="sxs-lookup"><span data-stu-id="ef58c-163">Rolling updates with [canary](https://martinfowler.com/bliki/CanaryRelease.html) deployments.</span></span>

<span data-ttu-id="ef58c-164">Jak wspomniano wcześniej, wysłannika jest wdrażany jako Przyczepka dla każdej mikrousługi w klastrze.</span><span class="sxs-lookup"><span data-stu-id="ef58c-164">As previously discussed, Envoy is deployed as a sidecar to each microservice in the cluster.</span></span>

## <a name="integration-with-azure-kubernetes-services"></a><span data-ttu-id="ef58c-165">Integracja z usługami Azure Kubernetes Services</span><span class="sxs-lookup"><span data-stu-id="ef58c-165">Integration with Azure Kubernetes Services</span></span>

<span data-ttu-id="ef58c-166">Chmura Azure obejmuje usługę Istio i zapewnia bezpośrednią pomoc techniczną w ramach usług Azure Kubernetes Services.</span><span class="sxs-lookup"><span data-stu-id="ef58c-166">The Azure cloud embraces Istio and provides direct support for it within Azure Kubernetes Services.</span></span> <span data-ttu-id="ef58c-167">Następujące linki mogą pomóc Ci rozpocząć pracę:</span><span class="sxs-lookup"><span data-stu-id="ef58c-167">The following links can help you get started:</span></span>

- [<span data-ttu-id="ef58c-168">Instalowanie Istio w AKS</span><span class="sxs-lookup"><span data-stu-id="ef58c-168">Installing Istio in AKS</span></span>](https://docs.microsoft.com/azure/aks/istio-install)
- [<span data-ttu-id="ef58c-169">Korzystanie z AKS i Istio</span><span class="sxs-lookup"><span data-stu-id="ef58c-169">Using AKS and Istio</span></span>](https://docs.microsoft.com/azure/aks/istio-scenario-routing)

>[!div class="step-by-step"]
><span data-ttu-id="ef58c-170">[Poprzedni](infrastructure-resiliency-azure.md)
>[Następny](monitoring-health.md)</span><span class="sxs-lookup"><span data-stu-id="ef58c-170">[Previous](infrastructure-resiliency-azure.md)
[Next](monitoring-health.md)</span></span> <!-- Next Chapter -->