---
title: Wzorce odporności aplikacji
description: Tworzenie architektury natywnych aplikacji .NET w chmurze dla platformy Azure | Wzorce odporności aplikacji
ms.date: 06/30/2019
ms.openlocfilehash: 13811efaa88e0bd2824add1c8712b78b18d46375
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/30/2019
ms.locfileid: "73087759"
---
# <a name="application-resiliency-patterns"></a><span data-ttu-id="f8370-103">Wzorce odporności aplikacji</span><span class="sxs-lookup"><span data-stu-id="f8370-103">Application resiliency patterns</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="f8370-104">Pierwszym wierszem obrony jest odporność aplikacji z włączoną obsługą oprogramowania.</span><span class="sxs-lookup"><span data-stu-id="f8370-104">The first line of defense is software-enabled application resiliency.</span></span>

<span data-ttu-id="f8370-105">Chociaż można zainwestować znaczną czas pisania własnej struktury odporności, takie produkty już istnieją.</span><span class="sxs-lookup"><span data-stu-id="f8370-105">While you could invest considerable time writing your own resiliency framework, such products already exist.</span></span> <span data-ttu-id="f8370-106">Na przykład [Polly](http://www.thepollyproject.org/) jest kompleksową biblioteką odporności platformy .NET i obsługi błędów przejściowych, która pozwala deweloperom na wyznaczanie zasad odporności w sposób bezpieczny dla bezpieczeństwa i bezpiecznego wątkowo.</span><span class="sxs-lookup"><span data-stu-id="f8370-106">For example, [Polly](http://www.thepollyproject.org/) is a comprehensive .NET resilience and transient-fault-handling library that allows developers to express resiliency policies in a fluent and thread-safe manner.</span></span> <span data-ttu-id="f8370-107">Polly są obiektami docelowymi utworzonymi za pomocą pełnej .NET Framework lub platformy .NET Core.</span><span class="sxs-lookup"><span data-stu-id="f8370-107">Polly targets applications built with either the full .NET Framework or .NET Core.</span></span> <span data-ttu-id="f8370-108">Rysunek 6-2 przedstawia zasady odporności (czyli funkcje) dostępne w bibliotece Polly.</span><span class="sxs-lookup"><span data-stu-id="f8370-108">Figure 6-2 shows the resiliency policies (that is, functionality) available from the Polly Library.</span></span> <span data-ttu-id="f8370-109">Te zasady można stosować pojedynczo lub wspólnie ze sobą.</span><span class="sxs-lookup"><span data-stu-id="f8370-109">These policies can be applied individually or combined together.</span></span>

![Polly Framework](./media/polly-resiliency-framework.png)

<span data-ttu-id="f8370-111">**Rysunek 6-2**.</span><span class="sxs-lookup"><span data-stu-id="f8370-111">**Figure 6-2**.</span></span> <span data-ttu-id="f8370-112">Funkcje platformy odporności Polly</span><span class="sxs-lookup"><span data-stu-id="f8370-112">Polly resiliency framework features</span></span>

<span data-ttu-id="f8370-113">Zwróć uwagę na to, jak na poprzednim rysunku zasady odporności dotyczą komunikatów żądania, niezależnie od tego, czy pochodzą z klienta zewnętrznego czy innej usługi zaplecza.</span><span class="sxs-lookup"><span data-stu-id="f8370-113">Note how in the previous figure the resiliency policies apply to request messages, whether coming from an external client or another back-end service.</span></span> <span data-ttu-id="f8370-114">Celem jest zrekompensowanie żądania usługi, która może być chwilowo niedostępna.</span><span class="sxs-lookup"><span data-stu-id="f8370-114">The goal is to compensate the request for a service that might be momentarily unavailable.</span></span> <span data-ttu-id="f8370-115">Te krótkie przerwy zwykle deklarują się za pomocą kodów stanu HTTP przedstawionych na rysunku 6-3.</span><span class="sxs-lookup"><span data-stu-id="f8370-115">These short interruptions typically manifest themselves with the HTTP status codes shown in Figure 6-3.</span></span>

![Kody stanu HTTP do ponowienia próby](./media/http-status-codes.png)

<span data-ttu-id="f8370-117">**Rysunek 6-3**.</span><span class="sxs-lookup"><span data-stu-id="f8370-117">**Figure 6-3**.</span></span> <span data-ttu-id="f8370-118">Kody stanu HTTP do ponowienia próby</span><span class="sxs-lookup"><span data-stu-id="f8370-118">HTTP status codes to retry</span></span>

<span data-ttu-id="f8370-119">Pytanie: Czy chcesz ponowić próbę wykonania kodu stanu HTTP 403 — Dostęp zabroniony?</span><span class="sxs-lookup"><span data-stu-id="f8370-119">Question: Would you retry an HTTP Status Code of 403 - Forbidden?</span></span> <span data-ttu-id="f8370-120">Nie.</span><span class="sxs-lookup"><span data-stu-id="f8370-120">No.</span></span> <span data-ttu-id="f8370-121">W tym miejscu system działa prawidłowo, ale informuje obiekt wywołujący, że nie ma uprawnień do wykonywania żądanych operacji.</span><span class="sxs-lookup"><span data-stu-id="f8370-121">Here, the system is functioning properly, but informing the caller that they aren't authorized to perform the requested operation.</span></span> <span data-ttu-id="f8370-122">Należy zachować ostrożność, aby ponowić próbę tylko operacji spowodowanych błędami.</span><span class="sxs-lookup"><span data-stu-id="f8370-122">Care must be taken to retry only those operations caused by failures.</span></span>

<span data-ttu-id="f8370-123">Zgodnie z zaleceniami w rozdziale 1 programiści firmy Microsoft tworzący aplikacje natywne w chmurze powinni kierować platformą .NET Core.</span><span class="sxs-lookup"><span data-stu-id="f8370-123">As recommended in Chapter 1, Microsoft developers constructing cloud-native applications should target .NET Core.</span></span> <span data-ttu-id="f8370-124">W wersji 2,1 wprowadzono bibliotekę [HTTPClientFactory](https://www.stevejgordon.co.uk/introduction-to-httpclientfactory-aspnetcore) do tworzenia wystąpień klienta http na potrzeby współpracy z zasobami opartymi na adresach URL.</span><span class="sxs-lookup"><span data-stu-id="f8370-124">Version 2.1 introduced the [HTTPClientFactory](https://www.stevejgordon.co.uk/introduction-to-httpclientfactory-aspnetcore) library for creating HTTP Client instances for interacting with URL-based resources.</span></span> <span data-ttu-id="f8370-125">Zastąpienie oryginalnej klasy HTTPClient, Klasa Factory obsługuje wiele ulepszonych funkcji, jednym z nich jest [ścisła integracja](../microservices/implement-resilient-applications/implement-http-call-retries-exponential-backoff-polly.md) z biblioteką odporności Polly.</span><span class="sxs-lookup"><span data-stu-id="f8370-125">Superseding the original HTTPClient class, the factory class supports many enhanced features, one of which is [tight integration](../microservices/implement-resilient-applications/implement-http-call-retries-exponential-backoff-polly.md) with the Polly resiliency library.</span></span> <span data-ttu-id="f8370-126">Dzięki niej można łatwo definiować zasady odporności w klasie uruchamiania aplikacji w celu obsługi częściowych awarii i problemów z łącznością.</span><span class="sxs-lookup"><span data-stu-id="f8370-126">With it, you can easily define resiliency policies in the application Startup class to handle partial failures and connectivity issues.</span></span>

<span data-ttu-id="f8370-127">Następnie Rozwińmy wzorce ponowień i wyłączników.</span><span class="sxs-lookup"><span data-stu-id="f8370-127">Next, let's expand on retry and circuit breaker patterns.</span></span>

### <a name="retry-pattern"></a><span data-ttu-id="f8370-128">Wzorzec ponawiania</span><span class="sxs-lookup"><span data-stu-id="f8370-128">Retry pattern</span></span>

<span data-ttu-id="f8370-129">W rozproszonym środowisku natywnym w chmurze wywołania usług i zasobów w chmurze mogą zakończyć się niepowodzeniem z powodu przejściowych (krótko-o) awarii, które zwykle są naprawione po krótkim czasie.</span><span class="sxs-lookup"><span data-stu-id="f8370-129">In a distributed cloud-native environment, calls to services and cloud resources can fail because of transient (short-lived) failures, which typically correct themselves after a brief period of time.</span></span> <span data-ttu-id="f8370-130">Wdrożenie strategii ponawiania próbuje obsłużyć usługę natywną w chmurze.</span><span class="sxs-lookup"><span data-stu-id="f8370-130">Implementing a retry strategy helps a cloud-native service handle these scenarios.</span></span>

<span data-ttu-id="f8370-131">[Wzorzec ponawiania próby](https://docs.microsoft.com/azure/architecture/patterns/retry) umożliwia usłudze ponowienie próby nieudanej operacji żądania, która jest możliwa do skonfigurowania.</span><span class="sxs-lookup"><span data-stu-id="f8370-131">The [Retry pattern](https://docs.microsoft.com/azure/architecture/patterns/retry) enables a service to retry a failed request operation a (configurable) number of times with an exponentially increasing wait time.</span></span> <span data-ttu-id="f8370-132">Rysunek 6-4 pokazuje ponowną próbę wykonania akcji.</span><span class="sxs-lookup"><span data-stu-id="f8370-132">Figure 6-4 shows a retry in action.</span></span>

![Wzorzec ponawiania w akcji](./media/retry-pattern.png)

<span data-ttu-id="f8370-134">**Rysunek 6-4**.</span><span class="sxs-lookup"><span data-stu-id="f8370-134">**Figure 6-4**.</span></span> <span data-ttu-id="f8370-135">Wzorzec ponawiania w akcji</span><span class="sxs-lookup"><span data-stu-id="f8370-135">Retry pattern in action</span></span>

<span data-ttu-id="f8370-136">Na poprzednim rysunku został zaimplementowany wzorzec ponawiania prób dla operacji żądania.</span><span class="sxs-lookup"><span data-stu-id="f8370-136">In the previous figure, a retry pattern has been implemented for a request operation.</span></span> <span data-ttu-id="f8370-137">Jest skonfigurowany tak, aby zezwalał do czterech ponownych prób przed niepowodzeniem z interwałem wycofywania (czas oczekiwania), zaczynając od dwóch sekund, co wykładniczo podwaja się dla każdej kolejnej próby.</span><span class="sxs-lookup"><span data-stu-id="f8370-137">It's configured to allow up to four retries before failing with a backoff interval (wait time) starting at two seconds, which exponentially doubles for each subsequent attempt.</span></span>

- <span data-ttu-id="f8370-138">Pierwsze wywołanie nie powiodło się i zwraca kod stanu HTTP 500.</span><span class="sxs-lookup"><span data-stu-id="f8370-138">The first invocation fails and returns an HTTP status code of 500.</span></span> <span data-ttu-id="f8370-139">Aplikacja czeka dwie sekundy i ponawia próbę wywołania.</span><span class="sxs-lookup"><span data-stu-id="f8370-139">The application waits for two seconds and retries the call.</span></span>
- <span data-ttu-id="f8370-140">Drugie wywołanie kończy się niepowodzeniem i zwraca kod stanu HTTP 500.</span><span class="sxs-lookup"><span data-stu-id="f8370-140">The second invocation also fails and returns an HTTP status code of 500.</span></span> <span data-ttu-id="f8370-141">Aplikacja teraz podwaja interwał wycofywania do czterech sekund i ponawia próbę wywołania.</span><span class="sxs-lookup"><span data-stu-id="f8370-141">The application now doubles the backoff interval to four seconds and retries the call.</span></span>
- <span data-ttu-id="f8370-142">Na koniec trzecie wywołanie powiodło się.</span><span class="sxs-lookup"><span data-stu-id="f8370-142">Finally, the third call succeeds.</span></span>
- <span data-ttu-id="f8370-143">W tym scenariuszu próba wykonania operacji ponawiania próbuje się do czterech ponownych prób podczas podwajania czasu trwania wycofywania przed zakończeniem wywołania.</span><span class="sxs-lookup"><span data-stu-id="f8370-143">In this scenario, the retry operation would have attempted up to four retries while doubling the backoff duration before failing the call.</span></span>

<span data-ttu-id="f8370-144">Ważne jest, aby zwiększyć okres wycofywania przed ponowną próbą wywołania, aby zezwolić na samoprawidłowość usługi.</span><span class="sxs-lookup"><span data-stu-id="f8370-144">It's important to increase the backoff period before retrying the call to allow the service time to self-correct.</span></span> <span data-ttu-id="f8370-145">Najlepszym rozwiązaniem jest wdrożenie wykładniczego wzrostu wycofywania (podwojenie okresu przy każdej ponowieniu próby), aby zapewnić odpowiedni czas korekcji.</span><span class="sxs-lookup"><span data-stu-id="f8370-145">It's a best practice to implement an exponentially increasing backoff (doubling the period on each retry) to allow adequate correction time.</span></span>

## <a name="circuit-breaker-pattern"></a><span data-ttu-id="f8370-146">Wzorzec wyłącznika</span><span class="sxs-lookup"><span data-stu-id="f8370-146">Circuit breaker pattern</span></span>

<span data-ttu-id="f8370-147">Chociaż wzorzec ponawiania może pomóc w odzyskaniu żądania Entangled w częściowej awarii, istnieją sytuacje, w których awarie mogą być spowodowane nieoczekiwanymi zdarzeniami, które będą wymagały dłuższych okresów czasu na rozwiązanie.</span><span class="sxs-lookup"><span data-stu-id="f8370-147">While the retry pattern can help salvage a request entangled in a partial failure, there are situations where failures can be caused by unanticipated events that will require longer periods of time to resolve.</span></span> <span data-ttu-id="f8370-148">Te błędy mogą mieć różne wagi od częściowej utraty łączności z pełną awarią usługi.</span><span class="sxs-lookup"><span data-stu-id="f8370-148">These faults can range in severity from a partial loss of connectivity to the complete failure of a service.</span></span> <span data-ttu-id="f8370-149">W takich sytuacjach nie jest możliwe, aby aplikacja stale ponawiać próbę wykonania operacji, która prawdopodobnie nie powiedzie się.</span><span class="sxs-lookup"><span data-stu-id="f8370-149">In these situations, it's pointless for an application to continually retry an operation that is unlikely to succeed.</span></span>

<span data-ttu-id="f8370-150">Aby zapewnić, że wykonywanie operacji ciągłego ponawiania w usłudze, która nie odpowiada, może przejść do samodzielnego scenariusza odmowy usługi, w którym usługa jest zalewana przez ciągłe wywoływanie zasobów, takich jak pamięć, wątki i baza danych. połączenia, powodując niepowodzenie niepowiązanych części systemu wykorzystujących te same zasoby.</span><span class="sxs-lookup"><span data-stu-id="f8370-150">To make things worse, executing continual retry operations on a non-responsive service can move you into a self-imposed denial of service scenario where you flood your service with continual calls exhausting resources such as memory, threads and database connections, causing failure in unrelated parts of the system that use the same resources.</span></span>

<span data-ttu-id="f8370-151">W takich sytuacjach lepszym rozwiązaniem może być niepowodzenie operacji natychmiastowego i próba wywołania usługi w przypadku, gdy będzie to możliwe.</span><span class="sxs-lookup"><span data-stu-id="f8370-151">In these situations, it would be preferable for the operation to fail immediately and only attempt to invoke the service if it's likely to succeed.</span></span>

<span data-ttu-id="f8370-152">[Wzorzec wyłącznika](https://docs.microsoft.com/azure/architecture/patterns/circuit-breaker) może uniemożliwić aplikacji wielokrotne ponawianie próby wykonania operacji, która może zakończyć się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="f8370-152">The [Circuit Breaker pattern](https://docs.microsoft.com/azure/architecture/patterns/circuit-breaker) can prevent an application from repeatedly trying to execute an operation that's likely to fail.</span></span> <span data-ttu-id="f8370-153">Monitoruje również aplikację z okresowym wywołaniem próbnym w celu ustalenia, czy błąd został rozwiązany.</span><span class="sxs-lookup"><span data-stu-id="f8370-153">It also monitors the application with a periodic trial call to determine whether the fault has resolved.</span></span> <span data-ttu-id="f8370-154">Rysunek 6-5 pokazuje wzorzec wyłącznika w akcji.</span><span class="sxs-lookup"><span data-stu-id="f8370-154">Figure 6-5 shows the Circuit Breaker pattern in action.</span></span>

![Wzorzec wyłącznika w akcji](./media/circuit-breaker-pattern.png)

<span data-ttu-id="f8370-156">**Rysunek 6-5**.</span><span class="sxs-lookup"><span data-stu-id="f8370-156">**Figure 6-5**.</span></span> <span data-ttu-id="f8370-157">Wzorzec wyłącznika w akcji</span><span class="sxs-lookup"><span data-stu-id="f8370-157">Circuit breaker pattern in action</span></span>

<span data-ttu-id="f8370-158">Na poprzedniej ilustracji wzorzec wyłącznika został dodany do oryginalnego wzorca ponawiania prób.</span><span class="sxs-lookup"><span data-stu-id="f8370-158">In the previous figure, a Circuit Breaker pattern has been added to the original retry pattern.</span></span> <span data-ttu-id="f8370-159">Zwróć uwagę, jak po 10 żądaniach zakończonych niepowodzeniem Wyłączniki są otwierane i nie będą już zezwalać na wywołania usługi.</span><span class="sxs-lookup"><span data-stu-id="f8370-159">Note how after 10 failed requests, the circuit breakers opens and no longer allows calls to the service.</span></span> <span data-ttu-id="f8370-160">Wartość CheckCircuit ustawiona na 30 sekund określa, jak często Biblioteka umożliwia przechodzenie do usługi za pomocą jednego żądania.</span><span class="sxs-lookup"><span data-stu-id="f8370-160">The CheckCircuit value, set at 30 seconds, specifies how often the library allows one request to proceed to the service.</span></span> <span data-ttu-id="f8370-161">Jeśli to wywołanie zakończy się pomyślnie, obwód zostanie zamknięty, a usługa zostanie ponownie udostępniona dla ruchu.</span><span class="sxs-lookup"><span data-stu-id="f8370-161">If that call succeeds, the circuit closes and the service is once again available to traffic.</span></span>

<span data-ttu-id="f8370-162">Należy pamiętać, że intencja wzorca wyłącznika *różni* się od wzorca ponawiania prób.</span><span class="sxs-lookup"><span data-stu-id="f8370-162">Keep in mind that the intent of the Circuit Breaker pattern is *different* than that of the Retry pattern.</span></span> <span data-ttu-id="f8370-163">Wzorzec ponawiania umożliwia aplikacji ponowienie próby wykonania operacji w oczekiwany sposób.</span><span class="sxs-lookup"><span data-stu-id="f8370-163">The Retry pattern enables an application to retry an operation in the expectation that it will succeed.</span></span> <span data-ttu-id="f8370-164">Wzorzec wyłącznika uniemożliwia aplikacji wykonywanie operacji, która prawdopodobnie nie powiedzie się.</span><span class="sxs-lookup"><span data-stu-id="f8370-164">The Circuit Breaker pattern prevents an application from doing an operation that is likely to fail.</span></span> <span data-ttu-id="f8370-165">Często aplikacja *łączy te dwa* wzorce przy użyciu wzorca ponawiania w celu wywołania operacji za pośrednictwem wyłącznika.</span><span class="sxs-lookup"><span data-stu-id="f8370-165">Often, an application will *combine* these two patterns by using the Retry pattern to invoke an operation through a circuit breaker.</span></span> <span data-ttu-id="f8370-166">Jednak logika ponawiania powinna być wrażliwa na wszystkie wyjątki zwrócone przez wyłącznik i porzucanie ponowień próby, jeśli wyłącznik wskazuje, że błąd nie jest przejściowy.</span><span class="sxs-lookup"><span data-stu-id="f8370-166">However, the retry logic should be sensitive to any exceptions returned by the circuit breaker and abandon retry attempts if the circuit breaker indicates that a fault isn't transient.</span></span>

<span data-ttu-id="f8370-167">Odporność aplikacji jest wymagana do obsługi problematycznych operacji.</span><span class="sxs-lookup"><span data-stu-id="f8370-167">Application resiliency is a must for handling problematic requested operations.</span></span> <span data-ttu-id="f8370-168">Ale jest to tylko połowa wątku.</span><span class="sxs-lookup"><span data-stu-id="f8370-168">But, it's only half of the story.</span></span> <span data-ttu-id="f8370-169">Następnie omówiono funkcje odporności dostępne w chmurze platformy Azure.</span><span class="sxs-lookup"><span data-stu-id="f8370-169">Next, we cover resiliency features available in the Azure cloud.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="f8370-170">[Poprzedni](resiliency.md)
>[Następny](infrastructure-resiliency-azure.md)</span><span class="sxs-lookup"><span data-stu-id="f8370-170">[Previous](resiliency.md)
[Next](infrastructure-resiliency-azure.md)</span></span>
