---
title: Zarządzanie wydajnością aplikacji — gRPC dla deweloperów WCF
description: Rejestrowanie, metryki i śledzenie dla ASP.NET Core aplikacji gRPC.
author: markrendle
ms.date: 09/02/2019
ms.openlocfilehash: 6ba67fd069e7efc232f912e50c0e283facb79e9c
ms.sourcegitcommit: 337bdc5a463875daf2cc6883e5a2da97d56f5000
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/24/2019
ms.locfileid: "72846722"
---
# <a name="application-performance-management"></a><span data-ttu-id="df49e-103">Zarządzanie wydajnością aplikacji</span><span class="sxs-lookup"><span data-stu-id="df49e-103">Application Performance Management</span></span>

<span data-ttu-id="df49e-104">W nowoczesnych środowiskach produkcyjnych, takich jak Kubernetes, bardzo ważne jest, aby monitorować aplikacje w celu zapewnienia optymalnego działania.</span><span class="sxs-lookup"><span data-stu-id="df49e-104">In modern production environments like Kubernetes, it's very important to be able to monitor applications to ensure they're running optimally.</span></span> <span data-ttu-id="df49e-105">Problemy, takie jak rejestrowanie i metryki, nigdy nie były ważniejsze.</span><span class="sxs-lookup"><span data-stu-id="df49e-105">Concerns like logging and metrics have never been more important.</span></span> <span data-ttu-id="df49e-106">ASP.NET Core, w tym gRPC, ma wbudowaną obsługę tworzenia komunikatów dziennika i danych metryk oraz zarządzania nimi, a także *śledzenia* danych.</span><span class="sxs-lookup"><span data-stu-id="df49e-106">ASP.NET Core, including gRPC, has first-class support for producing and managing log messages and metrics data, as well as *tracing* data.</span></span> <span data-ttu-id="df49e-107">Ta sekcja zawiera szczegółowe informacje dotyczące tych obszarów.</span><span class="sxs-lookup"><span data-stu-id="df49e-107">This section will explore these areas in more details.</span></span>

## <a name="logging-vs-metrics"></a><span data-ttu-id="df49e-108">Rejestrowanie metryk a</span><span class="sxs-lookup"><span data-stu-id="df49e-108">Logging vs Metrics</span></span>

<span data-ttu-id="df49e-109">Przed przejrzeniem szczegółów implementacji należy zrozumieć różnicę między rejestrowaniem i metrykami.</span><span class="sxs-lookup"><span data-stu-id="df49e-109">Before looking at the implementation details, it's necessary to understand the difference between logging and metrics.</span></span>

<span data-ttu-id="df49e-110">Rejestrowanie jest powiązane z wiadomościami tekstowymi, które rejestrują szczegółowe informacje o elementach, które wystąpiły w systemie.</span><span class="sxs-lookup"><span data-stu-id="df49e-110">Logging is concerned with text messages that record detailed information about things that have happened in the system.</span></span> <span data-ttu-id="df49e-111">Komunikaty dziennika mogą zawierać dane wyjątku, takie jak ślady stosu, lub dane strukturalne, które udostępniają kontekst o wiadomości.</span><span class="sxs-lookup"><span data-stu-id="df49e-111">Log messages may include exception data like stack traces, or structured data that provides context about the message.</span></span> <span data-ttu-id="df49e-112">Dane wyjściowe rejestrowania są często zapisywane w magazynie tekstu do przeszukiwania.</span><span class="sxs-lookup"><span data-stu-id="df49e-112">Logging output is commonly written to a searchable text store.</span></span>

<span data-ttu-id="df49e-113">Metryki odnoszą się do danych liczbowych, które są przeznaczone do agregowania i przedstawiane za pomocą wykresów i wykresów na pulpicie nawigacyjnym, który zapewnia widok ogólnej kondycji i wydajności aplikacji.</span><span class="sxs-lookup"><span data-stu-id="df49e-113">Metrics refers to numeric data that is designed to be aggregated and presented using charts and graphs in a dashboard that provides a view of the overall health and performance of an application.</span></span> <span data-ttu-id="df49e-114">Dane metryk mogą być również używane do wyzwalania automatycznych alertów w przypadku przekroczenia progu.</span><span class="sxs-lookup"><span data-stu-id="df49e-114">Metrics data can also be used to trigger automated alerts when a threshold is exceeded.</span></span> <span data-ttu-id="df49e-115">Na poniższej liście przedstawiono przykłady danych metryk:</span><span class="sxs-lookup"><span data-stu-id="df49e-115">The following list shows some examples of metrics data:</span></span>

- <span data-ttu-id="df49e-116">Czas przetwarzania żądań.</span><span class="sxs-lookup"><span data-stu-id="df49e-116">Time taken to process requests.</span></span>
- <span data-ttu-id="df49e-117">Liczba żądań na sekundę obsługiwanych przez wystąpienie usługi.</span><span class="sxs-lookup"><span data-stu-id="df49e-117">The number of requests per second being handled by an instance of a service.</span></span>
- <span data-ttu-id="df49e-118">Liczba żądań zakończonych niepowodzeniem w wystąpieniu.</span><span class="sxs-lookup"><span data-stu-id="df49e-118">The number of failed requests on an instance.</span></span>

## <a name="logging-in-aspnet-core-grpc"></a><span data-ttu-id="df49e-119">Logowanie w ASP.NET Core gRPC</span><span class="sxs-lookup"><span data-stu-id="df49e-119">Logging in ASP.NET Core gRPC</span></span>

<span data-ttu-id="df49e-120">ASP.NET Core zapewnia wbudowaną obsługę rejestrowania w postaci pakietu NuGet [Microsoft. Extensions. Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging) .</span><span class="sxs-lookup"><span data-stu-id="df49e-120">ASP.NET Core provides built-in support for logging, in the form of the [Microsoft.Extensions.Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging) NuGet package.</span></span> <span data-ttu-id="df49e-121">Podstawowe części tej biblioteki są dołączone do zestawu SDK sieci Web, więc nie trzeba instalować go ręcznie.</span><span class="sxs-lookup"><span data-stu-id="df49e-121">The core parts of this library are included with the Web SDK, so there's no need to install it manually.</span></span> <span data-ttu-id="df49e-122">Domyślnie komunikaty dziennika są zapisywane w standardowym wyjściu (konsoli) i w dowolnym dołączonym debugerze.</span><span class="sxs-lookup"><span data-stu-id="df49e-122">By default, log messages are written to the standard output (the "console") and to any attached debugger.</span></span> <span data-ttu-id="df49e-123">Aby pisać dzienniki do trwałych zewnętrznych magazynów danych, może zajść potrzeba zaimportowania [opcjonalnych pakietów ujścia rejestrowania](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0#third-party-logging-providers).</span><span class="sxs-lookup"><span data-stu-id="df49e-123">To write logs to persistent external data stores, you may need to import [optional logging sink packages](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0#third-party-logging-providers).</span></span>

<span data-ttu-id="df49e-124">ASP.NET Core gRPC Framework zapisuje szczegółowe komunikaty rejestrowania diagnostycznego do tej struktury rejestrowania, dzięki czemu mogą być przetwarzane/przechowywane wraz z własnymi komunikatami aplikacji.</span><span class="sxs-lookup"><span data-stu-id="df49e-124">The ASP.NET Core gRPC framework writes detailed diagnostic logging messages to this logging framework so they can be processed/stored along with your application's own messages.</span></span>

### <a name="produce-log-messages"></a><span data-ttu-id="df49e-125">Generowanie komunikatów dziennika</span><span class="sxs-lookup"><span data-stu-id="df49e-125">Produce log messages</span></span>

<span data-ttu-id="df49e-126">Rozszerzenie rejestrowania jest automatycznie rejestrowane w systemie ASP.NET Core, aby można było określić rejestratory jako parametr konstruktora dla typów usługi gRPC.</span><span class="sxs-lookup"><span data-stu-id="df49e-126">The logging extension is automatically registered with ASP.NET Core's dependency injection system, so you can specify loggers as a constructor parameter on gRPC service types.</span></span>

```csharp
public class StockData : Stocks.StocksBase
{
    private readonly ILogger<StockData> _logger;

    public StockData(ILogger<StockData> logger)
    {
        _logger = logger;
    }
}
```

<span data-ttu-id="df49e-127">Wiele komunikatów dziennika wokół żądań, wyjątków i tak dalej jest udostępnianych przez składniki ASP.NET Core i gRPC Framework.</span><span class="sxs-lookup"><span data-stu-id="df49e-127">Many log messages around requests, exceptions, and so on, are provided by the ASP.NET Core and gRPC framework components.</span></span> <span data-ttu-id="df49e-128">Dodawanie własnych wiadomości dziennika w celu zapewnienia szczegółowych informacji i kontekstu logiki aplikacji, a nie zagadnień niższego poziomu.</span><span class="sxs-lookup"><span data-stu-id="df49e-128">Add your own log messages to provide detail and context about application logic rather than lower-level concerns.</span></span>

<span data-ttu-id="df49e-129">Aby uzyskać więcej informacji na temat pisania komunikatów dziennika i dostępnych ujść i elementów docelowych rejestrowania, zobacz artykuł [Rejestrowanie w programie .NET Core i ASP.NET Core](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0) .</span><span class="sxs-lookup"><span data-stu-id="df49e-129">For more information about writing log messages and available logging sinks and targets, see the [Logging in .NET Core and ASP.NET Core](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0) article.</span></span>

## <a name="metrics-in-aspnet-core-grpc"></a><span data-ttu-id="df49e-130">Metryki w ASP.NET Core gRPC</span><span class="sxs-lookup"><span data-stu-id="df49e-130">Metrics in ASP.NET Core gRPC</span></span>

<span data-ttu-id="df49e-131">Środowisko uruchomieniowe programu .NET Core udostępnia zestaw składników służących do emitowania i obserwowania metryk, które obejmują interfejsy API, takie jak <xref:System.Diagnostics.Tracing.EventSource> i klasy <xref:System.Diagnostics.Tracing.EventCounter>.</span><span class="sxs-lookup"><span data-stu-id="df49e-131">The .NET Core runtime provides a set of components for emitting and observing metrics that includes APIs such as the <xref:System.Diagnostics.Tracing.EventSource> and <xref:System.Diagnostics.Tracing.EventCounter> classes.</span></span> <span data-ttu-id="df49e-132">Za pomocą tych interfejsów API można emitować podstawowe dane liczbowe, które mogą być używane przez procesy zewnętrzne, takie jak [globalne narzędzie liczników dotnet](https://github.com/dotnet/diagnostics/blob/master/documentation/dotnet-counters-instructions.md)lub śledzenie zdarzeń systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="df49e-132">These APIs can be used to emit basic numeric data that can be consumed by external processes like the [dotnet-counters global tool](https://github.com/dotnet/diagnostics/blob/master/documentation/dotnet-counters-instructions.md), or Event Tracing for Windows.</span></span> <span data-ttu-id="df49e-133">Aby uzyskać więcej informacji na temat używania `EventCounter` w własnym kodzie, zobacz samouczek [wprowadzenie do EventCounter](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.Tracing/documentation/EventCounterTutorial.md) .</span><span class="sxs-lookup"><span data-stu-id="df49e-133">For more information about using `EventCounter` in your own code, see the [EventCounter Introduction](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.Tracing/documentation/EventCounterTutorial.md) tutorial.</span></span>

<span data-ttu-id="df49e-134">W przypadku bardziej zaawansowanych metryk i zapisywania danych metryk w szerszym zakresie magazynów danych istnieje doskonały projekt typu "open source" o nazwie [metryki aplikacji](https://www.app-metrics.io).</span><span class="sxs-lookup"><span data-stu-id="df49e-134">For more advanced metrics and for writing metric data to a wider range of data stores, there's an excellent open-source project called [App Metrics](https://www.app-metrics.io).</span></span> <span data-ttu-id="df49e-135">Ten pakiet bibliotek zawiera rozbudowany zestaw typów służący do Instrumentacji kodu.</span><span class="sxs-lookup"><span data-stu-id="df49e-135">This suite of libraries provides an extensive set of types to instrument your code.</span></span> <span data-ttu-id="df49e-136">Oferuje również pakiety do zapisywania metryk do różnych rodzajów obiektów docelowych, które obejmują bazy danych szeregów czasowych, takich jak Prometheus i InfluxDB, [Azure Application Insights](https://docs.microsoft.com/azure/azure-monitor/app/app-insights-overview)i wiele innych.</span><span class="sxs-lookup"><span data-stu-id="df49e-136">It also offers packages to write metrics to different kinds of targets that include time-series databases, such as Prometheus and InfluxDB, [Azure Application Insights](https://docs.microsoft.com/azure/azure-monitor/app/app-insights-overview), and more.</span></span> <span data-ttu-id="df49e-137">Pakiet NuGet [App. Metrics. AspNetCore. MVC](https://www.nuget.org/packages/App.Metrics.AspNetCore.Mvc/) dodatkowo dodaje kompleksowy zestaw podstawowych metryk, które są automatycznie generowane przez integrację z platformą ASP.NET Core, a witryna sieci Web udostępnia [Szablony](https://www.app-metrics.io/samples/grafana/) do wyświetlania tych metryk za pomocą platformy wizualizacji [Grafana](https://grafana.com/) .</span><span class="sxs-lookup"><span data-stu-id="df49e-137">The [App.Metrics.AspNetCore.Mvc](https://www.nuget.org/packages/App.Metrics.AspNetCore.Mvc/) NuGet package even adds a comprehensive set of basic metrics that are automatically generated via integration with the ASP.NET Core framework, and the web site provides [templates](https://www.app-metrics.io/samples/grafana/) for displaying those metrics with the [Grafana](https://grafana.com/) visualization platform.</span></span>

<span data-ttu-id="df49e-138">Aby uzyskać więcej informacji i dokumentacji dotyczącej metryk aplikacji, zobacz witrynę sieci Web [App-Metrics.IO](https://app-metrics.io) .</span><span class="sxs-lookup"><span data-stu-id="df49e-138">For more information and documentation about App Metrics, see the [app-metrics.io](https://app-metrics.io) website.</span></span>

### <a name="produce-metrics"></a><span data-ttu-id="df49e-139">Tworzenie metryk</span><span class="sxs-lookup"><span data-stu-id="df49e-139">Produce metrics</span></span>

<span data-ttu-id="df49e-140">Większość platform metryk obsługuje pięć podstawowych typów metryk, które opisano w poniższej tabeli:</span><span class="sxs-lookup"><span data-stu-id="df49e-140">Most metrics platforms support five basic types of metric, outlined in the following table:</span></span>

| <span data-ttu-id="df49e-141">Typ metryki</span><span class="sxs-lookup"><span data-stu-id="df49e-141">Metric type</span></span> | <span data-ttu-id="df49e-142">Opis</span><span class="sxs-lookup"><span data-stu-id="df49e-142">Description</span></span> |
| ----------- | ----------- |
| <span data-ttu-id="df49e-143">Licznik</span><span class="sxs-lookup"><span data-stu-id="df49e-143">Counter</span></span>     | <span data-ttu-id="df49e-144">Śledzi, jak często coś się dzieje, takich jak żądania, błędy i tak dalej.</span><span class="sxs-lookup"><span data-stu-id="df49e-144">Tracks how often something happens, such as requests, errors, and so on.</span></span> |
| <span data-ttu-id="df49e-145">Urządzeń</span><span class="sxs-lookup"><span data-stu-id="df49e-145">Gauge</span></span>       | <span data-ttu-id="df49e-146">Rejestruje pojedynczą wartość, która zmienia się w czasie, na przykład aktywne połączenia.</span><span class="sxs-lookup"><span data-stu-id="df49e-146">Records a single value that changes over time, such as active connections.</span></span> |
| <span data-ttu-id="df49e-147">Razem</span><span class="sxs-lookup"><span data-stu-id="df49e-147">Histogram</span></span>   | <span data-ttu-id="df49e-148">Mierzy rozkład wartości w ramach dowolnych limitów.</span><span class="sxs-lookup"><span data-stu-id="df49e-148">Measures a distribution of values across arbitrary limits.</span></span> <span data-ttu-id="df49e-149">Na przykład histogram może śledzić rozmiar zestawu danych, zliczać, ile zawiera < 10 rekordów, liczbę 11-100 i 101-1000 i > 1000 rekordów.</span><span class="sxs-lookup"><span data-stu-id="df49e-149">For example, a histogram could track data set size, counting how many contained <10 records, how many 11-100 and 101-1000, and >1000 records.</span></span> |
| <span data-ttu-id="df49e-150">Wyższy</span><span class="sxs-lookup"><span data-stu-id="df49e-150">Meter</span></span>       | <span data-ttu-id="df49e-151">Mierzy szybkość, z jaką zdarzenie występuje w różnych przedziałach czasowych.</span><span class="sxs-lookup"><span data-stu-id="df49e-151">Measures the rate at which an event occurs in various time spans.</span></span> |
| <span data-ttu-id="df49e-152">Czasomierz</span><span class="sxs-lookup"><span data-stu-id="df49e-152">Timer</span></span>       | <span data-ttu-id="df49e-153">Śledzi czas trwania zdarzeń i szybkość ich występowania, przechowywane jako histogram.</span><span class="sxs-lookup"><span data-stu-id="df49e-153">Tracks the duration of events and the rate at which it occurs, stored as a histogram.</span></span> |

<span data-ttu-id="df49e-154">Korzystając z *metryk aplikacji*, interfejs `IMetrics` może zostać uzyskany za pośrednictwem iniekcji zależności i używany do rejestrowania dowolnej z tych metryk dla usługi gRPC.</span><span class="sxs-lookup"><span data-stu-id="df49e-154">Using *App Metrics*, an `IMetrics` interface can be obtained via dependency injection and used to record any of these metrics for a gRPC service.</span></span> <span data-ttu-id="df49e-155">Poniższy przykład pokazuje, jak zliczyć liczbę `Get` żądań wykonywanych w czasie:</span><span class="sxs-lookup"><span data-stu-id="df49e-155">The following example shows how to count the number of `Get` requests made over time:</span></span>

```csharp
public class StockData : Stocks.StocksBase
{
    private static readonly CounterOptions GetRequestCounter = new CounterOptions
    {
        Name = "StockData_Get_Requests",
        MeasurementUnit = Unit.Calls
    };

    private readonly IStockRepository _repository;
    private readonly IMetrics _metrics;

    public StockData(IStockRepository repository, IMetrics metrics)
    {
        _repository = repository;
        _metrics = metrics;
    }

    public override async Task<GetResponse> Get(GetRequest request, ServerCallContext context)
    {
        _metrics.Measure.Counter.Increment(GetRequestCounter);

        // Serve request...
    }
}
```

### <a name="store-and-visualize-metrics-data"></a><span data-ttu-id="df49e-156">Przechowywanie i Wizualizacja danych metryk</span><span class="sxs-lookup"><span data-stu-id="df49e-156">Store and visualize metrics data</span></span>

<span data-ttu-id="df49e-157">Najlepszym sposobem przechowywania danych metryk znajduje się w *bazie danych szeregów czasowych*, wyspecjalizowany magazyn danych przeznaczony do rejestrowania liczbowych serii danych oznaczonych sygnaturami czasowymi.</span><span class="sxs-lookup"><span data-stu-id="df49e-157">The best way to store metrics data is in a *time-series database*, a specialized data store designed to record numerical data series marked with timestamps.</span></span> <span data-ttu-id="df49e-158">Najpopularniejsze bazy danych to [Prometheus](https://prometheus.io/) i [InfluxDB](https://www.influxdata.com/products/influxdb-overview/).</span><span class="sxs-lookup"><span data-stu-id="df49e-158">The most popular of these databases are [Prometheus](https://prometheus.io/) and [InfluxDB](https://www.influxdata.com/products/influxdb-overview/).</span></span> <span data-ttu-id="df49e-159">Microsoft Azure udostępnia również dedykowany magazyn metryk za pomocą usługi [Azure monitor](https://docs.microsoft.com/azure/azure-monitor/overview) .</span><span class="sxs-lookup"><span data-stu-id="df49e-159">Microsoft Azure also provides dedicated metrics storage through the [Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/overview) service.</span></span>

<span data-ttu-id="df49e-160">Obecne rozwiązanie do wizualizacji danych metryk to [Grafana](https://grafana.com), które współpracuje z szeroką gamę dostawców magazynu, w tym Azure monitor, InfluxDB i Prometheus.</span><span class="sxs-lookup"><span data-stu-id="df49e-160">The current go-to solution for visualizing metrics data is [Grafana](https://grafana.com), which works with a wide range of storage providers including Azure Monitor, InfluxDB and Prometheus.</span></span> <span data-ttu-id="df49e-161">Na poniższej ilustracji przedstawiono przykładowy pulpit nawigacyjny Grafana, w którym są wyświetlane metryki z sieci łączącej usługi z uruchomioną próbą StockData:</span><span class="sxs-lookup"><span data-stu-id="df49e-161">The following image shows an example Grafana dashboard that displays metrics from the Linkerd service mesh running the StockData sample:</span></span>

![Pulpit nawigacyjny Grafana](media/application-performance-management/grafana-screenshot.png)

### <a name="metrics-based-alerting"></a><span data-ttu-id="df49e-163">Alerty oparte na metrykach</span><span class="sxs-lookup"><span data-stu-id="df49e-163">Metrics-based alerting</span></span>

<span data-ttu-id="df49e-164">Liczbowy charakter danych metryk oznacza, że jest to idealne rozwiązanie w przypadku systemów ostrzegających o alertach, które są przeznaczone dla deweloperów lub inżynierów pomocy technicznej, gdy wartość wykracza poza pewną określoną tolerancję.</span><span class="sxs-lookup"><span data-stu-id="df49e-164">The numerical nature of metrics data means that it's ideally suited to drive alerting systems, notifying developers or support engineers when a value falls outside of some defined tolerance.</span></span> <span data-ttu-id="df49e-165">Już wspomniane platformy zapewniają obsługę alertów za pośrednictwem różnych opcji, w tym wiadomości e-mail, wiadomości SMS lub wizualizacji w pulpicie nawigacyjnym.</span><span class="sxs-lookup"><span data-stu-id="df49e-165">The platforms already mentioned all provide support for alerting via a range of options, including emails, text messages, or in-dashboard visualizations.</span></span>

## <a name="distributed-tracing"></a><span data-ttu-id="df49e-166">Śledzenie rozproszone</span><span class="sxs-lookup"><span data-stu-id="df49e-166">Distributed tracing</span></span>

<span data-ttu-id="df49e-167">*Śledzenie rozproszone* to stosunkowo niedawne programowanie w zakresie monitorowania, które powstało na podstawie zwiększenia użycia mikrousług i rozproszonych architektur.</span><span class="sxs-lookup"><span data-stu-id="df49e-167">*Distributed tracing* is a relatively recent development in monitoring, which has arisen from the increasing use of microservices and distributed architectures.</span></span> <span data-ttu-id="df49e-168">Pojedyncze żądanie z przeglądarki klienta, aplikacji lub urządzenia mogą być podzielone na wiele kroków i żądań podrzędnych oraz korzystać z wielu usług w sieci.</span><span class="sxs-lookup"><span data-stu-id="df49e-168">A single request from a client browser, application, or device may be broken down into many steps and sub-requests, and involve the use of many services across a network.</span></span> <span data-ttu-id="df49e-169">Utrudnia to skorelowanie komunikatów dziennika i metryk z konkretnym żądaniem, które je wywołało.</span><span class="sxs-lookup"><span data-stu-id="df49e-169">This makes it difficult to correlate log messages and metrics with the specific request that triggered them.</span></span> <span data-ttu-id="df49e-170">Śledzenie rozproszone stosuje identyfikatory do żądań, które umożliwiają skorelowanie dzienników i metryk z konkretną operacją.</span><span class="sxs-lookup"><span data-stu-id="df49e-170">Distributed tracing applies identifiers to requests that allow logs and metrics to be correlated with a particular operation.</span></span> <span data-ttu-id="df49e-171">Jest to podobne do [kompleksowego śledzenia usługi WCF](https://docs.microsoft.com/dotnet/framework/wcf/diagnostics/tracing/end-to-end-tracing), ale jest stosowane na wielu platformach.</span><span class="sxs-lookup"><span data-stu-id="df49e-171">This is similar to [WCF's end-to-end tracing](https://docs.microsoft.com/dotnet/framework/wcf/diagnostics/tracing/end-to-end-tracing), but applied across multiple platforms.</span></span>

<span data-ttu-id="df49e-172">Mimo że nadal jest obszar technologii Nascent, rozproszone śledzenie szybko się rozwinęło i przechodzą przez proces normalizacji.</span><span class="sxs-lookup"><span data-stu-id="df49e-172">Although it's still a nascent technology area, distributed tracing has grown quickly in popularity and is now going through a standardization process.</span></span> <span data-ttu-id="df49e-173">Natywna platforma obliczeniowa w chmurze stworzyła [model śledzenia Open](https://opentracing.io), próbując udostępnić niezależnym od dostawcy biblioteki do pracy z założeniami, takimi jak [Jaeger](https://www.jaegertracing.io/) i [elastyczny system APM](https://www.elastic.co/products/apm).</span><span class="sxs-lookup"><span data-stu-id="df49e-173">The Cloud Native Computing Foundation created the [the Open Tracing standard](https://opentracing.io), attempting to provide vendor-neutral libraries for working with backends like [Jaeger](https://www.jaegertracing.io/) and [Elastic APM](https://www.elastic.co/products/apm).</span></span> <span data-ttu-id="df49e-174">W tym samym czasie, firma Google utworzyła [projekt OpenCensus](https://opencensus.io/) w celu rozwiązania tego samego zestawu problemów.</span><span class="sxs-lookup"><span data-stu-id="df49e-174">At the same time, Google created the [OpenCensus project](https://opencensus.io/) to address the same set of problems.</span></span> <span data-ttu-id="df49e-175">Te dwa projekty są teraz scalane do nowego projektu, [OpenTelemetry](https://opentelemetry.io), który ma być przyszłym standardem branżowym.</span><span class="sxs-lookup"><span data-stu-id="df49e-175">These two projects are now being merged into a new project, [OpenTelemetry](https://opentelemetry.io), which aims to be the future industry standard.</span></span>

### <a name="how-distributed-tracing-works"></a><span data-ttu-id="df49e-176">Jak działa śledzenie rozproszone</span><span class="sxs-lookup"><span data-stu-id="df49e-176">How distributed tracing works</span></span>

<span data-ttu-id="df49e-177">Śledzenie rozproszone opiera się na koncepcji *zakresów*: nazwanych, czasochłonnych operacjach, które są częścią pojedynczego *śledzenia*, co może obejmować przetwarzanie na wielu węzłach systemu.</span><span class="sxs-lookup"><span data-stu-id="df49e-177">Distributed tracing is based on the concept of *Spans*: named, timed operations that are part of a single *Trace*, which may involve processing on multiple nodes of a system.</span></span> <span data-ttu-id="df49e-178">Po zainicjowaniu nowej operacji jest tworzony ślad z unikatowym identyfikatorem.</span><span class="sxs-lookup"><span data-stu-id="df49e-178">When a new operation is initiated, a trace is created with a unique identifier.</span></span> <span data-ttu-id="df49e-179">Dla każdej operacji podrzędnej zakres jest tworzony z własnym identyfikatorem i identyfikatorem śledzenia.</span><span class="sxs-lookup"><span data-stu-id="df49e-179">For each sub-operation, a span is created with its own identifier and trace identifier.</span></span> <span data-ttu-id="df49e-180">Gdy żądanie przebiega w systemie, różne składniki mogą tworzyć zakresy *podrzędne* , które zawierają identyfikator ich *elementu nadrzędnego*.</span><span class="sxs-lookup"><span data-stu-id="df49e-180">As the request passes around the system, various components can create *child* spans that include the identifier of their *parent*.</span></span> <span data-ttu-id="df49e-181">Zakres ma *kontekst*, który zawiera identyfikatory śledzenia i zakresu, a także przydatne dane w postaci par klucz/wartość (zwany *bagażem*).</span><span class="sxs-lookup"><span data-stu-id="df49e-181">A span has a *context*, which contains the trace and span identifiers, as well as useful data in the form of key/value pairs (called *baggage*).</span></span>

### <a name="distributed-tracing-with-diagnosticsource"></a><span data-ttu-id="df49e-182">Śledzenie rozproszone z DiagnosticSource</span><span class="sxs-lookup"><span data-stu-id="df49e-182">Distributed tracing with DiagnosticSource</span></span>

<span data-ttu-id="df49e-183">Platforma .NET Core ma wewnętrzny moduł, który jest dobrze mapowany do dystrybuowanych śladów i zakresów: [DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#diagnosticsource-users-guide).</span><span class="sxs-lookup"><span data-stu-id="df49e-183">.NET Core has an internal module that maps well to distributed traces and spans: [DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#diagnosticsource-users-guide).</span></span> <span data-ttu-id="df49e-184">Jak również zapewnić prostą metodę tworzenia i korzystania z diagnostyki w ramach procesu, moduł `DiagnosticSource` ma koncepcję *działania*, która jest efektywnie implementacją rozproszonego śledzenia lub zakresu w śladzie.</span><span class="sxs-lookup"><span data-stu-id="df49e-184">As well as providing a simple way to produce and consume diagnostics within a process, the `DiagnosticSource` module has the concept of an *Activity*, which is effectively an implementation of a distributed trace, or a span within a trace.</span></span> <span data-ttu-id="df49e-185">Elementy wewnętrzne modułu wykorzystują działania nadrzędne i podrzędne, w tym przydzielanie identyfikatorów.</span><span class="sxs-lookup"><span data-stu-id="df49e-185">The internals of the module take care of parent/child activities, including allocating identifiers.</span></span> <span data-ttu-id="df49e-186">Więcej informacji o używaniu typu `Activity` można znaleźć w [podręczniku użytkownika działania w witrynie GitHub](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-user-guide)</span><span class="sxs-lookup"><span data-stu-id="df49e-186">For more information about using the `Activity` type, see the [Activity User Guide on GitHub](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-user-guide)</span></span>

<span data-ttu-id="df49e-187">Ponieważ DiagnosticSource jest częścią podstawowego środowiska, jest obsługiwana przez kilka podstawowych składników, w tym <xref:System.Net.Http.HttpClient>, Entity Framework Core i ASP.NET Core, w tym z jawną obsługą w strukturze gRPC.</span><span class="sxs-lookup"><span data-stu-id="df49e-187">Because DiagnosticSource is a part of the core framework, it's supported by several core components, including <xref:System.Net.Http.HttpClient>, Entity Framework Core and ASP.NET Core, including explicit support in the gRPC framework.</span></span> <span data-ttu-id="df49e-188">Gdy ASP.NET Core odbiera żądanie, sprawdza parę nagłówków HTTP zgodnych ze standardem [kontekstu śledzenia W3C](https://www.w3.org/TR/trace-context) .</span><span class="sxs-lookup"><span data-stu-id="df49e-188">When ASP.NET Core receives a request, it  checks for a pair of HTTP headers matching the [W3C Trace Context](https://www.w3.org/TR/trace-context) standard.</span></span> <span data-ttu-id="df49e-189">Jeśli nagłówki zostaną znalezione, działanie jest uruchamiane przy użyciu wartości tożsamości i kontekstu z nagłówków.</span><span class="sxs-lookup"><span data-stu-id="df49e-189">If the headers are found, an Activity is started using the identity values and context from the headers.</span></span> <span data-ttu-id="df49e-190">Jeśli nie zostaną znalezione żadne nagłówki, działanie jest uruchamiane z wygenerowanymi wartościami tożsamości, które pasują do formatu standardowego.</span><span class="sxs-lookup"><span data-stu-id="df49e-190">If no headers are found, an Activity is started with generated identity values that match the standard format.</span></span> <span data-ttu-id="df49e-191">Wszystkie diagnostyki generowane przez platformę lub przez kod aplikacji w okresie istnienia tego działania mogą być otagowane przy użyciu identyfikatorów śledzenia i zakresu.</span><span class="sxs-lookup"><span data-stu-id="df49e-191">Any diagnostics generated by the framework or by application code during the lifetime of this Activity can be tagged with the trace and span identifiers.</span></span> <span data-ttu-id="df49e-192">Pomoc techniczna `HttpClient` rozszerza to więcej, sprawdzając, czy są obecne działania na każdym żądaniu i automatycznie dodając nagłówki śledzenia do żądania wychodzącego.</span><span class="sxs-lookup"><span data-stu-id="df49e-192">The `HttpClient` support extends this further by checking for a current Activity on every request and automatically adding the trace headers to the outgoing request.</span></span>

<span data-ttu-id="df49e-193">Biblioteka gRPC klienta i serwera zawiera jawną obsługę DiagnosticSource i działania, a ASP.NET Core także tworzy działania i automatycznie stosuje informacje nagłówka.</span><span class="sxs-lookup"><span data-stu-id="df49e-193">The ASP.NET Core gRPC client and server libraries include explicit support for DiagnosticSource and Activity, and will create activities and apply and use header information automatically.</span></span>

> [!NOTE]
> <span data-ttu-id="df49e-194">Wszystko to występuje tylko wtedy, gdy *odbiornik* zużywa informacje diagnostyczne.</span><span class="sxs-lookup"><span data-stu-id="df49e-194">All of this only happens if a *listener* is consuming the diagnostic information.</span></span> <span data-ttu-id="df49e-195">Jeśli nie ma odbiornika, Diagnostyka nie jest zapisywana i żadne działania nie są tworzone.</span><span class="sxs-lookup"><span data-stu-id="df49e-195">If there's no listener, no diagnostics are written and no activities are created.</span></span>

### <a name="add-your-own-diagnosticsources-and-activities"></a><span data-ttu-id="df49e-196">Dodawanie własnych DiagnosticSources i działań</span><span class="sxs-lookup"><span data-stu-id="df49e-196">Add your own DiagnosticSources and Activities</span></span>

<span data-ttu-id="df49e-197">Mimo że dobra ilość danych jest generowana automatycznie przez ASP.NET Core, w tym gRPC, a także Entity Framework Core i `HttpClient`, można dodać własną diagnostykę lub utworzyć jawne zakresy w kodzie aplikacji.</span><span class="sxs-lookup"><span data-stu-id="df49e-197">Although a good quantity of data is automatically generated by ASP.NET Core, including gRPC, as well as Entity Framework Core and `HttpClient`, you may wish to add your own diagnostics or create explicit spans within your application code.</span></span> <span data-ttu-id="df49e-198">Aby uzyskać szczegółowe informacje na temat implementowania własnej diagnostyki, zapoznaj się z podręcznikiem użytkownika [DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#instrumenting-with-diagnosticsourcediagnosticlistener) i [podręcznikiem użytkownika](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-usage) dotyczącym działania.</span><span class="sxs-lookup"><span data-stu-id="df49e-198">Refer to the [DiagnosticSource User Guide](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#instrumenting-with-diagnosticsourcediagnosticlistener) and [Activity User Guide](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-usage) for details on how to implement your own diagnostics.</span></span>

### <a name="store-distributed-trace-data"></a><span data-ttu-id="df49e-199">Przechowywanie danych śledzenia rozproszonego</span><span class="sxs-lookup"><span data-stu-id="df49e-199">Store distributed trace data</span></span>

<span data-ttu-id="df49e-200">W momencie pisania projektu OpenTelemetry jest nadal na wczesnych etapach i dostępne są tylko pakiety z jakością alfa dla aplikacji .NET.</span><span class="sxs-lookup"><span data-stu-id="df49e-200">At the time of writing the OpenTelemetry project is still in the early stages, and only alpha-quality packages are available for .NET applications.</span></span> <span data-ttu-id="df49e-201">Projekt OpenTracing oferuje bardziej dojrzałe biblioteki, ale zostaną one zastąpione przez biblioteki OpenTelemetry w przyszłości.</span><span class="sxs-lookup"><span data-stu-id="df49e-201">The OpenTracing project offers more mature libraries, but these will be superseded by the OpenTelemetry libraries in the future.</span></span>

<span data-ttu-id="df49e-202">Interfejs API OpenTracing został opisany poniżej.</span><span class="sxs-lookup"><span data-stu-id="df49e-202">The OpenTracing API is described below.</span></span> <span data-ttu-id="df49e-203">Jeśli wolisz używać nowszego interfejsu API OpenTelemetry w aplikacji, zapoznaj się z [repozytorium zestawu SDK platformy .NET OpenTelemetry w witrynie GitHub](https://github.com/open-telemetry/opentelemetry-dotnet).</span><span class="sxs-lookup"><span data-stu-id="df49e-203">If you would prefer to use the newer OpenTelemetry API in your application, refer to the [OpenTelemetry .NET SDK repository on GitHub](https://github.com/open-telemetry/opentelemetry-dotnet).</span></span>

#### <a name="use-the-opentracing-package-to-store-distributed-trace-data"></a><span data-ttu-id="df49e-204">Przechowywanie danych śledzenia rozproszonego przy użyciu pakietu OpenTracing</span><span class="sxs-lookup"><span data-stu-id="df49e-204">Use the OpenTracing package to store distributed trace data</span></span>

<span data-ttu-id="df49e-205">[Pakiet NuGet OpenTracing](https://www.nuget.org/packages/OpenTracing/) , który obsługuje wszystkie plecze zgodne z OpenTracing (które mogą być używane niezależnie od `DiagnosticSource`).</span><span class="sxs-lookup"><span data-stu-id="df49e-205">The [an OpenTracing NuGet package](https://www.nuget.org/packages/OpenTracing/) that supports all OpenTracing-compliant back-ends (which can be used independently of `DiagnosticSource`).</span></span> <span data-ttu-id="df49e-206">Istnieje dodatkowy pakiet z projektu OpenTracing API [OpenTracing. contrib. Core](https://www.nuget.org/packages/OpenTracing.Contrib.NetCore/), który dodaje odbiornik `DiagnosticSource` i automatycznie zapisuje zdarzenia i działania na zapleczu.</span><span class="sxs-lookup"><span data-stu-id="df49e-206">There's an additional package from the OpenTracing API Contributions project, [OpenTracing.Contrib.NetCore](https://www.nuget.org/packages/OpenTracing.Contrib.NetCore/), which adds a `DiagnosticSource` listener and writes events and activities to a back-end automatically.</span></span> <span data-ttu-id="df49e-207">Włączenie tego pakietu jest proste, ponieważ instalowanie go z narzędzia NuGet i dodawanie go jako usługi w klasie `Startup`.</span><span class="sxs-lookup"><span data-stu-id="df49e-207">Enabling this package is as simple as installing it from NuGet and adding it as a service in your `Startup` class.</span></span>

```csharp
public class Startup
{
    public void ConfigureServices(IServiceCollection services)
    {
        services.AddOpenTracing();
    }
}
```

<span data-ttu-id="df49e-208">Pakiet OpenTracing jest warstwą abstrakcji i w związku z tym wymaga implementacji specyficznej dla zaplecza.</span><span class="sxs-lookup"><span data-stu-id="df49e-208">The OpenTracing package is an abstraction layer and as such it requires a back-end-specific implementation.</span></span> <span data-ttu-id="df49e-209">Implementacje interfejsu API OpenTracing są dostępne dla następujących zaplecza Open Source.</span><span class="sxs-lookup"><span data-stu-id="df49e-209">OpenTracing API implementations are available for the following open source back-ends.</span></span>

| <span data-ttu-id="df49e-210">Nazwa</span><span class="sxs-lookup"><span data-stu-id="df49e-210">Name</span></span> | <span data-ttu-id="df49e-211">Package</span><span class="sxs-lookup"><span data-stu-id="df49e-211">Package</span></span> | <span data-ttu-id="df49e-212">Witryna sieci Web</span><span class="sxs-lookup"><span data-stu-id="df49e-212">Web site</span></span> |
| ---- | ------- | -------- |
| <span data-ttu-id="df49e-213">Jaeger</span><span class="sxs-lookup"><span data-stu-id="df49e-213">Jaeger</span></span> | [<span data-ttu-id="df49e-214">Jaeger</span><span class="sxs-lookup"><span data-stu-id="df49e-214">Jaeger</span></span>](https://www.nuget.org/packages/Jaeger/) | [<span data-ttu-id="df49e-215">jaegertracing.io</span><span class="sxs-lookup"><span data-stu-id="df49e-215">jaegertracing.io</span></span>](https://jaegertracing.io) |
| <span data-ttu-id="df49e-216">Elastyczny system APM</span><span class="sxs-lookup"><span data-stu-id="df49e-216">Elastic APM</span></span> | [<span data-ttu-id="df49e-217">Elastyczny. APM. NetCoreAll</span><span class="sxs-lookup"><span data-stu-id="df49e-217">Elastic.Apm.NetCoreAll</span></span>](https://www.nuget.org/packages/Elastic.Apm.NetCoreAll/) | [<span data-ttu-id="df49e-218">elastic.co/products/apm</span><span class="sxs-lookup"><span data-stu-id="df49e-218">elastic.co/products/apm</span></span>](https://www.elastic.co/products/apm) |

<span data-ttu-id="df49e-219">Aby uzyskać więcej informacji na temat interfejsu API OpenTracing dla platformy .NET, zobacz [OpenTracing for C# ](https://github.com/opentracing/opentracing-csharp) i [OpenTracing C#contrib/.NET Core](https://github.com/opentracing-contrib/csharp-netcore) w witrynie GitHub.</span><span class="sxs-lookup"><span data-stu-id="df49e-219">For more information on the OpenTracing API for .NET, see the [OpenTracing for C#](https://github.com/opentracing/opentracing-csharp) and the [OpenTracing Contrib C#/.NET Core](https://github.com/opentracing-contrib/csharp-netcore) repositories on GitHub.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="df49e-220">[Poprzedni](load-balancing.md)
>[Następny](appendix.md)</span><span class="sxs-lookup"><span data-stu-id="df49e-220">[Previous](load-balancing.md)
[Next](appendix.md)</span></span>
