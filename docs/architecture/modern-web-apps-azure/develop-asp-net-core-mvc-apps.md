---
title: Opracowywanie aplikacji ASP.NET Core MVC
description: Tworzenie architektury nowoczesnych aplikacji sieci Web przy użyciu ASP.NET Core i platformy Azure | opracowywanie aplikacji ASP.NET Core MVC
author: ardalis
ms.author: wiwagn
ms.date: 12/01/2020
no-loc:
- Blazor
- WebAssembly
ms.openlocfilehash: c0fc92b2dbc25a1a48e0264b64c79fc8631fa8f0
ms.sourcegitcommit: 81f1bba2c97a67b5ca76bcc57b37333ffca60c7b
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 12/10/2020
ms.locfileid: "97009667"
---
# <a name="develop-aspnet-core-mvc-apps"></a><span data-ttu-id="bd286-103">Opracowywanie aplikacji ASP.NET Core MVC</span><span class="sxs-lookup"><span data-stu-id="bd286-103">Develop ASP.NET Core MVC apps</span></span>

> <span data-ttu-id="bd286-104">"Nie jest ważne, aby pobrać go po raz pierwszy.</span><span class="sxs-lookup"><span data-stu-id="bd286-104">"It's not important to get it right the first time.</span></span> <span data-ttu-id="bd286-105">Bardzo ważne jest, aby uzyskać je po raz ostatni. "</span><span class="sxs-lookup"><span data-stu-id="bd286-105">It's vitally important to get it right the last time."</span></span>
> <span data-ttu-id="bd286-106">_— Andrew polowa i David Thomas_</span><span class="sxs-lookup"><span data-stu-id="bd286-106">_- Andrew Hunt and David Thomas_</span></span>

<span data-ttu-id="bd286-107">ASP.NET Core to międzyplatformowa platforma typu "open source" służąca do tworzenia nowoczesnych aplikacji sieci Web zoptymalizowanych pod kątem chmury.</span><span class="sxs-lookup"><span data-stu-id="bd286-107">ASP.NET Core is a cross-platform, open-source framework for building modern cloud-optimized web applications.</span></span> <span data-ttu-id="bd286-108">Aplikacje ASP.NET Core są lekkie i modularne, dzięki wbudowanej obsłudze iniekcji zależności, co pozwala zwiększyć możliwości testowania i utrzymania.</span><span class="sxs-lookup"><span data-stu-id="bd286-108">ASP.NET Core apps are lightweight and modular, with built-in support for dependency injection, enabling greater testability and maintainability.</span></span> <span data-ttu-id="bd286-109">W połączeniu z platformą MVC, która obsługuje tworzenie nowoczesnych interfejsów API sieci Web oprócz aplikacji opartych na widoku, ASP.NET Core to zaawansowana platforma, w której można tworzyć aplikacje sieci Web dla przedsiębiorstw.</span><span class="sxs-lookup"><span data-stu-id="bd286-109">Combined with MVC, which supports building modern web APIs in addition to view-based apps, ASP.NET Core is a powerful framework with which to build enterprise web applications.</span></span>

## <a name="mvc-and-razor-pages"></a><span data-ttu-id="bd286-110">MVC i Razor Pages</span><span class="sxs-lookup"><span data-stu-id="bd286-110">MVC and Razor Pages</span></span>

<span data-ttu-id="bd286-111">ASP.NET Core MVC oferuje wiele funkcji, które są przydatne do tworzenia interfejsów API i aplikacji opartych na sieci Web.</span><span class="sxs-lookup"><span data-stu-id="bd286-111">ASP.NET Core MVC offers many features that are useful for building web-based APIs and apps.</span></span> <span data-ttu-id="bd286-112">Termin MVC oznacza "Model-View-Controller", wzorzec interfejsu użytkownika, który dzieli obowiązki odpowiedzi na żądania użytkowników do kilku części.</span><span class="sxs-lookup"><span data-stu-id="bd286-112">The term MVC stands for "Model-View-Controller", a UI pattern that breaks up the responsibilities of responding to user requests into several parts.</span></span> <span data-ttu-id="bd286-113">Oprócz tego wzorca można także zaimplementować funkcje w ASP.NET Core aplikacji jako Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="bd286-113">In addition to following this pattern, you can also implement features in your ASP.NET Core apps as Razor Pages.</span></span> <span data-ttu-id="bd286-114">Razor Pages są wbudowane w ASP.NET Core MVC i używają tych samych funkcji routingu, powiązania modelu, filtrów, autoryzacji itp. Jednak zamiast oddzielnych folderów i plików dla kontrolerów, modeli, widoków itp. i używania routingu opartego na atrybutach Razor Pages są umieszczane w pojedynczym folderze ("/Pages"), trasie na podstawie ich lokalizacji względnej w tym folderze i obsługi żądań z obsługą, a nie akcją kontrolera.</span><span class="sxs-lookup"><span data-stu-id="bd286-114">Razor Pages are built into ASP.NET Core MVC, and use the same features for routing, model binding, filters, authorization, etc. However, instead of having separate folders and files for Controllers, Models, Views, etc. and using attribute-based routing, Razor Pages are placed in a single folder ("/Pages"), route based on their relative location in this folder, and handle requests with handlers instead of controller actions.</span></span> <span data-ttu-id="bd286-115">W związku z tym podczas pracy z Razor Pages wszystkie potrzebne pliki i klasy są zwykle współzlokalizowane, a nie rozłożone w całym projekcie sieci Web.</span><span class="sxs-lookup"><span data-stu-id="bd286-115">As a result, when working with Razor Pages, all of the files and classes you need are typically colocated, not spread throughout the web project.</span></span>

<span data-ttu-id="bd286-116">Podczas tworzenia nowej aplikacji ASP.NET Core należy mieć plan na uwadze dla rodzaju aplikacji, którą chcesz skompilować.</span><span class="sxs-lookup"><span data-stu-id="bd286-116">When you create a new ASP.NET Core App, you should have a plan in mind for the kind of app you want to build.</span></span> <span data-ttu-id="bd286-117">W programie Visual Studio będziesz wybierać spośród kilku szablonów.</span><span class="sxs-lookup"><span data-stu-id="bd286-117">In Visual Studio, you'll choose from several templates.</span></span> <span data-ttu-id="bd286-118">Trzy najpopularniejsze szablony projektów to Web API, aplikacja sieci Web i aplikacja sieci Web (Model-View-Controller).</span><span class="sxs-lookup"><span data-stu-id="bd286-118">The three most common project templates are Web API, Web Application, and Web Application (Model-View-Controller).</span></span> <span data-ttu-id="bd286-119">Chociaż tę decyzję można podjąć tylko podczas pierwszego tworzenia projektu, nie jest to nieodwołalna decyzja.</span><span class="sxs-lookup"><span data-stu-id="bd286-119">Although you can only make this decision when you first create a project, it's not an irrevocable decision.</span></span> <span data-ttu-id="bd286-120">Projekt interfejsu API sieci Web używa standardowych kontrolerów kontrolera widoku modelu — tylko domyślnie nie ma widoków.</span><span class="sxs-lookup"><span data-stu-id="bd286-120">The Web API project uses standard Model-View-Controller controllers – it just lacks Views by default.</span></span> <span data-ttu-id="bd286-121">Podobnie szablon domyślnej aplikacji sieci Web używa Razor Pages, a zatem nie ma folderu widoki.</span><span class="sxs-lookup"><span data-stu-id="bd286-121">Likewise, the default Web Application template uses Razor Pages, and so also lacks a Views folder.</span></span> <span data-ttu-id="bd286-122">Możesz później dodać folder widoki do tych projektów, aby obsługiwać zachowanie oparte na widoku.</span><span class="sxs-lookup"><span data-stu-id="bd286-122">You can add a Views folder to these projects later to support view-based behavior.</span></span> <span data-ttu-id="bd286-123">Projekty Web API i Model-View-Controller nie zawierają domyślnie folderu Pages, ale można je później dodać do obsługi zachowania opartego na Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="bd286-123">Web API and Model-View-Controller projects don't include a Pages folder by default, but you can add one later to support Razor Pages-based behavior.</span></span> <span data-ttu-id="bd286-124">Te trzy szablony można traktować jako obsługujące trzy różne rodzaje domyślnej interakcji użytkownika: dane (internetowy interfejs API), oparte na stronach i widoku.</span><span class="sxs-lookup"><span data-stu-id="bd286-124">You can think of these three templates as supporting three different kinds of default user interaction: data (web API), page-based, and view-based.</span></span> <span data-ttu-id="bd286-125">Można jednak mieszać i dopasować dowolne lub wszystkie z tych szablonów w ramach pojedynczego projektu, jeśli chcesz.</span><span class="sxs-lookup"><span data-stu-id="bd286-125">However, you can mix and match any or all of these templates within a single project if you wish.</span></span>

### <a name="why-razor-pages"></a><span data-ttu-id="bd286-126">Dlaczego Razor Pages?</span><span class="sxs-lookup"><span data-stu-id="bd286-126">Why Razor Pages?</span></span>

<span data-ttu-id="bd286-127">Razor Pages to domyślne podejście do nowych aplikacji sieci Web w programie Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="bd286-127">Razor Pages is the default approach for new web applications in Visual Studio.</span></span> <span data-ttu-id="bd286-128">Razor Pages oferuje prostszy sposób tworzenia funkcji aplikacji opartych na stronach, takich jak formularze niespa.</span><span class="sxs-lookup"><span data-stu-id="bd286-128">Razor Pages offers a simpler way of building page-based application features, such as non-SPA forms.</span></span> <span data-ttu-id="bd286-129">Korzystanie z kontrolerów i widoków było powszechne dla aplikacji, które mają bardzo duże kontrolery, które pracowały z wieloma różnymi zależnościami, i wyświetlają wiele różnych widoków.</span><span class="sxs-lookup"><span data-stu-id="bd286-129">Using controllers and views, it was common for applications to have very large controllers that worked with many different dependencies and view models and returned many different views.</span></span> <span data-ttu-id="bd286-130">Spowodowało to zwiększenie złożoności i często wynika z tego, że kontrolery, które nie były zgodne z pojedynczą zasadą odpowiedzialności lub zasady otwarte/zamknięte w praktyce.</span><span class="sxs-lookup"><span data-stu-id="bd286-130">This resulted in more complexity and often resulted in controllers that didn't follow the Single Responsibility Principle or Open/Closed Principles effectively.</span></span> <span data-ttu-id="bd286-131">Razor Pages rozwiązuje ten problem przez hermetyzację logiki po stronie serwera dla danej logicznej "strony" w aplikacji sieci Web z oznaczeniem Razor.</span><span class="sxs-lookup"><span data-stu-id="bd286-131">Razor Pages addresses this issue by encapsulating the server-side logic for a given logical "page" in a web application with its Razor markup.</span></span> <span data-ttu-id="bd286-132">Strona Razor, która nie ma logiki po stronie serwera, może składać się tylko z pliku Razor (na przykład "index. cshtml").</span><span class="sxs-lookup"><span data-stu-id="bd286-132">A Razor Page that has no server-side logic can only consist of a Razor file (for instance, "Index.cshtml").</span></span> <span data-ttu-id="bd286-133">Jednak większość nieuproszczonych Razor Pages będzie miała skojarzoną klasę modelu strony, która jest taka sama jak nazwa pliku Razor z rozszerzeniem ". cs" (na przykład "Index.cshtml.cs").</span><span class="sxs-lookup"><span data-stu-id="bd286-133">However, most non-trivial Razor Pages will have an associated page model class, which by convention is named the same as the Razor file with a ".cs" extension (for example, "Index.cshtml.cs").</span></span>

<span data-ttu-id="bd286-134">Model strony strony Razor łączy obowiązki kontrolera MVC i ViewModel.</span><span class="sxs-lookup"><span data-stu-id="bd286-134">A Razor Page's page model combines the responsibilities of an MVC controller and a viewmodel.</span></span> <span data-ttu-id="bd286-135">Zamiast obsługi żądań z metodami akcji kontrolera, programy obsługi modelu strony, takie jak "OnGet ()", są wykonywane, domyślnie renderuje ich skojarzone strony.</span><span class="sxs-lookup"><span data-stu-id="bd286-135">Instead of handling requests with controller action methods, page model handlers like "OnGet()" are executed, rendering their associated page by default.</span></span> <span data-ttu-id="bd286-136">Razor Pages upraszcza proces kompilowania poszczególnych stron w aplikacji ASP.NET Core, zapewniając jednocześnie wszystkie funkcje architektury ASP.NET Core MVC.</span><span class="sxs-lookup"><span data-stu-id="bd286-136">Razor Pages simplifies the process of building individual pages in an ASP.NET Core app, while still providing all the architectural features of ASP.NET Core MVC.</span></span> <span data-ttu-id="bd286-137">Są to dobry wybór domyślny dla nowych funkcji opartych na stronach.</span><span class="sxs-lookup"><span data-stu-id="bd286-137">They're a good default choice for new page-based functionality.</span></span>

### <a name="when-to-use-mvc"></a><span data-ttu-id="bd286-138">Kiedy używać MVC</span><span class="sxs-lookup"><span data-stu-id="bd286-138">When to use MVC</span></span>

<span data-ttu-id="bd286-139">Jeśli tworzysz interfejsy API sieci Web, wzorzec MVC staje się bardziej zrozumiały niż próba użycia Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="bd286-139">If you're building web APIs, the MVC pattern makes more sense than trying to use Razor Pages.</span></span> <span data-ttu-id="bd286-140">Jeśli projekt będzie uwidaczniał wyłącznie punkty końcowe interfejsu API sieci Web, należy najlepiej zacząć od szablonu projektu interfejsu API sieci Web.</span><span class="sxs-lookup"><span data-stu-id="bd286-140">If your project will only expose web API endpoints, you should ideally start from the Web API project template.</span></span> <span data-ttu-id="bd286-141">W przeciwnym razie można łatwo dodać kontrolery i skojarzone punkty końcowe interfejsu API do dowolnej aplikacji ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="bd286-141">Otherwise, it's easy to add controllers and associated API endpoints to any ASP.NET Core app.</span></span> <span data-ttu-id="bd286-142">Użyj podejścia MVC opartego na widokach w przypadku migrowania istniejącej aplikacji z ASP.NET MVC 5 lub starszej do ASP.NET Core MVC i chcesz to zrobić z mniejszą ilością nakładu pracy.</span><span class="sxs-lookup"><span data-stu-id="bd286-142">Use the view-based MVC approach if you're migrating an existing application from ASP.NET MVC 5 or earlier to ASP.NET Core MVC and you want to do so with the least amount of effort.</span></span> <span data-ttu-id="bd286-143">Po przeprowadzeniu migracji wstępnej można sprawdzić, czy ma to na celu przyjęcie Razor Pages nowych funkcji, a nawet w przypadku migracji hurtowej.</span><span class="sxs-lookup"><span data-stu-id="bd286-143">Once you've made the initial migration, you can evaluate whether it makes sense to adopt Razor Pages for new features or even as a wholesale migration.</span></span>

<span data-ttu-id="bd286-144">Niezależnie od tego, czy wybierzesz kompilację aplikacji sieci Web przy użyciu widoków Razor Pages lub MVC, aplikacja będzie miała podobną wydajność i będzie obejmować obsługę iniekcji zależności, filtrów, powiązań modelu, walidacji itd.</span><span class="sxs-lookup"><span data-stu-id="bd286-144">Whether you choose to build your web app using Razor Pages or MVC views, your app will have similar performance and will include support for dependency injection, filters, model binding, validation, and so on.</span></span>

## <a name="mapping-requests-to-responses"></a><span data-ttu-id="bd286-145">Mapowanie żądań na odpowiedzi</span><span class="sxs-lookup"><span data-stu-id="bd286-145">Mapping requests to responses</span></span>

<span data-ttu-id="bd286-146">W swoich serca ASP.NET Core aplikacje mapują przychodzące żądania na odpowiedzi wychodzące.</span><span class="sxs-lookup"><span data-stu-id="bd286-146">At its heart, ASP.NET Core apps map incoming requests to outgoing responses.</span></span> <span data-ttu-id="bd286-147">Na niskim poziomie to mapowanie odbywa się przy użyciu oprogramowania pośredniczącego, a proste aplikacje i mikrousługi ASP.NET Core mogą obejmować wyłącznie niestandardowe oprogramowanie pośredniczące.</span><span class="sxs-lookup"><span data-stu-id="bd286-147">At a low level, this mapping is done with middleware, and simple ASP.NET Core apps and microservices may be comprised solely of custom middleware.</span></span> <span data-ttu-id="bd286-148">W przypadku korzystania z ASP.NET Core MVC można korzystać na nieco wyższym poziomie, zastanawiając się pod względem _tras_, _kontrolerów_ i _akcji_.</span><span class="sxs-lookup"><span data-stu-id="bd286-148">When using ASP.NET Core MVC, you can work at a somewhat higher level, thinking in terms of _routes_, _controllers_, and _actions_.</span></span> <span data-ttu-id="bd286-149">Każde żądanie przychodzące jest porównywane z tabelą routingu aplikacji. w przypadku znalezienia zgodnej trasy zostanie wywołana skojarzona Metoda akcji (należącej do kontrolera) do obsługi żądania.</span><span class="sxs-lookup"><span data-stu-id="bd286-149">Each incoming request is compared with the application's routing table, and if a matching route is found, the associated action method (belonging to a controller) is called to handle the request.</span></span> <span data-ttu-id="bd286-150">Jeśli nie zostanie znaleziona zgodna trasa, zostanie wywołana procedura obsługi błędów (w tym przypadku zwracająca wynik NotFound).</span><span class="sxs-lookup"><span data-stu-id="bd286-150">If no matching route is found, an error handler (in this case, returning a NotFound result) is called.</span></span>

<span data-ttu-id="bd286-151">Aplikacje ASP.NET Core MVC mogą używać tras konwencjonalnych, tras atrybutów lub obu.</span><span class="sxs-lookup"><span data-stu-id="bd286-151">ASP.NET Core MVC apps can use conventional routes, attribute routes, or both.</span></span> <span data-ttu-id="bd286-152">Trasy konwencjonalne są zdefiniowane w kodzie, określając _konwencje_ routingu przy użyciu składni podobnej do poniższego przykładu:</span><span class="sxs-lookup"><span data-stu-id="bd286-152">Conventional routes are defined in code, specifying routing _conventions_ using syntax like in the example below:</span></span>

```csharp
app.UseEndpoints(endpoints =>
{
    endpoints.MapControllerRoute(name: "default", pattern: "{controller=Home}/{action=Index}/{id?}");
});
```

<span data-ttu-id="bd286-153">W tym przykładzie trasa o nazwie "default" została dodana do tabeli routingu.</span><span class="sxs-lookup"><span data-stu-id="bd286-153">In this example, a route named "default" has been added to the routing table.</span></span> <span data-ttu-id="bd286-154">Definiuje szablon trasy z symbolami zastępczymi dla `controller` , `action` i `id` .</span><span class="sxs-lookup"><span data-stu-id="bd286-154">It defines a route template with placeholders for `controller`, `action`, and `id`.</span></span> <span data-ttu-id="bd286-155">`controller` `action` Symbole zastępcze i mają domyślnie określony ( `Home` i `Index` , odpowiednio), a `id` symbol zastępczy jest opcjonalny (na przykład "?").</span><span class="sxs-lookup"><span data-stu-id="bd286-155">The `controller` and `action` placeholders have the default specified (`Home` and `Index`, respectively), and the `id` placeholder is optional (by virtue of a "?" applied to it).</span></span> <span data-ttu-id="bd286-156">W ramach Konwencji zdefiniowanej tutaj należy określić, że pierwsza część żądania powinna odpowiadać nazwie kontrolera, drugiej części akcji, a następnie, jeśli to konieczne, trzecia część będzie reprezentować parametr ID.</span><span class="sxs-lookup"><span data-stu-id="bd286-156">The convention defined here states that the first part of a request should correspond to the name of the controller, the second part to the action, and then if necessary a third part will represent an ID parameter.</span></span> <span data-ttu-id="bd286-157">Trasy konwencjonalne są zwykle definiowane w jednym miejscu dla aplikacji, na przykład w `Configure` metodzie `Startup` klasy.</span><span class="sxs-lookup"><span data-stu-id="bd286-157">Conventional routes are typically defined in one place for the application, such as in the `Configure` method in the `Startup` class.</span></span>

<span data-ttu-id="bd286-158">Trasy atrybutów są stosowane bezpośrednio do kontrolerów i akcji, a nie do określonych globalnie.</span><span class="sxs-lookup"><span data-stu-id="bd286-158">Attribute routes are applied to controllers and actions directly, rather than specified globally.</span></span> <span data-ttu-id="bd286-159">Takie podejście ma znacznie większą możliwość odnajdywania, gdy przeglądasz określoną metodę, ale oznacza to, że informacje o routingu nie są przechowywane w jednym miejscu w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="bd286-159">This approach has the advantage of making them much more discoverable when you're looking at a particular method, but does mean that routing information is not kept in one place in the application.</span></span> <span data-ttu-id="bd286-160">Korzystając z tras atrybutów, można łatwo określić wiele tras dla danej akcji, a także połączyć trasy między kontrolerami i akcjami.</span><span class="sxs-lookup"><span data-stu-id="bd286-160">With attribute routes, you can easily specify multiple routes for a given action, as well as combine routes between controllers and actions.</span></span> <span data-ttu-id="bd286-161">Przykład:</span><span class="sxs-lookup"><span data-stu-id="bd286-161">For example:</span></span>

```csharp
[Route("Home")]
public class HomeController : Controller
{
    [Route("")] // Combines to define the route template "Home"
    [Route("Index")] // Combines to define route template "Home/Index"
    [Route("/")] // Does not combine, defines the route template ""
    public IActionResult Index() {}
}
```

<span data-ttu-id="bd286-162">Trasy można określić w [narzędzia HttpGet] i podobnych atrybutach, unikając konieczności dodawania oddzielnych atrybutów [Route].</span><span class="sxs-lookup"><span data-stu-id="bd286-162">Routes can be specified on [HttpGet] and similar attributes, avoiding the need to add separate [Route] attributes.</span></span> <span data-ttu-id="bd286-163">Trasy atrybutu mogą również używać tokenów, aby ograniczyć potrzebę powtarzania nazw kontrolerów lub akcji, jak pokazano poniżej:</span><span class="sxs-lookup"><span data-stu-id="bd286-163">Attribute routes can also use tokens to reduce the need to repeat controller or action names, as shown below:</span></span>

```csharp
[Route("[controller]")]
public class ProductsController : Controller
{
    [Route("")] // Matches 'Products'
    [Route("Index")] // Matches 'Products/Index'
    public IActionResult Index() {}
}
```

<span data-ttu-id="bd286-164">Razor Pages nie używa routingu atrybutów.</span><span class="sxs-lookup"><span data-stu-id="bd286-164">Razor Pages doesn't use attribute routing.</span></span> <span data-ttu-id="bd286-165">Jako część swojej dyrektywy można określić dodatkowe informacje o szablonie trasy dla strony Razor `@page` :</span><span class="sxs-lookup"><span data-stu-id="bd286-165">You can specify additional route template information for a Razor Page as part of its `@page` directive:</span></span>

```csharp
@page "{id:int}"
```

<span data-ttu-id="bd286-166">W poprzednim przykładzie dana strona będzie pasowała do trasy z `id` parametrem Integer.</span><span class="sxs-lookup"><span data-stu-id="bd286-166">In the previous example, the page in question would match a route with an integer `id` parameter.</span></span> <span data-ttu-id="bd286-167">Na przykład strona *Products. cshtml* znajdująca się w folderze głównym `/Pages` ma następującą trasę:</span><span class="sxs-lookup"><span data-stu-id="bd286-167">For example, the *Products.cshtml* page located in the root of `/Pages` would have this route:</span></span>

```csharp
"/Products/123"
```

<span data-ttu-id="bd286-168">Po dopasowaniu danego żądania do trasy, ale przed wywołaniem metody akcji, ASP.NET Core MVC będzie wykonywał [powiązania modelu](/aspnet/core/mvc/models/model-binding) i [Sprawdzanie poprawności modelu](/aspnet/core/mvc/models/validation) na żądanie.</span><span class="sxs-lookup"><span data-stu-id="bd286-168">Once a given request has been matched to a route, but before the action method is called, ASP.NET Core MVC will perform [model binding](/aspnet/core/mvc/models/model-binding) and [model validation](/aspnet/core/mvc/models/validation) on the request.</span></span> <span data-ttu-id="bd286-169">Powiązanie modelu jest odpowiedzialne za konwertowanie przychodzących danych HTTP na typy .NET określone jako parametry metody akcji, która ma zostać wywołana.</span><span class="sxs-lookup"><span data-stu-id="bd286-169">Model binding is responsible for converting incoming HTTP data into the .NET types specified as parameters of the action method to be called.</span></span> <span data-ttu-id="bd286-170">Na przykład jeśli metoda akcja oczekuje `int id` parametru, powiązanie modelu podejmie próbę podania tego parametru z wartości dostarczonej jako część żądania.</span><span class="sxs-lookup"><span data-stu-id="bd286-170">For example, if the action method expects an `int id` parameter, model binding will attempt to provide this parameter from a value provided as part of the request.</span></span> <span data-ttu-id="bd286-171">W tym celu powiązanie modelu wyszukuje wartości w opublikowanym formularzu, wartości w samej trasie i wartości ciągu zapytania.</span><span class="sxs-lookup"><span data-stu-id="bd286-171">To do so, model binding looks for values in a posted form, values in the route itself, and query string values.</span></span> <span data-ttu-id="bd286-172">Przy założeniu `id` , że wartość zostanie znaleziona, zostanie przekonwertowana na liczbę całkowitą przed przekazaniem do metody akcji.</span><span class="sxs-lookup"><span data-stu-id="bd286-172">Assuming an `id` value is found, it will be converted to an integer before being passed into the action method.</span></span>

<span data-ttu-id="bd286-173">Po powiązaniu modelu, ale przed wywołaniem metody akcji, następuje Walidacja modelu.</span><span class="sxs-lookup"><span data-stu-id="bd286-173">After binding the model but before calling the action method, model validation occurs.</span></span> <span data-ttu-id="bd286-174">Walidacja modelu używa opcjonalnych atrybutów dla typu modelu i może pomóc zapewnić, że udostępniony obiekt modelu spełnia określone wymagania dotyczące danych.</span><span class="sxs-lookup"><span data-stu-id="bd286-174">Model validation uses optional attributes on the model type, and can help ensure that the provided model object conforms to certain data requirements.</span></span> <span data-ttu-id="bd286-175">Niektóre wartości mogą być określone jako wymagane lub ograniczone do określonej długości lub zakresu liczbowego itd. Jeśli określono atrybuty walidacji, ale model nie spełnia wymagań, właściwość ModelState. IsValid ma wartość false, a zestaw reguł walidacji z błędami będzie dostępny do wysłania do klienta wysyłającego żądanie.</span><span class="sxs-lookup"><span data-stu-id="bd286-175">Certain values may be specified as required, or limited to a certain length or numeric range, etc. If validation attributes are specified but the model does not conform to their requirements, the property ModelState.IsValid will be false, and the set of failing validation rules will be available to send to the client making the request.</span></span>

<span data-ttu-id="bd286-176">W przypadku korzystania z walidacji modelu należy zawsze sprawdzić, czy model jest prawidłowy przed wykonaniem jakichkolwiek poleceń zmiany stanu, aby upewnić się, że aplikacja nie jest uszkodzona przez nieprawidłowe dane.</span><span class="sxs-lookup"><span data-stu-id="bd286-176">If you're using model validation, you should be sure to always check that the model is valid before performing any state-altering commands, to ensure your app is not corrupted by invalid data.</span></span> <span data-ttu-id="bd286-177">Możesz użyć [filtru](/aspnet/core/mvc/controllers/filters) , aby uniknąć konieczności dodawania kodu dla tej walidacji w każdej akcji.</span><span class="sxs-lookup"><span data-stu-id="bd286-177">You can use a [filter](/aspnet/core/mvc/controllers/filters) to avoid the need to add code for this validation in every action.</span></span> <span data-ttu-id="bd286-178">ASP.NET Core filtry MVC oferują sposób przechwytywania grup żądań, dzięki czemu można zastosować typowe zasady i zagadnienia dotyczące krzyżowego rozliczania.</span><span class="sxs-lookup"><span data-stu-id="bd286-178">ASP.NET Core MVC filters offer a way of intercepting groups of requests, so that common policies and cross-cutting concerns can be applied on a targeted basis.</span></span> <span data-ttu-id="bd286-179">Filtry mogą być stosowane do poszczególnych akcji, całych kontrolerów lub globalnie dla aplikacji.</span><span class="sxs-lookup"><span data-stu-id="bd286-179">Filters can be applied to individual actions, whole controllers, or globally for an application.</span></span>

<span data-ttu-id="bd286-180">W przypadku interfejsów API sieci Web ASP.NET Core MVC obsługuje [_negocjowanie zawartości_](/aspnet/core/mvc/models/formatting), umożliwiając żądanie określenia sposobu formatowania odpowiedzi.</span><span class="sxs-lookup"><span data-stu-id="bd286-180">For web APIs, ASP.NET Core MVC supports [_content negotiation_](/aspnet/core/mvc/models/formatting), allowing requests to specify how responses should be formatted.</span></span> <span data-ttu-id="bd286-181">W oparciu o nagłówki podane w żądaniu akcje zwracające dane spowodują sformatowanie odpowiedzi w formacie XML, JSON lub innym obsługiwanym formacie.</span><span class="sxs-lookup"><span data-stu-id="bd286-181">Based on headers provided in the request, actions returning data will format the response in XML, JSON, or another supported format.</span></span> <span data-ttu-id="bd286-182">Ta funkcja umożliwia korzystanie z tego samego interfejsu API przez wielu klientów z różnymi wymaganiami dotyczącymi formatu danych.</span><span class="sxs-lookup"><span data-stu-id="bd286-182">This feature enables the same API to be used by multiple clients with different data format requirements.</span></span>

<span data-ttu-id="bd286-183">Projekty interfejsu API sieci Web należy rozważyć przy użyciu `[ApiController]` atrybutu, który można zastosować do poszczególnych kontrolerów, do podstawowej klasy kontrolera lub do całego zestawu.</span><span class="sxs-lookup"><span data-stu-id="bd286-183">Web API projects should consider using the `[ApiController]` attribute, which can be applied to individual controllers, to a base controller class, or to the entire assembly.</span></span> <span data-ttu-id="bd286-184">Ten atrybut dodaje Automatyczne sprawdzanie poprawności modelu, a każda akcja z nieprawidłowym modelem zwróci nieprawidłowego żądania z informacjami o błędach walidacji.</span><span class="sxs-lookup"><span data-stu-id="bd286-184">This attribute adds automatic model validation checking and any action with an invalid model will return a BadRequest with the details of the validation errors.</span></span> <span data-ttu-id="bd286-185">Ten atrybut wymaga również, aby wszystkie akcje miały atrybut trasy, zamiast używać trasy konwencjonalnej i zwracają bardziej szczegółowe informacje ProblemDetails w odpowiedzi na błędy.</span><span class="sxs-lookup"><span data-stu-id="bd286-185">The attribute also requires all actions have an attribute route, rather than using a conventional route, and returns more detailed ProblemDetails information in response to errors.</span></span>

### <a name="keeping-controllers-under-control"></a><span data-ttu-id="bd286-186">Utrzymywanie kontrolerów pod kontrolą</span><span class="sxs-lookup"><span data-stu-id="bd286-186">Keeping controllers under control</span></span>

<span data-ttu-id="bd286-187">W przypadku aplikacji opartych na stronach Razor Pages wykonać doskonałe zadanie utrzymywania zbyt dużej liczby kontrolerów.</span><span class="sxs-lookup"><span data-stu-id="bd286-187">For page-based applications, Razor Pages do a great job of keeping controllers from getting too large.</span></span> <span data-ttu-id="bd286-188">Każda Strona otrzymuje własne pliki i klasy, które są przeznaczone tylko dla jego programów obsługi.</span><span class="sxs-lookup"><span data-stu-id="bd286-188">Each individual page is given its own files and classes dedicated just to its handler(s).</span></span> <span data-ttu-id="bd286-189">Przed wprowadzeniem Razor Pages wiele aplikacji zorientowanych na widok będzie miała duże klasy kontrolerów odpowiedzialne za wiele różnych akcji i widoków.</span><span class="sxs-lookup"><span data-stu-id="bd286-189">Prior to the introduction of Razor Pages, many view-centric applications would have large controller classes responsible for many different actions and views.</span></span> <span data-ttu-id="bd286-190">Te klasy byłyby naturalnie rosnące w celu posiadania wielu obowiązków i zależności, co utrudnia ich konserwację.</span><span class="sxs-lookup"><span data-stu-id="bd286-190">These classes would naturally grow to have many responsibilities and dependencies, making them harder to maintain.</span></span> <span data-ttu-id="bd286-191">Jeśli okaże się, że Twoje kontrolery widoków są zbyt duże, rozważ ich refaktoryzację do użycia Razor Pages lub wprowadzenie wzorca, takiego jak mediator.</span><span class="sxs-lookup"><span data-stu-id="bd286-191">If you find your view-based controllers are growing too large, consider refactoring them to use Razor Pages, or introducing a pattern like a mediator.</span></span>

<span data-ttu-id="bd286-192">Wzorzec projektowy mediator jest używany do zredukowania sprzęgania między klasami, jednocześnie umożliwiając komunikację między nimi.</span><span class="sxs-lookup"><span data-stu-id="bd286-192">The mediator design pattern is used to reduce coupling between classes while allowing communication between them.</span></span> <span data-ttu-id="bd286-193">W aplikacjach ASP.NET Core MVC ten wzorzec jest często stosowany do podziału kontrolerów na mniejsze części za pomocą *programów obsługi* w celu wykonywania pracy z metodami akcji.</span><span class="sxs-lookup"><span data-stu-id="bd286-193">In ASP.NET Core MVC applications, this pattern is frequently employed to break up controllers into smaller pieces by using *handlers* to do the work of action methods.</span></span> <span data-ttu-id="bd286-194">Popularny [pakiet NuGet MediatR](https://www.nuget.org/packages/MediatR/) jest często używany do osiągnięcia tego celu.</span><span class="sxs-lookup"><span data-stu-id="bd286-194">The popular [MediatR NuGet package](https://www.nuget.org/packages/MediatR/) is often used to accomplish this.</span></span> <span data-ttu-id="bd286-195">Zazwyczaj kontrolery obejmują wiele różnych metod akcji, z których każdy może wymagać pewnych zależności.</span><span class="sxs-lookup"><span data-stu-id="bd286-195">Typically, controllers include many different action methods, each of which may require certain dependencies.</span></span> <span data-ttu-id="bd286-196">Zestaw wszystkich zależności wymaganych przez dowolną akcję musi być przekazaniem do konstruktora kontrolera.</span><span class="sxs-lookup"><span data-stu-id="bd286-196">The set of all dependencies required by any action must be passed into the controller's constructor.</span></span> <span data-ttu-id="bd286-197">W przypadku korzystania z MediatR jedyną zależnością jest kontroler w wystąpieniu mediator.</span><span class="sxs-lookup"><span data-stu-id="bd286-197">When using MediatR, the only dependency a controller has is on an instance of the mediator.</span></span> <span data-ttu-id="bd286-198">Każda akcja następnie używa wystąpienia mediator do wysyłania komunikatu, który jest przetwarzany przez procedurę obsługi.</span><span class="sxs-lookup"><span data-stu-id="bd286-198">Each action then uses the mediator instance to send a message, which is processed by a handler.</span></span> <span data-ttu-id="bd286-199">Procedura obsługi jest specyficzna dla jednej akcji i w ten sposób wymaga tylko zależności wymaganych przez tę akcję.</span><span class="sxs-lookup"><span data-stu-id="bd286-199">The handler is specific to a single action and thus only needs the dependencies required by that action.</span></span> <span data-ttu-id="bd286-200">Przykładem kontrolera korzystającego z MediatR jest następujący:</span><span class="sxs-lookup"><span data-stu-id="bd286-200">An example of a controller using MediatR is shown here:</span></span>

```csharp
public class OrderController : Controller
{
    private readonly IMediator _mediator;

    public OrderController(IMediator mediator)
    {
        _mediator = mediator;
    }

    [HttpGet]
    public async Task<IActionResult> MyOrders()
    {
        var viewModel = await _mediator.Send(new GetMyOrders(User.Identity.Name));

        return View(viewModel);
    }

    // other actions implemented similarly
}
```

<span data-ttu-id="bd286-201">W `MyOrders` akcji wywołanie `Send` `GetMyOrders` komunikatu jest obsługiwane przez tę klasę:</span><span class="sxs-lookup"><span data-stu-id="bd286-201">In the `MyOrders` action, the call to `Send` a `GetMyOrders` message is handled by this class:</span></span>

```csharp
public class GetMyOrdersHandler : IRequestHandler<GetMyOrders, IEnumerable<OrderViewModel>>
{
    private readonly IOrderRepository _orderRepository;

    public GetMyOrdersHandler(IOrderRepository orderRepository)
    {
        _orderRepository = orderRepository;
    }

    public async Task<IEnumerable<OrderViewModel>> Handle(GetMyOrders request, CancellationToken cancellationToken)
    {
        var specification = new CustomerOrdersWithItemsSpecification(request.UserName);
        var orders = await _orderRepository.ListAsync(specification);

        return orders.Select(o => new OrderViewModel
        {
            OrderDate = o.OrderDate,
            OrderItems = o.OrderItems?.Select(oi => new OrderItemViewModel()
            {
                PictureUrl = oi.ItemOrdered.PictureUri,
                ProductId = oi.ItemOrdered.CatalogItemId,
                ProductName = oi.ItemOrdered.ProductName,
                UnitPrice = oi.UnitPrice,
                Units = oi.Units
            }).ToList(),
            OrderNumber = o.Id,
            ShippingAddress = o.ShipToAddress,
            Total = o.Total()
        });
    }
}
```

<span data-ttu-id="bd286-202">Rezultatem tego podejścia jest to, że kontrolery są znacznie mniejsze i koncentrują się głównie na powiązaniach routingu i modelu, natomiast poszczególne programy obsługi są odpowiedzialne za określone zadania wymagające danego punktu końcowego.</span><span class="sxs-lookup"><span data-stu-id="bd286-202">The end result of this approach is for controllers to be much smaller and focused primarily on routing and model binding, while individual handlers are responsible for the specific tasks needed by a given endpoint.</span></span> <span data-ttu-id="bd286-203">Takie podejście można również uzyskać bez MediatR za pomocą [pakietu NuGet ApiEndpoints](https://www.nuget.org/packages/Ardalis.ApiEndpoints/), który próbuje przełączyć się do kontrolerów interfejsu API te same korzyści, Razor Pages są one wbudowane dla kontrolerów opartych na widoku.</span><span class="sxs-lookup"><span data-stu-id="bd286-203">This approach can also be achieved without MediatR by using the [ApiEndpoints NuGet package](https://www.nuget.org/packages/Ardalis.ApiEndpoints/), which attempts to bring to API controllers the same benefits Razor Pages brings to view-based controllers.</span></span>

> ### <a name="references--mapping-requests-to-responses"></a><span data-ttu-id="bd286-204">References — mapowanie żądań na odpowiedzi</span><span class="sxs-lookup"><span data-stu-id="bd286-204">References – Mapping Requests to Responses</span></span>
>
> - <span data-ttu-id="bd286-205">**Routing do akcji kontrolera**</span><span class="sxs-lookup"><span data-stu-id="bd286-205">**Routing to Controller Actions**</span></span>\
 > <https://docs.microsoft.com/aspnet/core/mvc/controllers/routing>
> - <span data-ttu-id="bd286-206">**Powiązanie modelu**</span><span class="sxs-lookup"><span data-stu-id="bd286-206">**Model Binding**</span></span>\
 > <https://docs.microsoft.com/aspnet/core/mvc/models/model-binding>
> - <span data-ttu-id="bd286-207">**Walidacja modelu**</span><span class="sxs-lookup"><span data-stu-id="bd286-207">**Model Validation**</span></span>\
 > <https://docs.microsoft.com/aspnet/core/mvc/models/validation>
> - <span data-ttu-id="bd286-208">**Filtry**</span><span class="sxs-lookup"><span data-stu-id="bd286-208">**Filters**</span></span>\
 > <https://docs.microsoft.com/aspnet/core/mvc/controllers/filters>
> - <span data-ttu-id="bd286-209">**ApiController — atrybut**</span><span class="sxs-lookup"><span data-stu-id="bd286-209">**ApiController Attribute**</span></span>\
 > <https://docs.microsoft.com/aspnet/core/web-api/>

## <a name="working-with-dependencies"></a><span data-ttu-id="bd286-210">Praca z zależnościami</span><span class="sxs-lookup"><span data-stu-id="bd286-210">Working with dependencies</span></span>

<span data-ttu-id="bd286-211">ASP.NET Core ma wbudowaną obsługę i wewnętrznie wykorzystuje technikę znaną jako [iniekcja zależności](/aspnet/core/fundamentals/dependency-injection).</span><span class="sxs-lookup"><span data-stu-id="bd286-211">ASP.NET Core has built-in support for and internally makes use of a technique known as [dependency injection](/aspnet/core/fundamentals/dependency-injection).</span></span> <span data-ttu-id="bd286-212">Wstrzykiwanie zależności to technika, która umożliwia swobodne sprzęganie różnych części aplikacji.</span><span class="sxs-lookup"><span data-stu-id="bd286-212">Dependency injection is a technique that enables loose coupling between different parts of an application.</span></span> <span data-ttu-id="bd286-213">Sprzężenie luźne jest pożądane, ponieważ ułatwia izolowanie części aplikacji, co pozwala na testowanie lub zastępowanie.</span><span class="sxs-lookup"><span data-stu-id="bd286-213">Looser coupling is desirable because it makes it easier to isolate parts of the application, allowing for testing or replacement.</span></span> <span data-ttu-id="bd286-214">Sprawia również, że zmiana w jednej części aplikacji będzie miała nieoczekiwany wpływ w innym miejscu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="bd286-214">It also makes it less likely that a change in one part of the application will have an unexpected impact somewhere else in the application.</span></span> <span data-ttu-id="bd286-215">Iniekcja zależności jest oparta na zasadzie niewersji zależności i jest często kluczem do osiągnięcia zasady otwarte/zamknięte.</span><span class="sxs-lookup"><span data-stu-id="bd286-215">Dependency injection is based on the dependency inversion principle, and is often key to achieving the open/closed principle.</span></span> <span data-ttu-id="bd286-216">Podczas oceniania, jak działa Twoja aplikacja wraz z jej zależnościami, należy pamiętać o kodzie [static cling](https://deviq.com/static-cling/) zapachu i pamiętaj, że aphorism "[New to Glue](https://ardalis.com/new-is-glue)".</span><span class="sxs-lookup"><span data-stu-id="bd286-216">When evaluating how your application works with its dependencies, beware of the [static cling](https://deviq.com/static-cling/) code smell, and remember the aphorism "[new is glue](https://ardalis.com/new-is-glue)."</span></span>

<span data-ttu-id="bd286-217">Statyczne cling występuje, gdy klasy umożliwiają wywoływanie metod statycznych lub dostęp do właściwości statycznych, które mają efekty uboczne lub zależności dotyczące infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="bd286-217">Static cling occurs when your classes make calls to static methods, or access static properties, which have side effects or dependencies on infrastructure.</span></span> <span data-ttu-id="bd286-218">Na przykład jeśli masz metodę, która wywołuje metodę statyczną, która z kolei zapisuje dane w bazie danych, metoda jest ściśle sprzężona z bazą danych.</span><span class="sxs-lookup"><span data-stu-id="bd286-218">For example, if you have a method that calls a static method, which in turn writes to a database, your method is tightly coupled to the database.</span></span> <span data-ttu-id="bd286-219">Wszystkie elementy, które dzielą się tym wywołaniem bazy danych, spowodują uszkodzenie metody.</span><span class="sxs-lookup"><span data-stu-id="bd286-219">Anything that breaks that database call will break your method.</span></span> <span data-ttu-id="bd286-220">Testowanie takich metod jest trudne, ponieważ takie testy wymagają, aby komercyjne biblioteki do zasymulować wywołania statyczne lub mogły być testowane tylko z testową bazą danych.</span><span class="sxs-lookup"><span data-stu-id="bd286-220">Testing such methods is notoriously difficult, since such tests either require commercial mocking libraries to mock the static calls, or can only be tested with a test database in place.</span></span> <span data-ttu-id="bd286-221">Wywołania statyczne, które nie mają żadnych zależności względem infrastruktury, szczególnie te, które są całkowicie bezstanowe, są bardzo ważne do wywołania i nie mają wpływu na sprzężenie lub możliwości testowania (poza kodem sprzęgania do samego wywołania statycznego).</span><span class="sxs-lookup"><span data-stu-id="bd286-221">Static calls that don't have any dependence on infrastructure, especially those calls that are completely stateless, are fine to call and have no impact on coupling or testability (beyond coupling code to the static call itself).</span></span>

<span data-ttu-id="bd286-222">Wielu programistów zna ryzyko związane ze statycznym clingm i globalnym stanem, ale nadal ściśle połączy swój kod z określonymi implementacjami za pośrednictwem bezpośredniego tworzenia wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="bd286-222">Many developers understand the risks of static cling and global state, but will still tightly couple their code to specific implementations through direct instantiation.</span></span> <span data-ttu-id="bd286-223">"New to Glue" to przypomnienie dotyczące sprzęgu, a nie ogólne Condemnation użycia `new` słowa kluczowego.</span><span class="sxs-lookup"><span data-stu-id="bd286-223">"New is glue" is meant to be a reminder of this coupling, and not a general condemnation of the use of the `new` keyword.</span></span> <span data-ttu-id="bd286-224">Podobnie jak w przypadku wywołań metod statycznych, nowe wystąpienia typów, które nie mają zależności zewnętrznych, zazwyczaj nie umożliwiają ścisłego podzielenia kodu na szczegóły implementacji lub sprawiają, że testowanie jest trudniejsze.</span><span class="sxs-lookup"><span data-stu-id="bd286-224">Just as with static method calls, new instances of types that have no external dependencies typically do not tightly couple code to implementation details or make testing more difficult.</span></span> <span data-ttu-id="bd286-225">Ale za każdym razem, gdy Klasa jest tworzona, Poświęć nieco chwilę, aby rozważyć, czy ma to sens, że ma to na celu wyznaczenie, że ma to miejsce w konkretnym miejscu w danej lokalizacji, czy też będzie lepszym rozwiązaniem do żądania tego wystąpienia jako zależności.</span><span class="sxs-lookup"><span data-stu-id="bd286-225">But each time a class is instantiated, take just a brief moment to consider whether it makes sense to hard-code that specific instance in that particular location, or if it would be a better design to request that instance as a dependency.</span></span>

### <a name="declare-your-dependencies"></a><span data-ttu-id="bd286-226">Deklarowanie zależności</span><span class="sxs-lookup"><span data-stu-id="bd286-226">Declare your dependencies</span></span>

<span data-ttu-id="bd286-227">ASP.NET Core jest oparty na tym, że metody i klasy deklarują swoje zależności, żądając ich jako argumentów.</span><span class="sxs-lookup"><span data-stu-id="bd286-227">ASP.NET Core is built around having methods and classes declare their dependencies, requesting them as arguments.</span></span> <span data-ttu-id="bd286-228">Aplikacje ASP.NET są zwykle konfigurowane w klasie startowej, która jest konfigurowana do obsługi iniekcji zależności w kilku punktach.</span><span class="sxs-lookup"><span data-stu-id="bd286-228">ASP.NET applications are typically set up in a Startup class, which itself is configured to support dependency injection at several points.</span></span> <span data-ttu-id="bd286-229">Jeśli Klasa startowa ma Konstruktor, może zażądać zależności za pomocą konstruktora, tak więc:</span><span class="sxs-lookup"><span data-stu-id="bd286-229">If your Startup class has a constructor, it can request dependencies through the constructor, like so:</span></span>

```csharp
public class Startup
{
    public Startup(IHostingEnvironment env)
    {
        var builder = new ConfigurationBuilder()
            .SetBasePath(env.ContentRootPath)
            .AddJsonFile("appsettings.json", optional: false, reloadOnChange: true)
            .AddJsonFile($"appsettings.{env.EnvironmentName}.json", optional: true);
    }
}
```

<span data-ttu-id="bd286-230">Klasa uruchomieniowa jest interesująca, że nie ma żadnych jawnych wymagań dla tego typu.</span><span class="sxs-lookup"><span data-stu-id="bd286-230">The Startup class is interesting in that there are no explicit type requirements for it.</span></span> <span data-ttu-id="bd286-231">Nie dziedziczy po specjalnej początkowej klasie bazowej ani nie implementuje żadnego konkretnego interfejsu.</span><span class="sxs-lookup"><span data-stu-id="bd286-231">It doesn't inherit from a special Startup base class, nor does it implement any particular interface.</span></span> <span data-ttu-id="bd286-232">Możesz nadać mu konstruktora, a nie, i można określić dowolną liczbę parametrów w konstruktorze.</span><span class="sxs-lookup"><span data-stu-id="bd286-232">You can give it a constructor, or not, and you can specify as many parameters on the constructor as you want.</span></span> <span data-ttu-id="bd286-233">Po uruchomieniu hosta sieci Web, który został skonfigurowany dla aplikacji, zostanie wywołana Klasa startowa, której użyto, i użyje iniekcji zależności do wypełnienia wszelkich zależności wymaganych przez klasę uruchomieniową.</span><span class="sxs-lookup"><span data-stu-id="bd286-233">When the web host you've configured for your application starts, it will call the Startup class you've told it to use, and will use dependency injection to populate any dependencies the Startup class requires.</span></span> <span data-ttu-id="bd286-234">Oczywiście, jeśli poprosisz o parametry, które nie są skonfigurowane w kontenerze usług używanym przez ASP.NET Core, otrzymasz wyjątek, ale o ile przejdziesz do zależności, których dotyczy ten kontener, możesz poprosić o dowolne elementy.</span><span class="sxs-lookup"><span data-stu-id="bd286-234">Of course, if you request parameters that aren't configured in the services container used by ASP.NET Core, you'll get an exception, but as long as you stick to dependencies the container knows about, you can request anything you want.</span></span>

<span data-ttu-id="bd286-235">Iniekcja zależności jest wbudowana w aplikacje ASP.NET Core bezpośrednio od początku, podczas tworzenia wystąpienia uruchamiania.</span><span class="sxs-lookup"><span data-stu-id="bd286-235">Dependency injection is built into your ASP.NET Core apps right from the start, when you create the Startup instance.</span></span> <span data-ttu-id="bd286-236">Nie powoduje zatrzymania klasy startowej.</span><span class="sxs-lookup"><span data-stu-id="bd286-236">It doesn't stop there for the Startup class.</span></span> <span data-ttu-id="bd286-237">Możesz również zażądać zależności w metodzie konfigurowania:</span><span class="sxs-lookup"><span data-stu-id="bd286-237">You can also request dependencies in the Configure method:</span></span>

```csharp
public void Configure(IApplicationBuilder app,
    IHostingEnvironment env,
    ILoggerFactory loggerFactory)
{

}
```

<span data-ttu-id="bd286-238">Metoda ConfigureServices to wyjątek dla tego zachowania; musi on mieć tylko jeden parametr typu IServiceCollection.</span><span class="sxs-lookup"><span data-stu-id="bd286-238">The ConfigureServices method is the exception to this behavior; it must take just one parameter of type IServiceCollection.</span></span> <span data-ttu-id="bd286-239">Nie ma potrzeby obsługi iniekcji zależności, ponieważ z jednej strony jest odpowiedzialny za Dodawanie obiektów do kontenera usługi, a w drugiej, ma dostęp do wszystkich aktualnie skonfigurowanych usług za pośrednictwem parametru IServiceCollection.</span><span class="sxs-lookup"><span data-stu-id="bd286-239">It doesn't really need to support dependency injection, since on the one hand it is responsible for adding objects to the services container, and on the other it has access to all currently configured services via the IServiceCollection parameter.</span></span> <span data-ttu-id="bd286-240">Z tego względu można pracować z zależnościami zdefiniowanymi w kolekcji usług ASP.NET Core Services w każdej części klasy uruchomieniowej, żądając wymaganej usługi jako parametru lub przez pracę z IServiceCollection w ConfigureServices.</span><span class="sxs-lookup"><span data-stu-id="bd286-240">Thus, you can work with dependencies defined in the ASP.NET Core services collection in every part of the Startup class, either by requesting the needed service as a parameter or by working with the IServiceCollection in ConfigureServices.</span></span>

> [!NOTE]
> <span data-ttu-id="bd286-241">Jeśli musisz upewnić się, że niektóre usługi są dostępne dla klasy startowej, możesz je skonfigurować przy użyciu metody IWebHostBuilder i ConfigureServices w wywołaniu CreateDefaultBuilder.</span><span class="sxs-lookup"><span data-stu-id="bd286-241">If you need to ensure certain services are available to your Startup class, you can configure them using an IWebHostBuilder and its ConfigureServices method inside the CreateDefaultBuilder call.</span></span>

<span data-ttu-id="bd286-242">Klasa startowa to model służący do tworzenia struktury innych części aplikacji ASP.NET Core, od kontrolerów do oprogramowania pośredniczącego, do filtrów do własnych usług.</span><span class="sxs-lookup"><span data-stu-id="bd286-242">The Startup class is a model for how you should structure other parts of your ASP.NET Core application, from Controllers to Middleware to Filters to your own Services.</span></span> <span data-ttu-id="bd286-243">W każdym przypadku należy postępować zgodnie z [zasadami jawnych zależności](https://deviq.com/explicit-dependencies-principle/), żądając zależności, a nie ich bezpośrednio tworzyć i wykorzystując iniekcję zależności w całej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="bd286-243">In each case, you should follow the [Explicit Dependencies Principle](https://deviq.com/explicit-dependencies-principle/), requesting your dependencies rather than directly creating them, and leveraging dependency injection throughout your application.</span></span> <span data-ttu-id="bd286-244">Należy zachować ostrożność, gdzie i w jaki sposób bezpośrednio utworzyć wystąpienia implementacji, szczególnie usług i obiektów, które pracują z infrastrukturą, lub mieć skutki uboczne.</span><span class="sxs-lookup"><span data-stu-id="bd286-244">Be careful of where and how you directly instantiate implementations, especially services and objects that work with infrastructure or have side effects.</span></span> <span data-ttu-id="bd286-245">Preferuj pracę z abstrakcyjnymi definicjami w rdzeńu aplikacji i przekazane jako argumenty do zakodowana odwołań do określonych typów implementacji.</span><span class="sxs-lookup"><span data-stu-id="bd286-245">Prefer working with abstractions defined in your application core and passed in as arguments to hardcoding references to specific implementation types.</span></span>

## <a name="structuring-the-application"></a><span data-ttu-id="bd286-246">Tworzenie struktury aplikacji</span><span class="sxs-lookup"><span data-stu-id="bd286-246">Structuring the application</span></span>

<span data-ttu-id="bd286-247">Aplikacje monolityczne zwykle mają jeden punkt wejścia.</span><span class="sxs-lookup"><span data-stu-id="bd286-247">Monolithic applications typically have a single entry point.</span></span> <span data-ttu-id="bd286-248">W przypadku ASP.NET Core aplikacji sieci Web punkt wejścia będzie ASP.NET Core projekcie sieci Web.</span><span class="sxs-lookup"><span data-stu-id="bd286-248">In the case of an ASP.NET Core web application, the entry point will be the ASP.NET Core web project.</span></span> <span data-ttu-id="bd286-249">Nie oznacza to jednak, że rozwiązanie powinno zawierać tylko jeden projekt.</span><span class="sxs-lookup"><span data-stu-id="bd286-249">However, that doesn't mean the solution should consist of just a single project.</span></span> <span data-ttu-id="bd286-250">Warto podzielić aplikację na różne warstwy, aby obserwować rozdzielenie problemów.</span><span class="sxs-lookup"><span data-stu-id="bd286-250">It's useful to break up the application into different layers in order to follow separation of concerns.</span></span> <span data-ttu-id="bd286-251">Po podpisaniu na warstwach warto przekroczyć foldery do oddzielnych projektów, co może pomóc w osiągnięciu lepszego hermetyzacji.</span><span class="sxs-lookup"><span data-stu-id="bd286-251">Once broken up into layers, it's helpful to go beyond folders to separate projects, which can help achieve better encapsulation.</span></span> <span data-ttu-id="bd286-252">Najlepszym podejściem do osiągnięcia tych celów za pomocą aplikacji ASP.NET Core jest odmiana czystego architektury omówionego w rozdziale 5.</span><span class="sxs-lookup"><span data-stu-id="bd286-252">The best approach to achieve these goals with an ASP.NET Core application is a variation of the Clean Architecture discussed in chapter 5.</span></span> <span data-ttu-id="bd286-253">Po tym podejściu rozwiązanie aplikacji będzie obejmować oddzielne biblioteki dla interfejsu użytkownika, infrastruktury i ApplicationCore.</span><span class="sxs-lookup"><span data-stu-id="bd286-253">Following this approach, the application's solution will comprise separate libraries for the UI, Infrastructure, and ApplicationCore.</span></span>

<span data-ttu-id="bd286-254">Poza tymi projektami są również dołączone oddzielne projekty testowe (testowanie jest omówione w rozdziale 9).</span><span class="sxs-lookup"><span data-stu-id="bd286-254">In addition to these projects, separate test projects are included as well (Testing is discussed in Chapter 9).</span></span>

<span data-ttu-id="bd286-255">Model obiektów i interfejsy aplikacji należy umieścić w projekcie ApplicationCore.</span><span class="sxs-lookup"><span data-stu-id="bd286-255">The application's object model and interfaces should be placed in the ApplicationCore project.</span></span> <span data-ttu-id="bd286-256">Ten projekt będzie miał możliwie najmniejszej liczby zależności, a inne projekty w rozwiązaniu będą odwoływać się do niego.</span><span class="sxs-lookup"><span data-stu-id="bd286-256">This project will have as few dependencies as possible, and the other projects in the solution will reference it.</span></span> <span data-ttu-id="bd286-257">Jednostki biznesowe, które muszą być utrwalane, są zdefiniowane w projekcie ApplicationCore, podobnie jak usługi, które nie zależą bezpośrednio od infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="bd286-257">Business entities that need to be persisted are defined in the ApplicationCore project, as are services that do not directly depend on infrastructure.</span></span>

<span data-ttu-id="bd286-258">Szczegóły implementacji, takie jak trwałość lub sposób wysyłania powiadomień do użytkownika, są przechowywane w projekcie infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="bd286-258">Implementation details, such as how persistence is performed or how notifications might be sent to a user, are kept in the Infrastructure project.</span></span> <span data-ttu-id="bd286-259">Ten projekt będzie odwoływać się do pakietów specyficznych dla implementacji, takich jak Entity Framework Core, ale nie powinien ujawniać szczegółowych informacji o tych implementacjach poza projektem.</span><span class="sxs-lookup"><span data-stu-id="bd286-259">This project will reference implementation-specific packages such as Entity Framework Core, but should not expose details about these implementations outside of the project.</span></span> <span data-ttu-id="bd286-260">Usługi infrastruktury i repozytoria powinny implementować interfejsy, które są zdefiniowane w projekcie ApplicationCore, a jego implementacje trwałości są odpowiedzialne za pobieranie i przechowywanie jednostek zdefiniowanych w ApplicationCore.</span><span class="sxs-lookup"><span data-stu-id="bd286-260">Infrastructure services and repositories should implement interfaces that are defined in the ApplicationCore project, and its persistence implementations are responsible for retrieving and storing entities defined in ApplicationCore.</span></span>

<span data-ttu-id="bd286-261">Projekt interfejsu użytkownika ASP.NET Core jest odpowiedzialny za wszelkie wątpliwości dotyczące poziomu interfejsu użytkownika, ale nie powinien obejmować logiki biznesowej ani szczegółów infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="bd286-261">The ASP.NET Core UI project is responsible for any UI level concerns, but should not include business logic or infrastructure details.</span></span> <span data-ttu-id="bd286-262">W rzeczywistości najlepiej nie powinien on mieć zależności od projektu infrastruktury, co pomaga zapewnić, że żadna zależność między tymi dwoma projektami nie zostanie wprowadzona przypadkowo.</span><span class="sxs-lookup"><span data-stu-id="bd286-262">In fact, ideally it shouldn't even have a dependency on the Infrastructure project, which will help ensure no dependency between the two projects is introduced accidentally.</span></span> <span data-ttu-id="bd286-263">Można to osiągnąć za pomocą innych kontenerów DI innych firm, takich jak Autofac, co pozwala na definiowanie reguł DI w klasach modułów w każdym projekcie.</span><span class="sxs-lookup"><span data-stu-id="bd286-263">This can be achieved using a third-party DI container like Autofac, which allows you to define DI rules in Module classes in each project.</span></span>

<span data-ttu-id="bd286-264">Inne podejście do oddzielenia aplikacji od szczegółów implementacji ma na celu wywołanie mikrousług, które mogą być wdrożone w poszczególnych kontenerach platformy Docker.</span><span class="sxs-lookup"><span data-stu-id="bd286-264">Another approach to decoupling the application from implementation details is to have the application call microservices, perhaps deployed in individual Docker containers.</span></span> <span data-ttu-id="bd286-265">Zapewnia to jeszcze większe rozdzielenie problemów i rozróżnienie niż wykorzystanie dwóch projektów, ale ma dodatkową złożoność.</span><span class="sxs-lookup"><span data-stu-id="bd286-265">This provides even greater separation of concerns and decoupling than leveraging DI between two projects, but has additional complexity.</span></span>

### <a name="feature-organization"></a><span data-ttu-id="bd286-266">Organizacja funkcji</span><span class="sxs-lookup"><span data-stu-id="bd286-266">Feature organization</span></span>

<span data-ttu-id="bd286-267">Domyślnie aplikacje ASP.NET Core organizują strukturę folderów w taki sposób, aby obejmowały kontrolery i widoki oraz często modele widoków.</span><span class="sxs-lookup"><span data-stu-id="bd286-267">By default, ASP.NET Core applications organize their folder structure to include Controllers and Views, and frequently ViewModels.</span></span> <span data-ttu-id="bd286-268">Kod po stronie klienta do obsługi tych struktur po stronie serwera jest zazwyczaj przechowywany osobno w folderze wwwroot.</span><span class="sxs-lookup"><span data-stu-id="bd286-268">Client-side code to support these server-side structures is typically stored separately in the wwwroot folder.</span></span> <span data-ttu-id="bd286-269">Jednak duże aplikacje mogą napotkać problemy z tą organizacją, ponieważ praca nad daną funkcją często wymaga przechodzenia między tymi folderami.</span><span class="sxs-lookup"><span data-stu-id="bd286-269">However, large applications may encounter problems with this organization, since working on any given feature often requires jumping between these folders.</span></span> <span data-ttu-id="bd286-270">Jest to bardziej trudne i trudniejsze w miarę zwiększania się liczby plików i podfolderów w każdym folderze, dzięki czemu można przewijać Eksplorator rozwiązań.</span><span class="sxs-lookup"><span data-stu-id="bd286-270">This gets more and more difficult as the number of files and subfolders in each folder grows, resulting in a great deal of scrolling through Solution Explorer.</span></span> <span data-ttu-id="bd286-271">Jednym z rozwiązań tego problemu jest organizowanie kodu aplikacji według _funkcji_ zamiast według typu plików.</span><span class="sxs-lookup"><span data-stu-id="bd286-271">One solution to this problem is to organize application code by _feature_ instead of by file type.</span></span> <span data-ttu-id="bd286-272">Ten styl organizacyjny jest zwykle określany jako foldery funkcji lub [wycinki funkcji](/archive/msdn-magazine/2016/september/asp-net-core-feature-slices-for-asp-net-core-mvc) (Zobacz również: [wycinki pionowe](https://deviq.com/vertical-slices/)).</span><span class="sxs-lookup"><span data-stu-id="bd286-272">This organizational style is typically referred to as feature folders or [feature slices](/archive/msdn-magazine/2016/september/asp-net-core-feature-slices-for-asp-net-core-mvc) (see also: [Vertical Slices](https://deviq.com/vertical-slices/)).</span></span>

<span data-ttu-id="bd286-273">ASP.NET Core MVC obsługuje obszary do tego celu.</span><span class="sxs-lookup"><span data-stu-id="bd286-273">ASP.NET Core MVC supports Areas for this purpose.</span></span> <span data-ttu-id="bd286-274">Korzystając z obszarów, można utworzyć osobne zestawy kontrolerów i folderów widoków (oraz wszelkich skojarzonych modeli) w każdym folderze obszaru.</span><span class="sxs-lookup"><span data-stu-id="bd286-274">Using areas, you can create separate sets of Controllers and Views folders (as well as any associated models) in each Area folder.</span></span> <span data-ttu-id="bd286-275">Rysunek 7-1 pokazuje przykładową strukturę folderów przy użyciu obszarów.</span><span class="sxs-lookup"><span data-stu-id="bd286-275">Figure 7-1 shows an example folder structure, using Areas.</span></span>

![Przykładowa organizacja obszaru](./media/image7-1.png)

<span data-ttu-id="bd286-277">**Rysunek 7-1**.</span><span class="sxs-lookup"><span data-stu-id="bd286-277">**Figure 7-1**.</span></span> <span data-ttu-id="bd286-278">Przykładowa organizacja obszaru</span><span class="sxs-lookup"><span data-stu-id="bd286-278">Sample Area Organization</span></span>

<span data-ttu-id="bd286-279">W przypadku korzystania z obszarów należy użyć atrybutów do dekorować kontrolerów z nazwą obszaru, do którego należą:</span><span class="sxs-lookup"><span data-stu-id="bd286-279">When using Areas, you must use attributes to decorate your controllers with the name of the area to which they belong:</span></span>

```csharp
[Area("Catalog")]
public class HomeController
{}
```

<span data-ttu-id="bd286-280">Musisz również dodać obsługę obszaru do swoich tras:</span><span class="sxs-lookup"><span data-stu-id="bd286-280">You also need to add area support to your routes:</span></span>

```csharp
app.UseEndpoints(endpoints =>
{
    endpoints.MapControllerRoute(name: "areaRoute", pattern: "{area:exists}/{controller=Home}/{action=Index}/{id?}");
    endpoints.MapControllerRoute(name: "default", pattern: "{controller=Home}/{action=Index}/{id?}");
});
```

<span data-ttu-id="bd286-281">Oprócz wbudowanej obsługi obszarów, można również użyć własnej struktury folderów oraz Konwencji zamiast atrybutów i tras niestandardowych.</span><span class="sxs-lookup"><span data-stu-id="bd286-281">In addition to the built-in support for Areas, you can also use your own folder structure, and conventions in place of attributes and custom routes.</span></span> <span data-ttu-id="bd286-282">Dzięki temu można mieć foldery funkcji, które nie zawierały oddzielnych folderów dla widoków, kontrolerów itp., utrzymując hierarchię Flatter i ułatwiając wyświetlanie wszystkich powiązanych plików w jednym miejscu dla każdej funkcji.</span><span class="sxs-lookup"><span data-stu-id="bd286-282">This would allow you to have feature folders that didn't include separate folders for Views, Controllers, etc., keeping the hierarchy flatter and making it easier to see all related files in a single place for each feature.</span></span>

<span data-ttu-id="bd286-283">ASP.NET Core używa wbudowanych typów Konwencji do sterowania jego zachowaniem.</span><span class="sxs-lookup"><span data-stu-id="bd286-283">ASP.NET Core uses built-in convention types to control its behavior.</span></span> <span data-ttu-id="bd286-284">Możesz zmodyfikować lub zastąpić te konwencje.</span><span class="sxs-lookup"><span data-stu-id="bd286-284">You can modify or replace these conventions.</span></span> <span data-ttu-id="bd286-285">Na przykład można utworzyć Konwencję, która będzie automatycznie pobierać nazwę funkcji dla danego kontrolera na podstawie jego przestrzeni nazw (co zazwyczaj jest skorelowane z folderem, w którym znajduje się kontroler):</span><span class="sxs-lookup"><span data-stu-id="bd286-285">For example, you can create a convention that will automatically get the feature name for a given controller based on its namespace (which typically correlates to the folder in which the controller is located):</span></span>

```csharp
public class FeatureConvention : IControllerModelConvention
{
    public void Apply(ControllerModel controller)
    {
        controller.Properties.Add("feature",
        GetFeatureName(controller.ControllerType));
    }

    private string GetFeatureName(TypeInfo controllerType)
    {
        string[] tokens = controllerType.FullName.Split('.');
        if (!tokens.Any(t => t == "Features")) return "";
        string featureName = tokens
        .SkipWhile(t => !t.Equals("features",
        StringComparison.CurrentCultureIgnoreCase))
        .Skip(1)
        .Take(1)
        .FirstOrDefault();
        return featureName;
    }
}
```

<span data-ttu-id="bd286-286">Następnie należy określić tę Konwencję jako opcję po dodaniu obsługi MVC do aplikacji w ConfigureServices:</span><span class="sxs-lookup"><span data-stu-id="bd286-286">You then specify this convention as an option when you add support for MVC to your application in ConfigureServices:</span></span>

```csharp
services.AddMvc(o => o.Conventions.Add(new FeatureConvention()));
```

<span data-ttu-id="bd286-287">ASP.NET Core MVC używa również Konwencji do lokalizowania widoków.</span><span class="sxs-lookup"><span data-stu-id="bd286-287">ASP.NET Core MVC also uses a convention to locate views.</span></span> <span data-ttu-id="bd286-288">Można zastąpić go Konwencją niestandardową, aby widoki znajdowały się w folderach funkcji (przy użyciu nazwy funkcji dostarczonej przez FeatureConvention).</span><span class="sxs-lookup"><span data-stu-id="bd286-288">You can override it with a custom convention so that views will be located in your feature folders (using the feature name provided by the FeatureConvention, above).</span></span> <span data-ttu-id="bd286-289">Możesz dowiedzieć się więcej o tym podejściu i pobrać przykład roboczy z artykułu magazynowego MSDN, [wycinki funkcji dla ASP.NET Core MVC](/archive/msdn-magazine/2016/september/asp-net-core-feature-slices-for-asp-net-core-mvc).</span><span class="sxs-lookup"><span data-stu-id="bd286-289">You can learn more about this approach and download a working sample from the MSDN Magazine article, [Feature Slices for ASP.NET Core MVC](/archive/msdn-magazine/2016/september/asp-net-core-feature-slices-for-asp-net-core-mvc).</span></span>

### <a name="apis-and-no-locblazor-applications"></a><span data-ttu-id="bd286-290">Interfejsy API i Blazor aplikacje</span><span class="sxs-lookup"><span data-stu-id="bd286-290">APIs and Blazor applications</span></span>

<span data-ttu-id="bd286-291">Jeśli aplikacja zawiera zestaw interfejsów API sieci Web, które muszą być zabezpieczone, te interfejsy API należy najlepiej skonfigurować jako oddzielny projekt z widoku lub aplikacji Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="bd286-291">If your application includes a set of web APIs, which must be secured, these apis should ideally be configured as a separate project from your View or Razor Pages application.</span></span> <span data-ttu-id="bd286-292">Oddzielanie interfejsów API, szczególnie publicznych interfejsów API, z aplikacji sieci Web po stronie serwera ma wiele korzyści.</span><span class="sxs-lookup"><span data-stu-id="bd286-292">Separating APIs, especially public APIs, from your server-side web application has a number of benefits.</span></span> <span data-ttu-id="bd286-293">Te aplikacje często będą mieć unikatowe charakterystyki wdrożenia i obciążenia.</span><span class="sxs-lookup"><span data-stu-id="bd286-293">These applications often will have unique deployment and load characteristics.</span></span> <span data-ttu-id="bd286-294">Są one również bardzo prawdopodobnie do wdrażania różnych mechanizmów zabezpieczeń, dzięki standardowym aplikacjom opartym na formularzach, wykorzystującym uwierzytelnianie oparte na plikach cookie i interfejsy API najprawdopodobniej przy użyciu uwierzytelniania opartego na tokenach.</span><span class="sxs-lookup"><span data-stu-id="bd286-294">They're also very likely to adopt different mechanisms for security, with standard form-based applications leveraging cookie-based authentication and APIs most likely using token-based authentication.</span></span>

<span data-ttu-id="bd286-295">Ponadto Blazor aplikacje, bez względu na to, czy program korzysta z Blazor serwera, czy też Blazor WebAssembly , powinny być skompilowane jako oddzielne projekty.</span><span class="sxs-lookup"><span data-stu-id="bd286-295">Additionally, Blazor applications, whether using Blazor Server or Blazor WebAssembly, should be built as separate projects.</span></span> <span data-ttu-id="bd286-296">Aplikacje mają różne charakterystyki środowiska uruchomieniowego, a także modele zabezpieczeń.</span><span class="sxs-lookup"><span data-stu-id="bd286-296">The applications have different runtime characteristics as well as security models.</span></span> <span data-ttu-id="bd286-297">Mogą współużytkować typowe typy z aplikacją sieci Web po stronie serwera (lub projektem interfejsu API), a typy te powinny być zdefiniowane we wspólnym projekcie udostępnionym.</span><span class="sxs-lookup"><span data-stu-id="bd286-297">They're likely to share common types with the server-side web application (or API project), and these types should be defined in a common shared project.</span></span>

<span data-ttu-id="bd286-298">Dodanie Blazor WebAssembly interfejsu administratora do eShopOnWeb wymaga dodania kilku nowych projektów.</span><span class="sxs-lookup"><span data-stu-id="bd286-298">The addition of a Blazor WebAssembly admin interface to eShopOnWeb required adding several new projects.</span></span> <span data-ttu-id="bd286-299">Blazor WebAssembly Sam projekt, `BlazorAdmin` .</span><span class="sxs-lookup"><span data-stu-id="bd286-299">The Blazor WebAssembly project itself, `BlazorAdmin`.</span></span> <span data-ttu-id="bd286-300">Nowy zestaw publicznych punktów końcowych interfejsu API używany przez program `BlazorAdmin` i skonfigurowany do korzystania z uwierzytelniania opartego na tokenach jest zdefiniowany w `PublicApi` projekcie.</span><span class="sxs-lookup"><span data-stu-id="bd286-300">A new set of public API endpoints, used by `BlazorAdmin` and configured to use token-based authentication, is defined in the `PublicApi` project.</span></span> <span data-ttu-id="bd286-301">Niektóre typy udostępnione używane przez oba te projekty są przechowywane w nowym `BlazorShared` projekcie.</span><span class="sxs-lookup"><span data-stu-id="bd286-301">And certain shared types used by both of these projects are kept in a new `BlazorShared` project.</span></span>

<span data-ttu-id="bd286-302">Jeden z nich może zadawać, dlaczego należy dodać oddzielny `BlazorShared` projekt, jeśli istnieje już wspólny `ApplicationCore` projekt, którego można użyć do udostępniania dowolnego typu wymaganego przez oba `PublicApi` i `BlazorAdmin` ?</span><span class="sxs-lookup"><span data-stu-id="bd286-302">One might ask, why add a separate `BlazorShared` project when there is already a common `ApplicationCore` project that could be used to share any types required by both `PublicApi` and `BlazorAdmin`?</span></span> <span data-ttu-id="bd286-303">Odpowiedź polega na tym, że ten projekt zawiera całą logikę biznesową aplikacji i jest dużo większy niż to konieczne, a także znacznie bardziej niezbędny jest bezpieczny na serwerze.</span><span class="sxs-lookup"><span data-stu-id="bd286-303">The answer is that this project includes all of the application's business logic and is thus much larger than necessary and also much more likely to need to be kept secure on the server.</span></span> <span data-ttu-id="bd286-304">Należy pamiętać, że każda biblioteka, do której odwołuje się `BlazorAdmin` program, zostanie pobrana do przeglądarek użytkowników podczas ładowania Blazor aplikacji.</span><span class="sxs-lookup"><span data-stu-id="bd286-304">Remember that any library referenced by `BlazorAdmin` will be downloaded to users' browsers when they load the Blazor application.</span></span>

<span data-ttu-id="bd286-305">W zależności od tego, czy jest używany [wzorzec frontonu (BFF)](/azure/architecture/patterns/backends-for-frontends), interfejsy API używane przez Blazor WebAssembly aplikację nie mogą udostępniać ich typów 100% z Blazor .</span><span class="sxs-lookup"><span data-stu-id="bd286-305">Depending on whether one is using the [Backends-For-Frontends (BFF) pattern](/azure/architecture/patterns/backends-for-frontends), the APIs consumed by the Blazor WebAssembly app may not share their types 100% with Blazor.</span></span> <span data-ttu-id="bd286-306">W szczególności publiczny interfejs API, który ma być używany przez wielu różnych klientów, może definiować własne żądanie i typy wyników, zamiast udostępniać je w projekcie udostępnionym specyficznym dla klienta.</span><span class="sxs-lookup"><span data-stu-id="bd286-306">In particular, a public API that's meant to be consumed by many different clients may define its own request and result types, rather than sharing them in a client-specific shared project.</span></span> <span data-ttu-id="bd286-307">W przykładzie eShopOnWeb założono, że `PublicApi` projekt jest w rzeczywistości hostem publicznego interfejsu API, dlatego nie wszystkie typy żądań i odpowiedzi pochodzą z `BlazorShared` projektu.</span><span class="sxs-lookup"><span data-stu-id="bd286-307">In the eShopOnWeb sample, the assumption is being made that the `PublicApi` project is, in fact, hosting a public API, so not all of its request and response types come from the `BlazorShared` project.</span></span>

### <a name="cross-cutting-concerns"></a><span data-ttu-id="bd286-308">Zagadnienia ogólne</span><span class="sxs-lookup"><span data-stu-id="bd286-308">Cross-cutting concerns</span></span>

<span data-ttu-id="bd286-309">Po rozbudowywaniu aplikacji coraz bardziej ważne jest, aby wyeliminować problemy związane z wycinaniem i zachować spójność.</span><span class="sxs-lookup"><span data-stu-id="bd286-309">As applications grow, it becomes increasingly important to factor out cross-cutting concerns to eliminate duplication and maintain consistency.</span></span> <span data-ttu-id="bd286-310">Niektóre przykłady zagadnień związanych z obcinaniem w aplikacjach ASP.NET Core to uwierzytelnianie, reguły walidacji modelu, buforowanie danych wyjściowych i obsługa błędów, chociaż istnieje wiele innych.</span><span class="sxs-lookup"><span data-stu-id="bd286-310">Some examples of cross-cutting concerns in ASP.NET Core applications are authentication, model validation rules, output caching, and error handling, though there are many others.</span></span> <span data-ttu-id="bd286-311">ASP.NET Core [filtry](/aspnet/core/mvc/controllers/filters) MVC umożliwiają uruchamianie kodu przed określonymi krokami w potoku przetwarzania żądań lub po nich.</span><span class="sxs-lookup"><span data-stu-id="bd286-311">ASP.NET Core MVC [filters](/aspnet/core/mvc/controllers/filters) allow you to run code before or after certain steps in the request processing pipeline.</span></span> <span data-ttu-id="bd286-312">Na przykład filtr może zostać uruchomiony przed i po powiązaniu modelu, przed i po akcji lub przed i po wyniku akcji.</span><span class="sxs-lookup"><span data-stu-id="bd286-312">For instance, a filter can run before and after model binding, before and after an action, or before and after an action's result.</span></span> <span data-ttu-id="bd286-313">Można również użyć filtru autoryzacji, aby kontrolować dostęp do reszty potoku.</span><span class="sxs-lookup"><span data-stu-id="bd286-313">You can also use an authorization filter to control access to the rest of the pipeline.</span></span> <span data-ttu-id="bd286-314">Ilustracje 7-2 pokazuje, w jaki sposób przepływają żądania wykonania przez filtry, jeśli są skonfigurowane.</span><span class="sxs-lookup"><span data-stu-id="bd286-314">Figures 7-2 shows how request execution flows through filters, if configured.</span></span>

![Żądanie jest przetwarzane przez filtry autoryzacji, filtry zasobów, powiązania modelu, filtry akcji, wykonywanie akcji i konwersję wyników akcji, filtry wyjątków, filtry wynikowe i wykonywanie wyniku.](./media/image7-2.png)

<span data-ttu-id="bd286-317">**Rysunek 7-2**.</span><span class="sxs-lookup"><span data-stu-id="bd286-317">**Figure 7-2**.</span></span> <span data-ttu-id="bd286-318">Zażądaj wykonania przez filtry i potok żądań.</span><span class="sxs-lookup"><span data-stu-id="bd286-318">Request execution through filters and request pipeline.</span></span>

<span data-ttu-id="bd286-319">Filtry są zwykle zaimplementowane jako atrybuty, więc można je stosować do kontrolerów lub akcji (lub nawet globalnie).</span><span class="sxs-lookup"><span data-stu-id="bd286-319">Filters are usually implemented as attributes, so you can apply them to controllers or actions (or even globally).</span></span> <span data-ttu-id="bd286-320">Po dodaniu w ten sposób filtry określone na poziomie akcji przesłaniają lub kompilują przy użyciu filtrów określonych na poziomie kontrolera, które same przesłaniają filtry globalne.</span><span class="sxs-lookup"><span data-stu-id="bd286-320">When added in this fashion, filters specified at the action level override or build upon filters specified at the controller level, which themselves override global filters.</span></span> <span data-ttu-id="bd286-321">Na przykład \[ \] atrybut trasy może służyć do tworzenia tras między kontrolerami i akcjami.</span><span class="sxs-lookup"><span data-stu-id="bd286-321">For example, the \[Route\] attribute can be used to build up routes between controllers and actions.</span></span> <span data-ttu-id="bd286-322">Podobnie można skonfigurować autoryzację na poziomie kontrolera, a następnie przesłonić poszczególne akcje, jak pokazano w poniższym przykładzie:</span><span class="sxs-lookup"><span data-stu-id="bd286-322">Likewise, authorization can be configured at the controller level, and then overridden by individual actions, as the following sample demonstrates:</span></span>

```csharp
[Authorize]
public class AccountController : Controller

{
    [AllowAnonymous] // overrides the Authorize attribute
    public async Task<IActionResult> Login() {}
    public async Task<IActionResult> ForgotPassword() {}
}
```

<span data-ttu-id="bd286-323">Pierwsza metoda, login, używa filtru AllowAnonymous (atrybut), aby zastąpić filtr autoryzacji ustawiony na poziomie kontrolera.</span><span class="sxs-lookup"><span data-stu-id="bd286-323">The first method, Login, uses the AllowAnonymous filter (attribute) to override the Authorize filter set at the controller level.</span></span> <span data-ttu-id="bd286-324">Akcja ForgotPassword (i jakakolwiek inna akcja w klasie, która nie ma atrybutu AllowAnonymous) będzie wymagała uwierzytelnionego żądania.</span><span class="sxs-lookup"><span data-stu-id="bd286-324">The ForgotPassword action (and any other action in the class that doesn't have an AllowAnonymous attribute) will require an authenticated request.</span></span>

<span data-ttu-id="bd286-325">Filtry mogą służyć do eliminacji duplikatów w postaci typowych zasad obsługi błędów dla interfejsów API.</span><span class="sxs-lookup"><span data-stu-id="bd286-325">Filters can be used to eliminate duplication in the form of common error handling policies for APIs.</span></span> <span data-ttu-id="bd286-326">Na przykład typowe zasady interfejsu API to zwrócenie odpowiedzi NotFound do żądań odwołujących się do kluczy, które nie istnieją, i odpowiedzi nieprawidłowego żądania, jeśli Walidacja modelu kończy się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="bd286-326">For example, a typical API policy is to return a NotFound response to requests referencing keys that do not exist, and a BadRequest response if model validation fails.</span></span> <span data-ttu-id="bd286-327">Poniższy przykład ilustruje te dwie zasady w działaniu:</span><span class="sxs-lookup"><span data-stu-id="bd286-327">The following example demonstrates these two policies in action:</span></span>

```csharp
[HttpPut("{id}")]
public async Task<IActionResult> Put(int id, [FromBody]Author author)
{
    if ((await _authorRepository.ListAsync()).All(a => a.Id != id))
    {
        return NotFound(id);
    }
    if (!ModelState.IsValid)
    {
        return BadRequest(ModelState);
    }
    author.Id = id;
    await _authorRepository.UpdateAsync(author);
    return Ok();
}
```

<span data-ttu-id="bd286-328">Nie należy zezwalać na bałaganie metod akcji przy użyciu kodu warunkowego, takiego jak ten.</span><span class="sxs-lookup"><span data-stu-id="bd286-328">Don't allow your action methods to become cluttered with conditional code like this.</span></span> <span data-ttu-id="bd286-329">Zamiast tego należy ściągnąć zasady do filtrów, które mogą być stosowane w zależności od tego, co jest potrzebne.</span><span class="sxs-lookup"><span data-stu-id="bd286-329">Instead, pull the policies into filters that can be applied on an as-needed basis.</span></span> <span data-ttu-id="bd286-330">W tym przykładzie sprawdzanie poprawności modelu, który powinien wystąpić za każdym razem, gdy polecenie jest wysyłane do interfejsu API, może być zastąpione przez następujący atrybut:</span><span class="sxs-lookup"><span data-stu-id="bd286-330">In this example, the model validation check, which should occur anytime a command is sent to the API, can be replaced by the following attribute:</span></span>

```csharp
public class ValidateModelAttribute : ActionFilterAttribute
{
    public override void OnActionExecuting(ActionExecutingContext context)
    {
        if (!context.ModelState.IsValid)
        {
            context.Result = new BadRequestObjectResult(context.ModelState);
        }
    }
}
```

<span data-ttu-id="bd286-331">Można dodać `ValidateModelAttribute` do projektu jako zależność NuGet, dołączając pakiet [Ardalis. ValidateModel](https://www.nuget.org/packages/Ardalis.ValidateModel) .</span><span class="sxs-lookup"><span data-stu-id="bd286-331">You can add the `ValidateModelAttribute` to your project as a NuGet dependency by including the [Ardalis.ValidateModel](https://www.nuget.org/packages/Ardalis.ValidateModel) package.</span></span> <span data-ttu-id="bd286-332">W przypadku interfejsów API można użyć `ApiController` atrybutu, aby wymusić to zachowanie bez potrzeby osobnego `ValidateModel` filtru.</span><span class="sxs-lookup"><span data-stu-id="bd286-332">For APIs, you can use the `ApiController` attribute to enforce this behavior without the need for a separate `ValidateModel` filter.</span></span>

<span data-ttu-id="bd286-333">Analogicznie, filtr może służyć do sprawdzenia, czy rekord istnieje i zwrócić 404 przed wykonaniem akcji, eliminując konieczność wykonywania tych testów w akcji.</span><span class="sxs-lookup"><span data-stu-id="bd286-333">Likewise, a filter can be used to check if a record exists and return a 404 before the action is executed, eliminating the need to perform these checks in the action.</span></span> <span data-ttu-id="bd286-334">Po pobraniu wspólnych Konwencji i zorganizowaniu rozwiązania w celu oddzielenia kodu infrastruktury i logiki biznesowej od interfejsu użytkownika, metody akcji MVC powinny być niezwykle cienkie:</span><span class="sxs-lookup"><span data-stu-id="bd286-334">Once you've pulled out common conventions and organized your solution to separate infrastructure code and business logic from your UI, your MVC action methods should be extremely thin:</span></span>

```csharp
[HttpPut("{id}")]
[ValidateAuthorExists]
public async Task<IActionResult> Put(int id, [FromBody]Author author)
{
    await _authorRepository.UpdateAsync(author);
    return Ok();
}
```

<span data-ttu-id="bd286-335">Aby dowiedzieć się więcej na temat implementowania filtrów i pobrać przykład roboczy z magazynu MSDN, zobacz [Real-World ASP.NET Core filters MVC](/archive/msdn-magazine/2016/august/asp-net-core-real-world-asp-net-core-mvc-filters).</span><span class="sxs-lookup"><span data-stu-id="bd286-335">You can read more about implementing filters and download a working sample from the MSDN Magazine article, [Real-World ASP.NET Core MVC Filters](/archive/msdn-magazine/2016/august/asp-net-core-real-world-asp-net-core-mvc-filters).</span></span>

> ### <a name="references--structuring-applications"></a><span data-ttu-id="bd286-336">References — Tworzenie struktury aplikacji</span><span class="sxs-lookup"><span data-stu-id="bd286-336">References – Structuring applications</span></span>
>
> - <span data-ttu-id="bd286-337">**Obszarach**</span><span class="sxs-lookup"><span data-stu-id="bd286-337">**Areas**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/mvc/controllers/areas>
> - <span data-ttu-id="bd286-338">**Magazyn MSDN — wycinki funkcji dla ASP.NET Core MVC**</span><span class="sxs-lookup"><span data-stu-id="bd286-338">**MSDN Magazine – Feature Slices for ASP.NET Core MVC**</span></span>\
>   <https://docs.microsoft.com/archive/msdn-magazine/2016/september/asp-net-core-feature-slices-for-asp-net-core-mvc>
> - <span data-ttu-id="bd286-339">**Filtry**</span><span class="sxs-lookup"><span data-stu-id="bd286-339">**Filters**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/mvc/controllers/filters>
> - <span data-ttu-id="bd286-340">**MSDN Magazine — Real World ASP.NET Core Filters**</span><span class="sxs-lookup"><span data-stu-id="bd286-340">**MSDN Magazine – Real World ASP.NET Core MVC Filters**</span></span>\
>   <https://docs.microsoft.com/archive/msdn-magazine/2016/august/asp-net-core-real-world-asp-net-core-mvc-filters>

## <a name="security"></a><span data-ttu-id="bd286-341">Zabezpieczenia</span><span class="sxs-lookup"><span data-stu-id="bd286-341">Security</span></span>

<span data-ttu-id="bd286-342">Zabezpieczanie aplikacji sieci Web to duży temat z wieloma kwestiami.</span><span class="sxs-lookup"><span data-stu-id="bd286-342">Securing web applications is a large topic, with many considerations.</span></span> <span data-ttu-id="bd286-343">Na najbardziej podstawowym poziomie zabezpieczenia polegają na tym, że wiesz, z kogo pochodzi żądanie, a następnie upewniając się, że żądanie ma tylko dostęp do zasobów, które powinny.</span><span class="sxs-lookup"><span data-stu-id="bd286-343">At its most basic level, security involves ensuring you know who a given request is coming from, and then ensuring that the request only has access to resources it should.</span></span> <span data-ttu-id="bd286-344">Uwierzytelnianie to proces porównujący poświadczenia dostarczone z żądaniem do tych w zaufanym magazynie danych, aby sprawdzić, czy żądanie powinno być traktowane jako pochodzące ze znanej jednostki.</span><span class="sxs-lookup"><span data-stu-id="bd286-344">Authentication is the process of comparing credentials provided with a request to those in a trusted data store, to see if the request should be treated as coming from a known entity.</span></span> <span data-ttu-id="bd286-345">Autoryzacja to proces ograniczania dostępu do określonych zasobów na podstawie tożsamości użytkownika.</span><span class="sxs-lookup"><span data-stu-id="bd286-345">Authorization is the process of restricting access to certain resources based on user identity.</span></span> <span data-ttu-id="bd286-346">Trzeci problem dotyczący zabezpieczeń chroni żądania przed podsłuchiwaniem przez inne osoby, dla którego należy [upewnić się, że protokół SSL jest używany przez aplikację](/aspnet/core/security/enforcing-ssl).</span><span class="sxs-lookup"><span data-stu-id="bd286-346">A third security concern is protecting requests from eavesdropping by third parties, for which you should at least [ensure that SSL is used by your application](/aspnet/core/security/enforcing-ssl).</span></span>

### <a name="identity"></a><span data-ttu-id="bd286-347">Tożsamość</span><span class="sxs-lookup"><span data-stu-id="bd286-347">Identity</span></span>

<span data-ttu-id="bd286-348">ASP.NET Core tożsamością jest system członkostwa, którego można użyć do obsługi funkcji logowania dla aplikacji.</span><span class="sxs-lookup"><span data-stu-id="bd286-348">ASP.NET Core Identity is a membership system you can use to support login functionality for your application.</span></span> <span data-ttu-id="bd286-349">Obsługuje ona konta użytkowników lokalnych, a także dostawcę logowania zewnętrznego od dostawców, takich jak konto Microsoft, Twitter, Facebook, Google i inne.</span><span class="sxs-lookup"><span data-stu-id="bd286-349">It has support for local user accounts as well as external login provider support from providers like Microsoft Account, Twitter, Facebook, Google, and more.</span></span> <span data-ttu-id="bd286-350">Oprócz tożsamości ASP.NET Core aplikacja może korzystać z uwierzytelniania systemu Windows lub innego dostawcy tożsamości, takiego jak [serwer tożsamości](https://github.com/IdentityServer/IdentityServer4).</span><span class="sxs-lookup"><span data-stu-id="bd286-350">In addition to ASP.NET Core Identity, your application can use windows authentication, or a third-party identity provider like [Identity Server](https://github.com/IdentityServer/IdentityServer4).</span></span>

<span data-ttu-id="bd286-351">ASP.NET Core tożsamość jest dołączana do nowych szablonów projektu, jeśli wybrano opcję konta poszczególnych użytkowników.</span><span class="sxs-lookup"><span data-stu-id="bd286-351">ASP.NET Core Identity is included in new project templates if the Individual User Accounts option is selected.</span></span> <span data-ttu-id="bd286-352">Ten szablon obejmuje obsługę rejestracji, logowania, logowania zewnętrznego, zapomnianych haseł i dodatkowych funkcji.</span><span class="sxs-lookup"><span data-stu-id="bd286-352">This template includes support for registration, login, external logins, forgotten passwords, and additional functionality.</span></span>

![Wybieranie kont poszczególnych użytkowników w celu skonfigurowania tożsamości](./media/image7-3.png)

<span data-ttu-id="bd286-354">**Rysunek 7-3**.</span><span class="sxs-lookup"><span data-stu-id="bd286-354">**Figure 7-3**.</span></span> <span data-ttu-id="bd286-355">Wybierz opcję konta poszczególnych użytkowników, aby mieć wstępnie skonfigurowaną tożsamość.</span><span class="sxs-lookup"><span data-stu-id="bd286-355">Select Individual User Accounts to have Identity preconfigured.</span></span>

<span data-ttu-id="bd286-356">Obsługa tożsamości jest konfigurowana podczas uruchamiania, zarówno w ConfigureServices, jak i w konfiguracji:</span><span class="sxs-lookup"><span data-stu-id="bd286-356">Identity support is configured in Startup, both in ConfigureServices and Configure:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    // Add framework services.
    services.AddDbContext<ApplicationDbContext>(options =>
    options.UseSqlServer(Configuration.GetConnectionString("DefaultConnection")));
    services.AddIdentity<ApplicationUser, IdentityRole>()
        .AddEntityFrameworkStores<ApplicationDbContext>()
        .AddDefaultTokenProviders();
    services.AddMvc();
}

public void Configure(IApplicationBuilder app)
{
    app.UseStaticFiles();
    app.UseIdentity();
    app.UseEndpoints(endpoints =>
    {
        endpoints.MapControllerRoute(name: "default", pattern: "{controller=Home}/{action=Index}/{id?}");
    });
}
```

<span data-ttu-id="bd286-357">Ważne jest, aby UseIdentity pojawił się przed UseMvc w metodzie Configure.</span><span class="sxs-lookup"><span data-stu-id="bd286-357">It's important that UseIdentity appear before UseMvc in the Configure method.</span></span> <span data-ttu-id="bd286-358">Podczas konfigurowania tożsamości w programie ConfigureServices należy zauważyć wywołanie AddDefaultTokenProviders.</span><span class="sxs-lookup"><span data-stu-id="bd286-358">When configuring Identity in ConfigureServices, you'll notice a call to AddDefaultTokenProviders.</span></span> <span data-ttu-id="bd286-359">Nie ma nic do wykonania w przypadku tokenów, które mogą być używane do zabezpieczania komunikacji w sieci Web, ale zamiast tego odnoszą się do dostawców, którzy tworzą monity, które mogą być wysyłane do użytkowników za pośrednictwem wiadomości SMS lub poczty e-mail w celu potwierdzenia tożsamości.</span><span class="sxs-lookup"><span data-stu-id="bd286-359">This has nothing to do with tokens that may be used to secure web communications, but instead refers to providers that create prompts that can be sent to users via SMS or email in order for them to confirm their identity.</span></span>

<span data-ttu-id="bd286-360">Więcej informacji na temat [konfigurowania uwierzytelniania dwuskładnikowego](/aspnet/core/security/authentication/2fa) i [włączania zewnętrznych dostawców logowania](/aspnet/core/security/authentication/social/) można znaleźć w oficjalnym ASP.NET Core dokumentach.</span><span class="sxs-lookup"><span data-stu-id="bd286-360">You can learn more about [configuring two-factor authentication](/aspnet/core/security/authentication/2fa) and [enabling external login providers](/aspnet/core/security/authentication/social/) from the official ASP.NET Core docs.</span></span>

### <a name="authentication"></a><span data-ttu-id="bd286-361">Authentication</span><span class="sxs-lookup"><span data-stu-id="bd286-361">Authentication</span></span>

<span data-ttu-id="bd286-362">Uwierzytelnianie to proces określania, kto uzyskuje dostęp do systemu.</span><span class="sxs-lookup"><span data-stu-id="bd286-362">Authentication is the process of determining who is accessing the system.</span></span> <span data-ttu-id="bd286-363">Jeśli używasz tożsamości ASP.NET Core i metod konfiguracji przedstawionych w poprzedniej sekcji, spowoduje to automatyczne skonfigurowanie niektórych ustawień uwierzytelniania w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="bd286-363">If you're using ASP.NET Core Identity and the configuration methods shown in the previous section, it will automatically configure some authentication defaults in the application.</span></span> <span data-ttu-id="bd286-364">Można jednak również skonfigurować te ustawienia domyślne ręcznie lub zastąpić je zestawem AddIdentity.</span><span class="sxs-lookup"><span data-stu-id="bd286-364">However, you can also configure these defaults manually, or override the ones set by AddIdentity.</span></span> <span data-ttu-id="bd286-365">Jeśli używasz tożsamości, konfiguruje uwierzytelnianie oparte na plikach cookie jako *schemat* domyślny.</span><span class="sxs-lookup"><span data-stu-id="bd286-365">If you're using Identity, it configures cookie-based authentication as the default *scheme*.</span></span>

<span data-ttu-id="bd286-366">W przypadku uwierzytelniania opartego na sieci Web w programie istnieje zazwyczaj pięć akcji, które mogą być wykonywane w trakcie uwierzytelniania klienta systemu.</span><span class="sxs-lookup"><span data-stu-id="bd286-366">In web-based authentication, there are typically up to five actions that may be performed in the course of authenticating a client of a system.</span></span> <span data-ttu-id="bd286-367">Są to:</span><span class="sxs-lookup"><span data-stu-id="bd286-367">These are:</span></span>

- <span data-ttu-id="bd286-368">Potwierdza.</span><span class="sxs-lookup"><span data-stu-id="bd286-368">Authenticate.</span></span> <span data-ttu-id="bd286-369">Użyj informacji dostarczonych przez klienta, aby utworzyć tożsamość do użycia w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="bd286-369">Use the information provided by the client to create an identity for them to use within the application.</span></span>
- <span data-ttu-id="bd286-370">Sprawdz.</span><span class="sxs-lookup"><span data-stu-id="bd286-370">Challenge.</span></span> <span data-ttu-id="bd286-371">Ta akcja służy do wymagania, aby klient mógł identyfikować siebie.</span><span class="sxs-lookup"><span data-stu-id="bd286-371">This action is used to require the client to identify themselves.</span></span>
- <span data-ttu-id="bd286-372">Uniemożliwia.</span><span class="sxs-lookup"><span data-stu-id="bd286-372">Forbid.</span></span> <span data-ttu-id="bd286-373">Informowanie klienta, aby nie wykonywał akcji.</span><span class="sxs-lookup"><span data-stu-id="bd286-373">Inform the client they are forbidden from performing an action.</span></span>
- <span data-ttu-id="bd286-374">Logowanie.</span><span class="sxs-lookup"><span data-stu-id="bd286-374">Sign-in.</span></span> <span data-ttu-id="bd286-375">W jakiś sposób Utrwalaj istniejącego klienta.</span><span class="sxs-lookup"><span data-stu-id="bd286-375">Persist the existing client in some way.</span></span>
- <span data-ttu-id="bd286-376">Wyloguj się. Usuń klienta z trwałości.</span><span class="sxs-lookup"><span data-stu-id="bd286-376">Sign-out. Remove the client from persistence.</span></span>

<span data-ttu-id="bd286-377">Istnieje kilka typowych technik uwierzytelniania w aplikacjach sieci Web.</span><span class="sxs-lookup"><span data-stu-id="bd286-377">There are a number of common techniques for performing authentication in web applications.</span></span> <span data-ttu-id="bd286-378">Są one nazywane schematami.</span><span class="sxs-lookup"><span data-stu-id="bd286-378">These are referred to as schemes.</span></span> <span data-ttu-id="bd286-379">Dany schemat definiuje akcje dla niektórych lub wszystkich powyższych opcji.</span><span class="sxs-lookup"><span data-stu-id="bd286-379">A given scheme will define actions for some or all of the above options.</span></span> <span data-ttu-id="bd286-380">Niektóre schematy obsługują tylko podzbiór akcji i mogą wymagać oddzielnego schematu, aby wykonać te czynności, które nie są obsługiwane.</span><span class="sxs-lookup"><span data-stu-id="bd286-380">Some schemes only support a subset of actions, and may require a separate scheme to perform those it does not support.</span></span> <span data-ttu-id="bd286-381">Na przykład schemat OpenId-Connect (OIDC) nie obsługuje logowania ani wylogowywania, ale jest często skonfigurowany do korzystania z uwierzytelniania plików cookie dla tej trwałości.</span><span class="sxs-lookup"><span data-stu-id="bd286-381">For example, the OpenId-Connect (OIDC) scheme doesn't support Sign-in or Sign-out, but is commonly configured to use Cookie authentication for this persistence.</span></span>

<span data-ttu-id="bd286-382">W aplikacji ASP.NET Core można skonfigurować `DefaultAuthenticateScheme` oraz opcjonalne określone schematy dla każdej akcji opisanej powyżej.</span><span class="sxs-lookup"><span data-stu-id="bd286-382">In your ASP.NET Core application, you can configure a `DefaultAuthenticateScheme` as well as optional specific schemes for each of the actions described above.</span></span> <span data-ttu-id="bd286-383">Na przykład, `DefaultChallengeScheme` `DefaultForbidScheme` itp. Wywołanie [`AddIdentity<TUser,TRole>`](https://github.com/dotnet/aspnetcore/blob/release/3.1/src/Identity/Core/src/IdentityServiceCollectionExtensions.cs#L38-L102) konfiguruje kilka aspektów aplikacji i dodaje wiele wymaganych usług.</span><span class="sxs-lookup"><span data-stu-id="bd286-383">For example, `DefaultChallengeScheme`, `DefaultForbidScheme`, etc. Calling [`AddIdentity<TUser,TRole>`](https://github.com/dotnet/aspnetcore/blob/release/3.1/src/Identity/Core/src/IdentityServiceCollectionExtensions.cs#L38-L102) configures a number of aspects of the application and adds many required services.</span></span> <span data-ttu-id="bd286-384">Obejmuje to również wywołanie konfigurowania schematu uwierzytelniania:</span><span class="sxs-lookup"><span data-stu-id="bd286-384">It also includes this call to configure the authentication scheme:</span></span>

```csharp
services.AddAuthentication(options =>
{
    options.DefaultAuthenticateScheme = IdentityConstants.ApplicationScheme;
    options.DefaultChallengeScheme = IdentityConstants.ApplicationScheme;
    options.DefaultSignInScheme = IdentityConstants.ExternalScheme;
});
```

<span data-ttu-id="bd286-385">Te schematy używają plików cookie w celu zapewnienia trwałości i przekierowania do stron logowania w celu uwierzytelniania domyślnego.</span><span class="sxs-lookup"><span data-stu-id="bd286-385">These schemes use cookies for persistence and redirection to login pages for authentication by default.</span></span> <span data-ttu-id="bd286-386">Te schematy są odpowiednie dla aplikacji sieci Web, które współpracują z użytkownikami za pośrednictwem przeglądarek sieci Web, ale nie są zalecane dla interfejsów API.</span><span class="sxs-lookup"><span data-stu-id="bd286-386">These schemes are appropriate for web applications that interact with users via web browsers, but not recommended for APIs.</span></span> <span data-ttu-id="bd286-387">Zamiast tego interfejsy API zwykle używają innej formy uwierzytelniania, takiej jak tokeny okaziciela JWT.</span><span class="sxs-lookup"><span data-stu-id="bd286-387">Instead, APIs will typically use another form of authentication, such as JWT bearer tokens.</span></span>

<span data-ttu-id="bd286-388">Interfejsy API sieci Web są używane przez kod, taki jak `HttpClient` aplikacje .NET i równoważne typy w innych strukturach.</span><span class="sxs-lookup"><span data-stu-id="bd286-388">Web APIs are consumed by code, such as `HttpClient` in .NET applications and equivalent types in other frameworks.</span></span> <span data-ttu-id="bd286-389">Ci klienci oczekują użytecznej odpowiedzi z wywołania interfejsu API lub kodu stanu wskazującego, czy wystąpił problem.</span><span class="sxs-lookup"><span data-stu-id="bd286-389">These clients expect a usable response from an API call, or a status code indicating what, if any, problem has occurred.</span></span> <span data-ttu-id="bd286-390">Ci klienci nie korzystają z przeglądarki i nie renderują kodu HTML ani nie mogą z nimi korzystać.</span><span class="sxs-lookup"><span data-stu-id="bd286-390">These clients are not interacting through a browser and do not render or interact with any HTML that an API might return.</span></span> <span data-ttu-id="bd286-391">Z tego względu nie są odpowiednie dla punktów końcowych interfejsu API, aby przekierować klientów do stron logowania, jeśli nie są uwierzytelnione.</span><span class="sxs-lookup"><span data-stu-id="bd286-391">Thus, it is not appropriate for API endpoints to redirect their clients to login pages if they are not authenticated.</span></span> <span data-ttu-id="bd286-392">Inny schemat jest bardziej odpowiedni.</span><span class="sxs-lookup"><span data-stu-id="bd286-392">Another scheme is more appropriate.</span></span>

<span data-ttu-id="bd286-393">Aby skonfigurować uwierzytelnianie dla interfejsów API, można skonfigurować uwierzytelnianie podobne do następujących, które są używane przez `PublicApi` projekt w aplikacji eShopOnWeb Reference:</span><span class="sxs-lookup"><span data-stu-id="bd286-393">To configure authentication for APIs, you might set up authentication like the following, used by the `PublicApi` project in the eShopOnWeb reference application:</span></span>

```csharp
services.AddAuthentication(config =>
{
    config.DefaultScheme = JwtBearerDefaults.AuthenticationScheme;
})
    .AddJwtBearer(config =>
    {
        config.RequireHttpsMetadata = false;
        config.SaveToken = true;
        config.TokenValidationParameters = new TokenValidationParameters
        {
            ValidateIssuerSigningKey = true,
            IssuerSigningKey = new SymmetricSecurityKey(key),
            ValidateIssuer = false,
            ValidateAudience = false
        };
    });
```

<span data-ttu-id="bd286-394">Chociaż istnieje możliwość skonfigurowania wielu różnych schematów uwierzytelniania w ramach jednego projektu, można skonfigurować jeden domyślny schemat.</span><span class="sxs-lookup"><span data-stu-id="bd286-394">While it is possible to configure multiple different authentication schemes within a single project, it is much simpler to configure a single default scheme.</span></span> <span data-ttu-id="bd286-395">Z tego powodu, aplikacja referencyjna eShopOnWeb oddziela swoje interfejsy API do własnego projektu, `PublicApi` niezależnie od projektu głównego, `Web` zawierającego widoki i Razor Pages aplikacji.</span><span class="sxs-lookup"><span data-stu-id="bd286-395">For this reason, among others, the eShopOnWeb reference application separates its APIs into their own project, `PublicApi`, separate from the main `Web` project that includes the application's views and Razor Pages.</span></span>

#### <a name="authentication-in-no-locblazor-apps"></a><span data-ttu-id="bd286-396">Uwierzytelnianie w Blazor aplikacjach</span><span class="sxs-lookup"><span data-stu-id="bd286-396">Authentication in Blazor apps</span></span>

<span data-ttu-id="bd286-397">Blazor Aplikacje serwera mogą korzystać z tych samych funkcji uwierzytelniania co inna aplikacja ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="bd286-397">Blazor Server applications can leverage the same authentication features as any other ASP.NET Core application.</span></span> <span data-ttu-id="bd286-398">Blazorw WebAssembly aplikacjach nie można używać wbudowanych dostawców tożsamości i uwierzytelniania, ponieważ są one uruchamiane w przeglądarce.</span><span class="sxs-lookup"><span data-stu-id="bd286-398">Blazor WebAssembly applications cannot use the built-in Identity and Authentication providers, however, since they run in the browser.</span></span> <span data-ttu-id="bd286-399">BlazorWebAssemblyaplikacje mogą lokalnie przechowywać stan uwierzytelniania użytkownika i uzyskiwać dostęp do oświadczeń, aby określić akcje, które użytkownicy powinni wykonywać.</span><span class="sxs-lookup"><span data-stu-id="bd286-399">Blazor WebAssembly applications can store user authentication status locally and can access claims to determine what actions users should be able to perform.</span></span> <span data-ttu-id="bd286-400">Wszystkie testy uwierzytelniania i autoryzacji należy jednak wykonać na serwerze niezależnie od implementacji logiki w Blazor WebAssembly aplikacji, ponieważ użytkownicy mogą łatwo obejść aplikację i bezpośrednio korzystać z interfejsów API.</span><span class="sxs-lookup"><span data-stu-id="bd286-400">However, all authentication and authorization checks should be performed on the server regardless of any logic implemented inside the Blazor WebAssembly app, since users can easily bypass the app and interact with the APIs directly.</span></span>

> ### <a name="references--authentication"></a><span data-ttu-id="bd286-401">Odwołania — uwierzytelnianie</span><span class="sxs-lookup"><span data-stu-id="bd286-401">References – Authentication</span></span>
>
> - <span data-ttu-id="bd286-402">**Akcje uwierzytelniania i ustawienia domyślne**</span><span class="sxs-lookup"><span data-stu-id="bd286-402">**Authentication Actions and Defaults**</span></span>\
>   <https://stackoverflow.com/a/52493428>
> - <span data-ttu-id="bd286-403">**Uwierzytelnianie i autoryzacja dla aplikacji jednostronicowych**</span><span class="sxs-lookup"><span data-stu-id="bd286-403">**Authentication and Authorization for SPAs**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/security/authentication/identity-api-authorization>
> - <span data-ttu-id="bd286-404">**ASP.NET Core Blazor uwierzytelnianie i autoryzacja**</span><span class="sxs-lookup"><span data-stu-id="bd286-404">**ASP.NET Core Blazor Authentication and Authorization**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/blazor/security/>
> - <span data-ttu-id="bd286-405">**Zabezpieczenia: uwierzytelnianie i autoryzacja w ASP.NET Web Forms i Blazor**</span><span class="sxs-lookup"><span data-stu-id="bd286-405">**Security: Authentication and Authorization in ASP.NET Web Forms and Blazor**</span></span>\
>   <https://docs.microsoft.com/dotnet/architecture/blazor-for-web-forms-developers/security-authentication-authorization>

### <a name="authorization"></a><span data-ttu-id="bd286-406">Autoryzacja</span><span class="sxs-lookup"><span data-stu-id="bd286-406">Authorization</span></span>

<span data-ttu-id="bd286-407">Najprostsza forma autoryzacji obejmuje ograniczenie dostępu do użytkowników anonimowych.</span><span class="sxs-lookup"><span data-stu-id="bd286-407">The simplest form of authorization involves restricting access to anonymous users.</span></span> <span data-ttu-id="bd286-408">Tę funkcję można osiągnąć, stosując \[ \] atrybut Autoryzuj do określonych kontrolerów lub akcji.</span><span class="sxs-lookup"><span data-stu-id="bd286-408">This functionality can be achieved by applying the \[Authorize\] attribute to certain controllers or actions.</span></span> <span data-ttu-id="bd286-409">Jeśli role są używane, atrybut można rozszerzyć, aby ograniczyć dostęp do użytkowników, którzy należą do określonych ról, jak pokazano poniżej:</span><span class="sxs-lookup"><span data-stu-id="bd286-409">If roles are being used, the attribute can be further extended to restrict access to users who belong to certain roles, as shown:</span></span>

```csharp
[Authorize(Roles = "HRManager,Finance")]
public class SalaryController : Controller
{

}
```

<span data-ttu-id="bd286-410">W takim przypadku użytkownicy należący do `HRManager` lub `Finance` role (lub obie) będą mieli dostęp do SalaryController.</span><span class="sxs-lookup"><span data-stu-id="bd286-410">In this case, users belonging to either the `HRManager` or `Finance` roles (or both) would have access to the SalaryController.</span></span> <span data-ttu-id="bd286-411">Aby wymagać, aby użytkownik należał do wielu ról (nie tylko jeden z kilku), można zastosować atrybut wielokrotnie, określając wymaganą rolę za każdym razem.</span><span class="sxs-lookup"><span data-stu-id="bd286-411">To require that a user belong to multiple roles (not just one of several), you can apply the attribute multiple times, specifying a required role each time.</span></span>

<span data-ttu-id="bd286-412">Określanie niektórych zestawów ról jako ciągów w wielu różnych kontrolerach i akcjach może prowadzić do niepożądanego powtórzenia.</span><span class="sxs-lookup"><span data-stu-id="bd286-412">Specifying certain sets of roles as strings in many different controllers and actions can lead to undesirable repetition.</span></span> <span data-ttu-id="bd286-413">Należy określić co najmniej stałe dla tych literałów ciągów i użyć stałych w dowolnym miejscu, aby podać ciąg.</span><span class="sxs-lookup"><span data-stu-id="bd286-413">At a minimum, define constants for these string literals and use the constants anywhere you need to specify the string.</span></span> <span data-ttu-id="bd286-414">Istnieje również możliwość skonfigurowania zasad autoryzacji, które hermetyzują reguły autoryzacji, a następnie określania zasad zamiast poszczególnych ról przy zastosowaniu \[ \] atrybutu Autoryzuj:</span><span class="sxs-lookup"><span data-stu-id="bd286-414">You can also configure authorization policies, which encapsulate authorization rules, and then specify the policy instead of individual roles when applying the \[Authorize\] attribute:</span></span>

```csharp
[Authorize(Policy = "CanViewPrivateReport")]
public IActionResult ExecutiveSalaryReport()
{
    return View();
}
```

<span data-ttu-id="bd286-415">Korzystając z zasad w ten sposób, można oddzielić rodzaje akcji, które są ograniczone z określonych ról lub reguł, które mają zastosowanie.</span><span class="sxs-lookup"><span data-stu-id="bd286-415">Using policies in this way, you can separate the kinds of actions being restricted from the specific roles or rules that apply to it.</span></span> <span data-ttu-id="bd286-416">Później, jeśli utworzysz nową rolę, która musi mieć dostęp do określonych zasobów, można po prostu zaktualizować zasady, zamiast aktualizować każdą listę ról przy każdym \[ autoryzowanym \] atrybucie.</span><span class="sxs-lookup"><span data-stu-id="bd286-416">Later, if you create a new role that needs to have access to certain resources, you can just update a policy, rather than updating every list of roles on every \[Authorize\] attribute.</span></span>

#### <a name="claims"></a><span data-ttu-id="bd286-417">Oświadczenia</span><span class="sxs-lookup"><span data-stu-id="bd286-417">Claims</span></span>

<span data-ttu-id="bd286-418">Oświadczenia są parami wartości nazw, które reprezentują właściwości uwierzytelnionego użytkownika.</span><span class="sxs-lookup"><span data-stu-id="bd286-418">Claims are name value pairs that represent properties of an authenticated user.</span></span> <span data-ttu-id="bd286-419">Na przykład użytkownik może przechowywać numer pracownika jako roszczeń.</span><span class="sxs-lookup"><span data-stu-id="bd286-419">For example, you might store users' employee number as a claim.</span></span> <span data-ttu-id="bd286-420">Oświadczenia mogą być następnie używane jako część zasad autoryzacji.</span><span class="sxs-lookup"><span data-stu-id="bd286-420">Claims can then be used as part of authorization policies.</span></span> <span data-ttu-id="bd286-421">Można utworzyć zasady o nazwie "EmployeeOnly", które wymagają istnienia żądania o nazwie "EmployeeNumber", jak pokazano w poniższym przykładzie:</span><span class="sxs-lookup"><span data-stu-id="bd286-421">You could create a policy called "EmployeeOnly" that requires the existence of a claim called "EmployeeNumber", as shown in this example:</span></span>

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddMvc();
    services.AddAuthorization(options =>
    {
        options.AddPolicy("EmployeeOnly", policy => policy.RequireClaim("EmployeeNumber"));
    });
}
```

<span data-ttu-id="bd286-422">Te zasady mogą być następnie używane z \[ \] atrybutem Autoryzuj do ochrony dowolnego kontrolera i/lub akcji, zgodnie z powyższym opisem.</span><span class="sxs-lookup"><span data-stu-id="bd286-422">This policy could then be used with the \[Authorize\] attribute to protect any controller and/or action, as described above.</span></span>

#### <a name="securing-web-apis"></a><span data-ttu-id="bd286-423">Zabezpieczanie interfejsów API sieci Web</span><span class="sxs-lookup"><span data-stu-id="bd286-423">Securing web APIs</span></span>

<span data-ttu-id="bd286-424">Większość interfejsów API sieci Web powinna implementować system uwierzytelniania oparty na tokenach.</span><span class="sxs-lookup"><span data-stu-id="bd286-424">Most web APIs should implement a token-based authentication system.</span></span> <span data-ttu-id="bd286-425">Uwierzytelnianie tokenu jest bezstanowe i zaprojektowane do skalowalności.</span><span class="sxs-lookup"><span data-stu-id="bd286-425">Token authentication is stateless and designed to be scalable.</span></span> <span data-ttu-id="bd286-426">W systemie uwierzytelniania opartego na tokenach klient musi najpierw przeprowadzić uwierzytelnienie u dostawcy uwierzytelniania.</span><span class="sxs-lookup"><span data-stu-id="bd286-426">In a token-based authentication system, the client must first authenticate with the authentication provider.</span></span> <span data-ttu-id="bd286-427">Jeśli to się powiedzie, klient wystawia token, który jest po prostu zrozumiałą w sposób kryptograficznie ciągiem znaków.</span><span class="sxs-lookup"><span data-stu-id="bd286-427">If successful, the client is issued a token, which is simply a cryptographically meaningful string of characters.</span></span> <span data-ttu-id="bd286-428">Najbardziej typowym formatem tokenów jest token sieci Web JSON lub JWT (często wymawiane "notowania").</span><span class="sxs-lookup"><span data-stu-id="bd286-428">The most common format for tokens is JSON Web Token, or JWT (often pronounced "jot").</span></span> <span data-ttu-id="bd286-429">Gdy klient musi wydać żądanie do interfejsu API, dodaje ten token jako nagłówek w żądaniu.</span><span class="sxs-lookup"><span data-stu-id="bd286-429">When the client then needs to issue a request to an API, it adds this token as a header on the request.</span></span> <span data-ttu-id="bd286-430">Następnie serwer sprawdza poprawność tokenu znalezionego w nagłówku żądania przed ukończeniem żądania.</span><span class="sxs-lookup"><span data-stu-id="bd286-430">The server then validates the token found in the request header before completing the request.</span></span> <span data-ttu-id="bd286-431">Rysunek 7-4 ilustruje ten proces.</span><span class="sxs-lookup"><span data-stu-id="bd286-431">Figure 7-4 demonstrates this process.</span></span>

![TokenAuth](./media/image7-4.png)

<span data-ttu-id="bd286-433">**Rysunek 7-4.**</span><span class="sxs-lookup"><span data-stu-id="bd286-433">**Figure 7-4.**</span></span> <span data-ttu-id="bd286-434">Uwierzytelnianie oparte na tokenach dla interfejsów API sieci Web.</span><span class="sxs-lookup"><span data-stu-id="bd286-434">Token-based authentication for Web APIs.</span></span>

<span data-ttu-id="bd286-435">Możesz utworzyć własną usługę uwierzytelniania, zintegrować ją z usługą Azure AD i uwierzytelnianiem OAuth lub wdrożyć usługę przy użyciu narzędzia typu open source, takiego jak [IdentityServer](https://github.com/IdentityServer).</span><span class="sxs-lookup"><span data-stu-id="bd286-435">You can create your own authentication service, integrate with Azure AD and OAuth, or implement a service using an open-source tool like [IdentityServer](https://github.com/IdentityServer).</span></span>

<span data-ttu-id="bd286-436">Tokeny JWT mogą osadzać oświadczenia dotyczące użytkownika, które można odczytać na kliencie lub serwerze.</span><span class="sxs-lookup"><span data-stu-id="bd286-436">JWT tokens can embed claims about the user, which can be read on the client or server.</span></span> <span data-ttu-id="bd286-437">Możesz użyć narzędzia, takiego jak [JWT.IO](https://jwt.io/) , aby wyświetlić zawartość tokenu JWT.</span><span class="sxs-lookup"><span data-stu-id="bd286-437">You can use a tool like [jwt.io](https://jwt.io/) to view the contents of a JWT token.</span></span> <span data-ttu-id="bd286-438">Nie należy przechowywać poufnych danych, takich jak hasła lub klucze w tokenach JTW, ponieważ ich zawartość jest łatwo odczytywana.</span><span class="sxs-lookup"><span data-stu-id="bd286-438">Do not store sensitive data like passwords or keys in JTW tokens, since their contents are easily read.</span></span>

<span data-ttu-id="bd286-439">W przypadku używania tokenów JWT z SPA lub Blazor WebAssembly aplikacjami należy przechowywać token w dowolnym miejscu na kliencie, a następnie dodać go do każdego wywołania interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="bd286-439">When using JWT tokens with SPA or Blazor WebAssembly applications, you must store the token somewhere on the client and then add it to every API call.</span></span> <span data-ttu-id="bd286-440">To działanie jest zwykle wykonywane jako nagłówek, ponieważ ilustruje poniższy kod:</span><span class="sxs-lookup"><span data-stu-id="bd286-440">This activity is typically done as a header, as the following code demonstrates:</span></span>

```csharp
// AuthService.cs in BlazorAdmin project of eShopOnWeb
private async Task SetAuthorizationHeader()
{
    var token = await GetToken();
    _httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", token);
}
```

<span data-ttu-id="bd286-441">Po wywołaniu powyższej metody żądania wykonane przy użyciu `_httpClient` będą mieć token osadzony w nagłówkach żądania, co umożliwia interfejsowi API po stronie serwera uwierzytelnianie i Autoryzowanie żądania.</span><span class="sxs-lookup"><span data-stu-id="bd286-441">After calling the above method, requests made with the `_httpClient` will have the token embedded in the request's headers, allowing the server-side API to authenticate and authorize the request.</span></span>

#### <a name="custom-security"></a><span data-ttu-id="bd286-442">Zabezpieczenia niestandardowe</span><span class="sxs-lookup"><span data-stu-id="bd286-442">Custom Security</span></span>

<span data-ttu-id="bd286-443">Należy zwrócić szczególną uwagę na "wycofywanie własnych" implementacji kryptografii, członkostwa użytkowników lub systemu generacji tokenów.</span><span class="sxs-lookup"><span data-stu-id="bd286-443">Be especially careful about "rolling your own" implementation of cryptography, user membership, or token generation system.</span></span> <span data-ttu-id="bd286-444">Istnieje wiele dostępnych alternatyw komercyjnych i typu "open source", które niemal wykorzystają lepsze zabezpieczenia niż implementacja niestandardowa.</span><span class="sxs-lookup"><span data-stu-id="bd286-444">There are many commercial and open-source alternatives available, which will almost certainly have better security than a custom implementation.</span></span>

> ### <a name="references--security"></a><span data-ttu-id="bd286-445">Odwołania — zabezpieczenia</span><span class="sxs-lookup"><span data-stu-id="bd286-445">References – Security</span></span>
>
> - <span data-ttu-id="bd286-446">**Przegląd dokumentów dotyczących zabezpieczeń**</span><span class="sxs-lookup"><span data-stu-id="bd286-446">**Security Docs Overview**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/security/>
> - <span data-ttu-id="bd286-447">**Wymuszanie protokołu SSL w aplikacji ASP.NET Core**</span><span class="sxs-lookup"><span data-stu-id="bd286-447">**Enforcing SSL in an ASP.NET Core App**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/security/enforcing-ssl>
> - <span data-ttu-id="bd286-448">**Wprowadzenie do tożsamości**</span><span class="sxs-lookup"><span data-stu-id="bd286-448">**Introduction to Identity**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/security/authentication/identity>
> - <span data-ttu-id="bd286-449">**Wprowadzenie do autoryzacji**</span><span class="sxs-lookup"><span data-stu-id="bd286-449">**Introduction to Authorization**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/security/authorization/introduction>
> - <span data-ttu-id="bd286-450">**Uwierzytelnianie i autoryzacja API Apps w Azure App Service**</span><span class="sxs-lookup"><span data-stu-id="bd286-450">**Authentication and Authorization for API Apps in Azure App Service**</span></span>\
>   <https://docs.microsoft.com/azure/app-service-api/app-service-api-authentication>
> - <span data-ttu-id="bd286-451">**Serwer tożsamości**</span><span class="sxs-lookup"><span data-stu-id="bd286-451">**Identity Server**</span></span>\
>   <https://github.com/IdentityServer>

## <a name="client-communication"></a><span data-ttu-id="bd286-452">Komunikacja z klientem</span><span class="sxs-lookup"><span data-stu-id="bd286-452">Client communication</span></span>

<span data-ttu-id="bd286-453">Oprócz obsługi stron i reagowania na żądania danych za pośrednictwem interfejsów API sieci Web aplikacje ASP.NET Core mogą komunikować się bezpośrednio z połączonymi klientami.</span><span class="sxs-lookup"><span data-stu-id="bd286-453">In addition to serving pages and responding to requests for data via web APIs, ASP.NET Core apps can communicate directly with connected clients.</span></span> <span data-ttu-id="bd286-454">Ta komunikacja wychodząca może korzystać z różnych technologii transportu, najczęściej używanych przez obiekty WebSockets.</span><span class="sxs-lookup"><span data-stu-id="bd286-454">This outbound communication can use a variety of transport technologies, the most common being WebSockets.</span></span> <span data-ttu-id="bd286-455">ASP.NET Core sygnalizujący to biblioteka, która ułatwia dodawanie funkcji komunikacji między klientami w czasie rzeczywistym do aplikacji.</span><span class="sxs-lookup"><span data-stu-id="bd286-455">ASP.NET Core SignalR is a library that makes it simple to add real-time server-to-client communication functionality to your applications.</span></span> <span data-ttu-id="bd286-456">Program sygnalizujący obsługuje różne technologie transportowe, w tym elementy WebSockets, i dzieli wiele szczegółów implementacji od dewelopera.</span><span class="sxs-lookup"><span data-stu-id="bd286-456">SignalR supports a variety of transport technologies, including WebSockets, and abstracts away many of the implementation details from the developer.</span></span>

<span data-ttu-id="bd286-457">Komunikacja klientów w czasie rzeczywistym, bez względu na to, czy używanie funkcji WebSockets bezpośrednio czy z innymi technikami jest przydatne w różnych scenariuszach aplikacji.</span><span class="sxs-lookup"><span data-stu-id="bd286-457">Real-time client communication, whether using WebSockets directly or other techniques, are useful in a variety of application scenarios.</span></span> <span data-ttu-id="bd286-458">Oto niektóre przykłady:</span><span class="sxs-lookup"><span data-stu-id="bd286-458">Some examples include:</span></span>

- <span data-ttu-id="bd286-459">Aplikacje do pokoju rozmów na żywo</span><span class="sxs-lookup"><span data-stu-id="bd286-459">Live chat room applications</span></span>

- <span data-ttu-id="bd286-460">Monitorowanie aplikacji</span><span class="sxs-lookup"><span data-stu-id="bd286-460">Monitoring applications</span></span>

- <span data-ttu-id="bd286-461">Aktualizacje postępu zadania</span><span class="sxs-lookup"><span data-stu-id="bd286-461">Job progress updates</span></span>

- <span data-ttu-id="bd286-462">Powiadomienia</span><span class="sxs-lookup"><span data-stu-id="bd286-462">Notifications</span></span>

- <span data-ttu-id="bd286-463">Interaktywne aplikacje formularzy</span><span class="sxs-lookup"><span data-stu-id="bd286-463">Interactive forms applications</span></span>

<span data-ttu-id="bd286-464">Podczas tworzenia komunikacji z klientem w aplikacjach są zwykle dwa składniki:</span><span class="sxs-lookup"><span data-stu-id="bd286-464">When building client communication into your applications, there are typically two components:</span></span>

- <span data-ttu-id="bd286-465">Menedżer połączeń po stronie serwera (centrum sygnałów, websocketmanager WebSocketHandler)</span><span class="sxs-lookup"><span data-stu-id="bd286-465">Server-side connection manager (SignalR Hub, WebSocketManager WebSocketHandler)</span></span>

- <span data-ttu-id="bd286-466">Biblioteka po stronie klienta</span><span class="sxs-lookup"><span data-stu-id="bd286-466">Client-side library</span></span>

<span data-ttu-id="bd286-467">Klienci nie są ograniczeni do przeglądarek — aplikacje mobilne, aplikacje konsolowe i inne aplikacje natywne mogą również komunikować się przy użyciu sygnałów/obiektów WebSockets.</span><span class="sxs-lookup"><span data-stu-id="bd286-467">Clients aren't limited to browsers – mobile apps, console apps, and other native apps can also communicate using SignalR/WebSockets.</span></span> <span data-ttu-id="bd286-468">Następujący prosty program umożliwia echo całej zawartości wysyłanej do aplikacji czatu do konsoli programu w ramach przykładowej aplikacji websocketmanager:</span><span class="sxs-lookup"><span data-stu-id="bd286-468">The following simple program echoes all content sent to a chat application to the console, as part of a WebSocketManager sample application:</span></span>

```csharp
public class Program
{
    private static Connection _connection;
    public static void Main(string[] args)
    {
        StartConnectionAsync();
        _connection.On("receiveMessage", (arguments) =>
        {
            Console.WriteLine($"{arguments[0]} said: {arguments[1]}");
        });
        Console.ReadLine();
        StopConnectionAsync();
    }

    public static async Task StartConnectionAsync()
    {
        _connection = new Connection();
        await _connection.StartConnectionAsync("ws://localhost:65110/chat");
    }

    public static async Task StopConnectionAsync()
    {
        await _connection.StopConnectionAsync();
    }
}
```

<span data-ttu-id="bd286-469">Rozważ sposoby, w których aplikacje komunikują się bezpośrednio z aplikacjami klienckimi i należy rozważyć, czy komunikacja w czasie rzeczywistym poprawi środowisko użytkownika aplikacji.</span><span class="sxs-lookup"><span data-stu-id="bd286-469">Consider ways in which your applications communicate directly with client applications, and consider whether real-time communication would improve your app's user experience.</span></span>

> ### <a name="references--client-communication"></a><span data-ttu-id="bd286-470">Odwołania — komunikacja z klientem</span><span class="sxs-lookup"><span data-stu-id="bd286-470">References – Client Communication</span></span>
>
> - <span data-ttu-id="bd286-471">**ASP.NET Core sygnalizujący**</span><span class="sxs-lookup"><span data-stu-id="bd286-471">**ASP.NET Core SignalR**</span></span>\
>   <https://github.com/dotnet/aspnetcore/tree/master/src/SignalR>
> - <span data-ttu-id="bd286-472">**Menedżer obiektów WebSocket**</span><span class="sxs-lookup"><span data-stu-id="bd286-472">**WebSocket Manager**</span></span>\
>   <https://github.com/radu-matei/websocket-manager>

## <a name="domain-driven-design--should-you-apply-it"></a><span data-ttu-id="bd286-473">Projektowanie oparte na domenie — czy należy je zastosować?</span><span class="sxs-lookup"><span data-stu-id="bd286-473">Domain-driven design – Should you apply it?</span></span>

<span data-ttu-id="bd286-474">Domain-Driven Design (DDD) to Agile podejście do tworzenia oprogramowania, które kładzie nacisk na _domenę biznesową_.</span><span class="sxs-lookup"><span data-stu-id="bd286-474">Domain-Driven Design (DDD) is an agile approach to building software that emphasizes focusing on the _business domain_.</span></span> <span data-ttu-id="bd286-475">W dużym stopniu naciska na komunikację i interakcję z ekspertami domeny biznesowej, którzy mogą odnosić się do deweloperów, w jaki działa system w świecie rzeczywistym.</span><span class="sxs-lookup"><span data-stu-id="bd286-475">It places a heavy emphasis on communication and interaction with business domain expert(s) who can relate to the developers how the real-world system works.</span></span> <span data-ttu-id="bd286-476">Jeśli na przykład tworzysz system, który obsługuje handel giełdowy, ekspertem domeny może być doświadczony Broker ds. it.</span><span class="sxs-lookup"><span data-stu-id="bd286-476">For example, if you're building a system that handles stock trades, your domain expert might be an experienced stock broker.</span></span> <span data-ttu-id="bd286-477">DDD jest przeznaczony do rozwiązywania dużych i złożonych problemów związanych z biznesem. często nie jest to konieczne w przypadku mniejszych, prostszych aplikacji, ponieważ inwestycje w zrozumieniu i modelowania domeny nie są w tej samej postaci.</span><span class="sxs-lookup"><span data-stu-id="bd286-477">DDD is designed to address large, complex business problems, and is often not appropriate for smaller, simpler applications, as the investment in understanding and modeling the domain is not worth it.</span></span>

<span data-ttu-id="bd286-478">Podczas kompilowania oprogramowania po drodze, zespół (w tym udziałowcy nietechniczne i współautorzy) powinien opracować powszechny _Język_ dla obszaru problemu.</span><span class="sxs-lookup"><span data-stu-id="bd286-478">When building software following a DDD approach, your team (including non-technical stakeholders and contributors) should develop a _ubiquitous language_ for the problem space.</span></span> <span data-ttu-id="bd286-479">Oznacza to, że ta sama terminologia powinna zostać użyta w przypadku modelowania rzeczywistego pojęcia, odpowiedniki oprogramowania i wszelkich struktur, które mogą istnieć, aby zachować koncepcję (na przykład tabele bazy danych).</span><span class="sxs-lookup"><span data-stu-id="bd286-479">That is, the same terminology should be used for the real-world concept being modeled, the software equivalent, and any structures that might exist to persist the concept (for example, database tables).</span></span> <span data-ttu-id="bd286-480">W związku z tym koncepcje opisane w języku powszechnym powinny stanowić podstawę dla _modelu domeny_.</span><span class="sxs-lookup"><span data-stu-id="bd286-480">Thus, the concepts described in the ubiquitous language should form the basis for your _domain model_.</span></span>

<span data-ttu-id="bd286-481">Model domeny obejmuje obiekty, które współdziałają ze sobą, aby reprezentować zachowanie systemu.</span><span class="sxs-lookup"><span data-stu-id="bd286-481">Your domain model comprises objects that interact with one another to represent the behavior of the system.</span></span> <span data-ttu-id="bd286-482">Te obiekty mogą należeć do następujących kategorii:</span><span class="sxs-lookup"><span data-stu-id="bd286-482">These objects may fall into the following categories:</span></span>

- <span data-ttu-id="bd286-483">[Jednostki](https://deviq.com/entity/)reprezentujące obiekty z wątkiem tożsamości.</span><span class="sxs-lookup"><span data-stu-id="bd286-483">[Entities](https://deviq.com/entity/), which represent objects with a thread of identity.</span></span> <span data-ttu-id="bd286-484">Jednostki są zwykle przechowywane w stanie trwałości przy użyciu klucza, za pomocą którego mogą być później pobierane.</span><span class="sxs-lookup"><span data-stu-id="bd286-484">Entities are typically stored in persistence with a key by which they can later be retrieved.</span></span>

- <span data-ttu-id="bd286-485">[Agregaty](https://deviq.com/aggregate-pattern/)reprezentujące grupy obiektów, które powinny być utrwalane jako jednostka.</span><span class="sxs-lookup"><span data-stu-id="bd286-485">[Aggregates](https://deviq.com/aggregate-pattern/), which represent groups of objects that should be persisted as a unit.</span></span>

- <span data-ttu-id="bd286-486">[Obiekty wartości](https://deviq.com/value-object/), które reprezentują koncepcje, które mogą być porównane na podstawie sumy wartości ich właściwości.</span><span class="sxs-lookup"><span data-stu-id="bd286-486">[Value objects](https://deviq.com/value-object/), which represent concepts that can be compared on the basis of the sum of their property values.</span></span> <span data-ttu-id="bd286-487">Na przykład DateRange składa się z daty rozpoczęcia i zakończenia.</span><span class="sxs-lookup"><span data-stu-id="bd286-487">For example, DateRange consisting of a start and end date.</span></span>

- <span data-ttu-id="bd286-488">[Zdarzenia domeny](https://martinfowler.com/eaaDev/DomainEvent.html), które reprezentują rzeczy wykonywane w systemie, które są istotne dla innych części systemu.</span><span class="sxs-lookup"><span data-stu-id="bd286-488">[Domain events](https://martinfowler.com/eaaDev/DomainEvent.html), which represent things happening within the system that are of interest to other parts of the system.</span></span>

<span data-ttu-id="bd286-489">Model domeny DDD powinien hermetyzować złożone zachowanie w modelu.</span><span class="sxs-lookup"><span data-stu-id="bd286-489">A DDD domain model should encapsulate complex behavior within the model.</span></span> <span data-ttu-id="bd286-490">Jednostki, w szczególności nie powinny być kolekcjami właściwości.</span><span class="sxs-lookup"><span data-stu-id="bd286-490">Entities, in particular, should not merely be collections of properties.</span></span> <span data-ttu-id="bd286-491">Gdy model domeny nie ma zachowania i jedynie reprezentuje stan systemu, jest on uznawany za [model Anemic](https://deviq.com/anemic-model/), który jest NIEPOŻĄDANY w DDD.</span><span class="sxs-lookup"><span data-stu-id="bd286-491">When the domain model lacks behavior and merely represents the state of the system, it is said to be an [anemic model](https://deviq.com/anemic-model/), which is undesirable in DDD.</span></span>

<span data-ttu-id="bd286-492">Oprócz tych typów modeli DDD zazwyczaj wykorzystuje różne wzorce:</span><span class="sxs-lookup"><span data-stu-id="bd286-492">In addition to these model types, DDD typically employs a variety of patterns:</span></span>

- <span data-ttu-id="bd286-493">[Repozytorium](https://deviq.com/repository-pattern/), aby uzyskać szczegółowe informacje o trwałości.</span><span class="sxs-lookup"><span data-stu-id="bd286-493">[Repository](https://deviq.com/repository-pattern/), for abstracting persistence details.</span></span>

- <span data-ttu-id="bd286-494">[Fabryka](https://en.wikipedia.org/wiki/Factory_method_pattern)dla hermetyzowania złożonego tworzenia obiektów.</span><span class="sxs-lookup"><span data-stu-id="bd286-494">[Factory](https://en.wikipedia.org/wiki/Factory_method_pattern), for encapsulating complex object creation.</span></span>

- <span data-ttu-id="bd286-495">[Usługi](http://gorodinski.com/blog/2012/04/14/services-in-domain-driven-design-ddd/)dla hermetyzowania złożonych zachowań i/lub szczegółów implementacji infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="bd286-495">[Services](http://gorodinski.com/blog/2012/04/14/services-in-domain-driven-design-ddd/), for encapsulating complex behavior and/or infrastructure implementation details.</span></span>

- <span data-ttu-id="bd286-496">[Polecenia](https://en.wikipedia.org/wiki/Command_pattern), do oddzielania poleceń i wykonywania polecenia.</span><span class="sxs-lookup"><span data-stu-id="bd286-496">[Command](https://en.wikipedia.org/wiki/Command_pattern), for decoupling issuing commands and executing the command itself.</span></span>

- <span data-ttu-id="bd286-497">[Specyfikacja](https://deviq.com/specification-pattern/)dla hermetyzowania szczegółów zapytania.</span><span class="sxs-lookup"><span data-stu-id="bd286-497">[Specification](https://deviq.com/specification-pattern/), for encapsulating query details.</span></span>

<span data-ttu-id="bd286-498">DDD również zaleca użycie czystej architektury omówionej wcześniej, co pozwala na swobodne sprzęganie, hermetyzację i kod, który można łatwo zweryfikować przy użyciu testów jednostkowych.</span><span class="sxs-lookup"><span data-stu-id="bd286-498">DDD also recommends the use of the Clean Architecture discussed previously, allowing for loose coupling, encapsulation, and code that can easily be verified using unit tests.</span></span>

### <a name="when-should-you-apply-ddd"></a><span data-ttu-id="bd286-499">Kiedy należy zastosować DDD</span><span class="sxs-lookup"><span data-stu-id="bd286-499">When should you apply DDD</span></span>

<span data-ttu-id="bd286-500">DDD jest dobrze dostosowany do dużych aplikacji z znaczącą złożonością firmy (nie tylko technicznie).</span><span class="sxs-lookup"><span data-stu-id="bd286-500">DDD is well suited to large applications with significant business (not just technical) complexity.</span></span> <span data-ttu-id="bd286-501">Aplikacja powinna wymagać znajomości ekspertów domeny.</span><span class="sxs-lookup"><span data-stu-id="bd286-501">The application should require the knowledge of domain experts.</span></span> <span data-ttu-id="bd286-502">Istnieje duże zachowanie w modelu domeny, reprezentujące reguły biznesowe i interakcje wykraczające poza zwykłe przechowywanie i pobieranie bieżącego stanu różnych rekordów z magazynów danych.</span><span class="sxs-lookup"><span data-stu-id="bd286-502">There should be significant behavior in the domain model itself, representing business rules and interactions beyond simply storing and retrieving the current state of various records from data stores.</span></span>

### <a name="when-shouldnt-you-apply-ddd"></a><span data-ttu-id="bd286-503">Kiedy nie należy stosować DDD</span><span class="sxs-lookup"><span data-stu-id="bd286-503">When shouldn't you apply DDD</span></span>

<span data-ttu-id="bd286-504">DDD obejmuje inwestycje w modelowanie, architekturę i komunikację, które mogą nie być uzasadnione w przypadku mniejszych aplikacji lub aplikacji, które zasadniczo CRUD (Tworzenie/odczytywanie/aktualizowanie/usuwanie).</span><span class="sxs-lookup"><span data-stu-id="bd286-504">DDD involves investments in modeling, architecture, and communication that may not be warranted for smaller applications or applications that are essentially just CRUD (create/read/update/delete).</span></span> <span data-ttu-id="bd286-505">W przypadku wybrania podejścia do Twojej aplikacji po DDD, ale dowiesz się, że domena ma model Anemic bez zachowań, może być konieczne ponowne zawieszanie się z podejściem.</span><span class="sxs-lookup"><span data-stu-id="bd286-505">If you choose to approach your application following DDD, but find that your domain has an anemic model with no behavior, you may need to rethink your approach.</span></span> <span data-ttu-id="bd286-506">Twoja aplikacja może nie potrzebować DDD lub może być potrzebna pomoc w refaktoryzacji aplikacji w celu hermetyzacji logiki biznesowej w modelu domeny, a nie w bazie danych lub interfejsie użytkownika.</span><span class="sxs-lookup"><span data-stu-id="bd286-506">Either your application may not need DDD, or you may need assistance refactoring your application to encapsulate business logic in the domain model, rather than in your database or user interface.</span></span>

<span data-ttu-id="bd286-507">Podejście hybrydowe będzie używać DDD tylko dla transakcyjnych lub bardziej złożonych obszarów aplikacji, ale nie dla prostszej CRUD lub tylko do odczytu części aplikacji.</span><span class="sxs-lookup"><span data-stu-id="bd286-507">A hybrid approach would be to only use DDD for the transactional or more complex areas of the application, but not for simpler CRUD or read-only portions of the application.</span></span> <span data-ttu-id="bd286-508">Na przykład nie są wymagane ograniczenia agregacji, jeśli tworzysz zapytanie o dane w celu wyświetlenia raportu lub wizualizacji danych dla pulpitu nawigacyjnego.</span><span class="sxs-lookup"><span data-stu-id="bd286-508">For instance, you don't need the constraints of an Aggregate if you're querying data to display a report or to visualize data for a dashboard.</span></span> <span data-ttu-id="bd286-509">Doskonale akceptowalne jest oddzielny, prostszy model odczytu dla takich wymagań.</span><span class="sxs-lookup"><span data-stu-id="bd286-509">It's perfectly acceptable to have a separate, simpler read model for such requirements.</span></span>

> ### <a name="references--domain-driven-design"></a><span data-ttu-id="bd286-510">Odwołania — projektowanie Domain-Driven</span><span class="sxs-lookup"><span data-stu-id="bd286-510">References – Domain-Driven Design</span></span>
>
> - <span data-ttu-id="bd286-511">**DDD w zwykłym języku angielskim (odpowiedź StackOverflow)**</span><span class="sxs-lookup"><span data-stu-id="bd286-511">**DDD in Plain English (StackOverflow Answer)**</span></span>\
>   <https://stackoverflow.com/questions/1222392/can-someone-explain-domain-driven-design-ddd-in-plain-english-please/1222488#1222488>

## <a name="deployment"></a><span data-ttu-id="bd286-512">Wdrożenie</span><span class="sxs-lookup"><span data-stu-id="bd286-512">Deployment</span></span>

<span data-ttu-id="bd286-513">W procesie wdrażania aplikacji ASP.NET Core należy wykonać kilka kroków, bez względu na to, gdzie będzie ona hostowana.</span><span class="sxs-lookup"><span data-stu-id="bd286-513">There are a few steps involved in the process of deploying your ASP.NET Core application, regardless of where it will be hosted.</span></span> <span data-ttu-id="bd286-514">Pierwszym krokiem jest opublikowanie aplikacji, którą można wykonać przy użyciu `dotnet publish` interfejsu wiersza polecenia.</span><span class="sxs-lookup"><span data-stu-id="bd286-514">The first step is to publish the application, which can be done using the `dotnet publish` CLI command.</span></span> <span data-ttu-id="bd286-515">Ten krok spowoduje skompilowanie aplikacji i umieszczenie wszystkich plików wymaganych do uruchomienia aplikacji w wydzielonym folderze.</span><span class="sxs-lookup"><span data-stu-id="bd286-515">This step will compile the application and place all of the files needed to run the application into a designated folder.</span></span> <span data-ttu-id="bd286-516">W przypadku wdrażania z programu Visual Studio ten krok jest wykonywany automatycznie.</span><span class="sxs-lookup"><span data-stu-id="bd286-516">When you deploy from Visual Studio, this step is performed for you automatically.</span></span> <span data-ttu-id="bd286-517">Folder publikowania zawiera pliki. exe i. dll dla aplikacji i jej zależności.</span><span class="sxs-lookup"><span data-stu-id="bd286-517">The publish folder contains .exe and .dll files for the application and its dependencies.</span></span> <span data-ttu-id="bd286-518">Aplikacja samodzielna zawiera również wersję środowiska uruchomieniowego .NET.</span><span class="sxs-lookup"><span data-stu-id="bd286-518">A self-contained application will also include a version of the .NET runtime.</span></span> <span data-ttu-id="bd286-519">Aplikacje ASP.NET Core zawierają również pliki konfiguracji, statyczne zasoby klienta i widoki MVC.</span><span class="sxs-lookup"><span data-stu-id="bd286-519">ASP.NET Core applications will also include configuration files, static client assets, and MVC views.</span></span>

<span data-ttu-id="bd286-520">Aplikacje ASP.NET Core są aplikacjami konsolowymi, które należy uruchomić, gdy serwer jest uruchamiany i uruchamiany ponownie, jeśli wystąpi awaria aplikacji (lub serwera).</span><span class="sxs-lookup"><span data-stu-id="bd286-520">ASP.NET Core applications are console applications that must be started when the server boots and restarted if the application (or server) crashes.</span></span> <span data-ttu-id="bd286-521">Za pomocą Menedżera procesów można zautomatyzować ten proces.</span><span class="sxs-lookup"><span data-stu-id="bd286-521">A process manager can be used to automate this process.</span></span> <span data-ttu-id="bd286-522">Najbardziej typowymi menedżerami procesów dla ASP.NET Core są Nginx i Apache w systemach Linux i IIS lub Windows Service w systemie Windows.</span><span class="sxs-lookup"><span data-stu-id="bd286-522">The most common process managers for ASP.NET Core are Nginx and Apache on Linux and IIS or Windows Service on Windows.</span></span>

<span data-ttu-id="bd286-523">Oprócz Menedżera procesów aplikacje ASP.NET Core mogą korzystać z serwera proxy zwrotnego.</span><span class="sxs-lookup"><span data-stu-id="bd286-523">In addition to a process manager, ASP.NET Core applications may use a reverse proxy server.</span></span> <span data-ttu-id="bd286-524">Odwrotny serwer proxy odbiera żądania HTTP z Internetu i przekazuje je do Kestrel po pewnej wstępnej obsłudze.</span><span class="sxs-lookup"><span data-stu-id="bd286-524">A reverse proxy server receives HTTP requests from the Internet and forwards them to Kestrel after some preliminary handling.</span></span> <span data-ttu-id="bd286-525">Odwrotne serwery proxy zapewniają warstwę zabezpieczeń aplikacji.</span><span class="sxs-lookup"><span data-stu-id="bd286-525">Reverse proxy servers provide a layer of security for the application.</span></span> <span data-ttu-id="bd286-526">Kestrel również nie obsługuje hostowania wielu aplikacji na tym samym porcie, dlatego nie można używać technik takich jak nagłówki hosta, aby umożliwić hostowanie wielu aplikacji na tym samym porcie i adresie IP.</span><span class="sxs-lookup"><span data-stu-id="bd286-526">Kestrel also doesn't support hosting multiple applications on the same port, so techniques like host headers cannot be used with it to enable hosting multiple applications on the same port and IP address.</span></span>

![Kestrel z Internetem](./media/image7-5.png)

<span data-ttu-id="bd286-528">**Rysunek 7-5**.</span><span class="sxs-lookup"><span data-stu-id="bd286-528">**Figure 7-5**.</span></span> <span data-ttu-id="bd286-529">ASP.NET hostowane w Kestrel za odwrotnym serwerze proxy</span><span class="sxs-lookup"><span data-stu-id="bd286-529">ASP.NET hosted in Kestrel behind a reverse proxy server</span></span>

<span data-ttu-id="bd286-530">Innym scenariuszem, w którym może być przydatny zwrotny serwer proxy, jest zabezpieczanie wielu aplikacji przy użyciu protokołu SSL/HTTPS.</span><span class="sxs-lookup"><span data-stu-id="bd286-530">Another scenario in which a reverse proxy can be helpful is to secure multiple applications using SSL/HTTPS.</span></span> <span data-ttu-id="bd286-531">W takim przypadku tylko zwrotny serwer proxy musi mieć skonfigurowany protokół SSL.</span><span class="sxs-lookup"><span data-stu-id="bd286-531">In this case, only the reverse proxy would need to have SSL configured.</span></span> <span data-ttu-id="bd286-532">Komunikacja między odwrotnym serwerem proxy a Kestrel może odbywać się za pośrednictwem protokołu HTTP, jak pokazano na rysunku 7-6.</span><span class="sxs-lookup"><span data-stu-id="bd286-532">Communication between the reverse proxy server and Kestrel could take place over HTTP, as shown in Figure 7-6.</span></span>

![ASP.NET hostowane za pośrednictwem protokołu HTTPS zwrotnego serwera proxy](./media/image7-6.png)

<span data-ttu-id="bd286-534">**Rysunek 7-6**.</span><span class="sxs-lookup"><span data-stu-id="bd286-534">**Figure 7-6**.</span></span> <span data-ttu-id="bd286-535">ASP.NET hostowane za pośrednictwem protokołu HTTPS zwrotnego serwera proxy</span><span class="sxs-lookup"><span data-stu-id="bd286-535">ASP.NET hosted behind an HTTPS-secured reverse proxy server</span></span>

<span data-ttu-id="bd286-536">Coraz bardziej popularne podejście polega na hostowaniu ASP.NET Core aplikacji w kontenerze platformy Docker, który można hostować lokalnie lub wdrożyć na platformie Azure na potrzeby hostingu opartego na chmurze.</span><span class="sxs-lookup"><span data-stu-id="bd286-536">An increasingly popular approach is to host your ASP.NET Core application in a Docker container, which then can be hosted locally or deployed to Azure for cloud-based hosting.</span></span> <span data-ttu-id="bd286-537">Kontener platformy Docker może zawierać kod aplikacji działający w Kestrel i zostałby wdrożony za odwrotnym serwerem proxy, jak pokazano powyżej.</span><span class="sxs-lookup"><span data-stu-id="bd286-537">The Docker container could contain your application code, running on Kestrel, and would be deployed behind a reverse proxy server, as shown above.</span></span>

<span data-ttu-id="bd286-538">Jeśli aplikacja jest obsługiwana na platformie Azure, można użyć Application Gateway Microsoft Azure jako dedykowanego urządzenia wirtualnego, aby zapewnić kilka usług.</span><span class="sxs-lookup"><span data-stu-id="bd286-538">If you're hosting your application on Azure, you can use Microsoft Azure Application Gateway as a dedicated virtual appliance to provide several services.</span></span> <span data-ttu-id="bd286-539">Oprócz działania jako zwrotny serwer proxy dla poszczególnych aplikacji, Application Gateway może również oferować następujące funkcje:</span><span class="sxs-lookup"><span data-stu-id="bd286-539">In addition to acting as a reverse proxy for individual applications, Application Gateway can also offer the following features:</span></span>

- <span data-ttu-id="bd286-540">Równoważenie obciążenia HTTP</span><span class="sxs-lookup"><span data-stu-id="bd286-540">HTTP load balancing</span></span>

- <span data-ttu-id="bd286-541">Odciążanie protokołu SSL (tylko protokół SSL do Internetu)</span><span class="sxs-lookup"><span data-stu-id="bd286-541">SSL offload (SSL only to Internet)</span></span>

- <span data-ttu-id="bd286-542">Kompleksowa próba SSL</span><span class="sxs-lookup"><span data-stu-id="bd286-542">End to End SSL</span></span>

- <span data-ttu-id="bd286-543">Routing między lokacjami (konsolidowanie do 20 lokacji na jednym Application Gateway)</span><span class="sxs-lookup"><span data-stu-id="bd286-543">Multi-site routing (consolidate up to 20 sites on a single Application Gateway)</span></span>

- <span data-ttu-id="bd286-544">Zapora aplikacji internetowej</span><span class="sxs-lookup"><span data-stu-id="bd286-544">Web application firewall</span></span>

- <span data-ttu-id="bd286-545">Obsługa protokołu WebSocket</span><span class="sxs-lookup"><span data-stu-id="bd286-545">Websocket support</span></span>

- <span data-ttu-id="bd286-546">Zaawansowana diagnostyka</span><span class="sxs-lookup"><span data-stu-id="bd286-546">Advanced diagnostics</span></span>

<span data-ttu-id="bd286-547">_Dowiedz się więcej o opcjach wdrażania platformy Azure w [rozdziale 10](development-process-for-azure.md)._</span><span class="sxs-lookup"><span data-stu-id="bd286-547">_Learn more about Azure deployment options in [Chapter 10](development-process-for-azure.md)._</span></span>

> ### <a name="references--deployment"></a><span data-ttu-id="bd286-548">Odwołania — wdrażanie</span><span class="sxs-lookup"><span data-stu-id="bd286-548">References – Deployment</span></span>
>
> - <span data-ttu-id="bd286-549">**Omówienie hostingu i wdrażania**</span><span class="sxs-lookup"><span data-stu-id="bd286-549">**Hosting and Deployment Overview**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/publishing/>
> - <span data-ttu-id="bd286-550">**Kiedy używać Kestrel z zwrotnym serwerem proxy**</span><span class="sxs-lookup"><span data-stu-id="bd286-550">**When to use Kestrel with a reverse proxy**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/fundamentals/servers/kestrel#when-to-use-kestrel-with-a-reverse-proxy>
> - <span data-ttu-id="bd286-551">**Hostowanie aplikacji ASP.NET Core w platformie Docker**</span><span class="sxs-lookup"><span data-stu-id="bd286-551">**Host ASP.NET Core apps in Docker**</span></span>\
>   <https://docs.microsoft.com/aspnet/core/publishing/docker>
> - <span data-ttu-id="bd286-552">**Wprowadzenie do usługi Azure Application Gateway**</span><span class="sxs-lookup"><span data-stu-id="bd286-552">**Introducing Azure Application Gateway**</span></span>\
>   <https://docs.microsoft.com/azure/application-gateway/application-gateway-introduction>

>[!div class="step-by-step"]
><span data-ttu-id="bd286-553">[Poprzedni](common-client-side-web-technologies.md) 
> [Dalej](work-with-data-in-asp-net-core-apps.md)</span><span class="sxs-lookup"><span data-stu-id="bd286-553">[Previous](common-client-side-web-technologies.md)
[Next](work-with-data-in-asp-net-core-apps.md)</span></span>
