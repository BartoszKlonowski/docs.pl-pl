---
title: Twórz odporne na błędy usługi w chmurze. Obsługa przejściowych błędów w chmurze
description: Modernizacja istniejących aplikacji .NET za pomocą chmury platformy Azure i kontenerów systemu Windows | Twórz odporne na błędy usługi w chmurze. Obsługa przejściowych błędów w chmurze
ms.date: 04/30/2018
ms.openlocfilehash: e6fae8140b55cb0308dca9f4b77e961501b41f8f
ms.sourcegitcommit: 22be09204266253d45ece46f51cc6f080f2b3fd6
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/07/2019
ms.locfileid: "73739397"
---
# <a name="build-resilient-services-ready-for-the-cloud-embrace-transient-failures-in-the-cloud"></a><span data-ttu-id="4f0c2-105">Twórz odporne usługi dla chmury: Zastąp błędy przejściowe w chmurze</span><span class="sxs-lookup"><span data-stu-id="4f0c2-105">Build resilient services ready for the cloud: Embrace transient failures in the cloud</span></span>

<span data-ttu-id="4f0c2-106">Odporność to zdolność do odzyskiwania po awarii i kontynuowania działania.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-106">Resiliency is the ability to recover from failures and continue to function.</span></span> <span data-ttu-id="4f0c2-107">Odporność nie ma na uniknięcie niepowodzeń, ale akceptuje fakt, że wystąpią błędy, a następnie odpowiada na nie w taki sposób, aby uniknąć przestoju lub utraty danych.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-107">Resiliency is not about avoiding failures, but accepting the fact that failures will occur, and then responding to them in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="4f0c2-108">Celem odporności jest przywrócenie aplikacji do stanu w pełni funkcjonalnym po awarii.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-108">The goal of resiliency is to return the application to a fully functioning state after a failure.</span></span>

<span data-ttu-id="4f0c2-109">Aplikacja jest gotowa do użycia w chmurze, co wymaga co najmniej modelu odporności opartej na oprogramowaniu, a nie modelu sprzętowego.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-109">Your application is ready for the cloud when, at a minimum, it implements a software-based model of resiliency, rather than a hardware-based model.</span></span> <span data-ttu-id="4f0c2-110">Aplikacja w chmurze musi obejmować częściowe awarie, które wystąpiły.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-110">Your cloud application must embrace the partial failures that will certainly occur.</span></span> <span data-ttu-id="4f0c2-111">Zaprojektuj lub częściowo refaktoryzacji aplikacji w celu uzyskania odporności z oczekiwanymi częściowymi awariami.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-111">Design or partially refactor your application to achieve resiliency with expected partial failures.</span></span> <span data-ttu-id="4f0c2-112">Powinna być zaprojektowana tak, aby poradzić sobie ze częściowo niepowodzeńmi, takimi jak przejściowe przestoje i węzły sieci lub awarie maszyn wirtualnych w chmurze.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-112">It should be designed to cope with partial failures, like transient network outages and nodes, or VMs crashing in the cloud.</span></span> <span data-ttu-id="4f0c2-113">Nawet kontenery przenoszone do innego węzła w klastrze programu Orchestrator mogą spowodować sporadyczne krótkie błędy w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-113">Even containers being moved to a different node within an orchestrator cluster can cause intermittent short failures within the application.</span></span>

## <a name="handling-partial-failure"></a><span data-ttu-id="4f0c2-114">Obsługa częściowych niepowodzeń</span><span class="sxs-lookup"><span data-stu-id="4f0c2-114">Handling partial failure</span></span>

<span data-ttu-id="4f0c2-115">W aplikacji opartej na chmurze istnieje kiedykolwiek ryzyko częściowej awarii.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-115">In a cloud-based application, there's an ever-present risk of partial failure.</span></span> <span data-ttu-id="4f0c2-116">Na przykład pojedyncze wystąpienie witryny sieci Web lub kontener może kończyć się niepowodzeniem lub może być niedostępna lub nie odpowiadać przez krótki czas.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-116">For instance, a single website instance or a container might fail, or it might be unavailable or unresponsive for a short time.</span></span> <span data-ttu-id="4f0c2-117">Lub może ulec awarii Pojedyncza maszyna wirtualna lub serwer.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-117">Or, a single VM or server might crash.</span></span>

<span data-ttu-id="4f0c2-118">Ponieważ klienci i usługi są oddzielnymi procesami, usługa może nie być w stanie reagować w odpowiednim czasie na żądanie klienta.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-118">Because clients and services are separate processes, a service might not be able to respond in a timely manner to a client's request.</span></span> <span data-ttu-id="4f0c2-119">Usługa może być przeciążona i reagować na żądania lub może być niedostępna przez krótki czas z powodu problemów z siecią.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-119">The service might be overloaded and respond slowly to requests, or it might not be accessible for a short time because of network issues.</span></span>

<span data-ttu-id="4f0c2-120">Rozważmy na przykład monolityczną aplikację .NET, która uzyskuje dostęp do bazy danych w Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-120">For example, consider a monolithic .NET application that accesses a database in Azure SQL Database.</span></span> <span data-ttu-id="4f0c2-121">Jeśli baza danych Azure SQL lub jakakolwiek inna usługa nie odpowiada przez krótki czas (baza danych SQL Azure może zostać przeniesiona do innego węzła lub serwera i nie będzie odpowiadać przez kilka sekund), gdy użytkownik spróbuje wykonać dowolną akcję, aplikacja może ulec awarii i w tym samym czasie.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-121">If the Azure SQL database or any other third-party service is unresponsive for a brief time (an Azure SQL database might be moved to a different node or server, and be unresponsive for a few seconds), when the user tries to do any action, the application might crash and show an exception at the same moment.</span></span>

<span data-ttu-id="4f0c2-122">Podobny scenariusz może wystąpić w aplikacji, która korzysta z usług HTTP.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-122">A similar scenario might occur in an app that consumes HTTP services.</span></span> <span data-ttu-id="4f0c2-123">Sieć lub sama usługa może być niedostępna w chmurze w trakcie krótkiego, przejściowego błędu.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-123">The network or the service itself might not be available in the cloud during a short, transient failure.</span></span>

<span data-ttu-id="4f0c2-124">Odporna na błędy aplikacja, taka jak pokazana na rysunku 4-9, powinna implementować techniki takie jak "ponawianie prób z wykładniczą wycofywania", aby umożliwić aplikacji obsługę błędów przejściowych w zasobach.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-124">A resilient application like the one shown in Figure 4-9 should implement techniques like "retries with exponential backoff" to give the application an opportunity to handle transient failures in resources.</span></span> <span data-ttu-id="4f0c2-125">W aplikacjach należy również używać "wyłączników".</span><span class="sxs-lookup"><span data-stu-id="4f0c2-125">You also should use "circuit breakers" in your applications.</span></span> <span data-ttu-id="4f0c2-126">Wyłącznik przerywa aplikacji próbuje uzyskać dostęp do zasobu, gdy jest to długotrwałe niepowodzenie.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-126">A circuit breaker stops an application from trying to access a resource when it's actually a long-term failure.</span></span> <span data-ttu-id="4f0c2-127">Korzystając z wyłącznika, aplikacja unika wywoływania odmowy usługi do siebie samej.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-127">By using a circuit breaker, the application avoids provoking a denial of service to itself.</span></span>

![Diagram częściowych błędów obsłużonych przez ponowną próbę przy użyciu wykładniczej wycofywania.](./media/build-resilient-services-ready-for-the-cloud-embrace-transient-failures-in-the-cloud/retry-partial-failures.png)

<span data-ttu-id="4f0c2-129">**Rysunek 4-9.**</span><span class="sxs-lookup"><span data-stu-id="4f0c2-129">**Figure 4-9.**</span></span> <span data-ttu-id="4f0c2-130">Częściowe błędy obsłużone przez ponowną próbę przy użyciu wykładniczej wycofywania</span><span class="sxs-lookup"><span data-stu-id="4f0c2-130">Partial failures handled by retries with exponential backoff</span></span>

<span data-ttu-id="4f0c2-131">Tych technik można używać zarówno w przypadku zasobów HTTP, jak i zasobów bazy danych.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-131">You can use these techniques both in HTTP resources and in database resources.</span></span> <span data-ttu-id="4f0c2-132">Na rysunku 4-9 aplikacja jest oparta na architekturze 3-warstwowej, więc te metody są wymagane na poziomie usług (HTTP) i na poziomie warstwy danych (TCP).</span><span class="sxs-lookup"><span data-stu-id="4f0c2-132">In Figure 4-9, the application is based on a 3-tier architecture, so you need these techniques at the services level (HTTP) and at the data tier level (TCP).</span></span> <span data-ttu-id="4f0c2-133">W aplikacji monolitycznej, która korzysta tylko z jednej warstwy aplikacji oprócz bazy danych (bez dodatkowych usług lub mikrousług), obsługa błędów przejściowych na poziomie połączenia bazy danych może być wystarczająca.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-133">In a monolithic application that uses only a single app tier in addition to the database (no additional services or microservices), handling transient failures at the database connection level might be enough.</span></span> <span data-ttu-id="4f0c2-134">W tym scenariuszu wymagana jest tylko określona konfiguracja połączenia z bazą danych.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-134">In that scenario, just a particular configuration of the database connection is required.</span></span>

<span data-ttu-id="4f0c2-135">W przypadku wdrażania odpornego na błędy dostępu do bazy danych, w zależności od używanej wersji platformy .NET, może to być proste (na przykład [Entity Framework 6 lub nowsza](/ef/ef6/fundamentals/connection-resiliency/retry-logic)).</span><span class="sxs-lookup"><span data-stu-id="4f0c2-135">When implementing resilient communications that access the database, depending on the version of .NET you are using, it can be straightforward (for example, [with Entity Framework 6 or later](/ef/ef6/fundamentals/connection-resiliency/retry-logic).</span></span> <span data-ttu-id="4f0c2-136">Jest to tylko kwestia konfigurowania połączenia z bazą danych.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-136">It's just a matter of configuring the database connection).</span></span> <span data-ttu-id="4f0c2-137">Może być też konieczne użycie dodatkowych bibliotek, takich jak [blok obsługi błędów przejściowych](https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)) (dla wcześniejszych wersji programu .NET), a nawet zaimplementowanie własnej biblioteki.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-137">Or, you might need to use additional libraries like the [Transient Fault Handling Application Block](https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)) (for earlier versions of .NET), or even implement your own library.</span></span>

<span data-ttu-id="4f0c2-138">W przypadku wdrażania ponownych prób HTTP i wyłączników, zalecenie dotyczące platformy .NET polega na użyciu biblioteki [Polly](https://github.com/App-vNext/Polly) , która jest przeznaczona dla .NET Framework 4,0, .NET Framework 4,5 i .NET standard 1,1, która obejmuje obsługę platformy .NET Core.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-138">When implementing HTTP retries and circuit breakers, the recommendation for .NET is to use the [Polly](https://github.com/App-vNext/Polly) library, which targets .NET Framework 4.0, .NET Framework 4.5, and .NET Standard 1.1, which includes .NET Core support.</span></span>

<span data-ttu-id="4f0c2-139">Aby dowiedzieć się, jak zaimplementować strategie obsługi częściowych awarii w chmurze, zobacz następujące odwołania.</span><span class="sxs-lookup"><span data-stu-id="4f0c2-139">To learn how to implement strategies for handling partial failures in the cloud, see the following references.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="4f0c2-140">Dodatkowe zasoby</span><span class="sxs-lookup"><span data-stu-id="4f0c2-140">Additional resources</span></span>

- <span data-ttu-id="4f0c2-141">**Implementowanie komunikacji odpornej na obsługę częściowej awarii**</span><span class="sxs-lookup"><span data-stu-id="4f0c2-141">**Implementing resilient communication to handle partial failure**</span></span>

    [https://docs.microsoft.com/dotnet/architecture/microservices/implement-resilient-applications/partial-failure-strategies](../../microservices/implement-resilient-applications/partial-failure-strategies.md)

- <span data-ttu-id="4f0c2-142">**Entity Framework odporność połączenia i logika ponawiania prób (wersja 6 i nowsze)**</span><span class="sxs-lookup"><span data-stu-id="4f0c2-142">**Entity Framework connection resiliency and retry logic (version 6 and later)**</span></span>

    [https://docs.microsoft.com/ef/ef6/fundamentals/connection-resiliency/retry-logic](/ef/ef6/fundamentals/connection-resiliency/retry-logic)

- <span data-ttu-id="4f0c2-143">**Blok aplikacji do obsługi błędów przejściowych**</span><span class="sxs-lookup"><span data-stu-id="4f0c2-143">**The Transient Fault Handling Application Block**</span></span>

- <https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)>

- <span data-ttu-id="4f0c2-144">**Biblioteka Polly do odpornej komunikacji HTTP**</span><span class="sxs-lookup"><span data-stu-id="4f0c2-144">**Polly library for resilient HTTP communication**</span></span>

    https://github.com/App-vNext/Polly

>[!div class="step-by-step"]
><span data-ttu-id="4f0c2-145">[Poprzedni](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
>[dalej](modernize-your-apps-with-monitoring-and-telemetry.md)</span><span class="sxs-lookup"><span data-stu-id="4f0c2-145">[Previous](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
[Next](modernize-your-apps-with-monitoring-and-telemetry.md)</span></span>
