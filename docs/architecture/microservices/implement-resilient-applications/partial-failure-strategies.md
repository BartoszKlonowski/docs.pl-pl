---
title: Strategie dotyczące obsługi częściowych niepowodzeń
description: Zapoznaj się z kilkoma strategiami obsługi częściowych awarii z gracją.
ms.date: 10/16/2018
ms.openlocfilehash: abf87df5afed02b4d794a1307a0ed943cafb4db3
ms.sourcegitcommit: e3cbf26d67f7e9286c7108a2752804050762d02d
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/09/2020
ms.locfileid: "80988807"
---
# <a name="strategies-to-handle-partial-failure"></a><span data-ttu-id="a9c14-103">Strategie obsługi częściowej awarii</span><span class="sxs-lookup"><span data-stu-id="a9c14-103">Strategies to handle partial failure</span></span>

<span data-ttu-id="a9c14-104">Strategie radzenia sobie z częściowymi awariami są następujące.</span><span class="sxs-lookup"><span data-stu-id="a9c14-104">Strategies for dealing with partial failures include the following.</span></span>

<span data-ttu-id="a9c14-105">**Użyj komunikacji asynchroniiowej (na przykład komunikacji opartej na wiadomościach) w mikrousługach wewnętrznych.**</span><span class="sxs-lookup"><span data-stu-id="a9c14-105">**Use asynchronous communication (for example, message-based communication) across internal microservices**.</span></span> <span data-ttu-id="a9c14-106">Jest wysoce wskazane, aby nie tworzyć długie łańcuchy synchronicznych wywołań HTTP w ramach mikrousług wewnętrznych, ponieważ ten niepoprawny projekt ostatecznie stanie się główną przyczyną awarii.</span><span class="sxs-lookup"><span data-stu-id="a9c14-106">It's highly advisable not to create long chains of synchronous HTTP calls across the internal microservices because that incorrect design will eventually become the main cause of bad outages.</span></span> <span data-ttu-id="a9c14-107">Wręcz przeciwnie, z wyjątkiem komunikacji frontonu między aplikacjami klienckimi i pierwszego poziomu mikrousług lub szczegółowe bramy interfejsu API, zaleca się używać tylko komunikacji asynchroniiowej (opartej na wiadomości) po przekroczeniu początkowego cyklu żądania/odpowiedzi w ramach wewnętrznych mikrousług.</span><span class="sxs-lookup"><span data-stu-id="a9c14-107">On the contrary, except for the front-end communications between the client applications and the first level of microservices or fine-grained API Gateways, it's recommended to use only asynchronous (message-based) communication once past the initial request/response cycle, across the internal microservices.</span></span> <span data-ttu-id="a9c14-108">Spójność ostateczna i architektury oparte na zdarzeniach pomogą zminimalizować efekty tętnienia.</span><span class="sxs-lookup"><span data-stu-id="a9c14-108">Eventual consistency and event-driven architectures will help to minimize ripple effects.</span></span> <span data-ttu-id="a9c14-109">Te podejścia wymuszają wyższy poziom autonomii mikrousług i w związku z tym zapobiegają problemowi odnotowanemu w tym miejscu.</span><span class="sxs-lookup"><span data-stu-id="a9c14-109">These approaches enforce a higher level of microservice autonomy and therefore prevent against the problem noted here.</span></span>

<span data-ttu-id="a9c14-110">**Użyj ponownych prób z wykładniczym wycofywania**.</span><span class="sxs-lookup"><span data-stu-id="a9c14-110">**Use retries with exponential backoff**.</span></span> <span data-ttu-id="a9c14-111">Ta technika pomaga uniknąć błędów krótkich i przerywanych przez wykonywanie prób ponawiania połączeń określoną liczbę razy, w przypadku, gdy usługa nie była dostępna tylko przez krótki czas.</span><span class="sxs-lookup"><span data-stu-id="a9c14-111">This technique helps to avoid short and intermittent failures by performing call retries a certain number of times, in case the service was not available only for a short time.</span></span> <span data-ttu-id="a9c14-112">Może to wystąpić z powodu sporadyczne problemy z siecią lub gdy mikrousługi/kontenera jest przenoszony do innego węzła w klastrze.</span><span class="sxs-lookup"><span data-stu-id="a9c14-112">This might occur due to intermittent network issues or when a microservice/container is moved to a different node in a cluster.</span></span> <span data-ttu-id="a9c14-113">Jeśli jednak te ponownych prób nie są prawidłowo zaprojektowane z wyłącznikami, może to pogorszyć efekty tętnienia, ostatecznie nawet powodując [odmowę usługi (DoS)](https://en.wikipedia.org/wiki/Denial-of-service_attack).</span><span class="sxs-lookup"><span data-stu-id="a9c14-113">However, if these retries are not designed properly with circuit breakers, it can aggravate the ripple effects, ultimately even causing a [Denial of Service (DoS)](https://en.wikipedia.org/wiki/Denial-of-service_attack).</span></span>

<span data-ttu-id="a9c14-114">**Obejście limitów czasu sieci .**</span><span class="sxs-lookup"><span data-stu-id="a9c14-114">**Work around network timeouts**.</span></span> <span data-ttu-id="a9c14-115">Ogólnie rzecz biorąc klienci powinni być zaprojektowane, aby nie blokować przez czas nieokreślony i zawsze używać limitów czasu podczas oczekiwania na odpowiedź.</span><span class="sxs-lookup"><span data-stu-id="a9c14-115">In general, clients should be designed not to block indefinitely and to always use timeouts when waiting for a response.</span></span> <span data-ttu-id="a9c14-116">Za pomocą limitów czasu zapewnia, że zasoby nigdy nie są powiązane przez czas nieokreślony.</span><span class="sxs-lookup"><span data-stu-id="a9c14-116">Using timeouts ensures that resources are never tied up indefinitely.</span></span>

<span data-ttu-id="a9c14-117">**Użyj wzorca wyłącznika**.</span><span class="sxs-lookup"><span data-stu-id="a9c14-117">**Use the Circuit Breaker pattern**.</span></span> <span data-ttu-id="a9c14-118">W tym podejściu proces klienta śledzi liczbę żądań nie powiodło się.</span><span class="sxs-lookup"><span data-stu-id="a9c14-118">In this approach, the client process tracks the number of failed requests.</span></span> <span data-ttu-id="a9c14-119">Jeśli poziom błędu przekracza skonfigurowany limit, "wyłącznik" pokonuje, aby natychmiast zakończyć się niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="a9c14-119">If the error rate exceeds a configured limit, a "circuit breaker" trips so that further attempts fail immediately.</span></span> <span data-ttu-id="a9c14-120">(Jeśli duża liczba żądań nie powiódł się, sugeruje to, że usługa jest niedostępna i że wysyłanie żądań jest bezcelowe). Po upływie limitu czasu klient powinien spróbować ponownie i, jeśli nowe żądania zakończą się pomyślnie, zamknij wyłącznik.</span><span class="sxs-lookup"><span data-stu-id="a9c14-120">(If a large number of requests are failing, that suggests the service is unavailable and that sending requests is pointless.) After a timeout period, the client should try again and, if the new requests are successful, close the circuit breaker.</span></span>

<span data-ttu-id="a9c14-121">**Zapewnij rezerwowe**.</span><span class="sxs-lookup"><span data-stu-id="a9c14-121">**Provide fallbacks**.</span></span> <span data-ttu-id="a9c14-122">W tym podejściu proces klienta wykonuje logikę rezerwową, gdy żądanie kończy się niepowodzeniem, takie jak zwracanie danych w pamięci podręcznej lub wartość domyślna.</span><span class="sxs-lookup"><span data-stu-id="a9c14-122">In this approach, the client process performs fallback logic when a request fails, such as returning cached data or a default value.</span></span> <span data-ttu-id="a9c14-123">Jest to podejście odpowiednie dla zapytań i jest bardziej złożone dla aktualizacji lub poleceń.</span><span class="sxs-lookup"><span data-stu-id="a9c14-123">This is an approach suitable for queries, and is more complex for updates or commands.</span></span>

<span data-ttu-id="a9c14-124">**Ogranicz liczbę żądań w kolejce**.</span><span class="sxs-lookup"><span data-stu-id="a9c14-124">**Limit the number of queued requests**.</span></span> <span data-ttu-id="a9c14-125">Klienci powinni również nałożyć górną granicę na liczbę zaległych żądań, które mikrousługa klienta może wysyłać do określonej usługi.</span><span class="sxs-lookup"><span data-stu-id="a9c14-125">Clients should also impose an upper bound on the number of outstanding requests that a client microservice can send to a particular service.</span></span> <span data-ttu-id="a9c14-126">Jeśli limit został osiągnięty, prawdopodobnie nie ma sensu wysuwać dodatkowych żądań, a te próby powinny zakończyć się niepowodzeniem natychmiast.</span><span class="sxs-lookup"><span data-stu-id="a9c14-126">If the limit has been reached, it's probably pointless to make additional requests, and those attempts should fail immediately.</span></span> <span data-ttu-id="a9c14-127">Pod względem implementacji zasady [izolacji grodzi](https://github.com/App-vNext/Polly/wiki/Bulkhead) polly mogą być używane do spełnienia tego wymogu.</span><span class="sxs-lookup"><span data-stu-id="a9c14-127">In terms of implementation, the Polly [Bulkhead Isolation](https://github.com/App-vNext/Polly/wiki/Bulkhead) policy can be used to fulfill this requirement.</span></span> <span data-ttu-id="a9c14-128">Takie podejście jest zasadniczo przepustnicy równoległości z <xref:System.Threading.SemaphoreSlim> jako implementacji.</span><span class="sxs-lookup"><span data-stu-id="a9c14-128">This approach is essentially a parallelization throttle with <xref:System.Threading.SemaphoreSlim> as the implementation.</span></span> <span data-ttu-id="a9c14-129">Pozwala również na "kolejkę" poza grodzią.</span><span class="sxs-lookup"><span data-stu-id="a9c14-129">It also permits a "queue" outside the bulkhead.</span></span> <span data-ttu-id="a9c14-130">Można proaktywnie zrzucić nadmiar obciążenia jeszcze przed wykonaniem (na przykład, ponieważ pojemność jest uważana za pełną).</span><span class="sxs-lookup"><span data-stu-id="a9c14-130">You can proactively shed excess load even before execution (for example, because capacity is deemed full).</span></span> <span data-ttu-id="a9c14-131">To sprawia, że jego odpowiedzi na niektóre scenariusze awarii szybciej niż wyłącznik będzie, ponieważ wyłącznik czeka na awarie.</span><span class="sxs-lookup"><span data-stu-id="a9c14-131">This makes its response to certain failure scenarios faster than a circuit breaker would be, since the circuit breaker waits for the failures.</span></span> <span data-ttu-id="a9c14-132">Obiekt BulkheadPolicy w [Polly](http://www.thepollyproject.org/) ujawnia, jak pełne są grodzi i kolejki i oferuje zdarzenia na przepełnienie, dzięki czemu może być również używany do kierowania automatycznego skalowania poziomego.</span><span class="sxs-lookup"><span data-stu-id="a9c14-132">The BulkheadPolicy object in [Polly](http://www.thepollyproject.org/) exposes how full the bulkhead and queue are, and offers events on overflow so can also be used to drive automated horizontal scaling.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="a9c14-133">Zasoby dodatkowe</span><span class="sxs-lookup"><span data-stu-id="a9c14-133">Additional resources</span></span>

- <span data-ttu-id="a9c14-134">**Wzorce odporności**</span><span class="sxs-lookup"><span data-stu-id="a9c14-134">**Resiliency patterns**</span></span>\
  [https://docs.microsoft.com/azure/architecture/patterns/category/resiliency](/azure/architecture/patterns/category/resiliency)

- <span data-ttu-id="a9c14-135">**Dodawanie odporności i optymalizacja wydajności**</span><span class="sxs-lookup"><span data-stu-id="a9c14-135">**Adding Resilience and Optimizing Performance**</span></span>\
  <https://docs.microsoft.com/previous-versions/msp-n-p/jj591574(v=pandp.10)>

- <span data-ttu-id="a9c14-136">**Grodzi.**</span><span class="sxs-lookup"><span data-stu-id="a9c14-136">**Bulkhead.**</span></span> <span data-ttu-id="a9c14-137">Repozytorium GitHub.</span><span class="sxs-lookup"><span data-stu-id="a9c14-137">GitHub repo.</span></span> <span data-ttu-id="a9c14-138">Implementacja z zasadą Polly.</span><span class="sxs-lookup"><span data-stu-id="a9c14-138">Implementation with Polly policy.</span></span>\
  <https://github.com/App-vNext/Polly/wiki/Bulkhead>

- <span data-ttu-id="a9c14-139">**Projektowanie odpornych aplikacji na platformę Azure**</span><span class="sxs-lookup"><span data-stu-id="a9c14-139">**Designing resilient applications for Azure**</span></span>\
  [https://docs.microsoft.com/azure/architecture/resiliency/](/azure/architecture/resiliency/)

- <span data-ttu-id="a9c14-140">**Obsługa błędów przejściowych**</span><span class="sxs-lookup"><span data-stu-id="a9c14-140">**Transient fault handling**</span></span>\
  [https://docs.microsoft.com/azure/architecture/best-practices/transient-faults](/azure/architecture/best-practices/transient-faults)

>[!div class="step-by-step"]
><span data-ttu-id="a9c14-141">[Poprzedni](handle-partial-failure.md)
>[następny](implement-retries-exponential-backoff.md)</span><span class="sxs-lookup"><span data-stu-id="a9c14-141">[Previous](handle-partial-failure.md)
[Next](implement-retries-exponential-backoff.md)</span></span>
