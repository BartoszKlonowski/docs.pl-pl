---
title: Implementowanie komunikacji opartej na zdarzeniach między mikrousługami (zdarzenia integracji)
description: Architektura mikrousług platformy .NET dla aplikacji platformy .NET w kontenerze | Zrozumienie zdarzeń integracji w celu zaimplementowania komunikacji opartej na zdarzeniach między mikrousługami.
ms.date: 10/02/2018
ms.openlocfilehash: a778acba3e17b084840b77d903533f9180ca01d9
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 09/24/2020
ms.locfileid: "91152536"
---
# <a name="implementing-event-based-communication-between-microservices-integration-events"></a><span data-ttu-id="9e2b6-103">Implementowanie komunikacji opartej na zdarzeniach między mikrousługami (zdarzenia integracji)</span><span class="sxs-lookup"><span data-stu-id="9e2b6-103">Implementing event-based communication between microservices (integration events)</span></span>

<span data-ttu-id="9e2b6-104">Zgodnie z wcześniejszym opisem, gdy używasz komunikacji opartej na zdarzeniach, mikrousługa publikuje zdarzenie w przypadku, gdy coś się stało, na przykład gdy aktualizuje jednostkę biznesową.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-104">As described earlier, when you use event-based communication, a microservice publishes an event when something notable happens, such as when it updates a business entity.</span></span> <span data-ttu-id="9e2b6-105">Inne mikrousługi subskrybują te zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-105">Other microservices subscribe to those events.</span></span> <span data-ttu-id="9e2b6-106">Gdy mikrousługa otrzymuje zdarzenie, może aktualizować własne jednostki biznesowe, co może prowadzić do publikowania większej liczby zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-106">When a microservice receives an event, it can update its own business entities, which might lead to more events being published.</span></span> <span data-ttu-id="9e2b6-107">Jest to istota koncepcji spójności ostatecznej.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-107">This is the essence of the eventual consistency concept.</span></span> <span data-ttu-id="9e2b6-108">Ten system publikowania/subskrybowania jest zwykle wykonywany przy użyciu implementacji magistrali zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-108">This publish/subscribe system is usually performed by using an implementation of an event bus.</span></span> <span data-ttu-id="9e2b6-109">Magistrala zdarzeń może być zaprojektowana jako interfejs z interfejsem API, który jest wymagany do subskrybowania i anulowania subskrypcji zdarzeń oraz do publikowania zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-109">The event bus can be designed as an interface with the API needed to subscribe and unsubscribe to events and to publish events.</span></span> <span data-ttu-id="9e2b6-110">Może również mieć co najmniej jedną implementację opartą na komunikacji między procesami lub obsługą komunikatów, taką jak kolejka komunikatów lub Usługa Service Bus, która obsługuje komunikację asynchroniczną i model publikowania/subskrybowania.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-110">It can also have one or more implementations based on any inter-process or messaging communication, such as a messaging queue or a service bus that supports asynchronous communication and a publish/subscribe model.</span></span>

<span data-ttu-id="9e2b6-111">Zdarzenia mogą służyć do implementowania transakcji handlowych obejmujących wiele usług, co zapewnia spójność między tymi usługami.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-111">You can use events to implement business transactions that span multiple services, which gives you eventual consistency between those services.</span></span> <span data-ttu-id="9e2b6-112">Ostatecznie spójna transakcja składa się z serii działań rozproszonych.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-112">An eventually consistent transaction consists of a series of distributed actions.</span></span> <span data-ttu-id="9e2b6-113">W każdej akcji mikrousługa aktualizuje jednostkę biznesową i publikuje zdarzenie, które wyzwala następną akcję.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-113">At each action, the microservice updates a business entity and publishes an event that triggers the next action.</span></span> <span data-ttu-id="9e2b6-114">Na rysunku 6-18 poniżej znajduje się zdarzenie PriceUpdated opublikowane za pomocą usługi Event Bus, dzięki czemu Aktualizacja ceny jest propagowana do koszyka i innych mikrousług.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-114">Figure 6-18 below, shows a PriceUpdated event published through an event bus, so the price update is propagated to the Basket and other microservices.</span></span>

![Diagram komunikacji asynchronicznej sterowanej zdarzeniami z magistralą zdarzeń.](./media/integration-event-based-microservice-communications/event-driven-communication.png)

<span data-ttu-id="9e2b6-116">**Rysunek 6-18**.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-116">**Figure 6-18**.</span></span> <span data-ttu-id="9e2b6-117">Komunikacja sterowana zdarzeniami oparta na magistrali zdarzeń</span><span class="sxs-lookup"><span data-stu-id="9e2b6-117">Event-driven communication based on an event bus</span></span>

<span data-ttu-id="9e2b6-118">W tej sekcji opisano, jak można zaimplementować ten typ komunikacji z platformą .NET przy użyciu ogólnego interfejsu magistrali zdarzeń, jak pokazano na rysunku 6-18.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-118">This section describes how you can implement this type of communication with .NET by using a generic event bus interface, as shown in Figure 6-18.</span></span> <span data-ttu-id="9e2b6-119">Istnieje wiele potencjalnych implementacji, z których każda korzysta z innej technologii lub infrastruktury, takiej jak RabbitMQ, Azure Service Bus lub jakakolwiek inna usługa typu open-source innej firmy lub komercyjnej usługi Service Bus.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-119">There are multiple potential implementations, each using a different technology or infrastructure such as RabbitMQ, Azure Service Bus, or any other third-party open-source or commercial service bus.</span></span>

## <a name="using-message-brokers-and-services-buses-for-production-systems"></a><span data-ttu-id="9e2b6-120">Korzystanie z brokerów komunikatów i magistrali usług dla systemów produkcyjnych</span><span class="sxs-lookup"><span data-stu-id="9e2b6-120">Using message brokers and services buses for production systems</span></span>

<span data-ttu-id="9e2b6-121">Zgodnie z opisem w sekcji architektura można wybrać jedną z wielu technologii obsługi komunikatów w celu zaimplementowania abstrakcyjnej magistrali zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-121">As noted in the architecture section, you can choose from multiple messaging technologies for implementing your abstract event bus.</span></span> <span data-ttu-id="9e2b6-122">Jednak te technologie są na różnych poziomach.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-122">But these technologies are at different levels.</span></span> <span data-ttu-id="9e2b6-123">Na przykład RabbitMQ, transport brokera komunikatów, znajduje się na niższym poziomie niż produkty komercyjne, takie jak Azure Service Bus, NServiceBus, MassTransit lub jaśniejszy.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-123">For instance, RabbitMQ, a messaging broker transport, is at a lower level than commercial products like Azure Service Bus, NServiceBus, MassTransit, or Brighter.</span></span> <span data-ttu-id="9e2b6-124">Większość z tych produktów może korzystać z RabbitMQ lub Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-124">Most of these products can work on top of either RabbitMQ or Azure Service Bus.</span></span> <span data-ttu-id="9e2b6-125">Wybór produktu zależy od tego, ile funkcji i ile jest potrzebnych skalowalności aplikacji.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-125">Your choice of product depends on how many features and how much out-of-the-box scalability you need for your application.</span></span>

<span data-ttu-id="9e2b6-126">W celu zaimplementowania tylko weryfikacji usługi Event Bus dla środowiska deweloperskiego, tak jak w przykładzie eShopOnContainers, prosta implementacja na RabbitMQ działa jako kontener może być wystarczająca.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-126">For implementing just an event bus proof-of-concept for your development environment, as in the eShopOnContainers sample, a simple implementation on top of RabbitMQ running as a container might be enough.</span></span> <span data-ttu-id="9e2b6-127">Jednak w przypadku systemów o znaczeniu krytycznym i produkcyjnym wymagających wysokiej skalowalności warto oszacować i użyć Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-127">But for mission-critical and production systems that need high scalability, you might want to evaluate and use Azure Service Bus.</span></span>

<span data-ttu-id="9e2b6-128">Jeśli wymagane są abstrakcje wysokiego poziomu i bogatsze funkcje, takie jak [sagach](https://docs.particular.net/nservicebus/sagas/) dla długotrwałych procesów, które ułatwiają opracowywanie rozproszonego, inne komercyjne i typu "open source", takie jak NServiceBus, MassTransit i jaśniejszy, oceniają.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-128">If you require high-level abstractions and richer features like [Sagas](https://docs.particular.net/nservicebus/sagas/) for long-running processes that make distributed development easier, other commercial and open-source service buses like NServiceBus, MassTransit, and Brighter are worth evaluating.</span></span> <span data-ttu-id="9e2b6-129">W takim przypadku abstrakcje i interfejsy API, które mają być używane, zwykle są bezpośrednio podane przez te magistrale usług wyższego poziomu zamiast własnych streszczeń (takich jak [proste abstrakcje magistrali zdarzeń dostępne w eShopOnContainers](https://github.com/dotnet-architecture/eShopOnContainers/blob/dev/src/BuildingBlocks/EventBus/EventBus/Abstractions/IEventBus.cs)).</span><span class="sxs-lookup"><span data-stu-id="9e2b6-129">In this case, the abstractions and API to use would usually be directly the ones provided by those high-level service buses instead of your own abstractions (like the [simple event bus abstractions provided at eShopOnContainers](https://github.com/dotnet-architecture/eShopOnContainers/blob/dev/src/BuildingBlocks/EventBus/EventBus/Abstractions/IEventBus.cs)).</span></span> <span data-ttu-id="9e2b6-130">W takim przypadku można zbadać [eShopOnContainers rozwidlenia przy użyciu NServiceBus](https://go.particular.net/eShopOnContainers) (dodatkowe pochodne próbki zaimplementowane przez określone oprogramowanie).</span><span class="sxs-lookup"><span data-stu-id="9e2b6-130">For that matter, you can research the [forked eShopOnContainers using NServiceBus](https://go.particular.net/eShopOnContainers) (additional derived sample implemented by Particular Software).</span></span>

<span data-ttu-id="9e2b6-131">Oczywiście można zawsze tworzyć własne funkcje usługi Service Bus na podstawie technologii niższego poziomu, takich jak RabbitMQ i Docker, ale pracy wymaganej do "odtworzenia kółka" może być zbyt kosztowne dla niestandardowej aplikacji przedsiębiorstwa.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-131">Of course, you could always build your own service bus features on top of lower-level technologies like RabbitMQ and Docker, but the work needed to "reinvent the wheel" might be too costly for a custom enterprise application.</span></span>

<span data-ttu-id="9e2b6-132">Aby wykonać ponownie iterację: abstrakcje i implementacje magistrali zdarzeń opisane w próbce eShopOnContainers są przeznaczone do użycia tylko jako Weryfikacja koncepcji.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-132">To reiterate: the sample event bus abstractions and implementation showcased in the eShopOnContainers sample are intended to be used only as a proof of concept.</span></span> <span data-ttu-id="9e2b6-133">Po ustaleniu, że chcesz mieć komunikację asynchroniczną i opartą na zdarzeniach, jak wyjaśniono w bieżącej sekcji, należy wybrać produkt usługi Service Bus, który najlepiej odpowiada Twoim potrzebom produkcyjnym.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-133">Once you have decided that you want to have asynchronous and event-driven communication, as explained in the current section, you should choose the service bus product that best fits your needs for production.</span></span>

## <a name="integration-events"></a><span data-ttu-id="9e2b6-134">Zdarzenia integracji</span><span class="sxs-lookup"><span data-stu-id="9e2b6-134">Integration events</span></span>

<span data-ttu-id="9e2b6-135">Zdarzenia integracji służą do przełączania stanu domeny w ramach wielu mikrousług lub systemów zewnętrznych.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-135">Integration events are used for bringing domain state in sync across multiple microservices or external systems.</span></span> <span data-ttu-id="9e2b6-136">Jest to realizowane przez opublikowanie zdarzeń integracji poza mikrousługą.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-136">This is done by publishing integration events outside the microservice.</span></span> <span data-ttu-id="9e2b6-137">W przypadku opublikowania zdarzenia w wielu mikrousługach odbiornika (do jak wielu mikrousług jako subskrybowanych przez zdarzenie integracji) odpowiednia procedura obsługi zdarzeń w każdej mikrousłudze odbiornika obsługuje zdarzenie.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-137">When an event is published to multiple receiver microservices (to as many microservices as are subscribed to the integration event), the appropriate event handler in each receiver microservice handles the event.</span></span>

<span data-ttu-id="9e2b6-138">Zdarzenie integracji jest zasadniczo klasą holdingu danych, jak w poniższym przykładzie:</span><span class="sxs-lookup"><span data-stu-id="9e2b6-138">An integration event is basically a data-holding class, as in the following example:</span></span>

```csharp
public class ProductPriceChangedIntegrationEvent : IntegrationEvent
{
    public int ProductId { get; private set; }
    public decimal NewPrice { get; private set; }
    public decimal OldPrice { get; private set; }

    public ProductPriceChangedIntegrationEvent(int productId, decimal newPrice,
        decimal oldPrice)
    {
        ProductId = productId;
        NewPrice = newPrice;
        OldPrice = oldPrice;
    }
}
```

<span data-ttu-id="9e2b6-139">Zdarzenia integracji można definiować na poziomie aplikacji każdej mikrousług, dzięki czemu są one oddzielone od innych mikrousług, podobnie jak modele widoków są zdefiniowane na serwerze i kliencie.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-139">The integration events can be defined at the application level of each microservice, so they are decoupled from other microservices, in a way comparable to how ViewModels are defined in the server and client.</span></span> <span data-ttu-id="9e2b6-140">Nie zaleca się udostępniania wspólnej biblioteki zdarzeń integracji w wielu mikrousługach; Dzięki temu można sprzęgać te mikrousługi za pomocą pojedynczej biblioteki danych definicji zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-140">What is not recommended is sharing a common integration events library across multiple microservices; doing that would be coupling those microservices with a single event definition data library.</span></span> <span data-ttu-id="9e2b6-141">Nie chcesz tego robić z tego samego powodu, w którym nie chcesz udostępniać wspólnego modelu domeny w wielu mikrousługach: mikrousługi muszą być całkowicie autonomiczne.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-141">You do not want to do that for the same reasons that you do not want to share a common domain model across multiple microservices: microservices must be completely autonomous.</span></span>

<span data-ttu-id="9e2b6-142">Istnieje tylko kilka rodzajów bibliotek, które powinny być współużytkowane przez mikrousługi.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-142">There are only a few kinds of libraries you should share across microservices.</span></span> <span data-ttu-id="9e2b6-143">Jedną z nich są biblioteki, które są końcowymi blokami aplikacji, na przykład [interfejs API klienta usługi Event Bus](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/BuildingBlocks/EventBus), jak w eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-143">One is libraries that are final application blocks, like the [Event Bus client API](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/BuildingBlocks/EventBus), as in eShopOnContainers.</span></span> <span data-ttu-id="9e2b6-144">Inne to biblioteki, które stanowią narzędzia, które mogą być również udostępniane jako składniki NuGet, takie jak serializatory JSON.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-144">Another is libraries that constitute tools that could also be shared as NuGet components, like JSON serializers.</span></span>

## <a name="the-event-bus"></a><span data-ttu-id="9e2b6-145">Magistrala zdarzeń</span><span class="sxs-lookup"><span data-stu-id="9e2b6-145">The event bus</span></span>

<span data-ttu-id="9e2b6-146">Magistrala zdarzeń umożliwia komunikację w stylu publikacji/subskrypcji między mikrousługami bez konieczności jawnego informowania składników, jak pokazano na rysunku 6-19.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-146">An event bus allows publish/subscribe-style communication between microservices without requiring the components to explicitly be aware of each other, as shown in Figure 6-19.</span></span>

![Diagram przedstawiający podstawowy wzorzec publikowania/subskrybowania.](./media/integration-event-based-microservice-communications/publish-subscribe-basics.png)

<span data-ttu-id="9e2b6-148">**Rysunek 6-19**.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-148">**Figure 6-19**.</span></span> <span data-ttu-id="9e2b6-149">Podstawowe informacje dotyczące publikowania/subskrybowania za pomocą usługi Event Bus</span><span class="sxs-lookup"><span data-stu-id="9e2b6-149">Publish/subscribe basics with an event bus</span></span>

<span data-ttu-id="9e2b6-150">Na powyższym diagramie przedstawiono, że mikrousługa A publikuje w usłudze Event Bus, która dystrybuuje w celu subskrybowania mikrousług B i C, bez konieczności poznania subskrybentów przez wydawcę.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-150">The above diagram shows that microservice A publishes to Event Bus, which distributes to subscribing microservices B and C, without the publisher needing to know the subscribers.</span></span> <span data-ttu-id="9e2b6-151">Magistrala zdarzeń jest powiązana ze wzorcem obserwatora i wzorcem publikowania/subskrybowania.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-151">The event bus is related to the Observer pattern and the publish-subscribe pattern.</span></span>

### <a name="observer-pattern"></a><span data-ttu-id="9e2b6-152">Wzorzec obserwatora</span><span class="sxs-lookup"><span data-stu-id="9e2b6-152">Observer pattern</span></span>

<span data-ttu-id="9e2b6-153">We [wzorcu obserwatora](https://en.wikipedia.org/wiki/Observer_pattern)obiekt podstawowy (znany jako widoczny) powiadamia inne zainteresowane obiekty (zwane obserwatorami) z odpowiednimi informacjami (zdarzenia).</span><span class="sxs-lookup"><span data-stu-id="9e2b6-153">In the [Observer pattern](https://en.wikipedia.org/wiki/Observer_pattern), your primary object (known as the Observable) notifies other interested objects (known as Observers) with relevant information (events).</span></span>

### <a name="publishsubscribe-pubsub-pattern"></a><span data-ttu-id="9e2b6-154">Wzorzec publikowania/subskrybowania (pub/Sub)</span><span class="sxs-lookup"><span data-stu-id="9e2b6-154">Publish/Subscribe (Pub/Sub) pattern</span></span>

<span data-ttu-id="9e2b6-155">Celem [wzorca publikowania/subskrybowania](/previous-versions/msp-n-p/ff649664(v=pandp.10)) jest taka sama jak wzorzec obserwatora: chcesz powiadomić inne usługi o wystąpieniu pewnych zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-155">The purpose of the [Publish/Subscribe pattern](/previous-versions/msp-n-p/ff649664(v=pandp.10)) is the same as the Observer pattern: you want to notify other services when certain events take place.</span></span> <span data-ttu-id="9e2b6-156">Ale istnieje istotna różnica między wzorcem obserwatora a publikowaniem/podrzędnym.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-156">But there is an important difference between the Observer and Pub/Sub patterns.</span></span> <span data-ttu-id="9e2b6-157">We wzorcu obserwatora emisja jest wykonywana bezpośrednio od zauważalnych obserwatorów, więc "wiedzą".</span><span class="sxs-lookup"><span data-stu-id="9e2b6-157">In the observer pattern, the broadcast is performed directly from the observable to the observers, so they "know" each other.</span></span> <span data-ttu-id="9e2b6-158">Jednak w przypadku korzystania ze wzorca publikowania/sub, istnieje trzeci składnik, nazywany brokerem lub brokerem komunikatów lub magistralą zdarzeń, który jest znany przez wydawcę i abonenta.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-158">But when using a Pub/Sub pattern, there is a third component, called broker or message broker or event bus, which is known by both the publisher and subscriber.</span></span> <span data-ttu-id="9e2b6-159">W związku z tym w przypadku używania wzorca publikowania/podłączania Wydawca i Subskrybenci są precyzyjnie oddzielone przez wymienioną magistralę zdarzeń lub brokera komunikatów.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-159">Therefore, when using the Pub/Sub pattern the publisher and the subscribers are precisely decoupled thanks to the mentioned event bus or message broker.</span></span>

### <a name="the-middleman-or-event-bus"></a><span data-ttu-id="9e2b6-160">Centrum oprogramowania lub magistrali zdarzeń</span><span class="sxs-lookup"><span data-stu-id="9e2b6-160">The middleman or event bus</span></span>

<span data-ttu-id="9e2b6-161">Jak uzyskać anonimowość między wydawcą a subskrybentem?</span><span class="sxs-lookup"><span data-stu-id="9e2b6-161">How do you achieve anonymity between publisher and subscriber?</span></span> <span data-ttu-id="9e2b6-162">Prostym sposobem jest poinformowanie o całej komunikacji przez centrum.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-162">An easy way is let a middleman take care of all the communication.</span></span> <span data-ttu-id="9e2b6-163">Magistrala zdarzeń to ten środek pośredniczący.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-163">An event bus is one such middleman.</span></span>

<span data-ttu-id="9e2b6-164">Magistrala zdarzeń zwykle składa się z dwóch części:</span><span class="sxs-lookup"><span data-stu-id="9e2b6-164">An event bus is typically composed of two parts:</span></span>

- <span data-ttu-id="9e2b6-165">Streszczenie lub interfejs.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-165">The abstraction or interface.</span></span>

- <span data-ttu-id="9e2b6-166">Co najmniej jedna implementacja.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-166">One or more implementations.</span></span>

<span data-ttu-id="9e2b6-167">Na rysunku 6-19 można zobaczyć, jak, z punktu widzenia aplikacji, magistrala zdarzeń nie ma więcej niż w oddzielnym kanale pub/sub.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-167">In Figure 6-19 you can see how, from an application point of view, the event bus is nothing more than a Pub/Sub channel.</span></span> <span data-ttu-id="9e2b6-168">Sposób implementacji komunikacji asynchronicznej może się różnić.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-168">The way you implement this asynchronous communication can vary.</span></span> <span data-ttu-id="9e2b6-169">Może być wiele implementacji, aby można było zamienić między nimi, w zależności od wymagań środowiska (na przykład środowiska produkcyjnego i środowisk deweloperskich).</span><span class="sxs-lookup"><span data-stu-id="9e2b6-169">It can have multiple implementations so that you can swap between them, depending on the environment requirements (for example, production versus development environments).</span></span>

<span data-ttu-id="9e2b6-170">Na rysunku 6-20 można zobaczyć abstrakcję magistrali zdarzeń z wieloma implementacjami na podstawie technologii obsługi komunikatów infrastruktury, takich jak RabbitMQ, Azure Service Bus lub innego brokera zdarzeń/komunikatów.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-170">In Figure 6-20 you can see an abstraction of an event bus with multiple implementations based on infrastructure messaging technologies like RabbitMQ, Azure Service Bus, or another event/message broker.</span></span>

![Diagram przedstawiający dodanie warstwy abstrakcji magistrali zdarzeń.](./media/integration-event-based-microservice-communications/multiple-implementations-event-bus.png)

<span data-ttu-id="9e2b6-172">**Rysunek 6-20.**</span><span class="sxs-lookup"><span data-stu-id="9e2b6-172">**Figure 6- 20.**</span></span> <span data-ttu-id="9e2b6-173">Wiele implementacji magistrali zdarzeń</span><span class="sxs-lookup"><span data-stu-id="9e2b6-173">Multiple implementations of an event bus</span></span>

<span data-ttu-id="9e2b6-174">Dobrym sposobem jest użycie magistrali zdarzeń zdefiniowanej za pomocą interfejsu, aby można ją było zaimplementować przy użyciu kilku technologii, takich jak RabbitMQ usługi Azure Service Bus lub innych.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-174">It's good to have the event bus defined through an interface so it can be implemented with several technologies, like RabbitMQ Azure Service bus or others.</span></span> <span data-ttu-id="9e2b6-175">Jednak jak wspomniano wcześniej, użycie własnych streszczeń (interfejsu magistrali zdarzeń) jest dobre tylko wtedy, gdy potrzebne są podstawowe funkcje magistrali zdarzeń obsługiwane przez abstrakcyjne.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-175">However, and as mentioned previously, using your own abstractions (the event bus interface) is good only if you need basic event bus features supported by your abstractions.</span></span> <span data-ttu-id="9e2b6-176">Jeśli potrzebujesz bogatszych funkcji usługi Service Bus, prawdopodobnie Użyj interfejsu API i abstrakcji udostępnianych przez preferowaną komercyjną usługę Service Bus zamiast własnych streszczeń.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-176">If you need richer service bus features, you should probably use the API and abstractions provided by your preferred commercial service bus instead of your own abstractions.</span></span>

### <a name="defining-an-event-bus-interface"></a><span data-ttu-id="9e2b6-177">Definiowanie interfejsu magistrali zdarzeń</span><span class="sxs-lookup"><span data-stu-id="9e2b6-177">Defining an event bus interface</span></span>

<span data-ttu-id="9e2b6-178">Zacznijmy od pewnego kodu implementacji dla interfejsu usługi Event Bus i możliwych implementacji dla celów eksploracji.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-178">Let's start with some implementation code for the event bus interface and possible implementations for exploration purposes.</span></span> <span data-ttu-id="9e2b6-179">Interfejs powinien być ogólny i prosty, tak jak w poniższym interfejsie.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-179">The interface should be generic and straightforward, as in the following interface.</span></span>

```csharp
public interface IEventBus
{
    void Publish(IntegrationEvent @event);

    void Subscribe<T, TH>()
        where T : IntegrationEvent
        where TH : IIntegrationEventHandler<T>;

    void SubscribeDynamic<TH>(string eventName)
        where TH : IDynamicIntegrationEventHandler;

    void UnsubscribeDynamic<TH>(string eventName)
        where TH : IDynamicIntegrationEventHandler;

    void Unsubscribe<T, TH>()
        where TH : IIntegrationEventHandler<T>
        where T : IntegrationEvent;
}
```

<span data-ttu-id="9e2b6-180">`Publish`Metoda jest prosta.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-180">The `Publish` method is straightforward.</span></span> <span data-ttu-id="9e2b6-181">Magistrala zdarzeń będzie emitować przesłane do niej zdarzenie integracji z dowolną mikrousługą, a nawet z aplikacją zewnętrzną, która subskrybuje to zdarzenie.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-181">The event bus will broadcast the integration event passed to it to any microservice, or even an external application, subscribed to that event.</span></span> <span data-ttu-id="9e2b6-182">Ta metoda jest używana przez mikrousługę, która publikuje zdarzenie.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-182">This method is used by the microservice that is publishing the event.</span></span>

<span data-ttu-id="9e2b6-183">`Subscribe`Metody (mogą być dostępne różne implementacje zależne od argumentów) są używane przez mikrousługi, które chcą odbierać zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-183">The `Subscribe` methods (you can have several implementations depending on the arguments) are used by the microservices that want to receive events.</span></span> <span data-ttu-id="9e2b6-184">Ta metoda ma dwa argumenty.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-184">This method has two arguments.</span></span> <span data-ttu-id="9e2b6-185">Pierwsze jest zdarzeniem integracji subskrybowanym przez usługę ( `IntegrationEvent` ).</span><span class="sxs-lookup"><span data-stu-id="9e2b6-185">The first is the integration event to subscribe to (`IntegrationEvent`).</span></span> <span data-ttu-id="9e2b6-186">Drugim argumentem jest program obsługi zdarzeń integracji (lub metoda wywołania zwrotnego) o nazwie `IIntegrationEventHandler<T>` , który ma być wykonywany, gdy mikrousługa odbiornika pobiera ten komunikat o zdarzeniu integracji.</span><span class="sxs-lookup"><span data-stu-id="9e2b6-186">The second argument is the integration event handler (or callback method), named `IIntegrationEventHandler<T>`, to be executed when the receiver microservice gets that integration event message.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="9e2b6-187">Zasoby dodatkowe</span><span class="sxs-lookup"><span data-stu-id="9e2b6-187">Additional resources</span></span>

<span data-ttu-id="9e2b6-188">Niektóre rozwiązania do obsługi komunikatów w środowisku produkcyjnym:</span><span class="sxs-lookup"><span data-stu-id="9e2b6-188">Some production-ready messaging solutions:</span></span>

- <span data-ttu-id="9e2b6-189">**Azure Service Bus** </span><span class="sxs-lookup"><span data-stu-id="9e2b6-189">**Azure Service Bus** </span></span>\
  <https://docs.microsoft.com/azure/service-bus-messaging/>
  
- <span data-ttu-id="9e2b6-190">**NServiceBus** </span><span class="sxs-lookup"><span data-stu-id="9e2b6-190">**NServiceBus** </span></span>\
  <https://particular.net/nservicebus>
  
- <span data-ttu-id="9e2b6-191">**MassTransit** </span><span class="sxs-lookup"><span data-stu-id="9e2b6-191">**MassTransit** </span></span>\
  <https://masstransit-project.com/>

> [!div class="step-by-step"]
> <span data-ttu-id="9e2b6-192">[Poprzedni](database-server-container.md) 
>  [Dalej](rabbitmq-event-bus-development-test-environment.md)</span><span class="sxs-lookup"><span data-stu-id="9e2b6-192">[Previous](database-server-container.md)
[Next](rabbitmq-event-bus-development-test-environment.md)</span></span>
