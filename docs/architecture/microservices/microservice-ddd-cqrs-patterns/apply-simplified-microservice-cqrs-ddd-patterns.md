---
title: Stosowanie uproszczonych wzorców CQRS i DDD w mikrousługach
description: Architektura mikrousług platformy .NET dla konteneryzowanych aplikacji .NET | Zrozumienie ogólnej relacji między wzorcami CQRS i DDD.
ms.date: 10/08/2018
ms.openlocfilehash: e4e36bafff39f5f30d6371ed7c113322a85c3362
ms.sourcegitcommit: f87ad41b8e62622da126aa928f7640108c4eff98
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/07/2020
ms.locfileid: "80805593"
---
# <a name="apply-simplified-cqrs-and-ddd-patterns-in-a-microservice"></a><span data-ttu-id="d4743-103">Stosowanie uproszczonych wzorców CQRS i DDD w mikrousługach</span><span class="sxs-lookup"><span data-stu-id="d4743-103">Apply simplified CQRS and DDD patterns in a microservice</span></span>

<span data-ttu-id="d4743-104">CQRS jest wzorcem architektury, który oddziela modele do odczytu i zapisu danych.</span><span class="sxs-lookup"><span data-stu-id="d4743-104">CQRS is an architectural pattern that separates the models for reading and writing data.</span></span> <span data-ttu-id="d4743-105">Powiązany termin [Command Query Separation (CQS)](https://martinfowler.com/bliki/CommandQuerySeparation.html) został pierwotnie zdefiniowany przez Bertranda Meyera w swojej książce *Object Oriented Software Construction*.</span><span class="sxs-lookup"><span data-stu-id="d4743-105">The related term [Command Query Separation (CQS)](https://martinfowler.com/bliki/CommandQuerySeparation.html) was originally defined by Bertrand Meyer in his book *Object Oriented Software Construction*.</span></span> <span data-ttu-id="d4743-106">Podstawową ideą jest to, że można podzielić operacje systemu na dwie kategorie ostro oddzielone:</span><span class="sxs-lookup"><span data-stu-id="d4743-106">The basic idea is that you can divide a system's operations into two sharply separated categories:</span></span>

- <span data-ttu-id="d4743-107">Kwerendy.</span><span class="sxs-lookup"><span data-stu-id="d4743-107">Queries.</span></span> <span data-ttu-id="d4743-108">Te zwracają wynik i nie zmieniają stanu systemu, i są wolne od skutków ubocznych.</span><span class="sxs-lookup"><span data-stu-id="d4743-108">These return a result and do not change the state of the system, and they are free of side effects.</span></span>

- <span data-ttu-id="d4743-109">Polecenia.</span><span class="sxs-lookup"><span data-stu-id="d4743-109">Commands.</span></span> <span data-ttu-id="d4743-110">Zmieniają one stan systemu.</span><span class="sxs-lookup"><span data-stu-id="d4743-110">These change the state of a system.</span></span>

<span data-ttu-id="d4743-111">CQS jest prosta koncepcja: chodzi o metody w tym samym obiekcie są kwerendy lub polecenia.</span><span class="sxs-lookup"><span data-stu-id="d4743-111">CQS is a simple concept: it is about methods within the same object being either queries or commands.</span></span> <span data-ttu-id="d4743-112">Każda metoda zwraca stan lub mutuje stan, ale nie oba.</span><span class="sxs-lookup"><span data-stu-id="d4743-112">Each method either returns state or mutates state, but not both.</span></span> <span data-ttu-id="d4743-113">Nawet pojedynczy obiekt wzorca repozytorium może być zgodny z CQS.</span><span class="sxs-lookup"><span data-stu-id="d4743-113">Even a single repository pattern object can comply with CQS.</span></span> <span data-ttu-id="d4743-114">CQS można uznać za podstawową zasadę dla CQRS.</span><span class="sxs-lookup"><span data-stu-id="d4743-114">CQS can be considered a foundational principle for CQRS.</span></span>

<span data-ttu-id="d4743-115">[Command and Query Responsibility Segregation (CQRS)](https://martinfowler.com/bliki/CQRS.html) został wprowadzony przez Grega Younga i silnie promowany przez Udi Dahan i innych.</span><span class="sxs-lookup"><span data-stu-id="d4743-115">[Command and Query Responsibility Segregation (CQRS)](https://martinfowler.com/bliki/CQRS.html) was introduced by Greg Young and strongly promoted by Udi Dahan and others.</span></span> <span data-ttu-id="d4743-116">Opiera się na zasadzie CQS, chociaż jest bardziej szczegółowa.</span><span class="sxs-lookup"><span data-stu-id="d4743-116">It is based on the CQS principle, although it is more detailed.</span></span> <span data-ttu-id="d4743-117">Można uznać wzorzec na podstawie poleceń i zdarzeń oraz opcjonalnie na komunikaty asynchroniczne.</span><span class="sxs-lookup"><span data-stu-id="d4743-117">It can be considered a pattern based on commands and events plus optionally on asynchronous messages.</span></span> <span data-ttu-id="d4743-118">W wielu przypadkach CQRS jest związane z bardziej zaawansowanych scenariuszy, takich jak o innej fizycznej bazy danych dla odczytów (kwerend) niż dla zapisów (aktualizacje).</span><span class="sxs-lookup"><span data-stu-id="d4743-118">In many cases, CQRS is related to more advanced scenarios, like having a different physical database for reads (queries) than for writes (updates).</span></span> <span data-ttu-id="d4743-119">Ponadto bardziej rozwinięty system CQRS może implementować [usługi event-sourcing (ES)](https://martinfowler.com/eaaDev/EventSourcing.html) dla bazy danych aktualizacji, więc zdarzenia będą przechowywane tylko w modelu domeny zamiast przechowywania bieżących danych o stanie.</span><span class="sxs-lookup"><span data-stu-id="d4743-119">Moreover, a more evolved CQRS system might implement [Event-Sourcing (ES)](https://martinfowler.com/eaaDev/EventSourcing.html) for your updates database, so you would only store events in the domain model instead of storing the current-state data.</span></span> <span data-ttu-id="d4743-120">Jednak to podejście nie jest używane w tym przewodniku.</span><span class="sxs-lookup"><span data-stu-id="d4743-120">However, this approach is not used in this guide.</span></span> <span data-ttu-id="d4743-121">W tym przewodniku użyto najprostszego podejścia CQRS, które polega tylko na oddzieleniu zapytań od poleceń.</span><span class="sxs-lookup"><span data-stu-id="d4743-121">This guide uses the simplest CQRS approach, which consists of just separating the queries from the commands.</span></span>

<span data-ttu-id="d4743-122">Aspekt separacji CQRS jest osiągany przez grupowanie operacji kwerendy w jednej warstwie i poleceń w innej warstwie.</span><span class="sxs-lookup"><span data-stu-id="d4743-122">The separation aspect of CQRS is achieved by grouping query operations in one layer and commands in another layer.</span></span> <span data-ttu-id="d4743-123">Każda warstwa ma swój własny model danych (należy pamiętać, że mówimy modelu, niekoniecznie innej bazy danych) i jest zbudowany przy użyciu własnej kombinacji wzorców i technologii.</span><span class="sxs-lookup"><span data-stu-id="d4743-123">Each layer has its own data model (note that we say model, not necessarily a different database) and is built using its own combination of patterns and technologies.</span></span> <span data-ttu-id="d4743-124">Co ważniejsze, dwie warstwy mogą znajdować się w tej samej warstwie lub mikrousługach, jak w przykładzie (zamawianie mikrousług) używane dla tego przewodnika.</span><span class="sxs-lookup"><span data-stu-id="d4743-124">More importantly, the two layers can be within the same tier or microservice, as in the example (ordering microservice) used for this guide.</span></span> <span data-ttu-id="d4743-125">Lub mogą być implementowane na różnych mikrousług lub procesów, dzięki czemu mogą być optymalizowane i skalowane w poziomie oddzielnie bez wpływu na siebie nawzajem.</span><span class="sxs-lookup"><span data-stu-id="d4743-125">Or they could be implemented on different microservices or processes so they can be optimized and scaled out separately without affecting one another.</span></span>

<span data-ttu-id="d4743-126">CQRS oznacza posiadanie dwóch obiektów dla operacji odczytu/zapisu, gdzie w innych kontekstach istnieje jeden.</span><span class="sxs-lookup"><span data-stu-id="d4743-126">CQRS means having two objects for a read/write operation where in other contexts there is one.</span></span> <span data-ttu-id="d4743-127">Istnieją powody, aby mieć zdenormalizowane odczyty bazy danych, które można dowiedzieć się o bardziej zaawansowanej literatury CQRS.</span><span class="sxs-lookup"><span data-stu-id="d4743-127">There are reasons to have a denormalized reads database, which you can learn about in more advanced CQRS literature.</span></span> <span data-ttu-id="d4743-128">Ale nie używamy tego podejścia w tym miejscu, gdzie celem jest mieć większą elastyczność w kwerendach zamiast ograniczania zapytań z ograniczeniami z wzorców DDD, takich jak agregacje.</span><span class="sxs-lookup"><span data-stu-id="d4743-128">But we are not using that approach here, where the goal is to have more flexibility in the queries instead of limiting the queries with constraints from DDD patterns like aggregates.</span></span>

<span data-ttu-id="d4743-129">Przykładem tego rodzaju usługi jest zamawiania mikrousługi z aplikacji referencyjnej eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="d4743-129">An example of this kind of service is the ordering microservice from the eShopOnContainers reference application.</span></span> <span data-ttu-id="d4743-130">Ta usługa implementuje mikrousługi na podstawie uproszczonego podejścia CQRS.</span><span class="sxs-lookup"><span data-stu-id="d4743-130">This service implements a microservice based on a simplified CQRS approach.</span></span> <span data-ttu-id="d4743-131">Używa jednego źródła danych lub bazy danych, ale dwa modele logiczne plus wzorce DDD dla domeny transakcyjnej, jak pokazano na rysunku 7-2.</span><span class="sxs-lookup"><span data-stu-id="d4743-131">It uses a single data source or database, but two logical models plus DDD patterns for the transactional domain, as shown in Figure 7-2.</span></span>

![Diagram przedstawiający mikrousługi uproszczone CQRS i DDD na wysokim poziomie.](./media/apply-simplified-microservice-cqrs-ddd-patterns/simplified-cqrs-ddd-microservice.png)

<span data-ttu-id="d4743-133">**Rysunek 7-2**.</span><span class="sxs-lookup"><span data-stu-id="d4743-133">**Figure 7-2**.</span></span> <span data-ttu-id="d4743-134">Uproszczona mikrousługa oparta na CQRS i DDD</span><span class="sxs-lookup"><span data-stu-id="d4743-134">Simplified CQRS- and DDD-based microservice</span></span>

<span data-ttu-id="d4743-135">Logiczne "Zamawianie" Mikrousługa zawiera jego zamawiania bazy danych, które mogą być, ale nie musi być, tego samego hosta platformy Docker.</span><span class="sxs-lookup"><span data-stu-id="d4743-135">The Logical "Ordering" Microservice includes its Ordering database, which can be, but doesn't have to be, the same Docker host.</span></span> <span data-ttu-id="d4743-136">Posiadanie bazy danych w tym samym hoście platformy Docker jest dobre dla rozwoju, ale nie dla produkcji.</span><span class="sxs-lookup"><span data-stu-id="d4743-136">Having the database in the same Docker host is good for development, but not for production.</span></span>

<span data-ttu-id="d4743-137">Warstwą aplikacji może być sam internetowy interfejs API.</span><span class="sxs-lookup"><span data-stu-id="d4743-137">The application layer can be the Web API itself.</span></span> <span data-ttu-id="d4743-138">Ważnym aspektem projektu w tym miejscu jest, że mikrousługa ma podzielić zapytania i ViewModels (modele danych specjalnie utworzone dla aplikacji klienckich) z poleceń, modelu domeny i transakcji po wzorzec CQRS.</span><span class="sxs-lookup"><span data-stu-id="d4743-138">The important design aspect here is that the microservice has split the queries and ViewModels (data models especially created for the client applications) from the commands, domain model, and transactions following the CQRS pattern.</span></span> <span data-ttu-id="d4743-139">Takie podejście utrzymuje zapytania niezależne od ograniczeń i ograniczeń pochodzących z wzorców DDD, które mają sens tylko dla transakcji i aktualizacji, jak wyjaśniono w późniejszych sekcjach.</span><span class="sxs-lookup"><span data-stu-id="d4743-139">This approach keeps the queries independent from restrictions and constraints coming from DDD patterns that only make sense for transactions and updates, as explained in later sections.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="d4743-140">Zasoby dodatkowe</span><span class="sxs-lookup"><span data-stu-id="d4743-140">Additional resources</span></span>

- <span data-ttu-id="d4743-141">**Greg Young. Przechowywanie wersji w systemie event sourced** (free to read online e-book) </span><span class="sxs-lookup"><span data-stu-id="d4743-141">**Greg Young. Versioning in an Event Sourced System** (Free to read online e-book) </span></span>\
   <https://leanpub.com/esversioning/read>

>[!div class="step-by-step"]
><span data-ttu-id="d4743-142">[Poprzedni](index.md)
>[następny](eshoponcontainers-cqrs-ddd-microservice.md)</span><span class="sxs-lookup"><span data-stu-id="d4743-142">[Previous](index.md)
[Next](eshoponcontainers-cqrs-ddd-microservice.md)</span></span>
