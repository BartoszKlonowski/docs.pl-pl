---
title: Suwerenność danych przypadająca na mikrousługę
description: Suwerenność danych na mikrousługi jest jednym z kluczowych punktów mikrousług. Każda mikrousługa musi być jedynym właścicielem swojej bazy danych, udostępniając ją bez żadnych innych. Oczywiście wszystkie wystąpienia mikrousługi połączyć się z tej samej bazy danych o wysokiej dostępności.
ms.date: 09/20/2018
ms.openlocfilehash: f606d6314f38bf3e2c163871af432806dddc7446
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/14/2020
ms.locfileid: "73191908"
---
# <a name="data-sovereignty-per-microservice"></a><span data-ttu-id="d4585-105">Suwerenność danych przypadająca na mikrousługę</span><span class="sxs-lookup"><span data-stu-id="d4585-105">Data sovereignty per microservice</span></span>

<span data-ttu-id="d4585-106">Ważną regułą dla architektury mikrousług jest, że każda mikrousługa musi być właścicielem danych domeny i logiki.</span><span class="sxs-lookup"><span data-stu-id="d4585-106">An important rule for microservices architecture is that each microservice must own its domain data and logic.</span></span> <span data-ttu-id="d4585-107">Podobnie jak pełna aplikacja jest właścicielem logiki i danych, więc każda mikrousługa własnych logiki i danych w autonomicznym cyklu życia, z niezależnego wdrożenia na mikrousługi.</span><span class="sxs-lookup"><span data-stu-id="d4585-107">Just as a full application owns its logic and data, so must each microservice own its logic and data under an autonomous lifecycle, with independent deployment per microservice.</span></span>

<span data-ttu-id="d4585-108">Oznacza to, że model koncepcyjny domeny będzie się różnić między podsystemami lub mikrousług.</span><span class="sxs-lookup"><span data-stu-id="d4585-108">This means that the conceptual model of the domain will differ between subsystems or microservices.</span></span> <span data-ttu-id="d4585-109">Należy wziąć pod uwagę aplikacje dla przedsiębiorstw, w których aplikacje do zarządzania relacjami z klientami (CRM), podsystemy zakupów transakcyjnych i podsystemy obsługi klienta każde wywołanie unikatowych atrybutów i danych encji klienta oraz gdzie każdy z nich wykorzystuje inne Ograniczony kontekst (BC).</span><span class="sxs-lookup"><span data-stu-id="d4585-109">Consider enterprise applications, where customer relationship management (CRM) applications, transactional purchase subsystems, and customer support subsystems each call on unique customer entity attributes and data, and where each employs a different Bounded Context (BC).</span></span>

<span data-ttu-id="d4585-110">Zasada ta jest podobna w [projekcie opartym na domenie (DDD),](https://en.wikipedia.org/wiki/Domain-driven_design)gdzie każdy [ograniczony kontekst](https://martinfowler.com/bliki/BoundedContext.html) lub autonomiczny podsystem lub usługa musi posiadać swój model domeny (dane oraz logikę i zachowanie).</span><span class="sxs-lookup"><span data-stu-id="d4585-110">This principle is similar in [Domain-driven design (DDD)](https://en.wikipedia.org/wiki/Domain-driven_design), where each [Bounded Context](https://martinfowler.com/bliki/BoundedContext.html) or autonomous subsystem or service must own its domain model (data plus logic and behavior).</span></span> <span data-ttu-id="d4585-111">Każdy kontekst ograniczony DDD koreluje z jedną mikrousługą biznesową (jedną lub kilkoma usługami).</span><span class="sxs-lookup"><span data-stu-id="d4585-111">Each DDD Bounded Context correlates to one business microservice (one or several services).</span></span> <span data-ttu-id="d4585-112">Ten punkt o wzorzec kontekstu ograniczone go jest rozwijany w następnej sekcji.</span><span class="sxs-lookup"><span data-stu-id="d4585-112">This point about the Bounded Context pattern is expanded in the next section.</span></span>

<span data-ttu-id="d4585-113">Z drugiej strony tradycyjne (monolityczne dane) podejście stosowane w wielu aplikacjach jest mieć jedną scentralizowaną bazę danych lub tylko kilka baz danych.</span><span class="sxs-lookup"><span data-stu-id="d4585-113">On the other hand, the traditional (monolithic data) approach used in many applications is to have a single centralized database or just a few databases.</span></span> <span data-ttu-id="d4585-114">Jest to często znormalizowana baza danych SQL, która jest używana dla całej aplikacji i wszystkich jej wewnętrznych podsystemów, jak pokazano na rysunku 4-7.</span><span class="sxs-lookup"><span data-stu-id="d4585-114">This is often a normalized SQL database that's used for the whole application and all its internal subsystems, as shown in Figure 4-7.</span></span>

![Diagram przedstawiający dwa podejścia do bazy danych.](./media/data-sovereignty-per-microservice/data-sovereignty-comparison.png)

<span data-ttu-id="d4585-116">**Rysunek 4-7**.</span><span class="sxs-lookup"><span data-stu-id="d4585-116">**Figure 4-7**.</span></span> <span data-ttu-id="d4585-117">Porównanie suwerenności danych: monolityczna baza danych a mikrousługi</span><span class="sxs-lookup"><span data-stu-id="d4585-117">Data sovereignty comparison: monolithic database versus microservices</span></span>

<span data-ttu-id="d4585-118">W tradycyjnym podejściu istnieje jedna baza danych współużytkowana przez wszystkie usługi, zazwyczaj w architekturze warstwowej.</span><span class="sxs-lookup"><span data-stu-id="d4585-118">In the traditional approach, there's a single database shared across all services, typically in a tiered architecture.</span></span> <span data-ttu-id="d4585-119">W podejściu mikrousług każda mikrousługa jest właścicielem swojego modelu/danych.</span><span class="sxs-lookup"><span data-stu-id="d4585-119">In the microservices approach, each microservice owns its model/data.</span></span> <span data-ttu-id="d4585-120">Podejście scentralizowanej bazy danych początkowo wygląda prościej i wydaje się umożliwiać ponowne użycie jednostek w różnych podsystemach, aby wszystko było spójne.</span><span class="sxs-lookup"><span data-stu-id="d4585-120">The centralized database approach initially looks simpler and seems to enable reuse of entities in different subsystems to make everything consistent.</span></span> <span data-ttu-id="d4585-121">Ale rzeczywistość jest w końcu z ogromnymi tabelami, które obsługują wiele różnych podsystemów i które zawierają atrybuty i kolumny, które nie są potrzebne w większości przypadków.</span><span class="sxs-lookup"><span data-stu-id="d4585-121">But the reality is you end up with huge tables that serve many different subsystems, and that include attributes and columns that aren't needed in most cases.</span></span> <span data-ttu-id="d4585-122">To jak próba użycia tej samej fizycznej mapy do wędrowania krótkim szlakiem, jednodniowej podróży samochodem i nauki geografii.</span><span class="sxs-lookup"><span data-stu-id="d4585-122">It's like trying to use the same physical map for hiking a short trail, taking a day-long car trip, and learning geography.</span></span>

<span data-ttu-id="d4585-123">Monolityczne aplikacji z zazwyczaj jednej relacyjnej bazy danych ma dwie ważne korzyści: [transakcje ACID](https://en.wikipedia.org/wiki/ACID) i języka SQL, zarówno pracy we wszystkich tabelach i danych związanych z aplikacją.</span><span class="sxs-lookup"><span data-stu-id="d4585-123">A monolithic application with typically a single relational database has two important benefits: [ACID transactions](https://en.wikipedia.org/wiki/ACID) and the SQL language, both working across all the tables and data related to your application.</span></span> <span data-ttu-id="d4585-124">Takie podejście umożliwia łatwe pisanie kwerendy, która łączy dane z wielu tabel.</span><span class="sxs-lookup"><span data-stu-id="d4585-124">This approach provides a way to easily write a query that combines data from multiple tables.</span></span>

<span data-ttu-id="d4585-125">Jednak dostęp do danych staje się znacznie bardziej skomplikowane po przejściu do architektury mikrousług.</span><span class="sxs-lookup"><span data-stu-id="d4585-125">However, data access becomes much more complicated when you move to a microservices architecture.</span></span> <span data-ttu-id="d4585-126">Nawet w przypadku korzystania z transakcji ACID w ramach mikrousługi lub ograniczonego kontekstu, ważne jest, aby wziąć pod uwagę, że dane należące do każdej mikrousługi jest prywatny do tej mikrousługi i powinny być dostępne tylko synchronicznie za pośrednictwem swoich punktów końcowych interfejsu API(REST, gRPC, SOAP, itp.) lub asynchronicznie za pośrednictwem wiadomości (AMQP lub podobne).</span><span class="sxs-lookup"><span data-stu-id="d4585-126">Even when using ACID transactions within a microservice or Bounded Context, it is crucial to consider that the data owned by each microservice is private to that microservice and should only be accessed either synchronously through its API endpoints(REST, gRPC, SOAP, etc) or asynchronously via messaging(AMQP or similar).</span></span>

<span data-ttu-id="d4585-127">Hermetyzowanie danych zapewnia, że mikrousługi są luźno sprzężeni i mogą ewoluować niezależnie od siebie.</span><span class="sxs-lookup"><span data-stu-id="d4585-127">Encapsulating the data ensures that the microservices are loosely coupled and can evolve independently of one another.</span></span> <span data-ttu-id="d4585-128">Jeśli wiele usług uzyskiwało dostęp do tych samych danych, aktualizacje schematu wymagałyby skoordynowanych aktualizacji wszystkich usług.</span><span class="sxs-lookup"><span data-stu-id="d4585-128">If multiple services were accessing the same data, schema updates would require coordinated updates to all the services.</span></span> <span data-ttu-id="d4585-129">Spowoduje to przerwanie autonomii cyklu życia mikrousług.</span><span class="sxs-lookup"><span data-stu-id="d4585-129">This would break the microservice lifecycle autonomy.</span></span> <span data-ttu-id="d4585-130">Ale struktury danych rozproszonych oznacza, że nie można dokonać pojedynczej transakcji ACID w mikrousługach.</span><span class="sxs-lookup"><span data-stu-id="d4585-130">But distributed data structures mean that you can't make a single ACID transaction across microservices.</span></span> <span data-ttu-id="d4585-131">To z kolei oznacza, że należy użyć spójności ostatecznej, gdy proces biznesowy obejmuje wiele mikrousług.</span><span class="sxs-lookup"><span data-stu-id="d4585-131">This in turn means you must use eventual consistency when a business process spans multiple microservices.</span></span> <span data-ttu-id="d4585-132">Jest to znacznie trudniejsze do zaimplementowania niż proste sprzężenia SQL, ponieważ nie można utworzyć ograniczenia integralności lub użyć rozproszonych transakcji między oddzielnymi bazami danych, jak wyjaśnimy później.</span><span class="sxs-lookup"><span data-stu-id="d4585-132">This is much harder to implement than simple SQL joins, because you can't create integrity constraints or use distributed transactions between separate databases, as we'll explain later on.</span></span> <span data-ttu-id="d4585-133">Podobnie wiele innych funkcji relacyjnej bazy danych nie są dostępne w wielu mikrousług.</span><span class="sxs-lookup"><span data-stu-id="d4585-133">Similarly, many other relational database features aren't available across multiple microservices.</span></span>

<span data-ttu-id="d4585-134">Idąc jeszcze dalej, różne mikrousługi często używają różnych *rodzajów* baz danych.</span><span class="sxs-lookup"><span data-stu-id="d4585-134">Going even further, different microservices often use different *kinds* of databases.</span></span> <span data-ttu-id="d4585-135">Nowoczesne aplikacje przechowują i przetwarzają różne rodzaje danych, a relacyjna baza danych nie zawsze jest najlepszym wyborem.</span><span class="sxs-lookup"><span data-stu-id="d4585-135">Modern applications store and process diverse kinds of data, and a relational database isn't always the best choice.</span></span> <span data-ttu-id="d4585-136">W niektórych przypadkach użycia baza danych NoSQL, taka jak Usługa Azure CosmosDB lub MongoDB, może mieć wygodniejszy model danych i oferować lepszą wydajność i skalowalność niż baza danych SQL, taka jak SQL Server lub Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="d4585-136">For some use cases, a NoSQL database such as Azure CosmosDB or MongoDB might have a more convenient data model and offer better performance and scalability than a SQL database like SQL Server or Azure SQL Database.</span></span> <span data-ttu-id="d4585-137">W innych przypadkach relacyjnej bazy danych jest nadal najlepszym rozwiązaniem.</span><span class="sxs-lookup"><span data-stu-id="d4585-137">In other cases, a relational database is still the best approach.</span></span> <span data-ttu-id="d4585-138">W związku z tym aplikacje oparte na mikrousługach często używają mieszaniny baz danych SQL i NoSQL, która jest czasami nazywana podejściem [trwałości polyglot.](https://martinfowler.com/bliki/PolyglotPersistence.html)</span><span class="sxs-lookup"><span data-stu-id="d4585-138">Therefore, microservices-based applications often use a mixture of SQL and NoSQL databases, which is sometimes called the [polyglot persistence](https://martinfowler.com/bliki/PolyglotPersistence.html) approach.</span></span>

<span data-ttu-id="d4585-139">Architektura partycjonowana, polyglot-trwałe dla magazynu danych ma wiele zalet.</span><span class="sxs-lookup"><span data-stu-id="d4585-139">A partitioned, polyglot-persistent architecture for data storage has many benefits.</span></span> <span data-ttu-id="d4585-140">Należą do nich luźno powiązane usługi i lepsza wydajność, skalowalność, koszty i możliwości zarządzania.</span><span class="sxs-lookup"><span data-stu-id="d4585-140">These include loosely coupled services and better performance, scalability, costs, and manageability.</span></span> <span data-ttu-id="d4585-141">Może jednak wprowadzić pewne wyzwania związane z zarządzaniem danymi rozproszonymi, jak wyjaśniono w "[Identyfikowanie granic modelu domeny](identify-microservice-domain-model-boundaries.md)" w dalszej części tego rozdziału.</span><span class="sxs-lookup"><span data-stu-id="d4585-141">However, it can introduce some distributed data management challenges, as explained in "[Identifying domain-model boundaries](identify-microservice-domain-model-boundaries.md)" later in this chapter.</span></span>

## <a name="the-relationship-between-microservices-and-the-bounded-context-pattern"></a><span data-ttu-id="d4585-142">Relacja między mikrousługami a wzorcem kontekstu ograniczonego</span><span class="sxs-lookup"><span data-stu-id="d4585-142">The relationship between microservices and the Bounded Context pattern</span></span>

<span data-ttu-id="d4585-143">Pojęcie mikrousługi pochodzi od [wzorca ograniczonego kontekstu (BC)](https://martinfowler.com/bliki/BoundedContext.html) w [projekcie opartym na domenie (DDD).](https://en.wikipedia.org/wiki/Domain-driven_design)</span><span class="sxs-lookup"><span data-stu-id="d4585-143">The concept of microservice derives from the [Bounded Context (BC) pattern](https://martinfowler.com/bliki/BoundedContext.html) in [domain-driven design (DDD)](https://en.wikipedia.org/wiki/Domain-driven_design).</span></span> <span data-ttu-id="d4585-144">DDD zajmuje się dużymi modelami, dzieląc je na wiele kontrolerów BC i wyraźnie o swoich granicach.</span><span class="sxs-lookup"><span data-stu-id="d4585-144">DDD deals with large models by dividing them into multiple BCs and being explicit about their boundaries.</span></span> <span data-ttu-id="d4585-145">Każdy bc musi mieć swój własny model i bazy danych; podobnie każda mikrousługa jest właścicielem powiązanych danych.</span><span class="sxs-lookup"><span data-stu-id="d4585-145">Each BC must have its own model and database; likewise, each microservice owns its related data.</span></span> <span data-ttu-id="d4585-146">Ponadto, każdy BC zwykle ma swój własny [wszechobecny język,](https://martinfowler.com/bliki/UbiquitousLanguage.html) aby pomóc w komunikacji między programistami i ekspertami domeny.</span><span class="sxs-lookup"><span data-stu-id="d4585-146">In addition, each BC usually has its own [ubiquitous language](https://martinfowler.com/bliki/UbiquitousLanguage.html) to help communication between software developers and domain experts.</span></span>

<span data-ttu-id="d4585-147">Te terminy (głównie jednostki domeny) w wszechobecnym języku mogą mieć różne nazwy w różnych kontekstach ograniczonych, nawet jeśli różne jednostki domeny mają tę samą tożsamość (czyli unikatowy identyfikator używany do odczytywania jednostki z magazynu).</span><span class="sxs-lookup"><span data-stu-id="d4585-147">Those terms (mainly domain entities) in the ubiquitous language can have different names in different Bounded Contexts, even when different domain entities share the same identity (that is, the unique ID that's used to read the entity from storage).</span></span> <span data-ttu-id="d4585-148">Na przykład w kontekście ograniczonym profilu użytkownika jednostka domeny użytkownika może udostępniać tożsamość jednostce domeny kupującego w kontekście ograniczonym.</span><span class="sxs-lookup"><span data-stu-id="d4585-148">For instance, in a user-profile Bounded Context, the User domain entity might share identity with the Buyer domain entity in the ordering Bounded Context.</span></span>

<span data-ttu-id="d4585-149">Mikrousługi jest zatem jak ograniczony kontekst, ale określa również, że jest to usługa rozproszona.</span><span class="sxs-lookup"><span data-stu-id="d4585-149">A microservice is therefore like a Bounded Context, but it also specifies that it's a distributed service.</span></span> <span data-ttu-id="d4585-150">Jest on zbudowany jako oddzielny proces dla każdego ograniczonego kontekstu i musi używać protokołów rozproszonych zauważyć wcześniej, takich jak HTTP/HTTPS, WebSockets lub [AMQP](https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol).</span><span class="sxs-lookup"><span data-stu-id="d4585-150">It's built as a separate process for each Bounded Context, and it must use the distributed protocols noted earlier, like HTTP/HTTPS, WebSockets, or [AMQP](https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol).</span></span> <span data-ttu-id="d4585-151">Wzorzec kontekstu ograniczonego nie określa jednak, czy ograniczony kontekst jest usługą rozproszoną, czy też jest to po prostu logiczna granica (na przykład ogólny podsystem) w aplikacji wdrażania monolitycznego.</span><span class="sxs-lookup"><span data-stu-id="d4585-151">The Bounded Context pattern, however, doesn't specify whether the Bounded Context is a distributed service or if it's simply a logical boundary (such as a generic subsystem) within a monolithic-deployment application.</span></span>

<span data-ttu-id="d4585-152">Ważne jest, aby podkreślić, że definiowanie usługi dla każdego ograniczonego kontekstu jest dobrym miejscem do rozpoczęcia.</span><span class="sxs-lookup"><span data-stu-id="d4585-152">It's important to highlight that defining a service for each Bounded Context is a good place to start.</span></span> <span data-ttu-id="d4585-153">Ale nie musisz ograniczać do niego swojego projektu.</span><span class="sxs-lookup"><span data-stu-id="d4585-153">But you don't have to constrain your design to it.</span></span> <span data-ttu-id="d4585-154">Czasami należy zaprojektować ograniczony kontekst lub mikrousługi biznesowej składa się z kilku usług fizycznych.</span><span class="sxs-lookup"><span data-stu-id="d4585-154">Sometimes you must design a Bounded Context or business microservice composed of several physical services.</span></span> <span data-ttu-id="d4585-155">Ale ostatecznie oba wzorce -Bounded Context i mikrousługi— są ściśle powiązane.</span><span class="sxs-lookup"><span data-stu-id="d4585-155">But ultimately, both patterns -Bounded Context and microservice- are closely related.</span></span>

<span data-ttu-id="d4585-156">DDD korzyści z mikrousług, uzyskując prawdziwe granice w postaci mikrousług rozproszonych.</span><span class="sxs-lookup"><span data-stu-id="d4585-156">DDD benefits from microservices by getting real boundaries in the form of distributed microservices.</span></span> <span data-ttu-id="d4585-157">Ale pomysły, takie jak nie udostępnianie modelu między mikrousług są to, co chcesz również w kontekście ograniczone.</span><span class="sxs-lookup"><span data-stu-id="d4585-157">But ideas like not sharing the model between microservices are what you also want in a Bounded Context.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="d4585-158">Zasoby dodatkowe</span><span class="sxs-lookup"><span data-stu-id="d4585-158">Additional resources</span></span>

- <span data-ttu-id="d4585-159">**Chris Richardson. Wzorzec: Baza danych na usługę** </span><span class="sxs-lookup"><span data-stu-id="d4585-159">**Chris Richardson. Pattern: Database per service** </span></span>\
  <https://microservices.io/patterns/data/database-per-service.html>

- <span data-ttu-id="d4585-160">**Martin Fowler. Ograniczony kontekst** </span><span class="sxs-lookup"><span data-stu-id="d4585-160">**Martin Fowler. BoundedContext** </span></span>\
  <https://martinfowler.com/bliki/BoundedContext.html>

- <span data-ttu-id="d4585-161">**Martin Fowler. PolyglotWytrwałość** </span><span class="sxs-lookup"><span data-stu-id="d4585-161">**Martin Fowler. PolyglotPersistence** </span></span>\
  <https://martinfowler.com/bliki/PolyglotPersistence.html>

- <span data-ttu-id="d4585-162">**Alberto Brandolini. Strategiczny projekt oparty na domenie z mapowaniem kontekstu** </span><span class="sxs-lookup"><span data-stu-id="d4585-162">**Alberto Brandolini. Strategic Domain Driven Design with Context Mapping** </span></span>\
  <https://www.infoq.com/articles/ddd-contextmapping>

>[!div class="step-by-step"]
><span data-ttu-id="d4585-163">[Poprzedni](microservices-architecture.md)
>[następny](logical-versus-physical-architecture.md)</span><span class="sxs-lookup"><span data-stu-id="d4585-163">[Previous](microservices-architecture.md)
[Next](logical-versus-physical-architecture.md)</span></span>
