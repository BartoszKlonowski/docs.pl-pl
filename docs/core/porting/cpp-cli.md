---
title: Migrowanie projektów C++/CLI do programu .NET Core
description: Dowiedz się więcej o przenoszeniu projektów C++/CLI do programu .NET Core.
author: mjrousos
ms.date: 01/10/2020
ms.openlocfilehash: eb03f2a5ff42e8279fd3ebd6ee6fb6d955f6798d
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/14/2020
ms.locfileid: "75964931"
---
# <a name="how-to-port-a-ccli-project-to-net-core"></a><span data-ttu-id="9baa1-103">Jak przenieść projekt C++/CLI do programu .NET Core</span><span class="sxs-lookup"><span data-stu-id="9baa1-103">How to port a C++/CLI project to .NET Core</span></span>

<span data-ttu-id="9baa1-104">Począwszy od .NET Core 3.1 i Visual Studio 2019 w wersji 16.4, [projekty C++/CLI](/cpp/dotnet/dotnet-programming-with-cpp-cli-visual-cpp) mogą być przeznaczone dla programu .NET Core.</span><span class="sxs-lookup"><span data-stu-id="9baa1-104">Beginning with .NET Core 3.1 and Visual Studio 2019 version 16.4, [C++/CLI projects](/cpp/dotnet/dotnet-programming-with-cpp-cli-visual-cpp) can target .NET Core.</span></span> <span data-ttu-id="9baa1-105">Ta obsługa umożliwia przenoszenie aplikacji klasycznych systemu Windows z warstwami współprocesorowymi c++/CLI do .NET Core.</span><span class="sxs-lookup"><span data-stu-id="9baa1-105">This support makes it possible to port Windows desktop applications with C++/CLI interop layers to .NET Core.</span></span> <span data-ttu-id="9baa1-106">W tym artykule opisano sposób przenoszenia projektów c++/CLI z platformy .NET Framework do .NET Core 3.1.</span><span class="sxs-lookup"><span data-stu-id="9baa1-106">This article describes how to port C++/CLI projects from .NET Framework to .NET Core 3.1.</span></span>

## <a name="ccli-net-core-limitations"></a><span data-ttu-id="9baa1-107">Ograniczenia rdzenia C++/CLI .NET</span><span class="sxs-lookup"><span data-stu-id="9baa1-107">C++/CLI .NET Core limitations</span></span>

<span data-ttu-id="9baa1-108">Istnieją pewne ważne ograniczenia dotyczące przenoszenia projektów C++/CLI do .NET Core w porównaniu z innymi językami:</span><span class="sxs-lookup"><span data-stu-id="9baa1-108">There are some important limitations to porting C++/CLI projects to .NET Core compared to other languages:</span></span>

* <span data-ttu-id="9baa1-109">Obsługa c++/CLI dla programu .NET Core to tylko system Windows.</span><span class="sxs-lookup"><span data-stu-id="9baa1-109">C++/CLI support for .NET Core is Windows only.</span></span>
* <span data-ttu-id="9baa1-110">Projekty C++/CLI nie mogą być kierowane na program .NET Standard, tylko program .NET Core (lub .NET Framework).</span><span class="sxs-lookup"><span data-stu-id="9baa1-110">C++/CLI projects can't target .NET Standard, only .NET Core (or .NET Framework).</span></span>
* <span data-ttu-id="9baa1-111">Projekty c++/CLI nie obsługują nowego formatu pliku projektu w stylu SDK.</span><span class="sxs-lookup"><span data-stu-id="9baa1-111">C++/CLI projects don't support the new SDK-style project file format.</span></span> <span data-ttu-id="9baa1-112">Zamiast tego nawet podczas kierowania na .NET Core projekty C++/CLI używają istniejącego formatu pliku vcxproj.</span><span class="sxs-lookup"><span data-stu-id="9baa1-112">Instead, even when targeting .NET Core, C++/CLI projects use the existing vcxproj file format.</span></span>
* <span data-ttu-id="9baa1-113">Projekty c++/CLI nie mogą kierować wielu platform .NET.</span><span class="sxs-lookup"><span data-stu-id="9baa1-113">C++/CLI projects can't multitarget multiple .NET platforms.</span></span> <span data-ttu-id="9baa1-114">Jeśli musisz utworzyć projekt C++/CLI dla programu .NET Framework i .NET Core, użyj oddzielnych plików projektu.</span><span class="sxs-lookup"><span data-stu-id="9baa1-114">If you need to build a C++/CLI project for both .NET Framework and .NET Core, use separate project files.</span></span>
* <span data-ttu-id="9baa1-115">.NET Core nie `-clr:pure` obsługuje `-clr:safe` ani kompilacji, tylko nowa `-clr:netcore` `-clr` opcja (która jest równoważna dla .NET Framework).</span><span class="sxs-lookup"><span data-stu-id="9baa1-115">.NET Core doesn't support `-clr:pure` or `-clr:safe` compilation, only the new `-clr:netcore` option (which is equivalent to `-clr` for .NET Framework).</span></span>

## <a name="port-a-ccli-project"></a><span data-ttu-id="9baa1-116">Przenoszenie projektu C++/CLI</span><span class="sxs-lookup"><span data-stu-id="9baa1-116">Port a C++/CLI project</span></span>

<span data-ttu-id="9baa1-117">Aby przenieść projekt C++/CLI do programu .NET Core, należy wprowadzić następujące zmiany w pliku vcxproj.</span><span class="sxs-lookup"><span data-stu-id="9baa1-117">To port a C++/CLI project to .NET Core, make the following changes to the vcxproj file.</span></span> <span data-ttu-id="9baa1-118">Te kroki migracji różnią się od kroków wymaganych dla innych typów projektów, ponieważ projekty C++/CLI nie używają plików projektu w stylu SDK.</span><span class="sxs-lookup"><span data-stu-id="9baa1-118">These migration steps differ from the steps needed for other project types because C++/CLI projects don't use SDK-style project files.</span></span>

1. <span data-ttu-id="9baa1-119">Zamień `<CLRSupport>true</CLRSupport>` `<CLRSupport>NetCore</CLRSupport>`właściwości na .</span><span class="sxs-lookup"><span data-stu-id="9baa1-119">Replace `<CLRSupport>true</CLRSupport>` properties with `<CLRSupport>NetCore</CLRSupport>`.</span></span> <span data-ttu-id="9baa1-120">Ta właściwość jest często w grupach właściwości specyficznych dla konfiguracji, więc może być konieczne zastąpienie go w wielu miejscach.</span><span class="sxs-lookup"><span data-stu-id="9baa1-120">This property is often in configuration-specific property groups, so you may need to replace it in multiple places.</span></span>
2. <span data-ttu-id="9baa1-121">Zamień `<TargetFrameworkVersion>` `<TargetFramework>netcoreapp3.1</TargetFramework>`właściwości na .</span><span class="sxs-lookup"><span data-stu-id="9baa1-121">Replace `<TargetFrameworkVersion>` properties with `<TargetFramework>netcoreapp3.1</TargetFramework>`.</span></span>
3. <span data-ttu-id="9baa1-122">Usuń wszystkie odwołania programu `<Reference Include="System" />`.NET Framework (np. ).</span><span class="sxs-lookup"><span data-stu-id="9baa1-122">Remove any .NET Framework references (like `<Reference Include="System" />`).</span></span> <span data-ttu-id="9baa1-123">Podczas korzystania `<CLRSupport>NetCore</CLRSupport>`z zestawów SDK .NET Core core są automatycznie odwoływane.</span><span class="sxs-lookup"><span data-stu-id="9baa1-123">.NET Core SDK assemblies are automatically referenced when using `<CLRSupport>NetCore</CLRSupport>`.</span></span>
4. <span data-ttu-id="9baa1-124">Zaktualizuj użycie interfejsu API w plikach cpp, w razie potrzeby, aby usunąć interfejsy API niedostępne dla programu .NET Core.</span><span class="sxs-lookup"><span data-stu-id="9baa1-124">Update API usage in cpp files, as necessary, to remove APIs unavailable to .NET Core.</span></span> <span data-ttu-id="9baa1-125">Ponieważ projekty C++/CLI są zazwyczaj dość cienkimi warstwami współdziałania, często nie są potrzebne wiele zmian.</span><span class="sxs-lookup"><span data-stu-id="9baa1-125">Because C++/CLI projects tend to be fairly thin interop layers, there are often not many changes needed.</span></span> <span data-ttu-id="9baa1-126">[Analizator przenośności .NET](../../standard/analyzers/portability-analyzer.md) może służyć do identyfikowania nieobsługiwanych interfejsów API .NET używanych przez pliki binarne C++/CLI, podobnie jak w zapomocą czysto zarządzanych plików binarnych.</span><span class="sxs-lookup"><span data-stu-id="9baa1-126">The [.NET Portability Analyzer](../../standard/analyzers/portability-analyzer.md) can be used to identify unsupported .NET APIs used by C++/CLI binaries just as with purely managed binaries.</span></span> <span data-ttu-id="9baa1-127">Wskazówki dotyczące określania przenośności kodu i aktualizowania projektów do pracy z interfejsami API .NET Core są dostępne w [wytycznych dotyczących przenoszenia biblioteki.](./libraries.md#determine-portability)</span><span class="sxs-lookup"><span data-stu-id="9baa1-127">Guidelines for determining code portability and updating projects to work with .NET Core APIs are available in the [library porting guidance](./libraries.md#determine-portability).</span></span>

### <a name="wpf-and-windows-forms-usage"></a><span data-ttu-id="9baa1-128">Użycie w pfi i formularzach systemu Windows</span><span class="sxs-lookup"><span data-stu-id="9baa1-128">WPF and Windows Forms usage</span></span>

<span data-ttu-id="9baa1-129">Projekty .NET Core C++/CLI mogą używać formularzy systemu Windows i interfejsów API WPF.</span><span class="sxs-lookup"><span data-stu-id="9baa1-129">.NET Core C++/CLI projects can use Windows Forms and WPF APIs.</span></span> <span data-ttu-id="9baa1-130">Aby korzystać z tych interfejsów API pulpitu systemu Windows, należy dodać jawne odwołania framework do bibliotek interfejsu użytkownika.</span><span class="sxs-lookup"><span data-stu-id="9baa1-130">To use these Windows desktop APIs, you need to add explicit framework references to the UI libraries.</span></span> <span data-ttu-id="9baa1-131">Projekty w stylu SDK, które używają interfejsów API pulpitu systemu Windows, automatycznie odwołują się do niezbędnych bibliotek framework przy użyciu sdk. `Microsoft.NET.Sdk.WindowsDesktop`</span><span class="sxs-lookup"><span data-stu-id="9baa1-131">SDK-style projects that use Windows desktop APIs reference the necessary framework libraries automatically by using the `Microsoft.NET.Sdk.WindowsDesktop` SDK.</span></span> <span data-ttu-id="9baa1-132">Ponieważ projekty C++/CLI nie używają formatu projektu w stylu zestawu SDK, należy dodać jawne odwołania framework podczas kierowania .NET Core.</span><span class="sxs-lookup"><span data-stu-id="9baa1-132">Because C++/CLI projects don't use the SDK-style project format, they need to add explicit framework references when targeting .NET Core.</span></span>

<span data-ttu-id="9baa1-133">Aby korzystać z interfejsów API formularzy systemu Windows, dodaj to odwołanie do pliku vcxproj:</span><span class="sxs-lookup"><span data-stu-id="9baa1-133">To use Windows Forms APIs, add this reference to the vcxproj file:</span></span>

```xml
<!-- Reference all of Windows Forms -->
<FrameworkReference Include="Microsoft.WindowsDesktop.App.WindowsForms" />
```

<span data-ttu-id="9baa1-134">Aby użyć interfejsów API WPF, dodaj to odwołanie do pliku vcxproj:</span><span class="sxs-lookup"><span data-stu-id="9baa1-134">To use WPF APIs, add this reference to the vcxproj file:</span></span>

```xml
<!-- Reference all of WPF -->
<FrameworkReference Include="Microsoft.WindowsDesktop.App.WPF" />
```

<span data-ttu-id="9baa1-135">Aby używać zarówno formularzy systemu Windows, jak i interfejsów API WPF, dodaj to odwołanie do pliku vcxproj:</span><span class="sxs-lookup"><span data-stu-id="9baa1-135">To use both Windows Forms and WPF APIs, add this reference to the vcxproj file:</span></span>

```xml
<!-- Reference the entirety of the Windows desktop framework:
     Windows Forms, WPF, and the types that provide integration between them -->
<FrameworkReference Include="Microsoft.WindowsDesktop.App" />
```

<span data-ttu-id="9baa1-136">Obecnie nie jest możliwe dodanie tych odwołań za pomocą menedżera odwołań programu Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="9baa1-136">Currently, it's not possible to add these references using Visual Studio's reference manager.</span></span> <span data-ttu-id="9baa1-137">Zamiast tego zaktualizuj plik projektu ręcznie.</span><span class="sxs-lookup"><span data-stu-id="9baa1-137">Instead, update the project file manually.</span></span> <span data-ttu-id="9baa1-138">Tę aktualizację można wykonać w programie Visual Studio, zwalniając projekt, a następnie edytując plik projektu.</span><span class="sxs-lookup"><span data-stu-id="9baa1-138">This update can be done in Visual Studio by unloading the project and then editing the project file.</span></span> <span data-ttu-id="9baa1-139">Można również użyć innego edytora, takiego jak VS Code.</span><span class="sxs-lookup"><span data-stu-id="9baa1-139">You can also use another editor like VS Code.</span></span>

## <a name="build-without-msbuild"></a><span data-ttu-id="9baa1-140">Kompilacja bez MSBuild</span><span class="sxs-lookup"><span data-stu-id="9baa1-140">Build without MSBuild</span></span>

<span data-ttu-id="9baa1-141">Istnieje również możliwość tworzenia projektów C++/CLI bez użycia MSBuild.</span><span class="sxs-lookup"><span data-stu-id="9baa1-141">It's also possible to build C++/CLI projects without using MSBuild.</span></span> <span data-ttu-id="9baa1-142">Wykonaj następujące kroki, aby utworzyć projekt C++/CLI dla usługi .NET Core bezpośrednio z *programami cl.exe* i *link.exe:*</span><span class="sxs-lookup"><span data-stu-id="9baa1-142">Follow these steps to build a C++/CLI project for .NET Core directly with *cl.exe* and *link.exe*:</span></span>

1. <span data-ttu-id="9baa1-143">Podczas kompilowania `-clr:netcore` przekaż do *cl.exe*.</span><span class="sxs-lookup"><span data-stu-id="9baa1-143">When compiling, pass `-clr:netcore` to *cl.exe*.</span></span>
2. <span data-ttu-id="9baa1-144">Odwołanie niezbędne .NET Core zestawów odwołań.</span><span class="sxs-lookup"><span data-stu-id="9baa1-144">Reference necessary .NET Core reference assemblies.</span></span>
3. <span data-ttu-id="9baa1-145">Podczas łączenia należy podać katalog hosta `LibPath` aplikacji .NET Core jako katalog (aby można było znaleźć *ijwhost.lib).*</span><span class="sxs-lookup"><span data-stu-id="9baa1-145">When linking, provide the .NET Core app host directory as a `LibPath` (so that *ijwhost.lib* can be found).</span></span>
4. <span data-ttu-id="9baa1-146">*Skopiuj plik ijwhost.dll* (z katalogu hosta aplikacji .NET Core) do katalogu wyjściowego projektu.</span><span class="sxs-lookup"><span data-stu-id="9baa1-146">Copy *ijwhost.dll* (from the .NET Core app host directory) to the project's output directory.</span></span>
5. <span data-ttu-id="9baa1-147">Upewnij się, że plik [runtimeconfig.json](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md) istnieje dla pierwszego składnika aplikacji, który będzie uruchamiał kod zarządzany.</span><span class="sxs-lookup"><span data-stu-id="9baa1-147">Make sure a [runtimeconfig.json](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md) file exists for the first component of the application that will run managed code.</span></span> <span data-ttu-id="9baa1-148">Jeśli aplikacja ma zarządzany punkt `runtime.config` wejścia, plik zostanie utworzony i skopiowany automatycznie.</span><span class="sxs-lookup"><span data-stu-id="9baa1-148">If the application has a managed entry point, a `runtime.config` file will be created and copied automatically.</span></span> <span data-ttu-id="9baa1-149">Jeśli aplikacja ma natywny punkt wejścia, `runtimeconfig.json` należy jednak utworzyć plik dla pierwszej biblioteki C++/CLI, aby użyć punktu uruchomieniowego .NET Core.</span><span class="sxs-lookup"><span data-stu-id="9baa1-149">If the application has a native entry point, though, you need to create a `runtimeconfig.json` file for the first C++/CLI library to use the .NET Core runtime.</span></span>

## <a name="known-issues"></a><span data-ttu-id="9baa1-150">Znane problemy</span><span class="sxs-lookup"><span data-stu-id="9baa1-150">Known issues</span></span>

<span data-ttu-id="9baa1-151">Istnieje kilka znanych problemów, na które należy zwrócić uwagę podczas pracy z projektami C++/CLI przeznaczonymi dla programu .NET Core.</span><span class="sxs-lookup"><span data-stu-id="9baa1-151">There are a couple known issues to look out for when working with C++/CLI projects targeting .NET Core.</span></span>

* <span data-ttu-id="9baa1-152">Odwołanie do struktury WPF w projektach .NET Core C++/CLI powoduje obecnie niektóre obce ostrzeżenia dotyczące niemożnej importowania symboli.</span><span class="sxs-lookup"><span data-stu-id="9baa1-152">A WPF framework reference in .NET Core C++/CLI projects currently causes some extraneous warnings about being unable to import symbols.</span></span> <span data-ttu-id="9baa1-153">Ostrzeżenia te można bezpiecznie zignorować i należy je wkrótce naprawić.</span><span class="sxs-lookup"><span data-stu-id="9baa1-153">These warnings can be safely ignored and should be fixed soon.</span></span>
* <span data-ttu-id="9baa1-154">Jeśli aplikacja ma natywny punkt wejścia, biblioteka C++/CLI, która najpierw wykonuje kod zarządzany, wymaga pliku [runtimeconfig.json.](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md)</span><span class="sxs-lookup"><span data-stu-id="9baa1-154">If the application has a native entry point, the C++/CLI library that first executes managed code needs a [runtimeconfig.json](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md) file.</span></span> <span data-ttu-id="9baa1-155">Ten plik konfiguracyjny jest używany podczas uruchamiania programu .NET Core.</span><span class="sxs-lookup"><span data-stu-id="9baa1-155">This config file is used when the .NET Core runtime starts.</span></span> <span data-ttu-id="9baa1-156">Projekty C++/CLI nie `runtimeconfig.json` tworzą jeszcze plików w czasie kompilacji, więc plik musi zostać wygenerowany ręcznie.</span><span class="sxs-lookup"><span data-stu-id="9baa1-156">C++/CLI projects don't create `runtimeconfig.json` files automatically at build time yet, so the file must be generated manually.</span></span> <span data-ttu-id="9baa1-157">Jeśli biblioteka C++/CLI jest wywoływana z zarządzanego punktu wejścia, biblioteka C++/CLI nie potrzebuje `runtimeconfig.json` pliku (ponieważ zestaw punktu wejścia będzie miał taki, który jest używany podczas uruchamiania programu runtime).</span><span class="sxs-lookup"><span data-stu-id="9baa1-157">If a C++/CLI library is called from a managed entry point, then the C++/CLI library doesn't need a `runtimeconfig.json` file (since the entry point assembly will have one that is used when starting the runtime).</span></span> <span data-ttu-id="9baa1-158">Poniżej przedstawiono `runtimeconfig.json` prosty przykładowy plik.</span><span class="sxs-lookup"><span data-stu-id="9baa1-158">A simple sample `runtimeconfig.json` file is shown below.</span></span> <span data-ttu-id="9baa1-159">Aby uzyskać więcej informacji, zobacz [specyfikację w githubie](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md).</span><span class="sxs-lookup"><span data-stu-id="9baa1-159">For more information, see the [spec on GitHub](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md).</span></span>

    ```json
    {
          "runtimeOptions": {
             "tfm": "netcoreapp3.1",
             "framework": {
                "name": "Microsoft.NETCore.App",
                "version": "3.1.0"
             }
          }
    }
    ```
