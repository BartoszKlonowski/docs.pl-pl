---
title: EventPipe — Omówienie
description: Dowiedz się więcej o EventPipe i sposobach ich używania do śledzenia aplikacji .NET w celu diagnozowania problemów z wydajnością.
ms.date: 11/09/2020
ms.topic: overview
ms.openlocfilehash: 00378c4f409b307afa9183e40de6078cdafd3ae7
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/18/2020
ms.locfileid: "94820621"
---
# <a name="eventpipe"></a><span data-ttu-id="056aa-103">EventPipe</span><span class="sxs-lookup"><span data-stu-id="056aa-103">EventPipe</span></span>

<span data-ttu-id="056aa-104">EventPipe to składnik środowiska uruchomieniowego, który może służyć do zbierania danych śledzenia, podobnie jak ETW lub LTTng.</span><span class="sxs-lookup"><span data-stu-id="056aa-104">EventPipe is a runtime component that can be used to collect tracing data, similar to ETW or LTTng.</span></span> <span data-ttu-id="056aa-105">Celem EventPipe jest umożliwienie deweloperom platformy .NET śledzenia aplikacji platformy .NET bez konieczności polegania na specyficznych dla platformy systemach operacyjnych, takich jak ETW lub LTTng.</span><span class="sxs-lookup"><span data-stu-id="056aa-105">The goal of EventPipe is to allow .NET developers to easily trace their .NET applications without having to rely on platform-specific OS-native components such as ETW or LTTng.</span></span>

<span data-ttu-id="056aa-106">EventPipe jest mechanizmem za wiele narzędzi diagnostycznych i może służyć do konsumowania zdarzeń emitowanych przez środowisko uruchomieniowe oraz niestandardowych zdarzeń zapisanych przy użyciu elementu [EventSource](xref:System.Diagnostics.Tracing.EventSource).</span><span class="sxs-lookup"><span data-stu-id="056aa-106">EventPipe is the mechanism behind many of the diagnostic tools and can be used for consuming events emitted by the runtime as well as custom events written with [EventSource](xref:System.Diagnostics.Tracing.EventSource).</span></span>

<span data-ttu-id="056aa-107">Ten artykuł zawiera ogólne omówienie EventPipe opisujące, kiedy i jak używać EventPipe oraz jak skonfigurować go do własnych potrzeb.</span><span class="sxs-lookup"><span data-stu-id="056aa-107">This article is a high-level overview of EventPipe describing when and how to use EventPipe, and how to configure it to best suit your needs.</span></span>

## <a name="eventpipe-basics"></a><span data-ttu-id="056aa-108">EventPipe — podstawy</span><span class="sxs-lookup"><span data-stu-id="056aa-108">EventPipe basics</span></span>

<span data-ttu-id="056aa-109">EventPipe agreguje zdarzenia emitowane przez składniki środowiska uruchomieniowego — na przykład kompilator just in Time lub moduł wyrzucania elementów bezużytecznych, a także zdarzenia zapisywane z wystąpień elementu [EventSource](xref:System.Diagnostics.Tracing.EventSource) w bibliotekach i kodzie użytkownika.</span><span class="sxs-lookup"><span data-stu-id="056aa-109">EventPipe aggregates events emitted by runtime components - for example, the Just-In-Time compiler or the garbage collector - and events written from [EventSource](xref:System.Diagnostics.Tracing.EventSource) instances in the libraries and user code.</span></span>

<span data-ttu-id="056aa-110">Zdarzenia są następnie serializowane i mogą być zapisywane bezpośrednio do pliku lub używane przez port diagnostyki z zewnątrz.</span><span class="sxs-lookup"><span data-stu-id="056aa-110">The events are then serialized and can be written directly to a file or consumed through a Diagnostics Port from out-of-proces.</span></span> <span data-ttu-id="056aa-111">W systemie Windows porty diagnostyczne są implementowane jako `NamedPipe` s.</span><span class="sxs-lookup"><span data-stu-id="056aa-111">On Windows, Diagnostic Ports are implemented as `NamedPipe`s.</span></span> <span data-ttu-id="056aa-112">Na platformach innych niż Windows, takich jak Linux lub macOS, są implementowane przy użyciu gniazd domen systemu UNIX.</span><span class="sxs-lookup"><span data-stu-id="056aa-112">On non-Windows platforms, such as Linux or macOS, it is implemented using Unix Domain Sockets.</span></span> <span data-ttu-id="056aa-113">Aby uzyskać więcej informacji o porcie diagnostyki i sposobach współpracy z nim za pośrednictwem niestandardowego protokołu komunikacji między procesami, zapoznaj się z [dokumentacją dotyczącą protokołu IPC](https://github.com/dotnet/diagnostics/blob/master/documentation/design-docs/ipc-protocol.md).</span><span class="sxs-lookup"><span data-stu-id="056aa-113">For more information about the Diagnostics Port and how to interact with it via its custom inter-process communication protocol, see the [diagnostics IPC protocol documentation](https://github.com/dotnet/diagnostics/blob/master/documentation/design-docs/ipc-protocol.md).</span></span>

<span data-ttu-id="056aa-114">EventPipe następnie zapisuje serializowane zdarzenia w `.nettrace` formacie pliku jako strumień za pośrednictwem portów diagnostycznych lub bezpośrednio do pliku.</span><span class="sxs-lookup"><span data-stu-id="056aa-114">EventPipe then writes the serialized events in the `.nettrace` file format, either as a stream via Diagnostic Ports or directly to a file.</span></span> <span data-ttu-id="056aa-115">Aby dowiedzieć się więcej o formacie serializacji EventPipe, zapoznaj się z [dokumentacją w formacie EventPipe](https://github.com/microsoft/perfview/blob/master/src/TraceEvent/EventPipe/EventPipeFormat.md).</span><span class="sxs-lookup"><span data-stu-id="056aa-115">To learn more about the EventPipe serialization format, refer to the [EventPipe format documentation](https://github.com/microsoft/perfview/blob/master/src/TraceEvent/EventPipe/EventPipeFormat.md).</span></span>

## <a name="eventpipe-vs-etwlttng"></a><span data-ttu-id="056aa-116">EventPipe a ETW/LTTng</span><span class="sxs-lookup"><span data-stu-id="056aa-116">EventPipe vs. ETW/LTTng</span></span>

<span data-ttu-id="056aa-117">EventPipe jest częścią środowiska uruchomieniowego .NET (CoreCLR) i jest zaprojektowana tak, aby działała w ten sam sposób na wszystkich platformach obsługiwanych przez platformę .NET Core.</span><span class="sxs-lookup"><span data-stu-id="056aa-117">EventPipe is part of the .NET runtime (CoreCLR) and is designed to work the same way across all the platforms .NET Core supports.</span></span> <span data-ttu-id="056aa-118">Pozwala to na używanie narzędzi śledzenia opartych na EventPipe, takich jak `dotnet-counters` , `dotnet-gcdump` i `dotnet-trace` , w celu bezproblemowego działania między platformami.</span><span class="sxs-lookup"><span data-stu-id="056aa-118">This allows tracing tools based on EventPipe, such as `dotnet-counters`, `dotnet-gcdump`, and `dotnet-trace`, to work seamlessly across platforms.</span></span>

<span data-ttu-id="056aa-119">Jednak ponieważ EventPipe jest składnikiem wbudowanym środowiska uruchomieniowego, jego zakres jest ograniczony do kodu zarządzanego i samego środowiska uruchomieniowego.</span><span class="sxs-lookup"><span data-stu-id="056aa-119">However, because EventPipe is a runtime built-in component, its scope is limited to managed code and the runtime itself.</span></span> <span data-ttu-id="056aa-120">EventPipe nie można używać do śledzenia pewnych zdarzeń niższego poziomu, takich jak rozpoznawanie natywnego stosu kodu lub uzyskiwanie różnych zdarzeń jądra.</span><span class="sxs-lookup"><span data-stu-id="056aa-120">EventPipe cannot be used for tracking some lower-level events, such as resolving native code stack or getting various kernel events.</span></span> <span data-ttu-id="056aa-121">Jeśli używasz międzyoperacyjności C/C++ w aplikacji lub chcesz śledzić środowisko uruchomieniowe (które jest zapisywane w języku C++) lub chcesz uzyskać lepszą diagnostykę w zachowaniu aplikacji, która wymaga zdarzeń jądra (to znaczy zdarzenia przełączenia kontekstu natywnego wątku), należy użyć funkcji ETW lub [perf/LTTng](./trace-perfcollect-lttng.md).</span><span class="sxs-lookup"><span data-stu-id="056aa-121">If you use C/C++ interop in your app or you want to trace the runtime itself (which is written in C++), or want deeper diagnostics into the behavior of the app that requires kernel events (that is, native-thread context-switching events) you should use ETW or [perf/LTTng](./trace-perfcollect-lttng.md).</span></span>

<span data-ttu-id="056aa-122">Kolejną istotną różnicą między EventPipe i ETW/LTTng jest wymagania dotyczące uprawnień administratora/katalogu głównego.</span><span class="sxs-lookup"><span data-stu-id="056aa-122">Another major difference between EventPipe and ETW/LTTng is admin/root privilege requirement.</span></span> <span data-ttu-id="056aa-123">Aby śledzić aplikację przy użyciu funkcji ETW lub LTTng, musisz być administratorem/katalogiem głównym.</span><span class="sxs-lookup"><span data-stu-id="056aa-123">To trace an application using ETW or LTTng you need to be an admin/root.</span></span> <span data-ttu-id="056aa-124">Korzystając z EventPipe, można śledzić aplikacje tak długo, jak program śledzący (na przykład `dotnet-trace` ) jest uruchamiany jako ten sam użytkownik, który uruchomił aplikację.</span><span class="sxs-lookup"><span data-stu-id="056aa-124">Using EventPipe, you can trace applications as long as the tracer (for example, `dotnet-trace`) is run as the same user as the user that launched the application.</span></span>

<span data-ttu-id="056aa-125">Poniższa tabela zawiera podsumowanie różnic między EventPipe i ETW/LTTng.</span><span class="sxs-lookup"><span data-stu-id="056aa-125">The following table is a summary of the differences between EventPipe and ETW/LTTng.</span></span>

|<span data-ttu-id="056aa-126">Cechy</span><span class="sxs-lookup"><span data-stu-id="056aa-126">Feature</span></span>|<span data-ttu-id="056aa-127">EventPipe</span><span class="sxs-lookup"><span data-stu-id="056aa-127">EventPipe</span></span>|<span data-ttu-id="056aa-128">ETW</span><span class="sxs-lookup"><span data-stu-id="056aa-128">ETW</span></span>|<span data-ttu-id="056aa-129">LTTng</span><span class="sxs-lookup"><span data-stu-id="056aa-129">LTTng</span></span>|
|-------|---------|---|-----------|
|<span data-ttu-id="056aa-130">Wiele platform</span><span class="sxs-lookup"><span data-stu-id="056aa-130">Cross-platform</span></span>|<span data-ttu-id="056aa-131">Tak</span><span class="sxs-lookup"><span data-stu-id="056aa-131">Yes</span></span>|<span data-ttu-id="056aa-132">Nie (tylko w systemie Windows)</span><span class="sxs-lookup"><span data-stu-id="056aa-132">No (only on Windows)</span></span>|<span data-ttu-id="056aa-133">Nie (tylko w przypadku obsługiwanego dystrybucje systemu Linux)</span><span class="sxs-lookup"><span data-stu-id="056aa-133">No (only on supported Linux distros)</span></span>|
|<span data-ttu-id="056aa-134">Wymagaj uprawnienia administratora/elementu głównego</span><span class="sxs-lookup"><span data-stu-id="056aa-134">Require admin/root privilege</span></span>|<span data-ttu-id="056aa-135">Nie</span><span class="sxs-lookup"><span data-stu-id="056aa-135">No</span></span>|<span data-ttu-id="056aa-136">Tak</span><span class="sxs-lookup"><span data-stu-id="056aa-136">Yes</span></span>|<span data-ttu-id="056aa-137">Tak</span><span class="sxs-lookup"><span data-stu-id="056aa-137">Yes</span></span>|
|<span data-ttu-id="056aa-138">Może uzyskać zdarzenia systemu operacyjnego/jądra</span><span class="sxs-lookup"><span data-stu-id="056aa-138">Can get OS/kernel events</span></span>|<span data-ttu-id="056aa-139">Nie</span><span class="sxs-lookup"><span data-stu-id="056aa-139">No</span></span>|<span data-ttu-id="056aa-140">Tak</span><span class="sxs-lookup"><span data-stu-id="056aa-140">Yes</span></span>|<span data-ttu-id="056aa-141">Tak</span><span class="sxs-lookup"><span data-stu-id="056aa-141">Yes</span></span>|
|<span data-ttu-id="056aa-142">Może rozpoznać natywny stosy wywołań</span><span class="sxs-lookup"><span data-stu-id="056aa-142">Can resolve native callstacks</span></span>|<span data-ttu-id="056aa-143">Nie</span><span class="sxs-lookup"><span data-stu-id="056aa-143">No</span></span>|<span data-ttu-id="056aa-144">Tak</span><span class="sxs-lookup"><span data-stu-id="056aa-144">Yes</span></span>|<span data-ttu-id="056aa-145">Tak</span><span class="sxs-lookup"><span data-stu-id="056aa-145">Yes</span></span>|

## <a name="use-eventpipe-to-trace-your-net-application"></a><span data-ttu-id="056aa-146">Śledzenie aplikacji platformy .NET za pomocą EventPipe</span><span class="sxs-lookup"><span data-stu-id="056aa-146">Use EventPipe to trace your .NET application</span></span>

<span data-ttu-id="056aa-147">Możesz użyć EventPipe do śledzenia aplikacji .NET na wiele sposobów:</span><span class="sxs-lookup"><span data-stu-id="056aa-147">You can use EventPipe to trace your .NET application in many ways:</span></span>

* <span data-ttu-id="056aa-148">Użyj jednego z [narzędzi diagnostycznych](#tools-that-use-eventpipe) , które są oparte na EventPipe.</span><span class="sxs-lookup"><span data-stu-id="056aa-148">Use one of the [diagnostics tools](#tools-that-use-eventpipe) that are built on top of EventPipe.</span></span>

* <span data-ttu-id="056aa-149">Za pomocą biblioteki [Microsoft. Diagnostics. servicecore. Client](https://github.com/dotnet/diagnostics/blob/master/documentation/diagnostics-client-library-instructions.md) można napisać własne narzędzie do samodzielnego konfigurowania i uruchamiania sesji EventPipe.</span><span class="sxs-lookup"><span data-stu-id="056aa-149">Use [Microsoft.Diagnostics.NETCore.Client](https://github.com/dotnet/diagnostics/blob/master/documentation/diagnostics-client-library-instructions.md) library to write your own tool to configure and start EventPipe sessions yourself.</span></span>

* <span data-ttu-id="056aa-150">Użyj [zmiennych środowiskowych](#trace-using-environment-variables) , aby uruchomić EventPipe.</span><span class="sxs-lookup"><span data-stu-id="056aa-150">Use [environment variables](#trace-using-environment-variables) to start EventPipe.</span></span>

<span data-ttu-id="056aa-151">Po wygenerowaniu `nettrace` pliku zawierającego zdarzenia EventPipe można wyświetlić plik w programie [`PerfView`](https://github.com/Microsoft/perfview#perfview-overview) lub programie Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="056aa-151">After you've produced a `nettrace` file that contains your EventPipe events, you can view the file in [`PerfView`](https://github.com/Microsoft/perfview#perfview-overview) or Visual Studio.</span></span> <span data-ttu-id="056aa-152">Na platformach innych niż Windows można skonwertować `nettrace` plik do `speedscope` `Chromium` formatu lub format śledzenia za pomocą [`dotnet-trace convert`](./dotnet-trace.md#dotnet-trace-convert) polecenia i wyświetlić go z [`speedscope`](https://www.speedscope.app/) lub Chrome devtools.</span><span class="sxs-lookup"><span data-stu-id="056aa-152">On non-Windows platforms, you can convert the `nettrace` file to a `speedscope` or `Chromium` trace format by using [`dotnet-trace convert`](./dotnet-trace.md#dotnet-trace-convert) command and view it with [`speedscope`](https://www.speedscope.app/) or Chrome DevTools.</span></span>

<span data-ttu-id="056aa-153">Możesz również analizować ślady EventPipe programowo przy użyciu [zdarzenie śledzenia](https://github.com/Microsoft/perfview/blob/master/documentation/TraceEvent/TraceEventLibrary.md).</span><span class="sxs-lookup"><span data-stu-id="056aa-153">You can also analyze EventPipe traces programmatically with [TraceEvent](https://github.com/Microsoft/perfview/blob/master/documentation/TraceEvent/TraceEventLibrary.md).</span></span>

### <a name="tools-that-use-eventpipe"></a><span data-ttu-id="056aa-154">Narzędzia używające EventPipe</span><span class="sxs-lookup"><span data-stu-id="056aa-154">Tools that use EventPipe</span></span>

<span data-ttu-id="056aa-155">Jest to najprostszy sposób, aby używać EventPipe do śledzenia aplikacji.</span><span class="sxs-lookup"><span data-stu-id="056aa-155">This is the easiest way to use EventPipe to trace your application.</span></span> <span data-ttu-id="056aa-156">Aby dowiedzieć się więcej na temat korzystania z każdego z tych narzędzi, zapoznaj się z dokumentacją każdego narzędzia.</span><span class="sxs-lookup"><span data-stu-id="056aa-156">To learn more about how to use each of these tools, refer to each tool's documentation.</span></span>

* <span data-ttu-id="056aa-157">Funkcja [dotnet-Counters](./dotnet-counters.md) umożliwia monitorowanie i zbieranie różnych metryk emitowanych przez środowisko uruchomieniowe .NET i biblioteki podstawowe, a także metryki niestandardowe, które można napisać.</span><span class="sxs-lookup"><span data-stu-id="056aa-157">[dotnet-counters](./dotnet-counters.md) lets you monitor and collect various metrics emitted by the .NET runtime and core libraries, as well as custom metrics you can write.</span></span>

* <span data-ttu-id="056aa-158">[dotnet-gcdump](./dotnet-gcdump.md) umożliwia zbieranie zrzutów sterty GC procesów na żywo na potrzeby analizowania sterty zarządzanej aplikacji.</span><span class="sxs-lookup"><span data-stu-id="056aa-158">[dotnet-gcdump](./dotnet-gcdump.md) lets you collect GC heap dumps of live processes for analyzing an application's managed heap.</span></span>

* <span data-ttu-id="056aa-159">mechanizm [śledzenia dotnet](./dotnet-trace.md) umożliwia zbieranie śladów aplikacji do analizy pod kątem wydajności.</span><span class="sxs-lookup"><span data-stu-id="056aa-159">[dotnet-trace](./dotnet-trace.md) lets you collect traces of applications to analyze for performance.</span></span>

## <a name="trace-using-environment-variables"></a><span data-ttu-id="056aa-160">Śledzenie przy użyciu zmiennych środowiskowych</span><span class="sxs-lookup"><span data-stu-id="056aa-160">Trace using environment variables</span></span>

<span data-ttu-id="056aa-161">Preferowanym mechanizmem korzystania z EventPipe jest użycie `dotnet-trace` programu lub `Microsoft.Diagnostics.NETCore.Client` biblioteki.</span><span class="sxs-lookup"><span data-stu-id="056aa-161">The preferred mechanism for using EventPipe is to use `dotnet-trace` or the `Microsoft.Diagnostics.NETCore.Client` library.</span></span>

<span data-ttu-id="056aa-162">Można jednak użyć następujących zmiennych środowiskowych w celu skonfigurowania sesji EventPipe w aplikacji i zapisania śladu bezpośrednio do pliku.</span><span class="sxs-lookup"><span data-stu-id="056aa-162">However, you can use the following environment variables to set up an EventPipe session on an app and have it write the trace directly to a file.</span></span> <span data-ttu-id="056aa-163">Aby zatrzymać śledzenie, zamknij aplikację.</span><span class="sxs-lookup"><span data-stu-id="056aa-163">To stop tracing, exit the application.</span></span>

* <span data-ttu-id="056aa-164">`COMPlus_EnableEventPipe`: Ustaw tę wartość na, `1` Aby uruchomić sesję EventPipe, która zapisuje bezpośrednio do pliku.</span><span class="sxs-lookup"><span data-stu-id="056aa-164">`COMPlus_EnableEventPipe`: Set this to `1` to start an EventPipe session that writes directly to a file.</span></span> <span data-ttu-id="056aa-165">Wartość domyślna to `0`.</span><span class="sxs-lookup"><span data-stu-id="056aa-165">The default value is `0`.</span></span>

* <span data-ttu-id="056aa-166">`COMPlus_EventPipeOutputPath`: Ścieżka do wyjściowego pliku śledzenia EventPipe, gdy jest on skonfigurowany do uruchamiania za pośrednictwem `COMPlus_EnableEventPipe` .</span><span class="sxs-lookup"><span data-stu-id="056aa-166">`COMPlus_EventPipeOutputPath`: The path to the output EventPipe trace file when it's configured to run via `COMPlus_EnableEventPipe`.</span></span> <span data-ttu-id="056aa-167">Wartość domyślna to `trace.nettrace` , która zostanie utworzona w tym samym katalogu, w którym jest uruchomiona aplikacja.</span><span class="sxs-lookup"><span data-stu-id="056aa-167">The default value is `trace.nettrace`, which will be created in the same directory that the app is running from.</span></span>

* <span data-ttu-id="056aa-168">`COMPlus_CircularBufferMB`: Rozmiar wewnętrznego bufora, który jest używany przez EventPipe, gdy jest skonfigurowany do uruchamiania za pośrednictwem `COMPlus_EnableEventPipe` .</span><span class="sxs-lookup"><span data-stu-id="056aa-168">`COMPlus_CircularBufferMB`: The size of the internal buffer that is used by EventPipe when it's configured to run via `COMPlus_EnableEventPipe`.</span></span>

* <span data-ttu-id="056aa-169">`COMPlus_EventPipeConfig`: Konfiguruje konfigurację sesji EventPipe podczas uruchamiania sesji EventPipe z usługą `COMPlus_EnableEventPipe` .</span><span class="sxs-lookup"><span data-stu-id="056aa-169">`COMPlus_EventPipeConfig`: Sets up the EventPipe session configuration when starting an EventPipe session with `COMPlus_EnableEventPipe`.</span></span>

  <span data-ttu-id="056aa-170">Składnia wygląda następująco:</span><span class="sxs-lookup"><span data-stu-id="056aa-170">The syntax is as follows:</span></span>

  `<provider>:<keyword>:<level>`

  <span data-ttu-id="056aa-171">Można również określić wielu dostawców, łącząc je z przecinkiem:</span><span class="sxs-lookup"><span data-stu-id="056aa-171">You can also specify multiple providers by concatenating them with a comma:</span></span>

  `<provider1>:<keyword1>:<level1>,<provider2>:<keyword2>:<level2>`

  <span data-ttu-id="056aa-172">Jeśli ta zmienna środowiskowa nie została ustawiona, ale EventPipe jest włączona przez `COMPlus_EnableEventPipe` program, rozpocznie śledzenie przez włączenie następujących dostawców z następującymi słowami kluczowymi i poziomami:</span><span class="sxs-lookup"><span data-stu-id="056aa-172">If this environment variable is not set but EventPipe is enabled by `COMPlus_EnableEventPipe`, it will start tracing by enabling the following providers with the following keywords and levels:</span></span>

  - `Microsoft-Windows-DotNETRuntime:4c14fccbd:5`
  - `Microsoft-Windows-DotNETRuntimePrivate:4002000b:5`
  - `Microsoft-DotNETCore-SampleProfiler:0:5`
