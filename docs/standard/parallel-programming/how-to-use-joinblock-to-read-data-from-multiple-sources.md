---
title: 'Porady: Korzystanie z klasy JoinBlock do odczytywania danych z wielu źródeł'
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Task Parallel Library, dataflows
- TPL dataflow library, joining blocks in
- dataflow blocks, joining in TPL
ms.assetid: e9c1ada4-ac57-4704-87cb-2f5117f8151d
ms.openlocfilehash: 66fd7ed7a98b8be8f88f65ecb52710a1e40af778
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/30/2019
ms.locfileid: "73139738"
---
# <a name="how-to-use-joinblock-to-read-data-from-multiple-sources"></a><span data-ttu-id="8a43e-102">Porady: Korzystanie z klasy JoinBlock do odczytywania danych z wielu źródeł</span><span class="sxs-lookup"><span data-stu-id="8a43e-102">How to: Use JoinBlock to Read Data From Multiple Sources</span></span>
<span data-ttu-id="8a43e-103">W tym dokumencie wyjaśniono, jak używać klasy <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> do wykonywania operacji, gdy dane są dostępne z wielu źródeł.</span><span class="sxs-lookup"><span data-stu-id="8a43e-103">This document explains how to use the <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> class to perform an operation when data is available from multiple sources.</span></span> <span data-ttu-id="8a43e-104">Pokazano również, jak używać trybu zachłanne, aby umożliwić wiele bloków sprzężeń, aby bardziej efektywnie współużytkować źródło danych.</span><span class="sxs-lookup"><span data-stu-id="8a43e-104">It also demonstrates how to use non-greedy mode to enable multiple join blocks to share a data source more efficiently.</span></span>

[!INCLUDE [tpl-install-instructions](../../../includes/tpl-install-instructions.md)]

## <a name="example"></a><span data-ttu-id="8a43e-105">Przykład</span><span class="sxs-lookup"><span data-stu-id="8a43e-105">Example</span></span>  
 <span data-ttu-id="8a43e-106">W poniższym przykładzie zdefiniowano trzy typy zasobów, `NetworkResource`, `FileResource`i `MemoryResource`oraz wykonuje operacje, gdy zasoby staną się dostępne.</span><span class="sxs-lookup"><span data-stu-id="8a43e-106">The following example defines three resource types, `NetworkResource`, `FileResource`, and `MemoryResource`, and performs operations when resources become available.</span></span> <span data-ttu-id="8a43e-107">Ten przykład wymaga pary `NetworkResource` i `MemoryResource` w celu wykonania pierwszej operacji i pary `FileResource` i `MemoryResource` w celu wykonania drugiej operacji.</span><span class="sxs-lookup"><span data-stu-id="8a43e-107">This example requires a `NetworkResource` and `MemoryResource` pair in order to perform the first operation and a `FileResource` and `MemoryResource` pair in order to perform the second operation.</span></span> <span data-ttu-id="8a43e-108">Aby włączyć te operacje, gdy wszystkie wymagane zasoby są dostępne, w tym przykładzie zostanie użyta Klasa <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>.</span><span class="sxs-lookup"><span data-stu-id="8a43e-108">To enable these operations to occur when all required resources are available, this example uses the <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> class.</span></span> <span data-ttu-id="8a43e-109">Gdy obiekt <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> odbiera dane ze wszystkich źródeł, propaguje te dane do obiektu docelowego, co w tym przykładzie jest obiektem <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>.</span><span class="sxs-lookup"><span data-stu-id="8a43e-109">When a <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> object receives data from all sources, it propagates that data to its target, which in this example is an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object.</span></span> <span data-ttu-id="8a43e-110">Oba obiekty <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> odczytywać z udostępnionej puli obiektów `MemoryResource`.</span><span class="sxs-lookup"><span data-stu-id="8a43e-110">Both <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects read from a shared pool of `MemoryResource` objects.</span></span>  
  
 [!code-csharp[TPLDataflow_NonGreedyJoin#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_nongreedyjoin/cs/nongreedyjoin.cs#1)]
 [!code-vb[TPLDataflow_NonGreedyJoin#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_nongreedyjoin/vb/nongreedyjoin.vb#1)]  
  
 <span data-ttu-id="8a43e-111">Aby umożliwić efektywne wykorzystanie udostępnionej puli `MemoryResource` obiektów, w tym przykładzie określa obiekt <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions>, który ma właściwość <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> ustawioną na `False` do tworzenia <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> obiektów, które działają w trybie innym niż zachłanne.</span><span class="sxs-lookup"><span data-stu-id="8a43e-111">To enable efficient use of the shared pool of `MemoryResource` objects, this example specifies a <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> property set to `False` to create <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects that act in non-greedy mode.</span></span> <span data-ttu-id="8a43e-112">Blok Join inny niż zachłanne umożliwia odłożenie wszystkich komunikatów przychodzących do momentu, gdy jeden z nich będzie dostępny z każdego źródła.</span><span class="sxs-lookup"><span data-stu-id="8a43e-112">A non-greedy join block postpones all incoming messages until one is available from each source.</span></span> <span data-ttu-id="8a43e-113">Jeśli dowolny z odroczonych komunikatów został zaakceptowany przez inny blok, blok sprzężenia ponownie uruchamia proces.</span><span class="sxs-lookup"><span data-stu-id="8a43e-113">If any of the postponed messages were accepted by another block, the join block restarts the process.</span></span> <span data-ttu-id="8a43e-114">Tryb inny niż zachłanne umożliwia blokom sprzężenia, które współdzielą jeden lub więcej bloków źródłowych, aby postępować dalej, ponieważ inne bloki oczekują na dane.</span><span class="sxs-lookup"><span data-stu-id="8a43e-114">Non-greedy mode enables join blocks that share one or more source blocks to make forward progress as the other blocks wait for data.</span></span> <span data-ttu-id="8a43e-115">W tym przykładzie, jeśli do puli `memoryResources` zostanie dodany obiekt `MemoryResource`, pierwszy blok sprzężenia, aby otrzymać drugie źródło danych, może postępować dalej.</span><span class="sxs-lookup"><span data-stu-id="8a43e-115">In this example, if a `MemoryResource` object is added to the `memoryResources` pool, the first join block to receive its second data source can make forward progress.</span></span> <span data-ttu-id="8a43e-116">Jeśli w tym przykładzie był używany tryb zachłanne, który jest domyślnym, jeden blok sprzężenia może przyjmować `MemoryResource` obiektu i czekać, aż drugi zasób stanie się dostępny.</span><span class="sxs-lookup"><span data-stu-id="8a43e-116">If this example were to use greedy mode, which is the default, one join block might take the `MemoryResource` object and wait for the second resource to become available.</span></span> <span data-ttu-id="8a43e-117">Jeśli jednak inny blok sprzężenia ma dostęp do drugiego źródła danych, nie może postępować dalej, ponieważ obiekt `MemoryResource` został wykonany przez inny blok sprzężenia.</span><span class="sxs-lookup"><span data-stu-id="8a43e-117">However, if the other join block has its second data source available, it cannot make forward progress because the `MemoryResource` object has been taken by the other join block.</span></span>  
  
## <a name="robust-programming"></a><span data-ttu-id="8a43e-118">Niezawodne programowanie</span><span class="sxs-lookup"><span data-stu-id="8a43e-118">Robust Programming</span></span>  
 <span data-ttu-id="8a43e-119">Użycie sprzężeń innych niż zachłanne może również pomóc w zapobieganiu zakleszczeniom w aplikacji.</span><span class="sxs-lookup"><span data-stu-id="8a43e-119">The use of non-greedy joins can also help you prevent deadlock in your application.</span></span> <span data-ttu-id="8a43e-120">W aplikacji oprogramowania *zakleszczenie* występuje, gdy co najmniej dwa procesy przechowują zasób i wzajemnie czekają na inny proces zwolnienia innego zasobu.</span><span class="sxs-lookup"><span data-stu-id="8a43e-120">In a software application, *deadlock* occurs when two or more processes each hold a resource and mutually wait for another process to release some other resource.</span></span> <span data-ttu-id="8a43e-121">Rozważmy aplikację, która definiuje dwa <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> obiekty.</span><span class="sxs-lookup"><span data-stu-id="8a43e-121">Consider an application that defines two <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects.</span></span> <span data-ttu-id="8a43e-122">Oba obiekty odczytają dane z dwóch udostępnionych bloków źródłowych.</span><span class="sxs-lookup"><span data-stu-id="8a43e-122">Both objects each read data from two shared source blocks.</span></span> <span data-ttu-id="8a43e-123">W trybie zachłanne, jeśli jeden blok sprzężenia odczytuje z pierwszego źródła, a drugi blok sprzężenia odczytuje z drugiego źródła, aplikacja może zakleszczać, ponieważ oba bloki sprzężenia wzajemnie zaczekają na inne, aby zwolnić zasób.</span><span class="sxs-lookup"><span data-stu-id="8a43e-123">In greedy mode, if one join block reads from the first source and the second join block reads from the second source, the application might deadlock because both join blocks mutually wait for the other to release its resource.</span></span> <span data-ttu-id="8a43e-124">W trybie innym niż zachłanne każdy blok sprzężenia odczytuje ze źródeł tylko wtedy, gdy wszystkie dane są dostępne i w związku z tym ryzyko zakleszczenia jest eliminowane.</span><span class="sxs-lookup"><span data-stu-id="8a43e-124">In non-greedy mode, each join block reads from its sources only when all data is available, and therefore, the risk of deadlock is eliminated.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8a43e-125">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="8a43e-125">See also</span></span>

- [<span data-ttu-id="8a43e-126">Przepływ danych</span><span class="sxs-lookup"><span data-stu-id="8a43e-126">Dataflow</span></span>](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)
