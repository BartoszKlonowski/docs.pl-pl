---
title: 'Przewodnik: Korzystanie z przepływu danych w aplikacji Windows Forms'
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- TPL dataflow library, in Windows Forms
- Task Parallel Library, dataflows
- Windows Forms, and TPL
ms.assetid: 9c65cdf7-660c-409f-89ea-59d7ec8e127c
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 4dc433b83fd086a1e3e165a85b6bfe64b781f45b
ms.sourcegitcommit: cdf67135a98a5a51913dacddb58e004a3c867802
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 08/21/2019
ms.locfileid: "69666339"
---
# <a name="walkthrough-using-dataflow-in-a-windows-forms-application"></a><span data-ttu-id="35f7e-102">Przewodnik: Korzystanie z przepływu danych w aplikacji Windows Forms</span><span class="sxs-lookup"><span data-stu-id="35f7e-102">Walkthrough: Using Dataflow in a Windows Forms Application</span></span>
<span data-ttu-id="35f7e-103">W tym dokumencie przedstawiono sposób tworzenia sieci bloków przepływu danych, które wykonują przetwarzanie obrazów w aplikacji Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="35f7e-103">This document demonstrates how to create a network of dataflow blocks that perform image processing in a Windows Forms application.</span></span>  
  
 <span data-ttu-id="35f7e-104">Ten przykład służy do ładowania plików obrazów z określonego folderu, tworzenia obrazu złożonego i wyświetlania wyniku.</span><span class="sxs-lookup"><span data-stu-id="35f7e-104">This example loads image files from the specified folder, creates a composite image, and displays the result.</span></span> <span data-ttu-id="35f7e-105">W przykładzie zastosowano model przepływu danych do rozsyłania obrazów za pośrednictwem sieci.</span><span class="sxs-lookup"><span data-stu-id="35f7e-105">The example uses the dataflow model to route images through the network.</span></span> <span data-ttu-id="35f7e-106">W modelu przepływu danych niezależne składniki programu komunikują się ze sobą przez wysyłanie komunikatów.</span><span class="sxs-lookup"><span data-stu-id="35f7e-106">In the dataflow model, independent components of a program communicate with one another by sending messages.</span></span> <span data-ttu-id="35f7e-107">Gdy składnik odbiera komunikat, wykonuje pewne działania, a następnie przekazuje wynik do innego składnika.</span><span class="sxs-lookup"><span data-stu-id="35f7e-107">When a component receives a message, it performs some action and then passes the result to another component.</span></span> <span data-ttu-id="35f7e-108">Porównaj ten element z modelem przepływu sterowania, w którym aplikacja używa struktur kontroli, na przykład instrukcji warunkowych, pętli i tak dalej, aby kontrolować kolejność operacji w programie.</span><span class="sxs-lookup"><span data-stu-id="35f7e-108">Compare this with the control flow model, in which an application uses control structures, for example, conditional statements, loops, and so on, to control the order of operations in a program.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="35f7e-109">Wymagania wstępne</span><span class="sxs-lookup"><span data-stu-id="35f7e-109">Prerequisites</span></span>  
 <span data-ttu-id="35f7e-110">Przeczytaj [przepływu danych](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md) przed rozpoczęciem tego instruktażu.</span><span class="sxs-lookup"><span data-stu-id="35f7e-110">Read [Dataflow](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md) before you start this walkthrough.</span></span>  

[!INCLUDE [tpl-install-instructions](../../../includes/tpl-install-instructions.md)]

## <a name="sections"></a><span data-ttu-id="35f7e-111">Sekcje</span><span class="sxs-lookup"><span data-stu-id="35f7e-111">Sections</span></span>  
 <span data-ttu-id="35f7e-112">Ten Instruktaż zawiera następujące sekcje:</span><span class="sxs-lookup"><span data-stu-id="35f7e-112">This walkthrough contains the following sections:</span></span>  
  
- [<span data-ttu-id="35f7e-113">Tworzenie aplikacji Windows Forms</span><span class="sxs-lookup"><span data-stu-id="35f7e-113">Creating the Windows Forms Application</span></span>](#winforms)  
  
- [<span data-ttu-id="35f7e-114">Tworzenie sieci przepływu danych</span><span class="sxs-lookup"><span data-stu-id="35f7e-114">Creating the Dataflow Network</span></span>](#network)  
  
- [<span data-ttu-id="35f7e-115">Łączenie sieci przepływu danych z interfejsem użytkownika</span><span class="sxs-lookup"><span data-stu-id="35f7e-115">Connecting the Dataflow Network to the User Interface</span></span>](#ui)  
  
- [<span data-ttu-id="35f7e-116">Kompletny przykład</span><span class="sxs-lookup"><span data-stu-id="35f7e-116">The Complete Example</span></span>](#complete)  
  
<a name="winforms"></a>   
## <a name="creating-the-windows-forms-application"></a><span data-ttu-id="35f7e-117">Tworzenie aplikacji Windows Forms</span><span class="sxs-lookup"><span data-stu-id="35f7e-117">Creating the Windows Forms Application</span></span>  
 <span data-ttu-id="35f7e-118">W tej sekcji opisano, jak utworzyć podstawową aplikację Windows Forms i dodać kontrolki do formularza głównego.</span><span class="sxs-lookup"><span data-stu-id="35f7e-118">This section describes how to create the basic Windows Forms application and add controls to the main form.</span></span>  
  
### <a name="to-create-the-windows-forms-application"></a><span data-ttu-id="35f7e-119">Aby utworzyć aplikację Windows Forms</span><span class="sxs-lookup"><span data-stu-id="35f7e-119">To Create the Windows Forms Application</span></span>  
  
1. <span data-ttu-id="35f7e-120">W programie Visual Studio Utwórz projekt C# **aplikacji Windows Forms** wizualizacji lub Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="35f7e-120">In Visual Studio, create a Visual C# or Visual Basic **Windows Forms Application** project.</span></span> <span data-ttu-id="35f7e-121">W tym dokumencie projekt ma nazwę `CompositeImages`.</span><span class="sxs-lookup"><span data-stu-id="35f7e-121">In this document, the project is named `CompositeImages`.</span></span>  
  
2. <span data-ttu-id="35f7e-122">W projektancie formularzy dla formularza głównego Form1.cs (Form1. vb dla Visual Basic) Dodaj <xref:System.Windows.Forms.ToolStrip> kontrolkę.</span><span class="sxs-lookup"><span data-stu-id="35f7e-122">On the form designer for the main form, Form1.cs (Form1.vb for Visual Basic), add a <xref:System.Windows.Forms.ToolStrip> control.</span></span>  
  
3. <span data-ttu-id="35f7e-123">Dodaj kontrolkę do <xref:System.Windows.Forms.ToolStrip>kontrolki. <xref:System.Windows.Forms.ToolStripButton></span><span class="sxs-lookup"><span data-stu-id="35f7e-123">Add a <xref:System.Windows.Forms.ToolStripButton> control to the <xref:System.Windows.Forms.ToolStrip> control.</span></span> <span data-ttu-id="35f7e-124">Ustaw właściwość na <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text> i<xref:System.Windows.Forms.ToolStripItem.Text%2A> właściwość, aby **wybrać folder.** <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A></span><span class="sxs-lookup"><span data-stu-id="35f7e-124">Set the <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> property to <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text> and the <xref:System.Windows.Forms.ToolStripItem.Text%2A> property to **Choose Folder**.</span></span>  
  
4. <span data-ttu-id="35f7e-125">Dodaj drugą <xref:System.Windows.Forms.ToolStripButton> kontrolkę <xref:System.Windows.Forms.ToolStrip> do kontrolki.</span><span class="sxs-lookup"><span data-stu-id="35f7e-125">Add a second <xref:System.Windows.Forms.ToolStripButton> control to the <xref:System.Windows.Forms.ToolStrip> control.</span></span> <span data-ttu-id="35f7e-126"><xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text> <xref:System.Windows.Forms.ToolStripItem.Enabled%2A> Ustaw właściwość na `False`, Właściwośćdoanulowaniaiwłaściwośćna<xref:System.Windows.Forms.ToolStripItem.Text%2A>. <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A></span><span class="sxs-lookup"><span data-stu-id="35f7e-126">Set the <xref:System.Windows.Forms.ToolStripItem.DisplayStyle%2A> property to <xref:System.Windows.Forms.ToolStripItemDisplayStyle.Text>, the <xref:System.Windows.Forms.ToolStripItem.Text%2A> property to **Cancel**, and the <xref:System.Windows.Forms.ToolStripItem.Enabled%2A> property to `False`.</span></span>  
  
5. <span data-ttu-id="35f7e-127"><xref:System.Windows.Forms.PictureBox> Dodaj obiekt do formularza głównego.</span><span class="sxs-lookup"><span data-stu-id="35f7e-127">Add a <xref:System.Windows.Forms.PictureBox> object to the main form.</span></span> <span data-ttu-id="35f7e-128">Ustaw <xref:System.Windows.Forms.Control.Dock%2A> właściwość <xref:System.Windows.Forms.DockStyle.Fill>.</span><span class="sxs-lookup"><span data-stu-id="35f7e-128">Set the <xref:System.Windows.Forms.Control.Dock%2A> property to <xref:System.Windows.Forms.DockStyle.Fill>.</span></span>  
  
<a name="network"></a>   
## <a name="creating-the-dataflow-network"></a><span data-ttu-id="35f7e-129">Tworzenie sieci przepływu danych</span><span class="sxs-lookup"><span data-stu-id="35f7e-129">Creating the Dataflow Network</span></span>  
 <span data-ttu-id="35f7e-130">W tej sekcji opisano sposób tworzenia sieci przepływu danych, która wykonuje przetwarzanie obrazu.</span><span class="sxs-lookup"><span data-stu-id="35f7e-130">This section describes how to create the dataflow network that performs image processing.</span></span>  
  
### <a name="to-create-the-dataflow-network"></a><span data-ttu-id="35f7e-131">Aby utworzyć sieć przepływu danych</span><span class="sxs-lookup"><span data-stu-id="35f7e-131">To Create the Dataflow Network</span></span>  
  
1. <span data-ttu-id="35f7e-132">Dodaj odwołanie do elementu System. Threading. Tasks. przepływu danych. dll do projektu.</span><span class="sxs-lookup"><span data-stu-id="35f7e-132">Add a reference to System.Threading.Tasks.Dataflow.dll to your project.</span></span>  
  
2. <span data-ttu-id="35f7e-133">Upewnij się, że Form1.cs (Form1. vb dla Visual Basic) zawiera `using` następujące`Using` instrukcje (w Visual Basic):</span><span class="sxs-lookup"><span data-stu-id="35f7e-133">Ensure that Form1.cs (Form1.vb for Visual Basic) contains the following `using` (`Using` in Visual Basic) statements:</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#1)]  
  
3. <span data-ttu-id="35f7e-134">Dodaj następujące składowe danych do `Form1` klasy:</span><span class="sxs-lookup"><span data-stu-id="35f7e-134">Add the following data members to the `Form1` class:</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#2)]  
  
4. <span data-ttu-id="35f7e-135">Dodaj następującą metodę `CreateImageProcessingNetwork` `Form1` do klasy.</span><span class="sxs-lookup"><span data-stu-id="35f7e-135">Add the following method, `CreateImageProcessingNetwork`, to the `Form1` class.</span></span> <span data-ttu-id="35f7e-136">Ta metoda służy do tworzenia sieci przetwarzania obrazów.</span><span class="sxs-lookup"><span data-stu-id="35f7e-136">This method creates the image processing network.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#3)]  
  
5. <span data-ttu-id="35f7e-137">Zaimplementuj `LoadBitmaps` metodę.</span><span class="sxs-lookup"><span data-stu-id="35f7e-137">Implement the `LoadBitmaps` method.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#4)]  
  
6. <span data-ttu-id="35f7e-138">Zaimplementuj `CreateCompositeBitmap` metodę.</span><span class="sxs-lookup"><span data-stu-id="35f7e-138">Implement the `CreateCompositeBitmap` method.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#5)]  
  
    > [!NOTE]
    >  <span data-ttu-id="35f7e-139">C# Wersja`CreateCompositeBitmap` metody używa wskaźników w celu zapewnienia <xref:System.Drawing.Bitmap?displayProperty=nameWithType> wydajnego przetwarzania obiektów.</span><span class="sxs-lookup"><span data-stu-id="35f7e-139">The C# version of the `CreateCompositeBitmap` method uses pointers to enable efficient processing of the <xref:System.Drawing.Bitmap?displayProperty=nameWithType> objects.</span></span> <span data-ttu-id="35f7e-140">W związku z tym należy włączyć opcję Zezwalaj na niebezpieczny **kod** w projekcie, aby można było [](../../csharp/language-reference/keywords/unsafe.md) użyć słowa kluczowego unsafe.</span><span class="sxs-lookup"><span data-stu-id="35f7e-140">Therefore, you must enable the **Allow unsafe code** option in your project in order to use the [unsafe](../../csharp/language-reference/keywords/unsafe.md) keyword.</span></span> <span data-ttu-id="35f7e-141">Aby uzyskać więcej informacji na temat włączania niebezpiecznego kodu C# w projekcie wizualizacji, zobacz [stronę Kompilacja,C#Projektant projektu ()](/visualstudio/ide/reference/build-page-project-designer-csharp).</span><span class="sxs-lookup"><span data-stu-id="35f7e-141">For more information about how to enable unsafe code in a Visual C# project, see [Build Page, Project Designer (C#)](/visualstudio/ide/reference/build-page-project-designer-csharp).</span></span>  
  
 <span data-ttu-id="35f7e-142">W poniższej tabeli opisano elementy członkowskie sieci.</span><span class="sxs-lookup"><span data-stu-id="35f7e-142">The following table describes the members of the network.</span></span>  
  
|<span data-ttu-id="35f7e-143">Element członkowski</span><span class="sxs-lookup"><span data-stu-id="35f7e-143">Member</span></span>|<span data-ttu-id="35f7e-144">Typ</span><span class="sxs-lookup"><span data-stu-id="35f7e-144">Type</span></span>|<span data-ttu-id="35f7e-145">Opis</span><span class="sxs-lookup"><span data-stu-id="35f7e-145">Description</span></span>|  
|------------|----------|-----------------|  
|`loadBitmaps`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<span data-ttu-id="35f7e-146">Pobiera ścieżkę folderu jako dane wejściowe i tworzy kolekcję <xref:System.Drawing.Bitmap> obiektów jako dane wyjściowe.</span><span class="sxs-lookup"><span data-stu-id="35f7e-146">Takes a folder path as input and produces a collection of <xref:System.Drawing.Bitmap> objects as output.</span></span>|  
|`createCompositeBitmap`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<span data-ttu-id="35f7e-147">Pobiera kolekcję <xref:System.Drawing.Bitmap> obiektów jako dane wejściowe i tworzy kompozytową mapę bitową jako dane wyjściowe.</span><span class="sxs-lookup"><span data-stu-id="35f7e-147">Takes a collection of <xref:System.Drawing.Bitmap> objects as input and produces a composite bitmap as output.</span></span>|  
|`displayCompositeBitmap`|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|<span data-ttu-id="35f7e-148">Wyświetla kompozytową mapę bitową w formularzu.</span><span class="sxs-lookup"><span data-stu-id="35f7e-148">Displays the composite bitmap on the form.</span></span>|  
|`operationCancelled`|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|<span data-ttu-id="35f7e-149">Wyświetla obraz wskazujący, że operacja została anulowana, i umożliwia użytkownikowi wybranie innego folderu.</span><span class="sxs-lookup"><span data-stu-id="35f7e-149">Displays an image to indicate that the operation is canceled and enables the user to select another folder.</span></span>|  
  
 <span data-ttu-id="35f7e-150">Aby połączyć bloki przepływu danych w celu utworzenia sieci, w tym przykładzie zostanie <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> użyta metoda.</span><span class="sxs-lookup"><span data-stu-id="35f7e-150">To connect the dataflow blocks to form a network, this example uses the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> method.</span></span> <span data-ttu-id="35f7e-151">Metoda zawiera przeciążoną wersję, która <xref:System.Predicate%601> pobiera obiekt, który określa, czy blok docelowy akceptuje lub odrzuca komunikat. <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A></span><span class="sxs-lookup"><span data-stu-id="35f7e-151">The <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> method contains an overloaded version that takes a <xref:System.Predicate%601> object that determines whether the target block accepts or rejects a message.</span></span> <span data-ttu-id="35f7e-152">Ten mechanizm filtrowania umożliwia blokom komunikatów odbieranie tylko określonych wartości.</span><span class="sxs-lookup"><span data-stu-id="35f7e-152">This filtering mechanism enables message blocks to receive only certain values.</span></span> <span data-ttu-id="35f7e-153">W tym przykładzie sieć może rozgałęziać się na jeden z dwóch sposobów.</span><span class="sxs-lookup"><span data-stu-id="35f7e-153">In this example, the network can branch in one of two ways.</span></span> <span data-ttu-id="35f7e-154">Gałąź główna ładuje obrazy z dysku, tworzy obraz złożony i wyświetla ten obraz w formularzu.</span><span class="sxs-lookup"><span data-stu-id="35f7e-154">The main branch loads the images from disk, creates the composite image, and displays that image on the form.</span></span> <span data-ttu-id="35f7e-155">Gałąź alternatywna anuluje bieżącą operację.</span><span class="sxs-lookup"><span data-stu-id="35f7e-155">The alternate branch cancels the current operation.</span></span> <span data-ttu-id="35f7e-156"><xref:System.Predicate%601> Obiekty umożliwiają blokom przepływu danych wzdłuż gałęzi głównej, aby przełączyć się na gałąź alternatywną poprzez odrzucenie niektórych komunikatów.</span><span class="sxs-lookup"><span data-stu-id="35f7e-156">The <xref:System.Predicate%601> objects enable the dataflow blocks along the main branch to switch to the alternative branch by rejecting certain messages.</span></span> <span data-ttu-id="35f7e-157">Na przykład, jeśli użytkownik anuluje operację, blok `createCompositeBitmap` przepływu danych tworzy `null` (`Nothing` w Visual Basic) jako dane wyjściowe.</span><span class="sxs-lookup"><span data-stu-id="35f7e-157">For example, if the user cancels the operation, the dataflow block `createCompositeBitmap` produces `null` (`Nothing` in Visual Basic) as its output.</span></span> <span data-ttu-id="35f7e-158">Blok `displayCompositeBitmap` przepływu danych `operationCancelled`odrzuca wartości wejściowe i w związku z tym komunikat jest oferowany dla. `null`</span><span class="sxs-lookup"><span data-stu-id="35f7e-158">The dataflow block `displayCompositeBitmap` rejects `null` input values, and therefore, the message is offered to `operationCancelled`.</span></span> <span data-ttu-id="35f7e-159">Blok `operationCancelled` przepływu danych akceptuje wszystkie komunikaty i w związku z tym wyświetla obraz, aby wskazać, że operacja została anulowana.</span><span class="sxs-lookup"><span data-stu-id="35f7e-159">The dataflow block `operationCancelled` accepts all messages and therefore, displays an image to indicate that the operation is canceled.</span></span>  
  
 <span data-ttu-id="35f7e-160">Na poniższej ilustracji przedstawiono sieć przetwarzania obrazów:</span><span class="sxs-lookup"><span data-stu-id="35f7e-160">The following illustration shows the image processing network:</span></span>  
  
 ![Ilustracja przedstawiająca sieć przetwarzania obrazów.](./media/walkthrough-using-dataflow-in-a-windows-forms-application/dataflow-winforms-image-processing.png)  
  
 <span data-ttu-id="35f7e-162">Ponieważ bloki `operationCancelled` i przepływu danych działają na interfejsie użytkownika, należy pamiętać, że te akcje są wykonywane w wątku interfejsu użytkownika. `displayCompositeBitmap`</span><span class="sxs-lookup"><span data-stu-id="35f7e-162">Because the `displayCompositeBitmap` and `operationCancelled` dataflow blocks act on the user interface, it is important that these actions occur on the user-interface thread.</span></span> <span data-ttu-id="35f7e-163">W tym celu w czasie konstruowania obiekty te udostępniają <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> obiekt, który <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> ma właściwość ustawioną na <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="35f7e-163">To accomplish this, during construction, these objects each provide a <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> property set to <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="35f7e-164"><xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType> Metoda<xref:System.Threading.Tasks.TaskScheduler> tworzy obiekt, który wykonuje prace w bieżącym kontekście synchronizacji.</span><span class="sxs-lookup"><span data-stu-id="35f7e-164">The <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType> method creates a <xref:System.Threading.Tasks.TaskScheduler> object that performs work on the current synchronization context.</span></span> <span data-ttu-id="35f7e-165">Ponieważ metoda jest wywoływana z procedury obsługi przycisku **Wybierz folder** , który działa w wątku interfejsu użytkownika, akcje dla `displayCompositeBitmap` bloków i `operationCancelled` przepływu danych również są uruchamiane w wątku interfejsu użytkownika. `CreateImageProcessingNetwork`</span><span class="sxs-lookup"><span data-stu-id="35f7e-165">Because the `CreateImageProcessingNetwork` method is called from the handler of the **Choose Folder** button, which runs on the user-interface thread, the actions for the `displayCompositeBitmap` and `operationCancelled` dataflow blocks also run on the user-interface thread.</span></span>  
  
 <span data-ttu-id="35f7e-166">W tym przykładzie używa udostępnionego tokenu anulowania zamiast ustawiania właściwości, <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> ponieważ właściwość trwale anuluje wykonywanie bloku przepływu danych.</span><span class="sxs-lookup"><span data-stu-id="35f7e-166">This example uses a shared cancellation token instead of setting the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> property because the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> property permanently cancels dataflow block execution.</span></span> <span data-ttu-id="35f7e-167">Token anulowania umożliwia korzystanie z tej samej sieci przepływu danych wiele razy, nawet jeśli użytkownik anuluje jedną lub więcej operacji.</span><span class="sxs-lookup"><span data-stu-id="35f7e-167">A cancellation token enables this example to reuse the same dataflow network multiple times, even when the user cancels one or more operations.</span></span> <span data-ttu-id="35f7e-168">Przykład, który używa <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> do trwałego anulowania wykonywania bloku przepływu danych, znajduje się w temacie [How to: Anuluj blok](../../../docs/standard/parallel-programming/how-to-cancel-a-dataflow-block.md)przepływu danych.</span><span class="sxs-lookup"><span data-stu-id="35f7e-168">For an example that uses <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> to permanently cancel the execution of a dataflow block, see [How to: Cancel a Dataflow Block](../../../docs/standard/parallel-programming/how-to-cancel-a-dataflow-block.md).</span></span>  
  
<a name="ui"></a>   
## <a name="connecting-the-dataflow-network-to-the-user-interface"></a><span data-ttu-id="35f7e-169">Łączenie sieci przepływu danych z interfejsem użytkownika</span><span class="sxs-lookup"><span data-stu-id="35f7e-169">Connecting the Dataflow Network to the User Interface</span></span>  
 <span data-ttu-id="35f7e-170">W tej sekcji opisano sposób łączenia sieci przepływu danych z interfejsem użytkownika.</span><span class="sxs-lookup"><span data-stu-id="35f7e-170">This section describes how to connect the dataflow network to the user interface.</span></span> <span data-ttu-id="35f7e-171">Tworzenie obrazu złożonego i anulowanie operacji są inicjowane z przycisków **Wybierz folder** i **Anuluj** .</span><span class="sxs-lookup"><span data-stu-id="35f7e-171">The creation of the composite image and cancellation of the operation are initiated from the **Choose Folder** and **Cancel** buttons.</span></span> <span data-ttu-id="35f7e-172">Gdy użytkownik wybierze jeden z tych przycisków, odpowiednia akcja zostanie zainicjowana w sposób asynchroniczny.</span><span class="sxs-lookup"><span data-stu-id="35f7e-172">When the user chooses either of these buttons, the appropriate action is initiated in an asynchronous manner.</span></span>  
  
### <a name="to-connect-the-dataflow-network-to-the-user-interface"></a><span data-ttu-id="35f7e-173">Aby połączyć sieć przepływu danych z interfejsem użytkownika</span><span class="sxs-lookup"><span data-stu-id="35f7e-173">To Connect the Dataflow Network to the User Interface</span></span>  
  
1. <span data-ttu-id="35f7e-174">W projektancie formularzy dla formularza głównego Utwórz procedurę obsługi <xref:System.Windows.Forms.ToolStripItem.Click> zdarzeń dla zdarzenia dla przycisku **Wybierz folder** .</span><span class="sxs-lookup"><span data-stu-id="35f7e-174">On the form designer for the main form, create an event handler for the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Choose Folder** button.</span></span>  
  
2. <span data-ttu-id="35f7e-175">Zaimplementuj zdarzenie dla przycisku **Wybierz folder.** <xref:System.Windows.Forms.ToolStripItem.Click></span><span class="sxs-lookup"><span data-stu-id="35f7e-175">Implement the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Choose Folder** button.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#6](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#6)]  
  
3. <span data-ttu-id="35f7e-176">W projektancie formularzy dla formularza głównego Utwórz procedurę obsługi <xref:System.Windows.Forms.ToolStripItem.Click> zdarzeń dla zdarzenia dla przycisku **Anuluj** .</span><span class="sxs-lookup"><span data-stu-id="35f7e-176">On the form designer for the main form, create an event handler for the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Cancel** button.</span></span>  
  
4. <span data-ttu-id="35f7e-177">Zaimplementuj zdarzenie dla przycisku **Anuluj.** <xref:System.Windows.Forms.ToolStripItem.Click></span><span class="sxs-lookup"><span data-stu-id="35f7e-177">Implement the <xref:System.Windows.Forms.ToolStripItem.Click> event for the **Cancel** button.</span></span>  
  
     [!code-csharp[TPLDataflow_CompositeImages#7](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#7)]  
  
<a name="complete"></a>   
## <a name="the-complete-example"></a><span data-ttu-id="35f7e-178">Kompletny przykład</span><span class="sxs-lookup"><span data-stu-id="35f7e-178">The Complete Example</span></span>  
 <span data-ttu-id="35f7e-179">Poniższy przykład pokazuje kompletny kod dla tego przewodnika.</span><span class="sxs-lookup"><span data-stu-id="35f7e-179">The following example shows the complete code for this walkthrough.</span></span>  
  
 [!code-csharp[TPLDataflow_CompositeImages#100](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_compositeimages/cs/compositeimages/form1.cs#100)]  
  
 <span data-ttu-id="35f7e-180">Na poniższej ilustracji przedstawiono typowe dane wyjściowe folderu Common \Sample obrazy \ folder.</span><span class="sxs-lookup"><span data-stu-id="35f7e-180">The following illustration shows typical output for the common \Sample Pictures\ folder.</span></span>  
  
 <span data-ttu-id="35f7e-181">![Aplikacja Windows Forms](../../../docs/standard/parallel-programming/media/tpldataflow-compositeimages.gif "TPLDataflow_CompositeImages")</span><span class="sxs-lookup"><span data-stu-id="35f7e-181">![The Windows Forms Application](../../../docs/standard/parallel-programming/media/tpldataflow-compositeimages.gif "TPLDataflow_CompositeImages")</span></span>  

## <a name="see-also"></a><span data-ttu-id="35f7e-182">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="35f7e-182">See also</span></span>

- [<span data-ttu-id="35f7e-183">Przepływ danych</span><span class="sxs-lookup"><span data-stu-id="35f7e-183">Dataflow</span></span>](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)
