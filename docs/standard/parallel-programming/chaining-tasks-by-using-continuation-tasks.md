---
title: Tworzenie łańcuchów zadań przy użyciu zadań kontynuacji
description: Dowiedz się więcej o zadaniach łańcucha przy użyciu zadań kontynuacji w programie .NET. Zadanie kontynuacji to asynchroniczne zadanie, które jest wywoływane przez inne zadanie.
ms.date: 07/20/2020
dev_langs:
- csharp
- vb
helpviewer_keywords:
- tasks, continuations
ms.assetid: 0b45e9a2-de28-46ce-8212-1817280ed42d
ms.openlocfilehash: c7afbc1bb22a1743aed8e4ebd0a06c4f3fb57e86
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/18/2020
ms.locfileid: "94830613"
---
# <a name="chaining-tasks-using-continuation-tasks"></a><span data-ttu-id="c6aa2-104">Tworzenie łańcuchów zadań przy użyciu zadań kontynuacji</span><span class="sxs-lookup"><span data-stu-id="c6aa2-104">Chaining tasks using continuation tasks</span></span>

<span data-ttu-id="c6aa2-105">W programowaniu asynchronicznym, jest to typowe dla jednej operacji asynchronicznej po zakończeniu, aby wywołać drugą operację.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-105">In asynchronous programming, it's common for one asynchronous operation, on completion, to invoke a second operation.</span></span> <span data-ttu-id="c6aa2-106">Kontynuacje umożliwiają decedent operacji na korzystanie z wyników pierwszej operacji.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-106">Continuations allow decedent operations to consume the results of the first operation.</span></span> <span data-ttu-id="c6aa2-107">Tradycyjnie, kontynuacje zostały wykonane przy użyciu metod wywołania zwrotnego.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-107">Traditionally, continuations have been done by using callback methods.</span></span> <span data-ttu-id="c6aa2-108">W bibliotece zadań równoległych te same funkcje są udostępniane przez _zadania kontynuacji_.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-108">In the Task Parallel Library, the same functionality is provided by _continuation tasks_.</span></span> <span data-ttu-id="c6aa2-109">Zadanie kontynuacji (znane również jako kontynuacja) to asynchroniczne zadanie, które jest wywoływane przez inne zadanie, znane jako _poprzedzające_, po zakończeniu poprzedzającego.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-109">A continuation task (also known just as a continuation) is an asynchronous task that's invoked by another task, known as the _antecedent_, when the antecedent finishes.</span></span>

<span data-ttu-id="c6aa2-110">Kontynuacje są stosunkowo łatwe w użyciu, ale są jednak zaawansowane i elastyczne.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-110">Continuations are relatively easy to use, but are nevertheless powerful and flexible.</span></span> <span data-ttu-id="c6aa2-111">Możesz na przykład:</span><span class="sxs-lookup"><span data-stu-id="c6aa2-111">For example, you can:</span></span>

- <span data-ttu-id="c6aa2-112">Przekaż dane z Antecedent do kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-112">Pass data from the antecedent to the continuation.</span></span>
- <span data-ttu-id="c6aa2-113">Określ dokładne warunki, w których kontynuacja zostanie wywołana lub nie zostanie wywołana.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-113">Specify the precise conditions under which the continuation will be invoked or not invoked.</span></span>
- <span data-ttu-id="c6aa2-114">Anuluj kontynuację albo przed jej rozpoczęciem albo w trakcie jej działania.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-114">Cancel a continuation either before it starts or cooperatively as it is running.</span></span>
- <span data-ttu-id="c6aa2-115">Podaj wskazówki dotyczące sposobu, w jaki kontynuacja powinna zostać zaplanowana.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-115">Provide hints about how the continuation should be scheduled.</span></span>
- <span data-ttu-id="c6aa2-116">Wywoływanie wielu kontynuacji z tego samego poprzedzającego.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-116">Invoke multiple continuations from the same antecedent.</span></span>
- <span data-ttu-id="c6aa2-117">Wywołanie jednej kontynuacji po ukończeniu wszystkich lub dowolnego jednego z wielu poprzedników.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-117">Invoke one continuation when all or any one of multiple antecedents complete.</span></span>
- <span data-ttu-id="c6aa2-118">Łańcuch uzupełnia jeden po drugim do dowolnej dowolnej długości.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-118">Chain continuations one after another to any arbitrary length.</span></span>
- <span data-ttu-id="c6aa2-119">Użyj kontynuacji, aby obsłużyć wyjątki generowane przez poprzedzające.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-119">Use a continuation to handle exceptions thrown by the antecedent.</span></span>

## <a name="about-continuations"></a><span data-ttu-id="c6aa2-120">Informacje o kontynuacji</span><span class="sxs-lookup"><span data-stu-id="c6aa2-120">About continuations</span></span>

<span data-ttu-id="c6aa2-121">Kontynuacja to zadanie, które jest tworzone w <xref:System.Threading.Tasks.TaskStatus.WaitingForActivation> stanie.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-121">A continuation is a task that is created in the <xref:System.Threading.Tasks.TaskStatus.WaitingForActivation> state.</span></span> <span data-ttu-id="c6aa2-122">Jest uaktywniana automatycznie po ukończeniu zadania lub zadania poprzedzającego.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-122">It is activated automatically when its antecedent task or tasks complete.</span></span> <span data-ttu-id="c6aa2-123">Wywołanie <xref:System.Threading.Tasks.Task.Start%2A?displayProperty=nameWithType> kontynuacji w kodzie użytkownika zgłasza <xref:System.InvalidOperationException?displayProperty=nameWithType> wyjątek.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-123">Calling <xref:System.Threading.Tasks.Task.Start%2A?displayProperty=nameWithType> on a continuation in user code throws an <xref:System.InvalidOperationException?displayProperty=nameWithType> exception.</span></span>

<span data-ttu-id="c6aa2-124">Kontynuacja jest sama <xref:System.Threading.Tasks.Task> i nie blokuje wątku, w którym jest uruchomiona.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-124">A continuation is itself a <xref:System.Threading.Tasks.Task> and does not block the thread on which it is started.</span></span> <span data-ttu-id="c6aa2-125">Wywołaj <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> metodę, aby zablokować do momentu zakończenia zadania kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-125">Call the <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> method to block until the continuation task finishes.</span></span>

## <a name="create-a-continuation-for-a-single-antecedent"></a><span data-ttu-id="c6aa2-126">Tworzenie kontynuacji dla pojedynczego poprzedzającego</span><span class="sxs-lookup"><span data-stu-id="c6aa2-126">Create a continuation for a single antecedent</span></span>

<span data-ttu-id="c6aa2-127">Należy utworzyć kontynuację, która jest wykonywana po zakończeniu poprzedzającego, wywołując <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> metodę.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-127">You create a continuation that executes when its antecedent has completed by calling the <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="c6aa2-128">W poniższym przykładzie pokazano wzorzec podstawowy (dla jasności, obsługa wyjątków jest pomijana).</span><span class="sxs-lookup"><span data-stu-id="c6aa2-128">The following example shows the basic pattern (for clarity, exception handling is omitted).</span></span> <span data-ttu-id="c6aa2-129">Wykonuje zadanie poprzedzające, `taskA` która zwraca <xref:System.DayOfWeek> obiekt, który wskazuje nazwę bieżącego dnia tygodnia.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-129">It executes an antecedent task, `taskA`, that returns a <xref:System.DayOfWeek> object that indicates the name of the current day of the week.</span></span> <span data-ttu-id="c6aa2-130">Po ukończeniu poprzedzającego, zadanie kontynuacji, `continuation` ,,, jest przenoszone poprzedzające i wyświetla ciąg, który zawiera jego wynik.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-130">When the antecedent completes, the continuation task, `continuation`, is passed the antecedent and displays a string that includes its result.</span></span>

> [!NOTE]
> <span data-ttu-id="c6aa2-131">Przykłady w języku C# w tym artykule używają `async` modyfikatora `Main` metody.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-131">The C# samples in this article make use of the `async` modifier on the `Main` method.</span></span> <span data-ttu-id="c6aa2-132">Ta funkcja jest dostępna w języku C# 7,1 i nowszych.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-132">That feature is available in C# 7.1 and later.</span></span> <span data-ttu-id="c6aa2-133">Poprzednie wersje generują [`CS5001`](../../csharp/misc/cs5001.md) podczas kompilowania tego przykładowego kodu.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-133">Previous versions generate [`CS5001`](../../csharp/misc/cs5001.md) when compiling this sample code.</span></span> <span data-ttu-id="c6aa2-134">Należy ustawić wersję językową na C# 7,1 lub nowszą.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-134">You'll need to set the language version to C# 7.1 or newer.</span></span> <span data-ttu-id="c6aa2-135">Możesz dowiedzieć się, jak skonfigurować wersję języka w artykule dotyczącym [konfigurowania wersji językowej](../../csharp/language-reference/configure-language-version.md).</span><span class="sxs-lookup"><span data-stu-id="c6aa2-135">You can learn how to configure the language version in the article on [configure language version](../../csharp/language-reference/configure-language-version.md).</span></span>

:::code language="csharp" source="snippets/cs/simple1.cs":::

[!code-vb[TPL_Continuations#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/simple1.vb#1)]

## <a name="create-a-continuation-for-multiple-antecedents"></a><span data-ttu-id="c6aa2-136">Tworzenie kontynuacji dla wielu poprzedzających</span><span class="sxs-lookup"><span data-stu-id="c6aa2-136">Create a continuation for multiple antecedents</span></span>

<span data-ttu-id="c6aa2-137">Możesz również utworzyć kontynuację, która będzie uruchamiana po zakończeniu dowolnej lub wszystkich grup zadań.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-137">You can also create a continuation that will run when any or all of a group of tasks has completed.</span></span> <span data-ttu-id="c6aa2-138">Aby wykonać kontynuację po zakończeniu wszystkich zadań poprzedzających, należy wywołać metodę static ( `Shared` in Visual Basic) <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> lub <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A?displayProperty=nameWithType> metodę wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-138">To execute a continuation when all antecedent tasks have completed, you call the static (`Shared` in Visual Basic) <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> method or the instance <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="c6aa2-139">Aby wykonać kontynuację, gdy którekolwiek z zadań poprzedzających zostało zakończone, należy wywołać metodę static ( `Shared` in Visual Basic) <xref:System.Threading.Tasks.Task.WhenAny%2A?displayProperty=nameWithType> lub metodę wystąpienia <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAny%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="c6aa2-139">To execute a continuation when any of the antecedent tasks has completed, you call the static (`Shared` in Visual Basic) <xref:System.Threading.Tasks.Task.WhenAny%2A?displayProperty=nameWithType> method or the instance <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAny%2A?displayProperty=nameWithType> method.</span></span>

<span data-ttu-id="c6aa2-140">Wywołania <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> i <xref:System.Threading.Tasks.Task.WhenAny%2A?displayProperty=nameWithType> przeciążenia nie blokują wątku wywołującego.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-140">Calls to the <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Task.WhenAny%2A?displayProperty=nameWithType> overloads do not block the calling thread.</span></span> <span data-ttu-id="c6aa2-141">Jednak zazwyczaj wywołują wszystkie metody, ale <xref:System.Threading.Tasks.Task.WhenAll%28System.Collections.Generic.IEnumerable%7BSystem.Threading.Tasks.Task%7D%29?displayProperty=nameWithType> i, <xref:System.Threading.Tasks.Task.WhenAll%28System.Threading.Tasks.Task%5B%5D%29?displayProperty=nameWithType> Aby pobrać zwracaną <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> Właściwość, która blokuje wątek wywołujący.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-141">However, you typically call all but the <xref:System.Threading.Tasks.Task.WhenAll%28System.Collections.Generic.IEnumerable%7BSystem.Threading.Tasks.Task%7D%29?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Task.WhenAll%28System.Threading.Tasks.Task%5B%5D%29?displayProperty=nameWithType> methods to retrieve the returned <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property, which does block the calling thread.</span></span>

<span data-ttu-id="c6aa2-142">Poniższy przykład wywołuje <xref:System.Threading.Tasks.Task.WhenAll%28System.Collections.Generic.IEnumerable%7BSystem.Threading.Tasks.Task%7D%29?displayProperty=nameWithType> metodę w celu utworzenia zadania kontynuacji, które odzwierciedla wyniki jego 10 poprzedzających zadań.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-142">The following example calls the <xref:System.Threading.Tasks.Task.WhenAll%28System.Collections.Generic.IEnumerable%7BSystem.Threading.Tasks.Task%7D%29?displayProperty=nameWithType> method to create a continuation task that reflects the results of its 10 antecedent tasks.</span></span> <span data-ttu-id="c6aa2-143">Każde zadanie poprzedzające ma wartość indeksu, która należy do zakresu od 1 do 10.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-143">Each antecedent task squares an index value that ranges from one to 10.</span></span> <span data-ttu-id="c6aa2-144">Jeśli poprzedzające pomyślne zakończenie (ich <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> Właściwość to <xref:System.Threading.Tasks.TaskStatus.RanToCompletion?displayProperty=nameWithType> ), <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> Właściwość kontynuacji jest tablicą <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> wartości zwracanych przez każde poprzedzające.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-144">If the antecedents complete successfully (their <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> property is <xref:System.Threading.Tasks.TaskStatus.RanToCompletion?displayProperty=nameWithType>), the <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property of the continuation is an array of the <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> values returned by each antecedent.</span></span> <span data-ttu-id="c6aa2-145">Przykład dodaje je do obliczenia sumy kwadratów dla wszystkich liczb z zakresu od 1 do 10.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-145">The example adds them to compute the sum of squares for all numbers between one and 10.</span></span>

:::code language="csharp" source="snippets/cs/whenall1.cs":::

[!code-vb[TPL_Continuations#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/whenall1.vb#5)]

## <a name="continuation-options"></a><span data-ttu-id="c6aa2-146">Opcje kontynuacji</span><span class="sxs-lookup"><span data-stu-id="c6aa2-146">Continuation options</span></span>

<span data-ttu-id="c6aa2-147">Podczas tworzenia kontynuacji pojedynczego zadania można użyć <xref:System.Threading.Tasks.Task.ContinueWith%2A> przeciążenia, które przyjmuje <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> wartość wyliczenia, aby określić warunki, pod którymi rozpocznie się kontynuacja.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-147">When you create a single-task continuation, you can use a <xref:System.Threading.Tasks.Task.ContinueWith%2A> overload that takes a <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> enumeration value to specify the conditions under which the continuation starts.</span></span> <span data-ttu-id="c6aa2-148">Na przykład można określić, że kontynuacja ma być uruchamiana tylko wtedy, gdy poprzednik zostanie zakończony pomyślnie, lub tylko wtedy, gdy zostanie zakończony w stanie awarii.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-148">For example, you can specify that the continuation is to run only if the antecedent completes successfully, or only if it completes in a faulted state.</span></span> <span data-ttu-id="c6aa2-149">Jeśli warunek nie ma wartości true, gdy poprzedzający jest gotowy do wywołania kontynuacji, kontynuacja przechodzi bezpośrednio do <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> stanu, a następnie nie można jej uruchomić.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-149">If the condition is not true when the antecedent is ready to invoke the continuation, the continuation transitions directly to the <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> state and subsequently cannot be started.</span></span>

<span data-ttu-id="c6aa2-150">Szereg metod kontynuacji wielu zadań, takich jak przeciążenia <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A?displayProperty=nameWithType> metody, również zawierają <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> parametr.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-150">A number of multi-task continuation methods, such as overloads of the <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A?displayProperty=nameWithType> method, also include a <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> parameter.</span></span> <span data-ttu-id="c6aa2-151">Jednak tylko podzbiór wszystkich <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> elementów członkowskich wyliczenia jest prawidłowy.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-151">Only a subset of all <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> enumeration members are valid, however.</span></span> <span data-ttu-id="c6aa2-152">Można określić <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> wartości, które mają odpowiedniki w <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=nameWithType> wyliczeniu, takie jak <xref:System.Threading.Tasks.TaskContinuationOptions.AttachedToParent?displayProperty=nameWithType> , <xref:System.Threading.Tasks.TaskContinuationOptions.LongRunning?displayProperty=nameWithType> , i <xref:System.Threading.Tasks.TaskContinuationOptions.PreferFairness?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="c6aa2-152">You can specify <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> values that have counterparts in the <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=nameWithType> enumeration, such as <xref:System.Threading.Tasks.TaskContinuationOptions.AttachedToParent?displayProperty=nameWithType>, <xref:System.Threading.Tasks.TaskContinuationOptions.LongRunning?displayProperty=nameWithType>, and <xref:System.Threading.Tasks.TaskContinuationOptions.PreferFairness?displayProperty=nameWithType>.</span></span> <span data-ttu-id="c6aa2-153">W przypadku określenia dowolnej `NotOn` `OnlyOn` opcji lub z kontynuacją wielozadania <xref:System.ArgumentOutOfRangeException> zostanie zgłoszony wyjątek w czasie wykonywania.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-153">If you specify any of the `NotOn` or `OnlyOn` options with a multi-task continuation, an <xref:System.ArgumentOutOfRangeException> exception will be thrown at run time.</span></span>

<span data-ttu-id="c6aa2-154">Więcej informacji o opcjach kontynuacji zadania znajduje się w <xref:System.Threading.Tasks.TaskContinuationOptions> temacie.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-154">For more information on task continuation options, see the <xref:System.Threading.Tasks.TaskContinuationOptions> topic.</span></span>

## <a name="pass-data-to-a-continuation"></a><span data-ttu-id="c6aa2-155">Przekazywanie danych do kontynuacji</span><span class="sxs-lookup"><span data-stu-id="c6aa2-155">Pass data to a continuation</span></span>

<span data-ttu-id="c6aa2-156"><xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType>Metoda przekazuje odwołanie do delegata użytkownika kontynuacji jako argument.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-156">The <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> method passes a reference to the antecedent to the user delegate of the continuation as an argument.</span></span> <span data-ttu-id="c6aa2-157">Jeśli antecedent jest <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType> obiektem, a zadanie zostało uruchomione, dopóki nie zostało ukończone, kontynuacja może uzyskać dostęp do <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> właściwości zadania.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-157">If the antecedent is a <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType> object, and the task ran until it was completed, then the continuation can access the <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property of the task.</span></span>

<span data-ttu-id="c6aa2-158"><xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType>Właściwość blokuje się do momentu ukończenia zadania.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-158">The <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property blocks until the task has completed.</span></span> <span data-ttu-id="c6aa2-159">Jeśli jednak zadanie zostało anulowane lub wystąpił błąd, próba uzyskania dostępu do <xref:System.Threading.Tasks.Task%601.Result%2A> właściwości zgłasza <xref:System.AggregateException> wyjątek.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-159">However, if the task was canceled or faulted, attempting to access the <xref:System.Threading.Tasks.Task%601.Result%2A> property throws an <xref:System.AggregateException> exception.</span></span> <span data-ttu-id="c6aa2-160">Można uniknąć tego problemu, korzystając z <xref:System.Threading.Tasks.TaskContinuationOptions.OnlyOnRanToCompletion> opcji, jak pokazano w poniższym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-160">You can avoid this problem by using the <xref:System.Threading.Tasks.TaskContinuationOptions.OnlyOnRanToCompletion> option, as shown in the following example.</span></span>

:::code language="csharp" source="snippets/cs/result1.cs":::

[!code-vb[TPL_Continuations#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/result1.vb#2)]

<span data-ttu-id="c6aa2-161">Jeśli chcesz, aby kontynuacja była uruchamiana, nawet jeśli poprzednik nie został uruchomiony w celu pomyślnego ukończenia, należy zabezpieczyć wyjątek.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-161">If you want the continuation to run even if the antecedent did not run to successful completion, you must guard against the exception.</span></span> <span data-ttu-id="c6aa2-162">Jednym z metod jest przetestowanie <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> Właściwości poprzedzającego i próba uzyskania dostępu do właściwości tylko <xref:System.Threading.Tasks.Task%601.Result%2A> wtedy, gdy stanem jest nie <xref:System.Threading.Tasks.TaskStatus.Faulted> lub <xref:System.Threading.Tasks.TaskStatus.Canceled> .</span><span class="sxs-lookup"><span data-stu-id="c6aa2-162">One approach is to test the <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> property of the antecedent, and only attempt to access the <xref:System.Threading.Tasks.Task%601.Result%2A> property if the status is not <xref:System.Threading.Tasks.TaskStatus.Faulted> or <xref:System.Threading.Tasks.TaskStatus.Canceled>.</span></span> <span data-ttu-id="c6aa2-163">Można również przeanalizować <xref:System.Threading.Tasks.Task.Exception%2A> Właściwość poprzedzającą.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-163">You can also examine the <xref:System.Threading.Tasks.Task.Exception%2A> property of the antecedent.</span></span> <span data-ttu-id="c6aa2-164">Aby uzyskać więcej informacji, zobacz [Obsługa wyjątków](exception-handling-task-parallel-library.md).</span><span class="sxs-lookup"><span data-stu-id="c6aa2-164">For more information, see [Exception Handling](exception-handling-task-parallel-library.md).</span></span> <span data-ttu-id="c6aa2-165">Poniższy przykład modyfikuje poprzedni przykład, aby uzyskać dostęp do <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> Właściwości antecedent tylko wtedy, gdy jego stan to <xref:System.Threading.Tasks.TaskStatus.RanToCompletion?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="c6aa2-165">The following example modifies the previous example to access antecedent's <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property only if its status is <xref:System.Threading.Tasks.TaskStatus.RanToCompletion?displayProperty=nameWithType>.</span></span>

:::code language="csharp" source="snippets/cs/result2.cs":::

[!code-vb[TPL_Continuations#7](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/result2.vb#7)]

## <a name="cancel-a-continuation"></a><span data-ttu-id="c6aa2-166">Anuluj kontynuację</span><span class="sxs-lookup"><span data-stu-id="c6aa2-166">Cancel a continuation</span></span>

<span data-ttu-id="c6aa2-167"><xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType>Właściwość kontynuacji jest ustawiana na <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> w następujących sytuacjach:</span><span class="sxs-lookup"><span data-stu-id="c6aa2-167">The <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> property of a continuation is set to <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> in the following situations:</span></span>

- <span data-ttu-id="c6aa2-168">Zgłasza <xref:System.OperationCanceledException> wyjątek w odpowiedzi na żądanie anulowania.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-168">It throws an <xref:System.OperationCanceledException> exception in response to a cancellation request.</span></span> <span data-ttu-id="c6aa2-169">Podobnie jak w przypadku każdego zadania, jeśli wyjątek zawiera ten sam token, który został przekazano do kontynuacji, jest traktowany jako potwierdzenie anulowania spółdzielni.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-169">As with any task, if the exception contains the same token that was passed to the continuation, it is treated as an acknowledgment of cooperative cancellation.</span></span>
- <span data-ttu-id="c6aa2-170">Kontynuacja jest przenoszona, <xref:System.Threading.CancellationToken?displayProperty=nameWithType> której <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> Właściwość jest `true` .</span><span class="sxs-lookup"><span data-stu-id="c6aa2-170">The continuation is passed a <xref:System.Threading.CancellationToken?displayProperty=nameWithType> whose <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> property is `true`.</span></span> <span data-ttu-id="c6aa2-171">W takim przypadku kontynuacja nie zostanie uruchomiona i przechodzi do <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> stanu.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-171">In this case, the continuation does not start, and it transitions to the <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> state.</span></span>
- <span data-ttu-id="c6aa2-172">Kontynuacja nigdy nie działa, ponieważ warunek ustawiony przez jego <xref:System.Threading.Tasks.TaskContinuationOptions> argument nie został spełniony.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-172">The continuation never runs because the condition set by its <xref:System.Threading.Tasks.TaskContinuationOptions> argument was not met.</span></span> <span data-ttu-id="c6aa2-173">Na przykład jeśli poprzednika przejdzie do <xref:System.Threading.Tasks.TaskStatus.Faulted?displayProperty=nameWithType> stanu, jego kontynuacja, która została przeniesiona, <xref:System.Threading.Tasks.TaskContinuationOptions.NotOnFaulted?displayProperty=nameWithType> nie zostanie uruchomiona, ale przejdzie do <xref:System.Threading.Tasks.TaskStatus.Canceled> stanu.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-173">For example, if an antecedent goes into a <xref:System.Threading.Tasks.TaskStatus.Faulted?displayProperty=nameWithType> state, its continuation that was passed the <xref:System.Threading.Tasks.TaskContinuationOptions.NotOnFaulted?displayProperty=nameWithType> option will not run but will transition to the <xref:System.Threading.Tasks.TaskStatus.Canceled> state.</span></span>

<span data-ttu-id="c6aa2-174">Jeśli zadanie i jego kontynuacja reprezentują dwie części tej samej operacji logicznej, można przekazać ten sam token anulowania do obu zadań, jak pokazano w poniższym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-174">If a task and its continuation represent two parts of the same logical operation, you can pass the same cancellation token to both tasks, as shown in the following example.</span></span> <span data-ttu-id="c6aa2-175">Składa się z poprzedzającego, który generuje listę liczb całkowitych, które są podzielne przez 33, które przechodzi do kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-175">It consists of an antecedent that generates a list of integers that are divisible by 33, which it passes to the continuation.</span></span> <span data-ttu-id="c6aa2-176">Kontynuacja z kolei wyświetla listę.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-176">The continuation in turn displays the list.</span></span> <span data-ttu-id="c6aa2-177">Zarówno poprzednik, jak i kontynuacja są regularnie wstrzymywane w przypadku losowych interwałów.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-177">Both the antecedent and the continuation pause regularly for random intervals.</span></span> <span data-ttu-id="c6aa2-178">Ponadto <xref:System.Threading.Timer?displayProperty=nameWithType> obiekt jest używany do wykonywania `Elapsed` metody po pięciu sekundowym przedziale czasu.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-178">In addition, a <xref:System.Threading.Timer?displayProperty=nameWithType> object is used to execute the `Elapsed` method after a five-second timeout interval.</span></span> <span data-ttu-id="c6aa2-179">Ten przykład wywołuje <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> metodę, która powoduje wywoływanie metody przez aktualnie wykonywane zadanie <xref:System.Threading.CancellationToken.ThrowIfCancellationRequested%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="c6aa2-179">This example calls the <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> method, which causes the currently executing task to call the <xref:System.Threading.CancellationToken.ThrowIfCancellationRequested%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="c6aa2-180">Określa, czy <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> Metoda jest wywoływana, gdy jest wykonywane poprzedzające lub kontynuacja, zależy od czasu trwania losowo generowanych przerw.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-180">Whether the <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> method is called when the antecedent or its continuation is executing depends on the duration of the randomly generated pauses.</span></span> <span data-ttu-id="c6aa2-181">Jeśli poprzednik zostanie anulowany, kontynuacja nie zostanie uruchomiona.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-181">If the antecedent is canceled, the continuation will not start.</span></span> <span data-ttu-id="c6aa2-182">Jeśli poprzedzające nie zostało anulowane, token nadal może być używany do anulowania kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-182">If the antecedent is not canceled, the token can still be used to cancel the continuation.</span></span>

:::code language="csharp" source="snippets/cs/cancellation1.cs":::

[!code-vb[TPL_Continuations#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/cancellation1.vb#3)]

<span data-ttu-id="c6aa2-183">Można również uniemożliwić kontynuowanie wykonywania, jeśli jego poprzednik zostanie anulowany bez podawania kontynuacji tokenu anulowania przez określenie <xref:System.Threading.Tasks.TaskContinuationOptions.NotOnCanceled?displayProperty=nameWithType> opcji podczas tworzenia kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-183">You can also prevent a continuation from executing if its antecedent is canceled without supplying the continuation a cancellation token by specifying the <xref:System.Threading.Tasks.TaskContinuationOptions.NotOnCanceled?displayProperty=nameWithType> option when you create the continuation.</span></span> <span data-ttu-id="c6aa2-184">Poniżej przedstawiono prosty przykład.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-184">The following is a simple example.</span></span>

:::code language="csharp" source="snippets/cs/cancellation2.cs":::

[!code-vb[TPL_Continuations#8](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/cancellation2.vb#8)]

<span data-ttu-id="c6aa2-185">Gdy kontynuacja przechodzi do <xref:System.Threading.Tasks.TaskStatus.Canceled> stanu, może to mieć wpływ na kontynuacje, które są następujące, w zależności od <xref:System.Threading.Tasks.TaskContinuationOptions> tego, który został określony dla tych kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-185">After a continuation goes into the <xref:System.Threading.Tasks.TaskStatus.Canceled> state, it may affect continuations that follow, depending on the <xref:System.Threading.Tasks.TaskContinuationOptions> that were specified for those continuations.</span></span>

<span data-ttu-id="c6aa2-186">Kontynuacje, które zostały zlikwidowane, nie zostaną uruchomione.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-186">Continuations that are disposed will not start.</span></span>

## <a name="continuations-and-child-tasks"></a><span data-ttu-id="c6aa2-187">Kontynuacje i zadania podrzędne</span><span class="sxs-lookup"><span data-stu-id="c6aa2-187">Continuations and child tasks</span></span>

<span data-ttu-id="c6aa2-188">Kontynuacja nie działa do momentu ukończenia poprzedzających i wszystkich dołączonych zadań podrzędnych.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-188">A continuation does not run until the antecedent and all of its attached child tasks have completed.</span></span> <span data-ttu-id="c6aa2-189">Kontynuacja nie czeka na zakończenie odłączonych zadań podrzędnych.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-189">The continuation does not wait for detached child tasks to finish.</span></span> <span data-ttu-id="c6aa2-190">Poniższe dwa przykłady ilustrują zadania podrzędne, które są dołączone do i odłączane od poprzedzającego, który tworzy kontynuację.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-190">The following two examples illustrate child tasks that are attached to and detached from an antecedent that creates a continuation.</span></span> <span data-ttu-id="c6aa2-191">W poniższym przykładzie kontynuacja jest uruchamiana tylko po wykonaniu wszystkich zadań podrzędnych, a wielokrotne uruchomienie tego przykładu da identyczne dane wyjściowe.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-191">In the following example, the continuation runs only after all child tasks have completed, and running the example multiple times produces identical output each time.</span></span> <span data-ttu-id="c6aa2-192">W przykładzie jest uruchamiany poprzedzający przez wywołanie <xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=nameWithType> metody, ponieważ domyślnie <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType> Metoda tworzy zadanie nadrzędne, którego domyślna opcja tworzenia zadań to <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="c6aa2-192">The example launches the antecedent by calling the <xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=nameWithType> method, since by default the <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType> method creates a parent task whose default task creation option is <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType>.</span></span>

:::code language="csharp" source="snippets/cs/attached1.cs":::

[!code-vb[TPL_Continuations#9](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/attached1.vb#9)]

<span data-ttu-id="c6aa2-193">Jeśli zadania podrzędne są odłączone od poprzedzającego, jednak kontynuacja jest uruchamiana zaraz po zakończonym poprzedniku, niezależnie od stanu zadań podrzędnych.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-193">If child tasks are detached from the antecedent, however, the continuation runs as soon as the antecedent has terminated, regardless of the state of the child tasks.</span></span> <span data-ttu-id="c6aa2-194">W związku z tym wiele przebiegów poniższego przykładu może generować zmienne dane wyjściowe, które są zależne od tego, jak harmonogram zadań obsłużył każde zadanie podrzędne.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-194">As a result, multiple runs of the following example can produce variable output that depends on how the task scheduler handled each child task.</span></span>

:::code language="csharp" source="snippets/cs/detached1.cs":::

[!code-vb[TPL_Continuations#10](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/detached1.vb#10)]

<span data-ttu-id="c6aa2-195">Końcowy stan zadania poprzedzającego zależy od końcowego stanu wszystkich dołączonych zadań podrzędnych.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-195">The final status of the antecedent task depends on the final status of any attached child tasks.</span></span> <span data-ttu-id="c6aa2-196">Stan odłączonych zadań podrzędnych nie ma wpływu na element nadrzędny.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-196">The status of detached child tasks does not affect the parent.</span></span> <span data-ttu-id="c6aa2-197">Aby uzyskać więcej informacji, zobacz [dołączone i odłączone zadania podrzędne](attached-and-detached-child-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="c6aa2-197">For more information, see [Attached and Detached Child Tasks](attached-and-detached-child-tasks.md).</span></span>

## <a name="associate-state-with-continuations"></a><span data-ttu-id="c6aa2-198">Skojarz stan z kontynuacjami</span><span class="sxs-lookup"><span data-stu-id="c6aa2-198">Associate state with continuations</span></span>

<span data-ttu-id="c6aa2-199">Możliwe jest skojarzenie dowolnego stanu z kontynuacją zadania.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-199">You can associate arbitrary state with a task continuation.</span></span> <span data-ttu-id="c6aa2-200"><xref:System.Threading.Tasks.Task.ContinueWith%2A>Metoda zapewnia przeciążone wersje, które będą miały <xref:System.Object> wartość reprezentującą stan kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-200">The <xref:System.Threading.Tasks.Task.ContinueWith%2A> method provides overloaded versions that each take an <xref:System.Object> value that represents the state of the continuation.</span></span> <span data-ttu-id="c6aa2-201">Możesz później uzyskać dostęp do tego obiektu stanu przy użyciu <xref:System.Threading.Tasks.Task.AsyncState%2A?displayProperty=nameWithType> właściwości.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-201">You can later access this state object by using the <xref:System.Threading.Tasks.Task.AsyncState%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="c6aa2-202">Ten obiekt stanu jest `null` nieprawidłowy, jeśli nie podasz wartości.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-202">This state object is `null` if you do not provide a value.</span></span>

<span data-ttu-id="c6aa2-203">Stan kontynuacji jest przydatny podczas konwertowania istniejącego kodu, który używa [modelu programowania asynchronicznego (APM)](../asynchronous-programming-patterns/asynchronous-programming-model-apm.md) do korzystania z TPL.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-203">Continuation state is useful when you convert existing code that uses the [Asynchronous Programming Model (APM)](../asynchronous-programming-patterns/asynchronous-programming-model-apm.md) to use the TPL.</span></span> <span data-ttu-id="c6aa2-204">W programie APM zazwyczaj jest używany stan obiektu w metodzie **BEGIN**_Method_ i później uzyskuje się dostęp do tego stanu przy użyciu <xref:System.IAsyncResult.AsyncState%2A?displayProperty=nameWithType> właściwości.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-204">In the APM, you typically provide object state in the **Begin**_Method_ method and later access that state by using the <xref:System.IAsyncResult.AsyncState%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="c6aa2-205">Za pomocą <xref:System.Threading.Tasks.Task.ContinueWith%2A> metody, można zachować ten stan podczas konwertowania kodu, który używa APM do użycia TPL.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-205">By using the <xref:System.Threading.Tasks.Task.ContinueWith%2A> method, you can preserve this state when you convert code that uses the APM to use the TPL.</span></span>

<span data-ttu-id="c6aa2-206">Stan kontynuacji może być również przydatny podczas pracy z <xref:System.Threading.Tasks.Task> obiektami w debugerze programu Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-206">Continuation state can also be useful when you work with <xref:System.Threading.Tasks.Task> objects in the Visual Studio debugger.</span></span> <span data-ttu-id="c6aa2-207">Na przykład w oknie **zadania równoległe** w kolumnie **zadanie** jest wyświetlany ciąg reprezentujący obiekt stanu dla każdego zadania.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-207">For example, in the **Parallel Tasks** window, the **Task** column displays the string representation of the state object for each task.</span></span> <span data-ttu-id="c6aa2-208">Aby uzyskać więcej informacji o oknie **zadań równoległych** , zobacz [Korzystanie z okna zadań](/visualstudio/debugger/using-the-tasks-window).</span><span class="sxs-lookup"><span data-stu-id="c6aa2-208">For more information about the **Parallel Tasks** window, see [Using the Tasks Window](/visualstudio/debugger/using-the-tasks-window).</span></span>

<span data-ttu-id="c6aa2-209">Poniższy przykład pokazuje, jak używać stanu kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-209">The following example shows how to use continuation state.</span></span> <span data-ttu-id="c6aa2-210">Tworzy łańcuch zadań kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-210">It creates a chain of continuation tasks.</span></span> <span data-ttu-id="c6aa2-211">Każde zadanie zawiera bieżący czas, <xref:System.DateTime> obiekt, dla `state` parametru <xref:System.Threading.Tasks.Task.ContinueWith%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-211">Each task provides the current time, a <xref:System.DateTime> object, for the `state` parameter of the <xref:System.Threading.Tasks.Task.ContinueWith%2A> method.</span></span> <span data-ttu-id="c6aa2-212">Każdy <xref:System.DateTime> obiekt reprezentuje godzinę utworzenia zadania kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-212">Each <xref:System.DateTime> object represents the time at which the continuation task is created.</span></span> <span data-ttu-id="c6aa2-213">Każde zadanie powstaje jako wynik drugi <xref:System.DateTime> obiekt, który reprezentuje godzinę zakończenia zadania.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-213">Each task produces as its result a second <xref:System.DateTime> object that represents the time at which the task finishes.</span></span> <span data-ttu-id="c6aa2-214">Po zakończeniu wszystkich zadań ten przykład wyświetla czas utworzenia i godzinę zakończenia każdego zadania kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-214">After all tasks finish, this example displays the creation time and the time at which each continuation task finishes.</span></span>

:::code language="csharp" source="snippets/cs/continuationstate.cs":::

[!code-vb[TPL_ContinuationState#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuationstate/vb/continuationstate.vb#1)]

## <a name="continuations-that-return-task-types"></a><span data-ttu-id="c6aa2-215">Kontynuacje zwracające typy zadań</span><span class="sxs-lookup"><span data-stu-id="c6aa2-215">Continuations that return Task types</span></span>

<span data-ttu-id="c6aa2-216">Czasami może być konieczne przetworzenie łańcucha kontynuacji zwracającej <xref:System.Threading.Tasks.Task> Typ.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-216">Sometimes you may need to chain a continuation that returns a <xref:System.Threading.Tasks.Task> type.</span></span> <span data-ttu-id="c6aa2-217">Są one określane jako zadania zagnieżdżone i są wspólne.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-217">These are referred to as nested tasks, and they are common.</span></span> <span data-ttu-id="c6aa2-218">Gdy zadanie nadrzędne wywołuje <xref:System.Threading.Tasks.Task%601.ContinueWith%2A?displayProperty=nameWithType> i dostarcza zadanie `continuationFunction` , które zwraca wywołanie, <xref:System.Threading.Tasks.TaskExtensions.Unwrap%2A> Aby utworzyć zadanie proxy reprezentujące asynchroniczne operacje `<Task<Task<T>>>` lub `Task(Of Task(Of T))` (Visual Basic).</span><span class="sxs-lookup"><span data-stu-id="c6aa2-218">When a parent task calls <xref:System.Threading.Tasks.Task%601.ContinueWith%2A?displayProperty=nameWithType>, and provides a `continuationFunction` that is task returning you call <xref:System.Threading.Tasks.TaskExtensions.Unwrap%2A> to create a proxy task that represents the asynchronous operation of the `<Task<Task<T>>>` or `Task(Of Task(Of T))` (Visual Basic).</span></span>

<span data-ttu-id="c6aa2-219">Poniższy przykład pokazuje, jak używać kontynuacji, które zawijają dodatkowe funkcje zwracające zadania.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-219">The following example shows how to use continuations that wrap additional task returning functions.</span></span> <span data-ttu-id="c6aa2-220">Każdą kontynuację można rozpakowany, uwidaczniając wewnętrzne zadanie, które zostało opakowane.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-220">Each continuation can be unwrapped, exposing the inner task that was wrapped.</span></span>

:::code language="csharp" source="snippets/cs/unwrap.cs":::
:::code language="vb" source="snippets/vb/unwrap.vb":::

<span data-ttu-id="c6aa2-221">Aby uzyskać więcej informacji na temat korzystania z programu <xref:System.Threading.Tasks.TaskExtensions.Unwrap%2A> , zobacz [How to: unnesting a zagnieżdżone zadanie](how-to-unwrap-a-nested-task.md).</span><span class="sxs-lookup"><span data-stu-id="c6aa2-221">For more information on using <xref:System.Threading.Tasks.TaskExtensions.Unwrap%2A>, see [How to: Unwrap a nested Task](how-to-unwrap-a-nested-task.md).</span></span>

## <a name="handle-exceptions-thrown-from-continuations"></a><span data-ttu-id="c6aa2-222">Obsługa wyjątków zgłoszonych przez kontynuacje</span><span class="sxs-lookup"><span data-stu-id="c6aa2-222">Handle exceptions thrown from continuations</span></span>

<span data-ttu-id="c6aa2-223">Relację kontynuacji poprzedzającej nie jest relacją nadrzędny-podrzędny.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-223">An antecedent-continuation relationship is not a parent-child relationship.</span></span> <span data-ttu-id="c6aa2-224">Wyjątki zgłoszone przez kontynuacje nie są propagowane do poprzedzającego.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-224">Exceptions thrown by continuations are not propagated to the antecedent.</span></span> <span data-ttu-id="c6aa2-225">W związku z tym, obsługa wyjątków zgłaszanych przez kontynuacje w miarę obsłużenia ich w innych zadaniach w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="c6aa2-225">Therefore, handle exceptions thrown by continuations as you would handle them in any other task, as follows:</span></span>

- <span data-ttu-id="c6aa2-226"><xref:System.Threading.Tasks.Task.Wait%2A> <xref:System.Threading.Tasks.Task.WaitAll%2A> <xref:System.Threading.Tasks.Task.WaitAny%2A> Aby poczekać na kontynuację, można użyć metody,, lub lub jej ogólnego odpowiednika.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-226">You can use the <xref:System.Threading.Tasks.Task.Wait%2A>, <xref:System.Threading.Tasks.Task.WaitAll%2A>, or <xref:System.Threading.Tasks.Task.WaitAny%2A> method, or its generic counterpart, to wait on the continuation.</span></span> <span data-ttu-id="c6aa2-227">Możesz poczekać na poprzedzające i jego kontynuacje w tej samej `try` instrukcji, jak pokazano w poniższym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-227">You can wait for an antecedent and its continuations in the same `try` statement, as shown in the following example.</span></span>

:::code language="csharp" source="snippets/cs/exception1.cs":::

[!code-vb[TPL_Continuations#6](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/exception1.vb#6)]

- <span data-ttu-id="c6aa2-228">Możesz użyć drugiej kontynuacji, aby obserwować <xref:System.Threading.Tasks.Task.Exception%2A> Właściwość pierwszej kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-228">You can use a second continuation to observe the <xref:System.Threading.Tasks.Task.Exception%2A> property of the first continuation.</span></span> <span data-ttu-id="c6aa2-229">W poniższym przykładzie zadanie próbuje odczytać z nieistniejącego pliku.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-229">In the following example, a task attempts to read from a non-existent file.</span></span> <span data-ttu-id="c6aa2-230">Kontynuacja następnie wyświetla informacje o wyjątku w zadaniu poprzedzającym.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-230">The continuation then displays information about the exception in the antecedent task.</span></span>

:::code language="csharp" source="snippets/cs/exception2.cs" id="example":::

[!code-vb[TPL_Continuations#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/exception2.vb#4)]

<span data-ttu-id="c6aa2-231">Ponieważ został uruchomiony z <xref:System.Threading.Tasks.TaskContinuationOptions.OnlyOnFaulted?displayProperty=nameWithType> opcją, kontynuacja jest wykonywana tylko wtedy, gdy wystąpi wyjątek w poprzedniku, i w związku z tym może założyć, że <xref:System.Threading.Tasks.Task.Exception%2A> Właściwość antecedent nie jest `null` .</span><span class="sxs-lookup"><span data-stu-id="c6aa2-231">Because it was run with the <xref:System.Threading.Tasks.TaskContinuationOptions.OnlyOnFaulted?displayProperty=nameWithType> option, the continuation executes only if an exception occurs in the antecedent, and therefore it can assume that the antecedent's <xref:System.Threading.Tasks.Task.Exception%2A> property is not `null`.</span></span> <span data-ttu-id="c6aa2-232">Jeśli kontynuacja jest wykonywana niezależnie od tego, czy wyjątek jest zgłaszany w przypadku poprzedzającego, należy sprawdzić, czy <xref:System.Threading.Tasks.Task.Exception%2A> Właściwość antecedent nie jest `null` wcześniejsza niż próba obsługi wyjątku, jak pokazano w poniższym fragmencie kodu.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-232">If the continuation executes whether or not an exception is thrown in the antecedent, it would have to check whether the antecedent's <xref:System.Threading.Tasks.Task.Exception%2A> property is not `null` before attempting to handle the exception, as the following code fragment shows.</span></span>

:::code language="csharp" source="snippets/cs/exception2.cs" id="exception":::

[!code-vb[TPL_Continuations#11](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/exception2.vb#11)]

<span data-ttu-id="c6aa2-233">Aby uzyskać więcej informacji, zobacz [Obsługa wyjątków](exception-handling-task-parallel-library.md).</span><span class="sxs-lookup"><span data-stu-id="c6aa2-233">For more information, see [Exception Handling](exception-handling-task-parallel-library.md).</span></span>

- <span data-ttu-id="c6aa2-234">Jeśli kontynuacja jest dołączonym zadaniem podrzędnym, które zostało utworzone przy użyciu <xref:System.Threading.Tasks.TaskContinuationOptions.AttachedToParent?displayProperty=nameWithType> opcji, jego wyjątki będą propagowane przez element nadrzędny z powrotem do wątku wywołującego, podobnie jak w przypadku dowolnego innego dołączonego elementu podrzędnego.</span><span class="sxs-lookup"><span data-stu-id="c6aa2-234">If the continuation is an attached child task that was created by using the <xref:System.Threading.Tasks.TaskContinuationOptions.AttachedToParent?displayProperty=nameWithType> option, its exceptions will be propagated by the parent back to the calling thread, as is the case in any other attached child.</span></span> <span data-ttu-id="c6aa2-235">Aby uzyskać więcej informacji, zobacz [dołączone i odłączone zadania podrzędne](attached-and-detached-child-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="c6aa2-235">For more information, see [Attached and Detached Child Tasks](attached-and-detached-child-tasks.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="c6aa2-236">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="c6aa2-236">See also</span></span>

- [<span data-ttu-id="c6aa2-237">Biblioteka zadań równoległych (TPL)</span><span class="sxs-lookup"><span data-stu-id="c6aa2-237">Task Parallel Library (TPL)</span></span>](task-parallel-library-tpl.md)
