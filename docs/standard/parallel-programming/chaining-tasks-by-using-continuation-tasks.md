---
title: Tworzenie łańcuchów zadań przy użyciu zadań kontynuacji
ms.date: 02/11/2019
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- tasks, continuations
ms.assetid: 0b45e9a2-de28-46ce-8212-1817280ed42d
ms.openlocfilehash: 7de8c4e44e1866e3df36c666c9ecc210dc6a7d83
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/15/2020
ms.locfileid: "78159367"
---
# <a name="chaining-tasks-by-using-continuation-tasks"></a><span data-ttu-id="f5cfd-102">Tworzenie łańcuchów zadań przy użyciu zadań kontynuacji</span><span class="sxs-lookup"><span data-stu-id="f5cfd-102">Chaining Tasks by Using Continuation Tasks</span></span>
<span data-ttu-id="f5cfd-103">W programowaniu asynchronicznym jest wspólne dla jednej operacji asynchronicznej, po zakończeniu, wywołać drugą operację i przekazać dane do niej.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-103">In asynchronous programming, it is common for one asynchronous operation, on completion, to invoke a second operation and pass data to it.</span></span> <span data-ttu-id="f5cfd-104">Tradycyjnie kontynuacje zostały wykonane przy użyciu metod wywołania zwrotu.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-104">Traditionally, continuations have been done by using callback methods.</span></span> <span data-ttu-id="f5cfd-105">W bibliotece równoległej zadania te same funkcje są dostarczane przez *zadania kontynuacji*.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-105">In the Task Parallel Library, the same functionality is provided by *continuation tasks*.</span></span> <span data-ttu-id="f5cfd-106">Zadanie kontynuacji (znane również jako kontynuacja) jest zadaniem asynchronicznym wywoływanym przez inne zadanie, które jest znane jako *poprzednik*, po zakończeniu poprzednika.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-106">A continuation task (also known just as a continuation) is an asynchronous task that is invoked by another task, which is known as the *antecedent*, when the antecedent finishes.</span></span>  
  
 <span data-ttu-id="f5cfd-107">Kontynuacje są stosunkowo łatwe w użyciu, ale mimo to są potężne i elastyczne.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-107">Continuations are relatively easy to use, but are nevertheless powerful and flexible.</span></span> <span data-ttu-id="f5cfd-108">Można na przykład:</span><span class="sxs-lookup"><span data-stu-id="f5cfd-108">For example, you can:</span></span>  
  
- <span data-ttu-id="f5cfd-109">Przekazywanie danych z poprzednika do kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-109">Pass data from the antecedent to the continuation.</span></span>  
  
- <span data-ttu-id="f5cfd-110">Określ dokładne warunki, w których kontynuacja będzie wywoływana lub nie wywoływana.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-110">Specify the precise conditions under which the continuation will be invoked or not invoked.</span></span>  
  
- <span data-ttu-id="f5cfd-111">Anuluj kontynuację przed jej rozpoczęciem lub wspólnie, gdy jest uruchomiona.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-111">Cancel a continuation either before it starts or cooperatively as it is running.</span></span>  
  
- <span data-ttu-id="f5cfd-112">Podaj wskazówki dotyczące sposobu planowania kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-112">Provide hints about how the continuation should be scheduled.</span></span>  
  
- <span data-ttu-id="f5cfd-113">Wywołać wiele kontynuacji z tego samego poprzednika.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-113">Invoke multiple continuations from the same antecedent.</span></span>  
  
- <span data-ttu-id="f5cfd-114">Wywołaj jedną kontynuację po zakończeniu wszystkich lub jednego z wielu poprzedników.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-114">Invoke one continuation when all or any one of multiple antecedents complete.</span></span>  
  
- <span data-ttu-id="f5cfd-115">Łańcuch kontynuacje jeden po drugim do dowolnej długości.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-115">Chain continuations one after another to any arbitrary length.</span></span>  
  
- <span data-ttu-id="f5cfd-116">Użyj kontynuacji do obsługi wyjątków zgłoszonych przez poprzednika.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-116">Use a continuation to handle exceptions thrown by the antecedent.</span></span>  
  
## <a name="about-continuations"></a><span data-ttu-id="f5cfd-117">O kontynuacjach</span><span class="sxs-lookup"><span data-stu-id="f5cfd-117">About continuations</span></span>  
 <span data-ttu-id="f5cfd-118">Kontynuacja jest zadaniem, który <xref:System.Threading.Tasks.TaskStatus.WaitingForActivation> jest tworzony w stanie.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-118">A continuation is a task that is created in the <xref:System.Threading.Tasks.TaskStatus.WaitingForActivation> state.</span></span> <span data-ttu-id="f5cfd-119">Jest on aktywowany automatycznie po zakończeniu jego poprzedzających zadań lub zadań.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-119">It is activated automatically when its antecedent task or tasks complete.</span></span> <span data-ttu-id="f5cfd-120">Wywołanie <xref:System.Threading.Tasks.Task.Start%2A?displayProperty=nameWithType> kontynuacji w kodzie <xref:System.InvalidOperationException?displayProperty=nameWithType> użytkownika zgłasza wyjątek.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-120">Calling <xref:System.Threading.Tasks.Task.Start%2A?displayProperty=nameWithType> on a continuation in user code throws an <xref:System.InvalidOperationException?displayProperty=nameWithType> exception.</span></span>  
  
 <span data-ttu-id="f5cfd-121">Kontynuacja sama <xref:System.Threading.Tasks.Task> w sobie jest i nie blokuje wątku, na którym jest uruchamiany.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-121">A continuation is itself a <xref:System.Threading.Tasks.Task> and does not block the thread on which it is started.</span></span> <span data-ttu-id="f5cfd-122">Wywołaj <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> metodę, aby zablokować, dopóki nie zakończy się zadanie kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-122">Call the <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> method to block until the continuation task finishes.</span></span>  
  
## <a name="creating-a-continuation-for-a-single-antecedent"></a><span data-ttu-id="f5cfd-123">Tworzenie kontynuacji dla jednego poprzednika</span><span class="sxs-lookup"><span data-stu-id="f5cfd-123">Creating a continuation for a single antecedent</span></span>  
 <span data-ttu-id="f5cfd-124">Tworzenie kontynuacji, która jest wykonywana po zakończeniu jego <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> poprzednika przez wywołanie metody.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-124">You create a continuation that executes when its antecedent has completed by calling the <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="f5cfd-125">W poniższym przykładzie przedstawiono podstawowy wzorzec (dla jasności pominięto obsługę wyjątków).</span><span class="sxs-lookup"><span data-stu-id="f5cfd-125">The following example shows the basic pattern (for clarity, exception handling is omitted).</span></span> <span data-ttu-id="f5cfd-126">Wykonuje zadanie poprzednika, , `taskA`który zwraca <xref:System.DayOfWeek> obiekt, który wskazuje nazwę bieżącego dnia tygodnia.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-126">It executes an antecedent task, `taskA`, that returns a <xref:System.DayOfWeek> object that indicates the name of the current day of the week.</span></span> <span data-ttu-id="f5cfd-127">Po zakończeniu antecedent, zadanie kontynuacji, `continuation`, jest przekazywana antecedent i wyświetla ciąg, który zawiera jego wynik.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-127">When the antecedent completes, the continuation task, `continuation`, is passed the antecedent and displays a string that includes its result.</span></span>

> [!NOTE]
> <span data-ttu-id="f5cfd-128">Przykłady Języka C# w tym `async` artykule korzystają `Main` z modyfikatora na metodę.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-128">The C# samples in this article make use of the `async` modifier on the `Main` method.</span></span> <span data-ttu-id="f5cfd-129">Ta funkcja jest dostępna w języku C# 7.1 i nowszych.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-129">That feature is available in C# 7.1 and later.</span></span> <span data-ttu-id="f5cfd-130">Poprzednie wersje generują [`CS5001`](../../csharp/misc/cs5001.md) podczas kompilowania tego przykładowego kodu.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-130">Previous versions generate [`CS5001`](../../csharp/misc/cs5001.md) when compiling this sample code.</span></span> <span data-ttu-id="f5cfd-131">Musisz ustawić wersję językową na C# 7.1 lub nowszą.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-131">You'll need to set the language version to C# 7.1 or newer.</span></span> <span data-ttu-id="f5cfd-132">Możesz dowiedzieć się, jak skonfigurować wersję językową w artykule na [konfigurowanie wersji językowej](../../csharp/language-reference/configure-language-version.md).</span><span class="sxs-lookup"><span data-stu-id="f5cfd-132">You can learn how to configure the language version in the article on [configure language version](../../csharp/language-reference/configure-language-version.md).</span></span>
  
 [!code-csharp[TPL_Continuations#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_continuations/cs/simple1.cs#1)]
 [!code-vb[TPL_Continuations#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/simple1.vb#1)]  
  
## <a name="creating-a-continuation-for-multiple-antecedents"></a><span data-ttu-id="f5cfd-133">Tworzenie kontynuacji dla wielu poprzedników</span><span class="sxs-lookup"><span data-stu-id="f5cfd-133">Creating a continuation for multiple antecedents</span></span>  
 <span data-ttu-id="f5cfd-134">Można również utworzyć kontynuację, która zostanie uruchamiana po zakończeniu dowolnej lub wszystkich grup zadań.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-134">You can also create a continuation that will run when any or all of a group of tasks has completed.</span></span> <span data-ttu-id="f5cfd-135">Aby wykonać kontynuację po zakończeniu wszystkich poprzednich zadań,`Shared` należy wywołać <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> metodę statyczną (w języku Visual Basic) lub metodę wystąpienia. <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="f5cfd-135">To execute a continuation when all antecedent tasks have completed, you call the static (`Shared` in Visual Basic) <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> method or the instance <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="f5cfd-136">Aby wykonać kontynuację po zakończeniu dowolnych zadań poprzedników, należy`Shared` wywołać <xref:System.Threading.Tasks.Task.WhenAny%2A?displayProperty=nameWithType> metodę statyczną (w języku Visual Basic) lub metodę wystąpienia. <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAny%2A?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="f5cfd-136">To execute a continuation when any of the antecedent tasks has completed, you call the static (`Shared` in Visual Basic) <xref:System.Threading.Tasks.Task.WhenAny%2A?displayProperty=nameWithType> method or the instance <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAny%2A?displayProperty=nameWithType> method.</span></span>  
  
 <span data-ttu-id="f5cfd-137">Należy zauważyć, <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> że <xref:System.Threading.Tasks.Task.WhenAny%2A?displayProperty=nameWithType> wywołania i przeciążenia nie blokują wątku wywołującego.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-137">Note that calls to the <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Task.WhenAny%2A?displayProperty=nameWithType> overloads do not block the calling thread.</span></span>  <span data-ttu-id="f5cfd-138">Jednak zazwyczaj wywołać wszystkie <xref:System.Threading.Tasks.Task.WhenAll%28System.Collections.Generic.IEnumerable%7BSystem.Threading.Tasks.Task%7D%29?displayProperty=nameWithType> oprócz <xref:System.Threading.Tasks.Task.WhenAll%28System.Threading.Tasks.Task%5B%5D%29?displayProperty=nameWithType> i metody, aby <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> pobrać zwróconą właściwość, która blokuje wątek wywołujący.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-138">However, you typically call all but the <xref:System.Threading.Tasks.Task.WhenAll%28System.Collections.Generic.IEnumerable%7BSystem.Threading.Tasks.Task%7D%29?displayProperty=nameWithType> and  <xref:System.Threading.Tasks.Task.WhenAll%28System.Threading.Tasks.Task%5B%5D%29?displayProperty=nameWithType> methods to retrieve the returned  <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property, which does block the calling thread.</span></span>  
  
 <span data-ttu-id="f5cfd-139">Poniższy przykład wywołuje <xref:System.Threading.Tasks.Task.WhenAll%28System.Collections.Generic.IEnumerable%7BSystem.Threading.Tasks.Task%7D%29?displayProperty=nameWithType> metodę, aby utworzyć zadanie kontynuacji, który odzwierciedla wyniki jego 10 poprzednich zadań.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-139">The following example calls the <xref:System.Threading.Tasks.Task.WhenAll%28System.Collections.Generic.IEnumerable%7BSystem.Threading.Tasks.Task%7D%29?displayProperty=nameWithType> method to create a continuation task that reflects the results of its 10 antecedent tasks.</span></span> <span data-ttu-id="f5cfd-140">Każde zadanie poprzednika kwadraty wartość indeksu, który waha się od jednego do 10.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-140">Each antecedent task squares an index value that ranges from one to 10.</span></span> <span data-ttu-id="f5cfd-141">Jeśli poprzedników zakończyć pomyślnie (ich <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> właściwość <xref:System.Threading.Tasks.TaskStatus.RanToCompletion?displayProperty=nameWithType>jest <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> ), właściwość kontynuacji jest <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> tablica wartości zwracanych przez każdego poprzednika.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-141">If the antecedents complete successfully (their <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> property is <xref:System.Threading.Tasks.TaskStatus.RanToCompletion?displayProperty=nameWithType>), the <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property of the continuation is an array of the <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> values returned by each antecedent.</span></span> <span data-ttu-id="f5cfd-142">W przykładzie dodaje je do obliczenia sumy kwadratów dla wszystkich liczb z 1 do 10.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-142">The example adds them to compute the sum of squares for all numbers between one and 10.</span></span>  
  
 [!code-csharp[TPL_Continuations#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_continuations/cs/whenall1.cs#5)]
 [!code-vb[TPL_Continuations#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/whenall1.vb#5)]  
  
## <a name="continuation-options"></a><span data-ttu-id="f5cfd-143">Opcje kontynuacji</span><span class="sxs-lookup"><span data-stu-id="f5cfd-143">Continuation options</span></span>  
 <span data-ttu-id="f5cfd-144">Podczas tworzenia kontynuacji jednego zadania, można <xref:System.Threading.Tasks.Task.ContinueWith%2A> użyć przeciążenia, który przyjmuje wartość <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> wyliczenia, aby określić warunki, w których rozpoczyna się kontynuacja.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-144">When you create a single-task continuation, you can use a <xref:System.Threading.Tasks.Task.ContinueWith%2A> overload that takes a <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> enumeration value to specify the conditions under which the continuation starts.</span></span> <span data-ttu-id="f5cfd-145">Na przykład można określić, że kontynuacja ma być uruchamiana tylko wtedy, gdy poprzednik zakończy się pomyślnie lub tylko wtedy, gdy zakończy się w stanie błędnym.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-145">For example, you can specify that the continuation is to run only if the antecedent completes successfully, or only if it completes in a faulted state.</span></span> <span data-ttu-id="f5cfd-146">Jeśli warunek nie jest spełniony, gdy poprzednik jest gotowy do wywołania <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> kontynuacji, kontynuacja przechodzi bezpośrednio do stanu, a następnie nie można uruchomić.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-146">If the condition is not true when the antecedent is ready to invoke the continuation, the continuation transitions directly to the <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> state and subsequently cannot be started.</span></span>  
  
 <span data-ttu-id="f5cfd-147">Szereg wielozadaniowych metod kontynuacji, takich jak <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A?displayProperty=nameWithType> przeciążenia metody, również parametr. <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="f5cfd-147">A number of multi-task continuation methods, such as overloads of the <xref:System.Threading.Tasks.TaskFactory.ContinueWhenAll%2A?displayProperty=nameWithType> method, also include a <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> parameter.</span></span> <span data-ttu-id="f5cfd-148">Jednak tylko podzbiór <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> wszystkich elementów członkowskich wyliczania jest prawidłowy.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-148">Only a subset of all <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> enumeration members are valid, however.</span></span> <span data-ttu-id="f5cfd-149">Można określić <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> wartości, które mają <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=nameWithType> odpowiedniki w <xref:System.Threading.Tasks.TaskContinuationOptions.AttachedToParent?displayProperty=nameWithType>wyliczeniu, takie jak , <xref:System.Threading.Tasks.TaskContinuationOptions.LongRunning?displayProperty=nameWithType>, i <xref:System.Threading.Tasks.TaskContinuationOptions.PreferFairness?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-149">You can specify <xref:System.Threading.Tasks.TaskContinuationOptions?displayProperty=nameWithType> values that have counterparts in the <xref:System.Threading.Tasks.TaskCreationOptions?displayProperty=nameWithType> enumeration, such as <xref:System.Threading.Tasks.TaskContinuationOptions.AttachedToParent?displayProperty=nameWithType>, <xref:System.Threading.Tasks.TaskContinuationOptions.LongRunning?displayProperty=nameWithType>, and <xref:System.Threading.Tasks.TaskContinuationOptions.PreferFairness?displayProperty=nameWithType>.</span></span> <span data-ttu-id="f5cfd-150">Jeśli określisz `NotOn` `OnlyOn` dowolną z lub opcji <xref:System.ArgumentOutOfRangeException> z kontynuacją wielu zadań, wyjątek zostanie zgłoszony w czasie wykonywania.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-150">If you specify any of the `NotOn` or `OnlyOn` options with a multi-task continuation, an <xref:System.ArgumentOutOfRangeException> exception will be thrown at run time.</span></span>  
  
 <span data-ttu-id="f5cfd-151">Aby uzyskać więcej informacji na <xref:System.Threading.Tasks.TaskContinuationOptions> temat opcji kontynuacji zadań, zobacz temat.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-151">For more information on task continuation options, see the <xref:System.Threading.Tasks.TaskContinuationOptions> topic.</span></span>  
  
## <a name="passing-data-to-a-continuation"></a><span data-ttu-id="f5cfd-152">Przekazywanie danych do kontynuacji</span><span class="sxs-lookup"><span data-stu-id="f5cfd-152">Passing Data to a Continuation</span></span>  
 <span data-ttu-id="f5cfd-153">Metoda <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> przekazuje odwołanie do poprzednika do delegata użytkownika kontynuacji jako argument.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-153">The <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> method passes a reference to the antecedent to the user delegate of the continuation as an argument.</span></span> <span data-ttu-id="f5cfd-154">Jeśli antecedent jest <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType> obiektem, a zadanie zostało wykonane, dopóki nie <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> zostało ukończone, kontynuacja może uzyskać dostęp do właściwości zadania.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-154">If the antecedent is a <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType> object, and the task ran until it was completed, then the continuation can access the <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property of the task.</span></span>  
  
 <span data-ttu-id="f5cfd-155">Właściwość <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> blokuje, dopóki zadanie nie zostanie zakończone.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-155">The <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property blocks until the task has completed.</span></span> <span data-ttu-id="f5cfd-156">Jednak jeśli zadanie zostało anulowane lub błędy, próba <xref:System.Threading.Tasks.Task%601.Result%2A> uzyskania dostępu <xref:System.AggregateException> do właściwości zgłasza wyjątek.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-156">However, if the task was canceled or faulted, attempting to access the <xref:System.Threading.Tasks.Task%601.Result%2A> property throws an <xref:System.AggregateException> exception.</span></span> <span data-ttu-id="f5cfd-157">Ten problem można uniknąć, <xref:System.Threading.Tasks.TaskContinuationOptions.OnlyOnRanToCompletion> korzystając z opcji, jak pokazano w poniższym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-157">You can avoid this problem by using the <xref:System.Threading.Tasks.TaskContinuationOptions.OnlyOnRanToCompletion> option, as shown in the following example.</span></span>  
  
 [!code-csharp[TPL_Continuations#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_continuations/cs/result1.cs#2)]
 [!code-vb[TPL_Continuations#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/result1.vb#2)]  
  
 <span data-ttu-id="f5cfd-158">Jeśli chcesz, aby kontynuacja była uruchamiana, nawet jeśli poprzednik nie został uruchomiony do pomyślnego zakończenia, należy zabezpieczyć się przed wyjątkiem.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-158">If you want the continuation to run even if the antecedent did not run to successful completion, you must guard against the exception.</span></span> <span data-ttu-id="f5cfd-159">Jednym z podejść <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> jest przetestowanie właściwości poprzednika i <xref:System.Threading.Tasks.Task%601.Result%2A> tylko próbować uzyskać <xref:System.Threading.Tasks.TaskStatus.Faulted> dostęp <xref:System.Threading.Tasks.TaskStatus.Canceled>do właściwości, jeśli stan nie jest lub .</span><span class="sxs-lookup"><span data-stu-id="f5cfd-159">One approach is to test the <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> property of the antecedent, and only attempt to access the <xref:System.Threading.Tasks.Task%601.Result%2A> property if the status is not <xref:System.Threading.Tasks.TaskStatus.Faulted> or <xref:System.Threading.Tasks.TaskStatus.Canceled>.</span></span> <span data-ttu-id="f5cfd-160">Można również sprawdzić <xref:System.Threading.Tasks.Task.Exception%2A> właściwość poprzednika.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-160">You can also examine the <xref:System.Threading.Tasks.Task.Exception%2A> property of the antecedent.</span></span> <span data-ttu-id="f5cfd-161">Aby uzyskać więcej informacji, zobacz [Obsługa wyjątków](../../../docs/standard/parallel-programming/exception-handling-task-parallel-library.md).</span><span class="sxs-lookup"><span data-stu-id="f5cfd-161">For more information, see [Exception Handling](../../../docs/standard/parallel-programming/exception-handling-task-parallel-library.md).</span></span> <span data-ttu-id="f5cfd-162">Poniższy przykład modyfikuje poprzedni przykład, aby uzyskać <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> dostęp do właściwości <xref:System.Threading.Tasks.TaskStatus.RanToCompletion?displayProperty=nameWithType>poprzednika tylko wtedy, gdy jego stan jest .</span><span class="sxs-lookup"><span data-stu-id="f5cfd-162">The following example modifies the previous example to access antecedent's <xref:System.Threading.Tasks.Task%601.Result%2A?displayProperty=nameWithType> property only if its status is <xref:System.Threading.Tasks.TaskStatus.RanToCompletion?displayProperty=nameWithType>.</span></span>  
  
 [!code-csharp[TPL_Continuations#7](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_continuations/cs/result2.cs#7)]
 [!code-vb[TPL_Continuations#7](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/result2.vb#7)]  
  
## <a name="canceling-a-continuation"></a><span data-ttu-id="f5cfd-163">Anulowanie kontynuacji</span><span class="sxs-lookup"><span data-stu-id="f5cfd-163">Canceling a Continuation</span></span>  
 <span data-ttu-id="f5cfd-164">Właściwość <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> kontynuacji jest ustawiona <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> w następujących sytuacjach:</span><span class="sxs-lookup"><span data-stu-id="f5cfd-164">The <xref:System.Threading.Tasks.Task.Status%2A?displayProperty=nameWithType> property of a continuation is set to <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> in the following situations:</span></span>  
  
- <span data-ttu-id="f5cfd-165">Zgłasza <xref:System.OperationCanceledException> wyjątek w odpowiedzi na żądanie anulowania.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-165">It throws an <xref:System.OperationCanceledException> exception in response to a cancellation request.</span></span> <span data-ttu-id="f5cfd-166">Podobnie jak w przypadku każdego zadania, jeśli wyjątek zawiera ten sam token, który został przekazany do kontynuacji, jest traktowany jako potwierdzenie anulowania współpracy.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-166">As with any task, if the exception contains the same token that was passed to the continuation, it is treated as an acknowledgement of cooperative cancellation.</span></span>  
  
- <span data-ttu-id="f5cfd-167">Kontynuacja jest <xref:System.Threading.CancellationToken?displayProperty=nameWithType> przekazywana, której <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> właściwość jest `true`.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-167">The continuation is passed a <xref:System.Threading.CancellationToken?displayProperty=nameWithType> whose <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> property is `true`.</span></span> <span data-ttu-id="f5cfd-168">W takim przypadku kontynuacja nie uruchamia się i <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> przechodzi do stanu.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-168">In this case, the continuation does not start, and it transitions to the <xref:System.Threading.Tasks.TaskStatus.Canceled?displayProperty=nameWithType> state.</span></span>  
  
- <span data-ttu-id="f5cfd-169">Kontynuacja nigdy nie działa, <xref:System.Threading.Tasks.TaskContinuationOptions> ponieważ warunek ustawiony przez jego argument nie został spełniony.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-169">The continuation never runs because the condition set by its <xref:System.Threading.Tasks.TaskContinuationOptions> argument was not met.</span></span> <span data-ttu-id="f5cfd-170">Na przykład jeśli poprzednik przechodzi w <xref:System.Threading.Tasks.TaskStatus.Faulted?displayProperty=nameWithType> stan, jego kontynuacja, która została <xref:System.Threading.Tasks.TaskContinuationOptions.NotOnFaulted?displayProperty=nameWithType> przekazana, <xref:System.Threading.Tasks.TaskStatus.Canceled> opcja nie zostanie uruchomiony, ale przejdzie do stanu.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-170">For example, if an antecedent goes into a <xref:System.Threading.Tasks.TaskStatus.Faulted?displayProperty=nameWithType> state, its continuation that was passed the <xref:System.Threading.Tasks.TaskContinuationOptions.NotOnFaulted?displayProperty=nameWithType> option will not run but will transition to the <xref:System.Threading.Tasks.TaskStatus.Canceled> state.</span></span>  
  
 <span data-ttu-id="f5cfd-171">Jeśli zadanie i jego kontynuacja reprezentują dwie części tej samej operacji logicznej, można przekazać ten sam token anulowania do obu zadań, jak pokazano w poniższym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-171">If a task and its continuation represent two parts of the same logical operation, you can pass the same cancellation token to both tasks, as shown in the following example.</span></span> <span data-ttu-id="f5cfd-172">Składa się z poprzednika, który generuje listę liczb całkowitych, które są podzielne przez 33, który przechodzi do kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-172">It consists of an antecedent that generates a list of integers that are divisible by 33, which it passes to the continuation.</span></span> <span data-ttu-id="f5cfd-173">Kontynuacja z kolei wyświetla listę.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-173">The continuation in turn displays the list.</span></span> <span data-ttu-id="f5cfd-174">Zarówno poprzednik, jak i kontynuacja regularnie pauzują w losowych odstępach czasu.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-174">Both the antecedent and the continuation pause regularly for random intervals.</span></span> <span data-ttu-id="f5cfd-175">Ponadto <xref:System.Threading.Timer?displayProperty=nameWithType> obiekt jest używany do `Elapsed` wykonywania metody po pięciosekundowym przedziale czasu.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-175">In addition, a <xref:System.Threading.Timer?displayProperty=nameWithType> object is used to execute the `Elapsed` method after a five-second timeout interval.</span></span> <span data-ttu-id="f5cfd-176">W tym <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> przykładzie wywołuje metodę, co powoduje, <xref:System.Threading.CancellationToken.ThrowIfCancellationRequested%2A?displayProperty=nameWithType> że aktualnie wykonywane zadanie do wywołania metody.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-176">This example calls the <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> method, which causes the currently executing task to call the <xref:System.Threading.CancellationToken.ThrowIfCancellationRequested%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="f5cfd-177">To, <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> czy metoda jest wywoływana podczas wykonywania poprzednika, czy jego kontynuacja, zależy od czasu trwania losowo generowanych pauz.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-177">Whether the <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> method is called when the antecedent or its continuation is executing depends on the duration of the randomly generated pauses.</span></span> <span data-ttu-id="f5cfd-178">Jeśli poprzednik zostanie anulowany, kontynuacja nie rozpocznie się.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-178">If the antecedent is canceled, the continuation will not start.</span></span> <span data-ttu-id="f5cfd-179">Jeśli poprzednik nie zostanie anulowany, token nadal może służyć do anulowania kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-179">If the antecedent is not canceled, the token can still be used to cancel the continuation.</span></span>  
  
 [!code-csharp[TPL_Continuations#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_continuations/cs/cancellation1.cs#3)]
 [!code-vb[TPL_Continuations#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/cancellation1.vb#3)]  
  
 <span data-ttu-id="f5cfd-180">Można również zapobiec kontynuacji wykonywania, jeśli jego poprzednik jest anulowane bez podawania kontynuacji token anulowania, określając <xref:System.Threading.Tasks.TaskContinuationOptions.NotOnCanceled?displayProperty=nameWithType> opcję podczas tworzenia kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-180">You can also prevent a continuation from executing if its antecedent is canceled without supplying the continuation a cancellation token by specifying the <xref:System.Threading.Tasks.TaskContinuationOptions.NotOnCanceled?displayProperty=nameWithType> option when you create the continuation.</span></span> <span data-ttu-id="f5cfd-181">Poniżej przedstawiono prosty przykład.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-181">The following is a simple example.</span></span>  
  
 [!code-csharp[TPL_Continuations#8](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_continuations/cs/cancellation2.cs#8)]
 [!code-vb[TPL_Continuations#8](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/cancellation2.vb#8)]  
  
 <span data-ttu-id="f5cfd-182">Po kontynuacji przechodzi <xref:System.Threading.Tasks.TaskStatus.Canceled> do stanu, może mieć wpływ na <xref:System.Threading.Tasks.TaskContinuationOptions> kontynuacje, które następują, w zależności od, które zostały określone dla tych kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-182">After a continuation goes into the <xref:System.Threading.Tasks.TaskStatus.Canceled> state, it may affect continuations that follow, depending on the <xref:System.Threading.Tasks.TaskContinuationOptions> that were specified for those continuations.</span></span>  
  
 <span data-ttu-id="f5cfd-183">Kontynuacje, które są usuwane nie rozpocznie.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-183">Continuations that are disposed will not start.</span></span>  
  
## <a name="continuations-and-child-tasks"></a><span data-ttu-id="f5cfd-184">Kontynuacje i zadania podrzędne</span><span class="sxs-lookup"><span data-stu-id="f5cfd-184">Continuations and Child Tasks</span></span>  
 <span data-ttu-id="f5cfd-185">Kontynuacja nie jest uruchamiana, dopóki poprzednik i wszystkie związane z nim zadania podrzędne nie zostaną zakończone.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-185">A continuation does not run until the antecedent and all of its attached child tasks have completed.</span></span> <span data-ttu-id="f5cfd-186">Kontynuacja nie czeka na zakończenie zadań podrzędnych odłączonych.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-186">The continuation does not wait for detached child tasks to finish.</span></span> <span data-ttu-id="f5cfd-187">W poniższych dwóch przykładach przedstawiono zadania podrzędne, które są dołączone do i odłączone od poprzednika, który tworzy kontynuację.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-187">The following two examples illustrate child tasks that are attached to and detached from an antecedent that creates a continuation.</span></span> <span data-ttu-id="f5cfd-188">W poniższym przykładzie kontynuacja jest uruchamiana tylko po zakończeniu wszystkich zadań podrzędnych, a uruchamianie przykładu wiele razy powoduje uzyskanie identycznych danych wyjściowych za każdym razem.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-188">In the following example, the continuation runs only after all child tasks have completed, and running the example multiple times produces identical output each time.</span></span> <span data-ttu-id="f5cfd-189">Przykład uruchamia poprzednika, wywołując <xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=nameWithType> metodę, ponieważ domyślnie <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType> metoda tworzy zadanie nadrzędne, <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType>którego domyślną opcją tworzenia zadania jest .</span><span class="sxs-lookup"><span data-stu-id="f5cfd-189">The example launches the antecedent by calling the <xref:System.Threading.Tasks.TaskFactory.StartNew%2A?displayProperty=nameWithType> method, since by default the <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType> method creates a parent task whose default task creation option is <xref:System.Threading.Tasks.TaskCreationOptions.DenyChildAttach?displayProperty=nameWithType>.</span></span>  
  
 [!code-csharp[TPL_Continuations#9](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_continuations/cs/attached1.cs#9)]
 [!code-vb[TPL_Continuations#9](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/attached1.vb#9)]  
  
 <span data-ttu-id="f5cfd-190">Jeśli zadania podrzędne są odłączone od poprzednika, jednak kontynuacja jest uruchamiana natychmiast po zakończeniu poprzednika, niezależnie od stanu zadań podrzędnych.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-190">If child tasks are detached from the antecedent, however, the continuation runs as soon as the antecedent has terminated, regardless of the state of the child tasks.</span></span> <span data-ttu-id="f5cfd-191">W rezultacie wiele przebiegów w poniższym przykładzie może generować zmienne dane wyjściowe, które zależy od tego, jak harmonogram zadań obsługiwał każde zadanie podrzędne.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-191">As a result, multiple runs of the following example can produce variable output that depends on how the task scheduler handled each child task.</span></span>  
  
 [!code-csharp[TPL_Continuations#10](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_continuations/cs/detached1.cs#10)]
 [!code-vb[TPL_Continuations#10](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/detached1.vb#10)]  
  
 <span data-ttu-id="f5cfd-192">Ostateczny stan zadania poprzednika zależy od ostatecznego stanu dołączonych zadań podrzędnych.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-192">The final status of the antecedent task depends on the final status of any attached child tasks.</span></span> <span data-ttu-id="f5cfd-193">Stan odłączonych zadań podrzędnych nie ma wpływu na element nadrzędny.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-193">The status of detached child tasks does not affect the parent.</span></span> <span data-ttu-id="f5cfd-194">Aby uzyskać więcej informacji, zobacz [Dołączone i odłączone zadania podrzędne](../../../docs/standard/parallel-programming/attached-and-detached-child-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="f5cfd-194">For more information, see [Attached and Detached Child Tasks](../../../docs/standard/parallel-programming/attached-and-detached-child-tasks.md).</span></span>  
  
## <a name="associating-state-with-continuations"></a><span data-ttu-id="f5cfd-195">Kojarzenie państwa z kontynuacjami</span><span class="sxs-lookup"><span data-stu-id="f5cfd-195">Associating State with Continuations</span></span>  
 <span data-ttu-id="f5cfd-196">Można skojarzyć dowolny stan z kontynuacją zadania.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-196">You can associate arbitrary state with a task continuation.</span></span> <span data-ttu-id="f5cfd-197">Metoda <xref:System.Threading.Tasks.Task.ContinueWith%2A> zawiera przeciążone wersje, które każdy ma <xref:System.Object> wartość, która reprezentuje stan kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-197">The <xref:System.Threading.Tasks.Task.ContinueWith%2A> method provides overloaded versions that each take an <xref:System.Object> value that represents the state of the continuation.</span></span> <span data-ttu-id="f5cfd-198">Później można uzyskać dostęp do <xref:System.Threading.Tasks.Task.AsyncState%2A?displayProperty=nameWithType> tego obiektu stanu przy użyciu właściwości.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-198">You can later access this state object by using the <xref:System.Threading.Tasks.Task.AsyncState%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="f5cfd-199">Ten obiekt `null` stanu jest, jeśli nie podasz wartość.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-199">This state object is `null` if you do not provide a value.</span></span>  
  
 <span data-ttu-id="f5cfd-200">Stan kontynuacji jest przydatne podczas konwertowania istniejącego kodu, który używa [asynchronicznego modelu programowania (APM)](../../../docs/standard/asynchronous-programming-patterns/asynchronous-programming-model-apm.md) do korzystania z TPL.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-200">Continuation state is useful when you convert existing code that uses the [Asynchronous Programming Model (APM)](../../../docs/standard/asynchronous-programming-patterns/asynchronous-programming-model-apm.md) to use the TPL.</span></span> <span data-ttu-id="f5cfd-201">W programie APM zazwyczaj podaje stos obiektu w **begin**_method_ metody <xref:System.IAsyncResult.AsyncState%2A?displayProperty=nameWithType> i później dostęp do tego stanu przy użyciu właściwości.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-201">In the APM, you typically provide object state in the **Begin**_Method_ method and later access that state by using the <xref:System.IAsyncResult.AsyncState%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="f5cfd-202">Za pomocą <xref:System.Threading.Tasks.Task.ContinueWith%2A> metody, można zachować ten stan podczas konwertowania kodu, który używa APM do korzystania z TPL.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-202">By using the <xref:System.Threading.Tasks.Task.ContinueWith%2A> method, you can preserve this state when you convert code that uses the APM to use the TPL.</span></span>  
  
 <span data-ttu-id="f5cfd-203">Stan kontynuacji może być również <xref:System.Threading.Tasks.Task> przydatne podczas pracy z obiektami w debugerze programu Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-203">Continuation state can also be useful when you work with <xref:System.Threading.Tasks.Task> objects in the Visual Studio debugger.</span></span> <span data-ttu-id="f5cfd-204">Na przykład w oknie **Zadania równoległe** kolumna **Zadanie** wyświetla reprezentację ciągu obiektu stanu dla każdego zadania.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-204">For example, in the **Parallel Tasks** window, the **Task** column displays the string representation of the state object for each task.</span></span> <span data-ttu-id="f5cfd-205">Aby uzyskać więcej informacji na temat okna **Zadania równoległe,** zobacz [Korzystanie z okna Zadania](/visualstudio/debugger/using-the-tasks-window).</span><span class="sxs-lookup"><span data-stu-id="f5cfd-205">For more information about the **Parallel Tasks** window, see [Using the Tasks Window](/visualstudio/debugger/using-the-tasks-window).</span></span>  
  
 <span data-ttu-id="f5cfd-206">W poniższym przykładzie pokazano, jak używać stanu kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-206">The following example shows how to use continuation state.</span></span> <span data-ttu-id="f5cfd-207">Tworzy łańcuch zadań kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-207">It creates a chain of continuation tasks.</span></span> <span data-ttu-id="f5cfd-208">Każde zadanie zawiera bieżący <xref:System.DateTime> czas, obiekt, `state` dla <xref:System.Threading.Tasks.Task.ContinueWith%2A> parametru metody.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-208">Each task provides the current time, a <xref:System.DateTime> object, for the `state` parameter of the <xref:System.Threading.Tasks.Task.ContinueWith%2A> method.</span></span> <span data-ttu-id="f5cfd-209">Każdy <xref:System.DateTime> obiekt reprezentuje czas, w którym jest tworzone zadanie kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-209">Each <xref:System.DateTime> object represents the time at which the continuation task is created.</span></span> <span data-ttu-id="f5cfd-210">Każde zadanie daje w wyniku <xref:System.DateTime> drugi obiekt, który reprezentuje czas, w którym kończy się zadanie.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-210">Each task produces as its result a second <xref:System.DateTime> object that represents the time at which the task finishes.</span></span> <span data-ttu-id="f5cfd-211">Po zakończeniu wszystkich zadań w tym przykładzie jest wyświetlany czas utworzenia i czas zakończenia każdego zadania kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-211">After all tasks finish, this example displays the creation time and the time at which each continuation task finishes.</span></span>  
  
 [!code-csharp[TPL_ContinuationState#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_continuationstate/cs/continuationstate.cs#1)]
 [!code-vb[TPL_ContinuationState#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuationstate/vb/continuationstate.vb#1)]  
  
## <a name="handling-exceptions-thrown-from-continuations"></a><span data-ttu-id="f5cfd-212">Obsługa wyjątków generowanych z kontynuacji</span><span class="sxs-lookup"><span data-stu-id="f5cfd-212">Handling Exceptions Thrown from Continuations</span></span>  
 <span data-ttu-id="f5cfd-213">Relacja antecedent-kontynuacja nie jest relacją nadrzędny podrzędny.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-213">An antecedent-continuation relationship is not a parent-child relationship.</span></span> <span data-ttu-id="f5cfd-214">Wyjątki generowane przez kontynuacje nie są propagowane do poprzednika.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-214">Exceptions thrown by continuations are not propagated to the antecedent.</span></span> <span data-ttu-id="f5cfd-215">W związku z tym doobsługi wyjątków generowanych przez kontynuacje, jak można obsługiwać je w każdym innym zadaniu, w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="f5cfd-215">Therefore, handle exceptions thrown by continuations as you would handle them in any other task, as follows:</span></span>  
  
- <span data-ttu-id="f5cfd-216">Można użyć <xref:System.Threading.Tasks.Task.Wait%2A>, <xref:System.Threading.Tasks.Task.WaitAll%2A>lub <xref:System.Threading.Tasks.Task.WaitAny%2A> metody lub jego odpowiednik rodzajowy, aby poczekać na kontynuację.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-216">You can use the <xref:System.Threading.Tasks.Task.Wait%2A>, <xref:System.Threading.Tasks.Task.WaitAll%2A>, or <xref:System.Threading.Tasks.Task.WaitAny%2A> method, or its generic counterpart, to wait on the continuation.</span></span> <span data-ttu-id="f5cfd-217">Można czekać na poprzednika i jego kontynuacji `try` w tej samej instrukcji, jak pokazano w poniższym przykładzie.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-217">You can wait for an antecedent and its continuations in the same `try` statement, as shown in the following example.</span></span>  
  
     [!code-csharp[TPL_Continuations#6](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_continuations/cs/exception1.cs#6)]
     [!code-vb[TPL_Continuations#6](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/exception1.vb#6)]  
  
- <span data-ttu-id="f5cfd-218">Można użyć drugiej kontynuacji <xref:System.Threading.Tasks.Task.Exception%2A> obserwować właściwość pierwszej kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-218">You can use a second continuation to observe the <xref:System.Threading.Tasks.Task.Exception%2A> property of the first continuation.</span></span> <span data-ttu-id="f5cfd-219">W poniższym przykładzie zadanie próbuje odczytać z pliku nieistniejącego.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-219">In the following example, a task attempts to read from a non-existent file.</span></span> <span data-ttu-id="f5cfd-220">Następnie kontynuacja wyświetla informacje o wyjątku w zadaniu poprzednika.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-220">The continuation then displays information about the exception in the antecedent task.</span></span>  
  
     [!code-csharp[TPL_Continuations#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_continuations/cs/exception2.cs#4)]
     [!code-vb[TPL_Continuations#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/exception2.vb#4)]  
  
     <span data-ttu-id="f5cfd-221">Ponieważ został uruchomiony <xref:System.Threading.Tasks.TaskContinuationOptions.OnlyOnFaulted?displayProperty=nameWithType> z opcją, kontynuacja jest wykonywana tylko wtedy, gdy wystąpi wyjątek w poprzedniku, a zatem można założyć, że właściwość poprzednika <xref:System.Threading.Tasks.Task.Exception%2A> nie `null`jest .</span><span class="sxs-lookup"><span data-stu-id="f5cfd-221">Because it was run with the <xref:System.Threading.Tasks.TaskContinuationOptions.OnlyOnFaulted?displayProperty=nameWithType> option, the continuation executes only if an exception occurs in the antecedent, and therefore it can assume that the antecedent's <xref:System.Threading.Tasks.Task.Exception%2A> property is not `null`.</span></span> <span data-ttu-id="f5cfd-222">Jeśli kontynuacja wykonuje, czy wyjątek jest zgłaszany w poprzednik, musiałby sprawdzić, czy <xref:System.Threading.Tasks.Task.Exception%2A> właściwość antecedent nie `null` jest przed podjęciem próby obsługi wyjątku, jak pokazano w poniższym fragmencie kodu.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-222">If the continuation executes whether or not an exception is thrown in the antecedent, it would have to check whether the antecedent's <xref:System.Threading.Tasks.Task.Exception%2A> property is not `null` before attempting to handle the exception, as the following code fragment shows.</span></span>  
  
     [!code-csharp[TPL_Continuations#11](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_continuations/cs/exception2.cs#11)]
     [!code-vb[TPL_Continuations#11](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_continuations/vb/exception2.vb#11)]  
  
     <span data-ttu-id="f5cfd-223">Aby uzyskać więcej informacji, zobacz [Obsługa wyjątków](../../../docs/standard/parallel-programming/exception-handling-task-parallel-library.md).</span><span class="sxs-lookup"><span data-stu-id="f5cfd-223">For more information, see [Exception Handling](../../../docs/standard/parallel-programming/exception-handling-task-parallel-library.md).</span></span>  
  
- <span data-ttu-id="f5cfd-224">Jeśli kontynuacja jest dołączonym zadaniem podrzędnym, który został utworzony przy użyciu <xref:System.Threading.Tasks.TaskContinuationOptions.AttachedToParent?displayProperty=nameWithType> opcji, jego wyjątki będą propagowane przez element nadrzędny z powrotem do wątku wywołującego, jak to ma miejsce w każdym innym dołączonym podrzędnym.</span><span class="sxs-lookup"><span data-stu-id="f5cfd-224">If the continuation is an attached child task that was created by using the <xref:System.Threading.Tasks.TaskContinuationOptions.AttachedToParent?displayProperty=nameWithType> option, its exceptions will be propagated by the parent back to the calling thread, as is the case in any other attached child.</span></span> <span data-ttu-id="f5cfd-225">Aby uzyskać więcej informacji, zobacz [Dołączone i odłączone zadania podrzędne](../../../docs/standard/parallel-programming/attached-and-detached-child-tasks.md).</span><span class="sxs-lookup"><span data-stu-id="f5cfd-225">For more information, see [Attached and Detached Child Tasks](../../../docs/standard/parallel-programming/attached-and-detached-child-tasks.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f5cfd-226">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="f5cfd-226">See also</span></span>

- [<span data-ttu-id="f5cfd-227">Biblioteka zadań równoległych (TPL)</span><span class="sxs-lookup"><span data-stu-id="f5cfd-227">Task Parallel Library (TPL)</span></span>](../../../docs/standard/parallel-programming/task-parallel-library-tpl.md)
