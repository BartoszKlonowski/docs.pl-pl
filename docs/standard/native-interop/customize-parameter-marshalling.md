---
title: Dostosowywanie parametrów kierowania — .NET
description: Dowiedz się, jak dostosować, jak .NET kieruje parametry do natywną reprezentację.
author: jkoritzinsky
ms.author: jekoritz
ms.date: 01/18/2019
ms.openlocfilehash: 7821da546e0ed0ab5fa97d00a638aa5cc1a3089c
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/23/2019
ms.locfileid: "61973592"
---
# <a name="customizing-parameter-marshalling"></a><span data-ttu-id="17bfd-103">Dostosowywanie parametrów kierowania</span><span class="sxs-lookup"><span data-stu-id="17bfd-103">Customizing parameter marshalling</span></span>

<span data-ttu-id="17bfd-104">Podczas zachowanie kierujące parametr domyślne środowisko uruchomieniowe platformy .NET nie robi, co chcesz zrobić, użyj można użyć <xref:System.Runtime.InteropServices.MarshalAsAttribute?displayProperty=nameWithType> atrybutu, aby dostosować, jak parametry są przekazywane.</span><span class="sxs-lookup"><span data-stu-id="17bfd-104">When the .NET runtime's default parameter marshalling behavior doesn't do what you want, use can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute?displayProperty=nameWithType> attribute to customize how your parameters are marshaled.</span></span>

## <a name="customizing-string-parameters"></a><span data-ttu-id="17bfd-105">Dostosowywanie parametrów</span><span class="sxs-lookup"><span data-stu-id="17bfd-105">Customizing string parameters</span></span>

<span data-ttu-id="17bfd-106">.NET zawiera różne formaty ciągów zarządzany.</span><span class="sxs-lookup"><span data-stu-id="17bfd-106">.NET has a variety of formats for marshalling strings.</span></span> <span data-ttu-id="17bfd-107">Te metody są dzielone na różne sekcje na ciągi stylu C i skoncentrowane na Windows formaty ciągu.</span><span class="sxs-lookup"><span data-stu-id="17bfd-107">These methods are split into distinct sections on C-style strings and Windows-centric string formats.</span></span>

### <a name="c-style-strings"></a><span data-ttu-id="17bfd-108">Ciągi stylu C</span><span class="sxs-lookup"><span data-stu-id="17bfd-108">C-Style strings</span></span>

<span data-ttu-id="17bfd-109">Każda z tych formatów przekazuje ciąg zakończony wartością null do kodu natywnego.</span><span class="sxs-lookup"><span data-stu-id="17bfd-109">Each of these formats passes a null-terminated string to native code.</span></span> <span data-ttu-id="17bfd-110">Różnią się one kodowanie ciągu natywnych.</span><span class="sxs-lookup"><span data-stu-id="17bfd-110">They differ by the encoding of the native string.</span></span>

| <span data-ttu-id="17bfd-111">`System.Runtime.InteropServices.UnmanagedType` Wartość</span><span class="sxs-lookup"><span data-stu-id="17bfd-111">`System.Runtime.InteropServices.UnmanagedType` value</span></span> | <span data-ttu-id="17bfd-112">Kodowanie</span><span class="sxs-lookup"><span data-stu-id="17bfd-112">Encoding</span></span> |
|------------------------------------------------------|----------|
| <span data-ttu-id="17bfd-113">LPStr</span><span class="sxs-lookup"><span data-stu-id="17bfd-113">LPStr</span></span> | <span data-ttu-id="17bfd-114">ANSI</span><span class="sxs-lookup"><span data-stu-id="17bfd-114">ANSI</span></span> |
| <span data-ttu-id="17bfd-115">LPUTF8Str</span><span class="sxs-lookup"><span data-stu-id="17bfd-115">LPUTF8Str</span></span> | <span data-ttu-id="17bfd-116">UTF-8</span><span class="sxs-lookup"><span data-stu-id="17bfd-116">UTF-8</span></span> | 
| <span data-ttu-id="17bfd-117">LPWStr</span><span class="sxs-lookup"><span data-stu-id="17bfd-117">LPWStr</span></span> | <span data-ttu-id="17bfd-118">UTF-16</span><span class="sxs-lookup"><span data-stu-id="17bfd-118">UTF-16</span></span> |

<span data-ttu-id="17bfd-119"><xref:System.Runtime.InteropServices.UnmanagedType.VBByRefStr?displayProperty=nameWithType> Format jest nieco inny.</span><span class="sxs-lookup"><span data-stu-id="17bfd-119">The <xref:System.Runtime.InteropServices.UnmanagedType.VBByRefStr?displayProperty=nameWithType> format is slightly different.</span></span> <span data-ttu-id="17bfd-120">Podobnie jak `LPWStr`, kieruje go ciągu na ciąg stylu C natywnych zakodowane w formacie UTF-16.</span><span class="sxs-lookup"><span data-stu-id="17bfd-120">Like `LPWStr`, it marshals the string to a native C-style string encoded in UTF-16.</span></span> <span data-ttu-id="17bfd-121">Jednak ma zarządzanego podpisu, należy przekazać w ciągu przez odwołanie i pasujący podpis natywnych przenosi ciąg przez wartość.</span><span class="sxs-lookup"><span data-stu-id="17bfd-121">However, the managed signature has you pass in the string by reference and the matching native signature takes the string by value.</span></span> <span data-ttu-id="17bfd-122">Wykonywania tego rozróżnienia pozwala na używanie natywnych interfejsów API, przyjmuje ciąg przez wartość, która modyfikuje go w miejscu bez konieczności używania `StringBuilder`.</span><span class="sxs-lookup"><span data-stu-id="17bfd-122">This distinction allows you to use a native API that takes a string by value and modifies it in-place without having to use a `StringBuilder`.</span></span> <span data-ttu-id="17bfd-123">Zaleca się ręcznie przy użyciu tego formatu, ponieważ jest podatny na dezorientację z niezgodną sygnaturami natywne i zarządzane.</span><span class="sxs-lookup"><span data-stu-id="17bfd-123">We recommend against manually using this format since it's prone to cause confusion with the mismatching native and managed signatures.</span></span>

### <a name="windows-centric-string-formats"></a><span data-ttu-id="17bfd-124">Formaty ciągu skoncentrowane na Windows</span><span class="sxs-lookup"><span data-stu-id="17bfd-124">Windows-centric string formats</span></span>

<span data-ttu-id="17bfd-125">Podczas interakcji z interfejsem COM lub OLE, prawdopodobnie okaże, funkcje natywne pobierają ciągi jako `BSTR` argumentów.</span><span class="sxs-lookup"><span data-stu-id="17bfd-125">When interacting with COM or OLE interfaces, you'll likely find that the native functions take strings as `BSTR` arguments.</span></span> <span data-ttu-id="17bfd-126">Możesz użyć <xref:System.Runtime.InteropServices.UnmanagedType.BStr?displayProperty=nameWithType> niezarządzany typ, aby kierować ciąg w kodowaniu `BSTR`.</span><span class="sxs-lookup"><span data-stu-id="17bfd-126">You can use the <xref:System.Runtime.InteropServices.UnmanagedType.BStr?displayProperty=nameWithType> unmanaged type to marshal a string as a `BSTR`.</span></span>

<span data-ttu-id="17bfd-127">Jeśli masz interakcje interfejsów API WinRT, możesz użyć <xref:System.Runtime.InteropServices.UnmanagedType.HString?displayProperty=nameWithType> format, aby kierować ciąg w kodowaniu `HSTRING`.</span><span class="sxs-lookup"><span data-stu-id="17bfd-127">If you're interacting with WinRT APIs, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.HString?displayProperty=nameWithType> format to marshal a string as an `HSTRING`.</span></span>

## <a name="customizing-array-parameters"></a><span data-ttu-id="17bfd-128">Dostosowywanie tablicy parametrów</span><span class="sxs-lookup"><span data-stu-id="17bfd-128">Customizing array parameters</span></span>

<span data-ttu-id="17bfd-129">.NET zawiera również wiele sposobów, aby marshal tablicy parametrów.</span><span class="sxs-lookup"><span data-stu-id="17bfd-129">.NET also provides you multiple ways to marshal array parameters.</span></span> <span data-ttu-id="17bfd-130">Jeśli w przypadku wywoływania interfejsu API, który przyjmuje tablicy stylu C, należy użyć <xref:System.Runtime.InteropServices.UnmanagedType.LPArray?displayProperty=nameWithType> niezarządzanego typu.</span><span class="sxs-lookup"><span data-stu-id="17bfd-130">If you're calling an API that takes a C-style array, use the <xref:System.Runtime.InteropServices.UnmanagedType.LPArray?displayProperty=nameWithType> unmanaged type.</span></span> <span data-ttu-id="17bfd-131">Jeśli kierowania dostosowanych wartości w tablicy, możesz użyć <xref:System.Runtime.InteropServices.MarshalAsAttribute.ArraySubType> na `[MarshalAs]` atrybutu dla tego.</span><span class="sxs-lookup"><span data-stu-id="17bfd-131">If the values in the array need customized marshalling, you can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute.ArraySubType> field on the `[MarshalAs]` attribute for that.</span></span>

<span data-ttu-id="17bfd-132">Jeśli używasz interfejsów API modelu COM, prawdopodobnie będziesz mieć do organizowania parametry tablicy jako `SAFEARRAY*`s.</span><span class="sxs-lookup"><span data-stu-id="17bfd-132">If you're using COM APIs, you'll likely have to marshal your array parameters as `SAFEARRAY*`s.</span></span> <span data-ttu-id="17bfd-133">Aby to zrobić, można użyć <xref:System.Runtime.InteropServices.UnmanagedType.SafeArray?displayProperty=nameWithType> niezarządzanego typu.</span><span class="sxs-lookup"><span data-stu-id="17bfd-133">To do so, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.SafeArray?displayProperty=nameWithType> unmanaged type.</span></span> <span data-ttu-id="17bfd-134">Domyślny typ elementów `SAFEARRAY` będą widoczne w tabeli na [dostosowywanie `object` pola](./customize-struct-marshalling.md#marshalling-systemobjects).</span><span class="sxs-lookup"><span data-stu-id="17bfd-134">The default type of the elements of the `SAFEARRAY` can be seen in the table on [customizing `object` fields](./customize-struct-marshalling.md#marshalling-systemobjects).</span></span> <span data-ttu-id="17bfd-135">Możesz użyć <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArraySubType?displayProperty=nameWithType> i <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArrayUserDefinedSubType?displayProperty=nameWithType> typu pola, aby dostosować element dokładnie `SAFEARRAY`.</span><span class="sxs-lookup"><span data-stu-id="17bfd-135">You can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArraySubType?displayProperty=nameWithType> and <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArrayUserDefinedSubType?displayProperty=nameWithType> fields to customize the exact element type of the `SAFEARRAY`.</span></span>

## <a name="customizing-boolean-or-decimal-parameters"></a><span data-ttu-id="17bfd-136">Dostosowywanie parametrów logiczną lub dziesiętną</span><span class="sxs-lookup"><span data-stu-id="17bfd-136">Customizing boolean or decimal parameters</span></span>

<span data-ttu-id="17bfd-137">Instrukcje dotyczące kierowania logiczną lub dziesiętną parametrów, zobacz [Dostosowywanie struktury kierowania](customize-struct-marshalling.md).</span><span class="sxs-lookup"><span data-stu-id="17bfd-137">For information on marshalling boolean or decimal parameters, see [Customizing structure marshalling](customize-struct-marshalling.md).</span></span>

## <a name="customizing-object-parameters-windows-only"></a><span data-ttu-id="17bfd-138">Dostosowywanie parametrów obiektu (tylko Windows)</span><span class="sxs-lookup"><span data-stu-id="17bfd-138">Customizing object parameters (Windows-only)</span></span>

<span data-ttu-id="17bfd-139">W Windows środowisko uruchomieniowe platformy .NET udostępnia wiele różnych sposobów, aby zorganizować parametrów obiektu do kodu macierzystego.</span><span class="sxs-lookup"><span data-stu-id="17bfd-139">On Windows, the .NET runtime provides a number of different ways to marshal object parameters to native code.</span></span>

### <a name="marshalling-as-specific-com-interfaces"></a><span data-ttu-id="17bfd-140">Kierowania jako określonych interfejsów COM</span><span class="sxs-lookup"><span data-stu-id="17bfd-140">Marshalling as specific COM interfaces</span></span>

<span data-ttu-id="17bfd-141">Jeśli Twój interfejs API pobiera wskaźnik do obiektu COM, można użyć dowolnej z następujących `UnmanagedType` formatuje na `object`-wpisane parametru, aby poinformować .NET do organizowania jako tych określonych interfejsów:</span><span class="sxs-lookup"><span data-stu-id="17bfd-141">If your API takes a pointer to a COM object, you can use any of the following `UnmanagedType` formats on an `object`-typed parameter to tell .NET to marshal as these specific interfaces:</span></span>

- `IUnknown`
- `IDispatch`
- `IInspectable`

<span data-ttu-id="17bfd-142">Ponadto jeśli Twój typ jest oznaczony `[ComVisible(true)]` lub w przypadku kierowania `object` typu, można użyć <xref:System.Runtime.InteropServices.UnmanagedType.Interface?displayProperty=nameWithType> format marshalingu obiektu jako wywołalne opakowanie COM dla widoku COM tego typu.</span><span class="sxs-lookup"><span data-stu-id="17bfd-142">Additionally, if your type is marked `[ComVisible(true)]` or you're marshalling the `object` type, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.Interface?displayProperty=nameWithType> format to marshal your object as a COM callable wrapper for the COM view of your type.</span></span>

### <a name="marshalling-to-a-variant"></a><span data-ttu-id="17bfd-143">Kierowania do `VARIANT`</span><span class="sxs-lookup"><span data-stu-id="17bfd-143">Marshalling to a `VARIANT`</span></span>

<span data-ttu-id="17bfd-144">Jeśli natywnego interfejsu API systemu Win32 `VARIANT`, możesz użyć <xref:System.Runtime.InteropServices.UnmanagedType.Struct?displayProperty=nameWithType> sformatować w swojej `object` parametru do organizowania obiektów jako `VARIANT`s.</span><span class="sxs-lookup"><span data-stu-id="17bfd-144">If your native API takes a Win32 `VARIANT`, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.Struct?displayProperty=nameWithType> format on your `object` parameter to marshal your objects as `VARIANT`s.</span></span> <span data-ttu-id="17bfd-145">Zajrzyj do dokumentacji na [dostosowywanie `object` pola](customize-struct-marshalling.md#marshalling-systemobjects) mapowania między typami .NET i `VARIANT` typów.</span><span class="sxs-lookup"><span data-stu-id="17bfd-145">See the documentation on [customizing `object` fields](customize-struct-marshalling.md#marshalling-systemobjects) for a mapping between .NET types and `VARIANT` types.</span></span>

### <a name="custom-marshalers"></a><span data-ttu-id="17bfd-146">Niestandardowi</span><span class="sxs-lookup"><span data-stu-id="17bfd-146">Custom marshalers</span></span>

<span data-ttu-id="17bfd-147">Jeśli chcesz wyświetlić macierzysty interfejs COM do innego typu zarządzanego, możesz użyć `UnmanagedType.CustomMarshaler` format i implementację <xref:System.Runtime.InteropServices.ICustomMarshaler> zapewnienie własny niestandardowy kod zarządzany.</span><span class="sxs-lookup"><span data-stu-id="17bfd-147">If you want to project a native COM interface into a different managed type, you can use the `UnmanagedType.CustomMarshaler` format and an implementation of <xref:System.Runtime.InteropServices.ICustomMarshaler> to provide your own custom marshalling code.</span></span>
