---
title: Dostosowywanie organizowania parametrów — .NET
description: Dowiedz się, jak dostosować sposób organizowania parametrów przez platformę .NET do natywnej reprezentacji.
ms.date: 01/18/2019
ms.openlocfilehash: 36fb8c105a8836d77b862095a616de3ba641073c
ms.sourcegitcommit: 5f236cd78cf09593c8945a7d753e0850e96a0b80
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 01/07/2020
ms.locfileid: "75706364"
---
# <a name="customizing-parameter-marshaling"></a><span data-ttu-id="4be3e-103">Dostosowywanie marshalingu parametrów</span><span class="sxs-lookup"><span data-stu-id="4be3e-103">Customizing parameter marshaling</span></span>

<span data-ttu-id="4be3e-104">Gdy domyślne zachowanie podczas organizowania parametrów środowiska uruchomieniowego platformy .NET nie wykonuje tego zadania, można użyć atrybutu <xref:System.Runtime.InteropServices.MarshalAsAttribute?displayProperty=nameWithType>, aby dostosować sposób organizowania parametrów.</span><span class="sxs-lookup"><span data-stu-id="4be3e-104">When the .NET runtime's default parameter marshaling behavior doesn't do what you want, use can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute?displayProperty=nameWithType> attribute to customize how your parameters are marshaled.</span></span>

## <a name="customizing-string-parameters"></a><span data-ttu-id="4be3e-105">Dostosowywanie parametrów ciągu</span><span class="sxs-lookup"><span data-stu-id="4be3e-105">Customizing string parameters</span></span>

<span data-ttu-id="4be3e-106">Platforma .NET ma różne formaty do organizowania ciągów.</span><span class="sxs-lookup"><span data-stu-id="4be3e-106">.NET has a variety of formats for marshaling strings.</span></span> <span data-ttu-id="4be3e-107">Te metody są podzielone na różne sekcje w ciągach w stylu C i w formatach ciągów skoncentrowanych na systemie Windows.</span><span class="sxs-lookup"><span data-stu-id="4be3e-107">These methods are split into distinct sections on C-style strings and Windows-centric string formats.</span></span>

### <a name="c-style-strings"></a><span data-ttu-id="4be3e-108">Ciągi w stylu języka C</span><span class="sxs-lookup"><span data-stu-id="4be3e-108">C-Style strings</span></span>

<span data-ttu-id="4be3e-109">Każdy z tych formatów przekazuje ciąg zakończony znakiem null do kodu natywnego.</span><span class="sxs-lookup"><span data-stu-id="4be3e-109">Each of these formats passes a null-terminated string to native code.</span></span> <span data-ttu-id="4be3e-110">Różnią się one od kodowania ciągu macierzystego.</span><span class="sxs-lookup"><span data-stu-id="4be3e-110">They differ by the encoding of the native string.</span></span>

| <span data-ttu-id="4be3e-111">wartość `System.Runtime.InteropServices.UnmanagedType`</span><span class="sxs-lookup"><span data-stu-id="4be3e-111">`System.Runtime.InteropServices.UnmanagedType` value</span></span> | <span data-ttu-id="4be3e-112">Kodowanie</span><span class="sxs-lookup"><span data-stu-id="4be3e-112">Encoding</span></span> |
|------------------------------------------------------|----------|
| <span data-ttu-id="4be3e-113">LPStr</span><span class="sxs-lookup"><span data-stu-id="4be3e-113">LPStr</span></span> | <span data-ttu-id="4be3e-114">ANSI</span><span class="sxs-lookup"><span data-stu-id="4be3e-114">ANSI</span></span> |
| <span data-ttu-id="4be3e-115">LPUTF8Str</span><span class="sxs-lookup"><span data-stu-id="4be3e-115">LPUTF8Str</span></span> | <span data-ttu-id="4be3e-116">UTF-8</span><span class="sxs-lookup"><span data-stu-id="4be3e-116">UTF-8</span></span> | 
| <span data-ttu-id="4be3e-117">LPWStr</span><span class="sxs-lookup"><span data-stu-id="4be3e-117">LPWStr</span></span> | <span data-ttu-id="4be3e-118">UTF-16</span><span class="sxs-lookup"><span data-stu-id="4be3e-118">UTF-16</span></span> |
| <span data-ttu-id="4be3e-119">LPTStr</span><span class="sxs-lookup"><span data-stu-id="4be3e-119">LPTStr</span></span> | <span data-ttu-id="4be3e-120">UTF-16</span><span class="sxs-lookup"><span data-stu-id="4be3e-120">UTF-16</span></span> |

<span data-ttu-id="4be3e-121">Format <xref:System.Runtime.InteropServices.UnmanagedType.VBByRefStr?displayProperty=nameWithType> jest nieco inny.</span><span class="sxs-lookup"><span data-stu-id="4be3e-121">The <xref:System.Runtime.InteropServices.UnmanagedType.VBByRefStr?displayProperty=nameWithType> format is slightly different.</span></span> <span data-ttu-id="4be3e-122">Podobnie jak `LPWStr`, organizowane jest ciąg do natywnego ciągu w stylu C zakodowanego w UTF-16.</span><span class="sxs-lookup"><span data-stu-id="4be3e-122">Like `LPWStr`, it marshals the string to a native C-style string encoded in UTF-16.</span></span> <span data-ttu-id="4be3e-123">Jednak sygnatura zarządzana przekazuje ciąg przez odwołanie, a pasujący podpis macierzysty przyjmuje ciąg przez wartość.</span><span class="sxs-lookup"><span data-stu-id="4be3e-123">However, the managed signature has you pass in the string by reference and the matching native signature takes the string by value.</span></span> <span data-ttu-id="4be3e-124">To rozróżnienie umożliwia użycie natywnego interfejsu API, który przyjmuje ciąg przez wartość i modyfikuje go w miejscu bez konieczności używania `StringBuilder`.</span><span class="sxs-lookup"><span data-stu-id="4be3e-124">This distinction allows you to use a native API that takes a string by value and modifies it in-place without having to use a `StringBuilder`.</span></span> <span data-ttu-id="4be3e-125">Zalecamy ręczne korzystanie z tego formatu, ponieważ jest podatny na pomyłkę w przypadku niezgodności z niezgodnymi z nimi i zarządzanymi podpisami.</span><span class="sxs-lookup"><span data-stu-id="4be3e-125">We recommend against manually using this format since it's prone to cause confusion with the mismatching native and managed signatures.</span></span>

### <a name="windows-centric-string-formats"></a><span data-ttu-id="4be3e-126">Formaty ciągu skoncentrowane na systemie Windows</span><span class="sxs-lookup"><span data-stu-id="4be3e-126">Windows-centric string formats</span></span>

<span data-ttu-id="4be3e-127">W przypadku korzystania z interfejsów COM lub OLE prawdopodobnie okaże się, że funkcje natywne przyjmują ciągi jako argumenty `BSTR`.</span><span class="sxs-lookup"><span data-stu-id="4be3e-127">When interacting with COM or OLE interfaces, you'll likely find that the native functions take strings as `BSTR` arguments.</span></span> <span data-ttu-id="4be3e-128">Możesz użyć niezarządzanego typu <xref:System.Runtime.InteropServices.UnmanagedType.BStr?displayProperty=nameWithType>, aby zorganizować ciąg jako `BSTR`.</span><span class="sxs-lookup"><span data-stu-id="4be3e-128">You can use the <xref:System.Runtime.InteropServices.UnmanagedType.BStr?displayProperty=nameWithType> unmanaged type to marshal a string as a `BSTR`.</span></span>

<span data-ttu-id="4be3e-129">Jeśli korzystasz z interfejsów API WinRT, możesz użyć formatu <xref:System.Runtime.InteropServices.UnmanagedType.HString?displayProperty=nameWithType>, aby zorganizować ciąg jako `HSTRING`.</span><span class="sxs-lookup"><span data-stu-id="4be3e-129">If you're interacting with WinRT APIs, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.HString?displayProperty=nameWithType> format to marshal a string as an `HSTRING`.</span></span>

## <a name="customizing-array-parameters"></a><span data-ttu-id="4be3e-130">Dostosowywanie parametrów tablicy</span><span class="sxs-lookup"><span data-stu-id="4be3e-130">Customizing array parameters</span></span>

<span data-ttu-id="4be3e-131">Platforma .NET udostępnia również wiele sposobów organizowania parametrów tablicowych.</span><span class="sxs-lookup"><span data-stu-id="4be3e-131">.NET also provides you multiple ways to marshal array parameters.</span></span> <span data-ttu-id="4be3e-132">Jeśli wywołujesz interfejs API, który pobiera tablicę w stylu C, użyj <xref:System.Runtime.InteropServices.UnmanagedType.LPArray?displayProperty=nameWithType> typu niezarządzanego.</span><span class="sxs-lookup"><span data-stu-id="4be3e-132">If you're calling an API that takes a C-style array, use the <xref:System.Runtime.InteropServices.UnmanagedType.LPArray?displayProperty=nameWithType> unmanaged type.</span></span> <span data-ttu-id="4be3e-133">Jeśli wartości w tablicy wymagają dostosowanego kierowania, można użyć pola <xref:System.Runtime.InteropServices.MarshalAsAttribute.ArraySubType> w atrybucie `[MarshalAs]` dla tego elementu.</span><span class="sxs-lookup"><span data-stu-id="4be3e-133">If the values in the array need customized marshaling, you can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute.ArraySubType> field on the `[MarshalAs]` attribute for that.</span></span>

<span data-ttu-id="4be3e-134">Jeśli używasz interfejsów API modelu COM, prawdopodobnie trzeba będzie zorganizować parametry tablicy jako `SAFEARRAY*`s.</span><span class="sxs-lookup"><span data-stu-id="4be3e-134">If you're using COM APIs, you'll likely have to marshal your array parameters as `SAFEARRAY*`s.</span></span> <span data-ttu-id="4be3e-135">W tym celu można użyć typu niezarządzanego <xref:System.Runtime.InteropServices.UnmanagedType.SafeArray?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="4be3e-135">To do so, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.SafeArray?displayProperty=nameWithType> unmanaged type.</span></span> <span data-ttu-id="4be3e-136">Domyślny typ elementów `SAFEARRAY` można zobaczyć w tabeli na temat [dostosowywania pól `object`](./customize-struct-marshaling.md#marshaling-systemobjects).</span><span class="sxs-lookup"><span data-stu-id="4be3e-136">The default type of the elements of the `SAFEARRAY` can be seen in the table on [customizing `object` fields](./customize-struct-marshaling.md#marshaling-systemobjects).</span></span> <span data-ttu-id="4be3e-137">Można użyć pól <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArraySubType?displayProperty=nameWithType> i <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArrayUserDefinedSubType?displayProperty=nameWithType> do dostosowania dokładnego typu elementu `SAFEARRAY`.</span><span class="sxs-lookup"><span data-stu-id="4be3e-137">You can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArraySubType?displayProperty=nameWithType> and <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArrayUserDefinedSubType?displayProperty=nameWithType> fields to customize the exact element type of the `SAFEARRAY`.</span></span>

## <a name="customizing-boolean-or-decimal-parameters"></a><span data-ttu-id="4be3e-138">Dostosowywanie parametrów logicznych lub dziesiętnych</span><span class="sxs-lookup"><span data-stu-id="4be3e-138">Customizing boolean or decimal parameters</span></span>

<span data-ttu-id="4be3e-139">Aby uzyskać informacje na temat organizowania parametrów logicznych lub dziesiętnych, zobacz [Dostosowywanie organizowania struktury](customize-struct-marshaling.md).</span><span class="sxs-lookup"><span data-stu-id="4be3e-139">For information on marshaling boolean or decimal parameters, see [Customizing structure marshaling](customize-struct-marshaling.md).</span></span>

## <a name="customizing-object-parameters-windows-only"></a><span data-ttu-id="4be3e-140">Dostosowywanie parametrów obiektu (tylko system Windows)</span><span class="sxs-lookup"><span data-stu-id="4be3e-140">Customizing object parameters (Windows-only)</span></span>

<span data-ttu-id="4be3e-141">W systemie Windows środowisko uruchomieniowe platformy .NET udostępnia wiele różnych sposobów organizowania parametrów obiektów w kodzie natywnym.</span><span class="sxs-lookup"><span data-stu-id="4be3e-141">On Windows, the .NET runtime provides a number of different ways to marshal object parameters to native code.</span></span>

### <a name="marshaling-as-specific-com-interfaces"></a><span data-ttu-id="4be3e-142">Kierowanie jako określonych interfejsów COM</span><span class="sxs-lookup"><span data-stu-id="4be3e-142">Marshaling as specific COM interfaces</span></span>

<span data-ttu-id="4be3e-143">Jeśli Twój interfejs API przyjmuje wskaźnik do obiektu COM, można użyć dowolnego z poniższych `UnmanagedType` formatów na parametrze typu `object`, aby poinformować platformę .NET, aby mogli zorganizować się jako te określone interfejsy:</span><span class="sxs-lookup"><span data-stu-id="4be3e-143">If your API takes a pointer to a COM object, you can use any of the following `UnmanagedType` formats on an `object`-typed parameter to tell .NET to marshal as these specific interfaces:</span></span>

- `IUnknown`
- `IDispatch`
- `IInspectable`

<span data-ttu-id="4be3e-144">Ponadto, jeśli typ jest oznaczony `[ComVisible(true)]` lub organizowane jest typ `object`, można użyć formatu <xref:System.Runtime.InteropServices.UnmanagedType.Interface?displayProperty=nameWithType> do organizowania obiektu jako otoki COM dla widoku COM dla danego typu.</span><span class="sxs-lookup"><span data-stu-id="4be3e-144">Additionally, if your type is marked `[ComVisible(true)]` or you're marshaling the `object` type, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.Interface?displayProperty=nameWithType> format to marshal your object as a COM callable wrapper for the COM view of your type.</span></span>

### <a name="marshaling-to-a-variant"></a><span data-ttu-id="4be3e-145">Kierowanie do `VARIANT`</span><span class="sxs-lookup"><span data-stu-id="4be3e-145">Marshaling to a `VARIANT`</span></span>

<span data-ttu-id="4be3e-146">Jeśli natywny interfejs API przyjmuje `VARIANT`Win32, można użyć formatu <xref:System.Runtime.InteropServices.UnmanagedType.Struct?displayProperty=nameWithType> na `object` parametr, aby zorganizować obiekty jako `VARIANT`s.</span><span class="sxs-lookup"><span data-stu-id="4be3e-146">If your native API takes a Win32 `VARIANT`, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.Struct?displayProperty=nameWithType> format on your `object` parameter to marshal your objects as `VARIANT`s.</span></span> <span data-ttu-id="4be3e-147">Zapoznaj się z dokumentacją dotyczącą [dostosowywania `object` pól](customize-struct-marshaling.md#marshaling-systemobjects) , aby uzyskać mapowanie między typami .net a typami `VARIANT`.</span><span class="sxs-lookup"><span data-stu-id="4be3e-147">See the documentation on [customizing `object` fields](customize-struct-marshaling.md#marshaling-systemobjects) for a mapping between .NET types and `VARIANT` types.</span></span>

### <a name="custom-marshalers"></a><span data-ttu-id="4be3e-148">Organizatorzy niestandardowi</span><span class="sxs-lookup"><span data-stu-id="4be3e-148">Custom marshalers</span></span>

<span data-ttu-id="4be3e-149">Jeśli chcesz utworzyć projekt natywnego interfejsu COM w innym typie zarządzanym, możesz użyć formatu `UnmanagedType.CustomMarshaler` i implementacji <xref:System.Runtime.InteropServices.ICustomMarshaler>, aby zapewnić własny, niestandardowy kod do organizowania.</span><span class="sxs-lookup"><span data-stu-id="4be3e-149">If you want to project a native COM interface into a different managed type, you can use the `UnmanagedType.CustomMarshaler` format and an implementation of <xref:System.Runtime.InteropServices.ICustomMarshaler> to provide your own custom marshaling code.</span></span>
