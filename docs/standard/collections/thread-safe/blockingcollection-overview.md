---
title: BlockingCollection — Przegląd
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- BlockingCollection, overview
ms.assetid: 987ea3d7-0ad5-4238-8b64-331ce4eb3f0b
author: mairaw
ms.author: mairaw
ms.openlocfilehash: 257435516b38d0e4389b7feceba68371bcc8f90e
ms.sourcegitcommit: 213292dfbb0c37d83f62709959ff55c50af5560d
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 09/25/2018
ms.locfileid: "47111051"
---
# <a name="blockingcollection-overview"></a><span data-ttu-id="eb9a0-102">BlockingCollection — Przegląd</span><span class="sxs-lookup"><span data-stu-id="eb9a0-102">BlockingCollection Overview</span></span>
<span data-ttu-id="eb9a0-103"><xref:System.Collections.Concurrent.BlockingCollection%601> jest klasą wątkowo kolekcji, która oferuje następujące funkcje:</span><span class="sxs-lookup"><span data-stu-id="eb9a0-103"><xref:System.Collections.Concurrent.BlockingCollection%601> is a thread-safe collection class that provides the following features:</span></span>  
  
-   <span data-ttu-id="eb9a0-104">Implementacja wzorca producent — konsument.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-104">An implementation of the Producer-Consumer pattern.</span></span>  
  
-   <span data-ttu-id="eb9a0-105">Równocześnie Dodawanie i pobieranie elementów z wielu wątków.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-105">Concurrent adding and taking of items from multiple threads.</span></span>  
  
-   <span data-ttu-id="eb9a0-106">Opcjonalne maksymalnej pojemności.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-106">Optional maximum capacity.</span></span>  
  
-   <span data-ttu-id="eb9a0-107">Operacje wstawiania i usuwania, które zablokować, jeśli kolekcja jest pusta lub pełne.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-107">Insertion and removal operations that block when collection is empty or full.</span></span>  
  
-   <span data-ttu-id="eb9a0-108">Wstawiania i usuwania "try" operacje nie należy blokować lub Blokuj, aż w wybranym okresie.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-108">Insertion and removal "try" operations that do not block or that block up to a specified period of time.</span></span>  
  
-   <span data-ttu-id="eb9a0-109">Hermetyzuje dowolny typ kolekcji, który implementuje <xref:System.Collections.Concurrent.IProducerConsumerCollection%601></span><span class="sxs-lookup"><span data-stu-id="eb9a0-109">Encapsulates any collection type that implements <xref:System.Collections.Concurrent.IProducerConsumerCollection%601></span></span>  
  
-   <span data-ttu-id="eb9a0-110">Unieważnieniu przy użyciu tokenów anulowania.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-110">Cancellation with cancellation tokens.</span></span>  
  
-   <span data-ttu-id="eb9a0-111">Dwa rodzaje wyliczenie z `foreach` (`For Each` w języku Visual Basic):</span><span class="sxs-lookup"><span data-stu-id="eb9a0-111">Two kinds of enumeration with `foreach` (`For Each` in Visual Basic):</span></span>  
  
    1.  <span data-ttu-id="eb9a0-112">Wyliczenie tylko do odczytu.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-112">Read-only enumeration.</span></span>  
  
    2.  <span data-ttu-id="eb9a0-113">Wyliczenie, które usuwa elementy, jak wyliczane są.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-113">Enumeration that removes items as they are enumerated.</span></span>  
  
## <a name="bounding-and-blocking-support"></a><span data-ttu-id="eb9a0-114">Blokujących i ograniczających pomocy technicznej</span><span class="sxs-lookup"><span data-stu-id="eb9a0-114">Bounding and Blocking Support</span></span>  
 <span data-ttu-id="eb9a0-115"><xref:System.Collections.Concurrent.BlockingCollection%601> obsługuje blokujących i ograniczających.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-115"><xref:System.Collections.Concurrent.BlockingCollection%601> supports bounding and blocking.</span></span> <span data-ttu-id="eb9a0-116">Blokujących oznacza, że można ustawić maksymalną pojemność kolekcji.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-116">Bounding means you can set the maximum capacity of the collection.</span></span> <span data-ttu-id="eb9a0-117">Blokujących jest ważne w niektórych scenariuszach, ponieważ pozwala na sterowanie maksymalny rozmiar kolekcji w pamięci i uniemożliwia tworzenie wątków przeniesienie zbyt daleko wcześniej konsumencki wątków.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-117">Bounding is important in certain scenarios because it enables you to control the maximum size of the collection in memory, and it prevents the producing threads from moving too far ahead of the consuming threads.</span></span>  
  
 <span data-ttu-id="eb9a0-118">Wiele wątków lub zadań można dodawać elementy do kolekcji jednocześnie, a jeśli kolekcja osiągnie określoną maksymalną pojemność, Tworzenie wątków zablokuje do momentu usunięcia elementu.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-118">Multiple threads or tasks can add items to the collection concurrently, and if the collection reaches its specified maximum capacity, the producing threads will block until an item is removed.</span></span> <span data-ttu-id="eb9a0-119">Wielu odbiorców jednocześnie usunąć elementy, a jeśli kolekcja staje się puste, wątki konsumencki spowoduje zablokowanie aż producent dodaje element.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-119">Multiple consumers can remove items concurrently, and if the collection becomes empty, the consuming threads will block until a producer adds an item.</span></span> <span data-ttu-id="eb9a0-120">Tworzenie wątku można wywołać <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A> do wskazania, zostaną dodane nie więcej elementów.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-120">A producing thread can call <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A> to indicate that no more items will be added.</span></span> <span data-ttu-id="eb9a0-121">Monitor konsumentów <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> właściwości, aby dowiedzieć się, gdy kolekcja jest pusta i nie więcej elementy zostaną dodane.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-121">Consumers monitor the <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> property to know when the collection is empty and no more items will be added.</span></span> <span data-ttu-id="eb9a0-122">Poniższy przykład pokazuje prosty BlockingCollection z ograniczoną pojemność 100.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-122">The following example shows a simple BlockingCollection with a bounded capacity of 100.</span></span> <span data-ttu-id="eb9a0-123">Zadanie producentów dodaje elementy do kolekcji, tak długo, jak niektóre zewnętrznych warunek jest spełniony, a następnie wywołuje <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A>.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-123">A producer task adds items to the collection as long as some external condition is true, and then calls <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A>.</span></span> <span data-ttu-id="eb9a0-124">Zadanie konsumenta trwa elementów do momentu <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> właściwość ma wartość true.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-124">The consumer task takes items until the <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> property is true.</span></span>  
  
 [!code-csharp[CDS_BlockingCollection#04](../../../../samples/snippets/csharp/VS_Snippets_Misc/cds_blockingcollection/cs/blockingcollection.cs#04)]
 [!code-vb[CDS_BlockingCollection#04](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/cds_blockingcollection/vb/introsnippetsbc.vb#04)]  
  
 <span data-ttu-id="eb9a0-125">Aby uzyskać kompletny przykład, zobacz [porady: Dodawanie i pobieranie elementów osobno z kolekcji BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="eb9a0-125">For a complete example, see [How to: Add and Take Items Individually from a BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span></span>  
  
## <a name="timed-blocking-operations"></a><span data-ttu-id="eb9a0-126">Upłynął limit czasu operacji blokowania</span><span class="sxs-lookup"><span data-stu-id="eb9a0-126">Timed Blocking Operations</span></span>  
 <span data-ttu-id="eb9a0-127">W upłynął limit czasu blokowania <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> i <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> operacji na kolekcjach ograniczonych, metoda próbuje dodać lub wykonać element.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-127">In timed blocking <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> and <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> operations on bounded collections, the method tries to add or take an item.</span></span> <span data-ttu-id="eb9a0-128">Jeśli element jest dostępny jest umieszczany w zmiennej, która została przekazana przez odwołanie, a metoda zwraca wartość true.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-128">If an item is available it is placed into the variable that was passed in by reference, and the method returns true.</span></span> <span data-ttu-id="eb9a0-129">Jeśli żaden element nie jest pobierany po upływie limitu czasu określonego metoda zwraca wartość false.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-129">If no item is retrieved after a specified time-out period the method returns false.</span></span> <span data-ttu-id="eb9a0-130">Ten wątek jest następnie robić innych przydatnych działań przed podjęciem ponownej próby uzyskać dostęp do kolekcji.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-130">The thread is then free to do some other useful work before trying again to access the collection.</span></span> <span data-ttu-id="eb9a0-131">Na przykład blokowanie dostępu przez czasu Zobacz drugi przykład w [porady: Dodawanie i pobieranie elementów osobno z kolekcji BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="eb9a0-131">For an example of timed blocking access, see the second example in [How to: Add and Take Items Individually from a BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span></span>  
  
## <a name="cancelling-add-and-take-operations"></a><span data-ttu-id="eb9a0-132">Anulowania Dodawanie i pobieranie operacji</span><span class="sxs-lookup"><span data-stu-id="eb9a0-132">Cancelling Add and Take Operations</span></span>  
 <span data-ttu-id="eb9a0-133">Dodaj i wykonaj operacje są zazwyczaj wykonywane w pętli.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-133">Add and Take operations are typically performed in a loop.</span></span> <span data-ttu-id="eb9a0-134">Możesz anulować pętli, przekazując <xref:System.Threading.CancellationToken> do <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> lub <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> metody, a następnie zaznaczając wartość tokenu <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> właściwość w każdej iteracji.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-134">You can cancel a loop by passing in a <xref:System.Threading.CancellationToken> to the <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> or <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> method, and then checking the value of the token's <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> property on each iteration.</span></span> <span data-ttu-id="eb9a0-135">Jeśli ma wartość true, to do Ciebie odpowiedzi na żądanie anulowania czyszczenia zasobów i wyjścia z pętli.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-135">If the value is true, then it is up to you to respond the cancellation request by cleaning up any resources and exiting the loop.</span></span> <span data-ttu-id="eb9a0-136">W poniższym przykładzie pokazano przeciążenia <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> przyjmującej anulowania tokenu i kod, używa ona:</span><span class="sxs-lookup"><span data-stu-id="eb9a0-136">The following example shows an overload of <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> that takes a cancellation token, and the code that uses it:</span></span>  
  
 [!code-csharp[CDS_BlockingCollection#05](../../../../samples/snippets/csharp/VS_Snippets_Misc/cds_blockingcollection/cs/blockingcollection.cs#05)]
 [!code-vb[CDS_BlockingCollection#05](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/cds_blockingcollection/vb/introsnippetsbc.vb#05)]  
  
 <span data-ttu-id="eb9a0-137">Na przykład jak dodać obsługę anulowania, zobacz drugi przykład w [porady: Dodawanie i pobieranie elementów osobno z kolekcji BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="eb9a0-137">For an example of how to add cancellation support, see the second example in [How to: Add and Take Items Individually from a BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span></span>  
  
## <a name="specifying-the-collection-type"></a><span data-ttu-id="eb9a0-138">Określanie typu kolekcji</span><span class="sxs-lookup"><span data-stu-id="eb9a0-138">Specifying the Collection Type</span></span>  
 <span data-ttu-id="eb9a0-139">Po utworzeniu <xref:System.Collections.Concurrent.BlockingCollection%601>, można określić nie tylko ograniczoną pojemność, ale również typ kolekcji do użycia.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-139">When you create a <xref:System.Collections.Concurrent.BlockingCollection%601>, you can specify not only the bounded capacity but also the type of collection to use.</span></span> <span data-ttu-id="eb9a0-140">Na przykład można określić <xref:System.Collections.Concurrent.ConcurrentQueue%601> dla pierwszego w pierwszym się zachowanie (FIFO) lub <xref:System.Collections.Concurrent.ConcurrentStack%601> ostatniego zachowania pierwszy LIFO ().</span><span class="sxs-lookup"><span data-stu-id="eb9a0-140">For example, you could specify a <xref:System.Collections.Concurrent.ConcurrentQueue%601> for first in-first out (FIFO) behavior, or a <xref:System.Collections.Concurrent.ConcurrentStack%601> for last in-first out (LIFO) behavior.</span></span> <span data-ttu-id="eb9a0-141">Można użyć dowolnej klasy kolekcji, który implementuje <xref:System.Collections.Concurrent.IProducerConsumerCollection%601> interfejsu.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-141">You can use any collection class that implements the <xref:System.Collections.Concurrent.IProducerConsumerCollection%601> interface.</span></span> <span data-ttu-id="eb9a0-142">Domyślny typ kolekcji dla <xref:System.Collections.Concurrent.BlockingCollection%601> jest <xref:System.Collections.Concurrent.ConcurrentQueue%601>.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-142">The default collection type for <xref:System.Collections.Concurrent.BlockingCollection%601> is <xref:System.Collections.Concurrent.ConcurrentQueue%601>.</span></span> <span data-ttu-id="eb9a0-143">Poniższy przykład kodu pokazuje sposób tworzenia <xref:System.Collections.Concurrent.BlockingCollection%601> ciągów, które ma pojemność wynoszącą 1000 i używa <xref:System.Collections.Concurrent.ConcurrentBag%601>:</span><span class="sxs-lookup"><span data-stu-id="eb9a0-143">The following code example shows how to create a <xref:System.Collections.Concurrent.BlockingCollection%601> of strings that has a capacity of 1000 and uses a <xref:System.Collections.Concurrent.ConcurrentBag%601>:</span></span>  
  
```vb  
Dim bc = New BlockingCollection(Of String)(New ConcurrentBag(Of String()), 1000)  
```  
  
```csharp  
BlockingCollection<string> bc = new BlockingCollection<string>(new ConcurrentBag<string>(), 1000 );  
```  
  
 <span data-ttu-id="eb9a0-144">Aby uzyskać więcej informacji, zobacz [porady: Dodawanie blokujących i ograniczających do kolekcji funkcji blokowania](../../../../docs/standard/collections/thread-safe/how-to-add-bounding-and-blocking.md).</span><span class="sxs-lookup"><span data-stu-id="eb9a0-144">For more information, see [How to: Add Bounding and Blocking Functionality to a Collection](../../../../docs/standard/collections/thread-safe/how-to-add-bounding-and-blocking.md).</span></span>  
  
## <a name="ienumerable-support"></a><span data-ttu-id="eb9a0-145">Obsługa interfejsu IEnumerable</span><span class="sxs-lookup"><span data-stu-id="eb9a0-145">IEnumerable Support</span></span>  
 <span data-ttu-id="eb9a0-146"><xref:System.Collections.Concurrent.BlockingCollection%601> udostępnia <xref:System.Collections.Concurrent.BlockingCollection%601.GetConsumingEnumerable%2A> metodę, która umożliwia klientom korzystać `foreach` (`For Each` w języku Visual Basic) do momentu ukończenia kolekcji, należy usunąć elementy, co oznacza, że jest pusta i nie więcej elementy zostaną dodane.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-146"><xref:System.Collections.Concurrent.BlockingCollection%601> provides a <xref:System.Collections.Concurrent.BlockingCollection%601.GetConsumingEnumerable%2A> method that enables consumers to use `foreach` (`For Each` in Visual Basic) to remove items until the collection is completed, which means it is empty and no more items will be added.</span></span> <span data-ttu-id="eb9a0-147">Aby uzyskać więcej informacji, zobacz [porady: użycie ForEach do usuwanie elementów blockingcollection](../../../../docs/standard/collections/thread-safe/how-to-use-foreach-to-remove.md).</span><span class="sxs-lookup"><span data-stu-id="eb9a0-147">For more information, see [How to: Use ForEach to Remove Items in a BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-use-foreach-to-remove.md).</span></span>  
  
## <a name="using-many-blockingcollections-as-one"></a><span data-ttu-id="eb9a0-148">Za pomocą wielu BlockingCollections jako jeden</span><span class="sxs-lookup"><span data-stu-id="eb9a0-148">Using Many BlockingCollections As One</span></span>  
 <span data-ttu-id="eb9a0-149">W przypadku scenariuszy, w którym konsument musi podjąć równocześnie elementów z wieloma kolekcjami można utworzyć tablice o <xref:System.Collections.Concurrent.BlockingCollection%601> i użyj metod statycznych, takich jak <xref:System.Collections.Concurrent.BlockingCollection%601.TakeFromAny%2A> i <xref:System.Collections.Concurrent.BlockingCollection%601.AddToAny%2A> który dodawanie do lub wykonać z dowolnego z kolekcji w Tablica.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-149">For scenarios in which a consumer needs to take items from multiple collections simultaneously, you can create arrays of <xref:System.Collections.Concurrent.BlockingCollection%601> and use the static methods such as <xref:System.Collections.Concurrent.BlockingCollection%601.TakeFromAny%2A> and <xref:System.Collections.Concurrent.BlockingCollection%601.AddToAny%2A> that will add to or take from any of the collections in the array.</span></span> <span data-ttu-id="eb9a0-150">Jeśli blokuje jedną kolekcję metody natychmiast próbuje innego aż znajdzie taki, który można wykonać operacji.</span><span class="sxs-lookup"><span data-stu-id="eb9a0-150">If one collection is blocking, the method immediately tries another until it finds one that can perform the operation.</span></span> <span data-ttu-id="eb9a0-151">Aby uzyskać więcej informacji, zobacz [porady: Użycie tablic blokowanie kolekcji w potoku](../../../../docs/standard/collections/thread-safe/how-to-use-arrays-of-blockingcollections.md).</span><span class="sxs-lookup"><span data-stu-id="eb9a0-151">For more information, see [How to: Use Arrays of Blocking Collections in a Pipeline](../../../../docs/standard/collections/thread-safe/how-to-use-arrays-of-blockingcollections.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="eb9a0-152">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="eb9a0-152">See also</span></span>

- <xref:System.Collections.Concurrent?displayProperty=nameWithType>  
- [<span data-ttu-id="eb9a0-153">Kolekcje i struktury danych</span><span class="sxs-lookup"><span data-stu-id="eb9a0-153">Collections and Data Structures</span></span>](../../../../docs/standard/collections/index.md)  
- [<span data-ttu-id="eb9a0-154">Kolekcje bezpieczne wątkowo</span><span class="sxs-lookup"><span data-stu-id="eb9a0-154">Thread-Safe Collections</span></span>](../../../../docs/standard/collections/thread-safe/index.md)
