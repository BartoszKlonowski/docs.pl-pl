---
title: 'Instrukcje: inspekcja zawartości zestawu przy użyciu MetadataLoadContext'
description: Dowiedz się, jak używać MetadataLoadContext, który jest interfejsem API, który umożliwia ładowanie zestawów .NET na potrzeby inspekcji.
author: MSDN-WhiteKnight
ms.date: 03/10/2020
ms.openlocfilehash: 7205230986aa852813a651d2fcb7c5ef88ab18fe
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/18/2020
ms.locfileid: "94831354"
---
# <a name="how-to-inspect-assembly-contents-using-metadataloadcontext"></a><span data-ttu-id="89dd1-103">Instrukcje: inspekcja zawartości zestawu przy użyciu MetadataLoadContext</span><span class="sxs-lookup"><span data-stu-id="89dd1-103">How to: Inspect assembly contents using MetadataLoadContext</span></span>

<span data-ttu-id="89dd1-104">Interfejs API odbicia w programie .NET domyślnie umożliwia deweloperom sprawdzanie zawartości zestawów ładowanych do głównego kontekstu wykonania.</span><span class="sxs-lookup"><span data-stu-id="89dd1-104">The reflection API in .NET by default enables developers to inspect the contents of assemblies loaded into the main execution context.</span></span> <span data-ttu-id="89dd1-105">Jednak czasami nie jest możliwe załadowanie zestawu do kontekstu wykonywania, na przykład ponieważ zostało skompilowane dla innej platformy lub architektury procesora lub jest [zestawem referencyjnym](reference-assemblies.md).</span><span class="sxs-lookup"><span data-stu-id="89dd1-105">However, sometimes it isn't possible to load an assembly into the execution context, for example, because it was compiled for another platform or processor architecture, or it's a [reference assembly](reference-assemblies.md).</span></span> <span data-ttu-id="89dd1-106"><xref:System.Reflection.MetadataLoadContext?displayProperty=fullName>Interfejs API umożliwia ładowanie i inspekcję takich zestawów.</span><span class="sxs-lookup"><span data-stu-id="89dd1-106">The <xref:System.Reflection.MetadataLoadContext?displayProperty=fullName> API allows you to load and inspect such assemblies.</span></span> <span data-ttu-id="89dd1-107">Zestawy ładowane do programu <xref:System.Reflection.MetadataLoadContext> są traktowane jako metadane, to oznacza, że można sprawdzać typy w zestawie, ale nie można wykonać żadnego zawartego w nim kodu.</span><span class="sxs-lookup"><span data-stu-id="89dd1-107">Assemblies loaded into the <xref:System.Reflection.MetadataLoadContext> are treated only as metadata, that is, you can examine types in the assembly, but you can't execute any code contained in it.</span></span> <span data-ttu-id="89dd1-108">W przeciwieństwie do głównego kontekstu wykonywania, <xref:System.Reflection.MetadataLoadContext> nie ładuje automatycznie zależności od bieżącego katalogu; zamiast tego używa logiki niestandardowego powiązania dostarczonej przez <xref:System.Reflection.MetadataAssemblyResolver> przekazane do niego.</span><span class="sxs-lookup"><span data-stu-id="89dd1-108">Unlike the main execution context, the <xref:System.Reflection.MetadataLoadContext> doesn't automatically load dependencies from the current directory; instead it uses the custom binding logic provided by the <xref:System.Reflection.MetadataAssemblyResolver> passed to it.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="89dd1-109">Wymagania wstępne</span><span class="sxs-lookup"><span data-stu-id="89dd1-109">Prerequisites</span></span>

<span data-ttu-id="89dd1-110">Aby użyć programu <xref:System.Reflection.MetadataLoadContext> , zainstaluj pakiet NuGet [System. odbicie. MetadataLoadContext](https://www.nuget.org/packages/System.Reflection.MetadataLoadContext) .</span><span class="sxs-lookup"><span data-stu-id="89dd1-110">To use <xref:System.Reflection.MetadataLoadContext>, install the [System.Reflection.MetadataLoadContext](https://www.nuget.org/packages/System.Reflection.MetadataLoadContext) NuGet package.</span></span> <span data-ttu-id="89dd1-111">Jest on obsługiwany w dowolnej platformie docelowej zgodnej z .NET Standard 2,0, na przykład .NET Core 2,0 lub .NET Framework 4.6.1.</span><span class="sxs-lookup"><span data-stu-id="89dd1-111">It is supported on any .NET Standard 2.0-compliant target framework, for example, .NET Core 2.0 or .NET Framework 4.6.1.</span></span>

## <a name="create-metadataassemblyresolver-for-metadataloadcontext"></a><span data-ttu-id="89dd1-112">Utwórz MetadataAssemblyResolver dla MetadataLoadContext</span><span class="sxs-lookup"><span data-stu-id="89dd1-112">Create MetadataAssemblyResolver for MetadataLoadContext</span></span>

<span data-ttu-id="89dd1-113">Tworzenie <xref:System.Reflection.MetadataLoadContext> wymaganych wystąpień <xref:System.Reflection.MetadataAssemblyResolver> .</span><span class="sxs-lookup"><span data-stu-id="89dd1-113">Creating the <xref:System.Reflection.MetadataLoadContext> requires providing the instance of the <xref:System.Reflection.MetadataAssemblyResolver>.</span></span> <span data-ttu-id="89dd1-114">Najprostszym sposobem na dostarczenie jednego jest użycie elementu <xref:System.Reflection.PathAssemblyResolver> , który rozwiązuje zestawy z danej kolekcji ciągów ścieżek zestawu.</span><span class="sxs-lookup"><span data-stu-id="89dd1-114">The simplest way to provide one is to use the <xref:System.Reflection.PathAssemblyResolver>, which resolves assemblies from the given collection of assembly path strings.</span></span> <span data-ttu-id="89dd1-115">Ta kolekcja, oprócz zestawów, które mają być sprawdzane bezpośrednio, powinna również obejmować wszystkie wymagane zależności.</span><span class="sxs-lookup"><span data-stu-id="89dd1-115">This collection, besides assemblies you want to inspect directly, should also include all needed dependencies.</span></span> <span data-ttu-id="89dd1-116">Na przykład, aby odczytać atrybut niestandardowy znajdujący się w zestawie zewnętrznym, należy dołączyć ten zestaw lub wyjątek.</span><span class="sxs-lookup"><span data-stu-id="89dd1-116">For example, to read the custom attribute located in an external assembly, you should include that assembly or an exception will be thrown.</span></span> <span data-ttu-id="89dd1-117">W większości przypadków należy uwzględnić co najmniej *podstawowy zestaw*, czyli zestaw zawierający wbudowane typy systemu, takie jak <xref:System.Object?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="89dd1-117">In most cases, you should include at least the *core assembly*, that is, the assembly containing built-in system types, such as <xref:System.Object?displayProperty=nameWithType>.</span></span> <span data-ttu-id="89dd1-118">Poniższy kod pokazuje, jak utworzyć <xref:System.Reflection.PathAssemblyResolver> przy użyciu kolekcji składającej się z skontrolowanego zestawu i bieżącego zestawu podstawowego środowiska uruchomieniowego:</span><span class="sxs-lookup"><span data-stu-id="89dd1-118">The following code shows how to create the <xref:System.Reflection.PathAssemblyResolver> using the collection consisting of the inspected assembly and the current runtime's core assembly:</span></span>

[!code-csharp[](snippets/inspect-contents-using-metadataloadcontext/MetadataLoadContextSnippets.cs#CoreAssembly)]

<span data-ttu-id="89dd1-119">Jeśli potrzebujesz dostępu do wszystkich typów BCL, możesz uwzględnić wszystkie zestawy środowiska uruchomieniowego w kolekcji.</span><span class="sxs-lookup"><span data-stu-id="89dd1-119">If you need access to all BCL types, you can include all runtime assemblies in the collection.</span></span> <span data-ttu-id="89dd1-120">Poniższy kod pokazuje, jak utworzyć <xref:System.Reflection.PathAssemblyResolver> przy użyciu kolekcji składającej się z skontrolowanego zestawu i wszystkich zestawów bieżącego środowiska uruchomieniowego:</span><span class="sxs-lookup"><span data-stu-id="89dd1-120">The following code shows how to create the <xref:System.Reflection.PathAssemblyResolver> using the collection consisting of the inspected assembly and all assemblies of the current runtime:</span></span>

[!code-csharp[](snippets/inspect-contents-using-metadataloadcontext/MetadataLoadContextSnippets.cs#RuntimeAssemblies)]

## <a name="create-metadataloadcontext"></a><span data-ttu-id="89dd1-121">Utwórz MetadataLoadContext</span><span class="sxs-lookup"><span data-stu-id="89dd1-121">Create MetadataLoadContext</span></span>

<span data-ttu-id="89dd1-122">Aby utworzyć <xref:System.Reflection.MetadataLoadContext> , wywołaj jego konstruktora <xref:System.Reflection.MetadataLoadContext.%23ctor%28System.Reflection.MetadataAssemblyResolver%2CSystem.String%29> , przekazując poprzednio utworzony <xref:System.Reflection.MetadataAssemblyResolver> jako pierwszy parametr i podstawową nazwę zestawu jako drugi parametr.</span><span class="sxs-lookup"><span data-stu-id="89dd1-122">To create the <xref:System.Reflection.MetadataLoadContext>, invoke its constructor <xref:System.Reflection.MetadataLoadContext.%23ctor%28System.Reflection.MetadataAssemblyResolver%2CSystem.String%29>, passing the previously created <xref:System.Reflection.MetadataAssemblyResolver> as the first parameter and the core assembly name as the second parameter.</span></span> <span data-ttu-id="89dd1-123">Możesz pominąć podstawową nazwę zestawu, w którym przypadku Konstruktor podejmie próbę użycia nazw domyślnych: "mscorlib", "System. Runtime" lub "Standard standardowy".</span><span class="sxs-lookup"><span data-stu-id="89dd1-123">You can omit the core assembly name, in which case the constructor will attempt to use default names: "mscorlib", "System.Runtime", or "netstandard".</span></span>

<span data-ttu-id="89dd1-124">Po utworzeniu kontekstu można załadować do niego zestawy przy użyciu metod takich jak <xref:System.Reflection.MetadataLoadContext.LoadFromAssemblyPath%2A> .</span><span class="sxs-lookup"><span data-stu-id="89dd1-124">After you've created the context, you can load assemblies into it using methods such as <xref:System.Reflection.MetadataLoadContext.LoadFromAssemblyPath%2A>.</span></span> <span data-ttu-id="89dd1-125">Można używać wszystkich interfejsów API odbicia w załadowanych zestawach, z wyjątkiem tych, które wymagają wykonania kodu.</span><span class="sxs-lookup"><span data-stu-id="89dd1-125">You can use all reflection APIs on loaded assemblies except ones that involve code execution.</span></span> <span data-ttu-id="89dd1-126"><xref:System.Reflection.MemberInfo.GetCustomAttributes%2A>Metoda obejmuje wykonywanie konstruktorów, dlatego należy użyć <xref:System.Reflection.MemberInfo.GetCustomAttributesData%2A> metody zamiast tego, gdy konieczne jest sprawdzenie atrybutów niestandardowych w <xref:System.Reflection.MetadataLoadContext> .</span><span class="sxs-lookup"><span data-stu-id="89dd1-126">The <xref:System.Reflection.MemberInfo.GetCustomAttributes%2A> method does involve the execution of constructors, so use the <xref:System.Reflection.MemberInfo.GetCustomAttributesData%2A> method instead when you need to examine custom attributes in the <xref:System.Reflection.MetadataLoadContext>.</span></span>

<span data-ttu-id="89dd1-127">Poniższy przykładowy kod tworzy <xref:System.Reflection.MetadataLoadContext> , ładuje do niego zestaw i wyprowadza atrybuty zestawu do konsoli:</span><span class="sxs-lookup"><span data-stu-id="89dd1-127">The following code sample creates <xref:System.Reflection.MetadataLoadContext>, loads the assembly into it, and outputs assembly attributes into the console:</span></span>

[!code-csharp[](snippets/inspect-contents-using-metadataloadcontext/MetadataLoadContextSnippets.cs#CreateContext)]

## <a name="example"></a><span data-ttu-id="89dd1-128">Przykład</span><span class="sxs-lookup"><span data-stu-id="89dd1-128">Example</span></span>

<span data-ttu-id="89dd1-129">Aby uzyskać kompletny przykład kodu, zobacz [Sprawdzanie zawartości zestawu przy użyciu przykładu MetadataLoadContext](/samples/dotnet/samples/inspect-assembly-contents-using-metadataloadcontext/).</span><span class="sxs-lookup"><span data-stu-id="89dd1-129">For a complete code example, see the [Inspect assembly contents using MetadataLoadContext sample](/samples/dotnet/samples/inspect-assembly-contents-using-metadataloadcontext/).</span></span>
