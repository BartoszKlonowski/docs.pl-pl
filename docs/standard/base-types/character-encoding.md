---
title: Jak używać klas kodowania znaków w programie .NET
description: Dowiedz się, jak używać klas kodowania znaków w programie .NET.
ms.date: 12/22/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- encoding, understanding
- encoding, choosing
- encoding, fallback strategy
ms.assetid: bf6d9823-4c2d-48af-b280-919c5af66ae9
ms.openlocfilehash: 8e0cf961f4d6b481c354bdc854806f971458ce21
ms.sourcegitcommit: e09dbff13f0b21b569a101f3b3c5efa174aec204
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 05/01/2020
ms.locfileid: "82624946"
---
# <a name="how-to-use-character-encoding-classes-in-net"></a><span data-ttu-id="dd327-103">Jak używać klas kodowania znaków w programie .NET</span><span class="sxs-lookup"><span data-stu-id="dd327-103">How to use character encoding classes in .NET</span></span>

<span data-ttu-id="dd327-104">W tym artykule wyjaśniono, jak używać klas, które platforma .NET zapewnia do kodowania i dekodowania tekstu przy użyciu różnych schematów kodowania.</span><span class="sxs-lookup"><span data-stu-id="dd327-104">This article explains how to use the classes that .NET provides for encoding and decoding text by using various encoding schemes.</span></span> <span data-ttu-id="dd327-105">W instrukcjach przyjęto założenie, że wprowadzono [wprowadzenie do kodowania znaków w programie .NET](character-encoding-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="dd327-105">The instructions assume you have read [Introduction to character encoding in .NET](character-encoding-introduction.md).</span></span>

## <a name="encoders-and-decoders"></a><span data-ttu-id="dd327-106">Kodery i dekodery</span><span class="sxs-lookup"><span data-stu-id="dd327-106">Encoders and decoders</span></span>

<span data-ttu-id="dd327-107">Platforma .NET udostępnia klasy kodowania, które kodują i dekodują tekst przy użyciu różnych systemów kodowania.</span><span class="sxs-lookup"><span data-stu-id="dd327-107">.NET provides encoding classes that encode and decode text by using various encoding systems.</span></span> <span data-ttu-id="dd327-108">Na przykład <xref:System.Text.UTF8Encoding> Klasa opisuje reguły kodowania do i dekodowania z, UTF-8.</span><span class="sxs-lookup"><span data-stu-id="dd327-108">For example, the <xref:System.Text.UTF8Encoding> class describes the rules for encoding to, and decoding from, UTF-8.</span></span> <span data-ttu-id="dd327-109">Platforma .NET używa kodowania UTF-16 (reprezentowanego <xref:System.Text.UnicodeEncoding> przez klasę) `string` dla wystąpień.</span><span class="sxs-lookup"><span data-stu-id="dd327-109">.NET uses UTF-16 encoding (represented by the <xref:System.Text.UnicodeEncoding> class) for `string` instances.</span></span> <span data-ttu-id="dd327-110">Kodery i dekodery są dostępne dla innych schematów kodowania.</span><span class="sxs-lookup"><span data-stu-id="dd327-110">Encoders and decoders are available for other encoding schemes.</span></span>

<span data-ttu-id="dd327-111">Kodowanie i dekodowanie może również obejmować walidację.</span><span class="sxs-lookup"><span data-stu-id="dd327-111">Encoding and decoding can also include validation.</span></span> <span data-ttu-id="dd327-112">Na przykład Klasa sprawdza <xref:System.Text.UnicodeEncoding> wszystkie `char` wystąpienia w zakresie surogatu, aby upewnić się, że znajdują się one w prawidłowych parach zastępczych.</span><span class="sxs-lookup"><span data-stu-id="dd327-112">For example, the <xref:System.Text.UnicodeEncoding> class checks all `char` instances in the surrogate range to make sure they're in valid surrogate pairs.</span></span> <span data-ttu-id="dd327-113">Strategia rezerwowa określa, jak koder obsługuje nieprawidłowe znaki lub jak dekoder obsługuje nieprawidłowe bajty.</span><span class="sxs-lookup"><span data-stu-id="dd327-113">A fallback strategy determines how an encoder handles invalid characters or how a decoder handles invalid bytes.</span></span>

> [!WARNING]
> <span data-ttu-id="dd327-114">Klasy kodowania .NET umożliwiają przechowywanie i konwertowanie danych znakowych.</span><span class="sxs-lookup"><span data-stu-id="dd327-114">.NET encoding classes provide a way to store and convert character data.</span></span> <span data-ttu-id="dd327-115">Nie powinny być używane do przechowywania danych binarnych w postaci ciągów.</span><span class="sxs-lookup"><span data-stu-id="dd327-115">They should not be used to store binary data in string form.</span></span> <span data-ttu-id="dd327-116">W zależności od użytego kodowania Konwertowanie danych binarnych na format ciągu z klasami kodowania może spowodować nieoczekiwane zachowanie i generować niedokładne lub uszkodzone dane.</span><span class="sxs-lookup"><span data-stu-id="dd327-116">Depending on the encoding used, converting binary data to string format with the encoding classes can introduce unexpected behavior and produce inaccurate or corrupted data.</span></span> <span data-ttu-id="dd327-117">Aby przekonwertować dane binarne na postać ciągu, użyj <xref:System.Convert.ToBase64String%2A?displayProperty=nameWithType> metody.</span><span class="sxs-lookup"><span data-stu-id="dd327-117">To convert binary data to a string form, use the <xref:System.Convert.ToBase64String%2A?displayProperty=nameWithType> method.</span></span>

<span data-ttu-id="dd327-118">Wszystkie klasy kodowania znaków w programie .NET dziedziczą <xref:System.Text.Encoding?displayProperty=nameWithType> z klasy, która jest klasą abstrakcyjną, która definiuje funkcje wspólne dla wszystkich kodowań znaków.</span><span class="sxs-lookup"><span data-stu-id="dd327-118">All character encoding classes in .NET inherit from the <xref:System.Text.Encoding?displayProperty=nameWithType> class, which is an abstract class that defines the functionality common to all character encodings.</span></span> <span data-ttu-id="dd327-119">Aby uzyskać dostęp do poszczególnych obiektów kodowania wdrożonych w programie .NET, wykonaj następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="dd327-119">To access the individual encoding objects implemented in .NET, do the following:</span></span>

- <span data-ttu-id="dd327-120">Użyj właściwości statycznych <xref:System.Text.Encoding> klasy, które zwracają obiekty reprezentujące standardowe kodowanie znaków dostępne w .NET (ASCII, UTF-7, UTF-8, UTF-16 i utf-32).</span><span class="sxs-lookup"><span data-stu-id="dd327-120">Use the static properties of the <xref:System.Text.Encoding> class, which return objects that represent the standard character encodings available in .NET (ASCII, UTF-7, UTF-8, UTF-16, and UTF-32).</span></span> <span data-ttu-id="dd327-121">Na przykład <xref:System.Text.Encoding.Unicode%2A?displayProperty=nameWithType> Właściwość zwraca <xref:System.Text.UnicodeEncoding> obiekt.</span><span class="sxs-lookup"><span data-stu-id="dd327-121">For example, the <xref:System.Text.Encoding.Unicode%2A?displayProperty=nameWithType> property returns a <xref:System.Text.UnicodeEncoding> object.</span></span> <span data-ttu-id="dd327-122">Każdy obiekt używa powrotu zamiennej do obsługi ciągów, których nie można kodować, i bajtów, których nie można zdekodować.</span><span class="sxs-lookup"><span data-stu-id="dd327-122">Each object uses replacement fallback to handle strings that it cannot encode and bytes that it cannot decode.</span></span> <span data-ttu-id="dd327-123">Aby uzyskać więcej informacji, zobacz [rezerwowe zastąpienie](../../../docs/standard/base-types/character-encoding.md#Replacement).</span><span class="sxs-lookup"><span data-stu-id="dd327-123">For more information, see [Replacement fallback](../../../docs/standard/base-types/character-encoding.md#Replacement).</span></span>

- <span data-ttu-id="dd327-124">Wywołaj konstruktora klasy kodowania.</span><span class="sxs-lookup"><span data-stu-id="dd327-124">Call the encoding's class constructor.</span></span> <span data-ttu-id="dd327-125">W ten sposób można utworzyć wystąpienie obiektów dla kodowania ASCII, UTF-7, UTF-8, UTF-16 i UTF-32.</span><span class="sxs-lookup"><span data-stu-id="dd327-125">Objects for the ASCII, UTF-7, UTF-8, UTF-16, and UTF-32 encodings can be instantiated in this way.</span></span> <span data-ttu-id="dd327-126">Domyślnie każdy obiekt używa powrotu zamiennej do obsługi ciągów, których nie można kodować, i bajtów, których nie można zdekodować, ale można określić, że zamiast tego ma zostać zgłoszony wyjątek.</span><span class="sxs-lookup"><span data-stu-id="dd327-126">By default, each object uses replacement fallback to handle strings that it cannot encode and bytes that it cannot decode, but you can specify that an exception should be thrown instead.</span></span> <span data-ttu-id="dd327-127">Aby uzyskać więcej informacji, zobacz rezerwowe [rezerwy](../../../docs/standard/base-types/character-encoding.md#Replacement) i [wyjątki](../../../docs/standard/base-types/character-encoding.md#Exception).</span><span class="sxs-lookup"><span data-stu-id="dd327-127">For more information, see [Replacement fallback](../../../docs/standard/base-types/character-encoding.md#Replacement) and [Exception fallback](../../../docs/standard/base-types/character-encoding.md#Exception).</span></span>

- <span data-ttu-id="dd327-128">Wywołaj <xref:System.Text.Encoding.%23ctor%28System.Int32%29> konstruktora i przekaż go do liczby całkowitej, która reprezentuje kodowanie.</span><span class="sxs-lookup"><span data-stu-id="dd327-128">Call the <xref:System.Text.Encoding.%23ctor%28System.Int32%29> constructor and pass it an integer that represents the encoding.</span></span> <span data-ttu-id="dd327-129">Obiekty kodowania standardowego używają rezerw zamiennych, a strony kodowej i dwubajtowego zestawu znaków (DBCS) używają najlepiej dopasowanej rezerwy do obsługi ciągów, których nie można kodować, i bajtów, których nie można zdekodować.</span><span class="sxs-lookup"><span data-stu-id="dd327-129">Standard encoding objects use replacement fallback, and code page and double-byte character set (DBCS) encoding objects use best-fit fallback to handle strings that they cannot encode and bytes that they cannot decode.</span></span> <span data-ttu-id="dd327-130">Aby uzyskać więcej informacji, zobacz [najlepiej dopasowany powrotu](../../../docs/standard/base-types/character-encoding.md#BestFit).</span><span class="sxs-lookup"><span data-stu-id="dd327-130">For more information, see [Best-fit fallback](../../../docs/standard/base-types/character-encoding.md#BestFit).</span></span>

- <span data-ttu-id="dd327-131">Wywołaj <xref:System.Text.Encoding.GetEncoding%2A?displayProperty=nameWithType> metodę, która zwraca dowolne kodowanie standardowe, strony kodowej lub DBCS dostępne w programie .NET.</span><span class="sxs-lookup"><span data-stu-id="dd327-131">Call the <xref:System.Text.Encoding.GetEncoding%2A?displayProperty=nameWithType> method, which returns any standard, code page, or DBCS encoding available in .NET.</span></span> <span data-ttu-id="dd327-132">Przeciążenia umożliwiają określenie obiektu rezerwowego dla kodera i dekodera.</span><span class="sxs-lookup"><span data-stu-id="dd327-132">Overloads let you specify a fallback object for both the encoder and the decoder.</span></span>

<span data-ttu-id="dd327-133">Możesz pobrać informacje o wszystkich kodowaniach dostępnych w programie .NET, wywołując <xref:System.Text.Encoding.GetEncodings%2A?displayProperty=nameWithType> metodę.</span><span class="sxs-lookup"><span data-stu-id="dd327-133">You can retrieve information about all the encodings available in .NET by calling the <xref:System.Text.Encoding.GetEncodings%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="dd327-134">Platforma .NET obsługuje schematy kodowania znaków wymienione w poniższej tabeli.</span><span class="sxs-lookup"><span data-stu-id="dd327-134">.NET supports the character encoding schemes listed in the following table.</span></span>

|<span data-ttu-id="dd327-135">Klasa kodowania</span><span class="sxs-lookup"><span data-stu-id="dd327-135">Encoding class</span></span>|<span data-ttu-id="dd327-136">Opis</span><span class="sxs-lookup"><span data-stu-id="dd327-136">Description</span></span>|
|--------------|-----------|
|[<span data-ttu-id="dd327-137">ASCII</span><span class="sxs-lookup"><span data-stu-id="dd327-137">ASCII</span></span>](xref:System.Text.ASCIIEncoding)|<span data-ttu-id="dd327-138">Koduje ograniczony zakres znaków przy użyciu krótszych siedmiu bitów bajtu.</span><span class="sxs-lookup"><span data-stu-id="dd327-138">Encodes a limited range of characters by using the lower seven bits of a byte.</span></span> <span data-ttu-id="dd327-139">Ponieważ to kodowanie obsługuje tylko wartości znakowe z U + 0000 za pośrednictwem U + 007F, w większości przypadków nie jest to wystarczające dla międzynarodowych aplikacji.</span><span class="sxs-lookup"><span data-stu-id="dd327-139">Because this encoding only supports character values from U+0000 through U+007F, in most cases it is inadequate for internationalized applications.</span></span>|
|[<span data-ttu-id="dd327-140">UTF-7</span><span class="sxs-lookup"><span data-stu-id="dd327-140">UTF-7</span></span>](xref:System.Text.UTF7Encoding)|<span data-ttu-id="dd327-141">Reprezentuje znaki jako sekwencje 7-bitowego znaków ASCII.</span><span class="sxs-lookup"><span data-stu-id="dd327-141">Represents characters as sequences of 7-bit ASCII characters.</span></span> <span data-ttu-id="dd327-142">Znaki Unicode inne niż ASCII są reprezentowane przez sekwencję ucieczki znaków ASCII.</span><span class="sxs-lookup"><span data-stu-id="dd327-142">Non-ASCII Unicode characters are represented by an escape sequence of ASCII characters.</span></span> <span data-ttu-id="dd327-143">UTF-7 obsługuje protokoły takie jak wiadomości e-mail i grupy dyskusyjne.</span><span class="sxs-lookup"><span data-stu-id="dd327-143">UTF-7 supports protocols such as email and newsgroup.</span></span> <span data-ttu-id="dd327-144">Jednak kodowanie UTF-7 nie jest szczególnie bezpieczne ani niezawodne.</span><span class="sxs-lookup"><span data-stu-id="dd327-144">However, UTF-7 is not particularly secure or robust.</span></span> <span data-ttu-id="dd327-145">W niektórych przypadkach zmiana jednego bitu może radykalnie zmienić interpretację całego ciągu UTF-7.</span><span class="sxs-lookup"><span data-stu-id="dd327-145">In some cases, changing one bit can radically alter the interpretation of an entire UTF-7 string.</span></span> <span data-ttu-id="dd327-146">W innych przypadkach, różne ciągi UTF-7 mogą kodować ten sam tekst.</span><span class="sxs-lookup"><span data-stu-id="dd327-146">In other cases, different UTF-7 strings can encode the same text.</span></span> <span data-ttu-id="dd327-147">W przypadku sekwencji, które zawierają znaki inne niż ASCII, UTF-7 wymaga więcej miejsca niż UTF-8, a Kodowanie/dekodowanie jest wolniejsze.</span><span class="sxs-lookup"><span data-stu-id="dd327-147">For sequences that include non-ASCII characters, UTF-7 requires more space than UTF-8, and encoding/decoding is slower.</span></span> <span data-ttu-id="dd327-148">W związku z tym należy zamiast tego użyć formatu UTF-8, jeśli jest to możliwe.</span><span class="sxs-lookup"><span data-stu-id="dd327-148">Consequently, you should use UTF-8 instead of UTF-7 if possible.</span></span>|
|[<span data-ttu-id="dd327-149">UTF-8</span><span class="sxs-lookup"><span data-stu-id="dd327-149">UTF-8</span></span>](xref:System.Text.UTF8Encoding)|<span data-ttu-id="dd327-150">Reprezentuje każdy punkt kodu Unicode jako sekwencję od 1 do 4 bajtów.</span><span class="sxs-lookup"><span data-stu-id="dd327-150">Represents each Unicode code point as a sequence of one to four bytes.</span></span> <span data-ttu-id="dd327-151">UTF-8 obsługuje 8-bitowe rozmiary danych i współpracuje z wieloma istniejącymi systemami operacyjnymi.</span><span class="sxs-lookup"><span data-stu-id="dd327-151">UTF-8 supports 8-bit data sizes and works well with many existing operating systems.</span></span> <span data-ttu-id="dd327-152">W przypadku zakresu znaków ASCII UTF-8 jest taka sama jak kodowanie ASCII i umożliwia szerszego zestawu znaków.</span><span class="sxs-lookup"><span data-stu-id="dd327-152">For the ASCII range of characters, UTF-8 is identical to ASCII encoding and allows a broader set of characters.</span></span> <span data-ttu-id="dd327-153">Jednak w przypadku skryptów języka chińskiego-japońskiego (CJK) UTF-8 może wymagać trzech bajtów dla każdego znaku i może spowodować większe rozmiary danych niż UTF-16.</span><span class="sxs-lookup"><span data-stu-id="dd327-153">However, for Chinese-Japanese-Korean (CJK) scripts, UTF-8 can require three bytes for each character, and can cause larger data sizes than UTF-16.</span></span> <span data-ttu-id="dd327-154">Czasami ilość danych ASCII, takich jak tagi HTML, uzasadnia zwiększony rozmiar dla zakresu CJK.</span><span class="sxs-lookup"><span data-stu-id="dd327-154">Sometimes the amount of ASCII data, such as HTML tags, justifies the increased size for the CJK range.</span></span>|
|[<span data-ttu-id="dd327-155">UTF-16</span><span class="sxs-lookup"><span data-stu-id="dd327-155">UTF-16</span></span>](xref:System.Text.UnicodeEncoding)|<span data-ttu-id="dd327-156">Reprezentuje każdy punkt kodu Unicode jako sekwencję jednej lub 2 16-bitowej liczby całkowitej.</span><span class="sxs-lookup"><span data-stu-id="dd327-156">Represents each Unicode code point as a sequence of one or two 16-bit integers.</span></span> <span data-ttu-id="dd327-157">Najpopularniejsze znaki Unicode wymagają tylko jednego punktu kodu UTF-16, chociaż znaki dodatkowe Unicode (U + 10000 i nowsze) wymagają dwóch zastępczych punktów kodowych w formacie UTF-16.</span><span class="sxs-lookup"><span data-stu-id="dd327-157">Most common Unicode characters require only one UTF-16 code point, although Unicode supplementary characters (U+10000 and greater) require two UTF-16 surrogate code points.</span></span> <span data-ttu-id="dd327-158">Obsługiwane są zarówno kolejność bajtów little-endian, jak i big-endian.</span><span class="sxs-lookup"><span data-stu-id="dd327-158">Both little-endian and big-endian byte orders are supported.</span></span> <span data-ttu-id="dd327-159">Kodowanie UTF-16 jest używane przez środowisko uruchomieniowe języka wspólnego do <xref:System.Char> reprezentowania <xref:System.String> i wartości, i jest używane przez system operacyjny Windows do reprezentowania `WCHAR` wartości.</span><span class="sxs-lookup"><span data-stu-id="dd327-159">UTF-16 encoding is used by the common language runtime to represent <xref:System.Char> and <xref:System.String> values, and it is used by the Windows operating system to represent `WCHAR` values.</span></span>|
|[<span data-ttu-id="dd327-160">UTF-32</span><span class="sxs-lookup"><span data-stu-id="dd327-160">UTF-32</span></span>](xref:System.Text.UTF32Encoding)|<span data-ttu-id="dd327-161">Reprezentuje każdy punkt kodu Unicode jako 32-bitową liczbę całkowitą.</span><span class="sxs-lookup"><span data-stu-id="dd327-161">Represents each Unicode code point as a 32-bit integer.</span></span> <span data-ttu-id="dd327-162">Obsługiwane są zarówno kolejność bajtów little-endian, jak i big-endian.</span><span class="sxs-lookup"><span data-stu-id="dd327-162">Both little-endian and big-endian byte orders are supported.</span></span> <span data-ttu-id="dd327-163">Kodowanie UTF-32 jest używane, gdy aplikacje chcą uniknąć zachowania surogatu kodu UTF-16 w systemach operacyjnych, w których zakodowane miejsce jest zbyt ważne.</span><span class="sxs-lookup"><span data-stu-id="dd327-163">UTF-32 encoding is used when applications want to avoid the surrogate code point behavior of UTF-16 encoding on operating systems for which encoded space is too important.</span></span> <span data-ttu-id="dd327-164">Pojedyncze glify renderowane na ekranie mogą wciąż być kodowane przy użyciu więcej niż jednego znaku UTF-32.</span><span class="sxs-lookup"><span data-stu-id="dd327-164">Single glyphs rendered on a display can still be encoded with more than one UTF-32 character.</span></span>|
|<span data-ttu-id="dd327-165">Kodowanie ANSI/ISO</span><span class="sxs-lookup"><span data-stu-id="dd327-165">ANSI/ISO encoding</span></span>|<span data-ttu-id="dd327-166">Zapewnia obsługę różnych stron kodowych.</span><span class="sxs-lookup"><span data-stu-id="dd327-166">Provides support for a variety of code pages.</span></span> <span data-ttu-id="dd327-167">W systemach operacyjnych Windows strony kodowe są używane do obsługi określonego języka lub grupy języków.</span><span class="sxs-lookup"><span data-stu-id="dd327-167">On Windows operating systems, code pages are used to support a specific language or group of languages.</span></span> <span data-ttu-id="dd327-168">W przypadku tabeli, która wyświetla listę stron kodowych obsługiwanych przez platformę <xref:System.Text.Encoding> .NET, zobacz Klasa.</span><span class="sxs-lookup"><span data-stu-id="dd327-168">For a table that lists the code pages supported by .NET, see the <xref:System.Text.Encoding> class.</span></span> <span data-ttu-id="dd327-169">Można pobrać obiekt kodowania dla konkretnej strony kodowej, wywołując <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> metodę.</span><span class="sxs-lookup"><span data-stu-id="dd327-169">You can retrieve an encoding object for a particular code page by calling the <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="dd327-170">Strona kodowa zawiera 256 punktów kodu i jest zależna od zera.</span><span class="sxs-lookup"><span data-stu-id="dd327-170">A code page contains 256 code points and is zero-based.</span></span> <span data-ttu-id="dd327-171">W większości stron kodowych od 0 do 127 reprezentuje zestaw znaków ASCII, a punkty kodów 128 przez 255 różnią się znacząco między stronami kodowymi.</span><span class="sxs-lookup"><span data-stu-id="dd327-171">In most code pages, code points 0 through 127 represent the ASCII character set, and code points 128 through 255 differ significantly between code pages.</span></span> <span data-ttu-id="dd327-172">Na przykład strona kodowa 1252 zawiera znaki dla systemów pisania łacińskiego, w tym angielski, niemiecki i francuski.</span><span class="sxs-lookup"><span data-stu-id="dd327-172">For example, code page 1252 provides the characters for Latin writing systems, including English, German, and French.</span></span> <span data-ttu-id="dd327-173">Ostatnie 128 punktów kodowych na stronie kodowej 1252 zawierają znaki akcentu.</span><span class="sxs-lookup"><span data-stu-id="dd327-173">The last 128 code points in code page 1252 contain the accent characters.</span></span> <span data-ttu-id="dd327-174">Strona kodowa 1253 zawiera kody znaków, które są wymagane w greckim systemie pisania.</span><span class="sxs-lookup"><span data-stu-id="dd327-174">Code page 1253 provides character codes that are required in the Greek writing system.</span></span> <span data-ttu-id="dd327-175">Ostatnie 128 punktów kodu na stronie kodowej 1253 zawierają znaki greckie.</span><span class="sxs-lookup"><span data-stu-id="dd327-175">The last 128 code points in code page 1253 contain the Greek characters.</span></span> <span data-ttu-id="dd327-176">W związku z tym aplikacja, która opiera się na stronach kodowych ANSI, nie może przechowywać greckich i niemieckich w tym samym strumieniu tekstowym, chyba że zawiera identyfikator, który wskazuje na stronę kodową, do której się odwołuje.</span><span class="sxs-lookup"><span data-stu-id="dd327-176">As a result, an application that relies on ANSI code pages cannot store Greek and German in the same text stream unless it includes an identifier that indicates the referenced code page.</span></span>|
|<span data-ttu-id="dd327-177">Kodowanie zestawów znaków dwubajtowych (DBCS)</span><span class="sxs-lookup"><span data-stu-id="dd327-177">Double-byte character set (DBCS) encodings</span></span>|<span data-ttu-id="dd327-178">Obsługuje języki, takie jak chiński, japoński i koreański, które zawierają więcej niż 256 znaków.</span><span class="sxs-lookup"><span data-stu-id="dd327-178">Supports languages, such as Chinese, Japanese, and Korean, that contain more than 256 characters.</span></span> <span data-ttu-id="dd327-179">W DBCS para punktów kodu (dwubajtowy) reprezentuje każdy znak.</span><span class="sxs-lookup"><span data-stu-id="dd327-179">In a DBCS, a pair of code points (a double byte) represents each character.</span></span> <span data-ttu-id="dd327-180"><xref:System.Text.Encoding.IsSingleByte%2A?displayProperty=nameWithType> Właściwość zwraca `false` dla kodowań DBCS.</span><span class="sxs-lookup"><span data-stu-id="dd327-180">The <xref:System.Text.Encoding.IsSingleByte%2A?displayProperty=nameWithType> property returns `false` for DBCS encodings.</span></span> <span data-ttu-id="dd327-181">Można pobrać obiekt kodowania dla określonego zestawu DBCS, wywołując <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> metodę.</span><span class="sxs-lookup"><span data-stu-id="dd327-181">You can retrieve an encoding object for a particular DBCS by calling the <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="dd327-182">Gdy aplikacja obsługuje dane DBCS, pierwszy bajt znaku dwubajtowego (bajt wiodący) jest przetwarzany w połączeniu z bajtem końcowym, który natychmiast następuje po nim.</span><span class="sxs-lookup"><span data-stu-id="dd327-182">When an application handles DBCS data, the first byte of a DBCS character (the lead byte) is processed in combination with the trail byte that immediately follows it.</span></span> <span data-ttu-id="dd327-183">Ponieważ pojedyncza para dwubajtowych punktów kodowych może reprezentować różne znaki w zależności od strony kodowej, schemat ten nadal nie pozwala na połączenie dwóch języków, takich jak japoński i chiński, w tym samym strumieniu danych.</span><span class="sxs-lookup"><span data-stu-id="dd327-183">Because a single pair of double-byte code points can represent different characters depending on the code page, this scheme still does not allow for the combination of two languages, such as Japanese and Chinese, in the same data stream.</span></span>|

<span data-ttu-id="dd327-184">Te kodowania umożliwiają współdziałanie z znakami Unicode, a także z kodowaniem najczęściej używanym w starszych aplikacjach.</span><span class="sxs-lookup"><span data-stu-id="dd327-184">These encodings enable you to work with Unicode characters as well as with encodings that are most commonly used in legacy applications.</span></span> <span data-ttu-id="dd327-185">Ponadto można utworzyć niestandardowe kodowanie, definiując klasę, która dziedziczy z <xref:System.Text.Encoding> i zastępując jej składowe.</span><span class="sxs-lookup"><span data-stu-id="dd327-185">In addition, you can create a custom encoding by defining a class that derives from <xref:System.Text.Encoding> and overriding its members.</span></span>

## <a name="net-core-encoding-support"></a><span data-ttu-id="dd327-186">Obsługa kodowania .NET Core</span><span class="sxs-lookup"><span data-stu-id="dd327-186">.NET Core encoding support</span></span>

<span data-ttu-id="dd327-187">Domyślnie platforma .NET Core nie udostępnia żadnych kodowań stron kodowych innych niż strona kodowa 28591 i kodowanie Unicode, takie jak UTF-8 i UTF-16.</span><span class="sxs-lookup"><span data-stu-id="dd327-187">By default, .NET Core does not make available any code page encodings other than code page 28591 and the Unicode encodings, such as UTF-8 and UTF-16.</span></span> <span data-ttu-id="dd327-188">Można jednak dodać kodowanie stron kodowych Znalezione w standardowych aplikacjach systemu Windows, które są przeznaczone dla platformy .NET dla aplikacji.</span><span class="sxs-lookup"><span data-stu-id="dd327-188">However, you can add the code page encodings found in standard Windows apps that target .NET to your app.</span></span> <span data-ttu-id="dd327-189">Aby uzyskać więcej informacji, zobacz <xref:System.Text.CodePagesEncodingProvider> temat.</span><span class="sxs-lookup"><span data-stu-id="dd327-189">For more information, see the <xref:System.Text.CodePagesEncodingProvider> topic.</span></span>

<a name="Selecting"></a>

## <a name="selecting-an-encoding-class"></a><span data-ttu-id="dd327-190">Wybieranie klasy kodowania</span><span class="sxs-lookup"><span data-stu-id="dd327-190">Selecting an Encoding Class</span></span>

<span data-ttu-id="dd327-191">Jeśli masz możliwość wybrania kodowania, które ma być używane przez aplikację, użyj kodowania Unicode, najlepiej <xref:System.Text.UTF8Encoding> lub. <xref:System.Text.UnicodeEncoding></span><span class="sxs-lookup"><span data-stu-id="dd327-191">If you have the opportunity to choose the encoding to be used by your application, you should use a Unicode encoding, preferably either <xref:System.Text.UTF8Encoding> or <xref:System.Text.UnicodeEncoding>.</span></span> <span data-ttu-id="dd327-192">(Platforma .NET obsługuje także trzecie kodowanie Unicode, <xref:System.Text.UTF32Encoding>).</span><span class="sxs-lookup"><span data-stu-id="dd327-192">(.NET also supports a third Unicode encoding, <xref:System.Text.UTF32Encoding>.)</span></span>

<span data-ttu-id="dd327-193">Jeśli planujesz użycie kodowania ASCII (<xref:System.Text.ASCIIEncoding>), wybierz <xref:System.Text.UTF8Encoding> zamiast tego.</span><span class="sxs-lookup"><span data-stu-id="dd327-193">If you are planning to use an ASCII encoding (<xref:System.Text.ASCIIEncoding>), choose <xref:System.Text.UTF8Encoding> instead.</span></span> <span data-ttu-id="dd327-194">Dwa kodowania są identyczne dla zestawu znaków ASCII, ale <xref:System.Text.UTF8Encoding> ma następujące zalety:</span><span class="sxs-lookup"><span data-stu-id="dd327-194">The two encodings are identical for the ASCII character set, but <xref:System.Text.UTF8Encoding> has the following advantages:</span></span>

- <span data-ttu-id="dd327-195">Może reprezentować każdy znak Unicode, <xref:System.Text.ASCIIEncoding> który obsługuje tylko wartości znaków Unicode między u + 0000 i u + 007F.</span><span class="sxs-lookup"><span data-stu-id="dd327-195">It can represent every Unicode character, whereas <xref:System.Text.ASCIIEncoding> supports only the Unicode character values between U+0000 and U+007F.</span></span>

- <span data-ttu-id="dd327-196">Zapewnia wykrywanie błędów i lepsze zabezpieczenia.</span><span class="sxs-lookup"><span data-stu-id="dd327-196">It provides error detection and better security.</span></span>

- <span data-ttu-id="dd327-197">Został dostrojony tak szybko, jak to możliwe i powinien być szybszy niż inne kodowanie.</span><span class="sxs-lookup"><span data-stu-id="dd327-197">It has been tuned to be as fast as possible and should be faster than any other encoding.</span></span> <span data-ttu-id="dd327-198">Nawet w przypadku zawartości, która jest całkowicie ASCII, operacje <xref:System.Text.UTF8Encoding> wykonywane przy użyciu programu są szybsze <xref:System.Text.ASCIIEncoding>niż operacje wykonywane przy użyciu programu.</span><span class="sxs-lookup"><span data-stu-id="dd327-198">Even for content that is entirely ASCII, operations performed with <xref:System.Text.UTF8Encoding> are faster than operations performed with <xref:System.Text.ASCIIEncoding>.</span></span>

<span data-ttu-id="dd327-199">Należy rozważyć użycie <xref:System.Text.ASCIIEncoding> tylko w przypadku starszych aplikacji.</span><span class="sxs-lookup"><span data-stu-id="dd327-199">You should consider using <xref:System.Text.ASCIIEncoding> only for legacy applications.</span></span> <span data-ttu-id="dd327-200">Jednak nawet w przypadku starszych aplikacji <xref:System.Text.UTF8Encoding> może być lepszym wyborem z następujących powodów (przy założeniu ustawień domyślnych):</span><span class="sxs-lookup"><span data-stu-id="dd327-200">However, even for legacy applications, <xref:System.Text.UTF8Encoding> might be a better choice for the following reasons (assuming default settings):</span></span>

- <span data-ttu-id="dd327-201">Jeśli aplikacja ma zawartość, która nie jest ściśle ASCII i koduje ją z <xref:System.Text.ASCIIEncoding>, każdy znak inny niż ASCII jest kodowany jako znak zapytania (?).</span><span class="sxs-lookup"><span data-stu-id="dd327-201">If your application has content that is not strictly ASCII and encodes it with <xref:System.Text.ASCIIEncoding>, each non-ASCII character encodes as a question mark (?).</span></span> <span data-ttu-id="dd327-202">Jeśli aplikacja następnie dekoduje te dane, informacje zostaną utracone.</span><span class="sxs-lookup"><span data-stu-id="dd327-202">If the application then decodes this data, the information is lost.</span></span>

- <span data-ttu-id="dd327-203">Jeśli aplikacja ma zawartość, która nie jest ściśle ASCII i koduje ją z <xref:System.Text.UTF8Encoding>, wynik wydaje się niezrozumiały, jeśli jest interpretowany jako ASCII.</span><span class="sxs-lookup"><span data-stu-id="dd327-203">If your application has content that is not strictly ASCII and encodes it with <xref:System.Text.UTF8Encoding>, the result seems unintelligible if interpreted as ASCII.</span></span> <span data-ttu-id="dd327-204">Jeśli jednak aplikacja używa dekodera UTF-8, aby zdekodować te dane, dane są wykonywane pomyślnie.</span><span class="sxs-lookup"><span data-stu-id="dd327-204">However, if the application then uses a UTF-8 decoder to decode this data, the data performs a round trip successfully.</span></span>

<span data-ttu-id="dd327-205">W aplikacji sieci Web znaki wysyłane do klienta w odpowiedzi na żądanie sieci Web powinny odzwierciedlać kodowanie używane na kliencie.</span><span class="sxs-lookup"><span data-stu-id="dd327-205">In a web application, characters sent to the client in response to a web request should reflect the encoding used on the client.</span></span> <span data-ttu-id="dd327-206">W większości przypadków należy ustawić <xref:System.Web.HttpResponse.ContentEncoding%2A?displayProperty=nameWithType> właściwość na wartość zwracaną przez <xref:System.Web.HttpRequest.ContentEncoding%2A?displayProperty=nameWithType> właściwość, aby wyświetlić tekst w kodowaniu, którego oczekuje użytkownik.</span><span class="sxs-lookup"><span data-stu-id="dd327-206">In most cases, you should set the <xref:System.Web.HttpResponse.ContentEncoding%2A?displayProperty=nameWithType> property to the value returned by the <xref:System.Web.HttpRequest.ContentEncoding%2A?displayProperty=nameWithType> property to display text in the encoding that the user expects.</span></span>

<a name="Using"></a>

## <a name="using-an-encoding-object"></a><span data-ttu-id="dd327-207">Używanie obiektu kodowania</span><span class="sxs-lookup"><span data-stu-id="dd327-207">Using an Encoding Object</span></span>

<span data-ttu-id="dd327-208">Koder konwertuje ciąg znaków (najczęściej są to znaki Unicode) na jego odpowiednik liczbowy (Byte).</span><span class="sxs-lookup"><span data-stu-id="dd327-208">An encoder converts a string of characters (most commonly, Unicode characters) to its numeric (byte) equivalent.</span></span> <span data-ttu-id="dd327-209">Można na przykład użyć kodera ASCII do przekonwertowania znaków Unicode na ASCII, aby można było je wyświetlić w konsoli.</span><span class="sxs-lookup"><span data-stu-id="dd327-209">For example, you might use an ASCII encoder to convert Unicode characters to ASCII so that they can be displayed at the console.</span></span> <span data-ttu-id="dd327-210">Aby przeprowadzić konwersję, należy wywołać <xref:System.Text.Encoding.GetBytes%2A?displayProperty=nameWithType> metodę.</span><span class="sxs-lookup"><span data-stu-id="dd327-210">To perform the conversion, you call the <xref:System.Text.Encoding.GetBytes%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="dd327-211">Jeśli chcesz określić liczbę bajtów potrzebnych do przechowywania zakodowanych znaków przed wykonaniem kodowania, możesz wywołać <xref:System.Text.Encoding.GetByteCount%2A> metodę.</span><span class="sxs-lookup"><span data-stu-id="dd327-211">If you want to determine how many bytes are needed to store the encoded characters before performing the encoding, you can call the <xref:System.Text.Encoding.GetByteCount%2A> method.</span></span>

<span data-ttu-id="dd327-212">W poniższym przykładzie zastosowano tablicę jednobajtową do kodowania ciągów w dwóch oddzielnych operacjach.</span><span class="sxs-lookup"><span data-stu-id="dd327-212">The following example uses a single byte array to encode strings in two separate operations.</span></span> <span data-ttu-id="dd327-213">Zachowuje indeks wskazujący pozycję początkową w tablicy bajtów dla następnego zestawu bajtów zakodowanych w formacie ASCII.</span><span class="sxs-lookup"><span data-stu-id="dd327-213">It maintains an index that indicates the starting position in the byte array for the next set of ASCII-encoded bytes.</span></span> <span data-ttu-id="dd327-214">Wywołuje <xref:System.Text.ASCIIEncoding.GetByteCount%28System.String%29?displayProperty=nameWithType> metodę, aby upewnić się, że tablica bajtów jest wystarczająco duża, aby pomieścić zakodowany ciąg.</span><span class="sxs-lookup"><span data-stu-id="dd327-214">It calls the <xref:System.Text.ASCIIEncoding.GetByteCount%28System.String%29?displayProperty=nameWithType> method to ensure that the byte array is large enough to accommodate the encoded string.</span></span> <span data-ttu-id="dd327-215">Następnie wywołuje <xref:System.Text.ASCIIEncoding.GetBytes%28System.String%2CSystem.Int32%2CSystem.Int32%2CSystem.Byte%5B%5D%2CSystem.Int32%29?displayProperty=nameWithType> metodę w celu zakodowania znaków w ciągu.</span><span class="sxs-lookup"><span data-stu-id="dd327-215">It then calls the <xref:System.Text.ASCIIEncoding.GetBytes%28System.String%2CSystem.Int32%2CSystem.Int32%2CSystem.Byte%5B%5D%2CSystem.Int32%29?displayProperty=nameWithType> method to encode the characters in the string.</span></span>

[!code-csharp[Conceptual.Encoding#8](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/getbytes1.cs#8)]
[!code-vb[Conceptual.Encoding#8](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/getbytes1.vb#8)]

<span data-ttu-id="dd327-216">Dekoder konwertuje tablicę bajtową, która odzwierciedla określony kodowanie znaków w zestawie znaków, w tablicy znaków lub w ciągu.</span><span class="sxs-lookup"><span data-stu-id="dd327-216">A decoder converts a byte array that reflects a particular character encoding into a set of characters, either in a character array or in a string.</span></span> <span data-ttu-id="dd327-217">Aby zdekodować tablicę bajtową do tablicy znaków, należy wywołać <xref:System.Text.Encoding.GetChars%2A?displayProperty=nameWithType> metodę.</span><span class="sxs-lookup"><span data-stu-id="dd327-217">To decode a byte array into a character array, you call the <xref:System.Text.Encoding.GetChars%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="dd327-218">Aby zdekodować tablicę bajtową do ciągu, należy wywołać <xref:System.Text.Encoding.GetString%2A> metodę.</span><span class="sxs-lookup"><span data-stu-id="dd327-218">To decode a byte array into a string, you call the <xref:System.Text.Encoding.GetString%2A> method.</span></span> <span data-ttu-id="dd327-219">Jeśli chcesz określić liczbę znaków potrzebną do przechowywania zdekodowanych bajtów przed wykonaniem dekodowania, możesz wywołać <xref:System.Text.Encoding.GetCharCount%2A> metodę.</span><span class="sxs-lookup"><span data-stu-id="dd327-219">If you want to determine how many characters are needed to store the decoded bytes before performing the decoding, you can call the <xref:System.Text.Encoding.GetCharCount%2A> method.</span></span>

<span data-ttu-id="dd327-220">Poniższy przykład koduje trzy ciągi, a następnie dekoduje je w postaci pojedynczej tablicy znaków.</span><span class="sxs-lookup"><span data-stu-id="dd327-220">The following example encodes three strings and then decodes them into a single array of characters.</span></span> <span data-ttu-id="dd327-221">Zachowuje indeks wskazujący pozycję początkową w tablicy znaków dla następnego zestawu zdekodowanych znaków.</span><span class="sxs-lookup"><span data-stu-id="dd327-221">It maintains an index that indicates the starting position in the character array for the next set of decoded characters.</span></span> <span data-ttu-id="dd327-222">Wywołuje <xref:System.Text.ASCIIEncoding.GetCharCount%2A> metodę, aby upewnić się, że tablica znaków jest wystarczająco duża, aby pomieścić wszystkie znaki zdekodowane.</span><span class="sxs-lookup"><span data-stu-id="dd327-222">It calls the <xref:System.Text.ASCIIEncoding.GetCharCount%2A> method to ensure that the character array is large enough to accommodate all the decoded characters.</span></span> <span data-ttu-id="dd327-223">Następnie wywołuje <xref:System.Text.ASCIIEncoding.GetChars%28System.Byte%5B%5D%2CSystem.Int32%2CSystem.Int32%2CSystem.Char%5B%5D%2CSystem.Int32%29?displayProperty=nameWithType> metodę, aby zdekodować tablicę bajtów.</span><span class="sxs-lookup"><span data-stu-id="dd327-223">It then calls the <xref:System.Text.ASCIIEncoding.GetChars%28System.Byte%5B%5D%2CSystem.Int32%2CSystem.Int32%2CSystem.Char%5B%5D%2CSystem.Int32%29?displayProperty=nameWithType> method to decode the byte array.</span></span>

[!code-csharp[Conceptual.Encoding#9](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/getchars1.cs#9)]
[!code-vb[Conceptual.Encoding#9](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/getchars1.vb#9)]

<span data-ttu-id="dd327-224">Metody kodowania i dekodowania klasy pochodzącej od <xref:System.Text.Encoding> są przeznaczone do pracy nad kompletnym zestawem danych; oznacza to, że wszystkie dane, które mają być kodowane lub dekodowane, są dostarczane w jednym wywołaniu metody.</span><span class="sxs-lookup"><span data-stu-id="dd327-224">The encoding and decoding methods of a class derived from <xref:System.Text.Encoding> are designed to work on a complete set of data; that is, all the data to be encoded or decoded is supplied in a single method call.</span></span> <span data-ttu-id="dd327-225">Jednak w niektórych przypadkach dane są dostępne w strumieniu, a dane, które mają być kodowane lub dekodowane, mogą być dostępne tylko z oddzielnych operacji odczytu.</span><span class="sxs-lookup"><span data-stu-id="dd327-225">However, in some cases, data is available in a stream, and the data to be encoded or decoded may be available only from separate read operations.</span></span> <span data-ttu-id="dd327-226">Wymaga to kodowania lub dekodowania operacji, aby zapamiętać każdy zapisany stan w poprzednim wywołaniu.</span><span class="sxs-lookup"><span data-stu-id="dd327-226">This requires the encoding or decoding operation to remember any saved state from its previous invocation.</span></span> <span data-ttu-id="dd327-227">Metody klas pochodnych <xref:System.Text.Encoder> i <xref:System.Text.Decoder> są w stanie obsługiwać operacje kodowania i dekodowania obejmujące wiele wywołań metod.</span><span class="sxs-lookup"><span data-stu-id="dd327-227">Methods of classes derived from <xref:System.Text.Encoder> and <xref:System.Text.Decoder> are able to handle encoding and decoding operations that span multiple method calls.</span></span>

<span data-ttu-id="dd327-228"><xref:System.Text.Encoder> Obiekt dla określonego kodowania jest dostępny we <xref:System.Text.Encoding.GetEncoder%2A?displayProperty=nameWithType> właściwości tego kodowania.</span><span class="sxs-lookup"><span data-stu-id="dd327-228">An <xref:System.Text.Encoder> object for a particular encoding is available from that encoding's <xref:System.Text.Encoding.GetEncoder%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="dd327-229"><xref:System.Text.Decoder> Obiekt dla określonego kodowania jest dostępny we <xref:System.Text.Encoding.GetDecoder%2A?displayProperty=nameWithType> właściwości tego kodowania.</span><span class="sxs-lookup"><span data-stu-id="dd327-229">A <xref:System.Text.Decoder> object for a particular encoding is available from that encoding's <xref:System.Text.Encoding.GetDecoder%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="dd327-230">W przypadku operacji dekodowania należy zauważyć, że klasy <xref:System.Text.Decoder> pochodne z <xref:System.Text.Decoder.GetChars%2A?displayProperty=nameWithType> zawierają metodę, ale nie mają metody odpowiadającej <xref:System.Text.Encoding.GetString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="dd327-230">For decoding operations, note that classes derived from <xref:System.Text.Decoder> include a <xref:System.Text.Decoder.GetChars%2A?displayProperty=nameWithType> method, but they do not have a method that corresponds to <xref:System.Text.Encoding.GetString%2A?displayProperty=nameWithType>.</span></span>

<span data-ttu-id="dd327-231">Poniższy przykład ilustruje różnicę między użyciem metod <xref:System.Text.Encoding.GetString%2A?displayProperty=nameWithType> i <xref:System.Text.Decoder.GetChars%2A?displayProperty=nameWithType> do dekodowania tablicy bajtowej Unicode.</span><span class="sxs-lookup"><span data-stu-id="dd327-231">The following example illustrates the difference between using the <xref:System.Text.Encoding.GetString%2A?displayProperty=nameWithType> and <xref:System.Text.Decoder.GetChars%2A?displayProperty=nameWithType> methods for decoding a Unicode byte array.</span></span> <span data-ttu-id="dd327-232">Przykład koduje ciąg, który zawiera znaki Unicode do pliku, a następnie używa dwóch metod dekodowania do zdekodowania ich dziesięć bajtów jednocześnie.</span><span class="sxs-lookup"><span data-stu-id="dd327-232">The example encodes a string that contains some Unicode characters to a file, and then uses the two decoding methods to decode them ten bytes at a time.</span></span> <span data-ttu-id="dd327-233">Ponieważ para dwuskładnikowa występuje w dziesiątych i jedenastych bajtach, jest dekodowane w oddzielnych wywołaniach metod.</span><span class="sxs-lookup"><span data-stu-id="dd327-233">Because a surrogate pair occurs in the tenth and eleventh bytes, it is decoded in separate method calls.</span></span> <span data-ttu-id="dd327-234">Ponieważ dane wyjściowe są wyświetlane, <xref:System.Text.Encoding.GetString%2A?displayProperty=nameWithType> Metoda nie jest w stanie poprawnie zdekodować bajtów i zamiast tego zastępuje je literałem U + FFFD (znak zastępczy).</span><span class="sxs-lookup"><span data-stu-id="dd327-234">As the output shows, the <xref:System.Text.Encoding.GetString%2A?displayProperty=nameWithType> method is not able to correctly decode the bytes and instead replaces them with U+FFFD (REPLACEMENT CHARACTER).</span></span> <span data-ttu-id="dd327-235">Z drugiej strony <xref:System.Text.Decoder.GetChars%2A?displayProperty=nameWithType> Metoda może pomyślnie zdekodować tablicę bajtową, aby uzyskać oryginalny ciąg.</span><span class="sxs-lookup"><span data-stu-id="dd327-235">On the other hand, the <xref:System.Text.Decoder.GetChars%2A?displayProperty=nameWithType> method is able to successfully decode the byte array to get the original string.</span></span>

[!code-csharp[Conceptual.Encoding#10](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/stream1.cs#10)]
[!code-vb[Conceptual.Encoding#10](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/stream1.vb#10)]

<a name="FallbackStrategy"></a>

## <a name="choosing-a-fallback-strategy"></a><span data-ttu-id="dd327-236">Wybór strategii rezerwowej</span><span class="sxs-lookup"><span data-stu-id="dd327-236">Choosing a Fallback Strategy</span></span>

<span data-ttu-id="dd327-237">Gdy metoda próbuje zakodować lub zdekodować znak, ale nie istnieje żadne mapowanie, musi zaimplementować strategię rezerwową, która określa sposób obsługi mapowania zakończonego niepowodzeniem.</span><span class="sxs-lookup"><span data-stu-id="dd327-237">When a method tries to encode or decode a character but no mapping exists, it must implement a fallback strategy that determines how the failed mapping should be handled.</span></span> <span data-ttu-id="dd327-238">Istnieją trzy typy strategii powrotu:</span><span class="sxs-lookup"><span data-stu-id="dd327-238">There are three types of fallback strategies:</span></span>

- <span data-ttu-id="dd327-239">Dopasowanie najlepszego dopasowania</span><span class="sxs-lookup"><span data-stu-id="dd327-239">Best-fit fallback</span></span>

- <span data-ttu-id="dd327-240">Alternatywa wymiany</span><span class="sxs-lookup"><span data-stu-id="dd327-240">Replacement fallback</span></span>

- <span data-ttu-id="dd327-241">Rezerwa wyjątku</span><span class="sxs-lookup"><span data-stu-id="dd327-241">Exception fallback</span></span>

> [!IMPORTANT]
> <span data-ttu-id="dd327-242">Najczęstsze problemy w operacjach kodowania są wykonywane, gdy znak Unicode nie może zostać zmapowany na konkretne kodowanie strony kodowej.</span><span class="sxs-lookup"><span data-stu-id="dd327-242">The most common problems in encoding operations occur when a Unicode character cannot be mapped to a particular code page encoding.</span></span> <span data-ttu-id="dd327-243">Najczęstsze problemy związane z dekodowaniem są wykonywane, gdy nieprawidłowe sekwencje bajtów nie mogą być przetłumaczone na prawidłowe znaki Unicode.</span><span class="sxs-lookup"><span data-stu-id="dd327-243">The most common problems in decoding operations occur when invalid byte sequences cannot be translated into valid Unicode characters.</span></span> <span data-ttu-id="dd327-244">Z tego względu należy wiedzieć, która strategia rezerwowa używa danego obiektu kodowania.</span><span class="sxs-lookup"><span data-stu-id="dd327-244">For these reasons, you should know which fallback strategy a particular encoding object uses.</span></span> <span data-ttu-id="dd327-245">Zawsze, gdy jest to możliwe, należy określić strategię rezerwową używaną przez obiekt kodowania podczas tworzenia wystąpienia obiektu.</span><span class="sxs-lookup"><span data-stu-id="dd327-245">Whenever possible, you should specify the fallback strategy used by an encoding object when you instantiate the object.</span></span>

<a name="BestFit"></a>

### <a name="best-fit-fallback"></a><span data-ttu-id="dd327-246">Dopasowanie najlepszego dopasowania</span><span class="sxs-lookup"><span data-stu-id="dd327-246">Best-Fit Fallback</span></span>

<span data-ttu-id="dd327-247">Gdy znak nie ma dokładnego dopasowania w kodowaniu docelowym, koder może próbować zmapować go do podobnego znaku.</span><span class="sxs-lookup"><span data-stu-id="dd327-247">When a character does not have an exact match in the target encoding, the encoder can try to map it to a similar character.</span></span> <span data-ttu-id="dd327-248">(Najlepszym dopasowaniem jest raczej kodowanie, a nie problem z dekodowaniem.</span><span class="sxs-lookup"><span data-stu-id="dd327-248">(Best-fit fallback is mostly an encoding rather than a decoding issue.</span></span> <span data-ttu-id="dd327-249">Istnieje kilka stron kodowych, które zawierają znaki, których nie można pomyślnie zmapować na Unicode.) Najlepszym dopasowaniem jest wartość domyślna dla kodowania strony kodowej i dwubajtowego zestawu znaków, które są pobierane przez przeciążenia <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> i <xref:System.Text.Encoding.GetEncoding%28System.String%29?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="dd327-249">There are very few code pages that contain characters that cannot be successfully mapped to Unicode.) Best-fit fallback is the default for code page and double-byte character set encodings that are retrieved by the <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> and <xref:System.Text.Encoding.GetEncoding%28System.String%29?displayProperty=nameWithType> overloads.</span></span>

> [!NOTE]
> <span data-ttu-id="dd327-250">Teoretycznie, klasy kodowania Unicode zapewniane w .NET (<xref:System.Text.UTF8Encoding>, <xref:System.Text.UnicodeEncoding>i <xref:System.Text.UTF32Encoding>) obsługują każdy znak w każdym zestawie znaków, dzięki czemu mogą one być używane w celu wyeliminowania najbardziej pasujących problemów powrotu.</span><span class="sxs-lookup"><span data-stu-id="dd327-250">In theory, the Unicode encoding classes provided in .NET (<xref:System.Text.UTF8Encoding>, <xref:System.Text.UnicodeEncoding>, and <xref:System.Text.UTF32Encoding>) support every character in every character set, so they can be used to eliminate best-fit fallback issues.</span></span>

<span data-ttu-id="dd327-251">Najlepiej dopasowane strategie różnią się w zależności od stron kodowych.</span><span class="sxs-lookup"><span data-stu-id="dd327-251">Best-fit strategies vary for different code pages.</span></span> <span data-ttu-id="dd327-252">Na przykład w przypadku niektórych stron kodowych znaki łacińskie o pełnej szerokości są mapowane na bardziej popularne znaki łacińskie połówkowej szerokości.</span><span class="sxs-lookup"><span data-stu-id="dd327-252">For example, for some code pages, full-width Latin characters map to the more common half-width Latin characters.</span></span> <span data-ttu-id="dd327-253">W przypadku innych stron kodowych mapowanie nie jest wykonywane.</span><span class="sxs-lookup"><span data-stu-id="dd327-253">For other code pages, this mapping is not made.</span></span> <span data-ttu-id="dd327-254">Nawet w ramach agresywnej strategii najlepiej dopasowanej nie ma żadnych znaków w przypadku niektórych kodowań.</span><span class="sxs-lookup"><span data-stu-id="dd327-254">Even under an aggressive best-fit strategy, there is no imaginable fit for some characters in some encodings.</span></span> <span data-ttu-id="dd327-255">Na przykład, ideograph chiński nie ma uzasadnionego mapowania na stronę kodową 1252.</span><span class="sxs-lookup"><span data-stu-id="dd327-255">For example, a Chinese ideograph has no reasonable mapping to code page 1252.</span></span> <span data-ttu-id="dd327-256">W takim przypadku używany jest ciąg zastępczy.</span><span class="sxs-lookup"><span data-stu-id="dd327-256">In this case, a replacement string is used.</span></span> <span data-ttu-id="dd327-257">Domyślnie ten ciąg jest tylko pojedynczym ZNAKiem zapytania (U + 003F).</span><span class="sxs-lookup"><span data-stu-id="dd327-257">By default, this string is just a single QUESTION MARK (U+003F).</span></span>

> [!NOTE]
> <span data-ttu-id="dd327-258">Strategie najlepiej dopasowane nie są udokumentowane szczegółowo.</span><span class="sxs-lookup"><span data-stu-id="dd327-258">Best-fit strategies are not documented in detail.</span></span> <span data-ttu-id="dd327-259">Jednak kilka stron kodowych są udokumentowane w witrynie sieci Web [konsorcjum Unicode](https://www.unicode.org/Public/MAPPINGS/VENDORS/MICSFT/WindowsBestFit/) .</span><span class="sxs-lookup"><span data-stu-id="dd327-259">However, several code pages are documented at the [Unicode Consortium's](https://www.unicode.org/Public/MAPPINGS/VENDORS/MICSFT/WindowsBestFit/) website.</span></span> <span data-ttu-id="dd327-260">Aby uzyskać opis sposobu interpretacji plików mapowania, zapoznaj się z plikiem **README. txt** w tym folderze.</span><span class="sxs-lookup"><span data-stu-id="dd327-260">Please review the **readme.txt** file in that folder for a description of how to interpret the mapping files.</span></span>

<span data-ttu-id="dd327-261">Poniższy przykład używa strony kodowej 1252 (strona kodowa systemu Windows dla języków zachodnich Europy) do zilustrowania najlepszego mapowania i jego wad.</span><span class="sxs-lookup"><span data-stu-id="dd327-261">The following example uses code page 1252 (the Windows code page for Western European languages) to illustrate best-fit mapping and its drawbacks.</span></span> <span data-ttu-id="dd327-262"><xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> Metoda jest używana do pobierania obiektu kodowania dla strony kodowej 1252.</span><span class="sxs-lookup"><span data-stu-id="dd327-262">The <xref:System.Text.Encoding.GetEncoding%28System.Int32%29?displayProperty=nameWithType> method is used to retrieve an encoding object for code page 1252.</span></span> <span data-ttu-id="dd327-263">Domyślnie używa mapowania najlepszego dopasowania dla znaków Unicode, które nie są obsługiwane.</span><span class="sxs-lookup"><span data-stu-id="dd327-263">By default, it uses a best-fit mapping for Unicode characters that it does not support.</span></span> <span data-ttu-id="dd327-264">Przykład tworzy wystąpienie ciągu, który zawiera trzy znaki inne niż ASCII — WYRÓŻNIONe Wielka litera S (U + 24C8), indeks GÓRNy 5 (U + 2075) i NIESKOŃCZONość (U + 221E) — rozdzielone spacjami.</span><span class="sxs-lookup"><span data-stu-id="dd327-264">The example instantiates a string that contains three non-ASCII characters - CIRCLED LATIN CAPITAL LETTER S (U+24C8), SUPERSCRIPT FIVE (U+2075), and INFINITY (U+221E) - separated by spaces.</span></span> <span data-ttu-id="dd327-265">Jako dane wyjściowe z przykładu pokazują, gdy ciąg jest zakodowany, trzy oryginalne znaki niebędące znakami spacji są zastępowane na podstawie znaku zapytania (U + 003F), cyfry pięć (U + 0035) i cyfry osiem (U + 0038).</span><span class="sxs-lookup"><span data-stu-id="dd327-265">As the output from the example shows, when the string is encoded, the three original non-space characters are replaced by QUESTION MARK (U+003F), DIGIT FIVE (U+0035), and DIGIT EIGHT (U+0038).</span></span> <span data-ttu-id="dd327-266">CYFRa osiem to szczególnie słabe zastąpienie dla nieobsługiwanego znaku NIESKOŃCZONości, a znak zapytania wskazuje, że dla oryginalnego znaku nie jest dostępne żadne mapowanie.</span><span class="sxs-lookup"><span data-stu-id="dd327-266">DIGIT EIGHT is a particularly poor replacement for the unsupported INFINITY character, and QUESTION MARK indicates that no mapping was available for the original character.</span></span>

[!code-csharp[Conceptual.Encoding#1](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/bestfit1.cs#1)]
[!code-vb[Conceptual.Encoding#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/bestfit1.vb#1)]

<span data-ttu-id="dd327-267">Najwygodniejsze mapowanie jest domyślnym zachowaniem dla <xref:System.Text.Encoding> obiektu, który koduje dane Unicode na dane strony kodowej, a istnieją starsze aplikacje korzystające z tego zachowania.</span><span class="sxs-lookup"><span data-stu-id="dd327-267">Best-fit mapping is the default behavior for an <xref:System.Text.Encoding> object that encodes Unicode data into code page data, and there are legacy applications that rely on this behavior.</span></span> <span data-ttu-id="dd327-268">Jednak większość nowych aplikacji powinna unikać optymalnego zachowania ze względów bezpieczeństwa.</span><span class="sxs-lookup"><span data-stu-id="dd327-268">However, most new applications should avoid best-fit behavior for security reasons.</span></span> <span data-ttu-id="dd327-269">Na przykład aplikacje nie powinny umieszczać nazwy domeny za pomocą najlepszego dopasowania kodowania.</span><span class="sxs-lookup"><span data-stu-id="dd327-269">For example, applications should not put a domain name through a best-fit encoding.</span></span>

> [!NOTE]
> <span data-ttu-id="dd327-270">Możesz również zaimplementować niestandardowe mapowanie rezerwy najlepszego dopasowania dla kodowania.</span><span class="sxs-lookup"><span data-stu-id="dd327-270">You can also implement a custom best-fit fallback mapping for an encoding.</span></span> <span data-ttu-id="dd327-271">Aby uzyskać więcej informacji, zobacz sekcję [implementowanie niestandardowej strategii rezerwowej](../../../docs/standard/base-types/character-encoding.md#Custom) .</span><span class="sxs-lookup"><span data-stu-id="dd327-271">For more information, see the [Implementing a Custom Fallback Strategy](../../../docs/standard/base-types/character-encoding.md#Custom) section.</span></span>

<span data-ttu-id="dd327-272">Jeśli jest to wartość domyślna dla obiektu Encoding, można wybrać inną strategię rezerwową podczas pobierania <xref:System.Text.Encoding> obiektu przez wywołanie metody <xref:System.Text.Encoding.GetEncoding%28System.Int32%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> lub <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> przeciążenia.</span><span class="sxs-lookup"><span data-stu-id="dd327-272">If best-fit fallback is the default for an encoding object, you can choose another fallback strategy when you retrieve an <xref:System.Text.Encoding> object by calling the <xref:System.Text.Encoding.GetEncoding%28System.Int32%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> or <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> overload.</span></span> <span data-ttu-id="dd327-273">Poniższa sekcja zawiera przykład zastępujący każdy znak, którego nie można zamapować na stronę kodową 1252 przy użyciu gwiazdki (\*).</span><span class="sxs-lookup"><span data-stu-id="dd327-273">The following section includes an example that replaces each character that cannot be mapped to code page 1252 with an asterisk (\*).</span></span>

[!code-csharp[Conceptual.Encoding#3](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/bestfit1a.cs#3)]
[!code-vb[Conceptual.Encoding#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/bestfit1a.vb#3)]

<a name="Replacement"></a>

### <a name="replacement-fallback"></a><span data-ttu-id="dd327-274">Alternatywa wymiany</span><span class="sxs-lookup"><span data-stu-id="dd327-274">Replacement Fallback</span></span>

<span data-ttu-id="dd327-275">Gdy znak nie ma dokładnego dopasowania w schemacie docelowym, ale nie ma odpowiedniego znaku, do którego można zamapować, aplikacja może określić znak zastępczy lub ciąg.</span><span class="sxs-lookup"><span data-stu-id="dd327-275">When a character does not have an exact match in the target scheme, but there is no appropriate character that it can be mapped to, the application can specify a replacement character or string.</span></span> <span data-ttu-id="dd327-276">Jest to domyślne zachowanie dla dekodera Unicode, który zastępuje dowolną dwubajtową sekwencję, której nie można zdekodować przy użyciu REPLACEMENT_CHARACTER (U + FFFD).</span><span class="sxs-lookup"><span data-stu-id="dd327-276">This is the default behavior for the Unicode decoder, which replaces any two-byte sequence that it cannot decode with REPLACEMENT_CHARACTER (U+FFFD).</span></span> <span data-ttu-id="dd327-277">Jest to również domyślne zachowanie <xref:System.Text.ASCIIEncoding> klasy, która zastępuje każdy znak, którego nie można kodować ani zdekodować ze znakiem zapytania.</span><span class="sxs-lookup"><span data-stu-id="dd327-277">It is also the default behavior of the <xref:System.Text.ASCIIEncoding> class, which replaces each character that it cannot encode or decode with a question mark.</span></span> <span data-ttu-id="dd327-278">Poniższy przykład ilustruje zastąpienie znaków w ciągu Unicode z poprzedniego przykładu.</span><span class="sxs-lookup"><span data-stu-id="dd327-278">The following example illustrates character replacement for the Unicode string from the previous example.</span></span> <span data-ttu-id="dd327-279">Ponieważ dane wyjściowe są wyświetlane, każdy znak, którego nie można zdekodować do wartości bajtowej ASCII, jest zastępowany przez 0x3F, który jest kodem ASCII dla znaku zapytania.</span><span class="sxs-lookup"><span data-stu-id="dd327-279">As the output shows, each character that cannot be decoded into an ASCII byte value is replaced by 0x3F, which is the ASCII code for a question mark.</span></span>

[!code-csharp[Conceptual.Encoding#2](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/replacementascii.cs#2)]
[!code-vb[Conceptual.Encoding#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/replacementascii.vb#2)]

<span data-ttu-id="dd327-280">Platforma .NET zawiera <xref:System.Text.EncoderReplacementFallback> klasy <xref:System.Text.DecoderReplacementFallback> i, które zastępują ciąg zamienny, jeśli znak nie jest mapowany dokładnie w operacji kodowania lub dekodowania.</span><span class="sxs-lookup"><span data-stu-id="dd327-280">.NET includes the <xref:System.Text.EncoderReplacementFallback> and <xref:System.Text.DecoderReplacementFallback> classes, which substitute a replacement string if a character does not map exactly in an encoding or decoding operation.</span></span> <span data-ttu-id="dd327-281">Domyślnie ten ciąg zamienny jest znakiem zapytania, ale można wywołać przeciążenie konstruktora klasy w celu wybrania innego ciągu.</span><span class="sxs-lookup"><span data-stu-id="dd327-281">By default, this replacement string is a question mark, but you can call a class constructor overload to choose a different string.</span></span> <span data-ttu-id="dd327-282">Zazwyczaj ciąg zamienny jest pojedynczym znakiem, chociaż nie jest to wymagane.</span><span class="sxs-lookup"><span data-stu-id="dd327-282">Typically, the replacement string is a single character, although this is not a requirement.</span></span> <span data-ttu-id="dd327-283">Poniższy przykład zmienia zachowanie kodera 1252 strony kodowej przez utworzenie wystąpienia <xref:System.Text.EncoderReplacementFallback> obiektu, który używa gwiazdki (\*) jako ciągu zastępczego.</span><span class="sxs-lookup"><span data-stu-id="dd327-283">The following example changes the behavior of the code page 1252 encoder by instantiating an <xref:System.Text.EncoderReplacementFallback> object that uses an asterisk (\*) as a replacement string.</span></span>

[!code-csharp[Conceptual.Encoding#3](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/bestfit1a.cs#3)]
[!code-vb[Conceptual.Encoding#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/bestfit1a.vb#3)]

> [!NOTE]
> <span data-ttu-id="dd327-284">Można również zaimplementować klasę zastępczą dla kodowania.</span><span class="sxs-lookup"><span data-stu-id="dd327-284">You can also implement a replacement class for an encoding.</span></span> <span data-ttu-id="dd327-285">Aby uzyskać więcej informacji, zobacz sekcję [implementowanie niestandardowej strategii rezerwowej](../../../docs/standard/base-types/character-encoding.md#Custom) .</span><span class="sxs-lookup"><span data-stu-id="dd327-285">For more information, see the [Implementing a Custom Fallback Strategy](../../../docs/standard/base-types/character-encoding.md#Custom) section.</span></span>

<span data-ttu-id="dd327-286">Oprócz znaku zapytania (U + 003F) znak ZASTĘPCZy Unicode (U + FFFD) jest często używany jako ciąg zamienny, szczególnie w przypadku dekodowania sekwencji bajtów, których nie można pomyślnie przetłumaczyć na znaki Unicode.</span><span class="sxs-lookup"><span data-stu-id="dd327-286">In addition to QUESTION MARK (U+003F), the Unicode REPLACEMENT CHARACTER (U+FFFD) is commonly used as a replacement string, particularly when decoding byte sequences that cannot be successfully translated into Unicode characters.</span></span> <span data-ttu-id="dd327-287">Można jednak wybrać dowolny ciąg zamienny, który może zawierać wiele znaków.</span><span class="sxs-lookup"><span data-stu-id="dd327-287">However, you are free to choose any replacement string, and it can contain multiple characters.</span></span>

<a name="Exception"></a>

### <a name="exception-fallback"></a><span data-ttu-id="dd327-288">Rezerwa wyjątku</span><span class="sxs-lookup"><span data-stu-id="dd327-288">Exception Fallback</span></span>

<span data-ttu-id="dd327-289">Zamiast podawania najlepszego dopasowania lub ciągu zamiennego, koder może zgłosić, <xref:System.Text.EncoderFallbackException> Jeśli nie jest w stanie zakodować zestawu znaków, a dekoder może zgłosić, <xref:System.Text.DecoderFallbackException> Jeśli nie można zdekodować tablicy bajtów.</span><span class="sxs-lookup"><span data-stu-id="dd327-289">Instead of providing a best-fit fallback or a replacement string, an encoder can throw an <xref:System.Text.EncoderFallbackException> if it is unable to encode a set of characters, and a decoder can throw a <xref:System.Text.DecoderFallbackException> if it is unable to decode a byte array.</span></span> <span data-ttu-id="dd327-290">Aby zgłosić wyjątek w operacjach kodowania i dekodowania, należy dostarczyć <xref:System.Text.EncoderExceptionFallback> obiekt i <xref:System.Text.DecoderExceptionFallback> obiekt odpowiednio do <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> metody.</span><span class="sxs-lookup"><span data-stu-id="dd327-290">To throw an exception in encoding and decoding operations, you supply an <xref:System.Text.EncoderExceptionFallback> object and a <xref:System.Text.DecoderExceptionFallback> object, respectively, to the <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="dd327-291">Poniższy przykład ilustruje rezerwę wyjątku z <xref:System.Text.ASCIIEncoding> klasą.</span><span class="sxs-lookup"><span data-stu-id="dd327-291">The following example illustrates exception fallback with the <xref:System.Text.ASCIIEncoding> class.</span></span>

[!code-csharp[Conceptual.Encoding#4](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/exceptionascii.cs#4)]
[!code-vb[Conceptual.Encoding#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/exceptionascii.vb#4)]

> [!NOTE]
> <span data-ttu-id="dd327-292">Można również zaimplementować niestandardową procedurę obsługi wyjątków dla operacji kodowania.</span><span class="sxs-lookup"><span data-stu-id="dd327-292">You can also implement a custom exception handler for an encoding operation.</span></span> <span data-ttu-id="dd327-293">Aby uzyskać więcej informacji, zobacz sekcję [implementowanie niestandardowej strategii rezerwowej](../../../docs/standard/base-types/character-encoding.md#Custom) .</span><span class="sxs-lookup"><span data-stu-id="dd327-293">For more information, see the [Implementing a Custom Fallback Strategy](../../../docs/standard/base-types/character-encoding.md#Custom) section.</span></span>

<span data-ttu-id="dd327-294">Obiekty <xref:System.Text.EncoderFallbackException> i <xref:System.Text.DecoderFallbackException> zapewniają następujące informacje o stanie, który spowodował wyjątek:</span><span class="sxs-lookup"><span data-stu-id="dd327-294">The <xref:System.Text.EncoderFallbackException> and <xref:System.Text.DecoderFallbackException> objects provide the following information about the condition that caused the exception:</span></span>

- <span data-ttu-id="dd327-295"><xref:System.Text.EncoderFallbackException> Obiekt <xref:System.Text.EncoderFallbackException.IsUnknownSurrogate%2A> zawiera metodę, która wskazuje, czy znak lub znaki, których nie można zakodować, reprezentują nieznaną parę surogatu (w tym przypadku Metoda `true`zwraca) lub nieznany pojedynczy znak (w tym przypadku metoda zwraca `false`).</span><span class="sxs-lookup"><span data-stu-id="dd327-295">The <xref:System.Text.EncoderFallbackException> object includes an <xref:System.Text.EncoderFallbackException.IsUnknownSurrogate%2A> method, which indicates whether the character or characters that cannot be encoded represent an unknown surrogate pair (in which case, the method returns `true`) or an unknown single character (in which case, the method returns `false`).</span></span> <span data-ttu-id="dd327-296">Znaki w parze dwuskładnikowej są dostępne we <xref:System.Text.EncoderFallbackException.CharUnknownHigh%2A?displayProperty=nameWithType> właściwościach i <xref:System.Text.EncoderFallbackException.CharUnknownLow%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="dd327-296">The characters in the surrogate pair are available from the <xref:System.Text.EncoderFallbackException.CharUnknownHigh%2A?displayProperty=nameWithType> and <xref:System.Text.EncoderFallbackException.CharUnknownLow%2A?displayProperty=nameWithType> properties.</span></span> <span data-ttu-id="dd327-297">Nieznany pojedynczy znak jest dostępny z <xref:System.Text.EncoderFallbackException.CharUnknown%2A?displayProperty=nameWithType> właściwości.</span><span class="sxs-lookup"><span data-stu-id="dd327-297">The unknown single character is available from the <xref:System.Text.EncoderFallbackException.CharUnknown%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="dd327-298"><xref:System.Text.EncoderFallbackException.Index%2A?displayProperty=nameWithType> Właściwość wskazuje położenie w ciągu, w którym znaleziono pierwszy znak, który nie może zostać zakodowany.</span><span class="sxs-lookup"><span data-stu-id="dd327-298">The <xref:System.Text.EncoderFallbackException.Index%2A?displayProperty=nameWithType> property indicates the position in the string at which the first character that could not be encoded was found.</span></span>

- <span data-ttu-id="dd327-299"><xref:System.Text.DecoderFallbackException> Obiekt zawiera <xref:System.Text.DecoderFallbackException.BytesUnknown%2A> właściwość, która zwraca tablicę bajtów, których nie można zdekodować.</span><span class="sxs-lookup"><span data-stu-id="dd327-299">The <xref:System.Text.DecoderFallbackException> object includes a <xref:System.Text.DecoderFallbackException.BytesUnknown%2A> property that returns an array of bytes that cannot be decoded.</span></span> <span data-ttu-id="dd327-300"><xref:System.Text.DecoderFallbackException.Index%2A?displayProperty=nameWithType> Właściwość wskazuje pozycję początkową nieznanych bajtów.</span><span class="sxs-lookup"><span data-stu-id="dd327-300">The <xref:System.Text.DecoderFallbackException.Index%2A?displayProperty=nameWithType> property indicates the starting position of the unknown bytes.</span></span>

<span data-ttu-id="dd327-301">Chociaż obiekty <xref:System.Text.EncoderFallbackException> i <xref:System.Text.DecoderFallbackException> zapewniają odpowiednie informacje diagnostyczne o wyjątku, nie zapewniają dostępu do buforu kodowania lub dekodowania.</span><span class="sxs-lookup"><span data-stu-id="dd327-301">Although the <xref:System.Text.EncoderFallbackException> and <xref:System.Text.DecoderFallbackException> objects provide adequate diagnostic information about the exception, they do not provide access to the encoding or decoding buffer.</span></span> <span data-ttu-id="dd327-302">W związku z tym nie zezwalają na zamienianie lub korygowanie nieprawidłowych danych w ramach metody kodowania lub dekodowania.</span><span class="sxs-lookup"><span data-stu-id="dd327-302">Therefore, they do not allow invalid data to be replaced or corrected within the encoding or decoding method.</span></span>

<a name="Custom"></a>

## <a name="implementing-a-custom-fallback-strategy"></a><span data-ttu-id="dd327-303">Implementowanie niestandardowej strategii rezerwowej</span><span class="sxs-lookup"><span data-stu-id="dd327-303">Implementing a Custom Fallback Strategy</span></span>

<span data-ttu-id="dd327-304">Oprócz najlepszego mapowania, które jest implementowane wewnętrznie przez strony kodowe, platforma .NET zawiera następujące klasy do implementowania strategii rezerwowej:</span><span class="sxs-lookup"><span data-stu-id="dd327-304">In addition to the best-fit mapping that is implemented internally by code pages, .NET includes the following classes for implementing a fallback strategy:</span></span>

- <span data-ttu-id="dd327-305">Użyj <xref:System.Text.EncoderReplacementFallback> i <xref:System.Text.EncoderReplacementFallbackBuffer> , aby zamienić znaki w operacjach kodowania.</span><span class="sxs-lookup"><span data-stu-id="dd327-305">Use <xref:System.Text.EncoderReplacementFallback> and <xref:System.Text.EncoderReplacementFallbackBuffer> to replace characters in encoding operations.</span></span>

- <span data-ttu-id="dd327-306">Użyj <xref:System.Text.DecoderReplacementFallback> i <xref:System.Text.DecoderReplacementFallbackBuffer> , aby zamienić znaki podczas dekodowania operacji.</span><span class="sxs-lookup"><span data-stu-id="dd327-306">Use <xref:System.Text.DecoderReplacementFallback> and <xref:System.Text.DecoderReplacementFallbackBuffer> to replace characters in decoding operations.</span></span>

- <span data-ttu-id="dd327-307">Użyj <xref:System.Text.EncoderExceptionFallback> i <xref:System.Text.EncoderExceptionFallbackBuffer> , aby zgłosić <xref:System.Text.EncoderFallbackException> , kiedy nie można zakodować znaku.</span><span class="sxs-lookup"><span data-stu-id="dd327-307">Use <xref:System.Text.EncoderExceptionFallback> and <xref:System.Text.EncoderExceptionFallbackBuffer> to throw an <xref:System.Text.EncoderFallbackException> when a character cannot be encoded.</span></span>

- <span data-ttu-id="dd327-308">Użyj <xref:System.Text.DecoderExceptionFallback> i <xref:System.Text.DecoderExceptionFallbackBuffer> , aby zgłosić <xref:System.Text.DecoderFallbackException> , kiedy nie można zdekodować znaku.</span><span class="sxs-lookup"><span data-stu-id="dd327-308">Use <xref:System.Text.DecoderExceptionFallback> and <xref:System.Text.DecoderExceptionFallbackBuffer> to throw a <xref:System.Text.DecoderFallbackException> when a character cannot be decoded.</span></span>

<span data-ttu-id="dd327-309">Ponadto można zaimplementować niestandardowe rozwiązanie, które używa najlepszego dopasowania powrotu, powrotu zamiennej lub powrotu do wyjątków, wykonując następujące czynności:</span><span class="sxs-lookup"><span data-stu-id="dd327-309">In addition, you can implement a custom solution that uses best-fit fallback, replacement fallback, or exception fallback, by following these steps:</span></span>

1. <span data-ttu-id="dd327-310">Utwórz klasę z <xref:System.Text.EncoderFallback> dla operacji kodowania i z <xref:System.Text.DecoderFallback> dla operacji dekodowania.</span><span class="sxs-lookup"><span data-stu-id="dd327-310">Derive a class from <xref:System.Text.EncoderFallback> for encoding operations, and from <xref:System.Text.DecoderFallback> for decoding operations.</span></span>

2. <span data-ttu-id="dd327-311">Utwórz klasę z <xref:System.Text.EncoderFallbackBuffer> dla operacji kodowania i z <xref:System.Text.DecoderFallbackBuffer> dla operacji dekodowania.</span><span class="sxs-lookup"><span data-stu-id="dd327-311">Derive a class from <xref:System.Text.EncoderFallbackBuffer> for encoding operations, and from <xref:System.Text.DecoderFallbackBuffer> for decoding operations.</span></span>

3. <span data-ttu-id="dd327-312">W przypadku powrotu wyjątku, jeśli wstępnie <xref:System.Text.EncoderFallbackException> zdefiniowane <xref:System.Text.DecoderFallbackException> i klasy nie spełniają Twoich potrzeb, należy utworzyć klasę z obiektu wyjątku, takiego jak <xref:System.Exception> lub <xref:System.ArgumentException>.</span><span class="sxs-lookup"><span data-stu-id="dd327-312">For exception fallback, if the predefined <xref:System.Text.EncoderFallbackException> and <xref:System.Text.DecoderFallbackException> classes do not meet your needs, derive a class from an exception object such as <xref:System.Exception> or <xref:System.ArgumentException>.</span></span>

### <a name="deriving-from-encoderfallback-or-decoderfallback"></a><span data-ttu-id="dd327-313">Wyprowadzanie z EncoderFallback lub DecoderFallback</span><span class="sxs-lookup"><span data-stu-id="dd327-313">Deriving from EncoderFallback or DecoderFallback</span></span>

<span data-ttu-id="dd327-314">Aby zaimplementować niestandardowe rozwiązanie alternatywne, należy utworzyć klasę, która dziedziczy z <xref:System.Text.EncoderFallback> dla operacji kodowania i z <xref:System.Text.DecoderFallback> dla operacji dekodowania.</span><span class="sxs-lookup"><span data-stu-id="dd327-314">To implement a custom fallback solution, you must create a class that inherits from <xref:System.Text.EncoderFallback> for encoding operations, and from <xref:System.Text.DecoderFallback> for decoding operations.</span></span> <span data-ttu-id="dd327-315">Wystąpienia tych klas są przesyłane do <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> metody i służą jako pośrednik między klasą kodowania a implementacją rezerwową.</span><span class="sxs-lookup"><span data-stu-id="dd327-315">Instances of these classes are passed to the <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> method and serve as the intermediary between the encoding class and the fallback implementation.</span></span>

<span data-ttu-id="dd327-316">W przypadku tworzenia niestandardowego rozwiązania alternatywnego dla kodera lub dekodera należy zaimplementować następujące elementy członkowskie:</span><span class="sxs-lookup"><span data-stu-id="dd327-316">When you create a custom fallback solution for an encoder or decoder, you must implement the following members:</span></span>

- <span data-ttu-id="dd327-317">Właściwość <xref:System.Text.EncoderFallback.MaxCharCount%2A?displayProperty=nameWithType> lub <xref:System.Text.DecoderFallback.MaxCharCount%2A?displayProperty=nameWithType> , która zwraca maksymalną możliwą liczbę znaków, które można zwrócić, aby zamienić pojedynczy znak.</span><span class="sxs-lookup"><span data-stu-id="dd327-317">The <xref:System.Text.EncoderFallback.MaxCharCount%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallback.MaxCharCount%2A?displayProperty=nameWithType> property, which returns the maximum possible number of characters that the best-fit, replacement, or exception fallback can return to replace a single character.</span></span> <span data-ttu-id="dd327-318">W przypadku niestandardowego powrotu wyjątku jego wartość wynosi zero.</span><span class="sxs-lookup"><span data-stu-id="dd327-318">For a custom exception fallback, its value is zero.</span></span>

- <span data-ttu-id="dd327-319">Metoda <xref:System.Text.EncoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> , która zwraca niestandardowy <xref:System.Text.EncoderFallbackBuffer> lub <xref:System.Text.DecoderFallbackBuffer> implementację.</span><span class="sxs-lookup"><span data-stu-id="dd327-319">The <xref:System.Text.EncoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> method, which returns your custom <xref:System.Text.EncoderFallbackBuffer> or <xref:System.Text.DecoderFallbackBuffer> implementation.</span></span> <span data-ttu-id="dd327-320">Metoda jest wywoływana przez koder, gdy napotka pierwszy znak, który nie może zostać pomyślnie zakodowany, lub przez dekoder w przypadku napotkania pierwszego bajtu, którego nie można pomyślnie zdekodować.</span><span class="sxs-lookup"><span data-stu-id="dd327-320">The method is called by the encoder when it encounters the first character that it is unable to successfully encode, or by the decoder when it encounters the first byte that it is unable to successfully decode.</span></span>

### <a name="deriving-from-encoderfallbackbuffer-or-decoderfallbackbuffer"></a><span data-ttu-id="dd327-321">Wyprowadzanie z EncoderFallbackBuffer lub DecoderFallbackBuffer</span><span class="sxs-lookup"><span data-stu-id="dd327-321">Deriving from EncoderFallbackBuffer or DecoderFallbackBuffer</span></span>

<span data-ttu-id="dd327-322">Aby zaimplementować niestandardowe rozwiązanie alternatywne, należy również utworzyć klasę, która dziedziczy z <xref:System.Text.EncoderFallbackBuffer> dla operacji kodowania i z <xref:System.Text.DecoderFallbackBuffer> dla operacji dekodowania.</span><span class="sxs-lookup"><span data-stu-id="dd327-322">To implement a custom fallback solution, you must also create a class that inherits from <xref:System.Text.EncoderFallbackBuffer> for encoding operations, and from <xref:System.Text.DecoderFallbackBuffer> for decoding operations.</span></span> <span data-ttu-id="dd327-323">Wystąpienia tych klas są zwracane przez <xref:System.Text.EncoderFallback.CreateFallbackBuffer%2A> metodę klas <xref:System.Text.EncoderFallback> i. <xref:System.Text.DecoderFallback></span><span class="sxs-lookup"><span data-stu-id="dd327-323">Instances of these classes are returned by the <xref:System.Text.EncoderFallback.CreateFallbackBuffer%2A> method  of the <xref:System.Text.EncoderFallback> and <xref:System.Text.DecoderFallback> classes.</span></span> <span data-ttu-id="dd327-324"><xref:System.Text.EncoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> Metoda jest wywoływana przez koder, gdy napotka pierwszy znak, który nie jest w stanie kodować, a <xref:System.Text.DecoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> Metoda jest wywoływana przez dekoder, gdy napotka jeden lub więcej bajtów, których nie można zdekodować.</span><span class="sxs-lookup"><span data-stu-id="dd327-324">The <xref:System.Text.EncoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> method is called by the encoder when it encounters the first character that it is not able to encode, and the <xref:System.Text.DecoderFallback.CreateFallbackBuffer%2A?displayProperty=nameWithType> method is called by the decoder when it encounters one or more bytes that it is not able to decode.</span></span> <span data-ttu-id="dd327-325">Klasy <xref:System.Text.EncoderFallbackBuffer> i <xref:System.Text.DecoderFallbackBuffer> zapewniają implementację rezerwową.</span><span class="sxs-lookup"><span data-stu-id="dd327-325">The <xref:System.Text.EncoderFallbackBuffer> and <xref:System.Text.DecoderFallbackBuffer> classes provide the fallback implementation.</span></span> <span data-ttu-id="dd327-326">Każde wystąpienie reprezentuje bufor, który zawiera znaki rezerwowe, które zastąpią znak, którego nie można zakodować lub nie można zdekodować sekwencji bajtów.</span><span class="sxs-lookup"><span data-stu-id="dd327-326">Each instance represents a buffer that contains the fallback characters that will replace the character that cannot be encoded or the byte sequence that cannot be decoded.</span></span>

<span data-ttu-id="dd327-327">W przypadku tworzenia niestandardowego rozwiązania alternatywnego dla kodera lub dekodera należy zaimplementować następujące elementy członkowskie:</span><span class="sxs-lookup"><span data-stu-id="dd327-327">When you create a custom fallback solution for an encoder or decoder, you must implement the following members:</span></span>

- <span data-ttu-id="dd327-328">Metoda <xref:System.Text.EncoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="dd327-328">The <xref:System.Text.EncoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="dd327-329"><xref:System.Text.EncoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType>jest wywoływany przez koder w celu dostarczenia bufora rezerwowego informacjami o znaku, którego nie może zakodować.</span><span class="sxs-lookup"><span data-stu-id="dd327-329"><xref:System.Text.EncoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> is called by the encoder to provide the fallback buffer with information about the character that it cannot encode.</span></span> <span data-ttu-id="dd327-330">Ponieważ znak, który ma być zakodowany, może być parą zastępczą, ta metoda jest przeciążona.</span><span class="sxs-lookup"><span data-stu-id="dd327-330">Because the character to be encoded may be a surrogate pair, this method is overloaded.</span></span> <span data-ttu-id="dd327-331">Jedno Przeciążenie jest przekazanie znaku, który ma zostać zakodowany i jego indeks w ciągu.</span><span class="sxs-lookup"><span data-stu-id="dd327-331">One overload is passed the character to be encoded and its index in the string.</span></span> <span data-ttu-id="dd327-332">Drugie Przeciążenie jest przenoszone z górnego i niskiego surogatu wraz z jego indeksem w ciągu.</span><span class="sxs-lookup"><span data-stu-id="dd327-332">The second overload is passed the high and low surrogate along with its index in the string.</span></span> <span data-ttu-id="dd327-333"><xref:System.Text.DecoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> Metoda jest wywoływana przez dekoder w celu dostarczenia bufora rezerwowego informacjami o bajtach, których nie można zdekodować.</span><span class="sxs-lookup"><span data-stu-id="dd327-333">The <xref:System.Text.DecoderFallbackBuffer.Fallback%2A?displayProperty=nameWithType> method is called by the decoder to provide the fallback buffer with information about the bytes that it cannot decode.</span></span> <span data-ttu-id="dd327-334">Ta metoda jest przenoszona tablicą bajtów, której nie można zdekodować, wraz z indeksem pierwszego bajtu.</span><span class="sxs-lookup"><span data-stu-id="dd327-334">This method is passed an array of bytes that it cannot decode, along with the index of the first byte.</span></span> <span data-ttu-id="dd327-335">Metoda rezerwowa powinna zwracać `true` , jeśli bufor rezerwowy może dostarczyć najlepiej pasujący lub zastępczy znak lub znaki; w przeciwnym razie powinna zwrócić `false`.</span><span class="sxs-lookup"><span data-stu-id="dd327-335">The fallback method should return `true` if the fallback buffer can supply a best-fit or replacement character or characters; otherwise, it should return `false`.</span></span> <span data-ttu-id="dd327-336">W przypadku powrotu wyjątku Metoda rezerwowa powinna zgłosić wyjątek.</span><span class="sxs-lookup"><span data-stu-id="dd327-336">For an exception fallback, the fallback method should throw an exception.</span></span>

- <span data-ttu-id="dd327-337">Metoda <xref:System.Text.EncoderFallbackBuffer.GetNextChar%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallbackBuffer.GetNextChar%2A?displayProperty=nameWithType> , która jest wywoływana wielokrotnie przez koder lub dekoder w celu uzyskania następnego znaku z buforu rezerwowego.</span><span class="sxs-lookup"><span data-stu-id="dd327-337">The <xref:System.Text.EncoderFallbackBuffer.GetNextChar%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallbackBuffer.GetNextChar%2A?displayProperty=nameWithType> method, which is called repeatedly by the encoder or decoder to get the next character from the fallback buffer.</span></span> <span data-ttu-id="dd327-338">Gdy wszystkie znaki powrotu zostały zwrócone, metoda powinna zwrócić U + 0000.</span><span class="sxs-lookup"><span data-stu-id="dd327-338">When all fallback characters have been returned, the method should return U+0000.</span></span>

- <span data-ttu-id="dd327-339">Właściwość <xref:System.Text.EncoderFallbackBuffer.Remaining%2A?displayProperty=nameWithType> lub <xref:System.Text.DecoderFallbackBuffer.Remaining%2A?displayProperty=nameWithType> , która zwraca liczbę znaków pozostałych w buforze rezerwowym.</span><span class="sxs-lookup"><span data-stu-id="dd327-339">The <xref:System.Text.EncoderFallbackBuffer.Remaining%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallbackBuffer.Remaining%2A?displayProperty=nameWithType> property, which returns the number of characters remaining in the fallback buffer.</span></span>

- <span data-ttu-id="dd327-340">Metoda <xref:System.Text.EncoderFallbackBuffer.MovePrevious%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallbackBuffer.MovePrevious%2A?displayProperty=nameWithType> , która przenosi bieżącą pozycję w buforze rezerwowym do poprzedniego znaku.</span><span class="sxs-lookup"><span data-stu-id="dd327-340">The <xref:System.Text.EncoderFallbackBuffer.MovePrevious%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallbackBuffer.MovePrevious%2A?displayProperty=nameWithType> method, which moves the current position in the fallback buffer to the previous character.</span></span>

- <span data-ttu-id="dd327-341">Metoda <xref:System.Text.EncoderFallbackBuffer.Reset%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallbackBuffer.Reset%2A?displayProperty=nameWithType> , która ponownie inicjuje bufor rezerwowy.</span><span class="sxs-lookup"><span data-stu-id="dd327-341">The <xref:System.Text.EncoderFallbackBuffer.Reset%2A?displayProperty=nameWithType> or <xref:System.Text.DecoderFallbackBuffer.Reset%2A?displayProperty=nameWithType> method, which reinitializes the fallback buffer.</span></span>

<span data-ttu-id="dd327-342">Jeśli implementacja powrotu jest najlepszym dopasowaną rezerwą lub alternatywą zamienną, klasy pochodne od <xref:System.Text.EncoderFallbackBuffer> i <xref:System.Text.DecoderFallbackBuffer> utrzymują również dwa prywatne pola wystąpień: dokładną liczbę znaków w buforze; i indeks następnego znaku w buforze, który ma zostać zwrócony.</span><span class="sxs-lookup"><span data-stu-id="dd327-342">If the fallback implementation is a best-fit fallback or a replacement fallback, the classes derived from <xref:System.Text.EncoderFallbackBuffer> and <xref:System.Text.DecoderFallbackBuffer> also maintain two private instance fields: the exact number of characters in the buffer; and the index of the next character in the buffer to return.</span></span>

### <a name="an-encoderfallback-example"></a><span data-ttu-id="dd327-343">Przykład EncoderFallback</span><span class="sxs-lookup"><span data-stu-id="dd327-343">An EncoderFallback Example</span></span>

<span data-ttu-id="dd327-344">W poprzednim przykładzie użyto powrotu zamiennej zastępującej znaki Unicode, które nie odpowiadają znakom ASCII z gwiazdką (\*).</span><span class="sxs-lookup"><span data-stu-id="dd327-344">An earlier example used replacement fallback to replace Unicode characters that did not correspond to ASCII characters with an asterisk (\*).</span></span> <span data-ttu-id="dd327-345">W poniższym przykładzie zastosowano niestandardową implementację rezerwową najlepiej w celu zapewnienia lepszego mapowania znaków innych niż ASCII.</span><span class="sxs-lookup"><span data-stu-id="dd327-345">The following example uses a custom best-fit fallback implementation instead to provide a better mapping of non-ASCII characters.</span></span>

<span data-ttu-id="dd327-346">Poniższy kod definiuje klasę o nazwie `CustomMapper` , która pochodzi od <xref:System.Text.EncoderFallback> do obsługi najlepszego mapowania znaków innych niż ASCII.</span><span class="sxs-lookup"><span data-stu-id="dd327-346">The following code defines a class named `CustomMapper` that is derived from <xref:System.Text.EncoderFallback> to handle the best-fit mapping of non-ASCII characters.</span></span> <span data-ttu-id="dd327-347">`CreateFallbackBuffer` Metoda zwraca `CustomMapperFallbackBuffer` obiekt, który dostarcza <xref:System.Text.EncoderFallbackBuffer> implementację.</span><span class="sxs-lookup"><span data-stu-id="dd327-347">Its `CreateFallbackBuffer` method returns a `CustomMapperFallbackBuffer` object, which provides the <xref:System.Text.EncoderFallbackBuffer> implementation.</span></span> <span data-ttu-id="dd327-348">`CustomMapper` Klasa używa <xref:System.Collections.Generic.Dictionary%602> obiektu do przechowywania mapowań nieobsługiwanych znaków Unicode (wartość klucza) i odpowiadających im znaków 8-bitowych (które są przechowywane w dwóch kolejnych bajtach w 64-bitowej liczbie całkowitej).</span><span class="sxs-lookup"><span data-stu-id="dd327-348">The `CustomMapper` class uses a <xref:System.Collections.Generic.Dictionary%602> object to store the mappings of unsupported Unicode characters (the key value) and their corresponding 8-bit characters (which are stored in two consecutive bytes in a 64-bit integer).</span></span> <span data-ttu-id="dd327-349">Aby to mapowanie było dostępne dla buforu rezerwowego, `CustomMapper` wystąpienie jest przesyłane jako parametr do konstruktora `CustomMapperFallbackBuffer` klasy.</span><span class="sxs-lookup"><span data-stu-id="dd327-349">To make this mapping available to the fallback buffer, the `CustomMapper` instance is passed as a parameter to the `CustomMapperFallbackBuffer` class constructor.</span></span> <span data-ttu-id="dd327-350">Ponieważ najdłuższym mapowaniem jest ciąg "INF" dla znaku Unicode U + 221E, `MaxCharCount` Właściwość zwraca wartość 3.</span><span class="sxs-lookup"><span data-stu-id="dd327-350">Because the longest mapping is the string "INF" for the Unicode character U+221E, the `MaxCharCount` property returns 3.</span></span>

[!code-csharp[Conceptual.Encoding#5](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/custom1.cs#5)]
[!code-vb[Conceptual.Encoding#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/custom1.vb#5)]

<span data-ttu-id="dd327-351">Poniższy kod definiuje `CustomMapperFallbackBuffer` klasę, która pochodzi od <xref:System.Text.EncoderFallbackBuffer>.</span><span class="sxs-lookup"><span data-stu-id="dd327-351">The following code defines the `CustomMapperFallbackBuffer` class, which is derived from <xref:System.Text.EncoderFallbackBuffer>.</span></span> <span data-ttu-id="dd327-352">Słownik zawierający najlepsze mapowania i zdefiniowany w `CustomMapper` wystąpieniu jest dostępny z konstruktora klasy.</span><span class="sxs-lookup"><span data-stu-id="dd327-352">The dictionary that contains best-fit mappings and that is defined in the `CustomMapper` instance is available from its class constructor.</span></span> <span data-ttu-id="dd327-353">Jego `Fallback` Metoda zwraca `true` Jeśli którykolwiek ze znaków Unicode, które nie mogą kodować kodera ASCII, jest zdefiniowany w słowniku mapowania; w przeciwnym razie zwraca `false`.</span><span class="sxs-lookup"><span data-stu-id="dd327-353">Its `Fallback` method returns `true` if any of the Unicode characters that the ASCII encoder cannot encode are defined in the mapping dictionary; otherwise, it returns `false`.</span></span> <span data-ttu-id="dd327-354">Dla każdego powrotu zmienna prywatna `count` wskazuje liczbę znaków, która pozostała do zwrócenia, a zmienna prywatna `index` wskazuje pozycję w buforze `charsToReturn`ciągów, od następnego znaku do zwrócenia.</span><span class="sxs-lookup"><span data-stu-id="dd327-354">For each fallback, the private `count` variable indicates the number of characters that remain to be returned, and the private `index` variable indicates the position in the string buffer, `charsToReturn`, of the next character to return.</span></span>

[!code-csharp[Conceptual.Encoding#6](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/custom1.cs#6)]
[!code-vb[Conceptual.Encoding#6](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/custom1.vb#6)]

<span data-ttu-id="dd327-355">Poniższy kod powoduje utworzenie wystąpienia `CustomMapper` obiektu i przekazanie jego wystąpienia do <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> metody.</span><span class="sxs-lookup"><span data-stu-id="dd327-355">The following code then instantiates the `CustomMapper` object and passes an instance of it to the <xref:System.Text.Encoding.GetEncoding%28System.String%2CSystem.Text.EncoderFallback%2CSystem.Text.DecoderFallback%29?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="dd327-356">Dane wyjściowe wskazują, że Najlepsza zgodność implementacja rezerwy pomyślnie obsługuje trzy znaki inne niż ASCII w oryginalnym ciągu.</span><span class="sxs-lookup"><span data-stu-id="dd327-356">The output indicates that the best-fit fallback implementation successfully handles the three non-ASCII characters in the original string.</span></span>

[!code-csharp[Conceptual.Encoding#7](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.encoding/cs/custom1.cs#7)]
[!code-vb[Conceptual.Encoding#7](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.encoding/vb/custom1.vb#7)]

## <a name="see-also"></a><span data-ttu-id="dd327-357">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="dd327-357">See also</span></span>

- [<span data-ttu-id="dd327-358">Wprowadzenie do kodowania znaków w programie .NET</span><span class="sxs-lookup"><span data-stu-id="dd327-358">Introduction to character encoding in .NET</span></span>](character-encoding-introduction.md)
- <xref:System.Text.Encoder>
- <xref:System.Text.Decoder>
- <xref:System.Text.DecoderFallback>
- <xref:System.Text.Encoding>
- <xref:System.Text.EncoderFallback>
- [<span data-ttu-id="dd327-359">Globalizacja i lokalizacja</span><span class="sxs-lookup"><span data-stu-id="dd327-359">Globalization and Localization</span></span>](../../../docs/standard/globalization-localization/index.md)
