---
title: Najlepsze rozwiązania w zakresie implementacji wzorca asynchronicznego opartego na zdarzeniach
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- Event-based Asynchronous Pattern
- ProgressChangedEventArgs class
- BackgroundWorker component
- events [.NET], asynchronous
- AsyncOperationManager class
- threading [.NET], asynchronous features
- AsyncOperation class
- AsyncCompletedEventArgs class
ms.assetid: 4acd2094-4f46-4eff-9190-92d0d9ff47db
ms.openlocfilehash: 8f2b1b4d6793be3e4de6fbc9fc09e8a7e690762c
ms.sourcegitcommit: 4a938327bad8b2e20cabd0f46a9dc50882596f13
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/28/2020
ms.locfileid: "92888922"
---
# <a name="best-practices-for-implementing-the-event-based-asynchronous-pattern"></a><span data-ttu-id="ed314-102">Najlepsze rozwiązania w zakresie implementacji wzorca asynchronicznego opartego na zdarzeniach</span><span class="sxs-lookup"><span data-stu-id="ed314-102">Best Practices for Implementing the Event-based Asynchronous Pattern</span></span>

<span data-ttu-id="ed314-103">Wzorzec asynchroniczny oparty na zdarzeniach umożliwia efektywne udostępnianie zachowań asynchronicznych w klasach ze znaną semantyką zdarzeń i delegatów.</span><span class="sxs-lookup"><span data-stu-id="ed314-103">The Event-based Asynchronous Pattern provides you with an effective way to expose asynchronous behavior in classes, with familiar event and delegate semantics.</span></span> <span data-ttu-id="ed314-104">Aby zaimplementować wzorzec asynchroniczny oparty na zdarzeniach, należy przestrzegać pewnych konkretnych wymagań zachowań.</span><span class="sxs-lookup"><span data-stu-id="ed314-104">To implement Event-based Asynchronous Pattern, you need to follow some specific behavioral requirements.</span></span> <span data-ttu-id="ed314-105">W poniższych sekcjach opisano wymagania i wskazówki, które należy wziąć pod uwagę podczas implementowania klasy, która następuje po asynchronicznym wzorcu opartym na zdarzeniach.</span><span class="sxs-lookup"><span data-stu-id="ed314-105">The following sections describe requirements and guidelines you should consider when you implement a class that follows the Event-based Asynchronous Pattern.</span></span>  
  
 <span data-ttu-id="ed314-106">Aby zapoznać się z omówieniem, zobacz [implementowanie wzorca asynchronicznego opartego na zdarzeniach](implementing-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="ed314-106">For an overview, see [Implementing the Event-based Asynchronous Pattern](implementing-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="required-behavioral-guarantees"></a><span data-ttu-id="ed314-107">Wymagane gwarancje zachowania</span><span class="sxs-lookup"><span data-stu-id="ed314-107">Required Behavioral Guarantees</span></span>

 <span data-ttu-id="ed314-108">W przypadku zaimplementowania wzorca asynchronicznego opartego na zdarzeniach należy podać pewną liczbę gwarancji, aby upewnić się, że klasa będzie działać prawidłowo, a klienci klasy mogą polegać na takiej sytuacji.</span><span class="sxs-lookup"><span data-stu-id="ed314-108">If you implement the Event-based Asynchronous Pattern, you must provide a number of guarantees to ensure that your class will behave properly and clients of your class can rely on such behavior.</span></span>  
  
### <a name="completion"></a><span data-ttu-id="ed314-109">Ukończenie</span><span class="sxs-lookup"><span data-stu-id="ed314-109">Completion</span></span>

 <span data-ttu-id="ed314-110">Zawsze Wywołaj procedurę obsługi zdarzeń **zakończonych** <em>MethodName</em>po pomyślnym ukończeniu, błędzie lub anulowaniu.</span><span class="sxs-lookup"><span data-stu-id="ed314-110">Always invoke the <em>MethodName</em>**Completed** event handler when you have successful completion, an error, or a cancellation.</span></span> <span data-ttu-id="ed314-111">Aplikacje nigdy nie powinny napotkać sytuacji, w której pozostają bezczynne, a ukończenie nie następuje.</span><span class="sxs-lookup"><span data-stu-id="ed314-111">Applications should never encounter a situation where they remain idle and completion never occurs.</span></span> <span data-ttu-id="ed314-112">Jedynym wyjątkiem od tej reguły jest zaprojektowana operacja asynchroniczna, tak aby nigdy nie kończyła się.</span><span class="sxs-lookup"><span data-stu-id="ed314-112">One exception to this rule is if the asynchronous operation itself is designed so that it never completes.</span></span>  
  
### <a name="completed-event-and-eventargs"></a><span data-ttu-id="ed314-113">Zdarzenie ukończenia i EventArgs</span><span class="sxs-lookup"><span data-stu-id="ed314-113">Completed Event and EventArgs</span></span>

<span data-ttu-id="ed314-114">Dla każdej oddzielnej metody **asynchronicznej** <em>MethodName</em>należy zastosować następujące wymagania dotyczące projektu:</span><span class="sxs-lookup"><span data-stu-id="ed314-114">For each separate <em>MethodName</em>**Async** method, apply the following design requirements:</span></span>  
  
- <span data-ttu-id="ed314-115">Zdefiniuj zdarzenie <em>MethodName</em>**ukończenia** MethodName dla tej samej klasy co metoda.</span><span class="sxs-lookup"><span data-stu-id="ed314-115">Define a <em>MethodName</em>**Completed** event on the same class as the method.</span></span>  
  
- <span data-ttu-id="ed314-116">Zdefiniuj <xref:System.EventArgs> klasę i towarzyszący delegat dla zdarzenia <em>MethodName</em>**ukończone** , które wynika z <xref:System.ComponentModel.AsyncCompletedEventArgs> klasy.</span><span class="sxs-lookup"><span data-stu-id="ed314-116">Define an <xref:System.EventArgs> class and accompanying delegate for the <em>MethodName</em>**Completed** event that derives from the <xref:System.ComponentModel.AsyncCompletedEventArgs> class.</span></span> <span data-ttu-id="ed314-117">Domyślna nazwa klasy powinna mieć postać <em>MethodName</em>**CompletedEventArgs** .</span><span class="sxs-lookup"><span data-stu-id="ed314-117">The default class name should be of the form <em>MethodName</em>**CompletedEventArgs** .</span></span>  
  
- <span data-ttu-id="ed314-118">Upewnij się, że <xref:System.EventArgs> Klasa jest specyficzna dla wartości zwracanych metody <em>MethodName</em> .</span><span class="sxs-lookup"><span data-stu-id="ed314-118">Ensure that the <xref:System.EventArgs> class is specific to the return values of the <em>MethodName</em> method.</span></span> <span data-ttu-id="ed314-119">W przypadku korzystania z <xref:System.EventArgs> klasy nigdy nie należy wymagać, aby deweloperzy mogli rzutować wynik.</span><span class="sxs-lookup"><span data-stu-id="ed314-119">When you use the <xref:System.EventArgs> class, you should never require developers to cast the result.</span></span>  
  
     <span data-ttu-id="ed314-120">Poniższy przykład kodu pokazuje dobry i niewłaściwy implementację tego wymagania projektowego.</span><span class="sxs-lookup"><span data-stu-id="ed314-120">The following code example shows good and bad implementation of this design requirement respectively.</span></span>  
  
```csharp  
// Good design  
private void Form1_MethodNameCompleted(object sender, xxxCompletedEventArgs e)
{
    DemoType result = e.Result;  
}  
  
// Bad design  
private void Form1_MethodNameCompleted(object sender, MethodNameCompletedEventArgs e)
{
    DemoType result = (DemoType)(e.Result);  
}  
```  
  
- <span data-ttu-id="ed314-121">Nie należy definiować <xref:System.EventArgs> klasy dla zwracanych metod `void` .</span><span class="sxs-lookup"><span data-stu-id="ed314-121">Do not define an <xref:System.EventArgs> class for returning methods that return `void`.</span></span> <span data-ttu-id="ed314-122">Zamiast tego należy użyć wystąpienia <xref:System.ComponentModel.AsyncCompletedEventArgs> klasy.</span><span class="sxs-lookup"><span data-stu-id="ed314-122">Instead, use an instance of the <xref:System.ComponentModel.AsyncCompletedEventArgs> class.</span></span>  
  
- <span data-ttu-id="ed314-123">Upewnij się, że zawsze zostało zgłoszone zdarzenie **ukończenia** <em>MethodName</em>.</span><span class="sxs-lookup"><span data-stu-id="ed314-123">Ensure that you always raise the <em>MethodName</em>**Completed** event.</span></span> <span data-ttu-id="ed314-124">To zdarzenie należy wymusić po pomyślnym zakończeniu, po błędzie lub po anulowaniu.</span><span class="sxs-lookup"><span data-stu-id="ed314-124">This event should be raised on successful completion, on an error, or on cancellation.</span></span> <span data-ttu-id="ed314-125">Aplikacje nigdy nie powinny napotkać sytuacji, w której pozostają bezczynne, a ukończenie nie następuje.</span><span class="sxs-lookup"><span data-stu-id="ed314-125">Applications should never encounter a situation where they remain idle and completion never occurs.</span></span>  
  
- <span data-ttu-id="ed314-126">Upewnij się, że przechwytujesz wszystkie wyjątki występujące w operacji asynchronicznej i przypisz przechwycony wyjątek do <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> właściwości.</span><span class="sxs-lookup"><span data-stu-id="ed314-126">Ensure that you catch any exceptions that occur in the asynchronous operation and assign the caught exception to the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> property.</span></span>  
  
- <span data-ttu-id="ed314-127">Jeśli wystąpił błąd podczas kończenia zadania, wyniki nie powinny być dostępne.</span><span class="sxs-lookup"><span data-stu-id="ed314-127">If there was an error completing the task, the results should not be accessible.</span></span> <span data-ttu-id="ed314-128">Gdy <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> Właściwość nie jest `null` , upewnij się, że dostęp do dowolnej właściwości w <xref:System.EventArgs> strukturze zgłasza wyjątek.</span><span class="sxs-lookup"><span data-stu-id="ed314-128">When the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> property is not `null`, ensure that accessing any property in the <xref:System.EventArgs> structure raises an exception.</span></span> <span data-ttu-id="ed314-129">Użyj <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> metody, aby przeprowadzić tę weryfikację.</span><span class="sxs-lookup"><span data-stu-id="ed314-129">Use the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> method to perform this verification.</span></span>  
  
- <span data-ttu-id="ed314-130">Przekrocz limit czasu jako błąd.</span><span class="sxs-lookup"><span data-stu-id="ed314-130">Model a time out as an error.</span></span> <span data-ttu-id="ed314-131">Po przekroczeniu limitu czasu zgłoś zdarzenie <em>MethodName</em>**ukończone** i przypisz <xref:System.TimeoutException> do <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> właściwości.</span><span class="sxs-lookup"><span data-stu-id="ed314-131">When a time out occurs, raise the <em>MethodName</em>**Completed** event and assign a <xref:System.TimeoutException> to the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> property.</span></span>  
  
- <span data-ttu-id="ed314-132">Jeśli klasa obsługuje wiele współbieżnych wywołań, upewnij się, że zdarzenie <em>MethodName</em>**ukończone** zawiera odpowiedni `userSuppliedState` obiekt.</span><span class="sxs-lookup"><span data-stu-id="ed314-132">If your class supports multiple concurrent invocations, ensure that the <em>MethodName</em>**Completed** event contains the appropriate `userSuppliedState` object.</span></span>  
  
- <span data-ttu-id="ed314-133">Upewnij się, że zdarzenie **ukończenia** <em>MethodName</em>zostało zgłoszone na odpowiednim wątku i w odpowiednim czasie w cyklu życia aplikacji.</span><span class="sxs-lookup"><span data-stu-id="ed314-133">Ensure that the <em>MethodName</em>**Completed** event is raised on the appropriate thread and at the appropriate time in the application lifecycle.</span></span> <span data-ttu-id="ed314-134">Aby uzyskać więcej informacji, zobacz sekcję wątkowość i konteksty.</span><span class="sxs-lookup"><span data-stu-id="ed314-134">For more information, see the Threading and Contexts section.</span></span>  
  
### <a name="simultaneously-executing-operations"></a><span data-ttu-id="ed314-135">Jednoczesne wykonywanie operacji</span><span class="sxs-lookup"><span data-stu-id="ed314-135">Simultaneously Executing Operations</span></span>  
  
- <span data-ttu-id="ed314-136">Jeśli klasa obsługuje wiele współbieżnych wywołań, należy umożliwić deweloperowi śledzenie każdego wywołania osobno przez zdefiniowanie przeciążenia **Async** <em>MethodName</em>, które przyjmuje parametr stanu o wartości obiektu lub identyfikator zadania o nazwie `userSuppliedState` .</span><span class="sxs-lookup"><span data-stu-id="ed314-136">If your class supports multiple concurrent invocations, enable the developer to track each invocation separately by defining the <em>MethodName</em>**Async** overload that takes an object-valued state parameter, or task ID, called `userSuppliedState`.</span></span> <span data-ttu-id="ed314-137">Ten parametr powinien zawsze być ostatnim parametrem w sygnaturze metody **asynchronicznej** <em>MethodName</em>.</span><span class="sxs-lookup"><span data-stu-id="ed314-137">This parameter should always be the last parameter in the <em>MethodName</em>**Async** method's signature.</span></span>  
  
- <span data-ttu-id="ed314-138">Jeśli klasa definiuje Przeciążenie Async <em>MethodName</em>**Async** , które przyjmuje parametr stanu o wartościach obiektu lub identyfikator zadania, należy śledzić okres istnienia operacji przy użyciu tego identyfikatora zadania i upewnić się, że jest on ponownie używany do obsługi uzupełniania.</span><span class="sxs-lookup"><span data-stu-id="ed314-138">If your class defines the <em>MethodName</em>**Async** overload that takes an object-valued state parameter, or task ID, be sure to track the lifetime of the operation with that task ID, and be sure to provide it back into the completion handler.</span></span> <span data-ttu-id="ed314-139">Istnieją klasy pomocnika, które mogą być pomocne.</span><span class="sxs-lookup"><span data-stu-id="ed314-139">There are helper classes available to assist.</span></span> <span data-ttu-id="ed314-140">Aby uzyskać więcej informacji na temat zarządzania współbieżnością, zobacz [How to: Implementuj składnik, który obsługuje wzorzec asynchroniczny oparty na zdarzeniach](component-that-supports-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="ed314-140">For more information on concurrency management, see [How to: Implement a Component That Supports the Event-based Asynchronous Pattern](component-that-supports-the-event-based-asynchronous-pattern.md).</span></span>  
  
- <span data-ttu-id="ed314-141">Jeśli klasa definiuje metodę **asynchroniczną** <em>MethodName</em>bez parametru State i nie obsługuje wielu współbieżnych wywołań, należy upewnić się, że każda próba wywołania **asynchronicznej** <em>MethodName</em>przed zakończeniem poprzedniego wywołania <em>MethodName</em>**asynchronicznego** MethodName zakończy działanie <xref:System.InvalidOperationException> .</span><span class="sxs-lookup"><span data-stu-id="ed314-141">If your class defines the <em>MethodName</em>**Async** method without the state parameter, and it does not support multiple concurrent invocations, ensure that any attempt to invoke <em>MethodName</em>**Async** before the prior <em>MethodName</em>**Async** invocation has completed raises an <xref:System.InvalidOperationException>.</span></span>  
  
- <span data-ttu-id="ed314-142">Ogólnie rzecz biorąc nie należy zgłaszać wyjątku, jeśli metoda **asynchroniczna** <em>MethodName</em>bez `userSuppliedState` parametru jest wywoływana wiele razy, tak że istnieje wiele zaległych operacji.</span><span class="sxs-lookup"><span data-stu-id="ed314-142">In general, do not raise an exception if the <em>MethodName</em>**Async** method without the `userSuppliedState` parameter is invoked multiple times so that there are multiple outstanding operations.</span></span> <span data-ttu-id="ed314-143">Można zgłosić wyjątek, gdy Klasa jawnie nie może obsłużyć tej sytuacji, ale zakłada, że deweloperzy mogą obsługiwać te wielokrotne wywołania zwrotne</span><span class="sxs-lookup"><span data-stu-id="ed314-143">You can raise an exception when your class explicitly cannot handle that situation, but assume that developers can handle these multiple indistinguishable callbacks</span></span>  
  
### <a name="accessing-results"></a><span data-ttu-id="ed314-144">Uzyskiwanie dostępu do wyników</span><span class="sxs-lookup"><span data-stu-id="ed314-144">Accessing Results</span></span>  
  
- <span data-ttu-id="ed314-145">Jeśli wystąpił błąd podczas wykonywania operacji asynchronicznej, wyniki nie powinny być dostępne.</span><span class="sxs-lookup"><span data-stu-id="ed314-145">If there was an error during execution of the asynchronous operation, the results should not be accessible.</span></span> <span data-ttu-id="ed314-146">Upewnij się, że dostęp do dowolnej właściwości w elemencie <xref:System.ComponentModel.AsyncCompletedEventArgs> when <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> nie `null` wywołuje wyjątku, do którego odwołuje się <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> .</span><span class="sxs-lookup"><span data-stu-id="ed314-146">Ensure that accessing any property in the <xref:System.ComponentModel.AsyncCompletedEventArgs> when <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> is not `null` raises the exception referenced by <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A>.</span></span> <span data-ttu-id="ed314-147"><xref:System.ComponentModel.AsyncCompletedEventArgs>Klasa zapewnia <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> metodę do tego celu.</span><span class="sxs-lookup"><span data-stu-id="ed314-147">The <xref:System.ComponentModel.AsyncCompletedEventArgs> class provides the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> method for this purpose.</span></span>  
  
- <span data-ttu-id="ed314-148">Upewnij się, że wszystkie próby uzyskania dostępu do wyniku spowodują <xref:System.InvalidOperationException> , że operacja została anulowana.</span><span class="sxs-lookup"><span data-stu-id="ed314-148">Ensure that any attempt to access the result raises an <xref:System.InvalidOperationException> stating that the operation was canceled.</span></span> <span data-ttu-id="ed314-149">Użyj <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> metody, aby przeprowadzić tę weryfikację.</span><span class="sxs-lookup"><span data-stu-id="ed314-149">Use the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> method to perform this verification.</span></span>  
  
### <a name="progress-reporting"></a><span data-ttu-id="ed314-150">Raportowanie postępu</span><span class="sxs-lookup"><span data-stu-id="ed314-150">Progress Reporting</span></span>  
  
- <span data-ttu-id="ed314-151">Raportowanie postępu obsługi, jeśli jest to możliwe.</span><span class="sxs-lookup"><span data-stu-id="ed314-151">Support progress reporting, if possible.</span></span> <span data-ttu-id="ed314-152">Dzięki temu deweloperzy mogą zapewnić lepsze środowisko użytkownika aplikacji, gdy używają klasy.</span><span class="sxs-lookup"><span data-stu-id="ed314-152">This enables developers to provide a better application user experience when they use your class.</span></span>  
  
- <span data-ttu-id="ed314-153">Jeśli zaimplementowano zdarzenie **ProgressChanged** **ProgressChanged** lub <em>MethodName</em>, należy się upewnić, że nie ma takich zdarzeń zgłoszonych dla określonej operacji asynchronicznej, gdy zostanie zgłoszone zdarzenie **ukończenia** <em>MethodName</em>przez tę operację.</span><span class="sxs-lookup"><span data-stu-id="ed314-153">If you implement a **ProgressChanged** or <em>MethodName</em>**ProgressChanged** event, ensure that there are no such events raised for a particular asynchronous operation after that operation's <em>MethodName</em>**Completed** event has been raised.</span></span>  
  
- <span data-ttu-id="ed314-154">Jeśli <xref:System.ComponentModel.ProgressChangedEventArgs> jest wypełniany Standard, upewnij się, że <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> zawsze można interpretować wartość procentową.</span><span class="sxs-lookup"><span data-stu-id="ed314-154">If the standard <xref:System.ComponentModel.ProgressChangedEventArgs> is being populated, ensure that the <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> can always be interpreted as a percentage.</span></span> <span data-ttu-id="ed314-155">Wartość procentowa nie musi być dokładna, ale powinna reprezentować wartość procentową.</span><span class="sxs-lookup"><span data-stu-id="ed314-155">The percentage does not need to be accurate, but it should represent a percentage.</span></span> <span data-ttu-id="ed314-156">Jeśli Metryka raportowania postępu musi być inna niż wartość procentowa, należy utworzyć klasę z <xref:System.ComponentModel.ProgressChangedEventArgs> klasy i pozostawić <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> wartość 0.</span><span class="sxs-lookup"><span data-stu-id="ed314-156">If your progress reporting metric must be something other than a percentage, derive a class from the <xref:System.ComponentModel.ProgressChangedEventArgs> class and leave <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> at 0.</span></span> <span data-ttu-id="ed314-157">Unikaj używania metryki raportowania innej niż wartość procentowa.</span><span class="sxs-lookup"><span data-stu-id="ed314-157">Avoid using a reporting metric other than a percentage.</span></span>  
  
- <span data-ttu-id="ed314-158">Upewnij się, że `ProgressChanged` zdarzenie jest zgłaszane na odpowiednim wątku i w odpowiednim czasie w cyklu życia aplikacji.</span><span class="sxs-lookup"><span data-stu-id="ed314-158">Ensure that the `ProgressChanged` event is raised on the appropriate thread and at the appropriate time in the application lifecycle.</span></span> <span data-ttu-id="ed314-159">Aby uzyskać więcej informacji, zobacz sekcję wątkowość i konteksty.</span><span class="sxs-lookup"><span data-stu-id="ed314-159">For more information, see the Threading and Contexts section.</span></span>  
  
### <a name="isbusy-implementation"></a><span data-ttu-id="ed314-160">Implementacja IsBusy</span><span class="sxs-lookup"><span data-stu-id="ed314-160">IsBusy Implementation</span></span>  
  
- <span data-ttu-id="ed314-161">Nie ujawniaj `IsBusy` właściwości, jeśli klasa obsługuje wiele współbieżnych wywołań.</span><span class="sxs-lookup"><span data-stu-id="ed314-161">Do not expose an `IsBusy` property if your class supports multiple concurrent invocations.</span></span> <span data-ttu-id="ed314-162">Na przykład proxy usługi sieci Web XML nie uwidacznia `IsBusy` właściwości, ponieważ obsługują one wiele współbieżnych wywołań metod asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="ed314-162">For example, XML Web service proxies do not expose an `IsBusy` property because they support multiple concurrent invocations of asynchronous methods.</span></span>  
  
- <span data-ttu-id="ed314-163">`IsBusy`Właściwość powinna zostać zwrócona `true` po wywołaniu metody **asynchronicznej** <em>MethodName</em>i przed podniesieniem zdarzenia <em>MethodName</em>**ukończone** .</span><span class="sxs-lookup"><span data-stu-id="ed314-163">The `IsBusy` property should return `true` after the <em>MethodName</em>**Async** method has been called and before the <em>MethodName</em>**Completed** event has been raised.</span></span> <span data-ttu-id="ed314-164">W przeciwnym razie powinna zostać zwrócona `false` .</span><span class="sxs-lookup"><span data-stu-id="ed314-164">Otherwise it should return `false`.</span></span> <span data-ttu-id="ed314-165"><xref:System.ComponentModel.BackgroundWorker>Składniki i <xref:System.Net.WebClient> są przykładami klas, które uwidaczniają `IsBusy` Właściwość.</span><span class="sxs-lookup"><span data-stu-id="ed314-165">The <xref:System.ComponentModel.BackgroundWorker> and <xref:System.Net.WebClient> components are examples of classes that expose an `IsBusy` property.</span></span>  
  
### <a name="cancellation"></a><span data-ttu-id="ed314-166">Anulowanie</span><span class="sxs-lookup"><span data-stu-id="ed314-166">Cancellation</span></span>  
  
- <span data-ttu-id="ed314-167">Obsługa anulowania, jeśli to możliwe.</span><span class="sxs-lookup"><span data-stu-id="ed314-167">Support cancellation, if possible.</span></span> <span data-ttu-id="ed314-168">Dzięki temu deweloperzy mogą zapewnić lepsze środowisko użytkownika aplikacji, gdy używają klasy.</span><span class="sxs-lookup"><span data-stu-id="ed314-168">This enables developers to provide a better application user experience when they use your class.</span></span>  
  
- <span data-ttu-id="ed314-169">W przypadku anulowania Ustaw <xref:System.ComponentModel.AsyncCompletedEventArgs.Cancelled%2A> flagę w <xref:System.ComponentModel.AsyncCompletedEventArgs> obiekcie.</span><span class="sxs-lookup"><span data-stu-id="ed314-169">In the case of cancellation, set the <xref:System.ComponentModel.AsyncCompletedEventArgs.Cancelled%2A> flag in the <xref:System.ComponentModel.AsyncCompletedEventArgs> object.</span></span>  
  
- <span data-ttu-id="ed314-170">Upewnij się, że wszystkie próby uzyskania dostępu do wyniku spowodują <xref:System.InvalidOperationException> , że operacja została anulowana.</span><span class="sxs-lookup"><span data-stu-id="ed314-170">Ensure that any attempt to access the result raises an <xref:System.InvalidOperationException> stating that the operation was canceled.</span></span> <span data-ttu-id="ed314-171">Użyj <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> metody, aby przeprowadzić tę weryfikację.</span><span class="sxs-lookup"><span data-stu-id="ed314-171">Use the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> method to perform this verification.</span></span>  
  
- <span data-ttu-id="ed314-172">Upewnij się, że wywołania metody anulowania zawsze zwracają się pomyślnie i nigdy nie zgłaszaj wyjątku.</span><span class="sxs-lookup"><span data-stu-id="ed314-172">Ensure that calls to a cancellation method always return successfully, and never raise an exception.</span></span> <span data-ttu-id="ed314-173">Ogólnie rzecz biorąc klient nie zostanie powiadomiony o tym, czy w danym momencie operacja jest w prawdziwie anulowana, i nie zostanie powiadomiona o tym, czy wcześniej wystawione anulowanie zakończyło się pomyślnie.</span><span class="sxs-lookup"><span data-stu-id="ed314-173">In general, a client is not notified as to whether an operation is truly cancelable at any given time, and is not notified as to whether a previously issued cancellation has succeeded.</span></span> <span data-ttu-id="ed314-174">Jednak aplikacja będzie zawsze otrzymywać powiadomienie, gdy anulowanie zakończyło się pomyślnie, ponieważ aplikacja bierze udział w stanie ukończenia.</span><span class="sxs-lookup"><span data-stu-id="ed314-174">However, the application will always be given notification when a cancellation succeeded, because the application takes part in the completion status.</span></span>  
  
- <span data-ttu-id="ed314-175">Zgłoś zdarzenie <em>MethodName</em>**ukończenia** MethodName, gdy operacja zostanie anulowana.</span><span class="sxs-lookup"><span data-stu-id="ed314-175">Raise the <em>MethodName</em>**Completed** event when the operation is canceled.</span></span>  
  
### <a name="errors-and-exceptions"></a><span data-ttu-id="ed314-176">Błędy i wyjątki</span><span class="sxs-lookup"><span data-stu-id="ed314-176">Errors and Exceptions</span></span>  
  
- <span data-ttu-id="ed314-177">Przechwyć wszystkie wyjątki występujące w operacji asynchronicznej i ustaw wartość <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A?displayProperty=nameWithType> właściwości na ten wyjątek.</span><span class="sxs-lookup"><span data-stu-id="ed314-177">Catch any exceptions that occur in the asynchronous operation and set the value of the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A?displayProperty=nameWithType> property to that exception.</span></span>  
  
### <a name="threading-and-contexts"></a><span data-ttu-id="ed314-178">Wątkowość i konteksty</span><span class="sxs-lookup"><span data-stu-id="ed314-178">Threading and Contexts</span></span>

 <span data-ttu-id="ed314-179">W celu poprawnego działania klasy należy pamiętać, że procedury obsługi zdarzeń klienta są wywoływane w prawidłowym wątku lub kontekście dla danego modelu aplikacji, w tym aplikacji ASP.NET i Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="ed314-179">For correct operation of your class, it is critical that the client's event handlers are invoked on the proper thread or context for the given application model, including ASP.NET and Windows Forms applications.</span></span> <span data-ttu-id="ed314-180">Dostępne są dwie ważne klasy pomocnika, aby zapewnić, że Klasa asynchroniczna zachowuje się prawidłowo w ramach dowolnego modelu aplikacji: <xref:System.ComponentModel.AsyncOperation> i <xref:System.ComponentModel.AsyncOperationManager> .</span><span class="sxs-lookup"><span data-stu-id="ed314-180">Two important helper classes are provided to ensure that your asynchronous class behaves correctly under any application model: <xref:System.ComponentModel.AsyncOperation> and <xref:System.ComponentModel.AsyncOperationManager>.</span></span>  
  
 <span data-ttu-id="ed314-181"><xref:System.ComponentModel.AsyncOperationManager> zawiera jedną metodę, <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> która zwraca <xref:System.ComponentModel.AsyncOperation> .</span><span class="sxs-lookup"><span data-stu-id="ed314-181"><xref:System.ComponentModel.AsyncOperationManager> provides one method, <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A>, which returns an <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="ed314-182">Wywołania <em>MethodName</em>metody **asynchronicznej** MethodName <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> i Klasa używają zwracanego <xref:System.ComponentModel.AsyncOperation> do śledzenia okresu istnienia zadania asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="ed314-182">Your <em>MethodName</em>**Async** method calls <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> and your class uses the returned <xref:System.ComponentModel.AsyncOperation> to track the lifetime of the asynchronous task.</span></span>  
  
 <span data-ttu-id="ed314-183">Aby zgłosić postęp, wyniki przyrostowe i zakończenie do klienta, wywołaj <xref:System.ComponentModel.AsyncOperation.Post%2A> metody i <xref:System.ComponentModel.AsyncOperation.OperationCompleted%2A> w <xref:System.ComponentModel.AsyncOperation> .</span><span class="sxs-lookup"><span data-stu-id="ed314-183">To report progress, incremental results, and completion to the client, call the <xref:System.ComponentModel.AsyncOperation.Post%2A> and <xref:System.ComponentModel.AsyncOperation.OperationCompleted%2A> methods on the <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="ed314-184"><xref:System.ComponentModel.AsyncOperation> jest odpowiedzialny za kierowanie wywołań do obsługi zdarzeń klienta do odpowiedniego wątku lub kontekstu.</span><span class="sxs-lookup"><span data-stu-id="ed314-184"><xref:System.ComponentModel.AsyncOperation> is responsible for marshaling calls to the client's event handlers to the proper thread or context.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="ed314-185">Można obejść te reguły, jeśli użytkownik jawnie chce przejść względem zasad modelu aplikacji, ale nadal korzysta z innych zalet użycia wzorca asynchronicznego opartego na zdarzeniach.</span><span class="sxs-lookup"><span data-stu-id="ed314-185">You can circumvent these rules if you explicitly want to go against the policy of the application model, but still benefit from the other advantages of using the Event-based Asynchronous Pattern.</span></span> <span data-ttu-id="ed314-186">Na przykład może być konieczne, aby Klasa działająca w Windows Forms była wolna wątków.</span><span class="sxs-lookup"><span data-stu-id="ed314-186">For example, you may want a class operating in Windows Forms to be free threaded.</span></span> <span data-ttu-id="ed314-187">Można utworzyć wolnie wielowątkową klasę, o ile deweloperzy będą zrozumieć implikowane ograniczenia.</span><span class="sxs-lookup"><span data-stu-id="ed314-187">You can create a free threaded class, as long as developers understand the implied restrictions.</span></span> <span data-ttu-id="ed314-188">Aplikacje konsolowe nie synchronizują wykonywania <xref:System.ComponentModel.AsyncOperation.Post%2A> wywołań.</span><span class="sxs-lookup"><span data-stu-id="ed314-188">Console applications do not synchronize the execution of <xref:System.ComponentModel.AsyncOperation.Post%2A> calls.</span></span> <span data-ttu-id="ed314-189">Może to spowodować, że `ProgressChanged` zdarzenia zostaną wygenerowane poza kolejnością.</span><span class="sxs-lookup"><span data-stu-id="ed314-189">This can cause `ProgressChanged` events to be raised out of order.</span></span> <span data-ttu-id="ed314-190">Jeśli chcesz mieć serializowane wykonywanie <xref:System.ComponentModel.AsyncOperation.Post%2A> wywołań, zaimplementuj i zainstaluj <xref:System.Threading.SynchronizationContext?displayProperty=nameWithType> klasę.</span><span class="sxs-lookup"><span data-stu-id="ed314-190">If you wish to have serialized execution of <xref:System.ComponentModel.AsyncOperation.Post%2A> calls, implement and install a <xref:System.Threading.SynchronizationContext?displayProperty=nameWithType> class.</span></span>  
  
 <span data-ttu-id="ed314-191">Aby uzyskać więcej informacji o korzystaniu z programu <xref:System.ComponentModel.AsyncOperation> i <xref:System.ComponentModel.AsyncOperationManager> Aby włączyć operacje asynchroniczne, zobacz [How to: implemental Component, który obsługuje wzorzec asynchroniczny oparty na zdarzeniach](component-that-supports-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="ed314-191">For more information about using <xref:System.ComponentModel.AsyncOperation> and <xref:System.ComponentModel.AsyncOperationManager> to enable your asynchronous operations, see [How to: Implement a Component That Supports the Event-based Asynchronous Pattern](component-that-supports-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="guidelines"></a><span data-ttu-id="ed314-192">Wytyczne</span><span class="sxs-lookup"><span data-stu-id="ed314-192">Guidelines</span></span>  
  
- <span data-ttu-id="ed314-193">W idealnym przypadku każde wywołanie metody powinno być niezależne od innych.</span><span class="sxs-lookup"><span data-stu-id="ed314-193">Ideally, each method invocation should be independent of others.</span></span> <span data-ttu-id="ed314-194">Należy unikać sprzęgania wywołań z udostępnionymi zasobami.</span><span class="sxs-lookup"><span data-stu-id="ed314-194">You should avoid coupling invocations with shared resources.</span></span> <span data-ttu-id="ed314-195">Jeśli zasoby mają być współdzielone między wywołaniami, należy zapewnić odpowiedni mechanizm synchronizacji w implementacji.</span><span class="sxs-lookup"><span data-stu-id="ed314-195">If resources are to be shared among invocations, you will need to provide a proper synchronization mechanism in your implementation.</span></span>  
  
- <span data-ttu-id="ed314-196">Projekty wymagające wdrożenia synchronizacji nie są zalecane.</span><span class="sxs-lookup"><span data-stu-id="ed314-196">Designs that require the client to implement synchronization are discouraged.</span></span> <span data-ttu-id="ed314-197">Na przykład można mieć metodę asynchroniczną, która odbiera globalny obiekt statyczny jako parametr; wiele współbieżnych wywołań tej metody może spowodować uszkodzenie lub zakleszczenie danych.</span><span class="sxs-lookup"><span data-stu-id="ed314-197">For example, you could have an asynchronous method that receives a global static object as a parameter; multiple concurrent invocations of such a method could result in data corruption or deadlocks.</span></span>  
  
- <span data-ttu-id="ed314-198">W przypadku zaimplementowania metody przy użyciu przeciążenia wielokrotnego wywołania ( `userState` w podpisie) Klasa będzie musiała zarządzać kolekcją Stanów użytkowników lub zadań, a także odpowiadające im operacje oczekujące.</span><span class="sxs-lookup"><span data-stu-id="ed314-198">If you implement a method with the multiple-invocation overload (`userState` in the signature), your class will need to manage a collection of user states, or task IDs, and their corresponding pending operations.</span></span> <span data-ttu-id="ed314-199">Ta kolekcja powinna być chroniona za pomocą `lock` regionów, ponieważ różne wywołania dodają i usuwają `userState` obiekty w kolekcji.</span><span class="sxs-lookup"><span data-stu-id="ed314-199">This collection should be protected with `lock` regions, because the various invocations add and remove `userState` objects in the collection.</span></span>  
  
- <span data-ttu-id="ed314-200">Rozważ ponowne użycie `CompletedEventArgs` klas, gdy jest to możliwe i odpowiednie.</span><span class="sxs-lookup"><span data-stu-id="ed314-200">Consider reusing `CompletedEventArgs` classes where feasible and appropriate.</span></span> <span data-ttu-id="ed314-201">W takim przypadku nazewnictwo nie jest spójne z nazwą metody, ponieważ dany delegat i <xref:System.EventArgs> Typ nie są powiązane z pojedynczą metodą.</span><span class="sxs-lookup"><span data-stu-id="ed314-201">In this case, the naming is not consistent with the method name, because a given delegate and <xref:System.EventArgs> type are not tied to a single method.</span></span> <span data-ttu-id="ed314-202">Jednak wymuszanie, aby deweloperzy mogli rzutować wartość pobieraną z właściwości na wartość <xref:System.EventArgs> nie jest nigdy akceptowalna.</span><span class="sxs-lookup"><span data-stu-id="ed314-202">However, forcing developers to cast the value retrieved from a property on the <xref:System.EventArgs> is never acceptable.</span></span>  
  
- <span data-ttu-id="ed314-203">Jeśli tworzysz klasę, która pochodzi od, nie <xref:System.ComponentModel.Component> Wdrażaj ani nie instaluj własnej <xref:System.Threading.SynchronizationContext> klasy.</span><span class="sxs-lookup"><span data-stu-id="ed314-203">If you are authoring a class that derives from <xref:System.ComponentModel.Component>, do not implement and install your own <xref:System.Threading.SynchronizationContext> class.</span></span> <span data-ttu-id="ed314-204">Modele aplikacji, a nie składniki, kontrolują, <xref:System.Threading.SynchronizationContext> która jest używana.</span><span class="sxs-lookup"><span data-stu-id="ed314-204">Application models, not components, control the <xref:System.Threading.SynchronizationContext> that is used.</span></span>  
  
- <span data-ttu-id="ed314-205">Jeśli używasz wielowątkowości dowolnego sortowania, możesz ujawnić sobie bardzo poważne i złożone błędy.</span><span class="sxs-lookup"><span data-stu-id="ed314-205">When you use multithreading of any sort, you potentially expose yourself to very serious and complex bugs.</span></span> <span data-ttu-id="ed314-206">Przed zaimplementowaniem dowolnego rozwiązania korzystającego z wielowątkowości Zobacz sekcję [zarządzane wątki z najlepszymi praktykami](../threading/managed-threading-best-practices.md).</span><span class="sxs-lookup"><span data-stu-id="ed314-206">Before implementing any solution that uses multithreading, see [Managed Threading Best Practices](../threading/managed-threading-best-practices.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ed314-207">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="ed314-207">See also</span></span>

- <xref:System.ComponentModel.AsyncOperation>
- <xref:System.ComponentModel.AsyncOperationManager>
- <xref:System.ComponentModel.AsyncCompletedEventArgs>
- <xref:System.ComponentModel.ProgressChangedEventArgs>
- <xref:System.ComponentModel.BackgroundWorker>
- [<span data-ttu-id="ed314-208">Implementacja wzorca asynchronicznego opartego na zdarzeniach</span><span class="sxs-lookup"><span data-stu-id="ed314-208">Implementing the Event-based Asynchronous Pattern</span></span>](implementing-the-event-based-asynchronous-pattern.md)
- [<span data-ttu-id="ed314-209">Asynchroniczny wzorzec oparty na zdarzeniach (EAP)</span><span class="sxs-lookup"><span data-stu-id="ed314-209">Event-based Asynchronous Pattern (EAP)</span></span>](event-based-asynchronous-pattern-eap.md)
- [<span data-ttu-id="ed314-210">Decydowanie o czasie implementacji klienta wzorca asynchronicznego opartego na zdarzeniach</span><span class="sxs-lookup"><span data-stu-id="ed314-210">Deciding When to Implement the Event-based Asynchronous Pattern</span></span>](deciding-when-to-implement-the-event-based-asynchronous-pattern.md)
- [<span data-ttu-id="ed314-211">Najlepsze rozwiązania w zakresie implementacji wzorca asynchronicznego opartego na zdarzeniach</span><span class="sxs-lookup"><span data-stu-id="ed314-211">Best Practices for Implementing the Event-based Asynchronous Pattern</span></span>](best-practices-for-implementing-the-event-based-asynchronous-pattern.md)
- [<span data-ttu-id="ed314-212">Instrukcje: Używanie składników obsługujących wzorzec asynchroniczny oparty na zdarzeniach</span><span class="sxs-lookup"><span data-stu-id="ed314-212">How to: Use Components That Support the Event-based Asynchronous Pattern</span></span>](how-to-use-components-that-support-the-event-based-asynchronous-pattern.md)
- [<span data-ttu-id="ed314-213">Instrukcje: Implementacja składnika obsługującego wzorzec asynchroniczny oparty na zdarzeniach</span><span class="sxs-lookup"><span data-stu-id="ed314-213">How to: Implement a Component That Supports the Event-based Asynchronous Pattern</span></span>](component-that-supports-the-event-based-asynchronous-pattern.md)
