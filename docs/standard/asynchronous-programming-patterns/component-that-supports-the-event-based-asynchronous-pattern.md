---
title: 'Instrukcje: Implementacja składnika obsługującego wzorzec asynchroniczny oparty na zdarzeniach'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Event-based Asynchronous Pattern
- ProgressChangedEventArgs class
- BackgroundWorker component
- events [.NET], asynchronous
- Asynchronous Pattern
- AsyncOperationManager class
- threading [.NET], asynchronous features
- components [.NET], asynchronous
- AsyncOperation class
- threading [Windows Forms], asynchronous features
- AsyncCompletedEventArgs class
ms.assetid: 61f676b5-936f-40f6-83ce-f22805ec9c2f
ms.openlocfilehash: 1779bb51267af3c2f50ec03112f3c45199390333
ms.sourcegitcommit: 965a5af7918acb0a3fd3baf342e15d511ef75188
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/18/2020
ms.locfileid: "94830431"
---
# <a name="how-to-implement-a-component-that-supports-the-event-based-asynchronous-pattern"></a><span data-ttu-id="e0714-102">Instrukcje: Implementacja składnika obsługującego wzorzec asynchroniczny oparty na zdarzeniach</span><span class="sxs-lookup"><span data-stu-id="e0714-102">How to: Implement a Component That Supports the Event-based Asynchronous Pattern</span></span>

<span data-ttu-id="e0714-103">W przypadku pisania klasy z niektórymi operacjami, które mogą mieć zauważalne opóźnienia, należy rozważyć udzielenie funkcji asynchronicznych przez implementację [asynchronicznego wzorca opartego na zdarzeniach](event-based-asynchronous-pattern-overview.md).</span><span class="sxs-lookup"><span data-stu-id="e0714-103">If you are writing a class with some operations that may incur noticeable delays, consider giving it asynchronous functionality by implementing the [Event-based Asynchronous Pattern Overview](event-based-asynchronous-pattern-overview.md).</span></span>  
  
 <span data-ttu-id="e0714-104">W tym instruktażu przedstawiono sposób tworzenia składnika implementującego wzorzec asynchroniczny oparty na zdarzeniach.</span><span class="sxs-lookup"><span data-stu-id="e0714-104">This walkthrough illustrates how to create a component that implements the Event-based Asynchronous Pattern.</span></span> <span data-ttu-id="e0714-105">Jest implementowana przy użyciu klas pomocników z <xref:System.ComponentModel?displayProperty=nameWithType> przestrzeni nazw, dzięki czemu składnik działa prawidłowo w ramach dowolnego modelu aplikacji, w tym ASP.NET, aplikacji konsolowych i aplikacji Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="e0714-105">It is implemented using helper classes from the <xref:System.ComponentModel?displayProperty=nameWithType> namespace, which ensures that the component works correctly under any application model, including ASP.NET, Console applications and Windows Forms applications.</span></span> <span data-ttu-id="e0714-106">Ten składnik jest również zaprojektowany przy użyciu <xref:System.Windows.Forms.PropertyGrid> kontrolki i własnych niestandardowych projektantów.</span><span class="sxs-lookup"><span data-stu-id="e0714-106">This component is also designable with a <xref:System.Windows.Forms.PropertyGrid> control and your own custom designers.</span></span>  
  
 <span data-ttu-id="e0714-107">Gdy jesteś w programie, będziesz mieć aplikację, która będzie w sposób asynchroniczny obliczał numery bazowe.</span><span class="sxs-lookup"><span data-stu-id="e0714-107">When you are through, you will have an application that computes prime numbers asynchronously.</span></span> <span data-ttu-id="e0714-108">Aplikacja będzie mieć wątek głównego interfejsu użytkownika i wątek dla każdego obliczenia liczby podstawowej.</span><span class="sxs-lookup"><span data-stu-id="e0714-108">Your application will have a main user interface (UI) thread and a thread for each prime number calculation.</span></span> <span data-ttu-id="e0714-109">Chociaż Testowanie dużej liczby może zająć dużo czasu, główny wątek interfejsu użytkownika nie zostanie przerwany w tym opóźnieniu, a formularz będzie odpowiadać podczas obliczeń.</span><span class="sxs-lookup"><span data-stu-id="e0714-109">Although testing whether a large number is prime can take a noticeable amount of time, the main UI thread will not be interrupted by this delay, and the form will be responsive during the calculations.</span></span> <span data-ttu-id="e0714-110">Będzie można uruchamiać dowolną liczbę obliczeń, tak jak współbieżne i wybiórczo anulować oczekujące obliczenia.</span><span class="sxs-lookup"><span data-stu-id="e0714-110">You will be able to run as many calculations as you like concurrently and selectively cancel pending calculations.</span></span>  
  
 <span data-ttu-id="e0714-111">Zadania przedstawione w tym instruktażu obejmują:</span><span class="sxs-lookup"><span data-stu-id="e0714-111">Tasks illustrated in this walkthrough include:</span></span>  
  
- <span data-ttu-id="e0714-112">Tworzenie składnika</span><span class="sxs-lookup"><span data-stu-id="e0714-112">Creating the Component</span></span>  
  
- <span data-ttu-id="e0714-113">Definiowanie publicznych zdarzeń asynchronicznych i delegatów</span><span class="sxs-lookup"><span data-stu-id="e0714-113">Defining Public Asynchronous Events and Delegates</span></span>  
  
- <span data-ttu-id="e0714-114">Definiowanie prywatnych delegatów</span><span class="sxs-lookup"><span data-stu-id="e0714-114">Defining Private Delegates</span></span>  
  
- <span data-ttu-id="e0714-115">Implementowanie zdarzeń publicznych</span><span class="sxs-lookup"><span data-stu-id="e0714-115">Implementing Public Events</span></span>  
  
- <span data-ttu-id="e0714-116">Implementowanie metody ukończenia</span><span class="sxs-lookup"><span data-stu-id="e0714-116">Implementing the Completion Method</span></span>  
  
- <span data-ttu-id="e0714-117">Implementowanie metod roboczych</span><span class="sxs-lookup"><span data-stu-id="e0714-117">Implementing the Worker Methods</span></span>  
  
- <span data-ttu-id="e0714-118">Implementowanie metod Start i Cancel</span><span class="sxs-lookup"><span data-stu-id="e0714-118">Implementing Start and Cancel Methods</span></span>  
  
 <span data-ttu-id="e0714-119">Aby skopiować kod w tym temacie jako pojedynczą listę, zobacz [How to: Implementuj klienta wzorca asynchronicznego opartego na zdarzeniach](how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="e0714-119">To copy the code in this topic as a single listing, see [How to: Implement a Client of the Event-based Asynchronous Pattern](how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="creating-the-component"></a><span data-ttu-id="e0714-120">Tworzenie składnika</span><span class="sxs-lookup"><span data-stu-id="e0714-120">Creating the Component</span></span>  
 <span data-ttu-id="e0714-121">Pierwszym krokiem jest utworzenie składnika, który będzie implementował wzorzec asynchroniczny oparty na zdarzeniach.</span><span class="sxs-lookup"><span data-stu-id="e0714-121">The first step is to create the component that will implement the Event-based Asynchronous Pattern.</span></span>  
  
### <a name="to-create-the-component"></a><span data-ttu-id="e0714-122">Aby utworzyć składnik</span><span class="sxs-lookup"><span data-stu-id="e0714-122">To create the component</span></span>  
  
- <span data-ttu-id="e0714-123">Utwórz klasę o nazwie `PrimeNumberCalculator` , która dziedziczy z <xref:System.ComponentModel.Component> .</span><span class="sxs-lookup"><span data-stu-id="e0714-123">Create a class called `PrimeNumberCalculator` that inherits from <xref:System.ComponentModel.Component>.</span></span>  
  
## <a name="defining-public-asynchronous-events-and-delegates"></a><span data-ttu-id="e0714-124">Definiowanie publicznych zdarzeń asynchronicznych i delegatów</span><span class="sxs-lookup"><span data-stu-id="e0714-124">Defining Public Asynchronous Events and Delegates</span></span>  
 <span data-ttu-id="e0714-125">Składnik komunikuje się z klientami przy użyciu zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="e0714-125">Your component communicates to clients using events.</span></span> <span data-ttu-id="e0714-126">Zdarzenie _MethodName_**zostało wykonane** przez klientów do ukończenia zadania asynchronicznego, a zdarzenie **ProgressChanged** _MethodName_ informuje klientów o postępie zadania asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="e0714-126">The _MethodName_**Completed** event alerts clients to the completion of an asynchronous task, and the _MethodName_**ProgressChanged** event informs clients of the progress of an asynchronous task.</span></span>  
  
### <a name="to-define-asynchronous-events-for-clients-of-your-component"></a><span data-ttu-id="e0714-127">Aby zdefiniować zdarzenia asynchroniczne dla klientów składnika:</span><span class="sxs-lookup"><span data-stu-id="e0714-127">To define asynchronous events for clients of your component:</span></span>  
  
1. <span data-ttu-id="e0714-128">Zaimportuj <xref:System.Threading?displayProperty=nameWithType> <xref:System.Collections.Specialized?displayProperty=nameWithType> przestrzenie nazw i w górnej części pliku.</span><span class="sxs-lookup"><span data-stu-id="e0714-128">Import the <xref:System.Threading?displayProperty=nameWithType> and <xref:System.Collections.Specialized?displayProperty=nameWithType> namespaces at the top of your file.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#11](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#11)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#11](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#11)]  
  
2. <span data-ttu-id="e0714-129">Przed `PrimeNumberCalculator` definicją klasy Zadeklaruj delegatów dla zdarzeń postępu i ukończenia.</span><span class="sxs-lookup"><span data-stu-id="e0714-129">Before the `PrimeNumberCalculator` class definition, declare delegates for progress and completion events.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#7](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#7)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#7](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#7)]  
  
3. <span data-ttu-id="e0714-130">W `PrimeNumberCalculator` definicji klasy Zadeklaruj zdarzenia w celu raportowania postępu i ukończenia do klientów.</span><span class="sxs-lookup"><span data-stu-id="e0714-130">In the `PrimeNumberCalculator` class definition, declare events for reporting progress and completion to clients.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#8](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#8)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#8](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#8)]  
  
4. <span data-ttu-id="e0714-131">Po `PrimeNumberCalculator` definicji klasy należy utworzyć `CalculatePrimeCompletedEventArgs` klasę do raportowania wyników każdego obliczenia do programu obsługi zdarzeń klienta dla `CalculatePrimeCompleted` zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="e0714-131">After the `PrimeNumberCalculator` class definition, derive the `CalculatePrimeCompletedEventArgs` class for reporting the outcome of each calculation to the client's event handler for the `CalculatePrimeCompleted`.event.</span></span> <span data-ttu-id="e0714-132">Oprócz `AsyncCompletedEventArgs` właściwości, ta Klasa pozwala klientowi określić, jaka liczba została przetestowana, czy jest, i co pierwszy dzielnik jest, jeśli nie jest.</span><span class="sxs-lookup"><span data-stu-id="e0714-132">In addition to the `AsyncCompletedEventArgs` properties, this class enables the client to determine what number was tested, whether it is prime, and what the first divisor is if it is not prime.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#6](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#6)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#6](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#6)]  
  
## <a name="checkpoint"></a><span data-ttu-id="e0714-133">Punkt kontrolny</span><span class="sxs-lookup"><span data-stu-id="e0714-133">Checkpoint</span></span>  
 <span data-ttu-id="e0714-134">W tym momencie można skompilować składnik.</span><span class="sxs-lookup"><span data-stu-id="e0714-134">At this point, you can build the component.</span></span>  
  
### <a name="to-test-your-component"></a><span data-ttu-id="e0714-135">Aby przetestować składnik</span><span class="sxs-lookup"><span data-stu-id="e0714-135">To test your component</span></span>  
  
- <span data-ttu-id="e0714-136">Kompiluj składnik.</span><span class="sxs-lookup"><span data-stu-id="e0714-136">Compile the component.</span></span>  
  
     <span data-ttu-id="e0714-137">Zostaną wyświetlone dwa ostrzeżenia kompilatora:</span><span class="sxs-lookup"><span data-stu-id="e0714-137">You will receive two compiler warnings:</span></span>  
  
    ```console  
    warning CS0067: The event 'AsynchronousPatternExample.PrimeNumberCalculator.ProgressChanged' is never used  
    warning CS0067: The event 'AsynchronousPatternExample.PrimeNumberCalculator.CalculatePrimeCompleted' is never used  
    ```  
  
     <span data-ttu-id="e0714-138">Te ostrzeżenia zostaną wyczyszczone w następnej sekcji.</span><span class="sxs-lookup"><span data-stu-id="e0714-138">These warnings will be cleared in the next section.</span></span>  
  
## <a name="defining-private-delegates"></a><span data-ttu-id="e0714-139">Definiowanie prywatnych delegatów</span><span class="sxs-lookup"><span data-stu-id="e0714-139">Defining Private Delegates</span></span>  
 <span data-ttu-id="e0714-140">Asynchroniczne aspekty `PrimeNumberCalculator` składnika są implementowane wewnętrznie z specjalnym delegatem znanym jako <xref:System.Threading.SendOrPostCallback> .</span><span class="sxs-lookup"><span data-stu-id="e0714-140">The asynchronous aspects of the `PrimeNumberCalculator` component are implemented internally with a special delegate known as a <xref:System.Threading.SendOrPostCallback>.</span></span> <span data-ttu-id="e0714-141"><xref:System.Threading.SendOrPostCallback>Reprezentuje metodę wywołania zwrotnego, która jest wykonywana w <xref:System.Threading.ThreadPool> wątku.</span><span class="sxs-lookup"><span data-stu-id="e0714-141">A <xref:System.Threading.SendOrPostCallback> represents a callback method that executes on a <xref:System.Threading.ThreadPool> thread.</span></span> <span data-ttu-id="e0714-142">Metoda wywołania zwrotnego musi mieć sygnaturę, która przyjmuje pojedynczy parametr typu <xref:System.Object> , co oznacza, że należy przekazać stan między delegatami w klasie otoki.</span><span class="sxs-lookup"><span data-stu-id="e0714-142">The callback method must have a signature that takes a single parameter of type <xref:System.Object>, which means you will need to pass state among delegates in a wrapper class.</span></span> <span data-ttu-id="e0714-143">Aby uzyskać więcej informacji, zobacz <xref:System.Threading.SendOrPostCallback>.</span><span class="sxs-lookup"><span data-stu-id="e0714-143">For more information, see <xref:System.Threading.SendOrPostCallback>.</span></span>  
  
### <a name="to-implement-your-components-internal-asynchronous-behavior"></a><span data-ttu-id="e0714-144">Aby zaimplementować wewnętrzne zachowanie asynchroniczne składnika:</span><span class="sxs-lookup"><span data-stu-id="e0714-144">To implement your component's internal asynchronous behavior:</span></span>  
  
1. <span data-ttu-id="e0714-145">Zadeklaruj i Utwórz <xref:System.Threading.SendOrPostCallback> delegatów w `PrimeNumberCalculator` klasie.</span><span class="sxs-lookup"><span data-stu-id="e0714-145">Declare and create the <xref:System.Threading.SendOrPostCallback> delegates in the `PrimeNumberCalculator` class.</span></span> <span data-ttu-id="e0714-146">Utwórz <xref:System.Threading.SendOrPostCallback> obiekty w metodzie narzędzia o nazwie `InitializeDelegates` .</span><span class="sxs-lookup"><span data-stu-id="e0714-146">Create the <xref:System.Threading.SendOrPostCallback> objects in a utility method called `InitializeDelegates`.</span></span>  
  
     <span data-ttu-id="e0714-147">Wymagane są dwa Delegaty: jeden do raportowania postępu dla klienta, a drugi do raportowania ukończenia do klienta programu.</span><span class="sxs-lookup"><span data-stu-id="e0714-147">You will need two delegates: one for reporting progress to the client, and one for reporting completion to the client.</span></span>  

     [!code-csharp[System.ComponentModel.AsyncOperationManager#9](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#9)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#9](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#9)]  
    [!code-csharp[System.ComponentModel.AsyncOperationManager#20](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#20)]
    [!code-vb[System.ComponentModel.AsyncOperationManager#20](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#20)]  
  
2. <span data-ttu-id="e0714-148">Wywołaj `InitializeDelegates` metodę w konstruktorze składnika.</span><span class="sxs-lookup"><span data-stu-id="e0714-148">Call the `InitializeDelegates` method in your component's constructor.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#21](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#21)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#21](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#21)]  
  
3. <span data-ttu-id="e0714-149">Zadeklaruj delegat w `PrimeNumberCalculator` klasie, która obsługuje rzeczywistą służbę do wykonania asynchronicznie.</span><span class="sxs-lookup"><span data-stu-id="e0714-149">Declare a delegate in the `PrimeNumberCalculator` class that handles the actual work to be done asynchronously.</span></span> <span data-ttu-id="e0714-150">Ten delegat otacza metodę procesu roboczego, która sprawdza, czy liczba jest podstawowa.</span><span class="sxs-lookup"><span data-stu-id="e0714-150">This delegate wraps the worker method that tests whether a number is prime.</span></span> <span data-ttu-id="e0714-151">Obiekt delegowany przyjmuje <xref:System.ComponentModel.AsyncOperation> parametr, który zostanie użyty do śledzenia okresu istnienia operacji asynchronicznej.</span><span class="sxs-lookup"><span data-stu-id="e0714-151">The delegate takes an <xref:System.ComponentModel.AsyncOperation> parameter, which will be used to track the lifetime of the asynchronous operation.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#22](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#22)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#22](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#22)]  
  
4. <span data-ttu-id="e0714-152">Utwórz kolekcję do zarządzania okresami istnienia oczekujących operacji asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="e0714-152">Create a collection for managing lifetimes of pending asynchronous operations.</span></span> <span data-ttu-id="e0714-153">Klient musi mieć możliwość śledzenia operacji, gdy są wykonywane i kończone, a to śledzenie jest wykonywane przez wymaganie, aby klient przeszedł unikatowy token, lub identyfikator zadania, gdy klient wysyła wywołanie do metody asynchronicznej.</span><span class="sxs-lookup"><span data-stu-id="e0714-153">The client needs a way to track operations as they are executed and completed, and this tracking is done by requiring the client to pass a unique token, or task ID, when the client makes the call to the asynchronous method.</span></span> <span data-ttu-id="e0714-154">`PrimeNumberCalculator`Składnik musi śledzić każde wywołanie, kojarząc identyfikator zadania z odpowiednim wywołaniem.</span><span class="sxs-lookup"><span data-stu-id="e0714-154">The `PrimeNumberCalculator` component must keep track of each call by associating the task ID with its corresponding invocation.</span></span> <span data-ttu-id="e0714-155">Jeśli klient przeszedł identyfikator zadania, który nie jest unikatowy, `PrimeNumberCalculator` składnik musi zgłosić wyjątek.</span><span class="sxs-lookup"><span data-stu-id="e0714-155">If the client passes a task ID that is not unique, the `PrimeNumberCalculator` component must raise an exception.</span></span>  
  
     <span data-ttu-id="e0714-156">`PrimeNumberCalculator`Składnik śledzi identyfikator zadania za pomocą specjalnej klasy kolekcji o nazwie a <xref:System.Collections.Specialized.HybridDictionary> .</span><span class="sxs-lookup"><span data-stu-id="e0714-156">The `PrimeNumberCalculator` component keeps track of task ID by using a special collection class called a <xref:System.Collections.Specialized.HybridDictionary>.</span></span> <span data-ttu-id="e0714-157">W definicji klasy Utwórz <xref:System.Collections.Specialized.HybridDictionary> wywołana `userTokenToLifetime` .</span><span class="sxs-lookup"><span data-stu-id="e0714-157">In the class definition, create a <xref:System.Collections.Specialized.HybridDictionary> called `userTokenToLifetime`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#23](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#23)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#23](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#23)]  
  
## <a name="implementing-public-events"></a><span data-ttu-id="e0714-158">Implementowanie zdarzeń publicznych</span><span class="sxs-lookup"><span data-stu-id="e0714-158">Implementing Public Events</span></span>  
 <span data-ttu-id="e0714-159">Składniki implementujące wzorzec asynchroniczny oparty na zdarzeniach komunikują się z klientami przy użyciu zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="e0714-159">Components that implement the Event-based Asynchronous Pattern communicate to clients using events.</span></span> <span data-ttu-id="e0714-160">Te zdarzenia są wywoływane w odpowiednim wątku z pomocą <xref:System.ComponentModel.AsyncOperation> klasy.</span><span class="sxs-lookup"><span data-stu-id="e0714-160">These events are invoked on the proper thread with the help of the <xref:System.ComponentModel.AsyncOperation> class.</span></span>  
  
### <a name="to-raise-events-to-your-components-clients"></a><span data-ttu-id="e0714-161">Aby zgłosić zdarzenia do klientów składnika:</span><span class="sxs-lookup"><span data-stu-id="e0714-161">To raise events to your component's clients:</span></span>  
  
1. <span data-ttu-id="e0714-162">Zaimplementuj zdarzenia publiczne na potrzeby raportowania dla klientów.</span><span class="sxs-lookup"><span data-stu-id="e0714-162">Implement public events for reporting to clients.</span></span> <span data-ttu-id="e0714-163">Konieczne będzie zdarzenie raportowania postępu i jeden dla ukończenia raportowania.</span><span class="sxs-lookup"><span data-stu-id="e0714-163">You will need an event for reporting progress and one for reporting completion.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#24](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#24)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#24](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#24)]  
  
## <a name="implementing-the-completion-method"></a><span data-ttu-id="e0714-164">Implementowanie metody ukończenia</span><span class="sxs-lookup"><span data-stu-id="e0714-164">Implementing the Completion Method</span></span>  
 <span data-ttu-id="e0714-165">Delegat uzupełniający to metoda, którą podstawowe, wolne od wątku zachowanie asynchroniczne wywoła, gdy operacja asynchroniczna kończy się przez pomyślne zakończenie, błąd lub anulowanie.</span><span class="sxs-lookup"><span data-stu-id="e0714-165">The completion delegate is the method that the underlying, free-threaded asynchronous behavior will invoke when the asynchronous operation ends by successful completion, error, or cancellation.</span></span> <span data-ttu-id="e0714-166">To wywołanie występuje w dowolnym wątku.</span><span class="sxs-lookup"><span data-stu-id="e0714-166">This invocation happens on an arbitrary thread.</span></span>  
  
 <span data-ttu-id="e0714-167">Ta metoda polega na tym, że identyfikator zadania klienta jest usuwany z wewnętrznej kolekcji unikatowych tokenów klienta.</span><span class="sxs-lookup"><span data-stu-id="e0714-167">This method is where the client's task ID is removed from the internal collection of unique client tokens.</span></span> <span data-ttu-id="e0714-168">Ta metoda również końcowy okres istnienia określonej operacji asynchronicznej przez wywołanie <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> metody w odpowiedniej <xref:System.ComponentModel.AsyncOperation> .</span><span class="sxs-lookup"><span data-stu-id="e0714-168">This method also ends the lifetime of a particular asynchronous operation by calling the <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> method on the corresponding <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="e0714-169">To wywołanie podnosi zdarzenie ukończenia w wątku, który jest odpowiedni dla modelu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="e0714-169">This call raises the completion event on the thread that is appropriate for the application model.</span></span> <span data-ttu-id="e0714-170">Po <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> wywołaniu metody to wystąpienie <xref:System.ComponentModel.AsyncOperation> nie może być już używane, a wszystkie kolejne próby jego użycia spowodują zgłoszenie wyjątku.</span><span class="sxs-lookup"><span data-stu-id="e0714-170">After the <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> method is called, this instance of <xref:System.ComponentModel.AsyncOperation> can no longer be used, and any subsequent attempts to use it will throw an exception.</span></span>  
  
 <span data-ttu-id="e0714-171">`CompletionMethod`Sygnatura musi zawierać wszystkie Stany wymagane do opisania wyniku operacji asynchronicznej.</span><span class="sxs-lookup"><span data-stu-id="e0714-171">The `CompletionMethod` signature must hold all state necessary to describe the outcome of the asynchronous operation.</span></span> <span data-ttu-id="e0714-172">Przechowuje stan dla liczby, która została przetestowana przez tę konkretną operację asynchroniczną, niezależnie od tego, czy jest to liczba, i wartość pierwszego dzielnika, jeśli nie jest to liczba podstawowa.</span><span class="sxs-lookup"><span data-stu-id="e0714-172">It holds state for the number that was tested by this particular asynchronous operation, whether the number is prime, and the value of its first divisor if it is not a prime number.</span></span> <span data-ttu-id="e0714-173">Zawiera również stan opisujący każdy wyjątek, który wystąpił, i <xref:System.ComponentModel.AsyncOperation> odpowiadający temu określonemu zadaniu.</span><span class="sxs-lookup"><span data-stu-id="e0714-173">It also holds state describing any exception that occurred, and the <xref:System.ComponentModel.AsyncOperation> corresponding to this particular task.</span></span>  
  
### <a name="to-complete-an-asynchronous-operation"></a><span data-ttu-id="e0714-174">Aby ukończyć operację asynchroniczną:</span><span class="sxs-lookup"><span data-stu-id="e0714-174">To complete an asynchronous operation:</span></span>  
  
- <span data-ttu-id="e0714-175">Zaimplementuj metodę ukończenia.</span><span class="sxs-lookup"><span data-stu-id="e0714-175">Implement the completion method.</span></span> <span data-ttu-id="e0714-176">Przyjmuje sześć parametrów, których używa do wypełniania `CalculatePrimeCompletedEventArgs` , który jest zwracany do klienta przez klienta `CalculatePrimeCompletedEventHandler` .</span><span class="sxs-lookup"><span data-stu-id="e0714-176">It takes six parameters, which it uses to populate a `CalculatePrimeCompletedEventArgs` that is returned to the client through the client's `CalculatePrimeCompletedEventHandler`.</span></span> <span data-ttu-id="e0714-177">Spowoduje to usunięcie tokenu identyfikatora zadania klienta z kolekcji wewnętrznej i zakończenie okresu istnienia operacji asynchronicznej z wywołaniem do <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> .</span><span class="sxs-lookup"><span data-stu-id="e0714-177">It removes the client's task ID token from the internal collection, and it ends the asynchronous operation's lifetime with a call to <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A>.</span></span> <span data-ttu-id="e0714-178"><xref:System.ComponentModel.AsyncOperation>Kierowanie wywołania do wątku lub kontekstu, który jest odpowiedni dla modelu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="e0714-178">The <xref:System.ComponentModel.AsyncOperation> marshals the call to the thread or context that is appropriate for the application model.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#26](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#26)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#26](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#26)]  
  
## <a name="checkpoint"></a><span data-ttu-id="e0714-179">Punkt kontrolny</span><span class="sxs-lookup"><span data-stu-id="e0714-179">Checkpoint</span></span>  
 <span data-ttu-id="e0714-180">W tym momencie można skompilować składnik.</span><span class="sxs-lookup"><span data-stu-id="e0714-180">At this point, you can build the component.</span></span>  
  
### <a name="to-test-your-component"></a><span data-ttu-id="e0714-181">Aby przetestować składnik</span><span class="sxs-lookup"><span data-stu-id="e0714-181">To test your component</span></span>  
  
- <span data-ttu-id="e0714-182">Kompiluj składnik.</span><span class="sxs-lookup"><span data-stu-id="e0714-182">Compile the component.</span></span>  
  
     <span data-ttu-id="e0714-183">Zostanie wyświetlone jedno Ostrzeżenie kompilatora:</span><span class="sxs-lookup"><span data-stu-id="e0714-183">You will receive one compiler warning:</span></span>  
  
    ```console  
    warning CS0169: The private field 'AsynchronousPatternExample.PrimeNumberCalculator.workerDelegate' is never used  
    ```  
  
     <span data-ttu-id="e0714-184">To ostrzeżenie zostanie rozwiązane w następnej sekcji.</span><span class="sxs-lookup"><span data-stu-id="e0714-184">This warning will be resolved in the next section.</span></span>  
  
## <a name="implementing-the-worker-methods"></a><span data-ttu-id="e0714-185">Implementowanie metod roboczych</span><span class="sxs-lookup"><span data-stu-id="e0714-185">Implementing the Worker Methods</span></span>  
 <span data-ttu-id="e0714-186">Do tej pory wdrożono kod asynchroniczny dla `PrimeNumberCalculator` składnika.</span><span class="sxs-lookup"><span data-stu-id="e0714-186">So far, you have implemented the supporting asynchronous code for the `PrimeNumberCalculator` component.</span></span> <span data-ttu-id="e0714-187">Teraz można zaimplementować kod, który wykonuje rzeczywistą prace.</span><span class="sxs-lookup"><span data-stu-id="e0714-187">Now you can implement the code that does the actual work.</span></span> <span data-ttu-id="e0714-188">Zostaną zaimplementowane trzy metody: `CalculateWorker` , `BuildPrimeNumberList` , i `IsPrime` .</span><span class="sxs-lookup"><span data-stu-id="e0714-188">You will implement three methods: `CalculateWorker`, `BuildPrimeNumberList`, and `IsPrime`.</span></span> <span data-ttu-id="e0714-189">Razem `BuildPrimeNumberList` i `IsPrime` składają się dobrze znany algorytm o nazwie Sit of Eratostenesa, który określa, czy liczba jest na początku, przez znalezienie wszystkich numerów głównych do pierwiastek kwadratowy numeru testu.</span><span class="sxs-lookup"><span data-stu-id="e0714-189">Together, `BuildPrimeNumberList` and `IsPrime` comprise a well-known algorithm called the Sieve of Eratosthenes, which determines if a number is prime by finding all the prime numbers up to the square root of the test number.</span></span> <span data-ttu-id="e0714-190">Jeśli żaden dzielnik nie zostanie znaleziony przez ten punkt, numer testu jest podstawowy.</span><span class="sxs-lookup"><span data-stu-id="e0714-190">If no divisors are found by that point, the test number is prime.</span></span>  
  
 <span data-ttu-id="e0714-191">Jeśli ten składnik został zastosowany w celu uzyskania maksymalnej wydajności, Zapamiętaj wszystkie liczby podstawowe wykryte przez różne wywołania dla różnych numerów testów.</span><span class="sxs-lookup"><span data-stu-id="e0714-191">If this component were written for maximum efficiency, it would remember all the prime numbers discovered by various invocations for different test numbers.</span></span> <span data-ttu-id="e0714-192">Sprawdza również, czy istnieją proste dzielniki, takie jak 2, 3 i 5.</span><span class="sxs-lookup"><span data-stu-id="e0714-192">It would also check for trivial divisors like 2, 3, and 5.</span></span> <span data-ttu-id="e0714-193">Celem tego przykładu jest zademonstrowanie sposobu, w jaki operacje czasochłonne mogą być wykonywane asynchronicznie, jednak te optymalizacje są pozostawione jako ćwiczenie.</span><span class="sxs-lookup"><span data-stu-id="e0714-193">The intent of this example is to demonstrate how time-consuming operations can be executed asynchronously, however, so these optimizations are left as an exercise for you.</span></span>  
  
 <span data-ttu-id="e0714-194">`CalculateWorker`Metoda jest opakowana w delegata i jest wywoływana asynchronicznie z wywołaniem do `BeginInvoke` .</span><span class="sxs-lookup"><span data-stu-id="e0714-194">The `CalculateWorker` method is wrapped in a delegate and is invoked asynchronously with a call to `BeginInvoke`.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="e0714-195">Raportowanie postępu jest zaimplementowane w `BuildPrimeNumberList` metodzie.</span><span class="sxs-lookup"><span data-stu-id="e0714-195">Progress reporting is implemented in the `BuildPrimeNumberList` method.</span></span> <span data-ttu-id="e0714-196">Na szybkich komputerach `ProgressChanged` zdarzenia mogą być zgłaszane w krótkim pomyślnym sukcesie.</span><span class="sxs-lookup"><span data-stu-id="e0714-196">On fast computers, `ProgressChanged` events can be raised in rapid succession.</span></span> <span data-ttu-id="e0714-197">Wątek klienta, na którym są wywoływane te zdarzenia, musi być w stanie obsłużyć tę sytuację.</span><span class="sxs-lookup"><span data-stu-id="e0714-197">The client thread, on which these events are raised, must be able to handle this situation.</span></span> <span data-ttu-id="e0714-198">Kod interfejsu użytkownika może być zalewany komunikatem i nie można go zachować, co spowodowało brak odpowiedzi.</span><span class="sxs-lookup"><span data-stu-id="e0714-198">User interface code may be flooded with messages and unable to keep up, resulting in unresponsiveness.</span></span> <span data-ttu-id="e0714-199">Przykładowy interfejs użytkownika, który obsługuje tę sytuację, znajduje się w temacie [How to: Implementuj klienta wzorca asynchronicznego opartego na zdarzeniach](how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="e0714-199">For an example user interface that handles this situation, see [How to: Implement a Client of the Event-based Asynchronous Pattern](how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
### <a name="to-execute-the-prime-number-calculation-asynchronously"></a><span data-ttu-id="e0714-200">Aby wykonać obliczenie liczby pierwszych asynchronicznie:</span><span class="sxs-lookup"><span data-stu-id="e0714-200">To execute the prime number calculation asynchronously:</span></span>  
  
1. <span data-ttu-id="e0714-201">Zaimplementuj `TaskCanceled` metodę narzędzia.</span><span class="sxs-lookup"><span data-stu-id="e0714-201">Implement the `TaskCanceled` utility method.</span></span> <span data-ttu-id="e0714-202">Spowoduje to sprawdzenie kolekcji okresu istnienia zadania dla danego identyfikatora zadania i zwrócenie informacji o tym, `true` czy nie znaleziono identyfikatora zadania.</span><span class="sxs-lookup"><span data-stu-id="e0714-202">This checks the task lifetime collection for the given task ID, and returns `true` if the task ID is not found.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#32](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#32)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#32](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#32)]  
  
2. <span data-ttu-id="e0714-203">Zaimplementuj `CalculateWorker` metodę.</span><span class="sxs-lookup"><span data-stu-id="e0714-203">Implement the `CalculateWorker` method.</span></span> <span data-ttu-id="e0714-204">Przyjmuje dwa parametry: liczbę do przetestowania i <xref:System.ComponentModel.AsyncOperation> .</span><span class="sxs-lookup"><span data-stu-id="e0714-204">It takes two parameters: a number to test, and an <xref:System.ComponentModel.AsyncOperation>.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#27](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#27)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#27](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#27)]  
  
3. <span data-ttu-id="e0714-205">Implementacja `BuildPrimeNumberList` .</span><span class="sxs-lookup"><span data-stu-id="e0714-205">Implement `BuildPrimeNumberList`.</span></span> <span data-ttu-id="e0714-206">Przyjmuje dwa parametry: liczbę do przetestowania i <xref:System.ComponentModel.AsyncOperation> .</span><span class="sxs-lookup"><span data-stu-id="e0714-206">It takes two parameters: the number to test, and an <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="e0714-207">Używa <xref:System.ComponentModel.AsyncOperation> do raportowania postępu i przyrostowych wyników.</span><span class="sxs-lookup"><span data-stu-id="e0714-207">It uses the <xref:System.ComponentModel.AsyncOperation> to report progress and incremental results.</span></span> <span data-ttu-id="e0714-208">Gwarantuje to, że procedury obsługi zdarzeń klienta są wywoływane w odpowiednim wątku lub kontekście dla modelu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="e0714-208">This assures that the client's event handlers are called on the proper thread or context for the application model.</span></span> <span data-ttu-id="e0714-209">W przypadku `BuildPrimeNumberList` znalezienia numeru głównego raport jest raportowany jako wynik przyrostowy do programu obsługi zdarzeń klienta dla `ProgressChanged` zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="e0714-209">When `BuildPrimeNumberList` finds a prime number, it reports this as an incremental result to the client's event handler for the `ProgressChanged` event.</span></span> <span data-ttu-id="e0714-210">Wymaga klasy pochodnej od <xref:System.ComponentModel.ProgressChangedEventArgs> , o nazwie `CalculatePrimeProgressChangedEventArgs` , która ma jedną dodaną właściwość o nazwie `LatestPrimeNumber` .</span><span class="sxs-lookup"><span data-stu-id="e0714-210">This requires a class derived from <xref:System.ComponentModel.ProgressChangedEventArgs>, called `CalculatePrimeProgressChangedEventArgs`, which has one added property called `LatestPrimeNumber`.</span></span>  
  
     <span data-ttu-id="e0714-211">`BuildPrimeNumberList`Metoda okresowo wywołuje `TaskCanceled` metodę i kończy działanie, jeśli metoda zwraca `true` .</span><span class="sxs-lookup"><span data-stu-id="e0714-211">The `BuildPrimeNumberList` method also periodically calls the `TaskCanceled` method and exits if the method returns `true`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#5](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#5)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#5](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#5)]  
  
4. <span data-ttu-id="e0714-212">Implementacja `IsPrime` .</span><span class="sxs-lookup"><span data-stu-id="e0714-212">Implement `IsPrime`.</span></span> <span data-ttu-id="e0714-213">Przyjmuje trzy parametry: listę znanych numerów początkowych, liczbę do przetestowania oraz parametr wyjściowy pierwszego dzielnika znaleziony.</span><span class="sxs-lookup"><span data-stu-id="e0714-213">It takes three parameters: a list of known prime numbers, the number to test, and an output parameter for the first divisor found.</span></span> <span data-ttu-id="e0714-214">Uwzględniając listę numerów pierwszych, określa, czy numer testu jest podstawowy.</span><span class="sxs-lookup"><span data-stu-id="e0714-214">Given the list of prime numbers, it determines if the test number is prime.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#28](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#28)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#28](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#28)]  
  
5. <span data-ttu-id="e0714-215">Pochodny `CalculatePrimeProgressChangedEventArgs` od <xref:System.ComponentModel.ProgressChangedEventArgs> .</span><span class="sxs-lookup"><span data-stu-id="e0714-215">Derive `CalculatePrimeProgressChangedEventArgs` from <xref:System.ComponentModel.ProgressChangedEventArgs>.</span></span> <span data-ttu-id="e0714-216">Ta klasa jest niezbędna do raportowania przyrostowych wyników do programu obsługi zdarzeń klienta dla `ProgressChanged` zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="e0714-216">This class is necessary for reporting incremental results to the client's event handler for the `ProgressChanged` event.</span></span> <span data-ttu-id="e0714-217">Ma jedną dodaną właściwość o nazwie `LatestPrimeNumber` .</span><span class="sxs-lookup"><span data-stu-id="e0714-217">It has one added property called `LatestPrimeNumber`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#29](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#29)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#29](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#29)]  
  
## <a name="checkpoint"></a><span data-ttu-id="e0714-218">Punkt kontrolny</span><span class="sxs-lookup"><span data-stu-id="e0714-218">Checkpoint</span></span>  
 <span data-ttu-id="e0714-219">W tym momencie można skompilować składnik.</span><span class="sxs-lookup"><span data-stu-id="e0714-219">At this point, you can build the component.</span></span>  
  
### <a name="to-test-your-component"></a><span data-ttu-id="e0714-220">Aby przetestować składnik</span><span class="sxs-lookup"><span data-stu-id="e0714-220">To test your component</span></span>  
  
- <span data-ttu-id="e0714-221">Kompiluj składnik.</span><span class="sxs-lookup"><span data-stu-id="e0714-221">Compile the component.</span></span>  
  
     <span data-ttu-id="e0714-222">Wszystkie te, które pozostały do zapisania, są metodami do uruchamiania i anulowania operacji asynchronicznych `CalculatePrimeAsync` oraz `CancelAsync` .</span><span class="sxs-lookup"><span data-stu-id="e0714-222">All that remains to be written are the methods to start and cancel asynchronous operations, `CalculatePrimeAsync` and `CancelAsync`.</span></span>  
  
## <a name="implementing-the-start-and-cancel-methods"></a><span data-ttu-id="e0714-223">Implementowanie metod Start i Cancel</span><span class="sxs-lookup"><span data-stu-id="e0714-223">Implementing the Start and Cancel Methods</span></span>  
 <span data-ttu-id="e0714-224">Metoda Worker jest uruchamiana we własnym wątku przez wywołanie `BeginInvoke` obiektu delegowanego, który go otacza.</span><span class="sxs-lookup"><span data-stu-id="e0714-224">You start the worker method on its own thread by calling `BeginInvoke` on the delegate that wraps it.</span></span> <span data-ttu-id="e0714-225">Aby zarządzać okresem istnienia określonej operacji asynchronicznej, należy wywołać <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> metodę w <xref:System.ComponentModel.AsyncOperationManager> klasie pomocnika.</span><span class="sxs-lookup"><span data-stu-id="e0714-225">To manage the lifetime of a particular asynchronous operation, you call the <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> method on the <xref:System.ComponentModel.AsyncOperationManager> helper class.</span></span> <span data-ttu-id="e0714-226">Zwraca <xref:System.ComponentModel.AsyncOperation> , który kierujące wywołania do obsługi zdarzeń klienta do właściwego wątku lub kontekstu.</span><span class="sxs-lookup"><span data-stu-id="e0714-226">This returns an <xref:System.ComponentModel.AsyncOperation>, which marshals calls on the client's event handlers to the proper thread or context.</span></span>  
  
 <span data-ttu-id="e0714-227">Użytkownik anulował określoną oczekującą operację, wywołując <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> odpowiedni element <xref:System.ComponentModel.AsyncOperation> .</span><span class="sxs-lookup"><span data-stu-id="e0714-227">You cancel a particular pending operation by calling <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> on its corresponding <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="e0714-228">Spowoduje to zakończenie tej operacji, a wszelkie kolejne wywołania do niej <xref:System.ComponentModel.AsyncOperation> spowodują zgłoszenie wyjątku.</span><span class="sxs-lookup"><span data-stu-id="e0714-228">This ends that operation, and any subsequent calls to its <xref:System.ComponentModel.AsyncOperation> will throw an exception.</span></span>  
  
### <a name="to-implement-start-and-cancel-functionality"></a><span data-ttu-id="e0714-229">Aby zaimplementować funkcje Start i Cancel:</span><span class="sxs-lookup"><span data-stu-id="e0714-229">To implement Start and Cancel functionality:</span></span>  
  
1. <span data-ttu-id="e0714-230">Zaimplementuj `CalculatePrimeAsync` metodę.</span><span class="sxs-lookup"><span data-stu-id="e0714-230">Implement the `CalculatePrimeAsync` method.</span></span> <span data-ttu-id="e0714-231">Upewnij się, że token dostarczony przez klienta (identyfikator zadania) jest unikatowy w odniesieniu do wszystkich tokenów reprezentujących aktualnie oczekujące zadania.</span><span class="sxs-lookup"><span data-stu-id="e0714-231">Make sure the client-supplied token (task ID) is unique with respect to all the tokens representing currently pending tasks.</span></span> <span data-ttu-id="e0714-232">Jeśli klient kończy się nieunikatowym tokenem, `CalculatePrimeAsync` zgłasza wyjątek.</span><span class="sxs-lookup"><span data-stu-id="e0714-232">If the client passes in a non-unique token, `CalculatePrimeAsync` raises an exception.</span></span> <span data-ttu-id="e0714-233">W przeciwnym razie token zostanie dodany do kolekcji identyfikatorów zadań.</span><span class="sxs-lookup"><span data-stu-id="e0714-233">Otherwise, the token is added to the task ID collection.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#3](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#3)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#3](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#3)]  
  
2. <span data-ttu-id="e0714-234">Zaimplementuj `CancelAsync` metodę.</span><span class="sxs-lookup"><span data-stu-id="e0714-234">Implement the `CancelAsync` method.</span></span> <span data-ttu-id="e0714-235">Jeśli `taskId` parametr istnieje w kolekcji tokenów, zostanie usunięty.</span><span class="sxs-lookup"><span data-stu-id="e0714-235">If the `taskId` parameter exists in the token collection, it is removed.</span></span> <span data-ttu-id="e0714-236">Zapobiega to anulowaniu zadań, które nie zostały uruchomione.</span><span class="sxs-lookup"><span data-stu-id="e0714-236">This prevents canceled tasks that have not started from running.</span></span> <span data-ttu-id="e0714-237">Jeśli zadanie jest uruchomione, Metoda zostanie `BuildPrimeNumberList` zakończona, gdy wykryje, że identyfikator zadania został usunięty z kolekcji okres istnienia.</span><span class="sxs-lookup"><span data-stu-id="e0714-237">If the task is running, the `BuildPrimeNumberList` method exits when it detects that the task ID has been removed from the lifetime collection.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#4](snippets/component-that-supports-the-event-based-asynchronous-pattern/csharp/primenumbercalculatormain.cs#4)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#4](snippets/component-that-supports-the-event-based-asynchronous-pattern/vb/primenumbercalculatormain.vb#4)]  
  
## <a name="checkpoint"></a><span data-ttu-id="e0714-238">Punkt kontrolny</span><span class="sxs-lookup"><span data-stu-id="e0714-238">Checkpoint</span></span>  
 <span data-ttu-id="e0714-239">W tym momencie można skompilować składnik.</span><span class="sxs-lookup"><span data-stu-id="e0714-239">At this point, you can build the component.</span></span>  
  
### <a name="to-test-your-component"></a><span data-ttu-id="e0714-240">Aby przetestować składnik</span><span class="sxs-lookup"><span data-stu-id="e0714-240">To test your component</span></span>  
  
- <span data-ttu-id="e0714-241">Kompiluj składnik.</span><span class="sxs-lookup"><span data-stu-id="e0714-241">Compile the component.</span></span>  
  
 <span data-ttu-id="e0714-242">`PrimeNumberCalculator`Składnik został już ukończony i gotowy do użycia.</span><span class="sxs-lookup"><span data-stu-id="e0714-242">The `PrimeNumberCalculator` component is now complete and ready to use.</span></span>  
  
 <span data-ttu-id="e0714-243">Aby zapoznać się z przykładowym klientem korzystającym z `PrimeNumberCalculator` składnika, zobacz [How to: Implementuj klienta wzorca asynchronicznego opartego na zdarzeniach](how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="e0714-243">For an example client that uses the `PrimeNumberCalculator` component, see [How to: Implement a Client of the Event-based Asynchronous Pattern](how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="e0714-244">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="e0714-244">Next Steps</span></span>  
 <span data-ttu-id="e0714-245">Możesz wypełnić ten przykład, pisząc `CalculatePrime` , synchroniczną równoważność `CalculatePrimeAsync` metody.</span><span class="sxs-lookup"><span data-stu-id="e0714-245">You can fill out this example by writing `CalculatePrime`, the synchronous equivalent of `CalculatePrimeAsync` method.</span></span> <span data-ttu-id="e0714-246">Dzięki temu składnik jest w `PrimeNumberCalculator` pełni zgodny ze wzorcem asynchronicznym opartym na zdarzeniach.</span><span class="sxs-lookup"><span data-stu-id="e0714-246">This will make the `PrimeNumberCalculator` component fully compliant with the Event-based Asynchronous Pattern.</span></span>  
  
 <span data-ttu-id="e0714-247">Możesz ulepszyć ten przykład, zachowując listę wszystkich pierwszych liczb odnalezionych przez różne wywołania dla różnych numerów testów.</span><span class="sxs-lookup"><span data-stu-id="e0714-247">You can improve this example by retaining the list of all the prime numbers discovered by various invocations for different test numbers.</span></span> <span data-ttu-id="e0714-248">Korzystając z tej metody, każde zadanie będzie korzystać z pracy wykonanej przez poprzednie zadania.</span><span class="sxs-lookup"><span data-stu-id="e0714-248">Using this approach, each task will benefit from the work done by previous tasks.</span></span> <span data-ttu-id="e0714-249">Należy zachować ostrożność, aby chronić tę listę z `lock` regionami, więc dostęp do listy przez różne wątki jest serializowany.</span><span class="sxs-lookup"><span data-stu-id="e0714-249">Be careful to protect this list with `lock` regions, so access to the list by different threads is serialized.</span></span>  
  
 <span data-ttu-id="e0714-250">Możesz również ulepszyć ten przykład, testując dla prostych dzielników, takich jak 2, 3 i 5.</span><span class="sxs-lookup"><span data-stu-id="e0714-250">You can also improve this example by testing for trivial divisors, like 2, 3, and 5.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e0714-251">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="e0714-251">See also</span></span>

- [<span data-ttu-id="e0714-252">Instrukcje: uruchamianie operacji w tle</span><span class="sxs-lookup"><span data-stu-id="e0714-252">How to: Run an Operation in the Background</span></span>](/dotnet/desktop/winforms/controls/how-to-run-an-operation-in-the-background)
- [<span data-ttu-id="e0714-253">Asynchroniczny wzorzec oparty na zdarzeniach — przegląd</span><span class="sxs-lookup"><span data-stu-id="e0714-253">Event-based Asynchronous Pattern Overview</span></span>](event-based-asynchronous-pattern-overview.md)
- [<span data-ttu-id="e0714-254">Asynchroniczny wzorzec oparty na zdarzeniach (EAP)</span><span class="sxs-lookup"><span data-stu-id="e0714-254">Event-based Asynchronous Pattern (EAP)</span></span>](event-based-asynchronous-pattern-eap.md)
