---
title: "Wskazówki: implementacja składnika obsługującego wzorzec asynchroniczny oparty na zdarzeniach"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Event-based Asynchronous Pattern
- ProgressChangedEventArgs class
- BackgroundWorker component
- events [.NET Framework], asynchronous
- Asynchronous Pattern
- AsyncOperationManager class
- threading [.NET Framework], asynchronous features
- components [.NET Framework], asynchronous
- AsyncOperation class
- threading [Windows Forms], asynchronous features
- AsyncCompletedEventArgs class
ms.assetid: 61f676b5-936f-40f6-83ce-f22805ec9c2f
caps.latest.revision: "21"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: a3e69ea3de0ac418956d51c6e942e33d90575c1d
ms.sourcegitcommit: 957c696f25e39f923a827fc3ad5e8ab72768838c
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 01/13/2018
---
# <a name="walkthrough-implementing-a-component-that-supports-the-event-based-asynchronous-pattern"></a><span data-ttu-id="20b9b-102">Wskazówki: implementacja składnika obsługującego wzorzec asynchroniczny oparty na zdarzeniach</span><span class="sxs-lookup"><span data-stu-id="20b9b-102">Walkthrough: Implementing a Component That Supports the Event-based Asynchronous Pattern</span></span>
<span data-ttu-id="20b9b-103">Podczas pisania klasy z niektórych operacji, które może pociągnąć za sobą zauważalnego opóźnienia, należy wziąć pod uwagę nadanie mu funkcji asynchroniczności zaimplementowanie [oparty na zdarzeniach asynchroniczny wzorzec — Przegląd](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md).</span><span class="sxs-lookup"><span data-stu-id="20b9b-103">If you are writing a class with some operations that may incur noticeable delays, consider giving it asynchronous functionality by implementing the [Event-based Asynchronous Pattern Overview](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md).</span></span>  
  
 <span data-ttu-id="20b9b-104">W tym przewodniku ilustruje sposób tworzenia składnika, który implementuje wzorzec asynchroniczny oparty na zdarzeniach.</span><span class="sxs-lookup"><span data-stu-id="20b9b-104">This walkthrough illustrates how to create a component that implements the Event-based Asynchronous Pattern.</span></span> <span data-ttu-id="20b9b-105">Jest stosowana przy użyciu klasy pomocy z <xref:System.ComponentModel?displayProperty=nameWithType> przestrzeni nazw, który zapewnia składnika działa prawidłowo w modelu żadnych aplikacji, w tym [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)], konsoli aplikacji i aplikacjach formularzy systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="20b9b-105">It is implemented using helper classes from the <xref:System.ComponentModel?displayProperty=nameWithType> namespace, which ensures that the component works correctly under any application model, including [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)], Console applications and Windows Forms applications.</span></span> <span data-ttu-id="20b9b-106">Ten składnik jest również designable z <xref:System.Windows.Forms.PropertyGrid> własne niestandardowe projektantów i kontroli.</span><span class="sxs-lookup"><span data-stu-id="20b9b-106">This component is also designable with a <xref:System.Windows.Forms.PropertyGrid> control and your own custom designers.</span></span>  
  
 <span data-ttu-id="20b9b-107">Po zakończeniu wykonywania masz aplikację, która oblicza liczb pierwszych asynchronicznie.</span><span class="sxs-lookup"><span data-stu-id="20b9b-107">When you are through, you will have an application that computes prime numbers asynchronously.</span></span> <span data-ttu-id="20b9b-108">Aplikacja będzie mieć wątku interfejsu użytkownika głównego i wątków dla każdego obliczania liczba pierwsza.</span><span class="sxs-lookup"><span data-stu-id="20b9b-108">Your application will have a main user interface (UI) thread and a thread for each prime number calculation.</span></span> <span data-ttu-id="20b9b-109">Chociaż sprawdzenie, czy jest dużą liczbą prime może zająć zauważalne ilość czasu, głównego wątku interfejsu użytkownika nie zostanie przerwana przez to opóźnienie i formularz będzie odpowiadać podczas obliczeń.</span><span class="sxs-lookup"><span data-stu-id="20b9b-109">Although testing whether a large number is prime can take a noticeable amount of time, the main UI thread will not be interrupted by this delay, and the form will be responsive during the calculations.</span></span> <span data-ttu-id="20b9b-110">Będzie można uruchomić zgodnie z wielu obliczeń, jak jednocześnie i selektywnie anulowania oczekującego obliczeń.</span><span class="sxs-lookup"><span data-stu-id="20b9b-110">You will be able to run as many calculations as you like concurrently and selectively cancel pending calculations.</span></span>  
  
 <span data-ttu-id="20b9b-111">Zadania przedstawione w tym przewodniku obejmują:</span><span class="sxs-lookup"><span data-stu-id="20b9b-111">Tasks illustrated in this walkthrough include:</span></span>  
  
-   <span data-ttu-id="20b9b-112">Tworzenie składnika</span><span class="sxs-lookup"><span data-stu-id="20b9b-112">Creating the Component</span></span>  
  
-   <span data-ttu-id="20b9b-113">Definiowanie zdarzenia asynchroniczne publiczne i Delegaty</span><span class="sxs-lookup"><span data-stu-id="20b9b-113">Defining Public Asynchronous Events and Delegates</span></span>  
  
-   <span data-ttu-id="20b9b-114">Definiowanie obiektów delegowanych prywatnych</span><span class="sxs-lookup"><span data-stu-id="20b9b-114">Defining Private Delegates</span></span>  
  
-   <span data-ttu-id="20b9b-115">Implementowanie zdarzenia publiczne</span><span class="sxs-lookup"><span data-stu-id="20b9b-115">Implementing Public Events</span></span>  
  
-   <span data-ttu-id="20b9b-116">Implementacja metody ukończenia</span><span class="sxs-lookup"><span data-stu-id="20b9b-116">Implementing the Completion Method</span></span>  
  
-   <span data-ttu-id="20b9b-117">Implementacja metody pracownika</span><span class="sxs-lookup"><span data-stu-id="20b9b-117">Implementing the Worker Methods</span></span>  
  
-   <span data-ttu-id="20b9b-118">Implementowanie Start i metody Anuluj</span><span class="sxs-lookup"><span data-stu-id="20b9b-118">Implementing Start and Cancel Methods</span></span>  
  
 <span data-ttu-id="20b9b-119">Aby skopiować kod w tym temacie na jednej liście, zobacz [porady: implementacja składnika obsługującego wzorzec asynchroniczny oparty na zdarzeniach](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="20b9b-119">To copy the code in this topic as a single listing, see [How to: Implement a Component That Supports the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="creating-the-component"></a><span data-ttu-id="20b9b-120">Tworzenie składnika</span><span class="sxs-lookup"><span data-stu-id="20b9b-120">Creating the Component</span></span>  
 <span data-ttu-id="20b9b-121">Pierwszym krokiem jest utworzyć składnika, który będzie implementacji klienta wzorca asynchronicznego opartego na zdarzeniach.</span><span class="sxs-lookup"><span data-stu-id="20b9b-121">The first step is to create the component that will implement the Event-based Asynchronous Pattern.</span></span>  
  
#### <a name="to-create-the-component"></a><span data-ttu-id="20b9b-122">Aby utworzyć składnika</span><span class="sxs-lookup"><span data-stu-id="20b9b-122">To create the component</span></span>  
  
-   <span data-ttu-id="20b9b-123">Tworzenie klasy o nazwie `PrimeNumberCalculator` dziedziczący po <xref:System.ComponentModel.Component>.</span><span class="sxs-lookup"><span data-stu-id="20b9b-123">Create a class called `PrimeNumberCalculator` that inherits from <xref:System.ComponentModel.Component>.</span></span>  
  
## <a name="defining-public-asynchronous-events-and-delegates"></a><span data-ttu-id="20b9b-124">Definiowanie zdarzenia asynchroniczne publiczne i Delegaty</span><span class="sxs-lookup"><span data-stu-id="20b9b-124">Defining Public Asynchronous Events and Delegates</span></span>  
 <span data-ttu-id="20b9b-125">Składnik komunikuje się klientów przy użyciu zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="20b9b-125">Your component communicates to clients using events.</span></span> <span data-ttu-id="20b9b-126">*MethodName *** Ukończono** alerty zdarzeń informujące o klientów do wykonania zadanie asynchroniczne i *MethodName *** ProgressChanged** zdarzeń poinformuje klientów postęp zadania asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="20b9b-126">The *MethodName***Completed** event alerts clients to the completion of an asynchronous task, and the *MethodName***ProgressChanged** event informs clients of the progress of an asynchronous task.</span></span>  
  
#### <a name="to-define-asynchronous-events-for-clients-of-your-component"></a><span data-ttu-id="20b9b-127">Aby zdefiniować zdarzenia asynchroniczne dla klientów składnika:</span><span class="sxs-lookup"><span data-stu-id="20b9b-127">To define asynchronous events for clients of your component:</span></span>  
  
1.  <span data-ttu-id="20b9b-128">Importuj <xref:System.Threading?displayProperty=nameWithType> i <xref:System.Collections.Specialized?displayProperty=nameWithType> przestrzeni nazw w górnej części pliku.</span><span class="sxs-lookup"><span data-stu-id="20b9b-128">Import the <xref:System.Threading?displayProperty=nameWithType> and <xref:System.Collections.Specialized?displayProperty=nameWithType> namespaces at the top of your file.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#11](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#11)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#11](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#11)]  
  
2.  <span data-ttu-id="20b9b-129">Przed `PrimeNumberCalculator` klasy definicji, Zadeklaruj delegatów dla zdarzeń o postępie i zakończeniu.</span><span class="sxs-lookup"><span data-stu-id="20b9b-129">Before the `PrimeNumberCalculator` class definition, declare delegates for progress and completion events.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#7](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#7)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#7](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#7)]  
  
3.  <span data-ttu-id="20b9b-130">W `PrimeNumberCalculator` definicji klasy, deklarowanie zdarzeń do raportowania postępie i zakończeniu do klientów.</span><span class="sxs-lookup"><span data-stu-id="20b9b-130">In the `PrimeNumberCalculator` class definition, declare events for reporting progress and completion to clients.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#8](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#8)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#8](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#8)]  
  
4.  <span data-ttu-id="20b9b-131">Po `PrimeNumberCalculator` definicji klasy, pochodzi `CalculatePrimeCompletedEventArgs` klasy raportowania w wyniku obliczenia każdego klienta programu obsługi zdarzeń dla `CalculatePrimeCompleted`.event.</span><span class="sxs-lookup"><span data-stu-id="20b9b-131">After the `PrimeNumberCalculator` class definition, derive the `CalculatePrimeCompletedEventArgs` class for reporting the outcome of each calculation to the client's event handler for the `CalculatePrimeCompleted`.event.</span></span> <span data-ttu-id="20b9b-132">Oprócz `AsyncCompletedEventArgs` właściwości, ta klasa umożliwia klienta w celu określenia jakiego numeru przetestowano, czy jest zapisują i co to jest pierwszy dzielnik, jeśli nie jest podstawowym.</span><span class="sxs-lookup"><span data-stu-id="20b9b-132">In addition to the `AsyncCompletedEventArgs` properties, this class enables the client to determine what number was tested, whether it is prime, and what the first divisor is if it is not prime.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#6](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#6)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#6](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#6)]  
  
## <a name="checkpoint"></a><span data-ttu-id="20b9b-133">Punkt kontrolny</span><span class="sxs-lookup"><span data-stu-id="20b9b-133">Checkpoint</span></span>  
 <span data-ttu-id="20b9b-134">W tym momencie można utworzyć składnika.</span><span class="sxs-lookup"><span data-stu-id="20b9b-134">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="20b9b-135">Aby przetestować składnika</span><span class="sxs-lookup"><span data-stu-id="20b9b-135">To test your component</span></span>  
  
-   <span data-ttu-id="20b9b-136">Kompiluj składnika.</span><span class="sxs-lookup"><span data-stu-id="20b9b-136">Compile the component.</span></span>  
  
     <span data-ttu-id="20b9b-137">Użytkownik otrzyma dwie ostrzeżenia kompilatora:</span><span class="sxs-lookup"><span data-stu-id="20b9b-137">You will receive two compiler warnings:</span></span>  
  
    ```  
    warning CS0067: The event 'AsynchronousPatternExample.PrimeNumberCalculator.ProgressChanged' is never used  
    warning CS0067: The event 'AsynchronousPatternExample.PrimeNumberCalculator.CalculatePrimeCompleted' is never used  
    ```  
  
     <span data-ttu-id="20b9b-138">Te ostrzeżenia dotyczące zostaną usunięte w następnej sekcji.</span><span class="sxs-lookup"><span data-stu-id="20b9b-138">These warnings will be cleared in the next section.</span></span>  
  
## <a name="defining-private-delegates"></a><span data-ttu-id="20b9b-139">Definiowanie obiektów delegowanych prywatnych</span><span class="sxs-lookup"><span data-stu-id="20b9b-139">Defining Private Delegates</span></span>  
 <span data-ttu-id="20b9b-140">Asynchroniczne aspektów `PrimeNumberCalculator` składnika są implementowane wewnętrznie z delegatem specjalne, znany jako <xref:System.Threading.SendOrPostCallback>.</span><span class="sxs-lookup"><span data-stu-id="20b9b-140">The asynchronous aspects of the `PrimeNumberCalculator` component are implemented internally with a special delegate known as a <xref:System.Threading.SendOrPostCallback>.</span></span> <span data-ttu-id="20b9b-141">A <xref:System.Threading.SendOrPostCallback> reprezentuje metodę wywołania zwrotnego, która wykonuje na <xref:System.Threading.ThreadPool> wątku.</span><span class="sxs-lookup"><span data-stu-id="20b9b-141">A <xref:System.Threading.SendOrPostCallback> represents a callback method that executes on a <xref:System.Threading.ThreadPool> thread.</span></span> <span data-ttu-id="20b9b-142">Metoda wywołania zwrotnego musi mieć podpisie, który przyjmuje jeden parametr typu <xref:System.Object>, co oznacza należy przekazać stanu między delegatów klasy otoki.</span><span class="sxs-lookup"><span data-stu-id="20b9b-142">The callback method must have a signature that takes a single parameter of type <xref:System.Object>, which means you will need to pass state among delegates in a wrapper class.</span></span> <span data-ttu-id="20b9b-143">Aby uzyskać więcej informacji, zobacz <xref:System.Threading.SendOrPostCallback>.</span><span class="sxs-lookup"><span data-stu-id="20b9b-143">For more information, see <xref:System.Threading.SendOrPostCallback>.</span></span>  
  
#### <a name="to-implement-your-components-internal-asynchronous-behavior"></a><span data-ttu-id="20b9b-144">Aby zaimplementować wewnętrzne zachowanie asynchroniczne danego składnika:</span><span class="sxs-lookup"><span data-stu-id="20b9b-144">To implement your component's internal asynchronous behavior:</span></span>  
  
1.  <span data-ttu-id="20b9b-145">Deklarowanie i tworzenie <xref:System.Threading.SendOrPostCallback> deleguje w `PrimeNumberCalculator` klasy.</span><span class="sxs-lookup"><span data-stu-id="20b9b-145">Declare and create the <xref:System.Threading.SendOrPostCallback> delegates in the `PrimeNumberCalculator` class.</span></span> <span data-ttu-id="20b9b-146">Utwórz <xref:System.Threading.SendOrPostCallback> obiektów w metodzie narzędzie `InitializeDelegates`.</span><span class="sxs-lookup"><span data-stu-id="20b9b-146">Create the <xref:System.Threading.SendOrPostCallback> objects in a utility method called `InitializeDelegates`.</span></span>  
  
     <span data-ttu-id="20b9b-147">Konieczne będzie dwóch delegatów: jeden dla raportowania postępu do klienta, a drugi dla raportowania uzupełniania do klienta.</span><span class="sxs-lookup"><span data-stu-id="20b9b-147">You will need two delegates: one for reporting progress to the client, and one for reporting completion to the client.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#9](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#9)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#9](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#9)]  
    [!code-csharp[System.ComponentModel.AsyncOperationManager#20](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#20)]
    [!code-vb[System.ComponentModel.AsyncOperationManager#20](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#20)]  
  
2.  <span data-ttu-id="20b9b-148">Wywołanie `InitializeDelegates` metody w Konstruktorze danego składnika.</span><span class="sxs-lookup"><span data-stu-id="20b9b-148">Call the `InitializeDelegates` method in your component's constructor.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#21](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#21)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#21](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#21)]  
  
3.  <span data-ttu-id="20b9b-149">Zadeklarować obiektu delegowanego w `PrimeNumberCalculator` klasa, która obsługuje rzeczywiste pracy asynchronicznie.</span><span class="sxs-lookup"><span data-stu-id="20b9b-149">Declare a delegate in the `PrimeNumberCalculator` class that handles the actual work to be done asynchronously.</span></span> <span data-ttu-id="20b9b-150">Ten delegat jest zawijana metody pracownika, który umożliwia sprawdzenie, czy liczba jest pierwsze.</span><span class="sxs-lookup"><span data-stu-id="20b9b-150">This delegate wraps the worker method that tests whether a number is prime.</span></span> <span data-ttu-id="20b9b-151">Delegat przyjmuje <xref:System.ComponentModel.AsyncOperation> parametr, który będzie służyć do śledzenia okres istnienia operację asynchroniczną.</span><span class="sxs-lookup"><span data-stu-id="20b9b-151">The delegate takes an <xref:System.ComponentModel.AsyncOperation> parameter, which will be used to track the lifetime of the asynchronous operation.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#22](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#22)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#22](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#22)]  
  
4.  <span data-ttu-id="20b9b-152">Utwórz kolekcję do zarządzania okresy istnienia oczekujących operacji asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="20b9b-152">Create a collection for managing lifetimes of pending asynchronous operations.</span></span> <span data-ttu-id="20b9b-153">Klient musi mieć możliwość śledzenia operacji są wykonane i ukończone, a to śledzenie odbywa się wymagając od klienta do przekazywania tokenu unikatowy lub identyfikator zadania, gdy klient wysyła wywołania do metody asynchronicznej.</span><span class="sxs-lookup"><span data-stu-id="20b9b-153">The client needs a way to track operations as they are executed and completed, and this tracking is done by requiring the client to pass a unique token, or task ID, when the client makes the call to the asynchronous method.</span></span> <span data-ttu-id="20b9b-154">`PrimeNumberCalculator` Składnika musi zachować informacje o każdym wywołaniu przez skojarzenie Identyfikatora zadania z odpowiedniego wywołania.</span><span class="sxs-lookup"><span data-stu-id="20b9b-154">The `PrimeNumberCalculator` component must keep track of each call by associating the task ID with its corresponding invocation.</span></span> <span data-ttu-id="20b9b-155">Jeśli klient przechodzi Identyfikatora zadania, która nie jest unikatowa, `PrimeNumberCalculator` składnika należy zgłosić wyjątek.</span><span class="sxs-lookup"><span data-stu-id="20b9b-155">If the client passes a task ID that is not unique, the `PrimeNumberCalculator` component must raise an exception.</span></span>  
  
     <span data-ttu-id="20b9b-156">`PrimeNumberCalculator` Składnika przechowuje informacje o identyfikatorze zadania przy użyciu klasy specjalne kolekcji o nazwie <xref:System.Collections.Specialized.HybridDictionary>.</span><span class="sxs-lookup"><span data-stu-id="20b9b-156">The `PrimeNumberCalculator` component keeps track of task ID by using a special collection class called a <xref:System.Collections.Specialized.HybridDictionary>.</span></span> <span data-ttu-id="20b9b-157">W definicji klasy, należy utworzyć <xref:System.Collections.Specialized.HybridDictionary> o nazwie `userTokenToLifetime`.</span><span class="sxs-lookup"><span data-stu-id="20b9b-157">In the class definition, create a <xref:System.Collections.Specialized.HybridDictionary> called `userTokenToLifetime`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#23](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#23)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#23](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#23)]  
  
## <a name="implementing-public-events"></a><span data-ttu-id="20b9b-158">Implementowanie zdarzenia publiczne</span><span class="sxs-lookup"><span data-stu-id="20b9b-158">Implementing Public Events</span></span>  
 <span data-ttu-id="20b9b-159">Składniki, które implementują wzorzec asynchroniczny oparty na zdarzeniach komunikują się klientów przy użyciu zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="20b9b-159">Components that implement the Event-based Asynchronous Pattern communicate to clients using events.</span></span> <span data-ttu-id="20b9b-160">Te zdarzenia są wywoływane w wątku prawidłowego za pomocą <xref:System.ComponentModel.AsyncOperation> klasy.</span><span class="sxs-lookup"><span data-stu-id="20b9b-160">These events are invoked on the proper thread with the help of the <xref:System.ComponentModel.AsyncOperation> class.</span></span>  
  
#### <a name="to-raise-events-to-your-components-clients"></a><span data-ttu-id="20b9b-161">Aby wywołać zdarzenia do danego składnika klientów:</span><span class="sxs-lookup"><span data-stu-id="20b9b-161">To raise events to your component's clients:</span></span>  
  
1.  <span data-ttu-id="20b9b-162">Implementuje publicznego zdarzeń do raportowania do klientów.</span><span class="sxs-lookup"><span data-stu-id="20b9b-162">Implement public events for reporting to clients.</span></span> <span data-ttu-id="20b9b-163">Konieczne będzie zdarzenia do raportowania postępu i jeden dla raportowania zakończenia.</span><span class="sxs-lookup"><span data-stu-id="20b9b-163">You will need an event for reporting progress and one for reporting completion.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#24](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#24)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#24](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#24)]  
  
## <a name="implementing-the-completion-method"></a><span data-ttu-id="20b9b-164">Implementacja metody ukończenia</span><span class="sxs-lookup"><span data-stu-id="20b9b-164">Implementing the Completion Method</span></span>  
 <span data-ttu-id="20b9b-165">Delegat zakończenia jest metody, wywołujący podstawowej, bezwątkowe zachowanie asynchronicznych po zakończeniu operacji asynchronicznej ukończone pomyślnie, błąd lub anulowania.</span><span class="sxs-lookup"><span data-stu-id="20b9b-165">The completion delegate is the method that the underlying, free-threaded asynchronous behavior will invoke when the asynchronous operation ends by successful completion, error, or cancellation.</span></span> <span data-ttu-id="20b9b-166">To wywołanie odbywa się dla dowolnego wątku.</span><span class="sxs-lookup"><span data-stu-id="20b9b-166">This invocation happens on an arbitrary thread.</span></span>  
  
 <span data-ttu-id="20b9b-167">Ta metoda jest, gdzie zadania o identyfikatorze klienta zostanie usunięty z wewnętrznej kolekcji tokeny unikatowych klientów.</span><span class="sxs-lookup"><span data-stu-id="20b9b-167">This method is where the client's task ID is removed from the internal collection of unique client tokens.</span></span> <span data-ttu-id="20b9b-168">Ta metoda kończy się okres istnienia określonej operacji asynchronicznej wywołując <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> metody w odpowiedniej <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="20b9b-168">This method also ends the lifetime of a particular asynchronous operation by calling the <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> method on the corresponding <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="20b9b-169">To wywołanie zgłasza zdarzenie ukończenia w wątku, który jest odpowiedni dla modelu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="20b9b-169">This call raises the completion event on the thread that is appropriate for the application model.</span></span> <span data-ttu-id="20b9b-170">Po <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> metoda jest wywoływana, to wystąpienie <xref:System.ComponentModel.AsyncOperation> nie mogą być używane, a wszystkie kolejne próby, aby użyć go spowoduje zgłoszenie wyjątku.</span><span class="sxs-lookup"><span data-stu-id="20b9b-170">After the <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> method is called, this instance of <xref:System.ComponentModel.AsyncOperation> can no longer be used, and any subsequent attempts to use it will throw an exception.</span></span>  
  
 <span data-ttu-id="20b9b-171">`CompletionMethod` Podpis musi, przytrzymaj wszystkich stanów będzie niezbędne do opisywania wynik operacji asynchronicznej.</span><span class="sxs-lookup"><span data-stu-id="20b9b-171">The `CompletionMethod` signature must hold all state necessary to describe the outcome of the asynchronous operation.</span></span> <span data-ttu-id="20b9b-172">Przechowuje stan liczba, która została testowała tej asynchronicznej operacji, czy jest pierwsze i wartość jego pierwszy dzielnik, jeśli nie jest liczba pierwsza.</span><span class="sxs-lookup"><span data-stu-id="20b9b-172">It holds state for the number that was tested by this particular asynchronous operation, whether the number is prime, and the value of its first divisor if it is not a prime number.</span></span> <span data-ttu-id="20b9b-173">Posiada opisujące każdy wyjątek, który wystąpił, stanu i <xref:System.ComponentModel.AsyncOperation> odpowiadający to konkretne zadanie.</span><span class="sxs-lookup"><span data-stu-id="20b9b-173">It also holds state describing any exception that occurred, and the <xref:System.ComponentModel.AsyncOperation> corresponding to this particular task.</span></span>  
  
#### <a name="to-complete-an-asynchronous-operation"></a><span data-ttu-id="20b9b-174">Aby zakończyć operację asynchroniczną:</span><span class="sxs-lookup"><span data-stu-id="20b9b-174">To complete an asynchronous operation:</span></span>  
  
-   <span data-ttu-id="20b9b-175">Implementuje metody ukończenia.</span><span class="sxs-lookup"><span data-stu-id="20b9b-175">Implement the completion method.</span></span> <span data-ttu-id="20b9b-176">Trwa sześć parametrów, których używa do wypełnienia `CalculatePrimeCompletedEventArgs` która jest zwracana do klienta przez klienta `CalculatePrimeCompletedEventHandler`.</span><span class="sxs-lookup"><span data-stu-id="20b9b-176">It takes six parameters, which it uses to populate a `CalculatePrimeCompletedEventArgs` that is returned to the client through the client's `CalculatePrimeCompletedEventHandler`.</span></span> <span data-ttu-id="20b9b-177">Usuwa token Identyfikatora zadania klienta z wewnętrznej kolekcji i zakończenia okresu istnienia operację asynchroniczną z wywołaniem do <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A>.</span><span class="sxs-lookup"><span data-stu-id="20b9b-177">It removes the client's task ID token from the internal collection, and it ends the asynchronous operation's lifetime with a call to <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A>.</span></span> <span data-ttu-id="20b9b-178"><xref:System.ComponentModel.AsyncOperation> Marshals wywołanie thread lub context, który jest odpowiedni dla modelu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="20b9b-178">The <xref:System.ComponentModel.AsyncOperation> marshals the call to the thread or context that is appropriate for the application model.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#26](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#26)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#26](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#26)]  
  
## <a name="checkpoint"></a><span data-ttu-id="20b9b-179">Punkt kontrolny</span><span class="sxs-lookup"><span data-stu-id="20b9b-179">Checkpoint</span></span>  
 <span data-ttu-id="20b9b-180">W tym momencie można utworzyć składnika.</span><span class="sxs-lookup"><span data-stu-id="20b9b-180">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="20b9b-181">Aby przetestować składnika</span><span class="sxs-lookup"><span data-stu-id="20b9b-181">To test your component</span></span>  
  
-   <span data-ttu-id="20b9b-182">Kompiluj składnika.</span><span class="sxs-lookup"><span data-stu-id="20b9b-182">Compile the component.</span></span>  
  
     <span data-ttu-id="20b9b-183">Zostanie wyświetlone ostrzeżenie kompilatora co:</span><span class="sxs-lookup"><span data-stu-id="20b9b-183">You will receive one compiler warning:</span></span>  
  
    ```  
    warning CS0169: The private field 'AsynchronousPatternExample.PrimeNumberCalculator.workerDelegate' is never used  
    ```  
  
     <span data-ttu-id="20b9b-184">To ostrzeżenie zostanie rozwiązany w następnej sekcji.</span><span class="sxs-lookup"><span data-stu-id="20b9b-184">This warning will be resolved in the next section.</span></span>  
  
## <a name="implementing-the-worker-methods"></a><span data-ttu-id="20b9b-185">Implementacja metody pracownika</span><span class="sxs-lookup"><span data-stu-id="20b9b-185">Implementing the Worker Methods</span></span>  
 <span data-ttu-id="20b9b-186">Do tej pory zaimplementowano obsługi kod asynchroniczne `PrimeNumberCalculator` składnika.</span><span class="sxs-lookup"><span data-stu-id="20b9b-186">So far, you have implemented the supporting asynchronous code for the `PrimeNumberCalculator` component.</span></span> <span data-ttu-id="20b9b-187">Teraz można wdrożyć kod, który wykonuje całą pracę.</span><span class="sxs-lookup"><span data-stu-id="20b9b-187">Now you can implement the code that does the actual work.</span></span> <span data-ttu-id="20b9b-188">Wdroży trzy metody: `CalculateWorker`, `BuildPrimeNumberList`, i `IsPrime`.</span><span class="sxs-lookup"><span data-stu-id="20b9b-188">You will implement three methods: `CalculateWorker`, `BuildPrimeNumberList`, and `IsPrime`.</span></span> <span data-ttu-id="20b9b-189">Razem `BuildPrimeNumberList` i `IsPrime` obejmują dobrze znanym algorytmem o nazwie sito Eratosthenes, która określa, czy liczba jest pierwsze znajdując liczb pierwszych maksymalnie pierwiastek kwadratowy liczby testów.</span><span class="sxs-lookup"><span data-stu-id="20b9b-189">Together, `BuildPrimeNumberList` and `IsPrime` comprise a well-known algorithm called the Sieve of Eratosthenes, which determines if a number is prime by finding all the prime numbers up to the square root of the test number.</span></span> <span data-ttu-id="20b9b-190">Jeśli nie zostaną znalezione nie divisors przez ten punkt, liczba testów jest pierwsze.</span><span class="sxs-lookup"><span data-stu-id="20b9b-190">If no divisors are found by that point, the test number is prime.</span></span>  
  
 <span data-ttu-id="20b9b-191">Ten składnik zostały napisane z maksymalną wydajnością, czy należy pamiętać liczb pierwszych odnalezione przez różnych wywołań numerów innego testu.</span><span class="sxs-lookup"><span data-stu-id="20b9b-191">If this component were written for maximum efficiency, it would remember all the prime numbers discovered by various invocations for different test numbers.</span></span> <span data-ttu-id="20b9b-192">Będzie on również sprawdzić trivial divisors jak 2, 3 i 5.</span><span class="sxs-lookup"><span data-stu-id="20b9b-192">It would also check for trivial divisors like 2, 3, and 5.</span></span> <span data-ttu-id="20b9b-193">Celem tego przykładu jest pokazują, jak czas operacji mogą być wykonywane asynchronicznie, jednak tak te optymalizacje pozostało jako wykonywania dla Ciebie.</span><span class="sxs-lookup"><span data-stu-id="20b9b-193">The intent of this example is to demonstrate how time-consuming operations can be executed asynchronously, however, so these optimizations are left as an exercise for you.</span></span>  
  
 <span data-ttu-id="20b9b-194">`CalculateWorker` Metody jest ujęte w delegata i została wywołana asynchronicznie przy wywołaniu `BeginInvoke`.</span><span class="sxs-lookup"><span data-stu-id="20b9b-194">The `CalculateWorker` method is wrapped in a delegate and is invoked asynchronously with a call to `BeginInvoke`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="20b9b-195">Raportowanie postępu jest zaimplementowana w `BuildPrimeNumberList` metody.</span><span class="sxs-lookup"><span data-stu-id="20b9b-195">Progress reporting is implemented in the `BuildPrimeNumberList` method.</span></span> <span data-ttu-id="20b9b-196">Na komputerach szybkiego `ProgressChanged` zdarzeń może być wywoływany w krótkim odstępie czasu.</span><span class="sxs-lookup"><span data-stu-id="20b9b-196">On fast computers, `ProgressChanged` events can be raised in rapid succession.</span></span> <span data-ttu-id="20b9b-197">Wątek klienta, na którym te zdarzenia są generowane, musi mieć możliwość obsługi tej sytuacji.</span><span class="sxs-lookup"><span data-stu-id="20b9b-197">The client thread, on which these events are raised, must be able to handle this situation.</span></span> <span data-ttu-id="20b9b-198">Kod interfejsu użytkownika może być przeciążony wiadomości i nie można przechowywać, co powoduje zachowanie wysunięcie.</span><span class="sxs-lookup"><span data-stu-id="20b9b-198">User interface code may be flooded with messages and unable to keep up, resulting in hanging behavior.</span></span> <span data-ttu-id="20b9b-199">Dla interfejsu użytkownika przykład obsługująca tej sytuacji, zobacz [porady: implementacja klienta wzorca asynchronicznego opartego na zdarzeniach](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="20b9b-199">For an example user interface that handles this situation, see [How to: Implement a Client of the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
#### <a name="to-execute-the-prime-number-calculation-asynchronously"></a><span data-ttu-id="20b9b-200">Można wykonać obliczania liczba pierwsza asynchronicznie:</span><span class="sxs-lookup"><span data-stu-id="20b9b-200">To execute the prime number calculation asynchronously:</span></span>  
  
1.  <span data-ttu-id="20b9b-201">Implementowanie `TaskCanceled` narzędzie metody.</span><span class="sxs-lookup"><span data-stu-id="20b9b-201">Implement the `TaskCanceled` utility method.</span></span> <span data-ttu-id="20b9b-202">To sprawdza kolekcji cykl życia zadania dla Identyfikatora danego zadania i zwraca `true` Jeżeli nie znaleziono Identyfikatora zadania.</span><span class="sxs-lookup"><span data-stu-id="20b9b-202">This checks the task lifetime collection for the given task ID, and returns `true` if the task ID is not found.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#32](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#32)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#32](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#32)]  
  
2.  <span data-ttu-id="20b9b-203">Implementowanie `CalculateWorker` metody.</span><span class="sxs-lookup"><span data-stu-id="20b9b-203">Implement the `CalculateWorker` method.</span></span> <span data-ttu-id="20b9b-204">Trwa dwa parametry: numer do testowania oraz usługi <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="20b9b-204">It takes two parameters: a number to test, and an <xref:System.ComponentModel.AsyncOperation>.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#27](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#27)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#27](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#27)]  
  
3.  <span data-ttu-id="20b9b-205">Implementowanie `BuildPrimeNumberList`.</span><span class="sxs-lookup"><span data-stu-id="20b9b-205">Implement `BuildPrimeNumberList`.</span></span> <span data-ttu-id="20b9b-206">Trwa dwa parametry: numer, aby przetestować i <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="20b9b-206">It takes two parameters: the number to test, and an <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="20b9b-207">Używa <xref:System.ComponentModel.AsyncOperation> raportu postęp i wyniki przyrostowe.</span><span class="sxs-lookup"><span data-stu-id="20b9b-207">It uses the <xref:System.ComponentModel.AsyncOperation> to report progress and incremental results.</span></span> <span data-ttu-id="20b9b-208">Gwarantuje to, że obsługi zdarzeń klienckich są nazywane na właściwy wątku lub kontekst dla modelu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="20b9b-208">This assures that the client's event handlers are called on the proper thread or context for the application model.</span></span> <span data-ttu-id="20b9b-209">Gdy `BuildPrimeNumberList` znajduje liczbę pierwszych, zgłasza to przyrostowe wyniku do klienta programu obsługi zdarzeń dla `ProgressChanged` zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="20b9b-209">When `BuildPrimeNumberList` finds a prime number, it reports this as an incremental result to the client's event handler for the `ProgressChanged` event.</span></span> <span data-ttu-id="20b9b-210">Wymaga to klasy pochodzącej od <xref:System.ComponentModel.ProgressChangedEventArgs>o nazwie `CalculatePrimeProgressChangedEventArgs`, która ma jeden dodawana właściwość o nazwie `LatestPrimeNumber`.</span><span class="sxs-lookup"><span data-stu-id="20b9b-210">This requires a class derived from <xref:System.ComponentModel.ProgressChangedEventArgs>, called `CalculatePrimeProgressChangedEventArgs`, which has one added property called `LatestPrimeNumber`.</span></span>  
  
     <span data-ttu-id="20b9b-211">`BuildPrimeNumberList` Okresowo wywołuje metodę `TaskCanceled` — metoda i wyjściach, jeśli metoda zwraca `true`.</span><span class="sxs-lookup"><span data-stu-id="20b9b-211">The `BuildPrimeNumberList` method also periodically calls the `TaskCanceled` method and exits if the method returns `true`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#5](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#5)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#5](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#5)]  
  
4.  <span data-ttu-id="20b9b-212">Implementowanie `IsPrime`.</span><span class="sxs-lookup"><span data-stu-id="20b9b-212">Implement `IsPrime`.</span></span> <span data-ttu-id="20b9b-213">Trwa trzy parametry: lista znanych liczb pierwszych, numer do testowania i parametru wyjściowego dla pierwszego dzielnik znaleziono.</span><span class="sxs-lookup"><span data-stu-id="20b9b-213">It takes three parameters: a list of known prime numbers, the number to test, and an output parameter for the first divisor found.</span></span> <span data-ttu-id="20b9b-214">Podana lista liczb pierwszych, jego Określa, czy kod testu jest pierwsze.</span><span class="sxs-lookup"><span data-stu-id="20b9b-214">Given the list of prime numbers, it determines if the test number is prime.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#28](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#28)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#28](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#28)]  
  
5.  <span data-ttu-id="20b9b-215">Pochodzi `CalculatePrimeProgressChangedEventArgs` z <xref:System.ComponentModel.ProgressChangedEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="20b9b-215">Derive `CalculatePrimeProgressChangedEventArgs` from <xref:System.ComponentModel.ProgressChangedEventArgs>.</span></span> <span data-ttu-id="20b9b-216">Ta klasa jest niezbędne do raportowania wyników przyrostowe do klienta programu obsługi zdarzeń dla `ProgressChanged` zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="20b9b-216">This class is necessary for reporting incremental results to the client's event handler for the `ProgressChanged` event.</span></span> <span data-ttu-id="20b9b-217">Ma on jeden dodanych właściwości o nazwie `LatestPrimeNumber`.</span><span class="sxs-lookup"><span data-stu-id="20b9b-217">It has one added property called `LatestPrimeNumber`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#29](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#29)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#29](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#29)]  
  
## <a name="checkpoint"></a><span data-ttu-id="20b9b-218">Punkt kontrolny</span><span class="sxs-lookup"><span data-stu-id="20b9b-218">Checkpoint</span></span>  
 <span data-ttu-id="20b9b-219">W tym momencie można utworzyć składnika.</span><span class="sxs-lookup"><span data-stu-id="20b9b-219">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="20b9b-220">Aby przetestować składnika</span><span class="sxs-lookup"><span data-stu-id="20b9b-220">To test your component</span></span>  
  
-   <span data-ttu-id="20b9b-221">Kompiluj składnika.</span><span class="sxs-lookup"><span data-stu-id="20b9b-221">Compile the component.</span></span>  
  
     <span data-ttu-id="20b9b-222">Wszystkie opcje, które pozostaną do zapisania są metody służące do uruchomienia i anulować operacji asynchronicznych `CalculatePrimeAsync` i `CancelAsync`.</span><span class="sxs-lookup"><span data-stu-id="20b9b-222">All that remains to be written are the methods to start and cancel asynchronous operations, `CalculatePrimeAsync` and `CancelAsync`.</span></span>  
  
## <a name="implementing-the-start-and-cancel-methods"></a><span data-ttu-id="20b9b-223">Implementacja punktu początkowego i metod Anuluj</span><span class="sxs-lookup"><span data-stu-id="20b9b-223">Implementing the Start and Cancel Methods</span></span>  
 <span data-ttu-id="20b9b-224">Start — metoda procesu roboczego w jego własnym wątku przez wywołanie metody `BeginInvoke` na delegata, który opakowuje go.</span><span class="sxs-lookup"><span data-stu-id="20b9b-224">You start the worker method on its own thread by calling `BeginInvoke` on the delegate that wraps it.</span></span> <span data-ttu-id="20b9b-225">Aby zarządzać okres istnienia określonej operacji asynchronicznej, należy wywołać <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> metoda <xref:System.ComponentModel.AsyncOperationManager> klasy pomocy.</span><span class="sxs-lookup"><span data-stu-id="20b9b-225">To manage the lifetime of a particular asynchronous operation, you call the <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> method on the <xref:System.ComponentModel.AsyncOperationManager> helper class.</span></span> <span data-ttu-id="20b9b-226">To polecenie zwróci <xref:System.ComponentModel.AsyncOperation>, który marshals wywołania dla klienta programu obsługi zdarzeń do właściwego thread lub context.</span><span class="sxs-lookup"><span data-stu-id="20b9b-226">This returns an <xref:System.ComponentModel.AsyncOperation>, which marshals calls on the client's event handlers to the proper thread or context.</span></span>  
  
 <span data-ttu-id="20b9b-227">Anuluj określonego oczekującą operację wywołując <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> na odpowiednie <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="20b9b-227">You cancel a particular pending operation by calling <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> on its corresponding <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="20b9b-228">Kończy operację tej i kolejnych wywołań jego <xref:System.ComponentModel.AsyncOperation> spowoduje zgłoszenie wyjątku.</span><span class="sxs-lookup"><span data-stu-id="20b9b-228">This ends that operation, and any subsequent calls to its <xref:System.ComponentModel.AsyncOperation> will throw an exception.</span></span>  
  
#### <a name="to-implement-start-and-cancel-functionality"></a><span data-ttu-id="20b9b-229">Aby zaimplementować Start i anulować funkcji:</span><span class="sxs-lookup"><span data-stu-id="20b9b-229">To implement Start and Cancel functionality:</span></span>  
  
1.  <span data-ttu-id="20b9b-230">Implementowanie `CalculatePrimeAsync` metody.</span><span class="sxs-lookup"><span data-stu-id="20b9b-230">Implement the `CalculatePrimeAsync` method.</span></span> <span data-ttu-id="20b9b-231">Upewnij się, że token dostarczony przez klienta (identyfikator zadania) jest unikatowa względem wszystkich tokenów reprezentujący aktualnie oczekujących zadań.</span><span class="sxs-lookup"><span data-stu-id="20b9b-231">Make sure the client-supplied token (task ID) is unique with respect to all the tokens representing currently pending tasks.</span></span> <span data-ttu-id="20b9b-232">Jeśli klient przechodzi do tokenu nie jest unikatowa, `CalculatePrimeAsync` zgłasza wyjątek.</span><span class="sxs-lookup"><span data-stu-id="20b9b-232">If the client passes in a non-unique token, `CalculatePrimeAsync` raises an exception.</span></span> <span data-ttu-id="20b9b-233">W przeciwnym razie wartość tokenu jest dodawany do kolekcji identyfikator zadania.</span><span class="sxs-lookup"><span data-stu-id="20b9b-233">Otherwise, the token is added to the task ID collection.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#3](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#3)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#3](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#3)]  
  
2.  <span data-ttu-id="20b9b-234">Implementowanie `CancelAsync` metody.</span><span class="sxs-lookup"><span data-stu-id="20b9b-234">Implement the `CancelAsync` method.</span></span> <span data-ttu-id="20b9b-235">Jeśli `taskId` parametr istnieje w kolekcji tokenu, zostanie ono usunięte.</span><span class="sxs-lookup"><span data-stu-id="20b9b-235">If the `taskId` parameter exists in the token collection, it is removed.</span></span> <span data-ttu-id="20b9b-236">Zapobiega to anulowanych zadań, które nie rozpoczęły uruchamianie.</span><span class="sxs-lookup"><span data-stu-id="20b9b-236">This prevents canceled tasks that have not started from running.</span></span> <span data-ttu-id="20b9b-237">Jeśli zadanie jest uruchomione, `BuildPrimeNumberList` — metoda kończy działanie, gdy wykryje, że identyfikator zadania został usunięty z kolekcji okres istnienia.</span><span class="sxs-lookup"><span data-stu-id="20b9b-237">If the task is running, the `BuildPrimeNumberList` method exits when it detects that the task ID has been removed from the lifetime collection.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#4](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#4)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#4](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#4)]  
  
## <a name="checkpoint"></a><span data-ttu-id="20b9b-238">Punkt kontrolny</span><span class="sxs-lookup"><span data-stu-id="20b9b-238">Checkpoint</span></span>  
 <span data-ttu-id="20b9b-239">W tym momencie można utworzyć składnika.</span><span class="sxs-lookup"><span data-stu-id="20b9b-239">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="20b9b-240">Aby przetestować składnika</span><span class="sxs-lookup"><span data-stu-id="20b9b-240">To test your component</span></span>  
  
-   <span data-ttu-id="20b9b-241">Kompiluj składnika.</span><span class="sxs-lookup"><span data-stu-id="20b9b-241">Compile the component.</span></span>  
  
 <span data-ttu-id="20b9b-242">`PrimeNumberCalculator` Składnika jest teraz gotowy do użycia.</span><span class="sxs-lookup"><span data-stu-id="20b9b-242">The `PrimeNumberCalculator` component is now complete and ready to use.</span></span>  
  
 <span data-ttu-id="20b9b-243">Na przykład klienta, który używa `PrimeNumberCalculator` składników, zobacz [porady: implementacja klienta wzorca asynchronicznego opartego na zdarzeniach](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="20b9b-243">For an example client that uses the `PrimeNumberCalculator` component, see [How to: Implement a Client of the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="20b9b-244">Następne kroki</span><span class="sxs-lookup"><span data-stu-id="20b9b-244">Next Steps</span></span>  
 <span data-ttu-id="20b9b-245">Możesz też wypełnić w tym przykładzie pisząc `CalculatePrime`, synchroniczne odpowiednikiem `CalculatePrimeAsync` metody.</span><span class="sxs-lookup"><span data-stu-id="20b9b-245">You can fill out this example by writing `CalculatePrime`, the synchronous equivalent of `CalculatePrimeAsync` method.</span></span> <span data-ttu-id="20b9b-246">Spowoduje to `PrimeNumberCalculator` składnika w pełni zgodne, za pomocą wzorca asynchronicznego opartego na zdarzeniach.</span><span class="sxs-lookup"><span data-stu-id="20b9b-246">This will make the `PrimeNumberCalculator` component fully compliant with the Event-based Asynchronous Pattern.</span></span>  
  
 <span data-ttu-id="20b9b-247">W tym przykładzie można zwiększyć, zachowując listy liczb pierwszych odnalezione przez różnych wywołań numerów innego testu.</span><span class="sxs-lookup"><span data-stu-id="20b9b-247">You can improve this example by retaining the list of all the prime numbers discovered by various invocations for different test numbers.</span></span> <span data-ttu-id="20b9b-248">W ten sposób każdego zadania będą korzystać z pracy wykonanej przez poprzednich zadań.</span><span class="sxs-lookup"><span data-stu-id="20b9b-248">Using this approach, each task will benefit from the work done by previous tasks.</span></span> <span data-ttu-id="20b9b-249">Chroń tej listy z `lock` regionach, więc jest serializowany dostęp do listy przez inne wątki.</span><span class="sxs-lookup"><span data-stu-id="20b9b-249">Be careful to protect this list with `lock` regions, so access to the list by different threads is serialized.</span></span>  
  
 <span data-ttu-id="20b9b-250">W tym przykładzie można również poprawić przez testowanie pod kątem trivial divisors, takie jak 2, 3 i 5.</span><span class="sxs-lookup"><span data-stu-id="20b9b-250">You can also improve this example by testing for trivial divisors, like 2, 3, and 5.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="20b9b-251">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="20b9b-251">See Also</span></span>  
 [<span data-ttu-id="20b9b-252">Instrukcje: uruchamianie operacji w tle</span><span class="sxs-lookup"><span data-stu-id="20b9b-252">How to: Run an Operation in the Background</span></span>](../../../docs/framework/winforms/controls/how-to-run-an-operation-in-the-background.md)  
 [<span data-ttu-id="20b9b-253">Asynchroniczny wzorzec oparty na zdarzeniach — omówienie</span><span class="sxs-lookup"><span data-stu-id="20b9b-253">Event-based Asynchronous Pattern Overview</span></span>](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md)  
 [<span data-ttu-id="20b9b-254">NIE w kompilacji: Wielowątkowość w języku Visual Basic</span><span class="sxs-lookup"><span data-stu-id="20b9b-254">NOT IN BUILD: Multithreading in Visual Basic</span></span>](http://msdn.microsoft.com/en-us/c731a50c-09c1-4468-9646-54c86b75d269)  
 [<span data-ttu-id="20b9b-255">Instrukcje: Implementacja składnika obsługującego wzorzec asynchroniczny oparty na zdarzeniach</span><span class="sxs-lookup"><span data-stu-id="20b9b-255">How to: Implement a Component That Supports the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md)  
 [<span data-ttu-id="20b9b-256">Programowanie wielowątkowości za pomocą wzorca asynchronicznego opartego na zdarzeniach</span><span class="sxs-lookup"><span data-stu-id="20b9b-256">Multithreaded Programming with the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/multithreaded-programming-with-the-event-based-asynchronous-pattern.md)
