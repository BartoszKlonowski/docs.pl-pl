---
title: Wzorzec projektowy obserwatora — Najlepsze praktyki
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- observer design pattern [.NET Framework], best practices
- best practices [.NET Framework], observer design pattern
ms.assetid: c834760f-ddd4-417f-abb7-a059679d5b8c
ms.openlocfilehash: 2da29e0baf429142707d0ddd39b1a11c13a17a90
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/15/2020
ms.locfileid: "73141540"
---
# <a name="observer-design-pattern-best-practices"></a><span data-ttu-id="3e1fa-102">Wzorzec projektowy obserwatora — Najlepsze praktyki</span><span class="sxs-lookup"><span data-stu-id="3e1fa-102">Observer Design Pattern Best Practices</span></span>
<span data-ttu-id="3e1fa-103">W .NET Framework wzorzec projektowania obserwatora jest implementowany jako zestaw interfejsów.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-103">In the .NET Framework, the observer design pattern is implemented as a set of interfaces.</span></span> <span data-ttu-id="3e1fa-104">Interfejs <xref:System.IObservable%601?displayProperty=nameWithType> reprezentuje dostawcę danych, który jest również <xref:System.IDisposable> odpowiedzialny za zapewnienie implementacji, która pozwala obserwatorom anulować subskrypcję powiadomień.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-104">The <xref:System.IObservable%601?displayProperty=nameWithType> interface represents the data provider, which is also responsible for providing an <xref:System.IDisposable> implementation that lets observers unsubscribe from notifications.</span></span> <span data-ttu-id="3e1fa-105">Interfejs <xref:System.IObserver%601?displayProperty=nameWithType> reprezentuje obserwatora.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-105">The <xref:System.IObserver%601?displayProperty=nameWithType> interface represents the observer.</span></span> <span data-ttu-id="3e1fa-106">W tym temacie opisano najlepsze rozwiązania, które deweloperzy powinni przestrzegać podczas implementowania wzorca projektu obserwatora przy użyciu tych interfejsów.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-106">This topic describes the best practices that developers should follow when implementing the observer design pattern using these interfaces.</span></span>  
  
## <a name="threading"></a><span data-ttu-id="3e1fa-107">Wątkowość</span><span class="sxs-lookup"><span data-stu-id="3e1fa-107">Threading</span></span>  
 <span data-ttu-id="3e1fa-108">Zazwyczaj dostawca implementuje <xref:System.IObservable%601.Subscribe%2A?displayProperty=nameWithType> metodę, dodając określonego obserwatora do listy subskrybentów, który jest reprezentowany przez <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> niektóre obiektu kolekcji i implementuje metodę, usuwając określonego obserwatora z listy subskrybentów.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-108">Typically, a provider implements the <xref:System.IObservable%601.Subscribe%2A?displayProperty=nameWithType> method by adding a particular observer to a subscriber list that is represented by some collection object, and it implements the <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> method by removing a particular observer from the subscriber list.</span></span> <span data-ttu-id="3e1fa-109">Obserwator może wywołać te metody w dowolnym momencie.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-109">An observer can call these methods at any time.</span></span> <span data-ttu-id="3e1fa-110">Ponadto ponieważ umowy provider/observer nie określa, kto jest odpowiedzialny za <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType> wypisanie subskrypcji po metodzie wywołania wywołania, dostawca i obserwator może zarówno spróbować usunąć tego samego członka z listy.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-110">In addition, because the provider/observer contract does not specify who is responsible for unsubscribing after the <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType> callback method, the provider and observer may both try to remove the same member from the list.</span></span> <span data-ttu-id="3e1fa-111">Ze względu na tę <xref:System.IObservable%601.Subscribe%2A> <xref:System.IDisposable.Dispose%2A> możliwość, zarówno i metody powinny być bezpieczne dla wątków.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-111">Because of this possibility, both the <xref:System.IObservable%601.Subscribe%2A> and <xref:System.IDisposable.Dispose%2A> methods should be thread-safe.</span></span> <span data-ttu-id="3e1fa-112">Zazwyczaj wiąże się to przy użyciu [kolekcji równoczesnych](../../../docs/standard/parallel-programming/data-structures-for-parallel-programming.md) lub blokady.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-112">Typically, this involves using a [concurrent collection](../../../docs/standard/parallel-programming/data-structures-for-parallel-programming.md) or a lock.</span></span> <span data-ttu-id="3e1fa-113">Implementacje, które nie są bezpieczne dla wątków należy jawnie dokument, że nie są.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-113">Implementations that are not thread-safe should explicitly document that they are not.</span></span>  
  
 <span data-ttu-id="3e1fa-114">Wszelkie dodatkowe gwarancje muszą być określone w warstwie na podstawie umowy dostawcy/obserwatora.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-114">Any additional guarantees have to be specified in a layer on top of the provider/observer contract.</span></span> <span data-ttu-id="3e1fa-115">Realizatorzy powinni wyraźnie wywołać, gdy nakładają dodatkowe wymagania, aby uniknąć nieporozumień użytkownika na temat umowy obserwatora.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-115">Implementers should clearly call out when they impose additional requirements to avoid user confusion about the observer contract.</span></span>  
  
## <a name="handling-exceptions"></a><span data-ttu-id="3e1fa-116">Obsługa wyjątków</span><span class="sxs-lookup"><span data-stu-id="3e1fa-116">Handling Exceptions</span></span>  
 <span data-ttu-id="3e1fa-117">Ze względu na luźne sprzężenie między dostawcą danych a obserwatorem wyjątki w wzorcu projektowania obserwatora mają być informacyjne.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-117">Because of the loose coupling between a data provider and an observer, exceptions in the observer design pattern are intended to be informational.</span></span> <span data-ttu-id="3e1fa-118">Ma to wpływ na sposób, w jaki dostawcy i obserwatorzy obsługują wyjątki w wzorzec projektowania obserwatora.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-118">This affects how providers and observers handle exceptions in the observer design pattern.</span></span>  
  
### <a name="the-provider----calling-the-onerror-method"></a><span data-ttu-id="3e1fa-119">Dostawca - Wywołanie OnError Metoda</span><span class="sxs-lookup"><span data-stu-id="3e1fa-119">The Provider -- Calling the OnError Method</span></span>  
 <span data-ttu-id="3e1fa-120">Metoda <xref:System.IObserver%601.OnError%2A> jest przeznaczona jako komunikat informacyjny dla obserwatorów, podobnie jak <xref:System.IObserver%601.OnNext%2A?displayProperty=nameWithType> metoda.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-120">The <xref:System.IObserver%601.OnError%2A> method is intended as an informational message to observers, much like the <xref:System.IObserver%601.OnNext%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="3e1fa-121">Jednak <xref:System.IObserver%601.OnNext%2A> metoda jest przeznaczona do zapewnienia obserwatorowi bieżących lub <xref:System.IObserver%601.OnError%2A> zaktualizowanych danych, podczas gdy metoda ma na celu wskazanie, że dostawca nie jest w stanie podać prawidłowych danych.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-121">However, the <xref:System.IObserver%601.OnNext%2A> method is designed to provide an observer with current or updated data, whereas the <xref:System.IObserver%601.OnError%2A> method is designed to indicate that the provider is unable to provide valid data.</span></span>  
  
 <span data-ttu-id="3e1fa-122">Dostawca powinien postępować zgodnie z następującymi <xref:System.IObserver%601.OnError%2A> najlepszymi rozwiązaniami podczas obsługi wyjątków i wywoływania metody:</span><span class="sxs-lookup"><span data-stu-id="3e1fa-122">The provider should follow these best practices when handling exceptions and calling the <xref:System.IObserver%601.OnError%2A> method:</span></span>  
  
- <span data-ttu-id="3e1fa-123">Dostawca musi obsługiwać własne wyjątki, jeśli ma jakieś szczególne wymagania.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-123">The provider must handle its own exceptions if it has any specific requirements.</span></span>  
  
- <span data-ttu-id="3e1fa-124">Dostawca nie powinien oczekiwać lub wymagać, aby obserwatorzy obsługili wyjątki w określony sposób.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-124">The provider should not expect or require that observers handle exceptions in any particular way.</span></span>  
  
- <span data-ttu-id="3e1fa-125">Dostawca powinien wywołać <xref:System.IObserver%601.OnError%2A> metodę, gdy obsługuje wyjątek, który zagraża jego zdolność do dostarczania aktualizacji.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-125">The provider should call the <xref:System.IObserver%601.OnError%2A> method when it handles an exception that compromises its ability to provide updates.</span></span> <span data-ttu-id="3e1fa-126">Informacje na temat takich wyjątków mogą być przekazywane obserwatorowi.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-126">Information on such exceptions can be passed to the observer.</span></span> <span data-ttu-id="3e1fa-127">W innych przypadkach nie ma potrzeby powiadamiania obserwatorów o wyjątku.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-127">In other cases, there is no need to notify observers of an exception.</span></span>  
  
 <span data-ttu-id="3e1fa-128">Gdy dostawca wywołuje <xref:System.IObserver%601.OnError%2A> <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType> lub metody, nie powinno być żadnych dalszych powiadomień, a dostawca może anulować subskrypcję swoich obserwatorów.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-128">Once the provider calls the <xref:System.IObserver%601.OnError%2A> or <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType> method, there should be no further notifications, and the provider can unsubscribe its observers.</span></span> <span data-ttu-id="3e1fa-129">Obserwatorzy mogą jednak zrezygnować z subskrypcji w dowolnym momencie, <xref:System.IObserver%601.OnError%2A> w <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType> tym zarówno przed otrzymaniem powiadomienia lub powiadomienia, jak i po otrzymaniu powiadomienia.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-129">However, the observers can also unsubscribe themselves at any time, including both before and after they receive an <xref:System.IObserver%601.OnError%2A> or <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType> notification.</span></span> <span data-ttu-id="3e1fa-130">Wzorzec projektowania obserwatora nie dyktuje, czy dostawca lub obserwator jest odpowiedzialny za wypisanie subskrypcji; w związku z tym istnieje możliwość, że oba mogą próbować zrezygnować z subskrypcji.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-130">The observer design pattern does not dictate whether the provider or the observer is responsible for unsubscribing; therefore, there is a possibility that both may attempt to unsubscribe.</span></span> <span data-ttu-id="3e1fa-131">Zazwyczaj gdy obserwatorzy anulują subskrypcję, są usuwani z kolekcji subskrybentów.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-131">Typically, when observers unsubscribe, they are removed from a subscribers collection.</span></span> <span data-ttu-id="3e1fa-132">W aplikacji jednowątkowej <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> implementacji należy upewnić się, że odwołanie do obiektu jest prawidłowy i że obiekt jest członkiem kolekcji subskrybentów przed podjęciem próby usunięcia go.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-132">In a single-threaded application, the <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> implementation should ensure that an object reference is valid and that the object is a member of the subscribers collection before attempting to remove it.</span></span> <span data-ttu-id="3e1fa-133">W aplikacji wielowątkowej należy użyć obiektu kolekcji bezpiecznego dla wątków, takiego jak <xref:System.Collections.Concurrent.BlockingCollection%601?displayProperty=nameWithType> obiekt.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-133">In a multithreaded application, a thread-safe collection object, such as a <xref:System.Collections.Concurrent.BlockingCollection%601?displayProperty=nameWithType> object, should be used.</span></span>  
  
### <a name="the-observer----implementing-the-onerror-method"></a><span data-ttu-id="3e1fa-134">Obserwator - Implementacja OnError Metoda</span><span class="sxs-lookup"><span data-stu-id="3e1fa-134">The Observer -- Implementing the OnError Method</span></span>  
 <span data-ttu-id="3e1fa-135">Gdy obserwator otrzymuje powiadomienie o błędzie od dostawcy, obserwator powinien traktować wyjątek jako informacyjny i nie powinien być zobowiązany do podjęcia żadnych szczególnych działań.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-135">When an observer receives an error notification from a provider, the observer should treat the exception as informational and should not be required to take any particular action.</span></span>  
  
 <span data-ttu-id="3e1fa-136">Obserwator powinien postępować zgodnie z <xref:System.IObserver%601.OnError%2A> tymi najlepszymi rozwiązaniami podczas odpowiadania na wywołanie metody od dostawcy:</span><span class="sxs-lookup"><span data-stu-id="3e1fa-136">The observer should follow these best practices when responding to an <xref:System.IObserver%601.OnError%2A> method call from a provider:</span></span>  
  
- <span data-ttu-id="3e1fa-137">Obserwator nie powinien zgłaszać wyjątków od implementacji interfejsu, takich jak <xref:System.IObserver%601.OnNext%2A> lub <xref:System.IObserver%601.OnError%2A>.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-137">The observer should not throw exceptions from its interface implementations, such as <xref:System.IObserver%601.OnNext%2A> or <xref:System.IObserver%601.OnError%2A>.</span></span> <span data-ttu-id="3e1fa-138">Jednak jeśli obserwator zgłasza wyjątki, należy oczekiwać, że te wyjątki, aby przejść nieobsługiwane.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-138">However, if the observer does throw exceptions, it should expect these exceptions to go unhandled.</span></span>  
  
- <span data-ttu-id="3e1fa-139">Aby zachować stos wywołań, obserwator, który chce zgłosić <xref:System.Exception> obiekt, który został przekazany do jego <xref:System.IObserver%601.OnError%2A> metody należy zawinąć wyjątek przed jego zgłaszaniem.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-139">To preserve the call stack, an observer that wishes to throw an <xref:System.Exception> object that was passed to its <xref:System.IObserver%601.OnError%2A> method should wrap the exception before throwing it.</span></span> <span data-ttu-id="3e1fa-140">W tym celu należy użyć standardowego obiektu wyjątku.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-140">A standard exception object should be used for this purpose.</span></span>  
  
## <a name="additional-best-practices"></a><span data-ttu-id="3e1fa-141">Dodatkowe najlepsze wskazówki</span><span class="sxs-lookup"><span data-stu-id="3e1fa-141">Additional Best Practices</span></span>  
 <span data-ttu-id="3e1fa-142">Próba wyrejestrowania <xref:System.IObservable%601.Subscribe%2A?displayProperty=nameWithType> w metodzie może spowodować odwołanie null.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-142">Attempting to unregister in the <xref:System.IObservable%601.Subscribe%2A?displayProperty=nameWithType> method may result in a null reference.</span></span> <span data-ttu-id="3e1fa-143">Dlatego zaleca się, aby uniknąć tej praktyki.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-143">Therefore, we recommend that you avoid this practice.</span></span>  
  
 <span data-ttu-id="3e1fa-144">Mimo że można dołączyć obserwatora do wielu dostawców, zalecany wzorzec jest dołączenie wystąpienia <xref:System.IObserver%601> tylko do jednego <xref:System.IObservable%601> wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="3e1fa-144">Although it is possible to attach an observer to multiple providers, the recommended pattern is to attach an <xref:System.IObserver%601> instance to only one <xref:System.IObservable%601> instance.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="3e1fa-145">Zobacz też</span><span class="sxs-lookup"><span data-stu-id="3e1fa-145">See also</span></span>

- [<span data-ttu-id="3e1fa-146">Wzorzec projektowy obserwatora</span><span class="sxs-lookup"><span data-stu-id="3e1fa-146">Observer Design Pattern</span></span>](../../../docs/standard/events/observer-design-pattern.md)
- [<span data-ttu-id="3e1fa-147">Instrukcje: Implementowanie obserwatora</span><span class="sxs-lookup"><span data-stu-id="3e1fa-147">How to: Implement an Observer</span></span>](../../../docs/standard/events/how-to-implement-an-observer.md)
- [<span data-ttu-id="3e1fa-148">Instrukcje: Implementowanie dostawcy</span><span class="sxs-lookup"><span data-stu-id="3e1fa-148">How to: Implement a Provider</span></span>](../../../docs/standard/events/how-to-implement-a-provider.md)
