---
title: Transakcje
ms.date: 09/08/2020
description: Dowiedz się, jak używać transakcji.
ms.openlocfilehash: 50c4cd1023eac892cafc3ae4395e9168bd8e9f36
ms.sourcegitcommit: aa6d8a90a4f5d8fe0f6e967980b8c98433f05a44
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 09/16/2020
ms.locfileid: "90678865"
---
# <a name="transactions"></a><span data-ttu-id="f6f0d-103">Transakcje</span><span class="sxs-lookup"><span data-stu-id="f6f0d-103">Transactions</span></span>

<span data-ttu-id="f6f0d-104">Transakcje umożliwiają grupowanie wielu instrukcji SQL w jednej jednostce pracy, która jest zatwierdzona do bazy danych jako jedną jednostką niepodzielną.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-104">Transactions let you group multiple SQL statements into a single unit of work that is committed to the database as one atomic unit.</span></span> <span data-ttu-id="f6f0d-105">Jeśli jakakolwiek instrukcja w transakcji nie powiedzie się, zmiany wprowadzone przez poprzednie instrukcje można wycofać.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-105">If any statement in the transaction fails, changes made by the previous statements can be rolled back.</span></span> <span data-ttu-id="f6f0d-106">Początkowy stan bazy danych, gdy transakcja została uruchomiona, jest zachowywany.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-106">The initial state of the database when the transaction was started is preserved.</span></span> <span data-ttu-id="f6f0d-107">Korzystanie z transakcji może również zwiększyć wydajność na konferencji SQLite podczas jednoczesnego wprowadzania wielu zmian w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-107">Using a transaction can also improve performance on SQLite when making numerous changes to the database at once.</span></span>

## <a name="concurrency"></a><span data-ttu-id="f6f0d-108">Współbieżność</span><span class="sxs-lookup"><span data-stu-id="f6f0d-108">Concurrency</span></span>

<span data-ttu-id="f6f0d-109">W przypadku oprogramowania SQLite w danej chwili w bazie danych może istnieć tylko jedna transakcja oczekująca na zmianę.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-109">In SQLite, only one transaction is allowed to have changes pending in the database at a time.</span></span> <span data-ttu-id="f6f0d-110">Z tego powodu wywołania <xref:Microsoft.Data.Sqlite.SqliteConnection.BeginTransaction%2A> i `Execute` metody w programie <xref:Microsoft.Data.Sqlite.SqliteCommand> mogą przekroczyć limit czasu, jeśli wykonywanie innej transakcji trwa zbyt długo.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-110">Because of this, calls to <xref:Microsoft.Data.Sqlite.SqliteConnection.BeginTransaction%2A> and the `Execute` methods on <xref:Microsoft.Data.Sqlite.SqliteCommand> may time out if another transaction takes too long to complete.</span></span>

<span data-ttu-id="f6f0d-111">Aby uzyskać więcej informacji na temat blokowania, ponawiania prób i przekroczeń limitu czasu, zobacz [Błędy bazy danych](database-errors.md).</span><span class="sxs-lookup"><span data-stu-id="f6f0d-111">For more information about locking, retries, and timeouts, see [Database errors](database-errors.md).</span></span>

## <a name="isolation-levels"></a><span data-ttu-id="f6f0d-112">Poziomy izolacji</span><span class="sxs-lookup"><span data-stu-id="f6f0d-112">Isolation levels</span></span>

<span data-ttu-id="f6f0d-113">Transakcje są domyślnie **serializowane** w programie SQLite.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-113">Transactions are **serializable** by default in SQLite.</span></span> <span data-ttu-id="f6f0d-114">Ten poziom izolacji gwarantuje, że wszelkie zmiany wprowadzone w ramach transakcji są całkowicie odizolowane.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-114">This isolation level guarantees that any changes made within a transaction are completely isolated.</span></span> <span data-ttu-id="f6f0d-115">Zmiany transakcji nie wpływają na inne instrukcje wykonywane poza transakcją.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-115">Other statements executed outside of the transaction aren't affected by the transaction's changes.</span></span>

<span data-ttu-id="f6f0d-116">W przypadku korzystania z udostępnionej pamięci podręcznej program SQLite obsługuje także **Odczyt niezatwierdzony** .</span><span class="sxs-lookup"><span data-stu-id="f6f0d-116">SQLite also supports **read uncommitted** when using a shared cache.</span></span> <span data-ttu-id="f6f0d-117">Ten poziom umożliwia odczyty zanieczyszczone, odczyty niepowtarzalne i fantomy:</span><span class="sxs-lookup"><span data-stu-id="f6f0d-117">This level allows dirty reads, nonrepeatable reads, and phantoms:</span></span>

- <span data-ttu-id="f6f0d-118">*Nieprzeczytany odczyt* występuje, gdy zmiany oczekujące w jednej transakcji są zwracane przez zapytanie poza transakcją, ale zmiany transakcji są wycofywane.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-118">A *dirty read* occurs when changes pending in one transaction are returned by a query outside of the transaction, but the changes in the transaction are rolled back.</span></span> <span data-ttu-id="f6f0d-119">Wyniki zawierają dane, które nigdy nie zostały przekazane do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-119">The results contain data that was never actually committed to the database.</span></span>

- <span data-ttu-id="f6f0d-120">Odczyt, który nie jest *powtarzany* , występuje, gdy transakcja kwerendy tego samego wiersza dwa razy, ale wyniki są różne, ponieważ zostały zmienione przez inną transakcję.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-120">A *nonrepeatable read* occurs when a transaction queries same row twice, but the results are different because it was changed between the two queries by another transaction.</span></span>

- <span data-ttu-id="f6f0d-121">*Fantomy* to wiersze, które są zmieniane lub dodawane, aby spełniały klauzulę WHERE zapytania podczas transakcji.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-121">*Phantoms* are rows that get changed or added to meet the where clause of a query during a transaction.</span></span> <span data-ttu-id="f6f0d-122">Jeśli jest to dozwolone, to samo zapytanie może zwracać różne wiersze, gdy są wykonywane dwa razy w tej samej transakcji.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-122">If allowed, the same query could return different rows when executed twice in the same transaction.</span></span>

<span data-ttu-id="f6f0d-123">Microsoft. Data. sqlite traktuje IsolationLevel <xref:Microsoft.Data.Sqlite.SqliteConnection.BeginTransaction%2A> jako poziom minimalny.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-123">Microsoft.Data.Sqlite treats the IsolationLevel passed to <xref:Microsoft.Data.Sqlite.SqliteConnection.BeginTransaction%2A> as a minimum level.</span></span> <span data-ttu-id="f6f0d-124">Rzeczywisty poziom izolacji zostanie podwyższony do odczytu niezatwierdzonego lub możliwego do serializacji.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-124">The actual isolation level will be promoted to either read uncommitted or serializable.</span></span>

<span data-ttu-id="f6f0d-125">Poniższy kod symuluje przeczytanie zanieczyszczone.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-125">The following code simulates a dirty read.</span></span> <span data-ttu-id="f6f0d-126">Należy pamiętać, że parametry połączenia muszą zawierać `Cache=Shared` .</span><span class="sxs-lookup"><span data-stu-id="f6f0d-126">Note, the connection string must include `Cache=Shared`.</span></span>

[!code-csharp[](../../../../samples/snippets/standard/data/sqlite/DirtyReadSample/Program.cs?name=snippet_DirtyRead)]

## <a name="deferred-transactions"></a><span data-ttu-id="f6f0d-127">Odroczone transakcje</span><span class="sxs-lookup"><span data-stu-id="f6f0d-127">Deferred transactions</span></span>

<span data-ttu-id="f6f0d-128">Począwszy od firmy Microsoft. Data. sqlite w wersji 5,0, można odroczyć transakcje.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-128">Starting with Microsoft.Data.Sqlite version 5.0, transactions can be deferred.</span></span> <span data-ttu-id="f6f0d-129">W ten sposób zostanie wykonane tworzenie rzeczywistej transakcji w bazie danych do momentu wykonania pierwszego polecenia.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-129">This defers the creation of the actual transaction in the database until the first command is executed.</span></span> <span data-ttu-id="f6f0d-130">Powoduje to również, że transakcja jest stopniowo uaktualniana z transakcji odczytu do transakcji zapisu, zgodnie z wymaganiami poleceń.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-130">It also causes the transaction to gradually upgrade from a read transaction to a write transaction as needed by its commands.</span></span> <span data-ttu-id="f6f0d-131">Może to być przydatne w przypadku włączania współbieżnego dostępu do bazy danych podczas transakcji.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-131">This can be useful for enabling concurrent access to the database during the transaction.</span></span>

[!code-csharp[](../../../../samples/snippets/standard/data/sqlite/DeferredTransactionSample/Program.cs?name=snippet_DeferredTransaction)]

> [!WARNING]
> <span data-ttu-id="f6f0d-132">Polecenia wewnątrz odroczonej transakcji mogą się nie powieść, jeśli powodują, że transakcja zostanie uaktualniona z transakcji odczytu do transakcji zapisu, gdy baza danych jest zablokowana.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-132">Commands inside a deferred transaction can fail if they cause the transaction to be upgraded from a read transaction to a write transaction while the database is locked.</span></span> <span data-ttu-id="f6f0d-133">W takim przypadku aplikacja będzie musiała ponowić próbę całej transakcji.</span><span class="sxs-lookup"><span data-stu-id="f6f0d-133">When this happens, the application will need to retry the entire transaction.</span></span>
