---
title: Implementowanie komunikacji opartej na zdarzeniach między mikrousługami (zdarzenia integracji)
description: Architektura Mikrousług .NET konteneryzowanych aplikacji .NET | Dowiedz się, zdarzenia integracji do zaimplementowania komunikacji oparte na zdarzeniach między mikrousługami.
ms.date: 10/02/2018
ms.openlocfilehash: 8a5cfa280063da742dc1693905fc44cf870c1fcc
ms.sourcegitcommit: 8699383914c24a0df033393f55db3369db728a7b
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 05/15/2019
ms.locfileid: "65640732"
---
# <a name="implementing-event-based-communication-between-microservices-integration-events"></a><span data-ttu-id="e60f7-103">Implementowanie komunikacji opartej na zdarzeniach między mikrousługami (zdarzenia integracji)</span><span class="sxs-lookup"><span data-stu-id="e60f7-103">Implementing event-based communication between microservices (integration events)</span></span>

<span data-ttu-id="e60f7-104">Jak opisano wcześniej, korzystając z komunikacji oparte na zdarzeniach, mikrousługi publikuje zdarzenie, gdy występuje coś, co jest istotne, np. gdy aktualizuje jednostkach biznesowych.</span><span class="sxs-lookup"><span data-stu-id="e60f7-104">As described earlier, when you use event-based communication, a microservice publishes an event when something notable happens, such as when it updates a business entity.</span></span> <span data-ttu-id="e60f7-105">Inne mikrousług subskrybować tych zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="e60f7-105">Other microservices subscribe to those events.</span></span> <span data-ttu-id="e60f7-106">Kiedy mikrousługi odbiera zdarzenia, można było uaktualnić swój własny jednostek biznesowych, które mogą prowadzić do więcej zdarzeń opublikowanej.</span><span class="sxs-lookup"><span data-stu-id="e60f7-106">When a microservice receives an event, it can update its own business entities, which might lead to more events being published.</span></span> <span data-ttu-id="e60f7-107">Jest to kwintesencja pojęcia spójności ostatecznej.</span><span class="sxs-lookup"><span data-stu-id="e60f7-107">This is the essence of the eventual consistency concept.</span></span> <span data-ttu-id="e60f7-108">Ten system publikowania/subskrybowania zwykle odbywa się przy użyciu implementacji magistrali zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="e60f7-108">This publish/subscribe system is usually performed by using an implementation of an event bus.</span></span> <span data-ttu-id="e60f7-109">Magistrali zdarzeń mogą służyć jako interfejs za pomocą interfejsu API potrzebne do subskrybowanie i anulowanie subskrypcji zdarzeń i publikowania zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="e60f7-109">The event bus can be designed as an interface with the API needed to subscribe and unsubscribe to events and to publish events.</span></span> <span data-ttu-id="e60f7-110">Może też mieć co najmniej jeden implementacje oparty na wszelkie komunikacji między procesami lub obsługi komunikatów, takich jak kolejki komunikatów lub usługi Service bus, który obsługuje komunikacji asynchronicznej i modelu publikowania/subskrybowania.</span><span class="sxs-lookup"><span data-stu-id="e60f7-110">It can also have one or more implementations based on any inter-process or messaging communication, such as a messaging queue or a service bus that supports asynchronous communication and a publish/subscribe model.</span></span>

<span data-ttu-id="e60f7-111">Zdarzenia można użyć do zaimplementowania transakcji biznesowych, które obejmują wiele usług, co daje spójności ostatecznej między tymi usługami.</span><span class="sxs-lookup"><span data-stu-id="e60f7-111">You can use events to implement business transactions that span multiple services, which gives you eventual consistency between those services.</span></span> <span data-ttu-id="e60f7-112">Transakcja ostatecznie spójną składa się z szeregu rozproszonych działań.</span><span class="sxs-lookup"><span data-stu-id="e60f7-112">An eventually consistent transaction consists of a series of distributed actions.</span></span> <span data-ttu-id="e60f7-113">W każdej akcji mikrousług aktualizacji jednostki biznesowe i publikuje zdarzenie, które wyzwala akcję dalej.</span><span class="sxs-lookup"><span data-stu-id="e60f7-113">At each action, the microservice updates a business entity and publishes an event that triggers the next action.</span></span>

![Mikrousługi wykazu, za pomocą oparte na zdarzeniach komunikację za pośrednictwem magistrali zdarzeń, aby osiągnąć spójność z koszyka i dodatkowe mikrousług.](./media/image19.png)

<span data-ttu-id="e60f7-115">**Rysunek 6-18**.</span><span class="sxs-lookup"><span data-stu-id="e60f7-115">**Figure 6-18**.</span></span> <span data-ttu-id="e60f7-116">Komunikacja oparte na zdarzeniach, oparte na magistrali zdarzeń</span><span class="sxs-lookup"><span data-stu-id="e60f7-116">Event-driven communication based on an event bus</span></span>

<span data-ttu-id="e60f7-117">W tej sekcji opisano, jak można zaimplementować ten typ komunikacji przy użyciu platformy .NET przy użyciu interfejsu magistrali zdarzeń generycznych, jak pokazano w rysunek 6-18.</span><span class="sxs-lookup"><span data-stu-id="e60f7-117">This section describes how you can implement this type of communication with .NET by using a generic event bus interface, as shown in Figure 6-18.</span></span> <span data-ttu-id="e60f7-118">Istnieje wiele potencjalnych implementacji przy użyciu różnych technologii lub infrastruktury, takich jak RabbitMQ, usługi Azure Service Bus lub wszelkich innych firm typu open source lub komercyjnymi usługi Service bus.</span><span class="sxs-lookup"><span data-stu-id="e60f7-118">There are multiple potential implementations, each using a different technology or infrastructure such as RabbitMQ, Azure Service Bus, or any other third-party open-source or commercial service bus.</span></span>

## <a name="using-message-brokers-and-services-buses-for-production-systems"></a><span data-ttu-id="e60f7-119">Za pomocą magistrali komunikatów brokerów i usług dla systemów produkcyjnych.</span><span class="sxs-lookup"><span data-stu-id="e60f7-119">Using message brokers and services buses for production systems</span></span>

<span data-ttu-id="e60f7-120">Jak wspomniano w sekcji architektury, możesz wybrać wiele technologii obsługi komunikatów do implementowania usługi Service bus zdarzenie abstrakcyjne.</span><span class="sxs-lookup"><span data-stu-id="e60f7-120">As noted in the architecture section, you can choose from multiple messaging technologies for implementing your abstract event bus.</span></span> <span data-ttu-id="e60f7-121">Jednak te technologie są na różnych poziomach.</span><span class="sxs-lookup"><span data-stu-id="e60f7-121">But these technologies are at different levels.</span></span> <span data-ttu-id="e60f7-122">Na przykład oprogramowania RabbitMQ, transportu brokera obsługi komunikatów, jest na poziomie niższym niż produktów komercyjnych, takich jak usługi Azure Service Bus, NServiceBus, MassTransit lub Brighter.</span><span class="sxs-lookup"><span data-stu-id="e60f7-122">For instance, RabbitMQ, a messaging broker transport, is at a lower level than commercial products like Azure Service Bus, NServiceBus, MassTransit, or Brighter.</span></span> <span data-ttu-id="e60f7-123">Większość tych produktów mogą działać na podstawie RabbitMQ lub Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="e60f7-123">Most of these products can work on top of either RabbitMQ or Azure Service Bus.</span></span> <span data-ttu-id="e60f7-124">Wybór produktu zależy od tego, jak wiele funkcji i ile out-of--box skalowalność potrzebne dla aplikacji.</span><span class="sxs-lookup"><span data-stu-id="e60f7-124">Your choice of product depends on how many features and how much out-of-the-box scalability you need for your application.</span></span>

<span data-ttu-id="e60f7-125">Implementowanie tylko zdarzenia magistrali z koncepcji dla swojego środowiska programowania, jak w poniższym przykładzie w ramach aplikacji eShopOnContainers proste wdrażanie na podstawie RabbitMQ uruchomionego jako kontener może być wystarczająca.</span><span class="sxs-lookup"><span data-stu-id="e60f7-125">For implementing just an event bus proof-of-concept for your development environment, as in the eShopOnContainers sample, a simple implementation on top of RabbitMQ running as a container might be enough.</span></span> <span data-ttu-id="e60f7-126">Ale w przypadku o kluczowym znaczeniu oraz systemów produkcyjnych, które wymagają wysokiej skalowalności, warto do oceny i przy użyciu usługi Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="e60f7-126">But for mission-critical and production systems that need high scalability, you might want to evaluate and use Azure Service Bus.</span></span>

<span data-ttu-id="e60f7-127">Jeśli potrzebujesz abstrakcji wysokiego poziomu i bardziej zaawansowane funkcje, takie jak [Sagach](https://docs.particular.net/nservicebus/sagas/) dla procesów długotrwałych, które dzięki niej programowanie rozproszonych łatwiejsze innych komercyjnych i open-source usługa autobusów, takich jak NServiceBus, MassTransit, i Brighter są warte dokonanie oceny oprogramowania.</span><span class="sxs-lookup"><span data-stu-id="e60f7-127">If you require high-level abstractions and richer features like [Sagas](https://docs.particular.net/nservicebus/sagas/) for long-running processes that make distributed development easier, other commercial and open-source service buses like NServiceBus, MassTransit, and Brighter are worth evaluating.</span></span> <span data-ttu-id="e60f7-128">W tym przypadku abstrakcje i interfejsu API do używania zazwyczaj będzie bezpośrednio te udostępniane przez te autobusów wysokiego poziomu usługi zamiast własnego abstrakcje (takich jak [abstrakcje magistrali zdarzenie proste podane w ramach aplikacji eShopOnContainers](https://github.com/dotnet-architecture/eShopOnContainers/blob/dev/src/BuildingBlocks/EventBus/EventBus/Abstractions/IEventBus.cs)).</span><span class="sxs-lookup"><span data-stu-id="e60f7-128">In this case, the abstractions and API to use would usually be directly the ones provided by those high-level service buses instead of your own abstractions (like the [simple event bus abstractions provided at eShopOnContainers](https://github.com/dotnet-architecture/eShopOnContainers/blob/dev/src/BuildingBlocks/EventBus/EventBus/Abstractions/IEventBus.cs)).</span></span> <span data-ttu-id="e60f7-129">Dla tej sprawy, można zbadać [forked przy użyciu NServiceBus w ramach aplikacji eShopOnContainers](https://go.particular.net/eShopOnContainers) (dodatkowe przykład pochodnej implementowany przez konkretnego oprogramowania)</span><span class="sxs-lookup"><span data-stu-id="e60f7-129">For that matter, you can research the [forked eShopOnContainers using NServiceBus](https://go.particular.net/eShopOnContainers) (additional derived sample implemented by Particular Software)</span></span>

<span data-ttu-id="e60f7-130">Oczywiście zawsze można zbudować własne funkcje magistrali usługi na podstawie technologii niższego poziomu, takie jak RabbitMQ i platformy Docker, ale czynności niezbędne do "wynalazł koła" może być zbyt kosztowne dla aplikacji przedsiębiorstwa niestandardowych.</span><span class="sxs-lookup"><span data-stu-id="e60f7-130">Of course, you could always build your own service bus features on top of lower-level technologies like RabbitMQ and Docker, but the work needed to “reinvent the wheel” might be too costly for a custom enterprise application.</span></span>

<span data-ttu-id="e60f7-131">Aby przywołują: Przykładowe zdarzenia magistrali abstrakcje i implementacji przedstawionym w ramach aplikacji eShopOnContainers próbki są przeznaczone do służyć jedynie jako Weryfikacja koncepcji.</span><span class="sxs-lookup"><span data-stu-id="e60f7-131">To reiterate: the sample event bus abstractions and implementation showcased in the eShopOnContainers sample are intended to be used only as a proof of concept.</span></span> <span data-ttu-id="e60f7-132">Gdy okaże się, chcesz mieć komunikacji asynchronicznej i oparte na zdarzeniach, jak wyjaśniono w bieżącej sekcji, należy wybrać produkt magistrali usług, który najlepiej spełnia Twoje potrzeby w środowisku produkcyjnym.</span><span class="sxs-lookup"><span data-stu-id="e60f7-132">Once you have decided that you want to have asynchronous and event-driven communication, as explained in the current section, you should choose the service bus product that best fits your needs for production.</span></span>

## <a name="integration-events"></a><span data-ttu-id="e60f7-133">Zdarzenia integracji</span><span class="sxs-lookup"><span data-stu-id="e60f7-133">Integration events</span></span>

<span data-ttu-id="e60f7-134">Integracja zdarzenia są używane do pobierania stanu domeny w synchronizacji w wielu mikrousługach lub systemy zewnętrzne.</span><span class="sxs-lookup"><span data-stu-id="e60f7-134">Integration events are used for bringing domain state in sync across multiple microservices or external systems.</span></span> <span data-ttu-id="e60f7-135">Polega to na publikowanie zdarzenia integracji spoza mikrousług.</span><span class="sxs-lookup"><span data-stu-id="e60f7-135">This is done by publishing integration events outside the microservice.</span></span> <span data-ttu-id="e60f7-136">Po opublikowaniu zdarzenia do wielu mikrousług odbiorcy (na tyle mikrousług, zgodnie z subskrybowanym zdarzenia integracji) obsługi odpowiedniego zdarzenia w poszczególne mikrousługi odbiorcy obsługuje zdarzenie.</span><span class="sxs-lookup"><span data-stu-id="e60f7-136">When an event is published to multiple receiver microservices (to as many microservices as are subscribed to the integration event), the appropriate event handler in each receiver microservice handles the event.</span></span>

<span data-ttu-id="e60f7-137">Zdarzenie integracji jest zasadniczo klasą przechowywania danych, jak w poniższym przykładzie:</span><span class="sxs-lookup"><span data-stu-id="e60f7-137">An integration event is basically a data-holding class, as in the following example:</span></span>

```csharp
public class ProductPriceChangedIntegrationEvent : IntegrationEvent
{
    public int ProductId { get; private set; }
    public decimal NewPrice { get; private set; }
    public decimal OldPrice { get; private set; }

    public ProductPriceChangedIntegrationEvent(int productId, decimal newPrice,
        decimal oldPrice)
    {
        ProductId = productId;
        NewPrice = newPrice;
        OldPrice = oldPrice;
    }
}
```

<span data-ttu-id="e60f7-138">Zdarzenia integracji można zdefiniować na poziomie aplikacji, poszczególne mikrousługi, więc one są całkowicie niezależni od innych mikrousług, w sposób porównywalny z jak modele widoków są zdefiniowane w serwera i klienta.</span><span class="sxs-lookup"><span data-stu-id="e60f7-138">The integration events can be defined at the application level of each microservice, so they are decoupled from other microservices, in a way comparable to how ViewModels are defined in the server and client.</span></span> <span data-ttu-id="e60f7-139">Co nie jest zalecane jest udostępnianie wspólnej biblioteki zdarzenia integracji między wiele mikrousług; tych czynności będzie można sprzężenia tych mikrousług przy użyciu biblioteki pojedyncze zdarzenie definicji danych.</span><span class="sxs-lookup"><span data-stu-id="e60f7-139">What is not recommended is sharing a common integration events library across multiple microservices; doing that would be coupling those microservices with a single event definition data library.</span></span> <span data-ttu-id="e60f7-140">Czy chcesz to zrobić dla takie same powodów, dla których nie chcesz udostępniać Wspólny model domeny w wielu mikrousługach: mikrousług musi być całkowicie autonomicznych.</span><span class="sxs-lookup"><span data-stu-id="e60f7-140">You do not want to do that for the same reasons that you do not want to share a common domain model across multiple microservices: microservices must be completely autonomous.</span></span>

<span data-ttu-id="e60f7-141">Istnieje tylko kilka rodzajów bibliotek, które powinny współużytkować między mikrousług.</span><span class="sxs-lookup"><span data-stu-id="e60f7-141">There are only a few kinds of libraries you should share across microservices.</span></span> <span data-ttu-id="e60f7-142">Jeden jest bibliotek, które są bloki gotowych aplikacji, takie jak [interfejsu API klienta magistrali zdarzeń](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/BuildingBlocks/EventBus), jak w ramach aplikacji eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="e60f7-142">One is libraries that are final application blocks, like the [Event Bus client API](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/BuildingBlocks/EventBus), as in eShopOnContainers.</span></span> <span data-ttu-id="e60f7-143">Innym jest bibliotek, które tworzą narzędzia, które również zostaną udostępnione jako części NuGet, takich jak serializatory JSON.</span><span class="sxs-lookup"><span data-stu-id="e60f7-143">Another is libraries that constitute tools that could also be shared as NuGet components, like JSON serializers.</span></span>

## <a name="the-event-bus"></a><span data-ttu-id="e60f7-144">Magistrali zdarzeń</span><span class="sxs-lookup"><span data-stu-id="e60f7-144">The event bus</span></span>

<span data-ttu-id="e60f7-145">Magistrali zdarzeń umożliwia publikowania/subskrybowania — styl komunikację między mikrousługami bez składniki, które jawnie wiedzieć, jak pokazano w rysunek 6-19.</span><span class="sxs-lookup"><span data-stu-id="e60f7-145">An event bus allows publish/subscribe-style communication between microservices without requiring the components to explicitly be aware of each other, as shown in Figure 6-19.</span></span>

![Wzorzec publikowania/subskrybowania podstawowe Mikrousług A publikuje w magistrali zdarzeń, który rozprowadza subskrypcję mikrousług B i C, bez wydawcy znajomości subskrybentów.](./media/image20.png)

<span data-ttu-id="e60f7-147">**Rysunek 6-19**.</span><span class="sxs-lookup"><span data-stu-id="e60f7-147">**Figure 6-19**.</span></span> <span data-ttu-id="e60f7-148">Podstawowe informacje o magistrali zdarzeń publikowania/subskrybowania</span><span class="sxs-lookup"><span data-stu-id="e60f7-148">Publish/subscribe basics with an event bus</span></span>

<span data-ttu-id="e60f7-149">Magistrali zdarzeń dotyczące wzorzec obserwatora i Publikuj — Subskrybuj wzorca.</span><span class="sxs-lookup"><span data-stu-id="e60f7-149">The event bus is related to the Observer pattern and the publish-subscribe pattern.</span></span>

### <a name="observer-pattern"></a><span data-ttu-id="e60f7-150">Wzorzec obserwatora</span><span class="sxs-lookup"><span data-stu-id="e60f7-150">Observer pattern</span></span>

<span data-ttu-id="e60f7-151">W [wzorzec obserwatora](https://en.wikipedia.org/wiki/Observer_pattern), obiekt podstawowy (znanych jako możliwość obserwowania) powiadamia innych zainteresowanych obiektów (znanych jako obserwatorzy) z istotnymi informacjami (zdarzenia).</span><span class="sxs-lookup"><span data-stu-id="e60f7-151">In the [Observer pattern](https://en.wikipedia.org/wiki/Observer_pattern), your primary object (known as the Observable) notifies other interested objects (known as Observers) with relevant information (events).</span></span>

### <a name="publishsubscribe-pubsub-pattern"></a><span data-ttu-id="e60f7-152">Wzorzec publikowania/subskrybowania (Pub/Sub)</span><span class="sxs-lookup"><span data-stu-id="e60f7-152">Publish/Subscribe (Pub/Sub) pattern</span></span>

<span data-ttu-id="e60f7-153">Celem [wzorca publikowania/subskrypcji](https://docs.microsoft.com/previous-versions/msp-n-p/ff649664(v=pandp.10)) jest taka sama jak wzorzec obserwatora: chcesz powiadomić inne usługi, w przypadku wystąpienia określonych zdarzeń została wykonana.</span><span class="sxs-lookup"><span data-stu-id="e60f7-153">The purpose of the [Publish/Subscribe pattern](https://docs.microsoft.com/previous-versions/msp-n-p/ff649664(v=pandp.10)) is the same as the Observer pattern: you want to notify other services when certain events take place.</span></span> <span data-ttu-id="e60f7-154">Ale ma jedną istotną różnicą między wzorców obserwatora i Pub/Sub.</span><span class="sxs-lookup"><span data-stu-id="e60f7-154">But there is an important difference between the Observer and Pub/Sub patterns.</span></span> <span data-ttu-id="e60f7-155">We wzorcu obserwatora emisji odbywa się bezpośrednio z obserwowalnymi na obserwatorów, dzięki czemu "znane" siebie nawzajem.</span><span class="sxs-lookup"><span data-stu-id="e60f7-155">In the observer pattern, the broadcast is performed directly from the observable to the observers, so they “know” each other.</span></span> <span data-ttu-id="e60f7-156">Ale gdy przy użyciu wzorca publikowania/subskrybowania, jest trzecim składnikiem o nazwie brokera lub broker lub zdarzeń magistrali komunikatów, który jest znany wydawcy i subskrybenta.</span><span class="sxs-lookup"><span data-stu-id="e60f7-156">But when using a Pub/Sub pattern, there is a third component, called broker or message broker or event bus, which is known by both the publisher and subscriber.</span></span> <span data-ttu-id="e60f7-157">W związku z tym gdy przy użyciu wzorca publikowania/subskrybowania wydawcy i subskrybenci są dokładnie odłączone dzięki brokera magistrali lub wiadomości wymienionych zdarzeń.</span><span class="sxs-lookup"><span data-stu-id="e60f7-157">Therefore, when using the Pub/Sub pattern the publisher and the subscribers are precisely decoupled thanks to the mentioned event bus or message broker.</span></span>

### <a name="the-middleman-or-event-bus"></a><span data-ttu-id="e60f7-158">Service bus pośredników lub zdarzenie</span><span class="sxs-lookup"><span data-stu-id="e60f7-158">The middleman or event bus</span></span>

<span data-ttu-id="e60f7-159">Jak osiągnąć anonimowości między wydawcą a transakcyjnym subskrybentem?</span><span class="sxs-lookup"><span data-stu-id="e60f7-159">How do you achieve anonymity between publisher and subscriber?</span></span> <span data-ttu-id="e60f7-160">Łatwo jest umożliwiają pośredników zajmie się całą komunikację.</span><span class="sxs-lookup"><span data-stu-id="e60f7-160">An easy way is let a middleman take care of all the communication.</span></span> <span data-ttu-id="e60f7-161">Magistrali zdarzeń jest jeden taki pośredników.</span><span class="sxs-lookup"><span data-stu-id="e60f7-161">An event bus is one such middleman.</span></span>

<span data-ttu-id="e60f7-162">Magistrali zdarzeń zwykle składa się z dwóch części:</span><span class="sxs-lookup"><span data-stu-id="e60f7-162">An event bus is typically composed of two parts:</span></span>

- <span data-ttu-id="e60f7-163">Abstrakcja lub interfejs.</span><span class="sxs-lookup"><span data-stu-id="e60f7-163">The abstraction or interface.</span></span>

- <span data-ttu-id="e60f7-164">Co najmniej jeden implementacji.</span><span class="sxs-lookup"><span data-stu-id="e60f7-164">One or more implementations.</span></span>

<span data-ttu-id="e60f7-165">W rysunek 6-19 możesz zobaczyć jak to zrobić, z punktu widzenia aplikacji, magistrali zdarzeń to nic innego niż kanału Pub/Sub.</span><span class="sxs-lookup"><span data-stu-id="e60f7-165">In Figure 6-19 you can see how, from an application point of view, the event bus is nothing more than a Pub/Sub channel.</span></span> <span data-ttu-id="e60f7-166">Sposób zaimplementowania tej komunikacji asynchronicznej może się różnić.</span><span class="sxs-lookup"><span data-stu-id="e60f7-166">The way you implement this asynchronous communication can vary.</span></span> <span data-ttu-id="e60f7-167">Tak, aby można przełączać się między nimi, w zależności od wymagań środowiska (na przykład, środowisko produkcyjne i środowiska deweloperskie) może mieć wiele implementacji.</span><span class="sxs-lookup"><span data-stu-id="e60f7-167">It can have multiple implementations so that you can swap between them, depending on the environment requirements (for example, production versus development environments).</span></span>

<span data-ttu-id="e60f7-168">W rysunek 6 – 20 znajduje abstrakcję magistrali zdarzeń z wielu implementacjach oparte na infrastruktury obsługi komunikatów technologii, takich jak RabbitMQ, usługi Azure Service Bus lub innym brokerem/komunikatu o zdarzeniu.</span><span class="sxs-lookup"><span data-stu-id="e60f7-168">In Figure 6-20 you can see an abstraction of an event bus with multiple implementations based on infrastructure messaging technologies like RabbitMQ, Azure Service Bus, or another event/message broker.</span></span>

![Warto mieć magistrali zdarzeń zdefiniowanych za pomocą interfejsu, więc można ją wdrożyć za pomocą kilku technologii, takich jak usługi RabbitMQ usługi Azure Service bus lub inne osoby.](./media/image21.png)

<span data-ttu-id="e60f7-170">**Rysunek 6 - 20.**</span><span class="sxs-lookup"><span data-stu-id="e60f7-170">**Figure 6- 20.**</span></span> <span data-ttu-id="e60f7-171">Wiele implementacji magistrali zdarzeń</span><span class="sxs-lookup"><span data-stu-id="e60f7-171">Multiple implementations of an event bus</span></span>

<span data-ttu-id="e60f7-172">Jednakże i jak wspomniano wcześniej przy użyciu własnych abstrakcje (interfejsu magistrali zdarzeń) jest dobra, tylko wtedy, gdy potrzebujesz funkcji magistrali zdarzeń w wersji basic, są obsługiwane przez Twoje abstrakcje.</span><span class="sxs-lookup"><span data-stu-id="e60f7-172">However, and as mentioned previously, using your own abstractions (the event bus interface) is good only if you need basic event bus features supported by your abstractions.</span></span> <span data-ttu-id="e60f7-173">Jeśli potrzebujesz bardziej rozbudowane funkcje magistrali usług, należy prawdopodobnie używać interfejsu API i abstrakcje dostarczone przez Twojego preferowanego komercyjnych usługi Service bus zamiast własne elementy abstrakcji.</span><span class="sxs-lookup"><span data-stu-id="e60f7-173">If you need richer service bus features, you should probably use the API and abstractions provided by your preferred commercial service bus instead of your own abstractions.</span></span>

### <a name="defining-an-event-bus-interface"></a><span data-ttu-id="e60f7-174">Definiowanie interfejsu magistrali zdarzeń</span><span class="sxs-lookup"><span data-stu-id="e60f7-174">Defining an event bus interface</span></span>

<span data-ttu-id="e60f7-175">Zacznijmy od kodu implementacji interfejsu magistrali zdarzeń i możliwe implementacje dla celów eksploracji.</span><span class="sxs-lookup"><span data-stu-id="e60f7-175">Let’s start with some implementation code for the event bus interface and possible implementations for exploration purposes.</span></span> <span data-ttu-id="e60f7-176">Interfejs powinna być ogólny i prostego, tak jak w poniższym interfejsu.</span><span class="sxs-lookup"><span data-stu-id="e60f7-176">The interface should be generic and straightforward, as in the following interface.</span></span>

```csharp
public interface IEventBus
{
    void Publish(IntegrationEvent @event);

    void Subscribe<T, TH>()
        where T : IntegrationEvent
        where TH : IIntegrationEventHandler<T>;

    void SubscribeDynamic<TH>(string eventName)
        where TH : IDynamicIntegrationEventHandler;

    void UnsubscribeDynamic<TH>(string eventName)
        where TH : IDynamicIntegrationEventHandler;

    void Unsubscribe<T, TH>()
        where TH : IIntegrationEventHandler<T>
        where T : IntegrationEvent;
}
```

<span data-ttu-id="e60f7-177">`Publish` Metoda jest prosta.</span><span class="sxs-lookup"><span data-stu-id="e60f7-177">The `Publish` method is straightforward.</span></span> <span data-ttu-id="e60f7-178">Magistrali zdarzeń będzie emitować zdarzenia integracji przekazywane do niego wszystkie mikrousługi lub nawet aplikacji zewnętrznej, zasubskrybować tego zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="e60f7-178">The event bus will broadcast the integration event passed to it to any microservice, or even an external application, subscribed to that event.</span></span> <span data-ttu-id="e60f7-179">Ta metoda jest używana przez mikrousług, która jest publikowanie zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="e60f7-179">This method is used by the microservice that is publishing the event.</span></span>

<span data-ttu-id="e60f7-180">`Subscribe` Metody (może mieć kilka implementacji w zależności od argumentów) są używane przez mikrousług, które chcesz odbierać zdarzenia.</span><span class="sxs-lookup"><span data-stu-id="e60f7-180">The `Subscribe` methods (you can have several implementations depending on the arguments) are used by the microservices that want to receive events.</span></span> <span data-ttu-id="e60f7-181">Ta metoda ma dwa argumenty.</span><span class="sxs-lookup"><span data-stu-id="e60f7-181">This method has two arguments.</span></span> <span data-ttu-id="e60f7-182">Pierwsza to zdarzenie integracji, aby subskrybować (`IntegrationEvent`).</span><span class="sxs-lookup"><span data-stu-id="e60f7-182">The first is the integration event to subscribe to (`IntegrationEvent`).</span></span> <span data-ttu-id="e60f7-183">Drugi argument funkcji jest integracja zdarzenie obsługi (lub metody wywołania zwrotnego), o nazwie `IIntegrationEventHandler<T>`, które zostaną wykonane podczas mikrousług odbiornik pobiera ten komunikat zdarzenia integracji.</span><span class="sxs-lookup"><span data-stu-id="e60f7-183">The second argument is the integration event handler (or callback method), named `IIntegrationEventHandler<T>`, to be executed when the receiver microservice gets that integration event message.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e60f7-184">[Poprzednie](database-server-container.md)
> [dalej](rabbitmq-event-bus-development-test-environment.md)</span><span class="sxs-lookup"><span data-stu-id="e60f7-184">[Previous](database-server-container.md)
[Next](rabbitmq-event-bus-development-test-environment.md)</span></span>
