---
title: "Migrowanie aplikacji starszych wbudowanymi .NET Framework do kontenerów systemu Windows"
description: "Architektura Mikrousług .NET dla aplikacji .NET konteneryzowanych | Migrowanie aplikacji starszych wbudowanymi .NET Framework do kontenerów systemu Windows"
keywords: "Docker, Mikrousług, ASP.NET, kontenera"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: c88027156b55829f77357c1fdb1aef01a802b88a
ms.sourcegitcommit: e7f04439d78909229506b56935a1105a4149ff3d
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 12/23/2017
---
# <a name="migrating-legacy-monolithic-net-framework-applications-to-windows-containers"></a><span data-ttu-id="6a4cb-104">Migrowanie aplikacji starszych wbudowanymi .NET Framework do kontenerów systemu Windows</span><span class="sxs-lookup"><span data-stu-id="6a4cb-104">Migrating Legacy Monolithic .NET Framework Applications to Windows Containers</span></span>

<span data-ttu-id="6a4cb-105">*Kontenery systemu Windows mogą być używane jako sposób do poprawy programowanie i testowanie środowiska i wdrażania aplikacji, które są oparte na starszych technologii .NET Framework, takich jak Web* *formularzy. Używanie kontenerów dla starszych aplikacji w ten sposób jest określana jako scenariusza "przyrostu i shift".*</span><span class="sxs-lookup"><span data-stu-id="6a4cb-105">*Windows Containers can be used as a way to improve development and test environments, and to deploy applications that are based on legacy .NET Framework technologies like Web* *Forms. Using containers for legacy applications in this way is referred to as a “lift and shift” scenario.*</span></span>

<span data-ttu-id="6a4cb-106">Wcześniejszych sekcjach tego przewodnika ma branżowa architektura mikrousług, gdzie aplikacje biznesowe są rozmieszczone w różnych kontenerów. każdy z usługą małe, ukierunkowanych.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-106">Earlier sections of this guide have championed a microservices architecture where business applications are distributed among different containers, each running a small, focused service.</span></span> <span data-ttu-id="6a4cb-107">Ten cel ma wiele korzyści.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-107">That goal has many benefits.</span></span> <span data-ttu-id="6a4cb-108">W nowo tworzonym tego podejścia jest zdecydowanie zalecane.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-108">In new development, that approach is strongly recommended.</span></span> <span data-ttu-id="6a4cb-109">Aplikacje krytyczne dla przedsiębiorstwa również korzystać do ponoszenie kosztów rearchitecture i ponowna implementacja.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-109">Enterprise-critical applications will also benefit enough to justify the cost of a rearchitecture and reimplementation.</span></span>

<span data-ttu-id="6a4cb-110">Jednak nie wszystkie aplikacje będą korzystać do ponoszenie kosztów.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-110">But not every application will benefit enough to justify the cost.</span></span> <span data-ttu-id="6a4cb-111">Nie oznacza że nie można użyć tych aplikacji w scenariuszach kontenera.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-111">That does not mean that those applications cannot be used in container scenarios.</span></span>

<span data-ttu-id="6a4cb-112">W tej sekcji przeanalizujemy aplikacji dla eShopOnContainers wyświetlany w rysunek 7-1.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-112">In this section, we will explore an application for eShopOnContainers, shown in Figure 7-1.</span></span> <span data-ttu-id="6a4cb-113">Ta aplikacja będzie służyć przez członków zespołu enterprise eShopOnContainers do wyświetlania i edytowania katalogu produktów.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-113">This application would be used by members of the eShopOnContainers enterprise team to view and edit the product catalog.</span></span>

![](./media/image1.png)

<span data-ttu-id="6a4cb-114">**Rysunek 7-1**.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-114">**Figure 7-1**.</span></span> <span data-ttu-id="6a4cb-115">Aplikacja formularzy sieci Web ASP.NET (technologia starsze) do kontenera systemu Windows</span><span class="sxs-lookup"><span data-stu-id="6a4cb-115">ASP.NET Web Forms application (legacy technology) on a Windows Container</span></span>

<span data-ttu-id="6a4cb-116">To jest aplikacja formularzy sieci Web, służący do przeglądania i modyfikowania wpisy w katalogu.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-116">This is a Web Forms application that is used to browse and modify the catalog entries.</span></span> <span data-ttu-id="6a4cb-117">Zależności formularzy sieci Web oznacza, że ta aplikacja nie będzie działać na .NET Core, chyba że jest napisany od nowa bez formularzy sieci Web i zamiast tego używa platformy ASP.NET Core MVC.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-117">The Web Forms dependency means this application will not run on .NET Core unless it is rewritten without Web Forms and instead uses ASP.NET Core MVC.</span></span> <span data-ttu-id="6a4cb-118">Zobaczysz, jak można uruchomić aplikacji, takich jak te w kontenerach bez zmian.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-118">You will see how you can run applications like these in containers without changes.</span></span> <span data-ttu-id="6a4cb-119">Widoczne będzie także, jak można zmienić minimalnego do pracy w trybie hybrydowego, w której niektóre funkcje został przeniesiony do oddzielnych mikrousługi, ale większość funkcji są wbudowanymi aplikacji.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-119">You will also see how you can make minimal changes to work in a hybrid mode where some functionality has been moved into a separate microservice, but most functionality remains in the monolithic application.</span></span>

## <a name="benefits-of-containerizing-a-monolithic-application"></a><span data-ttu-id="6a4cb-120">Zalety containerizing wbudowanymi aplikacji</span><span class="sxs-lookup"><span data-stu-id="6a4cb-120">Benefits of containerizing a monolithic application</span></span>

<span data-ttu-id="6a4cb-121">Aplikacja Catalog.WebForms jest dostępna w repozytorium GitHub eShopOnContainers (<https://github.com/dotnet/eShopOnContainers>).</span><span class="sxs-lookup"><span data-stu-id="6a4cb-121">The Catalog.WebForms application is available in the eShopOnContainers GitHub repository (<https://github.com/dotnet/eShopOnContainers>).</span></span> <span data-ttu-id="6a4cb-122">Ta aplikacja to aplikacja sieci web autonomiczny uzyskiwania dostępu do magazynu danych wysokiej dostępności.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-122">This application is a standalone web application accessing a high-availability data store.</span></span> <span data-ttu-id="6a4cb-123">Mimo tego są zalety uruchamiania aplikacji w kontenerze.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-123">Even so, there are advantages to running the application in a container.</span></span> <span data-ttu-id="6a4cb-124">Możesz utworzyć obraz dla aplikacji.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-124">You create an image for the application.</span></span> <span data-ttu-id="6a4cb-125">Od tego momentu każde wdrożenie jest uruchamiany w tym samym środowisku.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-125">From that point forward, every deployment runs in the same environment.</span></span> <span data-ttu-id="6a4cb-126">Każdy kontener korzysta z tej samej wersji systemu operacyjnego, ma tę samą wersję zainstalowane zależności używa tej samej struktury i jest utworzony przy użyciu tego samego procesu.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-126">Every container uses the same OS version, has the same version of dependencies installed, uses the same framework, and is built using the same process.</span></span> <span data-ttu-id="6a4cb-127">Widać aplikacji załadowany w Visual Studio 2017 na rysunku 7-2.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-127">You can see the application loaded in Visual Studio 2017 in Figure 7-2.</span></span>

![](./media/image2.png)

<span data-ttu-id="6a4cb-128">**Rysunek 7-2**.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-128">**Figure 7-2**.</span></span> <span data-ttu-id="6a4cb-129">Zarządzanie aplikacji formularzy sieci Web w programie Visual Studio 2017 katalogami</span><span class="sxs-lookup"><span data-stu-id="6a4cb-129">Catalog management Web Forms application in Visual Studio 2017</span></span>

<span data-ttu-id="6a4cb-130">Ponadto deweloperzy wszystkie uruchomić aplikację w tym środowisku spójne.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-130">In addition, developers can all run the application in this consistent environment.</span></span> <span data-ttu-id="6a4cb-131">Problemy, które są wyświetlane tylko w niektórych wersjach pojawi się natychmiast dla deweloperów, a nie udostępniając w środowisku tymczasowym czy produkcyjnym.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-131">Issues that only appear with certain versions will appear immediately for developers rather than surfacing in a staging or production environment.</span></span> <span data-ttu-id="6a4cb-132">Różnice między środowisk deweloperskich między zespół deweloperów znaczenia mniej po aplikacje uruchamiane w kontenerach.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-132">Differences between the development environments among the development team matter less once applications run in containers.</span></span>

<span data-ttu-id="6a4cb-133">Na koniec konteneryzowanych aplikacje mają płaska krzywej skalowalnego w poziomie.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-133">Finally, containerized applications have a flatter scale-out curve.</span></span> <span data-ttu-id="6a4cb-134">Masz aplikacje jak konteneryzowanych zapamiętanych włączyć więcej kontenerów na maszynie wirtualnej lub więcej kontenerów na maszynie fizycznej.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-134">You have learned how containerized apps enable more containers in a VM or more containers in a physical machine.</span></span> <span data-ttu-id="6a4cb-135">Przekłada się wyżej gęstości i mniej wymagane zasoby.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-135">This translates to higher density and fewer required resources.</span></span>

<span data-ttu-id="6a4cb-136">Z tego względu należy wziąć pod uwagę uruchamianie starszych aplikacji wbudowanymi w kontenerze Docker przy użyciu operacji "przyrostu i shift".</span><span class="sxs-lookup"><span data-stu-id="6a4cb-136">For all these reasons, consider running legacy monolithic apps in a Docker container using a “lift-and-shift” operation.</span></span> <span data-ttu-id="6a4cb-137">Frazy "przyrostu i przesunięcia" opisuje zakres zadania: możesz *Podnieś* całej aplikacji z maszyny fizycznej lub wirtualnej, i *shift* go do kontenera.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-137">The phrase “lift and shift” describes the scope of the task: you *lift* the entire application from a physical or virtual machine, and *shift* it into a container.</span></span> <span data-ttu-id="6a4cb-138">W sytuacjach idealne nie trzeba wprowadzać żadnych zmian do kodu aplikacji, aby uruchomić go w kontenerze.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-138">In ideal situations, you do not need to make any changes to the application code to run it in a container.</span></span>

## <a name="possible-migration-paths"></a><span data-ttu-id="6a4cb-139">Ścieżki migracji możliwe</span><span class="sxs-lookup"><span data-stu-id="6a4cb-139">Possible migration paths</span></span>

<span data-ttu-id="6a4cb-140">Jako aplikację wbudowanymi aplikacji Catalog.Webforms jest jednej aplikacji sieci web zawierający wszystkie kodu, w tym biblioteki dostępu do danych.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-140">As a monolithic application, the Catalog.Webforms application is one web application containing all the code, including the data access libraries.</span></span> <span data-ttu-id="6a4cb-141">Bazy danych są uruchamiane na osobnym komputerze wysokiej dostępności.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-141">The database runs on a separate high-availability machine.</span></span> <span data-ttu-id="6a4cb-142">Tej konfiguracji jest symulowane w przykładowym kodzie za pomocą usługi wykazu zasymulować: można uruchomić aplikacji Catalog.WebForms dla fałszywych danych do symulowania czysty scenariusz przyrostu shift.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-142">That configuration is simulated in the sample code by using a mock catalog service: you can run the Catalog.WebForms application against that fake data to simulate a pure lift-and-shift scenario.</span></span> <span data-ttu-id="6a4cb-143">Oznacza to najprostsza ścieżka migracji, w której przenieść istniejące zasoby do uruchamiania w kontenerze bez wprowadzania żadnych zmian kodu w ogóle.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-143">This demonstrates the simplest migration path, where you move existing assets to run in a container without any code changes at all.</span></span> <span data-ttu-id="6a4cb-144">Ta ścieżka jest odpowiedni dla aplikacji, które są kompletne i, która ma minimalne interakcje z funkcjami, który przenosisz mikrousług.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-144">This path is appropriate for applications that are complete and that have minimal interaction with functionality that you are moving to microservices.</span></span>

<span data-ttu-id="6a4cb-145">Jednak eShopOnContainers witryny sieci Web jest już dostęp do magazynu danych przy użyciu mikrousług dla różnych scenariuszy.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-145">However, the eShopOnContainers website is already accessing the data storage using microservices for different scenarios.</span></span> <span data-ttu-id="6a4cb-146">Niektóre dodatkowe zmiany, małe możliwe do edytora katalogu wykorzystać mikrousługi katalogu zamiast bezpośrednie uzyskiwanie dostępu do magazynu danych katalogu.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-146">Some small additional changes can be made to the catalog editor to leverage the catalog microservice instead of accessing the catalog data storage directly.</span></span>

<span data-ttu-id="6a4cb-147">Te zmiany pokazują kontynuacja do własnych aplikacji.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-147">These changes demonstrate the continuum for your own applications.</span></span> <span data-ttu-id="6a4cb-148">Można wykonywać wszystkie przenoszenia istniejących aplikacji bez zmian do kontenerów do wprowadzania zmian w małych, umożliwiających istniejących aplikacji uzyskać dostęp do pewnych nowych mikrousług, aby całkowicie ponowne zapisywanie w pełni korzystać z nowej aplikacji Architektura mikrousługi.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-148">You can do anything from moving an existing application without change into containers, to making small changes that enable existing applications to access some of the new microservices, to completely rewriting an application to fully participate in a new microservice-based architecture.</span></span> <span data-ttu-id="6a4cb-149">Prawidłowe ścieżki zależy od koszt migracji i korzysta z żadnych migracji.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-149">The right path depends on both the cost of the migration and the benefits from any migration.</span></span>

## <a name="application-tour"></a><span data-ttu-id="6a4cb-150">Samouczek aplikacji</span><span class="sxs-lookup"><span data-stu-id="6a4cb-150">Application tour</span></span>

<span data-ttu-id="6a4cb-151">Można załadować rozwiązania Catalog.WebForms i uruchomić aplikację jako aplikacja autonomiczna.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-151">You can load the Catalog.WebForms solution and run the application as a standalone application.</span></span> <span data-ttu-id="6a4cb-152">W tej konfiguracji zamiast bazę danych magazynu trwałego aplikacji przy użyciu fałszywych usługi zwracanych danych.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-152">In this configuration, instead of a persistent storage database, the application uses a fake service to return data.</span></span> <span data-ttu-id="6a4cb-153">Aplikacja używa Autofac (<https://autofac.org/>) jako Inwersja kontroli (IOC) kontenera.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-153">The application uses Autofac (<https://autofac.org/>) as an inversion of control (IOC) container.</span></span> <span data-ttu-id="6a4cb-154">Zależności Iniekcja można skonfigurować aplikacji na używanie fałszywych danych lub usługi data catalog na żywo.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-154">Using Dependency Injection (DI), you can configure the application to use the fake data or the live catalog data service.</span></span> <span data-ttu-id="6a4cb-155">(Wyjaśnijmy więcej o Podpisane wkrótce.) Kod uruchomienia odczytuje ustawienie useFake z plików web.config i konfiguruje kontenera Autofac iniekcję usługę fałszywych danych lub usługa katalogowa na żywo.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-155">(We will explain more about DI shortly.) The startup code reads a useFake setting from the web.config files, and configures the Autofac container to inject either the fake data service or the live catalog service.</span></span> <span data-ttu-id="6a4cb-156">Po uruchomieniu aplikacji z useFake ustawiona na wartość false w pliku web.config, zobaczysz wyświetlanie danych wykazu aplikacji formularzy sieci Web.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-156">If you run the application with useFake set to false in the web.config file, you see the Web Forms application displaying the catalog data.</span></span>

<span data-ttu-id="6a4cb-157">Większość technik w tej aplikacji należy znać bardzo dla każdego, kto został użyty formularzy sieci Web.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-157">Most of the techniques used in this application should be very familiar to anyone who has used Web Forms.</span></span> <span data-ttu-id="6a4cb-158">Jednak mikrousługi katalogu wprowadzono dwie metody, które mogą być nieznane: zależność Iniekcja, który został wcześniej wspomniano, i pracy z magazynami danych asynchronicznych w formularzach sieci Web.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-158">However, the catalog microservice introduces two techniques that might be unfamiliar: Dependency Injection (DI), which was mentioned earlier, and working with asynchronous data stores in Web Forms.</span></span>

<span data-ttu-id="6a4cb-159">Podpisane odwraca typowe strategii zorientowane obiektowo zapisywania klasy, które przydzielić wszystkich niezbędnych zasobów.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-159">DI inverts the typical object-oriented strategy of writing classes that allocate all needed resources.</span></span> <span data-ttu-id="6a4cb-160">Zamiast tego klasy żądania ich zależności z kontenera usług.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-160">Instead, classes request their dependencies from a service container.</span></span> <span data-ttu-id="6a4cb-161">Zaletą Podpisane jest, że można zastąpić usług zewnętrznych elementów sztucznych (mocks) do obsługi środowisk testowych lub innych.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-161">The advantage of DI is that you can replace external services with fakes (mocks) to support testing or other environments.</span></span>

<span data-ttu-id="6a4cb-162">Kontener Podpisane korzysta z konfiguracji appSettings pliku web.config do kontrolowania, czy używać katalogu fałszywych danych lub dane na żywo z uruchomionej usługi.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-162">The DI container uses the web.config appSettings configuration to control whether to use the fake catalog data or the live data from the running service.</span></span> <span data-ttu-id="6a4cb-163">Aplikacja rejestruje HttpModule obiektu, który tworzy kontener i rejestruje program obsługi żądania wstępnego wstrzyknięcia zależności.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-163">The application registers an HttpModule object that builds the container and registers a pre-request handler to inject dependencies.</span></span> <span data-ttu-id="6a4cb-164">Można wyświetlić kod w pliku Modules/AutoFacHttpModule.cs, który wygląda jak w następującym przykładzie:</span><span class="sxs-lookup"><span data-stu-id="6a4cb-164">You can see that code in the Modules/AutoFacHttpModule.cs file, which looks like the following example:</span></span>

```cs
private static IContainer CreateContainer()
{
  // Configure AutoFac:
  // Register Containers:

  var settings = WebConfigurationManager.AppSettings;
  var useFake = settings["usefake"];
  bool fake = useFake == "true";
  var builder = new ContainerBuilder();

  if (fake)
  {
    builder.RegisterType<CatalogMockService>()
    .As<ICatalogService>();
  }
  else
  {
    builder.RegisterType<CatalogService>()
    .As<ICatalogService>();
    builder.RegisterType<RequestProvider>()
    .As<IRequestProvider>();
  }

  var container = builder.Build();
  return container;
}

private void InjectDependencies()
{
  if (HttpContext.Current.CurrentHandler is Page page)
  {
    // Get the code-behind class that we may have written
    var pageType = page.GetType().BaseType;

    // Determine if there is a constructor to inject, and grab it
    var ctor = (from c in pageType.GetConstructors()
                where c.GetParameters().Length > 0
                select c).FirstOrDefault();

    if (ctor != null)
    {
      // Resolve the parameters for the constructor
      var args = (from parm in ctor.GetParameters()
                  select Container.Resolve(parm.ParameterType))
                  .ToArray();

      // Execute the constructor method with the arguments resolved
      ctor.Invoke(page, args);
    }

    // Use the Autofac method to inject any
    // properties that can be filled by Autofac
    Container.InjectProperties(page);
  }
}
```

<span data-ttu-id="6a4cb-165">Strony aplikacji (Default.aspx.cs i EditPage.aspx.cs) definiować konstruktorów przyjmujących te zależności.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-165">The application’s pages (Default.aspx.cs and EditPage.aspx.cs) define constructors that take these dependencies.</span></span> <span data-ttu-id="6a4cb-166">Należy pamiętać, że domyślny konstruktor jest nadal istnieje i jest dostępny.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-166">Note that the default constructor is still present and accessible.</span></span> <span data-ttu-id="6a4cb-167">Infrastruktura musi mieć następujący kod.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-167">The infrastructure needs the following code.</span></span>

```cs
protected _Default() { }

public _Default(ICatalogService catalog) => this.catalog = catalog;
```

<span data-ttu-id="6a4cb-168">Wykaz interfejsów API są wszystkie asynchronicznej metody.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-168">The catalog APIs are all asynchronous methods.</span></span> <span data-ttu-id="6a4cb-169">Formularze sieci Web obsługuje teraz tych opcji dla wszystkich kontrolek danych.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-169">Web Forms now supports these for all data controls.</span></span> <span data-ttu-id="6a4cb-170">Aplikacja Catalog.WebForms listy używane powiązanie modelu i Edycja stron; formanty na stronach zdefiniuj SelectMethod, metody UpdateMethod InsertMethod i DeleteMethod właściwości, które określają umożliwiające zwracanie zadań operacji asynchronicznych.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-170">The Catalog.WebForms application uses model binding for the list and edit pages; controls on the pages define SelectMethod, UpdateMethod, InsertMethod, and DeleteMethod properties that specify Task-returning asynchronous operations.</span></span> <span data-ttu-id="6a4cb-171">Formanty formularzy sieci Web zrozumieć, kiedy są asynchroniczne metody związany z formantem.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-171">Web Forms controls understand when the methods bound to a control are asynchronous.</span></span> <span data-ttu-id="6a4cb-172">Tylko ograniczenie wystąpią podczas używanie metod asynchronicznych select jest, że nie obsługuje stronicowania.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-172">The only restriction you encounter when using asynchronous select methods is that you cannot support paging.</span></span> <span data-ttu-id="6a4cb-173">Podpis stronicowania wymaga parametru wyjściowego i metody asynchroniczne nie mogą mieć parametrów out.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-173">The paging signature requires an out parameter, and asynchronous methods cannot have out parameters.</span></span> <span data-ttu-id="6a4cb-174">Ta sama metoda jest używana w innych stron, które wymagają danych z usługi wykaz.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-174">This same technique is used on other pages that require data from the catalog service.</span></span>

<span data-ttu-id="6a4cb-175">Konfigurację domyślną dla wykazu aplikacji formularzy sieci Web używa usługi catalog.api implementację testową.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-175">The default configuration for the catalog Web Forms application uses a mock implementation of the catalog.api service.</span></span> <span data-ttu-id="6a4cb-176">Ta makiety używa obiektu dataset ustalony danych, co upraszcza niektórych zadań przez usunięcie zależności od usługi catalog.api w środowiskach programistycznych.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-176">This mock uses a hard-coded dataset for its data, which simplifies some tasks by removing the dependency on the catalog.api service in development environments.</span></span>

## <a name="lifting-and-shifting"></a><span data-ttu-id="6a4cb-177">Podnoszenia i przesuwanie</span><span class="sxs-lookup"><span data-stu-id="6a4cb-177">Lifting and shifting</span></span>

<span data-ttu-id="6a4cb-178">Visual Studio zapewnia obsługę dużą containerizing aplikacji.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-178">Visual Studio provides great support for containerizing an application.</span></span> <span data-ttu-id="6a4cb-179">Kliknij prawym przyciskiem myszy węzeł projektu, a następnie wybierz **Dodaj** i **Obsługa Docker**.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-179">You right-click the project node and then select **Add** and **Docker Support**.</span></span> <span data-ttu-id="6a4cb-180">Szablon projektu Docker dodaje nowy projekt w rozwiązaniu o nazwie **docker-tworzą**.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-180">The Docker project template adds a new project to the solution called **docker-compose**.</span></span> <span data-ttu-id="6a4cb-181">Projekt zawiera zasoby Docker compose (lub kompilacji) obrazów należy i uruchamiania niezbędne kontenerów, jak pokazano na rysunku 7-3.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-181">The project contains the Docker assets that compose (or build) the images you need, and starts running the necessary containers, as shown in Figure 7-3.</span></span>

<span data-ttu-id="6a4cb-182">W najprostszej scenariuszach przyrostu i shift aplikacja będzie jednej usługi używanego dla aplikacji formularzy sieci Web.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-182">In the simplest lift-and-shift scenarios, the application will be the single service that you use for the Web Forms application.</span></span> <span data-ttu-id="6a4cb-183">Szablon również zmieni Twój projekt startowy, aby wskazywał **rozwiązania docker compose** projektu.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-183">The template also changes your startup project to point to the **docker-compose** project.</span></span> <span data-ttu-id="6a4cb-184">Teraz naciśnięcie klawisza Ctrl + F5 lub F5 tworzy obraz Docker i uruchamia kontenera Docker.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-184">Pressing Ctrl+F5 or F5 now creates the Docker image and launches the Docker container.</span></span>

![](./media/image3.png)

<span data-ttu-id="6a4cb-185">**Rysunek 7-3**.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-185">**Figure 7-3**.</span></span> <span data-ttu-id="6a4cb-186">**Rozwiązania docker compose** projektu w rozwiązaniu formularzy sieci Web</span><span class="sxs-lookup"><span data-stu-id="6a4cb-186">The **docker-compose** project in the Web Forms solution</span></span>

<span data-ttu-id="6a4cb-187">Przed uruchomieniem rozwiązania, należy się upewnić skonfigurowanie Docker do użycia kontenery systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-187">Before you run the solution, you must make sure that you configure Docker to use Windows Containers.</span></span> <span data-ttu-id="6a4cb-188">W tym celu należy kliknij prawym przyciskiem myszy ikonę na pasku zadań Docker w systemach Windows i wybierz **przełączyć się do systemu Windows kontenery**, jak pokazano na rysunku 7-4.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-188">To do that, you right-click the Docker taskbar icon in Windows and select **Switch to Windows Containers**, as shown in Figure 7-4.</span></span>

![](./media/image4.png)

<span data-ttu-id="6a4cb-189">**Rysunek 7-4**.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-189">**Figure 7-4**.</span></span> <span data-ttu-id="6a4cb-190">Przełączanie do kontenerów systemu Windows z Docker ikona na pasku zadań systemu Windows</span><span class="sxs-lookup"><span data-stu-id="6a4cb-190">Switching to Windows Containers from the Docker taskbar icon in Windows</span></span>

<span data-ttu-id="6a4cb-191">Jeśli element menu **przełączyć się do kontenerów Linux**, korzystasz już z Docker z kontenery systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-191">If the menu item says **Switch to Linux containers**, you are already running Docker with Windows Containers.</span></span>

<span data-ttu-id="6a4cb-192">Uruchamianie rozwiązania ponownym uruchomieniu hostów Docker.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-192">Running the solution restarts the Docker host.</span></span> <span data-ttu-id="6a4cb-193">Podczas tworzenia, kompilowania aplikacji i Docker obrazu dla projektu formularzy sieci Web.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-193">When you build, you build the application and the Docker image for the Web Forms project.</span></span> <span data-ttu-id="6a4cb-194">Można to zrobić, po raz pierwszy zajmuje wiele czasu.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-194">The first time you do this, it takes considerable time.</span></span> <span data-ttu-id="6a4cb-195">Jest to spowodowane proces kompilacji pobiera podstawowy obraz systemu Windows Server i dodatkowe obrazu dla platformy ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-195">This is because the build process pulls down the base Windows Server image and the additional image for ASP.NET.</span></span> <span data-ttu-id="6a4cb-196">Kolejne kompilacji i cykli uruchamiania będzie znacznie szybsze.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-196">Subsequent build and run cycles will be much faster.</span></span>

<span data-ttu-id="6a4cb-197">Spójrzmy bardziej pliki dodane przez szablon projektu Docker.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-197">Let’s take a deeper look at the files added by the Docker project template.</span></span> <span data-ttu-id="6a4cb-198">Kilka plików ono utworzone automatycznie.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-198">It created several files for you.</span></span> <span data-ttu-id="6a4cb-199">Visual Studio będzie korzystać do tworzenia obrazu Docker i kontener uruchamianie tych plików.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-199">Visual Studio uses these files to create the Docker image and launch a container.</span></span> <span data-ttu-id="6a4cb-200">Aby ręcznie uruchomić polecenia Docker, można użyć tych samych plików z poziomu interfejsu wiersza polecenia.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-200">You can use the same files from the CLI to run Docker commands manually.</span></span>

<span data-ttu-id="6a4cb-201">W poniższym przykładzie plik Dockerfile przedstawiono podstawowe ustawienia tworzenia obrazu Docker, na podstawie obrazu platformy ASP.NET w systemie Windows, uruchomioną witryny ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-201">The following Dockerfile example shows the basic settings for building a Docker image based on the Windows ASP.NET image that runs an ASP.NET site.</span></span>

```
FROM microsoft/aspnet

ARG source

WORKDIR /inetpub/wwwroot

COPY ${source:-obj/Docker/publish} .
```

<span data-ttu-id="6a4cb-202">Ten plik Dockerfile będzie wyglądają bardzo podobnie do utworzonych na uruchamianie aplikacji platformy ASP.NET Core w kontenerach systemu Linux.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-202">This Dockerfile will look very similar to those created for running an ASP.NET Core application in Linux containers.</span></span> <span data-ttu-id="6a4cb-203">Istnieje jednak kilka istotnych różnic.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-203">However, there are a few important differences.</span></span> <span data-ttu-id="6a4cb-204">Najbardziej istotną różnicą jest to podstawowy obraz microsoft/aspnet, czyli bieżącego obrazu systemu Windows Server, który zawiera programu .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-204">The most important difference is that the base image is microsoft/aspnet, which is the current Windows Server image that includes the .NET Framework.</span></span> <span data-ttu-id="6a4cb-205">Inne różnice są różne katalogi, skopiować z katalogu źródłowego.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-205">Other differences are that the directories copied from your source directory are different.</span></span>

<span data-ttu-id="6a4cb-206">Pliki w **docker-tworzą** projektu są potrzebne do tworzenia i konfigurowania kontenery zasoby Docker.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-206">The other files in the **docker-compose** project are the Docker assets needed to build and configure the containers.</span></span> <span data-ttu-id="6a4cb-207">Visual Studio umieszcza różne pliki docker-compose.yml w jeden węzeł, aby wyróżnić korzystania z nich.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-207">Visual Studio puts the various docker-compose.yml files under one node to highlight how they are used.</span></span> <span data-ttu-id="6a4cb-208">Plik podstawowy docker-compose zawiera dyrektywy, które są wspólne dla wszystkich konfiguracji.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-208">The base docker-compose file contains the directives that are common to all configurations.</span></span> <span data-ttu-id="6a4cb-209">Plik docker-compose.override.yml zawiera zmienne środowiskowe i powiązane zastąpienia dewelopera konfiguracja.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-209">The docker-compose.override.yml file contains environment variables and related overrides for a developer configuration.</span></span> <span data-ttu-id="6a4cb-210">Wariantów o. vs.debug i. vs.release Podaj ustawienia środowiska, które umożliwiają Visual Studio, aby dołączyć do i zarządzanie nimi uruchomionych kontenera.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-210">The variants with .vs.debug and .vs.release provide environment settings that enable Visual Studio to attach to and manage the running container.</span></span>

<span data-ttu-id="6a4cb-211">Podczas integracji z programem Visual Studio jest dodanie obsługi Docker do rozwiązania, możesz również skompilować i uruchomić z wiersza polecenia przy użyciu rozwiązania docker-tworzą zapasowej polecenia, jak przedstawiono w poprzednich sekcjach.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-211">While Visual Studio integration is part of adding Docker support to your solution, you can also build and run from the command line, using the docker-compose up command, as you saw in previous sections.</span></span>

## <a name="getting-data-from-the-existing-catalog-net-core-microservice"></a><span data-ttu-id="6a4cb-212">Pobieranie danych z istniejącego mikrousługi .NET Core katalogu</span><span class="sxs-lookup"><span data-stu-id="6a4cb-212">Getting data from the existing catalog .NET Core microservice</span></span>

<span data-ttu-id="6a4cb-213">Można skonfigurować aplikacji formularzy sieci Web do używania mikrousługi katalogu eShopOnContainers można pobrać danych zamiast fałszywych danych.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-213">You can configure the Web Forms application to use the eShopOnContainers catalog microservice to get data instead of using fake data.</span></span> <span data-ttu-id="6a4cb-214">W tym celu należy zmodyfikować plik web.config i ustaw wartość klucza useFake na wartość false.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-214">To do this, you edit the web.config file and set the value of the useFake key to false.</span></span> <span data-ttu-id="6a4cb-215">Kontener Podpisane użyje klasy, która uzyskuje dostęp do mikrousługi katalogu na żywo, zamiast klasy, która zwraca dane ustalony.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-215">The DI container will use the class that accesses the live catalog microservice instead of the class that returns the hard-coded data.</span></span> <span data-ttu-id="6a4cb-216">Niezbędne są inne zmiany kodu.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-216">No other code changes are needed.</span></span>

<span data-ttu-id="6a4cb-217">Uzyskiwanie dostępu do usługi katalogu na żywo oznacza należy zaktualizować **rozwiązania docker compose** projektu do tworzenia obrazu usługi katalogu i uruchom katalogu kontenera usług.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-217">Accessing the live catalog service does mean you need to update the **docker-compose** project to build the catalog service image and launch the catalog service container.</span></span> <span data-ttu-id="6a4cb-218">CE docker dla systemu Windows obsługuje kontenery systemu Linux i kontenery systemu Windows, ale nie w tym samym czasie.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-218">Docker CE for Windows supports both Linux containers and Windows Containers, but not at the same time.</span></span> <span data-ttu-id="6a4cb-219">Aby uruchomić mikrousługi katalogu, jest potrzebne do tworzenia obrazu, który uruchamia mikrousługi katalogu na górze kontenera usługi systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-219">To run the catalog microservice, you need to build an image that runs the catalog microservice on top of a Windows-based container.</span></span> <span data-ttu-id="6a4cb-220">Takie podejście wymaga inny plik Dockerfile dla projektu mikrousług niż przejrzane we wcześniejszych sekcjach.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-220">This approach requires a different Dockerfile for the microservices project than you have seen in earlier sections.</span></span> <span data-ttu-id="6a4cb-221">Plik Dockerfile.windows zawiera ustawienia konfiguracji, aby utworzyć obraz kontenera katalogu interfejsu API, dzięki czemu uruchamia się w kontenerze systemu Windows — na przykład, aby użyć obrazu systemu Windows Nano Docker.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-221">The Dockerfile.windows file contains the configuration settings to build the catalog API container image so that it runs on a Windows container—for example, to use a Windows Nano Docker image.</span></span>

<span data-ttu-id="6a4cb-222">Mikrousługi katalogu korzysta z bazy danych programu SQL Server.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-222">The catalog microservice relies on the SQL Server database.</span></span> <span data-ttu-id="6a4cb-223">W związku z tym należy użyć do obrazu systemu Windows Docker serwera SQL.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-223">Therefore, you need to use a Windows-based SQL Server Docker image as well.</span></span>

<span data-ttu-id="6a4cb-224">Po wprowadzeniu tych zmian projektu docker-compose jest więcej, aby uruchomić aplikację.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-224">After these changes, the docker-compose project does more to start the application.</span></span> <span data-ttu-id="6a4cb-225">Projekt rozpocznie się teraz na serwerze SQL przy użyciu obrazu serwera SQL na podstawie systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-225">The project now starts the SQL Server using the Windows based SQL Server image.</span></span> <span data-ttu-id="6a4cb-226">Mikrousługi katalogu rozpoczyna się w kontenerze systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-226">It starts the catalog microservice in a Windows container.</span></span> <span data-ttu-id="6a4cb-227">I również rozpoczyna kontenerze Edytor formularzy sieci Web wykazu w kontenerze systemu Windows.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-227">And it starts the Web Forms catalog editor container, also in a Windows container.</span></span> <span data-ttu-id="6a4cb-228">Jeśli obrazy potrzeby budynku, najpierw tworzone są obrazy.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-228">If any of the images need building, the images are created first.</span></span>

## <a name="development-and-production-environments"></a><span data-ttu-id="6a4cb-229">Środowiska deweloperskie i produkcji</span><span class="sxs-lookup"><span data-stu-id="6a4cb-229">Development and production environments</span></span>

<span data-ttu-id="6a4cb-230">Istnieje kilka różnic między konfiguracji Programowanie i produkcji.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-230">There are a couple of differences between the development configuration and a production configuration.</span></span> <span data-ttu-id="6a4cb-231">W środowisku programistycznym możesz uruchomić aplikacji formularzy sieci Web, katalogu mikrousługi i SQL Server w kontenerach systemu Windows w ramach tego samego hosta Docker.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-231">In the development environment, you run the Web Forms application, the catalog microservice, and SQL Server in Windows Containers, as part of the same Docker host.</span></span> <span data-ttu-id="6a4cb-232">We wcześniejszych sekcjach wspomniano obrazów programu SQL Server wdrożony w tym samym hoście Docker jako inne na podstawie .NET Core usługi na hoście Docker opartych na systemie Linux.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-232">In earlier sections, we mentioned SQL Server images deployed in the same Docker host as the other .NET Core-based services on a Linux-based Docker host.</span></span> <span data-ttu-id="6a4cb-233">Zaletą uruchamiania wielu mikrousług w tym samym hoście Docker (lub klastra) jest o mniej komunikacji sieciowej i komunikacji między kontenery ma mniejsze opóźnienia.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-233">The advantage of running the multiple microservices in the same Docker host (or cluster) is that there is less network communication and the communication between containers has lower latency.</span></span>

<span data-ttu-id="6a4cb-234">W środowisku programistycznym możesz uruchomić wszystkie kontenery w tej samej wersji systemu operacyjnego.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-234">In the development environment, you must run all the containers in the same OS.</span></span> <span data-ttu-id="6a4cb-235">CE docker dla systemu Windows nie obsługuje uruchamiania kontenery z systemem Windows i Linux w tym samym czasie.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-235">Docker CE for Windows does not support running Windows- and Linux-based containers at the same time.</span></span> <span data-ttu-id="6a4cb-236">W środowisku produkcyjnym można zdecydować, czy chcesz uruchomić mikrousługi katalogu w kontenerze systemu Windows w jednym Docker hosta (lub klastra) lub formularzy sieci Web aplikacji komunikują się z wystąpieniem mikrousługi katalogu uruchomione w kontenerze systemu Linux na inną Docker host.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-236">In production, you can decide if you want to run the catalog microservice in a Windows container in a single Docker host (or cluster), or have the Web Forms application communicate with an instance of the catalog microservice running in a Linux container on a different Docker host.</span></span> <span data-ttu-id="6a4cb-237">To zależy od sposobu Optymalizuj dla opóźnienia sieci.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-237">It depends on how you want to optimize for network latency.</span></span> <span data-ttu-id="6a4cb-238">W większości przypadków ma mikrousług, które aplikacje są zależne od uruchomione w tym samym hoście Docker (lub swarm) w celu ułatwienia wdrażania oraz mniejsze opóźnienia komunikacji.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-238">In most cases, you want the microservices that your applications depend on running in the same Docker host (or swarm) for ease of deployment and lower communication latency.</span></span> <span data-ttu-id="6a4cb-239">W tych konfiguracjach tylko kosztowne komunikacji jest między wystąpieniami mikrousługi i serwery wysokiej dostępności dla magazynu danych.</span><span class="sxs-lookup"><span data-stu-id="6a4cb-239">In those configurations, the only costly communications is between the microservice instances and the high-availability servers for the persistent data storage.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="6a4cb-240">[Poprzednie] (.. / net-core-single-containers-linux-windows-server-hosts/index.md) [dalej] (.. /Multi-container-microservice-NET-Applications/index.MD)</span><span class="sxs-lookup"><span data-stu-id="6a4cb-240">[Previous] (../net-core-single-containers-linux-windows-server-hosts/index.md) [Next] (../multi-container-microservice-net-applications/index.md)</span></span>
