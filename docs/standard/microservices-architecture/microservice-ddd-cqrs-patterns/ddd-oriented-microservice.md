---
title: Projektowanie zorientowane na DDD mikrousługi
description: Architektura Mikrousług .NET dla aplikacji .NET konteneryzowanych | Projektowanie zorientowane na DDD mikrousługi
keywords: Docker, Microservices, ASP.NET, Container
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 11/06/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: d2d07abe55f30e0b12a7f0cba937abd1b7e32629
ms.sourcegitcommit: 2e8acae16ae802f2d6d04e3ce0a6dbf04e476513
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/18/2018
---
# <a name="designing-a-ddd-oriented-microservice"></a><span data-ttu-id="3d43c-104">Projektowanie zorientowane na DDD mikrousługi</span><span class="sxs-lookup"><span data-stu-id="3d43c-104">Designing a DDD-oriented microservice</span></span>

<span data-ttu-id="3d43c-105">Projektowanie oparte na domenie (DDD) zaleca modelowania w oparciu firm jako istotne dla Twojej przypadki użycia zasobów rzeczywistymi.</span><span class="sxs-lookup"><span data-stu-id="3d43c-105">Domain-driven design (DDD) advocates modeling based on the reality of business as relevant to your use cases.</span></span> <span data-ttu-id="3d43c-106">W kontekście tworzenia aplikacji DDD zawiera informacje o problemach jako domeny.</span><span class="sxs-lookup"><span data-stu-id="3d43c-106">In the context of building applications, DDD talks about problems as domains.</span></span> <span data-ttu-id="3d43c-107">Opisuje obszarów problemów niezależne jako kontekstów ograniczone (każdy kontekst ograniczone skorelowany mikrousługi) i jest kładzie nacisk wspólnego języka aby porozmawiać na temat tych problemów.</span><span class="sxs-lookup"><span data-stu-id="3d43c-107">It describes independent problem areas as Bounded Contexts (each Bounded Context correlates to a microservice), and emphasizes a common language to talk about these problems.</span></span> <span data-ttu-id="3d43c-108">Podano tu także wiele zagadnienia techniczne i wzorców, takich jak jednostki domeny przy użyciu zaawansowanych modeli (nie [modelu domeny anemic](https://martinfowler.com/bliki/AnemicDomainModel.html)), wartość obiektów, agreguje i agregacji główny (lub podmiot główny) reguły do obsługi wewnętrznej implementacji.</span><span class="sxs-lookup"><span data-stu-id="3d43c-108">It also suggests many technical concepts and patterns, like domain entities with rich models (no [anemic-domain model](https://martinfowler.com/bliki/AnemicDomainModel.html)), value objects, aggregates and aggregate root (or root entity) rules to support the internal implementation.</span></span> <span data-ttu-id="3d43c-109">W tej sekcji przedstawiono projekt i implementację wewnętrzne zaczną obowiązywać.</span><span class="sxs-lookup"><span data-stu-id="3d43c-109">This section introduces the design and implementation of those internal patterns.</span></span>

<span data-ttu-id="3d43c-110">Czasami te reguły techniczne DDD i wzorce są postrzegane jako przeszkód, które mają problemy z ich opanowaniem nauki implementacji metod DDD.</span><span class="sxs-lookup"><span data-stu-id="3d43c-110">Sometimes these DDD technical rules and patterns are perceived as obstacles that have a steep learning curve for implementing DDD approaches.</span></span> <span data-ttu-id="3d43c-111">Ale ważnym elementem jest nie wzorców, ale organizowania kodu, więc jest wyrównywany do problemów biznesowych i przy użyciu tych samych warunków biznesowych (powszechny language).</span><span class="sxs-lookup"><span data-stu-id="3d43c-111">But the important part is not the patterns themselves, but organizing the code so it is aligned to the business problems, and using the same business terms (ubiquitous language).</span></span> <span data-ttu-id="3d43c-112">Ponadto podejścia DDD powinny być stosowane tylko wtedy, gdy wdraża mikrousług złożonych reguł biznesowych znaczące.</span><span class="sxs-lookup"><span data-stu-id="3d43c-112">In addition, DDD approaches should be applied only if you are implementing complex microservices with significant business rules.</span></span> <span data-ttu-id="3d43c-113">Obowiązki prostszy, takich jak usługi CRUD, można zarządzać za pomocą metod prostsze.</span><span class="sxs-lookup"><span data-stu-id="3d43c-113">Simpler responsibilities, like a CRUD service, can be managed with simpler approaches.</span></span>

<span data-ttu-id="3d43c-114">Gdzie ma zostać narysowany granice jest klucza zadań podczas projektowania i definiowania mikrousługi.</span><span class="sxs-lookup"><span data-stu-id="3d43c-114">Where to draw the boundaries is the key task when designing and defining a microservice.</span></span> <span data-ttu-id="3d43c-115">Wzorce DDD pomaga w zrozumieniu złożoności w domenie.</span><span class="sxs-lookup"><span data-stu-id="3d43c-115">DDD patterns help you understand the complexity in the domain.</span></span> <span data-ttu-id="3d43c-116">Dla modelu domeny dla każdego z ograniczonym kontekstu identyfikowanie i definiowanie jednostek, obiekty wartości i wartości zagregowane, które modelu domeny.</span><span class="sxs-lookup"><span data-stu-id="3d43c-116">For the domain model for each Bounded Context, you identify and define the entities, value objects, and aggregates that model your domain.</span></span> <span data-ttu-id="3d43c-117">Skompiluj i Dostosuj modelu domeny, który znajduje się w obrębie granicy, który definiuje kontekstu.</span><span class="sxs-lookup"><span data-stu-id="3d43c-117">You build and refine a domain model that is contained within a boundary that defines your context.</span></span> <span data-ttu-id="3d43c-118">I jest bardzo jawne w formie mikrousługi.</span><span class="sxs-lookup"><span data-stu-id="3d43c-118">And that is very explicit in the form of a microservice.</span></span> <span data-ttu-id="3d43c-119">Składniki w tych granicach przechodzili są Twoje mikrousług, chociaż w niektórych przypadkach a BC lub mikrousług biznesowych może składać się z kilku usług fizycznych.</span><span class="sxs-lookup"><span data-stu-id="3d43c-119">The components within those boundaries end up being your microservices, although in some cases a BC or business microservices can be composed of several physical services.</span></span> <span data-ttu-id="3d43c-120">DDD dotyczy granice i są mikrousług.</span><span class="sxs-lookup"><span data-stu-id="3d43c-120">DDD is about boundaries and so are microservices.</span></span>

## <a name="keep-the-microservice-context-boundaries-relatively-small"></a><span data-ttu-id="3d43c-121">Zachowaj mikrousługi granice kontekstu stosunkowo mały</span><span class="sxs-lookup"><span data-stu-id="3d43c-121">Keep the microservice context boundaries relatively small</span></span>

<span data-ttu-id="3d43c-122">Określanie, gdzie umieścić granicę między ograniczone kontekstów równoważy dwóch celów konkurencyjnych.</span><span class="sxs-lookup"><span data-stu-id="3d43c-122">Determining where to place boundaries between Bounded Contexts balances two competing goals.</span></span> <span data-ttu-id="3d43c-123">Najpierw chcesz początkowo utworzyć najmniejsza możliwa mikrousług, chociaż nie powinny zostać sterownik main; należy utworzyć obramowanie rzeczy, które wymagają spójności.</span><span class="sxs-lookup"><span data-stu-id="3d43c-123">First, you want to initially create the smallest possible microservices, although that should not be the main driver; you should create a boundary around things that need cohesion.</span></span> <span data-ttu-id="3d43c-124">Po drugie chce się uniknąć chatty komunikacji między mikrousług.</span><span class="sxs-lookup"><span data-stu-id="3d43c-124">Second, you want to avoid chatty communications between microservices.</span></span> <span data-ttu-id="3d43c-125">Tych celów mogą być sprzeczne z sobą.</span><span class="sxs-lookup"><span data-stu-id="3d43c-125">These goals can contradict one another.</span></span> <span data-ttu-id="3d43c-126">Należy je równoważenie przez decomposing systemu na tyle mały mikrousług, jak to możliwe, aż zostanie wyświetlony granice komunikacji szybko rośnie z każdego dodatkowych prób do oddzielania nowy kontekst ograniczone.</span><span class="sxs-lookup"><span data-stu-id="3d43c-126">You should balance them by decomposing the system into as many small microservices as you can until you see communication boundaries growing quickly with each additional attempt to separate a new Bounded Context.</span></span> <span data-ttu-id="3d43c-127">Spójności jest klucz w pojedynczym kontekście ograniczone.</span><span class="sxs-lookup"><span data-stu-id="3d43c-127">Cohesion is key within a single bounded context.</span></span>

<span data-ttu-id="3d43c-128">Jest on podobny do [Intimacy nieodpowiedni kod zapachu](https://sourcemaking.com/refactoring/smells/inappropriate-intimacy) podczas implementowania klas.</span><span class="sxs-lookup"><span data-stu-id="3d43c-128">It is similar to the [Inappropriate Intimacy code smell](https://sourcemaking.com/refactoring/smells/inappropriate-intimacy) when implementing classes.</span></span> <span data-ttu-id="3d43c-129">Jeśli dwa mikrousług potrzeba znacznie współpracują ze sobą, prawdopodobnie powinny być tym samym mikrousługi.</span><span class="sxs-lookup"><span data-stu-id="3d43c-129">If two microservices need to collaborate a lot with each other, they should probably be the same microservice.</span></span>

<span data-ttu-id="3d43c-130">Innym sposobem na niego jest autonomiczne.</span><span class="sxs-lookup"><span data-stu-id="3d43c-130">Another way to look at this is autonomy.</span></span> <span data-ttu-id="3d43c-131">Jeśli mikrousługi należy zależą od innej usługi bezpośrednio obsługi żądania, nie jest rzeczywiście autonomicznego.</span><span class="sxs-lookup"><span data-stu-id="3d43c-131">If a microservice must rely on another service to directly service a request, it is not truly autonomous.</span></span>

## <a name="layers-in-ddd-microservices"></a><span data-ttu-id="3d43c-132">Warstwy mikrousług DDD</span><span class="sxs-lookup"><span data-stu-id="3d43c-132">Layers in DDD microservices</span></span>

<span data-ttu-id="3d43c-133">Większość aplikacji przedsiębiorstwa firma i złożonością techniczne wynika z wielu warstw.</span><span class="sxs-lookup"><span data-stu-id="3d43c-133">Most enterprise applications with significant business and technical complexity are defined by multiple layers.</span></span> <span data-ttu-id="3d43c-134">Warstwy są artefaktu logicznych i nie są związane z wdrożenia usługi.</span><span class="sxs-lookup"><span data-stu-id="3d43c-134">The layers are a logical artifact, and are not related to the deployment of the service.</span></span> <span data-ttu-id="3d43c-135">Istnieją one pomóc deweloperom w zarządzaniu złożonością w kodzie.</span><span class="sxs-lookup"><span data-stu-id="3d43c-135">They exist to help developers manage the complexity in the code.</span></span> <span data-ttu-id="3d43c-136">Różnych warstwach (na przykład warstwy modelu domeny i warstwę prezentacji, itp.) może być różnych typów, które ma tłumaczenie między tymi typami.</span><span class="sxs-lookup"><span data-stu-id="3d43c-136">Different layers (like the domain model layer versus the presentation layer, etc.) might have different types, which mandates translations between those types.</span></span>

<span data-ttu-id="3d43c-137">Na przykład jednostki można załadować z bazy danych.</span><span class="sxs-lookup"><span data-stu-id="3d43c-137">For example, an entity could be loaded from the database.</span></span> <span data-ttu-id="3d43c-138">Następnie część informacji lub zagregowane informacje dodatkowe dane z innymi obiektami, mogą być wysyłane do klienta Interfejsu API sieci Web REST.</span><span class="sxs-lookup"><span data-stu-id="3d43c-138">Then part of that information, or an aggregation of information including additional data from other entities, can be sent to the client UI through a REST Web API.</span></span> <span data-ttu-id="3d43c-139">Punkt, w tym miejscu jest jednostką domeny znajduje się w ramach warstwy modelu domeny oraz nie powinien propagowane do innych obszarów, które nie należy ona do, tak samo, jak do warstwy prezentacji.</span><span class="sxs-lookup"><span data-stu-id="3d43c-139">The point here is that the domain entity is contained within the domain model layer and should not be propagated to other areas that it does not belong to, like to the presentation layer.</span></span>

<span data-ttu-id="3d43c-140">Ponadto musisz mieć zawsze prawidłowe jednostki (zobacz [projektowania poprawności warstwy modelu domeny](#designing-validations-in-the-domain-model-layer) sekcji) kontrolowane przez korzenie agregacji (jednostek głównego).</span><span class="sxs-lookup"><span data-stu-id="3d43c-140">Additionally, you need to have always-valid entities (see the [Designing validations in the domain model layer](#designing-validations-in-the-domain-model-layer) section) controlled by aggregate roots (root entities).</span></span> <span data-ttu-id="3d43c-141">W związku z tym jednostki powinien nie można powiązać z widokami klienta, ponieważ na poziomie interfejsu użytkownika część danych może nadal nie można sprawdzić poprawności.</span><span class="sxs-lookup"><span data-stu-id="3d43c-141">Therefore, entities should not be bound to client views, because at the UI level some data might still not be validated.</span></span> <span data-ttu-id="3d43c-142">Jest to co ViewModel dla.</span><span class="sxs-lookup"><span data-stu-id="3d43c-142">This is what the ViewModel is for.</span></span> <span data-ttu-id="3d43c-143">ViewModel to model danych wyłącznie na potrzeby warstwy prezentacji.</span><span class="sxs-lookup"><span data-stu-id="3d43c-143">The ViewModel is a data model exclusively for presentation layer needs.</span></span> <span data-ttu-id="3d43c-144">Jednostek domeny nie należy bezpośrednio do ViewModel.</span><span class="sxs-lookup"><span data-stu-id="3d43c-144">The domain entities do not belong directly to the ViewModel.</span></span> <span data-ttu-id="3d43c-145">Zamiast tego potrzebne jest tłumaczenie między jednostkami ViewModels i domeny i na odwrót.</span><span class="sxs-lookup"><span data-stu-id="3d43c-145">Instead, you need to translate between ViewModels and domain entities and vice versa.</span></span>

<span data-ttu-id="3d43c-146">Kiedy realizowanie złożoności, ważne jest, aby mieć modelu domeny kontrolowane przez katalogi agregacji upewnij się, że wszystkie invariants i reguły związane z tej grupy jednostek (agregacji) są wykonywane za pośrednictwem punktu pojedynczy wpis lub bramy, głównego agregacji.</span><span class="sxs-lookup"><span data-stu-id="3d43c-146">When tackling complexity, it is important to have a domain model controlled by aggregate roots that make sure that all the invariants and rules related to that group of entities (aggregate) are performed through a single entry-point or gate, the aggregate root.</span></span>

<span data-ttu-id="3d43c-147">Rysunek 9-5 zawiera implementowania warstwowego projektu w aplikacji eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="3d43c-147">Figure 9-5 shows how a layered design is implemented in the eShopOnContainers application.</span></span>

![](./media/image6.png)

<span data-ttu-id="3d43c-148">**Rysunek 9-5**.</span><span class="sxs-lookup"><span data-stu-id="3d43c-148">**Figure 9-5**.</span></span> <span data-ttu-id="3d43c-149">Warstwy DDD porządkowania mikrousługi w eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="3d43c-149">DDD layers in the ordering microservice in eShopOnContainers</span></span>

<span data-ttu-id="3d43c-150">Chcesz zaprojektować system tak, aby każda warstwa komunikuje się tylko z niektórych innych warstw.</span><span class="sxs-lookup"><span data-stu-id="3d43c-150">You want to design the system so that each layer communicates only with certain other layers.</span></span> <span data-ttu-id="3d43c-151">Może to być łatwiejsze do wymuszania Jeśli warstwy są zaimplementowane jako biblioteki inną klasę, ponieważ wyraźnie określenie, jakie zależności są ustawione między bibliotekami.</span><span class="sxs-lookup"><span data-stu-id="3d43c-151">That may be easier to enforce if layers are implemented as different class libraries, because you can clearly identify what dependencies are set between libraries.</span></span> <span data-ttu-id="3d43c-152">Na przykład warstwy modelu domeny nie powinna przyjmować zależności na inną warstwę (klasy modelu domeny powinien być zwykłym stare obiekty CLR lub [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object), klasy).</span><span class="sxs-lookup"><span data-stu-id="3d43c-152">For instance, the domain model layer should not take a dependency on any other layer (the domain model classes should be Plain Old CLR Objects, or [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object), classes).</span></span> <span data-ttu-id="3d43c-153">Jak pokazano w rysunku 9-6 **Ordering.Domain** Biblioteka warstwy ma zależności tylko w przypadku bibliotek .NET Core i pakiety NuGet, ale nie na inne niestandardowe biblioteki, takich jak dane biblioteki lub biblioteki trwałości.</span><span class="sxs-lookup"><span data-stu-id="3d43c-153">As shown in Figure 9-6, the **Ordering.Domain** layer library has dependencies only on the .NET Core libraries or NuGet packages, but not on any other custom library, such as data library or persistence library.</span></span>

![](./media/image7.PNG)

<span data-ttu-id="3d43c-154">**Rysunek 9 – 6**.</span><span class="sxs-lookup"><span data-stu-id="3d43c-154">**Figure 9-6**.</span></span> <span data-ttu-id="3d43c-155">Warstwy zaimplementowana bibliotek zapewnić lepszą kontrolę zależności między warstwami</span><span class="sxs-lookup"><span data-stu-id="3d43c-155">Layers implemented as libraries allow better control of dependencies between layers</span></span>

### <a name="the-domain-model-layer"></a><span data-ttu-id="3d43c-156">Warstwa modelu domeny</span><span class="sxs-lookup"><span data-stu-id="3d43c-156">The domain model layer</span></span>

<span data-ttu-id="3d43c-157">Marek Evans znakomity książki [konstrukcyjnych domeny](https://domainlanguage.com/ddd/) mówi następujące o warstwy modelu domeny i warstwy aplikacji.</span><span class="sxs-lookup"><span data-stu-id="3d43c-157">Eric Evans's excellent book [Domain Driven Design](https://domainlanguage.com/ddd/) says the following about the domain model layer and the application layer.</span></span>

<span data-ttu-id="3d43c-158">**Warstwa modelu domeny**: odpowiedzialny za reprezentujący założeń biznesowych, informacje dotyczące sytuacji i reguł biznesowych.</span><span class="sxs-lookup"><span data-stu-id="3d43c-158">**Domain Model Layer**: Responsible for representing concepts of the business, information about the business situation, and business rules.</span></span> <span data-ttu-id="3d43c-159">Stanu, które odzwierciedla sytuacji jest kontrolowany i używane w tym miejscu, mimo że szczegóły techniczne jego przechowywania mają delegowane do infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="3d43c-159">State that reflects the business situation is controlled and used here, even though the technical details of storing it are delegated to the infrastructure.</span></span> <span data-ttu-id="3d43c-160">Ta warstwa jest centralnym oprogramowanie firm.</span><span class="sxs-lookup"><span data-stu-id="3d43c-160">This layer is the heart of business software.</span></span>

<span data-ttu-id="3d43c-161">Warstwa modelu domeny jest, gdzie jest wyrażone biznesowe.</span><span class="sxs-lookup"><span data-stu-id="3d43c-161">The domain model layer is where the business is expressed.</span></span> <span data-ttu-id="3d43c-162">Po zaimplementowaniu mikrousługi warstwy modelu domeny w środowisku .NET tej warstwie jest zakodowane jako biblioteki klas z jednostkami domeny, które przechwytują dane oraz zachowanie (metody z logiką).</span><span class="sxs-lookup"><span data-stu-id="3d43c-162">When you implement a microservice domain model layer in .NET, that layer is coded as a class library with the domain entities that capture data plus behavior (methods with logic).</span></span>

<span data-ttu-id="3d43c-163">Po [nieznajomości trwałości](http://deviq.com/persistence-ignorance/) i [nieznajomości infrastruktury](https://ayende.com/blog/3137/infrastructure-ignorance) zasady, tej warstwy należy całkowicie Ignoruj szczegóły trwałość danych.</span><span class="sxs-lookup"><span data-stu-id="3d43c-163">Following the [Persistence Ignorance](http://deviq.com/persistence-ignorance/) and the [Infrastructure Ignorance](https://ayende.com/blog/3137/infrastructure-ignorance) principles, this layer must completely ignore data persistence details.</span></span> <span data-ttu-id="3d43c-164">Te zadania trwałości powinny być wykonywane przez warstwę infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="3d43c-164">These persistence tasks should be performed by the infrastructure layer.</span></span> <span data-ttu-id="3d43c-165">W związku z tym ta warstwa nie powinna przyjmować zależności bezpośrednich w infrastrukturze, co oznacza, że reguła ważne jest należy klas entity model domeny [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object)s.</span><span class="sxs-lookup"><span data-stu-id="3d43c-165">Therefore, this layer should not take direct dependencies on the infrastructure, which means that an important rule is that your domain model entity classes should be [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object)s.</span></span>

<span data-ttu-id="3d43c-166">Jednostek domeny nie powinien mieć żadnych zależności bezpośrednich (np. wynikające z klasy podstawowej) w dowolnej architektury infrastruktury dostępu do danych Entity Framework lub NHibernate.</span><span class="sxs-lookup"><span data-stu-id="3d43c-166">Domain entities should not have any direct dependency (like deriving from a base class) on any data access infrastructure framework like Entity Framework or NHibernate.</span></span> <span data-ttu-id="3d43c-167">Najlepiej, jeśli obiekty domeny powinien nie implementować lub pochodzić od dowolnego typu zdefiniowanego w dowolnej architektury infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="3d43c-167">Ideally, your domain entities should not derive from or implement any type defined in any infrastructure framework.</span></span>

<span data-ttu-id="3d43c-168">Większość nowoczesnych struktur ORM, takich jak Entity Framework Core Zezwalaj takie podejście, tak, aby w klasach modeli domeny nie są powiązane infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="3d43c-168">Most modern ORM frameworks like Entity Framework Core allow this approach, so that your domain model classes are not coupled to the infrastructure.</span></span> <span data-ttu-id="3d43c-169">Jednak po jednostki POCO nie zawsze jest możliwe podczas korzystania z niektórych baz danych NoSQL i platform, takich jak złośliwych użytkowników i niezawodne kolekcji w sieci szkieletowej usług Azure.</span><span class="sxs-lookup"><span data-stu-id="3d43c-169">However, having POCO entities is not always possible when using certain NoSQL databases and frameworks, like Actors and Reliable Collections in Azure Service Fabric.</span></span>

<span data-ttu-id="3d43c-170">Nawet wtedy, gdy jest to ważne jest, aby postępuj zgodnie z zasadą nieznajomości trwałości dla modelu domeny, nie należy zignorować dotyczy trwałości.</span><span class="sxs-lookup"><span data-stu-id="3d43c-170">Even when it is important to follow the Persistence Ignorance principle for you Domain model, you should not ignore persistence concerns.</span></span> <span data-ttu-id="3d43c-171">Nadal jest bardzo ważne zrozumieć modelu danych fizycznych i sposób mapowania modelu obiektu jednostki.</span><span class="sxs-lookup"><span data-stu-id="3d43c-171">It is still very important to understand the physical data model and how it maps to your entity object model.</span></span> <span data-ttu-id="3d43c-172">W przeciwnym razie można tworzyć projektów niemożliwe.</span><span class="sxs-lookup"><span data-stu-id="3d43c-172">Otherwise you can create impossible designs.</span></span>

<span data-ttu-id="3d43c-173">Ponadto oznacza to, możesz pobrać model przeznaczony do relacyjnej bazy danych i bezpośrednio Przenieś go do NoSQL lub zorientowane na dokument bazy danych.</span><span class="sxs-lookup"><span data-stu-id="3d43c-173">Also, this does not mean you can take a model designed for a relational database and directly move it to a NoSQL or document-oriented database.</span></span> <span data-ttu-id="3d43c-174">W niektórych modeli entity model mogą mieścić, ale zwykle nie.</span><span class="sxs-lookup"><span data-stu-id="3d43c-174">In some entity models, the model might fit, but usually it does not.</span></span> <span data-ttu-id="3d43c-175">Ograniczenia, które modelu jednostki musi być zgodne, na podstawie zarówno na technologii magazynowania i technologii ORM nadal istnieją.</span><span class="sxs-lookup"><span data-stu-id="3d43c-175">There are still constraints that your entity model must adhere to, based both on the storage technology and ORM technology.</span></span>

### <a name="the-application-layer"></a><span data-ttu-id="3d43c-176">Warstwa aplikacji</span><span class="sxs-lookup"><span data-stu-id="3d43c-176">The application layer</span></span>

<span data-ttu-id="3d43c-177">Przechodzi do warstwy aplikacji, możemy ponownie cytowanych książki marek Evans [konstrukcyjnych domeny](https://domainlanguage.com/ddd/):</span><span class="sxs-lookup"><span data-stu-id="3d43c-177">Moving on to the application layer, we can again cite Eric Evans's book [Domain Driven Design](https://domainlanguage.com/ddd/):</span></span>

<span data-ttu-id="3d43c-178">**Warstwa aplikacji:** definiuje zadań oprogramowania powinien wykonać i kieruje obiektów domeny obszerne opracowywanie problemów.</span><span class="sxs-lookup"><span data-stu-id="3d43c-178">**Application Layer:** Defines the jobs the software is supposed to do and directs the expressive domain objects to work out problems.</span></span> <span data-ttu-id="3d43c-179">Zadania, które ta warstwa jest odpowiedzialny za są przydatne w firmie lub niezbędne do interakcji z warstwy aplikacji innych systemów.</span><span class="sxs-lookup"><span data-stu-id="3d43c-179">The tasks this layer is responsible for are meaningful to the business or necessary for interaction with the application layers of other systems.</span></span> <span data-ttu-id="3d43c-180">Ta warstwa jest przechowywana elastycznej.</span><span class="sxs-lookup"><span data-stu-id="3d43c-180">This layer is kept thin.</span></span> <span data-ttu-id="3d43c-181">Nie zawiera reguły biznesowe lub wiedzy, ale tylko współrzędne zadań i delegatów pracy definicje współpracy obiektów domeny w warstwie dalej w dół.</span><span class="sxs-lookup"><span data-stu-id="3d43c-181">It does not contain business rules or knowledge, but only coordinates tasks and delegates work to collaborations of domain objects in the next layer down.</span></span> <span data-ttu-id="3d43c-182">Nie ma stanu w czasie wykonywania odbicia sytuacji, ale może mieć stanu, które odzwierciedla postęp zadania użytkownika lub programu.</span><span class="sxs-lookup"><span data-stu-id="3d43c-182">It does not have state reflecting the business situation, but it can have state that reflects the progress of a task for the user or the program.</span></span>

<span data-ttu-id="3d43c-183">Mikrousługi warstwy aplikacji w środowisku .NET jest często zakodowane jako projekt interfejsu API platformy ASP.NET Core sieci Web.</span><span class="sxs-lookup"><span data-stu-id="3d43c-183">A microservice’s application layer in .NET is commonly coded as an ASP.NET Core Web API project.</span></span> <span data-ttu-id="3d43c-184">Projekt implementuje mikrousługi interakcji, zdalny dostęp do sieci i użycia w aplikacji klienta lub interfejsu użytkownika zewnętrznego interfejsów API sieci Web.</span><span class="sxs-lookup"><span data-stu-id="3d43c-184">The project implements the microservice’s interaction, remote network access, and the external Web APIs used from the UI or client apps.</span></span> <span data-ttu-id="3d43c-185">Obejmuje on zapytania, jeśli przy użyciu CQRS podejścia polecenia zaakceptowane mikrousługi, a nawet sterowane zdarzeniami komunikację między mikrousług (integracji zdarzeń).</span><span class="sxs-lookup"><span data-stu-id="3d43c-185">It includes queries if using a CQRS approach, commands accepted by the microservice, and even the event-driven communication between microservices (integration events).</span></span> <span data-ttu-id="3d43c-186">ASP.NET interfejsu API sieci Web Core, który reprezentuje warstwy aplikacji nie może zawierać reguł biznesowych lub wiedzy domeny (szczególnie zasad domeny dla transakcji lub aktualizacji); te powinny należeć do biblioteki klas modelu domeny.</span><span class="sxs-lookup"><span data-stu-id="3d43c-186">The ASP.NET Core Web API that represents the application layer must not contain business rules or domain knowledge (especially domain rules for transactions or updates); these should be owned by the domain model class library.</span></span> <span data-ttu-id="3d43c-187">Współrzędna tylko musi warstwy aplikacji zadania i nie może przechowywania ani zdefiniować każdy stan domeny (model domeny).</span><span class="sxs-lookup"><span data-stu-id="3d43c-187">The application layer must only coordinate tasks and must not hold or define any domain state (domain model).</span></span> <span data-ttu-id="3d43c-188">Deleguje ona wykonywanie reguły biznesowe do domeny modelu klas sami (łączny katalogów głównych i jednostek domeny), które ostatecznie spowoduje zaktualizowanie danych w ramach tych jednostek domeny.</span><span class="sxs-lookup"><span data-stu-id="3d43c-188">It delegates the execution of business rules to the domain model classes themselves (aggregate roots and domain entities), which will ultimately update the data within those domain entities.</span></span>

<span data-ttu-id="3d43c-189">Zasadniczo logiki aplikacji jest, gdzie wdrożenia wszystkich przypadków użycia, które są zależne od danego frontonu.</span><span class="sxs-lookup"><span data-stu-id="3d43c-189">Basically, the application logic is where you implement all use cases that depend on a given front end.</span></span> <span data-ttu-id="3d43c-190">Na przykład implementacja związane z usługą sieci Web interfejsu API.</span><span class="sxs-lookup"><span data-stu-id="3d43c-190">For example, the implementation related to a Web API service.</span></span>

<span data-ttu-id="3d43c-191">Celem jest, że logikę domeny warstwy modelu domeny, jego invariants, model danych i reguły biznesowe pokrewnych musi być całkowicie niezależna od warstwy prezentacji i aplikacji.</span><span class="sxs-lookup"><span data-stu-id="3d43c-191">The goal is that the domain logic in the domain model layer, its invariants, the data model, and related business rules must be completely independent from the presentation and application layers.</span></span> <span data-ttu-id="3d43c-192">Najbardziej, warstwy modelu domeny nie bezpośrednio zależy od dowolnej architektury infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="3d43c-192">Most of all, the domain model layer must not directly depend on any infrastructure framework.</span></span>

### <a name="the-infrastructure-layer"></a><span data-ttu-id="3d43c-193">Warstwa infrastruktury</span><span class="sxs-lookup"><span data-stu-id="3d43c-193">The infrastructure layer</span></span>

<span data-ttu-id="3d43c-194">Warstwa infrastruktury jest, jak dane, które jest początkowo utrzymywana w domenie jednostki (w pamięci) jest trwały z baz danych lub innego magazynu trwałego.</span><span class="sxs-lookup"><span data-stu-id="3d43c-194">The infrastructure layer is how the data that is initially held in domain entities (in memory) is persisted in databases or another persistent store.</span></span> <span data-ttu-id="3d43c-195">Przykładem jest przy użyciu kodu programu Entity Framework Core do zaimplementowania klasy wzorca repozytorium, korzystających z elementu DBContext do utrwalenia danych relacyjnej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="3d43c-195">An example is using Entity Framework Core code to implement the Repository pattern classes that use a DBContext to persist data in a relational database.</span></span>

<span data-ttu-id="3d43c-196">Zgodnie z wcześniej wspomniano [nieznajomości trwałości](http://deviq.com/persistence-ignorance/) i [nieznajomości infrastruktury](https://ayende.com/blog/3137/infrastructure-ignorance) zasad, warstwie infrastrukturze musi nie "skażenia" warstwy modelu domeny.</span><span class="sxs-lookup"><span data-stu-id="3d43c-196">In accordance with the previously mentioned [Persistence Ignorance](http://deviq.com/persistence-ignorance/) and [Infrastructure Ignorance](https://ayende.com/blog/3137/infrastructure-ignorance) principles, the infrastructure layer must not “contaminate” the domain model layer.</span></span> <span data-ttu-id="3d43c-197">Funkcja klasy entity model domeny od infrastruktury używanej do utrwalenia danych (EF lub innych framework) muszą być stale nie biorąc pod uwagę twardych zależności struktury.</span><span class="sxs-lookup"><span data-stu-id="3d43c-197">You must keep the domain model entity classes agnostic from the infrastructure that you use to persist data (EF or any other framework) by not taking hard dependencies on frameworks.</span></span> <span data-ttu-id="3d43c-198">Biblioteki klas warstwy modelu domeny powinien mieć tylko kod domeny, po prostu [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object) jednostki klasy Implementowanie Puls oprogramowania i całkowicie całkowicie niezależna od technologii infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="3d43c-198">Your domain model layer class library should have only your domain code, just [POCO](https://en.wikipedia.org/wiki/Plain_Old_CLR_Object) entity classes implementing the heart of your software and completely decoupled from infrastructure technologies.</span></span>

<span data-ttu-id="3d43c-199">W związku z tym z warstwy lub bibliotek klas i projektów ostatecznie zależy od warstwą modelu domeny (biblioteki), nie odwrotnie, jak pokazano w rysunek 9-7.</span><span class="sxs-lookup"><span data-stu-id="3d43c-199">Thus, your layers or class libraries and projects should ultimately depend on your domain model layer (library), not vice versa, as shown in Figure 9-7.</span></span>

![](./media/image8.png)

<span data-ttu-id="3d43c-200">**Rysunek 9-7**.</span><span class="sxs-lookup"><span data-stu-id="3d43c-200">**Figure 9-7**.</span></span> <span data-ttu-id="3d43c-201">Zależności między warstwami w DDD</span><span class="sxs-lookup"><span data-stu-id="3d43c-201">Dependencies between layers in DDD</span></span>

<span data-ttu-id="3d43c-202">W tym projekcie warstwy powinny być niezależne dla każdego mikrousługi.</span><span class="sxs-lookup"><span data-stu-id="3d43c-202">This layer design should be independent for each microservice.</span></span> <span data-ttu-id="3d43c-203">Jak wspomniano wcześniej, można zaimplementować najbardziej złożonych mikrousług po wzorce DDD podczas implementowania prostsze opartych na danych mikrousług (proste CRUD w pojedynczej warstwie) w prostszy sposób.</span><span class="sxs-lookup"><span data-stu-id="3d43c-203">As noted earlier, you can implement the most complex microservices following DDD patterns, while implementing simpler data-driven microservices (simple CRUD in a single layer) in a simpler way.</span></span>

#### <a name="additional-resources"></a><span data-ttu-id="3d43c-204">Dodatkowe zasoby</span><span class="sxs-lookup"><span data-stu-id="3d43c-204">Additional resources</span></span>

-   <span data-ttu-id="3d43c-205">**DevIQ. Zasada nieznajomości trwałości**
    [*http://deviq.com/persistence-ignorance/*](http://deviq.com/persistence-ignorance/)</span><span class="sxs-lookup"><span data-stu-id="3d43c-205">**DevIQ. Persistence Ignorance principle**
[*http://deviq.com/persistence-ignorance/*](http://deviq.com/persistence-ignorance/)</span></span>

-   <span data-ttu-id="3d43c-206">**Oren Eini. Nieznajomości infrastruktury**
    [*https://ayende.com/blog/3137/infrastructure-ignorance*](https://ayende.com/blog/3137/infrastructure-ignorance)</span><span class="sxs-lookup"><span data-stu-id="3d43c-206">**Oren Eini. Infrastructure Ignorance**
[*https://ayende.com/blog/3137/infrastructure-ignorance*](https://ayende.com/blog/3137/infrastructure-ignorance)</span></span>

-   <span data-ttu-id="3d43c-207">**Angel Lopez. Architektura warstwowych w projekcie oparte na domenie**
    [*https://ajlopez.wordpress.com/2008/09/12/layered-architecture-in-domain-driven-design/*](https://ajlopez.wordpress.com/2008/09/12/layered-architecture-in-domain-driven-design/)</span><span class="sxs-lookup"><span data-stu-id="3d43c-207">**Angel Lopez. Layered Architecture In Domain-Driven Design**
[*https://ajlopez.wordpress.com/2008/09/12/layered-architecture-in-domain-driven-design/*](https://ajlopez.wordpress.com/2008/09/12/layered-architecture-in-domain-driven-design/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="3d43c-208">[Poprzednie] (cqrs mikrousługi reads.md) [dalej] (ruch model.md mikrousługi domeny)</span><span class="sxs-lookup"><span data-stu-id="3d43c-208">[Previous] (cqrs-microservice-reads.md) [Next] (microservice-domain-model.md)</span></span>
