---
title: Stosowanie zasad CQRS i CQS w mikrousługach DDD w ramach aplikacji eShopOnContainers
description: Architektura Mikrousług .NET konteneryzowanych aplikacji .NET | Poznaj sposób, w jaki sposób jest implementowany CQRS szeregowania mikrousługi w ramach aplikacji eShopOnContainers.
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 10/08/2018
ms.openlocfilehash: fc8c27c25fb6d07207586eb65d5ac9cc543bcc1a
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: pl-PL
ms.lasthandoff: 04/23/2019
ms.locfileid: "61818004"
---
# <a name="apply-cqrs-and-cqs-approaches-in-a-ddd-microservice-in-eshoponcontainers"></a><span data-ttu-id="c5986-103">Stosowanie podejścia CQRS i CQS w mikrousługach DDD w ramach aplikacji eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="c5986-103">Apply CQRS and CQS approaches in a DDD microservice in eShopOnContainers</span></span>

<span data-ttu-id="c5986-104">Projekt szeregowania mikrousługi w ramach aplikacji eShopOnContainers aplikacja referencyjna jest oparta na zasadach podejścia CQRS.</span><span class="sxs-lookup"><span data-stu-id="c5986-104">The design of the ordering microservice at the eShopOnContainers reference application is based on CQRS principles.</span></span> <span data-ttu-id="c5986-105">Jednak używa najprostszą metodą, co jest po prostu oddzielenie zapytania w poleceniach i przy użyciu tej samej bazy danych dla obu akcji.</span><span class="sxs-lookup"><span data-stu-id="c5986-105">However, it uses the simplest approach, which is just separating the queries from the commands and using the same database for both actions.</span></span>

<span data-ttu-id="c5986-106">Kluczową cechą tych wzorców i należy koniecznie zwrócić uwagę, jest, że zapytania są idempotentne: niezależnie od tego, ile razy zapytań systemu, nie zmienią się stan tego systemu.</span><span class="sxs-lookup"><span data-stu-id="c5986-106">The essence of those patterns, and the important point here, is that queries are idempotent: no matter how many times you query a system, the state of that system won't change.</span></span> <span data-ttu-id="c5986-107">Innymi słowy zapytania są efekt uboczny bezpłatnie.</span><span class="sxs-lookup"><span data-stu-id="c5986-107">In other words, queries are side-effect free.</span></span>

<span data-ttu-id="c5986-108">W związku z tym można użyć różnych "Odczyt" model danych niż logiki transakcyjnej "zapisuje" model domeny, mimo że szeregowania mikrousług korzystają z tej samej bazy danych.</span><span class="sxs-lookup"><span data-stu-id="c5986-108">Therefore, you could use a different “reads” data model than the transactional logic “writes” domain model, even though the ordering microservices are using the same database.</span></span> <span data-ttu-id="c5986-109">Dlatego jest to uproszczone podejście CQRS.</span><span class="sxs-lookup"><span data-stu-id="c5986-109">Hence, this is a simplified CQRS approach.</span></span>

<span data-ttu-id="c5986-110">Z drugiej strony poleceń, które wyzwalają transakcji i aktualizacji danych, zmiany stanu w systemie.</span><span class="sxs-lookup"><span data-stu-id="c5986-110">On the other hand, commands, which trigger transactions and data updates, change state in the system.</span></span> <span data-ttu-id="c5986-111">Za pomocą poleceń, musisz należy zachować ostrożność podczas dotyczących złożoności i ciągle zmieniające reguł biznesowych.</span><span class="sxs-lookup"><span data-stu-id="c5986-111">With commands, you need to be careful when dealing with complexity and ever-changing business rules.</span></span> <span data-ttu-id="c5986-112">To jest, gdy chcesz zastosować technik DDD, aby lepiej modelowanych systemu.</span><span class="sxs-lookup"><span data-stu-id="c5986-112">This is the where you want to apply DDD techniques to have a better modeled system.</span></span>

<span data-ttu-id="c5986-113">Nie można zastosować powszechnie wzorców DDD, w tym przewodniku.</span><span class="sxs-lookup"><span data-stu-id="c5986-113">The DDD patterns presented in this guide should not be applied universally.</span></span> <span data-ttu-id="c5986-114">Wprowadzają ograniczenia dotyczące projektu.</span><span class="sxs-lookup"><span data-stu-id="c5986-114">They introduce constraints on your design.</span></span> <span data-ttu-id="c5986-115">Te ograniczenia zapewniają korzyści, takich jak wyższej jakości, wraz z upływem czasu, szczególnie w przypadku polecenia i innego kodu, który modyfikuje stan systemu.</span><span class="sxs-lookup"><span data-stu-id="c5986-115">Those constraints provide benefits such as higher quality over time, especially in commands and other code that modifies system state.</span></span> <span data-ttu-id="c5986-116">Jednak te ograniczenia zwiększenia złożoności, z mniejszą liczbą korzyści, Odczyt i wykonywanie zapytań o dane.</span><span class="sxs-lookup"><span data-stu-id="c5986-116">However, those constraints add complexity with fewer benefits for reading and querying data.</span></span>

<span data-ttu-id="c5986-117">Jeden taki wzorzec jest wzorca agregacji omówiony bardziej w kolejnych sekcjach.</span><span class="sxs-lookup"><span data-stu-id="c5986-117">One such pattern is the Aggregate pattern, which we examine more in later sections.</span></span> <span data-ttu-id="c5986-118">Krótko mówiąc we wzorcu agregacji traktować wiele obiektów domeny jako pojedyncza jednostka wyniku ich relacje w domenie.</span><span class="sxs-lookup"><span data-stu-id="c5986-118">Briefly, in the Aggregate pattern, you treat many domain objects as a single unit as a result of their relationship in the domain.</span></span> <span data-ttu-id="c5986-119">Nie mogą zawsze uzyskać korzyści wynikające z tego wzorca w zapytaniach; to może zwiększyć złożoność logiki zapytania.</span><span class="sxs-lookup"><span data-stu-id="c5986-119">You might not always gain advantages from this pattern in queries; it can increase the complexity of query logic.</span></span> <span data-ttu-id="c5986-120">Dla zapytań tylko do odczytu nie uzyskać korzyści wynikające z traktowanie wielu obiektów jako jednej wartości zagregowanej.</span><span class="sxs-lookup"><span data-stu-id="c5986-120">For read-only queries, you do not get the advantages of treating multiple objects as a single Aggregate.</span></span> <span data-ttu-id="c5986-121">Uzyskujesz tylko złożoności.</span><span class="sxs-lookup"><span data-stu-id="c5986-121">You only get the complexity.</span></span>

<span data-ttu-id="c5986-122">Jak pokazano w rysunek 7-2, ten przewodnik sugeruje, przy użyciu wzorców DDD tylko w obszarze transakcyjnej/aktualizacji usługi mikrousługi (jak wyzwalane za pomocą poleceń).</span><span class="sxs-lookup"><span data-stu-id="c5986-122">As shown in Figure 7-2, this guide suggests using DDD patterns only in the transactional/updates area of your microservice (that is, as triggered by commands).</span></span> <span data-ttu-id="c5986-123">Zapytania można wykonać prostszej metody i powinna być oddzielona od po podejście CQRS poleceń.</span><span class="sxs-lookup"><span data-stu-id="c5986-123">Queries can follow a simpler approach and should be separated from commands, following a CQRS approach.</span></span>

<span data-ttu-id="c5986-124">Wykonania na stronie"zapytania", można wybrać wiele metod z Twojej pełnej ORM, takie jak EF Core, AutoMapper projekcji, procedury składowane, widoki, zmaterializowanych widoków lub wczesnych ORM.</span><span class="sxs-lookup"><span data-stu-id="c5986-124">For implementing the “queries side”, you can choose between many approaches, from your full-blown ORM like EF Core, AutoMapper projections, stored procedures, views, materialized views or a micro ORM.</span></span>

<span data-ttu-id="c5986-125">W tym przewodniku, jak i w ramach aplikacji eShopOnContainers (w szczególności szeregowania mikrousług) Wybraliśmy Implementowanie prostych zapytań przy użyciu micro ORM, takie jak [programem Dapper](https://github.com/StackExchange/dapper-dot-net).</span><span class="sxs-lookup"><span data-stu-id="c5986-125">In this guide and in eShopOnContainers (specifically the ordering microservice) we chose to implement straight queries using a micro ORM like [Dapper](https://github.com/StackExchange/dapper-dot-net).</span></span> <span data-ttu-id="c5986-126">Dzięki temu można zaimplementować dowolnego zapytania oparte na instrukcji SQL, aby uzyskać najlepszą wydajność, dzięki światła framework z niewielkim zapasem.</span><span class="sxs-lookup"><span data-stu-id="c5986-126">This lets you implement any query based on SQL statements to get the best performance, thanks to a light framework with very little overhead.</span></span>

<span data-ttu-id="c5986-127">Należy zauważyć, że gdy użycie tej metody aktualizacji do modelu, wpływających na to, jak jednostki są zachowywane w usługą SQL database również oddzielne aktualizacje do zapytania SQL, które korzystają z programem Dapper lub wszelkie inne oddzielne metody (bez EF) do wykonywania zapytań.</span><span class="sxs-lookup"><span data-stu-id="c5986-127">Note that when you use this approach, any updates to your model that impact how entities are persisted to a SQL database also need separate updates to SQL queries used by Dapper or any other separate (non-EF) approaches to querying.</span></span>

## <a name="cqrs-and-ddd-patterns-are-not-top-level-architectures"></a><span data-ttu-id="c5986-128">Wzorców CQRS i DDD nie są architektur najwyższego poziomu</span><span class="sxs-lookup"><span data-stu-id="c5986-128">CQRS and DDD patterns are not top-level architectures</span></span>

<span data-ttu-id="c5986-129">Jest ważne dowiedzieć się, że CQRS i większość wzorców DDD (np. warstwy DDD lub modelu domeny przy użyciu wartości zagregowane) nie są stylami architektury, ale tylko wzorce architektury.</span><span class="sxs-lookup"><span data-stu-id="c5986-129">It's important to understand that CQRS and most DDD patterns (like DDD layers or a domain model with aggregates) are not architectural styles, but only architecture patterns.</span></span> <span data-ttu-id="c5986-130">Mikrousługi, SOA i architektura sterowana zdarzeniami (EDA) są przykładami stylami architektury.</span><span class="sxs-lookup"><span data-stu-id="c5986-130">Microservices, SOA, and event-driven architecture (EDA) are examples of architectural styles.</span></span> <span data-ttu-id="c5986-131">Opisują one systemu z wielu składników, takich jak wiele mikrousług.</span><span class="sxs-lookup"><span data-stu-id="c5986-131">They describe a system of many components, such as many microservices.</span></span> <span data-ttu-id="c5986-132">Wzorców CQRS i DDD opisanie czegoś co wewnątrz pojedynczego systemu lub component; w tym przypadku coś wewnątrz mikrousługi.</span><span class="sxs-lookup"><span data-stu-id="c5986-132">CQRS and DDD patterns describe something inside a single system or component; in this case, something inside a microservice.</span></span>

<span data-ttu-id="c5986-133">Ograniczonych kontekstów (usług łączności biznesowej) będzie używać różnych wzorców.</span><span class="sxs-lookup"><span data-stu-id="c5986-133">Different Bounded Contexts (BCs) will employ different patterns.</span></span> <span data-ttu-id="c5986-134">Mają różne obowiązki i która prowadzi do różnych rozwiązaniach.</span><span class="sxs-lookup"><span data-stu-id="c5986-134">They have different responsibilities, and that leads to different solutions.</span></span> <span data-ttu-id="c5986-135">Warto podkreślając, że wymuszania tego samego wzorca, który wszędzie prowadzi do awarii.</span><span class="sxs-lookup"><span data-stu-id="c5986-135">It is worth emphasizing that forcing the same pattern everywhere leads to failure.</span></span> <span data-ttu-id="c5986-136">Nie używaj wzorców CQRS i DDD wszędzie.</span><span class="sxs-lookup"><span data-stu-id="c5986-136">Do not use CQRS and DDD patterns everywhere.</span></span> <span data-ttu-id="c5986-137">Wiele podsystemów, usług łączności biznesowej lub mikrousług są prostsze i można ją wdrożyć łatwiej za pomocą usługi simple CRUD lub przy użyciu innej metody.</span><span class="sxs-lookup"><span data-stu-id="c5986-137">Many subsystems, BCs, or microservices are simpler and can be implemented more easily using simple CRUD services or using another approach.</span></span>

<span data-ttu-id="c5986-138">Istnieje tylko jedna aplikacja architektury: Architektura aplikacji system lub end-to-end projektowania (na przykład w architekturze mikrousług).</span><span class="sxs-lookup"><span data-stu-id="c5986-138">There is only one application architecture: the architecture of the system or end-to-end application you are designing (for example, the microservices architecture).</span></span> <span data-ttu-id="c5986-139">Jednak projekt każdego ograniczonego kontekstu lub mikrousług tej aplikacji odzwierciedla własne wady i zalety i decyzje dotyczące projektu wewnętrznego na poziomie wzorców architektury.</span><span class="sxs-lookup"><span data-stu-id="c5986-139">However, the design of each Bounded Context or microservice within that application reflects its own tradeoffs and internal design decisions at an architecture patterns level.</span></span> <span data-ttu-id="c5986-140">Nie należy próbować użyć tego samego architektury wzorców takich jak CQRS i DDD wszędzie.</span><span class="sxs-lookup"><span data-stu-id="c5986-140">Do not try to apply the same architectural patterns like CQRS or DDD everywhere.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="c5986-141">Dodatkowe zasoby</span><span class="sxs-lookup"><span data-stu-id="c5986-141">Additional resources</span></span>

- <span data-ttu-id="c5986-142">**Martin Fowler. CQRS** \\</span><span class="sxs-lookup"><span data-stu-id="c5986-142">**Martin Fowler. CQRS** \\</span></span>
  <https://martinfowler.com/bliki/CQRS.html>

- <span data-ttu-id="c5986-143">**Grega Younga. CQS programu vs. CQRS** \\</span><span class="sxs-lookup"><span data-stu-id="c5986-143">**Greg Young. CQS vs. CQRS** \\</span></span>
  <http://codebetter.com/gregyoung/2009/08/13/command-query-separation/>

- <span data-ttu-id="c5986-144">**Grega Younga. Podejście CQRS dokumentów** \\</span><span class="sxs-lookup"><span data-stu-id="c5986-144">**Greg Young. CQRS Documents** \\</span></span>
  [https://cqrs.files.wordpress.com/2010/11/cqrs\_documents.pdf](https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf)

- <span data-ttu-id="c5986-145">**Grega Younga. Podejście CQRS, zadanie na podstawie interfejsów użytkownika i Określanie źródła zdarzeń** \\</span><span class="sxs-lookup"><span data-stu-id="c5986-145">**Greg Young. CQRS, Task Based UIs and Event Sourcing** \\</span></span>
  <http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/>

- <span data-ttu-id="c5986-146">**Udi Dahan. Sklarowanego CQRS** \\</span><span class="sxs-lookup"><span data-stu-id="c5986-146">**Udi Dahan. Clarified CQRS** \\</span></span>
  <http://udidahan.com/2009/12/09/clarified-cqrs/>

- <span data-ttu-id="c5986-147">**Określanie źródła zdarzeń (ES)** \\</span><span class="sxs-lookup"><span data-stu-id="c5986-147">**Event-Sourcing (ES)** \\</span></span>
  <http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/>

>[!div class="step-by-step"]
><span data-ttu-id="c5986-148">[Poprzednie](apply-simplified-microservice-cqrs-ddd-patterns.md)
>[dalej](cqrs-microservice-reads.md)</span><span class="sxs-lookup"><span data-stu-id="c5986-148">[Previous](apply-simplified-microservice-cqrs-ddd-patterns.md)
[Next](cqrs-microservice-reads.md)</span></span>
