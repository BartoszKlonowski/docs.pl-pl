---
title: Semafor i klasa SemaphoreSlim
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- counting semaphores
- semaphores
- threading [.NET Framework], cross-process synchronization
- Semaphore class, about Semaphore class
- SemaphoreSlim class, about SemaphoreSlim class
- threading [.NET Framework], Semaphore class
ms.assetid: 7722a333-b974-47a2-a7c0-f09097fb644e
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: e7d7f791fbc68a526f428f4f79d9b379a23ca771
ms.sourcegitcommit: 9bd8f213b50f0e1a73e03bd1e840c917fbd6d20a
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/25/2018
ms.locfileid: "50042340"
---
# <a name="semaphore-and-semaphoreslim"></a><span data-ttu-id="f18ca-102">Semafor i klasa SemaphoreSlim</span><span class="sxs-lookup"><span data-stu-id="f18ca-102">Semaphore and SemaphoreSlim</span></span>
<span data-ttu-id="f18ca-103"><xref:System.Threading.Semaphore?displayProperty=nameWithType> Klasa reprezentuje nazwane (ogólnosystemowe) lub semafor lokalnego.</span><span class="sxs-lookup"><span data-stu-id="f18ca-103">The <xref:System.Threading.Semaphore?displayProperty=nameWithType> class represents a named (systemwide) or local semaphore.</span></span> <span data-ttu-id="f18ca-104">To cienka otokę wokół obiektu semafora Win32.</span><span class="sxs-lookup"><span data-stu-id="f18ca-104">It is a thin wrapper around the Win32 semaphore object.</span></span> <span data-ttu-id="f18ca-105">Semaforów Win32 są liczenie semaforów, które mogą być używane do kontrolowania dostępu do puli zasobów.</span><span class="sxs-lookup"><span data-stu-id="f18ca-105">Win32 semaphores are counting semaphores, which can be used to control access to a pool of resources.</span></span>  
  
 <span data-ttu-id="f18ca-106"><xref:System.Threading.SemaphoreSlim> Klasa reprezentuje lekkie, szybkie semafor, który może służyć do oczekiwania w ramach jednego procesu, gdy spodziewane czasy oczekiwania będą bardzo krótkie.</span><span class="sxs-lookup"><span data-stu-id="f18ca-106">The <xref:System.Threading.SemaphoreSlim> class represents a lightweight, fast semaphore that can be used for waiting within a single process when wait times are expected to be very short.</span></span> <span data-ttu-id="f18ca-107"><xref:System.Threading.SemaphoreSlim> opiera się jak najszerzej w podstawowych synchronizacji dostarczane przez środowisko uruchomieniowe języka wspólnego (CLR).</span><span class="sxs-lookup"><span data-stu-id="f18ca-107"><xref:System.Threading.SemaphoreSlim> relies as much as possible on synchronization primitives provided by the common language runtime (CLR).</span></span> <span data-ttu-id="f18ca-108">Jednak zapewnia również dojść oczekiwania opóźnieniem zainicjowany, na podstawie jądra co jest niezbędne do obsługi oczekiwanie na wielu semaforów.</span><span class="sxs-lookup"><span data-stu-id="f18ca-108">However, it also provides lazily initialized, kernel-based wait handles as necessary to support waiting on multiple semaphores.</span></span> <span data-ttu-id="f18ca-109"><xref:System.Threading.SemaphoreSlim> również obsługuje korzystanie z tokenów anulowania, ale nie obsługuje o nazwie semaforów lub użytkowania dojście oczekiwania synchronizacji.</span><span class="sxs-lookup"><span data-stu-id="f18ca-109"><xref:System.Threading.SemaphoreSlim> also supports the use of cancellation tokens, but it does not support named semaphores or the use of a wait handle for synchronization.</span></span>  
  
## <a name="managing-a-limited-resource"></a><span data-ttu-id="f18ca-110">Zarządzanie zasobem ograniczone</span><span class="sxs-lookup"><span data-stu-id="f18ca-110">Managing a Limited Resource</span></span>  
 <span data-ttu-id="f18ca-111">Wątki wprowadź semafora przez wywołanie metody <xref:System.Threading.WaitHandle.WaitOne%2A> metody, która jest dziedziczona z <xref:System.Threading.WaitHandle> klasy, w przypadku <xref:System.Threading.Semaphore?displayProperty=nameWithType> obiektu lub <xref:System.Threading.SemaphoreSlim.Wait%2A?displayProperty=nameWithType> lub <xref:System.Threading.SemaphoreSlim.WaitAsync%2A?displayProperty=nameWithType> metody, w przypadku <xref:System.Threading.SemaphoreSlim> obiektu.</span><span class="sxs-lookup"><span data-stu-id="f18ca-111">Threads enter the semaphore by calling the <xref:System.Threading.WaitHandle.WaitOne%2A> method, which is inherited from the <xref:System.Threading.WaitHandle> class, in the case of a <xref:System.Threading.Semaphore?displayProperty=nameWithType> object, or the <xref:System.Threading.SemaphoreSlim.Wait%2A?displayProperty=nameWithType> or <xref:System.Threading.SemaphoreSlim.WaitAsync%2A?displayProperty=nameWithType> method, in the case of a <xref:System.Threading.SemaphoreSlim> object.</span></span> <span data-ttu-id="f18ca-112">Po powrocie z wywołania liczba klientów na semafora zostanie zmniejszony.</span><span class="sxs-lookup"><span data-stu-id="f18ca-112">When the call returns, the count on the semaphore is decremented.</span></span> <span data-ttu-id="f18ca-113">Kiedy wątek żądań zapisu oraz liczbę wynosi zero, blokuje wątek.</span><span class="sxs-lookup"><span data-stu-id="f18ca-113">When a thread requests entry and the count is zero, the thread blocks.</span></span> <span data-ttu-id="f18ca-114">Co wątków wersji semafora przez wywołanie metody <xref:System.Threading.Semaphore.Release%2A?displayProperty=nameWithType> lub <xref:System.Threading.SemaphoreSlim.Release%2A?displayProperty=nameWithType> metody zablokowane wątki mogą wprowadzać.</span><span class="sxs-lookup"><span data-stu-id="f18ca-114">As threads release the semaphore by calling the <xref:System.Threading.Semaphore.Release%2A?displayProperty=nameWithType> or <xref:System.Threading.SemaphoreSlim.Release%2A?displayProperty=nameWithType> method, blocked threads are allowed to enter.</span></span> <span data-ttu-id="f18ca-115">Nie dotyczy zagwarantowana kolejność, takich jak pierwszy in, first-out (FIFO) lub ostatni na wejściu, (LIFO), zablokowane wątki wprowadzić semafora.</span><span class="sxs-lookup"><span data-stu-id="f18ca-115">There is no guaranteed order, such as first-in, first-out (FIFO) or last-in, first-out (LIFO), for blocked threads to enter the semaphore.</span></span>  
  
 <span data-ttu-id="f18ca-116">Wątek można wprowadzić semafora wiele razy, wywołując <xref:System.Threading.Semaphore?displayProperty=nameWithType> obiektu <xref:System.Threading.WaitHandle.WaitOne%2A> metody lub <xref:System.Threading.SemaphoreSlim> obiektu <xref:System.Threading.SemaphoreSlim.Wait%2A> metoda wielokrotnie.</span><span class="sxs-lookup"><span data-stu-id="f18ca-116">A thread can enter the semaphore multiple times by calling the <xref:System.Threading.Semaphore?displayProperty=nameWithType> object's <xref:System.Threading.WaitHandle.WaitOne%2A> method or the  <xref:System.Threading.SemaphoreSlim> object's <xref:System.Threading.SemaphoreSlim.Wait%2A> method repeatedly.</span></span> <span data-ttu-id="f18ca-117">Aby zwolnić semafora, wątek może wywołać <xref:System.Threading.Semaphore.Release?displayProperty=nameWithType> lub <xref:System.Threading.SemaphoreSlim.Release?displayProperty=nameWithType> metoda przeciążenia taką samą liczbę razy, lub zadzwoń <xref:System.Threading.Semaphore.Release%28System.Int32%29?displayProperty=nameWithType> lub <xref:System.Threading.SemaphoreSlim.Release%28System.Int32%29?displayProperty=nameWithType> metoda przeciążenia i określ liczbę wpisów, które mogą być wprowadzane.</span><span class="sxs-lookup"><span data-stu-id="f18ca-117">To release the semaphore, the thread can either call the <xref:System.Threading.Semaphore.Release?displayProperty=nameWithType> or <xref:System.Threading.SemaphoreSlim.Release?displayProperty=nameWithType> method overload the same number of times, or call the <xref:System.Threading.Semaphore.Release%28System.Int32%29?displayProperty=nameWithType> or <xref:System.Threading.SemaphoreSlim.Release%28System.Int32%29?displayProperty=nameWithType> method overload and specify the number of entries to be released.</span></span>  
  
### <a name="semaphores-and-thread-identity"></a><span data-ttu-id="f18ca-118">Semaforów i tożsamości wątku</span><span class="sxs-lookup"><span data-stu-id="f18ca-118">Semaphores and Thread Identity</span></span>  
 <span data-ttu-id="f18ca-119">Semafor dwóch typów bez wymuszania tożsamość wątku na wywołania <xref:System.Threading.WaitHandle.WaitOne%2A>, <xref:System.Threading.SemaphoreSlim.Wait%2A>, <xref:System.Threading.Semaphore.Release%2A>, i <xref:System.Threading.SemaphoreSlim.Release%2A?displayProperty=nameWithType> metody.</span><span class="sxs-lookup"><span data-stu-id="f18ca-119">The two semaphore types do not enforce thread identity on calls to the <xref:System.Threading.WaitHandle.WaitOne%2A>, <xref:System.Threading.SemaphoreSlim.Wait%2A>, <xref:System.Threading.Semaphore.Release%2A>, and <xref:System.Threading.SemaphoreSlim.Release%2A?displayProperty=nameWithType> methods.</span></span> <span data-ttu-id="f18ca-120">Na przykład typowym scenariuszem użycia na semaforów zawiera wątku producentów i konsumentów wątku, z jednego wątku zawsze zwiększenie liczby semafor, a drugi zawsze zmniejszanie go.</span><span class="sxs-lookup"><span data-stu-id="f18ca-120">For example, a common usage scenario for semaphores involves a producer thread and a consumer thread, with one thread always incrementing the semaphore count and the other always decrementing it.</span></span>  
  
 <span data-ttu-id="f18ca-121">Jest odpowiedzialny za programisty, aby upewnić się, że wątek nie spowoduje zwolnienia semafora zbyt wiele razy.</span><span class="sxs-lookup"><span data-stu-id="f18ca-121">It is the programmer's responsibility to ensure that a thread does not release the semaphore too many times.</span></span> <span data-ttu-id="f18ca-122">Na przykład załóżmy, że semafor ma maksymalną liczbę dwóch tego wątku, A i B wątku obydwa wprowadź semafora.</span><span class="sxs-lookup"><span data-stu-id="f18ca-122">For example, suppose a semaphore has a maximum count of two, and that thread A and thread B both enter the semaphore.</span></span> <span data-ttu-id="f18ca-123">Jeśli to błąd programistyczny w wątku B powoduje go do wywoływania `Release` dwa razy, oba wywołania powiodło się.</span><span class="sxs-lookup"><span data-stu-id="f18ca-123">If a programming error in thread B causes it to call  `Release` twice, both calls succeed.</span></span> <span data-ttu-id="f18ca-124">Liczba klientów na semafora jest zapełniony i kiedy wątek, A ostatecznie wywołuje `Release`, <xref:System.Threading.SemaphoreFullException> zgłaszany.</span><span class="sxs-lookup"><span data-stu-id="f18ca-124">The count on the semaphore is full, and when thread A eventually calls `Release`, a <xref:System.Threading.SemaphoreFullException> is thrown.</span></span>  
  
## <a name="named-semaphores"></a><span data-ttu-id="f18ca-125">Nazwane semaforów</span><span class="sxs-lookup"><span data-stu-id="f18ca-125">Named Semaphores</span></span>  
 <span data-ttu-id="f18ca-126">System operacyjny Windows umożliwia semaforów mieć nazwy.</span><span class="sxs-lookup"><span data-stu-id="f18ca-126">The Windows operating system allows semaphores to have names.</span></span> <span data-ttu-id="f18ca-127">Semafor nazwanych jest całego systemu.</span><span class="sxs-lookup"><span data-stu-id="f18ca-127">A named semaphore is system wide.</span></span> <span data-ttu-id="f18ca-128">Oznacza to po utworzeniu nazwane semafora jest widoczny dla wszystkich wątków we wszystkich procesów.</span><span class="sxs-lookup"><span data-stu-id="f18ca-128">That is, once the named semaphore is created, it is visible to all threads in all processes.</span></span> <span data-ttu-id="f18ca-129">W związku z tym o nazwie semafora może służyć do Synchronizuj działania procesów, a także wątków.</span><span class="sxs-lookup"><span data-stu-id="f18ca-129">Thus, named semaphore can be used to synchronize the activities of processes as well as threads.</span></span>  
  
 <span data-ttu-id="f18ca-130">Możesz utworzyć <xref:System.Threading.Semaphore> obiekt, który przedstawia semafor systemu o nazwie przy użyciu jednego z konstruktorów, które określa nazwę.</span><span class="sxs-lookup"><span data-stu-id="f18ca-130">You can create a <xref:System.Threading.Semaphore> object that represents a named system semaphore by using one of the constructors that specifies a name.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f18ca-131">Ponieważ nazwany semaforów całego systemu, istnieje możliwość wielu <xref:System.Threading.Semaphore> obiekty reprezentujące takie same, o nazwie semafora.</span><span class="sxs-lookup"><span data-stu-id="f18ca-131">Because named semaphores are system wide, it is possible to have multiple <xref:System.Threading.Semaphore> objects that represent the same named semaphore.</span></span> <span data-ttu-id="f18ca-132">Każdorazowo, można wywołać konstruktora lub <xref:System.Threading.Semaphore.OpenExisting%2A?displayProperty=nameWithType> metodę, nowe <xref:System.Threading.Semaphore> obiekt zostanie utworzony.</span><span class="sxs-lookup"><span data-stu-id="f18ca-132">Each time you call a constructor or the <xref:System.Threading.Semaphore.OpenExisting%2A?displayProperty=nameWithType> method, a new <xref:System.Threading.Semaphore> object is created.</span></span> <span data-ttu-id="f18ca-133">Określenie tej samej nazwie wielokrotnie tworzy wiele obiektów, które reprezentują ten sam semafora o nazwie.</span><span class="sxs-lookup"><span data-stu-id="f18ca-133">Specifying the same name repeatedly creates multiple objects that represent the same named semaphore.</span></span>  
  
 <span data-ttu-id="f18ca-134">Możesz użyć nazwanych semaforów, należy zachować ostrożność.</span><span class="sxs-lookup"><span data-stu-id="f18ca-134">Be careful when you use named semaphores.</span></span> <span data-ttu-id="f18ca-135">Ponieważ są one całego systemu, inny proces, który używa tej samej nazwy można wprowadzić swoje semafora nieoczekiwanie.</span><span class="sxs-lookup"><span data-stu-id="f18ca-135">Because they are system wide, another process that uses the same name can enter your semaphore unexpectedly.</span></span> <span data-ttu-id="f18ca-136">Złośliwy kod, wykonania na tym samym komputerze może wykorzystać tę podstawę ataku typu "odmowa usługi".</span><span class="sxs-lookup"><span data-stu-id="f18ca-136">Malicious code executing on the same computer could use this as the basis of a denial-of-service attack.</span></span>  
  
 <span data-ttu-id="f18ca-137">Umożliwia kontrolę dostępu, aby chronić <xref:System.Threading.Semaphore> obiekt, który najlepiej reprezentuje nazwane semafor, za pomocą konstruktora, który określa <xref:System.Security.AccessControl.SemaphoreSecurity?displayProperty=nameWithType> obiektu.</span><span class="sxs-lookup"><span data-stu-id="f18ca-137">Use access control security to protect a <xref:System.Threading.Semaphore> object that represents a named semaphore, preferably by using a constructor that specifies a <xref:System.Security.AccessControl.SemaphoreSecurity?displayProperty=nameWithType> object.</span></span> <span data-ttu-id="f18ca-138">Można również stosować przy użyciu zabezpieczeń kontroli dostępu <xref:System.Threading.Semaphore.SetAccessControl%2A?displayProperty=nameWithType> metody, ale pozostawia oknem lukę między czas semafora jest tworzony i jest chroniony.</span><span class="sxs-lookup"><span data-stu-id="f18ca-138">You can also apply access control security using the <xref:System.Threading.Semaphore.SetAccessControl%2A?displayProperty=nameWithType> method, but this leaves a window of vulnerability between the time the semaphore is created and the time it is protected.</span></span> <span data-ttu-id="f18ca-139">Ochrona semaforów za pomocą kontrolę dostępu pomaga zapobiegać złośliwe ataki, ale nie rozwiązuje problemu Kolizje nazw niezamierzone.</span><span class="sxs-lookup"><span data-stu-id="f18ca-139">Protecting semaphores with access control security helps prevent malicious attacks, but does not solve the problem of unintentional name collisions.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f18ca-140">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="f18ca-140">See also</span></span>

- <xref:System.Threading.Semaphore>  
- <xref:System.Threading.SemaphoreSlim>  
- [<span data-ttu-id="f18ca-141">Wątkowość obiektów i funkcji</span><span class="sxs-lookup"><span data-stu-id="f18ca-141">Threading Objects and Features</span></span>](../../../docs/standard/threading/threading-objects-and-features.md)
