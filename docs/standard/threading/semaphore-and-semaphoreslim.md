---
title: Semafor i klasa SemaphoreSlim
description: Więcej informacji na temat semafora & SemaphoreSlim. Semafor klasy to cienka otoka wokół obiektu semafora Win32. Klasa SemaphoreSlim jest lekkim semaforem.
ms.date: 03/30/2017
helpviewer_keywords:
- counting semaphores
- semaphores
- threading [.NET], cross-process synchronization
- Semaphore class, about Semaphore class
- SemaphoreSlim class, about SemaphoreSlim class
- threading [.NET], Semaphore class
ms.assetid: 7722a333-b974-47a2-a7c0-f09097fb644e
ms.openlocfilehash: 34ffe11f7211d2d8b282bfd27f8c48328a5cb6d1
ms.sourcegitcommit: d8020797a6657d0fbbdff362b80300815f682f94
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/24/2020
ms.locfileid: "95681902"
---
# <a name="semaphore-and-semaphoreslim"></a><span data-ttu-id="850e8-105">Semafor i klasa SemaphoreSlim</span><span class="sxs-lookup"><span data-stu-id="850e8-105">Semaphore and SemaphoreSlim</span></span>

<span data-ttu-id="850e8-106"><xref:System.Threading.Semaphore?displayProperty=nameWithType>Klasa reprezentuje nazwę (systemowo) lub semafor lokalny.</span><span class="sxs-lookup"><span data-stu-id="850e8-106">The <xref:System.Threading.Semaphore?displayProperty=nameWithType> class represents a named (systemwide) or local semaphore.</span></span> <span data-ttu-id="850e8-107">Jest to cienka otoka otaczająca obiekt semafora Win32.</span><span class="sxs-lookup"><span data-stu-id="850e8-107">It is a thin wrapper around the Win32 semaphore object.</span></span> <span data-ttu-id="850e8-108">Semafory Win32 to zliczanie semaforów, które mogą służyć do kontrolowania dostępu do puli zasobów.</span><span class="sxs-lookup"><span data-stu-id="850e8-108">Win32 semaphores are counting semaphores, which can be used to control access to a pool of resources.</span></span>  
  
 <span data-ttu-id="850e8-109"><xref:System.Threading.SemaphoreSlim>Klasa reprezentuje lekki, szybki semafor, który może być używany do oczekiwania w pojedynczym procesie, gdy oczekiwane czasy oczekiwania są bardzo krótkie.</span><span class="sxs-lookup"><span data-stu-id="850e8-109">The <xref:System.Threading.SemaphoreSlim> class represents a lightweight, fast semaphore that can be used for waiting within a single process when wait times are expected to be very short.</span></span> <span data-ttu-id="850e8-110"><xref:System.Threading.SemaphoreSlim> jest tak dużo jak to możliwe w przypadku prymitywów synchronizacji dostarczonych przez środowisko uruchomieniowe języka wspólnego (CLR).</span><span class="sxs-lookup"><span data-stu-id="850e8-110"><xref:System.Threading.SemaphoreSlim> relies as much as possible on synchronization primitives provided by the common language runtime (CLR).</span></span> <span data-ttu-id="850e8-111">Zapewnia on jednak również opóźnieniem zainicjowane, zależne od jądra uchwyty do obsługi oczekiwania na wiele semaforów.</span><span class="sxs-lookup"><span data-stu-id="850e8-111">However, it also provides lazily initialized, kernel-based wait handles as necessary to support waiting on multiple semaphores.</span></span> <span data-ttu-id="850e8-112"><xref:System.Threading.SemaphoreSlim> Program obsługuje także tokeny anulowania, ale nie obsługuje semaforów nazwanych ani użycia uchwytu oczekiwania na potrzeby synchronizacji.</span><span class="sxs-lookup"><span data-stu-id="850e8-112"><xref:System.Threading.SemaphoreSlim> also supports the use of cancellation tokens, but it does not support named semaphores or the use of a wait handle for synchronization.</span></span>  
  
## <a name="managing-a-limited-resource"></a><span data-ttu-id="850e8-113">Zarządzanie zasobem ograniczonym</span><span class="sxs-lookup"><span data-stu-id="850e8-113">Managing a Limited Resource</span></span>  

 <span data-ttu-id="850e8-114">Wątki wprowadzają semafor <xref:System.Threading.WaitHandle.WaitOne%2A> , wywołując metodę, która jest dziedziczona z <xref:System.Threading.WaitHandle> klasy, w przypadku <xref:System.Threading.Semaphore?displayProperty=nameWithType> obiektu, lub <xref:System.Threading.SemaphoreSlim.Wait%2A?displayProperty=nameWithType> <xref:System.Threading.SemaphoreSlim.WaitAsync%2A?displayProperty=nameWithType> metody, w przypadku <xref:System.Threading.SemaphoreSlim> obiektu.</span><span class="sxs-lookup"><span data-stu-id="850e8-114">Threads enter the semaphore by calling the <xref:System.Threading.WaitHandle.WaitOne%2A> method, which is inherited from the <xref:System.Threading.WaitHandle> class, in the case of a <xref:System.Threading.Semaphore?displayProperty=nameWithType> object, or the <xref:System.Threading.SemaphoreSlim.Wait%2A?displayProperty=nameWithType> or <xref:System.Threading.SemaphoreSlim.WaitAsync%2A?displayProperty=nameWithType> method, in the case of a <xref:System.Threading.SemaphoreSlim> object.</span></span> <span data-ttu-id="850e8-115">Gdy wywołanie zwróci wartość, licznik semafora jest zmniejszany.</span><span class="sxs-lookup"><span data-stu-id="850e8-115">When the call returns, the count on the semaphore is decremented.</span></span> <span data-ttu-id="850e8-116">Gdy wątek żąda wpisu, a liczba jest równa zero, bloki wątku.</span><span class="sxs-lookup"><span data-stu-id="850e8-116">When a thread requests entry and the count is zero, the thread blocks.</span></span> <span data-ttu-id="850e8-117">Ponieważ wątki zwalniają semafor przez wywołanie <xref:System.Threading.Semaphore.Release%2A?displayProperty=nameWithType> metody lub <xref:System.Threading.SemaphoreSlim.Release%2A?displayProperty=nameWithType> , blokowane wątki mogą wprowadzić.</span><span class="sxs-lookup"><span data-stu-id="850e8-117">As threads release the semaphore by calling the <xref:System.Threading.Semaphore.Release%2A?displayProperty=nameWithType> or <xref:System.Threading.SemaphoreSlim.Release%2A?displayProperty=nameWithType> method, blocked threads are allowed to enter.</span></span> <span data-ttu-id="850e8-118">Brak uporządkowanej kolejności, takiej jak First-In, First-Out (FIFO) lub Last-in, First-Out (LIFO), w przypadku zablokowanych wątków do wprowadzania semafora.</span><span class="sxs-lookup"><span data-stu-id="850e8-118">There is no guaranteed order, such as first-in, first-out (FIFO) or last-in, first-out (LIFO), for blocked threads to enter the semaphore.</span></span>  
  
 <span data-ttu-id="850e8-119">Wątek może wielokrotnie wprowadzać semafor, wywołując <xref:System.Threading.Semaphore?displayProperty=nameWithType> <xref:System.Threading.WaitHandle.WaitOne%2A> metodę obiektu lub  <xref:System.Threading.SemaphoreSlim> <xref:System.Threading.SemaphoreSlim.Wait%2A> metodę obiektu wielokrotnie.</span><span class="sxs-lookup"><span data-stu-id="850e8-119">A thread can enter the semaphore multiple times by calling the <xref:System.Threading.Semaphore?displayProperty=nameWithType> object's <xref:System.Threading.WaitHandle.WaitOne%2A> method or the  <xref:System.Threading.SemaphoreSlim> object's <xref:System.Threading.SemaphoreSlim.Wait%2A> method repeatedly.</span></span> <span data-ttu-id="850e8-120">Aby zwolnić semafor, wątek może wywoływać <xref:System.Threading.Semaphore.Release?displayProperty=nameWithType> lub <xref:System.Threading.SemaphoreSlim.Release?displayProperty=nameWithType> przeciążać metodę lub wywoływać metodę <xref:System.Threading.Semaphore.Release%28System.Int32%29?displayProperty=nameWithType> <xref:System.Threading.SemaphoreSlim.Release%28System.Int32%29?displayProperty=nameWithType> przeciążoną, a także określić liczbę wpisów do zwolnienia.</span><span class="sxs-lookup"><span data-stu-id="850e8-120">To release the semaphore, the thread can either call the <xref:System.Threading.Semaphore.Release?displayProperty=nameWithType> or <xref:System.Threading.SemaphoreSlim.Release?displayProperty=nameWithType> method overload the same number of times, or call the <xref:System.Threading.Semaphore.Release%28System.Int32%29?displayProperty=nameWithType> or <xref:System.Threading.SemaphoreSlim.Release%28System.Int32%29?displayProperty=nameWithType> method overload and specify the number of entries to be released.</span></span>  
  
### <a name="semaphores-and-thread-identity"></a><span data-ttu-id="850e8-121">Semafory i tożsamość wątku</span><span class="sxs-lookup"><span data-stu-id="850e8-121">Semaphores and Thread Identity</span></span>  

 <span data-ttu-id="850e8-122">Dwa typy semaforów nie wymuszają tożsamości wątku dla wywołań <xref:System.Threading.WaitHandle.WaitOne%2A> <xref:System.Threading.SemaphoreSlim.Wait%2A> metod,, <xref:System.Threading.Semaphore.Release%2A> i <xref:System.Threading.SemaphoreSlim.Release%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="850e8-122">The two semaphore types do not enforce thread identity on calls to the <xref:System.Threading.WaitHandle.WaitOne%2A>, <xref:System.Threading.SemaphoreSlim.Wait%2A>, <xref:System.Threading.Semaphore.Release%2A>, and <xref:System.Threading.SemaphoreSlim.Release%2A?displayProperty=nameWithType> methods.</span></span> <span data-ttu-id="850e8-123">Na przykład typowy scenariusz użycia dla semaforów obejmuje wątek producenta i wątek odbiorcy, przy czym jeden wątek zawsze zwiększa liczbę semaforów, a druga zawsze zmniejsza.</span><span class="sxs-lookup"><span data-stu-id="850e8-123">For example, a common usage scenario for semaphores involves a producer thread and a consumer thread, with one thread always incrementing the semaphore count and the other always decrementing it.</span></span>  
  
 <span data-ttu-id="850e8-124">Programista może zapewnić, że wątek nie zwolni semafora zbyt wiele razy.</span><span class="sxs-lookup"><span data-stu-id="850e8-124">It is the programmer's responsibility to ensure that a thread does not release the semaphore too many times.</span></span> <span data-ttu-id="850e8-125">Załóżmy na przykład, że semafor ma maksymalną liczbę dwóch, a wątek a i wątek B jednocześnie wprowadźe semafor.</span><span class="sxs-lookup"><span data-stu-id="850e8-125">For example, suppose a semaphore has a maximum count of two, and that thread A and thread B both enter the semaphore.</span></span> <span data-ttu-id="850e8-126">Jeśli błąd programowania w wątku B powoduje wywołanie  `Release` dwa razy, oba wywołania powiodą się.</span><span class="sxs-lookup"><span data-stu-id="850e8-126">If a programming error in thread B causes it to call  `Release` twice, both calls succeed.</span></span> <span data-ttu-id="850e8-127">Licznik semafora jest zapełniony, a kiedy wątek A ostatecznie wywołuje `Release` , <xref:System.Threading.SemaphoreFullException> jest zgłaszany.</span><span class="sxs-lookup"><span data-stu-id="850e8-127">The count on the semaphore is full, and when thread A eventually calls `Release`, a <xref:System.Threading.SemaphoreFullException> is thrown.</span></span>  
  
## <a name="named-semaphores"></a><span data-ttu-id="850e8-128">Semafory nazwane</span><span class="sxs-lookup"><span data-stu-id="850e8-128">Named Semaphores</span></span>  

 <span data-ttu-id="850e8-129">System operacyjny Windows umożliwia semaforom używanie nazw.</span><span class="sxs-lookup"><span data-stu-id="850e8-129">The Windows operating system allows semaphores to have names.</span></span> <span data-ttu-id="850e8-130">Nazwany Semafor to Wide system.</span><span class="sxs-lookup"><span data-stu-id="850e8-130">A named semaphore is system wide.</span></span> <span data-ttu-id="850e8-131">Oznacza to, że po utworzeniu nazwanego semafora jest on widoczny dla wszystkich wątków we wszystkich procesach.</span><span class="sxs-lookup"><span data-stu-id="850e8-131">That is, once the named semaphore is created, it is visible to all threads in all processes.</span></span> <span data-ttu-id="850e8-132">Z tego względu nazwany semafor może służyć do synchronizowania działań procesów oraz wątków.</span><span class="sxs-lookup"><span data-stu-id="850e8-132">Thus, named semaphore can be used to synchronize the activities of processes as well as threads.</span></span>  
  
 <span data-ttu-id="850e8-133">Można utworzyć <xref:System.Threading.Semaphore> obiekt reprezentujący nazwany semafor systemowy przy użyciu jednego z konstruktorów, które określają nazwę.</span><span class="sxs-lookup"><span data-stu-id="850e8-133">You can create a <xref:System.Threading.Semaphore> object that represents a named system semaphore by using one of the constructors that specifies a name.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="850e8-134">Ponieważ nazwane semafory są systemem Wide, możliwe jest posiadanie wielu <xref:System.Threading.Semaphore> obiektów, które reprezentują ten sam semafor nazwany.</span><span class="sxs-lookup"><span data-stu-id="850e8-134">Because named semaphores are system wide, it is possible to have multiple <xref:System.Threading.Semaphore> objects that represent the same named semaphore.</span></span> <span data-ttu-id="850e8-135">Za każdym razem, gdy wywołujesz konstruktora lub <xref:System.Threading.Semaphore.OpenExisting%2A?displayProperty=nameWithType> metodę, <xref:System.Threading.Semaphore> tworzony jest nowy obiekt.</span><span class="sxs-lookup"><span data-stu-id="850e8-135">Each time you call a constructor or the <xref:System.Threading.Semaphore.OpenExisting%2A?displayProperty=nameWithType> method, a new <xref:System.Threading.Semaphore> object is created.</span></span> <span data-ttu-id="850e8-136">Wielokrotne Określanie nazwy powoduje utworzenie wielu obiektów, które reprezentują ten sam semafor nazwany.</span><span class="sxs-lookup"><span data-stu-id="850e8-136">Specifying the same name repeatedly creates multiple objects that represent the same named semaphore.</span></span>  
  
 <span data-ttu-id="850e8-137">Należy zachować ostrożność w przypadku używania semaforów nazwanych.</span><span class="sxs-lookup"><span data-stu-id="850e8-137">Be careful when you use named semaphores.</span></span> <span data-ttu-id="850e8-138">Ponieważ są one całego systemu, inny proces, który używa tej samej nazwy, może nieoczekiwanie wprowadzić semafor.</span><span class="sxs-lookup"><span data-stu-id="850e8-138">Because they are system wide, another process that uses the same name can enter your semaphore unexpectedly.</span></span> <span data-ttu-id="850e8-139">Złośliwy kod wykonywany na tym samym komputerze może być używany jako podstawa ataku typu "odmowa usługi".</span><span class="sxs-lookup"><span data-stu-id="850e8-139">Malicious code executing on the same computer could use this as the basis of a denial-of-service attack.</span></span>  
  
 <span data-ttu-id="850e8-140">Użyj zabezpieczeń kontroli dostępu, aby chronić <xref:System.Threading.Semaphore> obiekt, który reprezentuje nazwany semafor, najlepiej przy użyciu konstruktora, który określa <xref:System.Security.AccessControl.SemaphoreSecurity?displayProperty=nameWithType> obiekt.</span><span class="sxs-lookup"><span data-stu-id="850e8-140">Use access control security to protect a <xref:System.Threading.Semaphore> object that represents a named semaphore, preferably by using a constructor that specifies a <xref:System.Security.AccessControl.SemaphoreSecurity?displayProperty=nameWithType> object.</span></span> <span data-ttu-id="850e8-141">Można również zastosować zabezpieczenia kontroli dostępu przy użyciu <xref:System.Threading.Semaphore.SetAccessControl%2A?displayProperty=nameWithType> metody, ale powoduje to pozostawienie okna luk w zabezpieczeniach między momentem utworzenia semafora a czasem jego ochrony.</span><span class="sxs-lookup"><span data-stu-id="850e8-141">You can also apply access control security using the <xref:System.Threading.Semaphore.SetAccessControl%2A?displayProperty=nameWithType> method, but this leaves a window of vulnerability between the time the semaphore is created and the time it is protected.</span></span> <span data-ttu-id="850e8-142">Ochrona semaforów z zabezpieczeniami kontroli dostępu pomaga zapobiegać złośliwym atakom, ale nie rozwiązuje problemu przypadkowych kolizji nazw.</span><span class="sxs-lookup"><span data-stu-id="850e8-142">Protecting semaphores with access control security helps prevent malicious attacks, but does not solve the problem of unintentional name collisions.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="850e8-143">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="850e8-143">See also</span></span>

- <xref:System.Threading.Semaphore>
- <xref:System.Threading.SemaphoreSlim>
- [<span data-ttu-id="850e8-144">Wątkowość obiektów i funkcji</span><span class="sxs-lookup"><span data-stu-id="850e8-144">Threading Objects and Features</span></span>](threading-objects-and-features.md)
