---
title: Wyjątki w zarządzanych wątkach
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- unhandled exceptions,in managed threads
- threading [.NET Framework],unhandled exceptions
- threading [.NET Framework],exceptions in managed threads
- managed threading
ms.assetid: 11294769-2e89-43cb-890e-ad4ad79cfbee
ms.openlocfilehash: 2c3215fd42e8cf6d6427d23f94c14db4230ddd02
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/30/2019
ms.locfileid: "73138060"
---
# <a name="exceptions-in-managed-threads"></a><span data-ttu-id="c3a1c-102">Wyjątki w zarządzanych wątkach</span><span class="sxs-lookup"><span data-stu-id="c3a1c-102">Exceptions in Managed Threads</span></span>
<span data-ttu-id="c3a1c-103">Począwszy od .NET Framework w wersji 2,0, środowisko uruchomieniowe języka wspólnego pozwala na wykonywanie większości nieobsługiwanych wyjątków w wątkach.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-103">Starting with the .NET Framework version 2.0, the common language runtime allows most unhandled exceptions in threads to proceed naturally.</span></span> <span data-ttu-id="c3a1c-104">W większości przypadków, nieobsłużony wyjątek powoduje przerwanie działania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-104">In most cases this means that the unhandled exception causes the application to terminate.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="c3a1c-105">Jest to znacząca zmiana z .NET Framework wersje 1,0 i 1,1, które zapewniają przetrzymywanie dla wielu nieobsłużonych wyjątków — na przykład Nieobsłużone wyjątki w wątkach puli wątków.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-105">This is a significant change from the .NET Framework versions 1.0 and 1.1, which provide a backstop for many unhandled exceptions — for example, unhandled exceptions in thread pool threads.</span></span> <span data-ttu-id="c3a1c-106">Zobacz [zmiana z poprzednich wersji](#ChangeFromPreviousVersions) w dalszej części tego tematu.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-106">See [Change from Previous Versions](#ChangeFromPreviousVersions) later in this topic.</span></span>  
  
 <span data-ttu-id="c3a1c-107">Środowisko uruchomieniowe języka wspólnego zapewnia Nieobsłużone wyjątki, które są używane do sterowania przepływem programu:</span><span class="sxs-lookup"><span data-stu-id="c3a1c-107">The common language runtime provides a backstop for certain unhandled exceptions that are used for controlling program flow:</span></span>  
  
- <span data-ttu-id="c3a1c-108"><xref:System.Threading.ThreadAbortException> jest generowany w wątku, ponieważ został wywołany <xref:System.Threading.Thread.Abort%2A>.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-108">A <xref:System.Threading.ThreadAbortException> is thrown in a thread because <xref:System.Threading.Thread.Abort%2A> was called.</span></span>  
  
- <span data-ttu-id="c3a1c-109"><xref:System.AppDomainUnloadedException> jest generowany w wątku, ponieważ trwa zwalnianie domeny aplikacji, w której wykonywany jest wątek.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-109">An <xref:System.AppDomainUnloadedException> is thrown in a thread because the application domain in which the thread is executing is being unloaded.</span></span>  
  
- <span data-ttu-id="c3a1c-110">Środowisko uruchomieniowe języka wspólnego lub proces hosta przerywa wątek przez wygenerowanie wewnętrznego wyjątku.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-110">The common language runtime or a host process terminates the thread by throwing an internal exception.</span></span>  
  
 <span data-ttu-id="c3a1c-111">Jeśli którykolwiek z tych wyjątków nie jest obsługiwany w wątkach utworzonych przez środowisko uruchomieniowe języka wspólnego, wyjątek kończy działanie wątku, ale środowisko uruchomieniowe języka wspólnego nie zezwala na dalsze dalsze dalsze działanie.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-111">If any of these exceptions are unhandled in threads created by the common language runtime, the exception terminates the thread, but the common language runtime does not allow the exception to proceed further.</span></span>  
  
 <span data-ttu-id="c3a1c-112">Jeśli te wyjątki są nieobsługiwane w wątku głównym lub w wątkach, które zostały wprowadzone w środowisku uruchomieniowym z kodu niezarządzanego, zwykle działają normalnie, co spowoduje zakończenie działania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-112">If these exceptions are unhandled in the main thread, or in threads that entered the runtime from unmanaged code, they proceed normally, resulting in termination of the application.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="c3a1c-113">Jest możliwe, aby środowisko uruchomieniowe zgłosiło nieobsłużony wyjątek, zanim kod zarządzany miał szansę na zainstalowanie programu obsługi wyjątków.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-113">It is possible for the runtime to throw an unhandled exception before any managed code has had a chance to install an exception handler.</span></span> <span data-ttu-id="c3a1c-114">Chociaż kod zarządzany nie był w stanie obsłużyć takiego wyjątku, wyjątek można przeprowadzić w naturalny sposób.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-114">Even though managed code had no chance to handle such an exception, the exception is allowed to proceed naturally.</span></span>  
  
## <a name="exposing-threading-problems-during-development"></a><span data-ttu-id="c3a1c-115">Uwidacznianie problemów wielowątkowości podczas opracowywania</span><span class="sxs-lookup"><span data-stu-id="c3a1c-115">Exposing Threading Problems During Development</span></span>  
 <span data-ttu-id="c3a1c-116">Gdy wątki mogą kończyć się niepowodzeniem w trybie dyskretnym, bez przerywania działania aplikacji, nie wykryto poważnych problemów programistycznych.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-116">When threads are allowed to fail silently, without terminating the application, serious programming problems can go undetected.</span></span> <span data-ttu-id="c3a1c-117">Jest to konkretny problem dotyczący usług i innych aplikacji uruchamianych przez Rozszerzone okresy.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-117">This is a particular problem for services and other applications which run for extended periods.</span></span> <span data-ttu-id="c3a1c-118">Gdy wątki zakończą się niepowodzeniem, stan programu stopniowo ulega uszkodzeniu.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-118">As threads fail, program state gradually becomes corrupted.</span></span> <span data-ttu-id="c3a1c-119">Wydajność aplikacji może być gorsza lub aplikacja może przestać odpowiadać.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-119">Application performance may degrade, or the application might become unresponsive.</span></span>  
  
 <span data-ttu-id="c3a1c-120">Zezwalanie na Nieobsłużone wyjątki w wątkach w sposób naturalny, dopóki system operacyjny nie zakończy działania programu, ujawnia takie problemy podczas tworzenia i testowania.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-120">Allowing unhandled exceptions in threads to proceed naturally, until the operating system terminates the program, exposes such problems during development and testing.</span></span> <span data-ttu-id="c3a1c-121">Raporty o błędach programu obsługują debugowanie.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-121">Error reports on program terminations support debugging.</span></span>  
  
<a name="ChangeFromPreviousVersions"></a>   
## <a name="change-from-previous-versions"></a><span data-ttu-id="c3a1c-122">Zmień z poprzednich wersji</span><span class="sxs-lookup"><span data-stu-id="c3a1c-122">Change from Previous Versions</span></span>  
 <span data-ttu-id="c3a1c-123">Najbardziej znaczące zmiany odnoszą się do zarządzanych wątków.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-123">The most significant change pertains to managed threads.</span></span> <span data-ttu-id="c3a1c-124">W .NET Framework wersje 1,0 i 1,1 środowisko uruchomieniowe języka wspólnego zapewnia Nieobsłużone wyjątki w następujących sytuacjach:</span><span class="sxs-lookup"><span data-stu-id="c3a1c-124">In the .NET Framework versions 1.0 and 1.1, the common language runtime provides a backstop for unhandled exceptions in the following situations:</span></span>  
  
- <span data-ttu-id="c3a1c-125">Nie ma takiego znaczenia jako nieobsłużonego wyjątku w wątku puli wątków.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-125">There is no such thing as an unhandled exception on a thread pool thread.</span></span> <span data-ttu-id="c3a1c-126">Gdy zadanie zgłasza wyjątek, który nie jest obsługiwany, środowisko uruchomieniowe drukuje ślad stosu wyjątku do konsoli programu, a następnie zwraca wątek do puli wątków.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-126">When a task throws an exception that it does not handle, the runtime prints the exception stack trace to the console and then returns the thread to the thread pool.</span></span>  
  
- <span data-ttu-id="c3a1c-127">Nie istnieje taka rzecz jako nieobsłużony wyjątek w wątku utworzonym za pomocą metody <xref:System.Threading.Thread.Start%2A> klasy <xref:System.Threading.Thread>.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-127">There is no such thing as an unhandled exception on a thread created with the <xref:System.Threading.Thread.Start%2A> method of the <xref:System.Threading.Thread> class.</span></span> <span data-ttu-id="c3a1c-128">Gdy kod uruchomiony w takim wątku zgłasza wyjątek, który nie jest obsługiwany, środowisko uruchomieniowe drukuje ślad stosu wyjątku do konsoli programu, a następnie przerywa działanie wątku.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-128">When code running on such a thread throws an exception that it does not handle, the runtime prints the exception stack trace to the console and then gracefully terminates the thread.</span></span>  
  
- <span data-ttu-id="c3a1c-129">Nie ma takiego znaczenia jako nieobsłużonego wyjątku w wątku finalizatora.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-129">There is no such thing as an unhandled exception on the finalizer thread.</span></span> <span data-ttu-id="c3a1c-130">Gdy finalizator zgłasza wyjątek, który nie jest obsługiwany, środowisko uruchomieniowe drukuje ślad stosu wyjątku do konsoli programu, a następnie zezwoli wątekowi finalizatora na wznowienie działania finalizatorów.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-130">When a finalizer throws an exception that it does not handle, the runtime prints the exception stack trace to the console and then allows the finalizer thread to resume running finalizers.</span></span>  
  
 <span data-ttu-id="c3a1c-131">Stan pierwszego planu lub tła wątku zarządzanego nie ma wpływu na to zachowanie.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-131">The foreground or background status of a managed thread does not affect this behavior.</span></span>  
  
 <span data-ttu-id="c3a1c-132">W przypadku nieobsłużonych wyjątków w wątkach pochodzących z kodu niezarządzanego różnica jest bardziej subtelna.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-132">For unhandled exceptions on threads originating in unmanaged code, the difference is more subtle.</span></span> <span data-ttu-id="c3a1c-133">Okno dialogowe do dołączania JIT środowiska uruchomieniowego zastępują okno dialogowe systemu operacyjnego dla wyjątków zarządzanych lub natywnych wyjątków w wątkach, które przechodzą przez kod natywny.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-133">The runtime JIT-attach dialog preempts the operating system dialog for managed exceptions or native exceptions on threads that have passed through native code.</span></span> <span data-ttu-id="c3a1c-134">Proces kończy się we wszystkich przypadkach.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-134">The process terminates in all cases.</span></span>  
  
### <a name="migrating-code"></a><span data-ttu-id="c3a1c-135">Migrowanie kodu</span><span class="sxs-lookup"><span data-stu-id="c3a1c-135">Migrating Code</span></span>  
 <span data-ttu-id="c3a1c-136">Ogólnie rzecz biorąc, zmiana ta spowoduje ujawnienie wcześniej nierozpoznanych problemów programistycznych, dzięki czemu mogą one zostać naprawione.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-136">In general, the change will expose previously unrecognized programming problems so that they can be fixed.</span></span> <span data-ttu-id="c3a1c-137">Jednak w niektórych przypadkach programiści mogą korzystać z funkcji przerwania w czasie wykonywania, na przykład do kończenia wątków.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-137">In some cases, however, programmers might have taken advantage of the runtime backstop, for example to terminate threads.</span></span> <span data-ttu-id="c3a1c-138">W zależności od sytuacji należy wziąć pod uwagę jedną z następujących strategii migracji:</span><span class="sxs-lookup"><span data-stu-id="c3a1c-138">Depending on the situation, they should consider one of the following migration strategies:</span></span>  
  
- <span data-ttu-id="c3a1c-139">Restrukturyzacja kodu, dzięki czemu wątek zostanie bezproblemowo zakończony po odebraniu sygnału.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-139">Restructure the code so the thread exits gracefully when a signal is received.</span></span>  
  
- <span data-ttu-id="c3a1c-140">Użyj metody <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType>, aby przerwać wątek.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-140">Use the <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> method to abort the thread.</span></span>  
  
- <span data-ttu-id="c3a1c-141">Jeśli wątek musi zostać zatrzymany, aby zakończyć proces, należy wykonać wątek jako wątek w tle, dzięki czemu zostanie on automatycznie przerwany po zakończeniu procesu.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-141">If a thread must be stopped so that process termination can proceed, make the thread a background thread so that it is automatically terminated on process exit.</span></span>  
  
 <span data-ttu-id="c3a1c-142">We wszystkich przypadkach strategia powinna być zgodna z zaleceniami dotyczącymi projektowania wyjątków.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-142">In all cases, the strategy should follow the design guidelines for exceptions.</span></span> <span data-ttu-id="c3a1c-143">Zobacz [wskazówki dotyczące projektowania wyjątków](../../../docs/standard/design-guidelines/exceptions.md).</span><span class="sxs-lookup"><span data-stu-id="c3a1c-143">See [Design Guidelines for Exceptions](../../../docs/standard/design-guidelines/exceptions.md).</span></span>  
  
### <a name="application-compatibility-flag"></a><span data-ttu-id="c3a1c-144">Flaga zgodności aplikacji</span><span class="sxs-lookup"><span data-stu-id="c3a1c-144">Application Compatibility Flag</span></span>  
 <span data-ttu-id="c3a1c-145">Jako tymczasową miarę zgodności Administratorzy mogą umieścić flagę zgodności w sekcji `<runtime>` w pliku konfiguracji aplikacji.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-145">As a temporary compatibility measure, administrators can place a compatibility flag in the `<runtime>` section of the application configuration file.</span></span> <span data-ttu-id="c3a1c-146">Powoduje to, że środowisko uruchomieniowe języka wspólnego przywraca zachowanie wersji 1,0 i 1,1.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-146">This causes the common language runtime to revert to the behavior of versions 1.0 and 1.1.</span></span>  
  
```xml  
<legacyUnhandledExceptionPolicy enabled="1"/>  
```  
  
## <a name="host-override"></a><span data-ttu-id="c3a1c-147">Zastąpienie hosta</span><span class="sxs-lookup"><span data-stu-id="c3a1c-147">Host Override</span></span>  
 <span data-ttu-id="c3a1c-148">W .NET Framework w wersji 2,0 Host niezarządzany może użyć interfejsu [ICLRPolicyManager](../../../docs/framework/unmanaged-api/hosting/iclrpolicymanager-interface.md) w interfejsie API hostingu, aby zastąpić domyślne zasady nieobsłużonego wyjątku środowiska uruchomieniowego języka wspólnego.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-148">In the .NET Framework version 2.0, an unmanaged host can use the [ICLRPolicyManager](../../../docs/framework/unmanaged-api/hosting/iclrpolicymanager-interface.md) interface in the Hosting API to override the default unhandled exception policy of the common language runtime.</span></span> <span data-ttu-id="c3a1c-149">Funkcja [ICLRPolicyManager:: SetUnhandledExceptionPolicy —](../../../docs/framework/unmanaged-api/hosting/iclrpolicymanager-setunhandledexceptionpolicy-method.md) służy do ustawiania zasad dla nieobsłużonych wyjątków.</span><span class="sxs-lookup"><span data-stu-id="c3a1c-149">The [ICLRPolicyManager::SetUnhandledExceptionPolicy](../../../docs/framework/unmanaged-api/hosting/iclrpolicymanager-setunhandledexceptionpolicy-method.md) function is used to set the policy for unhandled exceptions.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c3a1c-150">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="c3a1c-150">See also</span></span>

- [<span data-ttu-id="c3a1c-151">Zarządzana wątkowość — podstawy</span><span class="sxs-lookup"><span data-stu-id="c3a1c-151">Managed Threading Basics</span></span>](../../../docs/standard/threading/managed-threading-basics.md)
