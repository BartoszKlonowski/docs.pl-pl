---
title: 'CA5392: Użyj atrybutu DefaultDllImportSearchPaths dla elementu P/Invoke (analiza kodu)'
description: Zawiera informacje o regule analizy kodu CA5392, w tym o przyczynach, sposobach rozwiązywania naruszeń oraz o tym, kiedy należy je pominąć.
ms.date: 05/28/2020
ms.topic: reference
author: LLLXXXCCC
ms.author: linche
f1_keywords:
- CA5392
ms.openlocfilehash: f6c488bcc40d1cd52bc2404e7174752c0b76c79f
ms.sourcegitcommit: 2e4adc490c1d2a705a0592b295d606b10b9f51f1
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 09/25/2020
ms.locfileid: "96589307"
---
# <a name="ca5392-use-defaultdllimportsearchpaths-attribute-for-pinvokes"></a><span data-ttu-id="e0a7a-103">CA5392: Użyj atrybutu DefaultDllImportSearchPaths dla elementów P/Invoke</span><span class="sxs-lookup"><span data-stu-id="e0a7a-103">CA5392: Use DefaultDllImportSearchPaths attribute for P/Invokes</span></span>

| | <span data-ttu-id="e0a7a-104">Wartość</span><span class="sxs-lookup"><span data-stu-id="e0a7a-104">Value</span></span> |
|-|-|
| <span data-ttu-id="e0a7a-105">**Identyfikator zasady**</span><span class="sxs-lookup"><span data-stu-id="e0a7a-105">**Rule ID**</span></span> |<span data-ttu-id="e0a7a-106">CA5392</span><span class="sxs-lookup"><span data-stu-id="e0a7a-106">CA5392</span></span>|
| <span data-ttu-id="e0a7a-107">**Kategoria**</span><span class="sxs-lookup"><span data-stu-id="e0a7a-107">**Category**</span></span> |<span data-ttu-id="e0a7a-108">Microsoft.Security</span><span class="sxs-lookup"><span data-stu-id="e0a7a-108">Microsoft.Security</span></span>|
| <span data-ttu-id="e0a7a-109">**Naprawa jest przerywana lub nieprzerwana**</span><span class="sxs-lookup"><span data-stu-id="e0a7a-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="e0a7a-110">Nieprzerwanie</span><span class="sxs-lookup"><span data-stu-id="e0a7a-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="e0a7a-111">Przyczyna</span><span class="sxs-lookup"><span data-stu-id="e0a7a-111">Cause</span></span>

<span data-ttu-id="e0a7a-112"><xref:System.Runtime.InteropServices.DefaultDllImportSearchPathsAttribute>Nie określono dla funkcji [wywołania platformy (P/Invoke)](../../../standard/native-interop/pinvoke.md) .</span><span class="sxs-lookup"><span data-stu-id="e0a7a-112">The <xref:System.Runtime.InteropServices.DefaultDllImportSearchPathsAttribute> is not specified for a [Platform Invoke (P/Invoke)](../../../standard/native-interop/pinvoke.md) function.</span></span>

## <a name="rule-description"></a><span data-ttu-id="e0a7a-113">Opis reguły</span><span class="sxs-lookup"><span data-stu-id="e0a7a-113">Rule description</span></span>

<span data-ttu-id="e0a7a-114">Domyślnie funkcja P/Invoke korzysta z <xref:System.Runtime.InteropServices.DllImportAttribute> sondowania wielu katalogów, w tym bieżącego katalogu roboczego biblioteki do załadowania.</span><span class="sxs-lookup"><span data-stu-id="e0a7a-114">By default, P/Invoke functions using <xref:System.Runtime.InteropServices.DllImportAttribute> probe a number of directories, including the current working directory for the library to load.</span></span> <span data-ttu-id="e0a7a-115">Może to być problem z zabezpieczeniami dla niektórych aplikacji, co prowadzi do przejęcia biblioteki DLL.</span><span class="sxs-lookup"><span data-stu-id="e0a7a-115">This can be a security issue for certain applications, leading to DLL hijacking.</span></span>

<span data-ttu-id="e0a7a-116">Na przykład jeśli złośliwa Biblioteka DLL o takiej samej nazwie jak zaimportowany plik jest umieszczana w bieżącym katalogu roboczym, który będzie domyślnie przeszukiwany w pierwszej kolejności, wówczas złośliwa Biblioteka DLL może zostać załadowana.</span><span class="sxs-lookup"><span data-stu-id="e0a7a-116">For example, if a malicious DLL with the same name as the imported one is placed under the current working directory, which will be searched firstly by default, then the malicious DLL could be loaded.</span></span>

<span data-ttu-id="e0a7a-117">Aby uzyskać więcej informacji, zobacz [bezpieczne ładowanie biblioteki](https://msrc-blog.microsoft.com/2014/05/13/load-library-safely/).</span><span class="sxs-lookup"><span data-stu-id="e0a7a-117">For more information, see [Load Library Safely](https://msrc-blog.microsoft.com/2014/05/13/load-library-safely/).</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="e0a7a-118">Jak naprawić naruszenia</span><span class="sxs-lookup"><span data-stu-id="e0a7a-118">How to fix violations</span></span>

<span data-ttu-id="e0a7a-119">Służy <xref:System.Runtime.InteropServices.DefaultDllImportSearchPathsAttribute> do określania ścieżki wyszukiwania biblioteki DLL jawnie dla zestawu lub metody.</span><span class="sxs-lookup"><span data-stu-id="e0a7a-119">Use <xref:System.Runtime.InteropServices.DefaultDllImportSearchPathsAttribute> to specify the DLL search path explicitly for the assembly or the method.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="e0a7a-120">Kiedy pominąć ostrzeżenia</span><span class="sxs-lookup"><span data-stu-id="e0a7a-120">When to suppress warnings</span></span>

<span data-ttu-id="e0a7a-121">Można bezpiecznie pominąć tę regułę:</span><span class="sxs-lookup"><span data-stu-id="e0a7a-121">It's safe to suppress this rule i:</span></span>

- <span data-ttu-id="e0a7a-122">Masz pewność, że załadowany zestaw jest tym, czego potrzebujesz.</span><span class="sxs-lookup"><span data-stu-id="e0a7a-122">You're sure the loaded assembly is what you want.</span></span> <span data-ttu-id="e0a7a-123">Na przykład aplikacja jest uruchamiana na zaufanym serwerze i całkowicie ufa plikom.</span><span class="sxs-lookup"><span data-stu-id="e0a7a-123">For example, your application runs on a trusted server and you completely trust the files.</span></span>
- <span data-ttu-id="e0a7a-124">Zaimportowany zestaw jest powszechnie używanym zestawem systemowym, takim jak user32.dll, a strategia ścieżki wyszukiwania jest zgodna z [mechanizmem znanych bibliotek DLL](/archive/blogs/larryosterman/what-are-known-dlls-anyway).</span><span class="sxs-lookup"><span data-stu-id="e0a7a-124">The imported assembly is a commonly used system assembly, like user32.dll, and the search path strategy follows the [Known DLLs mechanism](/archive/blogs/larryosterman/what-are-known-dlls-anyway).</span></span>

## <a name="pseudo-code-examples"></a><span data-ttu-id="e0a7a-125">Przykłady pseudo kodu</span><span class="sxs-lookup"><span data-stu-id="e0a7a-125">Pseudo-code examples</span></span>

```csharp
using System;
using System.Runtime.InteropServices;

class ExampleClass
{
    [DllImport("The3rdAssembly.dll")]
    public static extern int MessageBox(IntPtr hWnd, String text, String caption, uint type);

    public void ExampleMethod()
    {
        MessageBox(new IntPtr(0), "Hello World!", "Hello Dialog", 0);
    }
}
```

### <a name="solution"></a><span data-ttu-id="e0a7a-126">Rozwiązanie</span><span class="sxs-lookup"><span data-stu-id="e0a7a-126">Solution</span></span>

```csharp
using System;
using System.Runtime.InteropServices;

class ExampleClass
{
    [DllImport("The3rdAssembly.dll")]
    [DefaultDllImportSearchPaths(DllImportSearchPath.UserDirectories)]
    public static extern int MessageBox(IntPtr hWnd, String text, String caption, uint type);

    public void ExampleMethod()
    {
        MessageBox(new IntPtr(0), "Hello World!", "Hello Dialog", 0);
    }
}
```

## <a name="related-rules"></a><span data-ttu-id="e0a7a-127">Powiązane reguły</span><span class="sxs-lookup"><span data-stu-id="e0a7a-127">Related rules</span></span>

[<span data-ttu-id="e0a7a-128">CA5393: Nie używaj niebezpiecznej wartości DllImportSearchPath</span><span class="sxs-lookup"><span data-stu-id="e0a7a-128">CA5393: Do not use unsafe DllImportSearchPath value</span></span>](ca5393.md)
