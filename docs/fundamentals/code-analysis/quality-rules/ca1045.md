---
title: 'CA1045: nie przekazuj typów przez odwołanie (analiza kodu)'
description: 'Dowiedz się więcej o regule analizy kodu CA1045: nie przekazuj typów przez odwołanie'
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- CA1045
- DoNotPassTypesByReference
helpviewer_keywords:
- CA1045
- DoNotPassTypesByReference
author: gewarren
ms.author: gewarren
ms.openlocfilehash: 475e62a2abbab7c071e3b5d51b2ada5227111eaa
ms.sourcegitcommit: 2e4adc490c1d2a705a0592b295d606b10b9f51f1
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 09/25/2020
ms.locfileid: "96589100"
---
# <a name="ca1045-do-not-pass-types-by-reference"></a><span data-ttu-id="c86ad-103">CA1045: Nie przekazuj typów przez odwołanie</span><span class="sxs-lookup"><span data-stu-id="c86ad-103">CA1045: Do not pass types by reference</span></span>

| | <span data-ttu-id="c86ad-104">Wartość</span><span class="sxs-lookup"><span data-stu-id="c86ad-104">Value</span></span> |
|-|-|
| <span data-ttu-id="c86ad-105">**Identyfikator zasady**</span><span class="sxs-lookup"><span data-stu-id="c86ad-105">**Rule ID**</span></span> |<span data-ttu-id="c86ad-106">CA1045</span><span class="sxs-lookup"><span data-stu-id="c86ad-106">CA1045</span></span>|
| <span data-ttu-id="c86ad-107">**Kategoria**</span><span class="sxs-lookup"><span data-stu-id="c86ad-107">**Category**</span></span> |<span data-ttu-id="c86ad-108">Microsoft. Design</span><span class="sxs-lookup"><span data-stu-id="c86ad-108">Microsoft.Design</span></span>|
| <span data-ttu-id="c86ad-109">**Naprawa jest przerywana lub nieprzerwana**</span><span class="sxs-lookup"><span data-stu-id="c86ad-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="c86ad-110">Kluczowa</span><span class="sxs-lookup"><span data-stu-id="c86ad-110">Breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="c86ad-111">Przyczyna</span><span class="sxs-lookup"><span data-stu-id="c86ad-111">Cause</span></span>

<span data-ttu-id="c86ad-112">Metoda publiczna lub chroniona w typie publicznym ma `ref` parametr, który przyjmuje typ pierwotny, typ referencyjny lub typ wartości, który nie jest jednym z typów wbudowanych.</span><span class="sxs-lookup"><span data-stu-id="c86ad-112">A public or protected method in a public type has a `ref` parameter that takes a primitive type, a reference type, or a value type that is not one of the built-in types.</span></span>

## <a name="rule-description"></a><span data-ttu-id="c86ad-113">Opis reguły</span><span class="sxs-lookup"><span data-stu-id="c86ad-113">Rule description</span></span>

<span data-ttu-id="c86ad-114">Przekazywanie typów przez odwołanie (za pomocą `out` lub `ref` ) wymaga środowiska ze wskaźnikami, zrozumienie, jak typy wartości i typy odwołań różnią się i obsługują metody, które mają wiele wartości zwracanych.</span><span class="sxs-lookup"><span data-stu-id="c86ad-114">Passing types by reference (using `out` or `ref`) requires experience with pointers, understanding how value types and reference types differ, and handling methods that have multiple return values.</span></span> <span data-ttu-id="c86ad-115">Ponadto różnice między `out` i `ref` parametrów nie są szeroko zrozumiałe.</span><span class="sxs-lookup"><span data-stu-id="c86ad-115">Also, the difference between `out` and `ref` parameters is not widely understood.</span></span>

<span data-ttu-id="c86ad-116">Gdy typ odwołania jest przenoszona "przez odwołanie", Metoda zamierza użyć parametru, aby zwrócić inne wystąpienie obiektu.</span><span class="sxs-lookup"><span data-stu-id="c86ad-116">When a reference type is passed "by reference," the method intends to use the parameter to return a different instance of the object.</span></span> <span data-ttu-id="c86ad-117">(Przekazywanie typu odwołania przez odwołanie jest również znane jako użycie podwójnego wskaźnika, wskaźnika do wskaźnika lub podwójnego pośrednika). Przy użyciu domyślnej konwencji wywoływania, która jest przekazywany "przez wartość", parametr, który pobiera typ odwołania, już otrzymuje wskaźnik do obiektu.</span><span class="sxs-lookup"><span data-stu-id="c86ad-117">(Passing a reference type by reference is also known as using a double pointer, pointer to a pointer, or double indirection.) Using the default calling convention, which is pass "by value," a parameter that takes a reference type already receives a pointer to the object.</span></span> <span data-ttu-id="c86ad-118">Wskaźnik, a nie obiekt, do którego wskazuje, jest przenoszona przez wartość.</span><span class="sxs-lookup"><span data-stu-id="c86ad-118">The pointer, not the object to which it points, is passed by value.</span></span> <span data-ttu-id="c86ad-119">Przekazywanie przez wartość oznacza, że metoda nie może zmienić wskaźnika tak, aby wskazywała nowe wystąpienie typu referencyjnego, ale może zmienić zawartość obiektu, do którego wskazuje.</span><span class="sxs-lookup"><span data-stu-id="c86ad-119">Passing by value means that the method cannot change the pointer to have it point to a new instance of the reference type, but can change the contents of the object to which it points.</span></span> <span data-ttu-id="c86ad-120">W przypadku większości aplikacji jest to wystarczające i zapewnia zachowanie, które chcesz.</span><span class="sxs-lookup"><span data-stu-id="c86ad-120">For most applications this is sufficient and yields the behavior that you want.</span></span>

<span data-ttu-id="c86ad-121">Jeśli metoda musi zwrócić inne wystąpienie, użyj wartości zwracanej metody, aby to osiągnąć.</span><span class="sxs-lookup"><span data-stu-id="c86ad-121">If a method must return a different instance, use the return value of the method to accomplish this.</span></span> <span data-ttu-id="c86ad-122">Zapoznaj się z <xref:System.String?displayProperty=fullName> klasą dla różnych metod, które działają na ciągach i zwracają nowe wystąpienie ciągu.</span><span class="sxs-lookup"><span data-stu-id="c86ad-122">See the <xref:System.String?displayProperty=fullName> class for a variety of methods that operate on strings and return a new instance of a string.</span></span> <span data-ttu-id="c86ad-123">Przy użyciu tego modelu pozostało do obiektu wywołującego, aby zdecydować, czy oryginalny obiekt jest zachowywany.</span><span class="sxs-lookup"><span data-stu-id="c86ad-123">By using this model, it is left to the caller to decide whether the original object is preserved.</span></span>

<span data-ttu-id="c86ad-124">Mimo że zwracane wartości są commonplace i intensywnie używane, poprawne stosowanie `out` i `ref` parametrów wymaga pośrednich umiejętności związanych z projektowaniem i programowaniem.</span><span class="sxs-lookup"><span data-stu-id="c86ad-124">Although return values are commonplace and heavily used, the correct application of `out` and `ref` parameters requires intermediate design and coding skills.</span></span> <span data-ttu-id="c86ad-125">Architekty biblioteki, którzy projektują dla ogólnych odbiorców, nie powinni oczekiwać od użytkowników, aby Master pracował z `out` lub `ref` parametrami.</span><span class="sxs-lookup"><span data-stu-id="c86ad-125">Library architects who design for a general audience should not expect users to master working with `out` or `ref` parameters.</span></span>

> [!NOTE]
> <span data-ttu-id="c86ad-126">Podczas pracy z parametrami, które są duże struktury, dodatkowe zasoby, które są wymagane do kopiowania tych struktur, mogą spowodować efekt wydajności podczas przekazywania przez wartość.</span><span class="sxs-lookup"><span data-stu-id="c86ad-126">When you work with parameters that are large structures, the additional resources that are required to copy these structures could cause a performance effect when you pass by value.</span></span> <span data-ttu-id="c86ad-127">W takich przypadkach można rozważyć użycie `ref` lub `out` parametry.</span><span class="sxs-lookup"><span data-stu-id="c86ad-127">In these cases, you might consider using `ref` or `out` parameters.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="c86ad-128">Jak naprawić naruszenia</span><span class="sxs-lookup"><span data-stu-id="c86ad-128">How to fix violations</span></span>

<span data-ttu-id="c86ad-129">Aby naprawić naruszenie tej zasady, która jest spowodowana przez typ wartości, należy zwrócić obiekt jako wartość zwracaną przez metodę.</span><span class="sxs-lookup"><span data-stu-id="c86ad-129">To fix a violation of this rule that is caused by a value type, have the method return the object as its return value.</span></span> <span data-ttu-id="c86ad-130">Jeśli metoda musi zwracać wiele wartości, Zaprojektuj ją w celu zwrócenia pojedynczego wystąpienia obiektu, który zawiera wartości.</span><span class="sxs-lookup"><span data-stu-id="c86ad-130">If the method must return multiple values, redesign it to return a single instance of an object that holds the values.</span></span>

<span data-ttu-id="c86ad-131">Aby naprawić naruszenie tej zasady, która jest spowodowana przez typ referencyjny, należy się upewnić, że zachowanie ma zwrócić nowe wystąpienie odwołania.</span><span class="sxs-lookup"><span data-stu-id="c86ad-131">To fix a violation of this rule that is caused by a reference type, make sure that the behavior that you want is to return a new instance of the reference.</span></span> <span data-ttu-id="c86ad-132">Jeśli tak jest, metoda powinna używać jej wartości zwracanej, aby to zrobić.</span><span class="sxs-lookup"><span data-stu-id="c86ad-132">If it is, the method should use its return value to do this.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="c86ad-133">Kiedy pominąć ostrzeżenia</span><span class="sxs-lookup"><span data-stu-id="c86ad-133">When to suppress warnings</span></span>

<span data-ttu-id="c86ad-134">Można bezpiecznie pominąć ostrzeżenie z tej reguły. Jednak ten projekt może powodować problemy z użytecznością.</span><span class="sxs-lookup"><span data-stu-id="c86ad-134">It is safe to suppress a warning from this rule; however, this design could cause usability issues.</span></span>

## <a name="configurability"></a><span data-ttu-id="c86ad-135">Określając</span><span class="sxs-lookup"><span data-stu-id="c86ad-135">Configurability</span></span>

<span data-ttu-id="c86ad-136">Począwszy od wersji 3.0.0 pakietu analizatora, można skonfigurować, które części bazy kodu mają uruchamiać tę regułę, na podstawie ich dostępności.</span><span class="sxs-lookup"><span data-stu-id="c86ad-136">Starting with version 3.0.0 of the analyzer package, You can configure which parts of your codebase to run this rule on, based on their accessibility.</span></span> <span data-ttu-id="c86ad-137">Na przykład aby określić, że reguła powinna być uruchamiana tylko względem powierzchni niepublicznego interfejsu API, Dodaj następującą parę klucz-wartość do pliku *editorconfig* w projekcie:</span><span class="sxs-lookup"><span data-stu-id="c86ad-137">For example, to specify that the rule should run only against the non-public API surface, add the following key-value pair to an *.editorconfig* file in your project:</span></span>

```ini
dotnet_code_quality.ca1045.api_surface = private, internal
```

<span data-ttu-id="c86ad-138">Tę opcję można skonfigurować tylko dla tej reguły, dla wszystkich reguł lub dla wszystkich reguł w tej kategorii (projekt).</span><span class="sxs-lookup"><span data-stu-id="c86ad-138">You can configure this option for just this rule, for all rules, or for all rules in this category (Design).</span></span> <span data-ttu-id="c86ad-139">Aby uzyskać więcej informacji, zobacz [Opcje konfiguracji reguł jakości kodu](../code-quality-rule-options.md).</span><span class="sxs-lookup"><span data-stu-id="c86ad-139">For more information, see [Code quality rule configuration options](../code-quality-rule-options.md).</span></span>

## <a name="example"></a><span data-ttu-id="c86ad-140">Przykład</span><span class="sxs-lookup"><span data-stu-id="c86ad-140">Example</span></span>

<span data-ttu-id="c86ad-141">W poniższej bibliotece przedstawiono dwie implementacje klasy, która generuje odpowiedzi na opinie użytkowników.</span><span class="sxs-lookup"><span data-stu-id="c86ad-141">The following library shows two implementations of a class that generates responses to the feedback of the user.</span></span> <span data-ttu-id="c86ad-142">Pierwsza implementacja ( `BadRefAndOut` ) wymusza, aby użytkownik biblioteki zarządzał trzema zwracanymi wartościami.</span><span class="sxs-lookup"><span data-stu-id="c86ad-142">The first implementation (`BadRefAndOut`) forces the library user to manage three return values.</span></span> <span data-ttu-id="c86ad-143">Druga implementacja ( `RedesignedRefAndOut` ) upraszcza środowisko użytkownika, zwracając wystąpienie klasy kontenera ( `ReplyData` ), które zarządza danymi jako pojedynczą jednostką.</span><span class="sxs-lookup"><span data-stu-id="c86ad-143">The second implementation (`RedesignedRefAndOut`) simplifies the user experience by returning an instance of a container class (`ReplyData`) that manages the data as a single unit.</span></span>

:::code language="csharp" source="snippets/csharp/all-rules/ca1045.cs" id="snippet1":::

## <a name="example-1"></a><span data-ttu-id="c86ad-144">Przykład 1</span><span class="sxs-lookup"><span data-stu-id="c86ad-144">Example 1</span></span>

<span data-ttu-id="c86ad-145">W poniższej aplikacji przedstawiono środowisko użytkownika.</span><span class="sxs-lookup"><span data-stu-id="c86ad-145">The following application illustrates the experience of the user.</span></span> <span data-ttu-id="c86ad-146">Wywołanie przeprojektowanej biblioteki ( `UseTheSimplifiedClass` Metoda) jest bardziej proste, a informacje zwracane przez metodę są łatwo zarządzane.</span><span class="sxs-lookup"><span data-stu-id="c86ad-146">The call to the redesigned library (`UseTheSimplifiedClass` method) is more straightforward, and the information that is returned by the method is easily managed.</span></span> <span data-ttu-id="c86ad-147">Dane wyjściowe z dwóch metod są identyczne.</span><span class="sxs-lookup"><span data-stu-id="c86ad-147">The output from the two methods is identical.</span></span>

:::code language="csharp" source="snippets/csharp/all-rules/ca1045.cs" id="snippet2":::

## <a name="example-2"></a><span data-ttu-id="c86ad-148">Przykład 2</span><span class="sxs-lookup"><span data-stu-id="c86ad-148">Example 2</span></span>

<span data-ttu-id="c86ad-149">W poniższej bibliotece pokazano, jak `ref` są używane parametry typów referencyjnych i przedstawiono lepszy sposób implementacji tej funkcji.</span><span class="sxs-lookup"><span data-stu-id="c86ad-149">The following example library illustrates how `ref` parameters for reference types are used, and shows a better way to implement this functionality.</span></span>

:::code language="csharp" source="snippets/csharp/all-rules/ca1045.cs" id="snippet3":::

## <a name="example-3"></a><span data-ttu-id="c86ad-150">Przykład 3</span><span class="sxs-lookup"><span data-stu-id="c86ad-150">Example 3</span></span>

<span data-ttu-id="c86ad-151">Następująca aplikacja wywołuje każdą metodę w bibliotece, aby przedstawić zachowanie.</span><span class="sxs-lookup"><span data-stu-id="c86ad-151">The following application calls each method in the library to demonstrate the behavior.</span></span>

:::code language="csharp" source="snippets/csharp/all-rules/ca1045.cs" id="snippet4":::

<span data-ttu-id="c86ad-152">Ten przykład generuje następujące wyniki:</span><span class="sxs-lookup"><span data-stu-id="c86ad-152">This example produces the following output:</span></span>

```txt
Changing pointer - passed by value:
12345
12345
Changing pointer - passed by reference:
12345
12345 ABCDE
Passing by return value:
12345 ABCDE
```

## <a name="related-rules"></a><span data-ttu-id="c86ad-153">Powiązane reguły</span><span class="sxs-lookup"><span data-stu-id="c86ad-153">Related rules</span></span>

[<span data-ttu-id="c86ad-154">CA1021: Unikaj parametrów out</span><span class="sxs-lookup"><span data-stu-id="c86ad-154">CA1021: Avoid out parameters</span></span>](ca1021.md)
