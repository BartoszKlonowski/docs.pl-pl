---
title: 'CA2007: nie należy bezpośrednio czekać na zadanie (analiza kodu)'
description: 'Dowiedz się więcej o regule analizy kodu CA2007: nie należy bezpośrednio czekać na zadanie'
ms.date: 03/08/2019
ms.topic: reference
f1_keywords:
- CA2007
- DoNotDirectlyAwaitATaskAnalyzer
helpviewer_keywords:
- CA2007
author: gewarren
ms.author: gewarren
dev_langs:
- CSharp
ms.openlocfilehash: 3a0ae8035b897562d1d50a6d006fc8937f5bb315
ms.sourcegitcommit: 636af37170ae75a11c4f7d1ecd770820e7dfe7bd
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/07/2020
ms.locfileid: "96589431"
---
# <a name="ca2007-do-not-directly-await-a-task"></a><span data-ttu-id="a3682-103">CA2007: Nie oczekuj bezpośrednio zadania</span><span class="sxs-lookup"><span data-stu-id="a3682-103">CA2007: Do not directly await a Task</span></span>

| | <span data-ttu-id="a3682-104">Wartość</span><span class="sxs-lookup"><span data-stu-id="a3682-104">Value</span></span> |
|-|-|
| <span data-ttu-id="a3682-105">**Identyfikator zasady**</span><span class="sxs-lookup"><span data-stu-id="a3682-105">**Rule ID**</span></span> |<span data-ttu-id="a3682-106">CA2007</span><span class="sxs-lookup"><span data-stu-id="a3682-106">CA2007</span></span>|
| <span data-ttu-id="a3682-107">**Kategoria**</span><span class="sxs-lookup"><span data-stu-id="a3682-107">**Category**</span></span> |<span data-ttu-id="a3682-108">Microsoft. niezawodność</span><span class="sxs-lookup"><span data-stu-id="a3682-108">Microsoft.Reliability</span></span>|
| <span data-ttu-id="a3682-109">**Naprawa jest przerywana lub nieprzerwana**</span><span class="sxs-lookup"><span data-stu-id="a3682-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="a3682-110">Nieprzerwanie</span><span class="sxs-lookup"><span data-stu-id="a3682-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="a3682-111">Przyczyna</span><span class="sxs-lookup"><span data-stu-id="a3682-111">Cause</span></span>

<span data-ttu-id="a3682-112">Metoda asynchroniczna [czeka](../../../csharp/language-reference/operators/await.md) <xref:System.Threading.Tasks.Task> bezpośrednio.</span><span class="sxs-lookup"><span data-stu-id="a3682-112">An asynchronous method [awaits](../../../csharp/language-reference/operators/await.md) a <xref:System.Threading.Tasks.Task> directly.</span></span>

## <a name="rule-description"></a><span data-ttu-id="a3682-113">Opis reguły</span><span class="sxs-lookup"><span data-stu-id="a3682-113">Rule description</span></span>

<span data-ttu-id="a3682-114">Gdy Metoda asynchroniczna czeka <xref:System.Threading.Tasks.Task> bezpośrednio, kontynuacja zwykle odbywa się w tym samym wątku, który utworzył zadanie, w zależności od kontekstu asynchronicznego.</span><span class="sxs-lookup"><span data-stu-id="a3682-114">When an asynchronous method awaits a <xref:System.Threading.Tasks.Task> directly, continuation usually occurs in the same thread that created the task, depending on the async context.</span></span> <span data-ttu-id="a3682-115">Takie zachowanie może być kosztowne pod względem wydajności i może spowodować zakleszczenie w wątku interfejsu użytkownika.</span><span class="sxs-lookup"><span data-stu-id="a3682-115">This behavior can be costly in terms of performance and can result in a deadlock on the UI thread.</span></span> <span data-ttu-id="a3682-116">Rozważ wywołanie metody <xref:System.Threading.Tasks.Task.ConfigureAwait(System.Boolean)?displayProperty=nameWithType> sygnalizującej zamiar kontynuacji.</span><span class="sxs-lookup"><span data-stu-id="a3682-116">Consider calling <xref:System.Threading.Tasks.Task.ConfigureAwait(System.Boolean)?displayProperty=nameWithType> to signal your intention for continuation.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="a3682-117">Jak naprawić naruszenia</span><span class="sxs-lookup"><span data-stu-id="a3682-117">How to fix violations</span></span>

<span data-ttu-id="a3682-118">Aby naprawić naruszenia, wywołaj <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> oczekiwane <xref:System.Threading.Tasks.Task> .</span><span class="sxs-lookup"><span data-stu-id="a3682-118">To fix violations, call <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> on the awaited <xref:System.Threading.Tasks.Task>.</span></span> <span data-ttu-id="a3682-119">Można przekazać albo `true` `false` dla `continueOnCapturedContext` parametru.</span><span class="sxs-lookup"><span data-stu-id="a3682-119">You can pass either `true` or `false` for the `continueOnCapturedContext` parameter.</span></span>

- <span data-ttu-id="a3682-120">Wywołanie `ConfigureAwait(true)` dla zadania ma takie samo zachowanie, jak niejawnie wywoływanie <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> .</span><span class="sxs-lookup"><span data-stu-id="a3682-120">Calling `ConfigureAwait(true)` on the task has the same behavior as not explicitly calling <xref:System.Threading.Tasks.Task.ConfigureAwait%2A>.</span></span> <span data-ttu-id="a3682-121">Jawne wywołanie tej metody polega na tym, że czytelnicy będą wiedzieli, że zamierzasz przeprowadzić kontynuację w oryginalnym kontekście synchronizacji.</span><span class="sxs-lookup"><span data-stu-id="a3682-121">By explicitly calling this method, you're letting readers know you intentionally want to perform the continuation on the original synchronization context.</span></span>

- <span data-ttu-id="a3682-122">Wywołaj `ConfigureAwait(false)` zadanie, aby zaplanować kontynuacje puli wątków, unikając w ten sposób zakleszczenia w wątku interfejsu użytkownika.</span><span class="sxs-lookup"><span data-stu-id="a3682-122">Call `ConfigureAwait(false)` on the task to schedule continuations to the thread pool, thereby avoiding a deadlock on the UI thread.</span></span> <span data-ttu-id="a3682-123">Przekazywanie `false` jest dobrym rozwiązaniem dla bibliotek niezależnych od aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a3682-123">Passing `false` is a good option for app-independent libraries.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="a3682-124">Kiedy pominąć ostrzeżenia</span><span class="sxs-lookup"><span data-stu-id="a3682-124">When to suppress warnings</span></span>

<span data-ttu-id="a3682-125">To ostrzeżenie jest przeznaczone dla bibliotek, w których kod może być wykonywany w dowolnych środowiskach i gdzie kod nie powinien określać założeń dotyczących środowiska lub jak obiekt wywołujący metody może być wywoływany lub oczekujący na to.</span><span class="sxs-lookup"><span data-stu-id="a3682-125">This warning is intended for libraries, where the code may be executed in arbitrary environments and where code shouldn't make assumptions about the environment or how the caller of the method may be invoking or waiting on it.</span></span> <span data-ttu-id="a3682-126">Zwykle jest to konieczne, aby całkowicie pominąć ostrzeżenie dla projektów reprezentujących kod aplikacji zamiast kodu biblioteki; w rzeczywistości uruchomienie tej analizatora w kodzie aplikacji (na przykład po kliknięciu przycisku obsługi zdarzeń w programie WinForms lub projekcie WPF) może prowadzić do nieprawidłowych akcji.</span><span class="sxs-lookup"><span data-stu-id="a3682-126">It is generally appropriate to suppress the warning entirely for projects that represent application code rather than library code; in fact, running this analyzer on application code (for example, button click event handlers in a WinForms or WPF project) is likely to lead to the wrong actions being taken.</span></span>

<span data-ttu-id="a3682-127">To ostrzeżenie można pominąć w każdej sytuacji, w której kontynuacja powinna zostać zaplanowana z powrotem do oryginalnego kontekstu lub w przypadku braku takiego kontekstu.</span><span class="sxs-lookup"><span data-stu-id="a3682-127">You can suppress this warning in any situation where either the continuation should be scheduled back to the original context or where there is no such context in place.</span></span> <span data-ttu-id="a3682-128">Na przykład podczas pisania kodu na przycisku kliknij program obsługi zdarzeń w aplikacji WinForms lub WPF, w ogólny sposób kontynuacja oczekiwania z Await powinna być uruchamiana w wątku interfejsu użytkownika, a w związku z tym domyślnym zachowaniem planowania kontynuacji z powrotem do głównego kontekstu jest pożądane.</span><span class="sxs-lookup"><span data-stu-id="a3682-128">For example, when writing code in a button click event handler in a WinForms or WPF application, in general the continuation from an await should run on the UI thread, and thus the default behavior of scheduling the continuation back to the originating context is desirable.</span></span> <span data-ttu-id="a3682-129">Podobnie jak w przypadku pisania kodu w aplikacji ASP.NET Core, domyślnie nie ma <xref:System.Threading.SynchronizationContext> lub <xref:System.Threading.Tasks.TaskScheduler> , dla którego powód nie mógł `ConfigureAwait` faktycznie zmienić żadnego zachowania.</span><span class="sxs-lookup"><span data-stu-id="a3682-129">As another example, when writing code in an ASP.NET Core application, by default there is no <xref:System.Threading.SynchronizationContext> or <xref:System.Threading.Tasks.TaskScheduler>, for which reason a `ConfigureAwait` wouldn't actually change any behavior.</span></span>

## <a name="example"></a><span data-ttu-id="a3682-130">Przykład</span><span class="sxs-lookup"><span data-stu-id="a3682-130">Example</span></span>

<span data-ttu-id="a3682-131">Poniższy fragment kodu generuje ostrzeżenie:</span><span class="sxs-lookup"><span data-stu-id="a3682-131">The following code snippet generates the warning:</span></span>

```csharp
public async Task Execute()
{
    Task task = null;
    await task;
}
```

<span data-ttu-id="a3682-132">Aby naprawić naruszenie, wywołaj <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> oczekiwane <xref:System.Threading.Tasks.Task> :</span><span class="sxs-lookup"><span data-stu-id="a3682-132">To fix the violation, call <xref:System.Threading.Tasks.Task.ConfigureAwait%2A> on the awaited <xref:System.Threading.Tasks.Task>:</span></span>

```csharp
public async Task Execute()
{
    Task task = null;
    await task.ConfigureAwait(false);
}
```

## <a name="configurability"></a><span data-ttu-id="a3682-133">Określając</span><span class="sxs-lookup"><span data-stu-id="a3682-133">Configurability</span></span>

<span data-ttu-id="a3682-134">Można skonfigurować, czy chcesz wykluczyć metody asynchroniczne, które nie zwracają wartości z tej reguły.</span><span class="sxs-lookup"><span data-stu-id="a3682-134">You can configure whether you want to exclude asynchronous methods that don't return a value from this rule.</span></span> <span data-ttu-id="a3682-135">Aby wykluczyć te rodzaje metod, Dodaj następującą parę klucz-wartość do pliku *editorconfig* w projekcie:</span><span class="sxs-lookup"><span data-stu-id="a3682-135">To exclude these kinds of methods, add the following key-value pair to an *.editorconfig* file in your project:</span></span>

```ini
# Package version 2.9.0 and later
dotnet_code_quality.CA2007.exclude_async_void_methods = true

# Package version 2.6.3 and earlier
dotnet_code_quality.CA2007.skip_async_void_methods = true
```

<span data-ttu-id="a3682-136">Można także skonfigurować, do których rodzajów zestawów wyjściowych ma być stosowana ta reguła.</span><span class="sxs-lookup"><span data-stu-id="a3682-136">You can also configure which output assembly kinds to apply this rule to.</span></span> <span data-ttu-id="a3682-137">Na przykład, aby zastosować tę regułę tylko do kodu generującego aplikację konsolową lub dynamicznie połączonej biblioteki (to nie jest aplikacja interfejsu użytkownika), Dodaj następującą parę klucz-wartość do pliku *editorconfig* w projekcie:</span><span class="sxs-lookup"><span data-stu-id="a3682-137">For example, to only apply this rule to code that produces a console application or a dynamically linked library (that is, not a UI app), add the following key-value pair to an *.editorconfig* file in your project:</span></span>

```ini
dotnet_code_quality.CA2007.output_kind = ConsoleApplication, DynamicallyLinkedLibrary
```

<span data-ttu-id="a3682-138">Aby uzyskać więcej informacji, zobacz [Opcje konfiguracji reguł jakości kodu](../code-quality-rule-options.md).</span><span class="sxs-lookup"><span data-stu-id="a3682-138">For more information, see [Code quality rule configuration options](../code-quality-rule-options.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="a3682-139">Zobacz także</span><span class="sxs-lookup"><span data-stu-id="a3682-139">See also</span></span>

- [<span data-ttu-id="a3682-140">ConfigureAwait — często zadawane pytania</span><span class="sxs-lookup"><span data-stu-id="a3682-140">ConfigureAwait FAQ</span></span>](https://devblogs.microsoft.com/dotnet/configureawait-faq/)
- [<span data-ttu-id="a3682-141">Czy należy czekać na zadanie z ConfigureAwait (false)?</span><span class="sxs-lookup"><span data-stu-id="a3682-141">Should I await a task with ConfigureAwait(false)?</span></span>](https://github.com/Microsoft/vs-threading/blob/master/doc/cookbook_vs.md#should-i-await-a-task-with-configureawaitfalse)
- [<span data-ttu-id="a3682-142">CA2008: Nie twórz zadań bez przekazania klasy TaskScheduler</span><span class="sxs-lookup"><span data-stu-id="a3682-142">CA2008: Do not create tasks without passing a TaskScheduler</span></span>](ca2008.md)
- [<span data-ttu-id="a3682-143">Reguły dotyczące niezawodności</span><span class="sxs-lookup"><span data-stu-id="a3682-143">Reliability rules</span></span>](reliability-warnings.md)
