---
title: 'CA3075: niezabezpieczone przetwarzanie DTD (analiza kodu)'
description: 'Dowiedz się więcej o regule analizy kodu CA3075: niezabezpieczone przetwarzanie DTD'
ms.date: 03/18/2019
ms.topic: reference
author: gewarren
ms.author: gewarren
ms.openlocfilehash: 6656beda6847ba0e35d95361845e204f98742b6b
ms.sourcegitcommit: d8020797a6657d0fbbdff362b80300815f682f94
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 11/24/2020
ms.locfileid: "96590024"
---
# <a name="ca3075-insecure-dtd-processing"></a><span data-ttu-id="dd088-103">CA3075: Niezabezpieczone przetwarzanie definicji DTD</span><span class="sxs-lookup"><span data-stu-id="dd088-103">CA3075: Insecure DTD Processing</span></span>

| | <span data-ttu-id="dd088-104">Wartość</span><span class="sxs-lookup"><span data-stu-id="dd088-104">Value</span></span> |
|-|-|
| <span data-ttu-id="dd088-105">**Identyfikator zasady**</span><span class="sxs-lookup"><span data-stu-id="dd088-105">**Rule ID**</span></span> |<span data-ttu-id="dd088-106">CA3075</span><span class="sxs-lookup"><span data-stu-id="dd088-106">CA3075</span></span>|
| <span data-ttu-id="dd088-107">**Kategoria**</span><span class="sxs-lookup"><span data-stu-id="dd088-107">**Category**</span></span> |<span data-ttu-id="dd088-108">Microsoft.Security</span><span class="sxs-lookup"><span data-stu-id="dd088-108">Microsoft.Security</span></span>|
| <span data-ttu-id="dd088-109">**Naprawa jest przerywana lub nieprzerwana**</span><span class="sxs-lookup"><span data-stu-id="dd088-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="dd088-110">Nieprzerwanie</span><span class="sxs-lookup"><span data-stu-id="dd088-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="dd088-111">Przyczyna</span><span class="sxs-lookup"><span data-stu-id="dd088-111">Cause</span></span>

<span data-ttu-id="dd088-112">W przypadku korzystania z niezabezpieczonych <xref:System.Xml.XmlReaderSettings.DtdProcessing%2A> wystąpień lub odwoływania się do zewnętrznych źródeł jednostek Analizator może zaakceptować niezaufane dane wejściowe i ujawnić poufne informacje osobom atakującym.</span><span class="sxs-lookup"><span data-stu-id="dd088-112">If you use insecure <xref:System.Xml.XmlReaderSettings.DtdProcessing%2A> instances or reference external entity sources, the parser may accept untrusted input and disclose sensitive information to attackers.</span></span>

## <a name="rule-description"></a><span data-ttu-id="dd088-113">Opis reguły</span><span class="sxs-lookup"><span data-stu-id="dd088-113">Rule description</span></span>

<span data-ttu-id="dd088-114">*Definicja typu dokumentu (DTD)* to jeden z dwóch sposobów, przez który parser XML może ustalić ważność dokumentu, zgodnie z definicją [organizacja World Wide Web Consortium (W3C) XML (XML) 1,0](https://www.w3.org/TR/2008/REC-xml-20081126/).</span><span class="sxs-lookup"><span data-stu-id="dd088-114">A *Document Type Definition (DTD)* is one of two ways an XML parser can determine the validity of a document, as defined by the  [World Wide Web Consortium (W3C) Extensible Markup Language (XML) 1.0](https://www.w3.org/TR/2008/REC-xml-20081126/).</span></span> <span data-ttu-id="dd088-115">Ta reguła umożliwia wyszukiwanie właściwości i wystąpień, w przypadku których dane niezaufane są akceptowane, aby ostrzec deweloperów o potencjalnych zagrożeniach związanych z [ujawnianiem informacji](../../../framework/wcf/feature-details/information-disclosure.md) lub atakami [typu "odmowa usługi" (DOS)](../../../framework/wcf/feature-details/denial-of-service.md) .</span><span class="sxs-lookup"><span data-stu-id="dd088-115">This rule seeks properties and instances where untrusted data is accepted to warn developers about potential [Information Disclosure](../../../framework/wcf/feature-details/information-disclosure.md) threats or [Denial of Service (DoS)](../../../framework/wcf/feature-details/denial-of-service.md) attacks.</span></span> <span data-ttu-id="dd088-116">Ta zasada wyzwala następujące wyzwalacze:</span><span class="sxs-lookup"><span data-stu-id="dd088-116">This rule triggers when:</span></span>

- <span data-ttu-id="dd088-117">DtdProcessing jest włączona w <xref:System.Xml.XmlReader> wystąpieniu, które rozpoznaje zewnętrzne jednostki XML przy użyciu <xref:System.Xml.XmlUrlResolver> .</span><span class="sxs-lookup"><span data-stu-id="dd088-117">DtdProcessing is enabled on the <xref:System.Xml.XmlReader> instance, which resolves external XML entities using <xref:System.Xml.XmlUrlResolver>.</span></span>

- <span data-ttu-id="dd088-118"><xref:System.Xml.XmlNode.InnerXml%2A>Właściwość w pliku XML jest ustawiona.</span><span class="sxs-lookup"><span data-stu-id="dd088-118">The <xref:System.Xml.XmlNode.InnerXml%2A> property in the XML is set.</span></span>

- <span data-ttu-id="dd088-119"><xref:System.Xml.XmlReaderSettings.DtdProcessing%2A> Właściwość jest ustawiona na wartość Parse.</span><span class="sxs-lookup"><span data-stu-id="dd088-119"><xref:System.Xml.XmlReaderSettings.DtdProcessing%2A> property is set to Parse.</span></span>

- <span data-ttu-id="dd088-120">Niezaufane dane wejściowe są przetwarzane przy użyciu <xref:System.Xml.XmlResolver> zamiast <xref:System.Xml.XmlSecureResolver> .</span><span class="sxs-lookup"><span data-stu-id="dd088-120">Untrusted input is processed using <xref:System.Xml.XmlResolver> instead of <xref:System.Xml.XmlSecureResolver>.</span></span>

- <span data-ttu-id="dd088-121"><xref:System.Xml.XmlReader.Create%2A?displayProperty=nameWithType>Metoda jest wywoływana z niezabezpieczonym <xref:System.Xml.XmlReaderSettings> wystąpieniem lub bez wystąpienia.</span><span class="sxs-lookup"><span data-stu-id="dd088-121">The <xref:System.Xml.XmlReader.Create%2A?displayProperty=nameWithType> method is invoked with an insecure <xref:System.Xml.XmlReaderSettings> instance or no instance at all.</span></span>

- <span data-ttu-id="dd088-122"><xref:System.Xml.XmlReader> jest tworzony z niezabezpieczonymi domyślnymi ustawieniami lub wartościami.</span><span class="sxs-lookup"><span data-stu-id="dd088-122"><xref:System.Xml.XmlReader> is created with insecure default settings or values.</span></span>

<span data-ttu-id="dd088-123">W każdym z tych przypadków wynik jest taki sam: zawartość z systemu plików lub udziałów sieciowych z komputera, na którym jest przetwarzany kod XML, będzie widoczna dla osoby atakującej lub można użyć przetwarzania DTD jako wektora DoS.</span><span class="sxs-lookup"><span data-stu-id="dd088-123">In each of these cases, the outcome is the same: the contents from either the file system or network shares from the machine where the XML is processed will be exposed to the attacker, or DTD processing can be used as a DoS vector.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="dd088-124">Jak naprawić naruszenia</span><span class="sxs-lookup"><span data-stu-id="dd088-124">How to fix violations</span></span>

- <span data-ttu-id="dd088-125">Należy prawidłowo przechwycić i przetworzyć wszystkie wyjątki XmlTextReader, aby uniknąć ujawnienia informacji o ścieżce.</span><span class="sxs-lookup"><span data-stu-id="dd088-125">Catch and process all XmlTextReader exceptions properly to avoid path information disclosure.</span></span>

- <span data-ttu-id="dd088-126">Użyj, <xref:System.Xml.XmlSecureResolver> Aby ograniczyć zasoby, do których XmlTextReader może uzyskać dostęp.</span><span class="sxs-lookup"><span data-stu-id="dd088-126">Use the <xref:System.Xml.XmlSecureResolver> to restrict the resources that the XmlTextReader can access.</span></span>

- <span data-ttu-id="dd088-127">Nie Zezwalaj na <xref:System.Xml.XmlReader> otwieranie jakichkolwiek zasobów zewnętrznych przez ustawienie <xref:System.Xml.XmlResolver> właściwości na **null**.</span><span class="sxs-lookup"><span data-stu-id="dd088-127">Do not allow the <xref:System.Xml.XmlReader> to open any external resources by setting the <xref:System.Xml.XmlResolver> property to **null**.</span></span>

- <span data-ttu-id="dd088-128">Upewnij się, że <xref:System.Data.DataViewManager.DataViewSettingCollectionString%2A?displayProperty=nameWithType> Właściwość jest przypisana z zaufanego źródła.</span><span class="sxs-lookup"><span data-stu-id="dd088-128">Ensure that the <xref:System.Data.DataViewManager.DataViewSettingCollectionString%2A?displayProperty=nameWithType> property is assigned from a trusted source.</span></span>

### <a name="net-framework-35-and-earlier"></a><span data-ttu-id="dd088-129">.NET Framework 3,5 i wcześniejsze</span><span class="sxs-lookup"><span data-stu-id="dd088-129">.NET Framework 3.5 and earlier</span></span>

- <span data-ttu-id="dd088-130">Wyłącz przetwarzanie DTD w przypadku postępowania z niezaufanymi źródłami, ustawiając <xref:System.Xml.XmlReaderSettings.ProhibitDtd%2A> Właściwość na **wartość true**.</span><span class="sxs-lookup"><span data-stu-id="dd088-130">Disable DTD processing if you are dealing with untrusted sources by setting the <xref:System.Xml.XmlReaderSettings.ProhibitDtd%2A> property to **true**.</span></span>

- <span data-ttu-id="dd088-131">Klasa XmlTextReader ma pełne żądanie dziedziczenia zaufania.</span><span class="sxs-lookup"><span data-stu-id="dd088-131">XmlTextReader class has a full trust inheritance demand.</span></span>

### <a name="net-framework-4-and-later"></a><span data-ttu-id="dd088-132">.NET Framework 4 i nowsze</span><span class="sxs-lookup"><span data-stu-id="dd088-132">.NET Framework 4 and later</span></span>

- <span data-ttu-id="dd088-133">Unikaj włączania DtdProcessing w przypadku korzystania z niezaufanych źródeł przez ustawienie <xref:System.Xml.XmlReaderSettings.DtdProcessing%2A?displayProperty=nameWithType> właściwości na wartość **Zabroń** lub **Ignoruj**.</span><span class="sxs-lookup"><span data-stu-id="dd088-133">Avoid enabling DtdProcessing if you're dealing with untrusted sources by setting the <xref:System.Xml.XmlReaderSettings.DtdProcessing%2A?displayProperty=nameWithType> property to **Prohibit** or **Ignore**.</span></span>

- <span data-ttu-id="dd088-134">Upewnij się, że metoda Load () przyjmuje wystąpienie elementu XmlReader we wszystkich przypadkach InnerXml.</span><span class="sxs-lookup"><span data-stu-id="dd088-134">Ensure that the Load() method takes an XmlReader instance in all InnerXml cases.</span></span>

> [!NOTE]
> <span data-ttu-id="dd088-135">Ta reguła może zgłosić fałszywie dodatnie dla niektórych prawidłowych wystąpień XmlSecureResolver.</span><span class="sxs-lookup"><span data-stu-id="dd088-135">This rule might report false positives on some valid XmlSecureResolver instances.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="dd088-136">Kiedy pominąć ostrzeżenia</span><span class="sxs-lookup"><span data-stu-id="dd088-136">When to suppress warnings</span></span>

<span data-ttu-id="dd088-137">Jeśli nie masz pewności, że dane wejściowe są znane z zaufanego źródła, nie pomijaj reguły z tego ostrzeżenia.</span><span class="sxs-lookup"><span data-stu-id="dd088-137">Unless you're sure that the input is known to be from a trusted source, do not suppress a rule from this warning.</span></span>

## <a name="pseudo-code-examples"></a><span data-ttu-id="dd088-138">Przykłady pseudo kodu</span><span class="sxs-lookup"><span data-stu-id="dd088-138">Pseudo-code examples</span></span>

### <a name="violation-1"></a><span data-ttu-id="dd088-139">Naruszenie 1</span><span class="sxs-lookup"><span data-stu-id="dd088-139">Violation 1</span></span>

```csharp
using System.IO;
using System.Xml.Schema;

class TestClass
{
    public XmlSchema Test
    {
        get
        {
            var src = "";
            TextReader tr = new StreamReader(src);
            XmlSchema schema = XmlSchema.Read(tr, null); // warn
            return schema;
        }
    }
}
```

### <a name="solution-1"></a><span data-ttu-id="dd088-140">Rozwiązanie 1</span><span class="sxs-lookup"><span data-stu-id="dd088-140">Solution 1</span></span>

```csharp
using System.IO;
using System.Xml;
using System.Xml.Schema;

class TestClass
{
    public XmlSchema Test
    {
        get
        {
            var src = "";
            TextReader tr = new StreamReader(src);
            XmlReader reader = XmlReader.Create(tr, new XmlReaderSettings() { XmlResolver = null });
            XmlSchema schema = XmlSchema.Read(reader , null);
            return schema;
        }
    }
}
```

### <a name="violation-2"></a><span data-ttu-id="dd088-141">Naruszenie 2</span><span class="sxs-lookup"><span data-stu-id="dd088-141">Violation 2</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    public class TestClass
    {
        public XmlReaderSettings settings = new XmlReaderSettings();
        public void TestMethod(string path)
        {
            var reader = XmlReader.Create(path, settings);  // warn
        }
    }
}
```

### <a name="solution-2"></a><span data-ttu-id="dd088-142">Rozwiązanie 2</span><span class="sxs-lookup"><span data-stu-id="dd088-142">Solution 2</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    public class TestClass
    {
        public XmlReaderSettings settings = new XmlReaderSettings()
        {
            DtdProcessing = DtdProcessing.Prohibit
        };

        public void TestMethod(string path)
        {
            var reader = XmlReader.Create(path, settings);
        }
    }
}
```

### <a name="violation-3"></a><span data-ttu-id="dd088-143">Naruszenie zasad 3</span><span class="sxs-lookup"><span data-stu-id="dd088-143">Violation 3</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    public class DoNotUseSetInnerXml
    {
        public void TestMethod(string xml)
        {
            XmlDocument doc = new XmlDocument() { XmlResolver = null };
            doc.InnerXml = xml; // warn
        }
    }
}
```

```csharp
using System.Xml;

namespace TestNamespace
{
    public class DoNotUseLoadXml
    {
        public void TestMethod(string xml)
        {
            XmlDocument doc = new XmlDocument(){ XmlResolver = null };
            doc.LoadXml(xml); // warn
        }
    }
}
```

### <a name="solution-3"></a><span data-ttu-id="dd088-144">Rozwiązanie 3</span><span class="sxs-lookup"><span data-stu-id="dd088-144">Solution 3</span></span>

```csharp
using System.Xml;

public static void TestMethod(string xml)
{
    XmlDocument doc = new XmlDocument() { XmlResolver = null };
    System.IO.StringReader sreader = new System.IO.StringReader(xml);
    XmlReader reader = XmlReader.Create(sreader, new XmlReaderSettings() { XmlResolver = null });
    doc.Load(reader);
}
```

### <a name="violation-4"></a><span data-ttu-id="dd088-145">Naruszenie 4</span><span class="sxs-lookup"><span data-stu-id="dd088-145">Violation 4</span></span>

```csharp
using System.IO;
using System.Xml;
using System.Xml.Serialization;

namespace TestNamespace
{
    public class UseXmlReaderForDeserialize
    {
        public void TestMethod(Stream stream)
        {
            XmlSerializer serializer = new XmlSerializer(typeof(UseXmlReaderForDeserialize));
            serializer.Deserialize(stream); // warn
        }
    }
}
```

### <a name="solution-4"></a><span data-ttu-id="dd088-146">Rozwiązanie 4</span><span class="sxs-lookup"><span data-stu-id="dd088-146">Solution 4</span></span>

```csharp
using System.IO;
using System.Xml;
using System.Xml.Serialization;

namespace TestNamespace
{
    public class UseXmlReaderForDeserialize
    {
        public void TestMethod(Stream stream)
        {
            XmlSerializer serializer = new XmlSerializer(typeof(UseXmlReaderForDeserialize));
            XmlReader reader = XmlReader.Create(stream, new XmlReaderSettings() { XmlResolver = null });
            serializer.Deserialize(reader );
        }
    }
}
```

### <a name="violation-5"></a><span data-ttu-id="dd088-147">Naruszenie 5</span><span class="sxs-lookup"><span data-stu-id="dd088-147">Violation 5</span></span>

```csharp
using System.Xml;
using System.Xml.XPath;

namespace TestNamespace
{
    public class UseXmlReaderForXPathDocument
    {
        public void TestMethod(string path)
        {
            XPathDocument doc = new XPathDocument(path); // warn
        }
    }
}
```

### <a name="solution-5"></a><span data-ttu-id="dd088-148">Rozwiązanie 5</span><span class="sxs-lookup"><span data-stu-id="dd088-148">Solution 5</span></span>

```csharp
using System.Xml;
using System.Xml.XPath;

namespace TestNamespace
{
    public class UseXmlReaderForXPathDocument
    {
        public void TestMethod(string path)
        {
            XmlReader reader = XmlReader.Create(path, new XmlReaderSettings() { XmlResolver = null });
            XPathDocument doc = new XPathDocument(reader);
        }
    }
}
```

### <a name="violation-6"></a><span data-ttu-id="dd088-149">Naruszenie 6</span><span class="sxs-lookup"><span data-stu-id="dd088-149">Violation 6</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    class TestClass
    {
        public XmlDocument doc = new XmlDocument() { XmlResolver = new XmlUrlResolver() };
    }
}
```

### <a name="solution-6"></a><span data-ttu-id="dd088-150">Rozwiązanie 6</span><span class="sxs-lookup"><span data-stu-id="dd088-150">Solution 6</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    class TestClass
    {
        public XmlDocument doc = new XmlDocument() { XmlResolver = null }; // or set to a XmlSecureResolver instance
    }
}
```

### <a name="violation-7"></a><span data-ttu-id="dd088-151">Naruszenie 7</span><span class="sxs-lookup"><span data-stu-id="dd088-151">Violation 7</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    class TestClass
    {
        private static void TestMethod()
        {
            var reader = XmlTextReader.Create(""doc.xml""); //warn
        }
    }
}
```

```csharp
using System.Xml;

namespace TestNamespace
{
    public class TestClass
    {
        public void TestMethod(string path)
        {
            try {
                XmlTextReader reader = new XmlTextReader(path); // warn
            }
            catch { throw ; }
            finally {}
        }
    }
}
```

### <a name="solution-7"></a><span data-ttu-id="dd088-152">Rozwiązanie 7</span><span class="sxs-lookup"><span data-stu-id="dd088-152">Solution 7</span></span>

```csharp
using System.Xml;

namespace TestNamespace
{
    public class TestClass
    {
        public void TestMethod(string path)
        {
            XmlReaderSettings settings = new XmlReaderSettings() { XmlResolver = null };
            XmlReader reader = XmlReader.Create(path, settings);
        }
    }
}
```

> [!NOTE]
> <span data-ttu-id="dd088-153">Chociaż <xref:System.Xml.XmlReader.Create%2A?displayProperty=nameWithType> jest to zalecany sposób tworzenia <xref:System.Xml.XmlReader> wystąpienia, istnieją różnice między zachowaniem programu <xref:System.Xml.XmlTextReader> .</span><span class="sxs-lookup"><span data-stu-id="dd088-153">Although <xref:System.Xml.XmlReader.Create%2A?displayProperty=nameWithType> is the recommended way to create an <xref:System.Xml.XmlReader> instance, there are behavior differences from <xref:System.Xml.XmlTextReader>.</span></span> <span data-ttu-id="dd088-154"><xref:System.Xml.XmlReader>Od <xref:System.Xml.XmlReader.Create%2A> normalizowania `\r\n` do `\n` wartości XML, podczas gdy <xref:System.Xml.XmlTextReader> zachowuje `\r\n` sekwencję.</span><span class="sxs-lookup"><span data-stu-id="dd088-154">An <xref:System.Xml.XmlReader> from <xref:System.Xml.XmlReader.Create%2A> normalizes `\r\n` to `\n` in XML values, while <xref:System.Xml.XmlTextReader> preserves the `\r\n` sequence.</span></span>
