---
title: 'CA5381: Upewnij się, że certyfikaty nie są dodawane do magazynu głównego (analiza kodu)'
description: Zawiera informacje o regule analizy kodu CA5381, w tym o przyczynach, sposobach rozwiązywania naruszeń oraz o tym, kiedy należy je pominąć.
ms.date: 08/14/2019
ms.topic: reference
author: filipsebesta
ms.author: filipse
dev_langs:
- CSharp
f1_keywords:
- CA5381
- DoNotInstallRootCert
ms.openlocfilehash: 3840e8e56e066212403fa1cd2b2ab59e0e52fe43
ms.sourcegitcommit: 2e4adc490c1d2a705a0592b295d606b10b9f51f1
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 09/25/2020
ms.locfileid: "96589284"
---
# <a name="ca5381-ensure-certificates-are-not-added-to-root-store"></a>CA5381: Upewnij się, że certyfikaty nie są dodawane do magazynu głównego

| | Wartość |
|-|-|
| **Identyfikator zasady** |CA5381|
| **Kategoria** |Microsoft.Security|
| **Naprawa jest przerywana lub nieprzerwana** |Nieprzerwanie|

## <a name="cause"></a>Przyczyna

Dodanie certyfikatów do zaufanych certyfikatów głównych systemu operacyjnego zwiększa ryzyko legitimizing niezaufanego urzędu certyfikacji.

Domyślnie ta reguła analizuje całą bazę kodu, ale [można to skonfigurować](#configurability).

## <a name="rule-description"></a>Opis reguły

Ta reguła wykrywa kod, który potencjalnie dodaje certyfikat do magazynu certyfikatów zaufanych głównych urzędów certyfikacji. Domyślnie magazyn certyfikatów zaufanych głównych urzędów certyfikacji jest skonfigurowany przy użyciu zestawu publicznych urzędów certyfikacji (CA), które spełniają wymagania programu certyfikatów głównych firmy Microsoft. Ponieważ wszystkie Zaufane główne urzędy certyfikacji mogą wystawiać certyfikaty dla dowolnej domeny, osoba atakująca może wybrać słaby lub Day urząd certyfikacji, który jest instalowany przez siebie do celów ataku, i jeden narażony, złośliwy lub da urząd certyfikacji podważa bezpieczeństwo całego systemu.

## <a name="how-to-fix-violations"></a>Jak naprawić naruszenia

Nie instaluj certyfikatów w magazynie certyfikatów zaufanych głównych urzędów certyfikacji.

## <a name="when-to-suppress-warnings"></a>Kiedy pominąć ostrzeżenia

Nie zaleca się pomijania tej reguły.

## <a name="configurability"></a>Określając

Ta reguła ma następujące konfigurowalne opcje.

### <a name="excluded-symbol-names"></a>Wykluczone nazwy symboli

Można skonfigurować, które części bazy kodu mają być wykluczone z analizy. Na przykład aby określić, że reguła nie powinna być uruchamiana na żadnym kodzie w typach o nazwie `MyType` , Dodaj następującą parę klucz-wartość do pliku *editorconfig* w projekcie:

```ini
dotnet_code_quality.CA5381.excluded_symbol_names = MyType
```

Dozwolone formaty nazw symboli w wartości opcji (oddzielone przez `|` ):

- Tylko nazwa symbolu (zawiera wszystkie symbole z nazwą, niezależnie od typu zawierającego lub przestrzeni nazw)
- W pełni kwalifikowane nazwy w [formacie identyfikatora dokumentacji](https://github.com/dotnet/csharplang/blob/master/spec/documentation-comments.md#id-string-format)symbolu. Każda nazwa symbolu wymaga prefiksu rodzaju symboli, takiego jak "M:" prefix dla metod, `T:` prefix dla typów, "N:" prefiks dla przestrzeni nazw itd.
- `.ctor` dla konstruktorów i `.cctor` dla konstruktorów statycznych

Przykłady:

| Wartość opcji | Podsumowanie |
| --- | --- |
|`dotnet_code_quality.CA5381.excluded_symbol_names = MyType` | Dopasowuje wszystkie symbole o nazwie "MyType" w kompilacji
|`dotnet_code_quality.CA5381.excluded_symbol_names = MyType1|MyType2` | Dopasowuje wszystkie symbole o nazwie "MyType1" lub "MyType2" w kompilacji
|`dotnet_code_quality.CA5381.excluded_symbol_names = M:NS.MyType.MyMethod(ParamType)` | Dopasowuje określoną metodę "nomethod" przy użyciu podanego w pełni kwalifikowanego podpisu
|`dotnet_code_quality.CA5381.excluded_symbol_names = M:NS1.MyType1.MyMethod1(ParamType)|M:NS2.MyType2.MyMethod2(ParamType)` | Dopasowuje określone metody "MyMethod1" i "MyMethod2" z odpowiednimi w pełni kwalifikowanymi sygnaturami

Wszystkie te opcje można skonfigurować dla opcji tylko dla tej reguły, dla wszystkich reguł lub dla wszystkich reguł w tej kategorii (Security). Aby uzyskać więcej informacji, zobacz [Opcje konfiguracji reguł jakości kodu](../code-quality-rule-options.md).

## <a name="pseudo-code-examples"></a>Przykłady pseudo kodu

### <a name="violation"></a>Krocz

Poniższy pseudo kodu ilustruje wzorzec wykryty przez tę regułę.

```csharp
using System;
using System.Security.Cryptography.X509Certificates;

class TestClass
{
    public void TestMethod()
    {
        var storeName = StoreName.Root;
        Random r = new Random();

        if (r.Next(6) == 4)
        {
            storeName = StoreName.My;
        }

        var x509Store = new X509Store(storeName);
        x509Store.Add(new X509Certificate2());
    }
}
```

### <a name="solution"></a>Rozwiązanie

```csharp
using System.Security.Cryptography.X509Certificates;

class TestClass
{
    public void TestMethod()
    {
        var storeName = StoreName.My;
        var x509Store = new X509Store(storeName);
        x509Store.Add(new X509Certificate2());
    }
}
```
