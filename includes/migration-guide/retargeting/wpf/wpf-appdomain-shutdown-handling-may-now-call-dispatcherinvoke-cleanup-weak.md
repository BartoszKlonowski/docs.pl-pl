---
ms.openlocfilehash: 8b804d23247b95381f3ff83bc12c32215a420fb6
ms.sourcegitcommit: e02d17b2cf9c1258dadda4810a5e6072a0089aee
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 07/01/2020
ms.locfileid: "85614959"
---
### <a name="wpf-appdomain-shutdown-handling-may-now-call-dispatcherinvoke-in-cleanup-of-weak-events"></a><span data-ttu-id="2d65e-101">Obsługa zamykania aplikacji WPF może teraz wywołać dyspozytora. Wywołaj w trakcie oczyszczania słabych zdarzeń</span><span class="sxs-lookup"><span data-stu-id="2d65e-101">WPF AppDomain Shutdown Handling May Now Call Dispatcher.Invoke in Cleanup of Weak Events</span></span>

#### <a name="details"></a><span data-ttu-id="2d65e-102">Szczegóły</span><span class="sxs-lookup"><span data-stu-id="2d65e-102">Details</span></span>

<span data-ttu-id="2d65e-103">W .NET Framework 4.7.1 i starszych wersjach program WPF może utworzyć <xref:System.Windows.Threading.Dispatcher?displayProperty=nameWithType> na wątku platformy .NET finalizator podczas zamykania elementu AppDomain.</span><span class="sxs-lookup"><span data-stu-id="2d65e-103">In .NET Framework 4.7.1 and earlier versions, WPF potentially creates a <xref:System.Windows.Threading.Dispatcher?displayProperty=nameWithType> on the .NET finalizer thread during AppDomain shutdown.</span></span>  <span data-ttu-id="2d65e-104">Zostało to rozwiązane w .NET Framework 4.7.2 i nowszych wersjach, co sprawia, że jest to oczyszczanie słabych zdarzeń z obsługą wątków.</span><span class="sxs-lookup"><span data-stu-id="2d65e-104">This was fixed in .NET Framework 4.7.2 and later versions by making the cleanup of weak events thread-aware.</span></span>  <span data-ttu-id="2d65e-105">Z tego powodu, WPF może wywołać, <xref:System.Windows.Threading.Dispatcher.Invoke%2A?displayProperty=nameWithType> Aby ukończyć proces oczyszczania. W niektórych aplikacjach ta zmiana w czasie wykonywania może potencjalnie spowodować wyjątki podczas zamykania elementu AppDomain lub procesu.</span><span class="sxs-lookup"><span data-stu-id="2d65e-105">Due to this, WPF may call <xref:System.Windows.Threading.Dispatcher.Invoke%2A?displayProperty=nameWithType> to complete the cleanup process.In certain applications, this change in finalizer timing can potentially cause exceptions during AppDomain or process shutdown.</span></span>  <span data-ttu-id="2d65e-106">Jest to zwykle widoczne w aplikacjach, które nie zamykają prawidłowo odniesień działających w wątkach roboczych przed przetworzeniem lub zamknięciem elementu AppDomain.</span><span class="sxs-lookup"><span data-stu-id="2d65e-106">This is generally seen in applications that do not correctly shut down dispatchers running on worker threads prior to process or AppDomain shutdown.</span></span>  <span data-ttu-id="2d65e-107">Takie aplikacje powinny mieć na celu prawidłowe zarządzanie okresem istnienia dyspozytorów.</span><span class="sxs-lookup"><span data-stu-id="2d65e-107">Such applications should take care to properly manage the lifetime of dispatchers.</span></span>

#### <a name="suggestion"></a><span data-ttu-id="2d65e-108">Sugestia</span><span class="sxs-lookup"><span data-stu-id="2d65e-108">Suggestion</span></span>

<span data-ttu-id="2d65e-109">W .NET Framework 4.7.2 i nowszych wersjach deweloperzy mogą wyłączyć tę poprawkę, aby pomóc wyeliminować problemy związane z chronometrażem, które mogą wystąpić w wyniku zmiany. Aby wyłączyć zmianę w oczyszczaniu, użyj następującej flagi AppContext.</span><span class="sxs-lookup"><span data-stu-id="2d65e-109">In .NET Framework 4.7.2 and later versions, developers can disable this fix in order to help alleviate (but not eliminate) timing issues that may occur due to the cleanup change.To disable the change in cleanup, use the following AppContext flag.</span></span><pre><code class="lang-xml">&lt;configuration&gt;&#13;&#10;&lt;runtime&gt;&#13;&#10;&lt;AppContextSwitchOverrides value=&quot;Switch.MS.Internal.DoNotInvokeInWeakEventTableShutdownListener=true&quot;/&gt;&#13;&#10;&lt;/runtime&gt;&#13;&#10;&lt;/configuration&gt;&#13;&#10;</code></pre>

| <span data-ttu-id="2d65e-110">Nazwa</span><span class="sxs-lookup"><span data-stu-id="2d65e-110">Name</span></span>    | <span data-ttu-id="2d65e-111">Wartość</span><span class="sxs-lookup"><span data-stu-id="2d65e-111">Value</span></span>       |
|:--------|:------------|
| <span data-ttu-id="2d65e-112">Zakres</span><span class="sxs-lookup"><span data-stu-id="2d65e-112">Scope</span></span>   | <span data-ttu-id="2d65e-113">Brzeg</span><span class="sxs-lookup"><span data-stu-id="2d65e-113">Edge</span></span>        |
| <span data-ttu-id="2d65e-114">Wersja</span><span class="sxs-lookup"><span data-stu-id="2d65e-114">Version</span></span> | <span data-ttu-id="2d65e-115">4.7.2</span><span class="sxs-lookup"><span data-stu-id="2d65e-115">4.7.2</span></span>       |
| <span data-ttu-id="2d65e-116">Typ</span><span class="sxs-lookup"><span data-stu-id="2d65e-116">Type</span></span>    | <span data-ttu-id="2d65e-117">Przekierowanie</span><span class="sxs-lookup"><span data-stu-id="2d65e-117">Retargeting</span></span> |
