---
ms.openlocfilehash: ab9431780422dfece5dcf8007d13e6d584f5118f
ms.sourcegitcommit: 721c3e4bdbb1ea0bb420818ec944c538fe5c513a
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 12/01/2020
ms.locfileid: "96478388"
---
### <a name="avoiding-endless-recursion-for-iworkflowinstancemanagementtransactedcancel-and-iworkflowinstancemanagementtransactedterminate"></a><span data-ttu-id="c9b45-101">Unikanie rekursji nieskończoności dla IWorkflowInstanceManagement. TransactedCancel i IWorkflowInstanceManagement. TransactedTerminate</span><span class="sxs-lookup"><span data-stu-id="c9b45-101">Avoiding endless recursion for IWorkflowInstanceManagement.TransactedCancel and IWorkflowInstanceManagement.TransactedTerminate</span></span>

#### <a name="details"></a><span data-ttu-id="c9b45-102">Szczegóły</span><span class="sxs-lookup"><span data-stu-id="c9b45-102">Details</span></span>

<span data-ttu-id="c9b45-103">W pewnych okolicznościach przy użyciu programu <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> lub <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> interfejsów API do anulowania lub kończenia wystąpienia usługi przepływu pracy wystąpienie przepływu pracy może napotkać przepełnienie stosu z powodu nieskończonej rekursji, gdy `Workflow` środowisko uruchomieniowe próbuje utrzymać wystąpienie usługi w ramach przetwarzania żądania.</span><span class="sxs-lookup"><span data-stu-id="c9b45-103">Under some circumstances when using <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> APIs to cancel or terminate a workflow service instance, the workflow instance may encounter a stack overflow due to endless recursion when the `Workflow` runtime attempts to persist the service instance as part of processing the request.</span></span> <span data-ttu-id="c9b45-104">Ten problem występuje, gdy wystąpienie przepływu pracy jest w stanie, w którym oczekuje na ukończenie innego oczekującego żądania WCF do innej usługi.</span><span class="sxs-lookup"><span data-stu-id="c9b45-104">The problem occurs if the workflow instance is in a state where it is waiting for some other outstanding WCF request to another service to complete.</span></span> <span data-ttu-id="c9b45-105">`TransactedCancel`Operacje i `TransactedTerminate` tworzą elementy robocze, które są umieszczane w kolejce dla wystąpienia usługi przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="c9b45-105">The `TransactedCancel` and `TransactedTerminate` operations create work items that are queued for the workflow service instance.</span></span> <span data-ttu-id="c9b45-106">Te elementy robocze nie są wykonywane w ramach przetwarzania `TransactedCancel/TransactedTerminate` żądania.</span><span class="sxs-lookup"><span data-stu-id="c9b45-106">These work items are not executed as part of the processing of the `TransactedCancel/TransactedTerminate` request.</span></span> <span data-ttu-id="c9b45-107">Ponieważ wystąpienie usługi przepływu pracy jest zajęte, czekając na zakończenie innych oczekujących żądań WCF, element roboczy został utworzony w kolejce.</span><span class="sxs-lookup"><span data-stu-id="c9b45-107">Because the workflow service instance is busy waiting for the other outstanding WCF request to complete, the work item created remains queued.</span></span> <span data-ttu-id="c9b45-108">`TransactedCancel/TransactedTerminate`Operacja zostanie ukończona i kontrola zostanie zwrócona z powrotem do klienta.</span><span class="sxs-lookup"><span data-stu-id="c9b45-108">The `TransactedCancel/TransactedTerminate` operation completes and control is returned back to the client.</span></span> <span data-ttu-id="c9b45-109">Gdy transakcja skojarzona z operacją zostanie podjęta `TransactedCancel/TransactedTerminate` , musi zachować stan wystąpienia usługi przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="c9b45-109">When the transaction associated with the `TransactedCancel/TransactedTerminate` operation attempts to commit, it needs to persist the workflow service instance state.</span></span> <span data-ttu-id="c9b45-110">Ale ponieważ istnieje oczekujące `WCF` żądanie wystąpienia, środowisko uruchomieniowe przepływu pracy nie może utrwalać wystąpienia usługi przepływu pracy, a pętla rekursji nieskończonej prowadzi do przepełnienia stosu. Ponieważ `TransactedCancel` i `TransactedTerminate` Utwórz tylko element roboczy w pamięci, fakt, że transakcja istnieje, nie ma żadnego efektu.</span><span class="sxs-lookup"><span data-stu-id="c9b45-110">But because there is an outstanding `WCF` request for the instance, the Workflow runtime cannot persist the workflow service instance, and an endless recursion loop leads to the stack overflow.Because `TransactedCancel` and `TransactedTerminate` only create a work item in memory, the fact that a transaction exists doesn't have any effect.</span></span> <span data-ttu-id="c9b45-111">Wycofanie transakcji nie odrzuci elementu pracy. Aby rozwiązać ten problem, w .NET Framework 4.7.2 został wprowadzony, `AppSetting` który można dodać do `web.config/app.config` usługi przepływu pracy, która informuje go o ignorowaniu transakcji dla `TransactedCancel` i `TransactedTerminate` .</span><span class="sxs-lookup"><span data-stu-id="c9b45-111">A rollback of the transaction does not discard the work item.To address this issue, starting in .NET Framework 4.7.2, we have introduced an `AppSetting` that can be added to the `web.config/app.config` of the workflow service that tells it to ignore transactions for `TransactedCancel` and `TransactedTerminate`.</span></span> <span data-ttu-id="c9b45-112">Pozwala to na zatwierdzenie transakcji bez oczekiwania na utrwalenie wystąpienia przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="c9b45-112">This allows the transaction to commit without waiting for the workflow instance to persist.</span></span> <span data-ttu-id="c9b45-113">Element appSetting dla tej funkcji ma nazwę `microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate` .</span><span class="sxs-lookup"><span data-stu-id="c9b45-113">The AppSetting for this feature is named `microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate`.</span></span> <span data-ttu-id="c9b45-114">Wartość wskazuje, `true` że transakcja powinna być ignorowana, co pozwala uniknąć przepełnienia stosu.</span><span class="sxs-lookup"><span data-stu-id="c9b45-114">A value of `true` indicates that the transaction should be ignored, thus avoiding the stack overflow.</span></span> <span data-ttu-id="c9b45-115">Wartość domyślna tego element appSetting to `false` , więc nie ma to żadnego oddziaływać na istniejące wystąpienia usługi przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="c9b45-115">The default value of this AppSetting is `false`, so existing workflow service instances are not affected.</span></span>

#### <a name="suggestion"></a><span data-ttu-id="c9b45-116">Sugestia</span><span class="sxs-lookup"><span data-stu-id="c9b45-116">Suggestion</span></span>

<span data-ttu-id="c9b45-117">Jeśli używasz programu AppFabric lub innego <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> klienta i napotkasz przepełnienie stosu w wystąpieniu usługi przepływu pracy podczas próby anulowania lub zakończenia wystąpienia przepływu pracy, możesz dodać następujące elementy do `<appSettings>` sekcji pliku web.config/app.config dla usługi przepływu pracy:</span><span class="sxs-lookup"><span data-stu-id="c9b45-117">If you are using AppFabric or another <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> client and are encountering a stack overflow in the workflow service instance when trying to cancel or terminate a workflow instance, you can add the following to the `<appSettings>` section of the web.config/app.config file for the workflow service:</span></span>

<pre><code class="lang-xml">&lt;add key=&quot;microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate&quot; value=&quot;true&quot;/&gt;&#13;&#10;</code></pre>

<span data-ttu-id="c9b45-118">Jeśli problem nie wystąpi, nie musisz tego robić.</span><span class="sxs-lookup"><span data-stu-id="c9b45-118">If you are not encountering the problem, you do not need to do this.</span></span>

| <span data-ttu-id="c9b45-119">Nazwa</span><span class="sxs-lookup"><span data-stu-id="c9b45-119">Name</span></span>    | <span data-ttu-id="c9b45-120">Wartość</span><span class="sxs-lookup"><span data-stu-id="c9b45-120">Value</span></span>       |
|:--------|:------------|
| <span data-ttu-id="c9b45-121">Zakres</span><span class="sxs-lookup"><span data-stu-id="c9b45-121">Scope</span></span>   | <span data-ttu-id="c9b45-122">Edge</span><span class="sxs-lookup"><span data-stu-id="c9b45-122">Edge</span></span>        |
| <span data-ttu-id="c9b45-123">Wersja</span><span class="sxs-lookup"><span data-stu-id="c9b45-123">Version</span></span> | <span data-ttu-id="c9b45-124">4.7.2</span><span class="sxs-lookup"><span data-stu-id="c9b45-124">4.7.2</span></span>       |
| <span data-ttu-id="c9b45-125">Typ</span><span class="sxs-lookup"><span data-stu-id="c9b45-125">Type</span></span>    | <span data-ttu-id="c9b45-126">Przekierowanie</span><span class="sxs-lookup"><span data-stu-id="c9b45-126">Retargeting</span></span> |
