### <a name="avoiding-endless-recursion-for-iworkflowinstancemanagementtransactedcancel-and-iworkflowinstancemanagementtransactedterminate"></a><span data-ttu-id="8dc91-101">Unikanie nieskończoną rekursję IWorkflowInstanceManagement.TransactedCancel i IWorkflowInstanceManagement.TransactedTerminate</span><span class="sxs-lookup"><span data-stu-id="8dc91-101">Avoiding endless recursion for IWorkflowInstanceManagement.TransactedCancel and IWorkflowInstanceManagement.TransactedTerminate</span></span>

|   |   |
|---|---|
|<span data-ttu-id="8dc91-102">Szczegóły</span><span class="sxs-lookup"><span data-stu-id="8dc91-102">Details</span></span>|<span data-ttu-id="8dc91-103">W pewnych okolicznościach, w przypadku korzystania z <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> lub <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> interfejsy API w celu anulowania lub zakończenia przepływu pracy usługi wystąpienie, wystąpienie przepływu pracy, może wystąpić przepełnienie stosu, z powodu nieskończonej rekursji podczas <code>Workflow</code> runtime próbuje zachować wystąpienie usługi w ramach przetwarzania żądania.</span><span class="sxs-lookup"><span data-stu-id="8dc91-103">Under some circumstances when using <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> APIs to cancel or terminate a worklow service instance, the workflow instance may encounter a stack overflow due to endless recursion when the <code>Workflow</code> runtime attempts to persist the service instance as part of processing the request.</span></span> <span data-ttu-id="8dc91-104">Ten problem występuje, jeśli wystąpienie przepływu pracy jest w stanie, w której oczekuje na niektórych innych oczekujące WCF żądanie do innej usługi zakończyć. <code>TransactedCancel</code> i <code>TransactedTerminate</code> operacje tworzenia elementów roboczych, które są umieszczane w kolejce dla wystąpienia usługi przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="8dc91-104">The problem occurs if the workflow instance is in a state where it is waiting for some other outstanding WCF request to another service to complete.The <code>TransactedCancel</code> and <code>TransactedTerminate</code> operations create work items that are queued for the workflow service instance.</span></span> <span data-ttu-id="8dc91-105">Pracy, te elementy nie są wykonywane w ramach przetwarzania <code>TransactedCancel/TransactedTerminate</code> żądania.</span><span class="sxs-lookup"><span data-stu-id="8dc91-105">These work items are not executed as part of the processing of the <code>TransactedCancel/TransactedTerminate</code> request.</span></span> <span data-ttu-id="8dc91-106">Ponieważ wystąpienia usługi przepływu pracy jest zajęty, oczekiwanie na inne oczekujące żądanie WCF zakończyć, pracy utworzony element pozostaje w kolejce.</span><span class="sxs-lookup"><span data-stu-id="8dc91-106">Because the workflow service instance is busy waiting for the other outstanding WCF request to complete, the work item created remains queued.</span></span> <span data-ttu-id="8dc91-107"><code>TransactedCancel/TransactedTerminate</code> Kończy działanie i kontrolka jest zwracana do klienta.</span><span class="sxs-lookup"><span data-stu-id="8dc91-107">The <code>TransactedCancel/TransactedTerminate</code> operation completes and control is returned back to the client.</span></span> <span data-ttu-id="8dc91-108">Gdy transakcja jest skojarzony z <code>TransactedCancel/TransactedTerminate</code> operacji próbuje zatwierdzić, musi ona utrwalanie stanu wystąpienia przepływu pracy usługi.</span><span class="sxs-lookup"><span data-stu-id="8dc91-108">When the transaction associated with the <code>TransactedCancel/TransactedTerminate</code> operation attempts to commit, it needs to persist the workflow serivce instance state.</span></span> <span data-ttu-id="8dc91-109">Ale ponieważ istnieje oczekujące <code>WCF</code> żądania dla tego wystąpienia środowiska wykonawczego przepływów pracy nie można utrwalić wystąpienia usługi przepływu pracy i pętlę nieskończoną rekursję prowadzą do przepełnienia stosu. Ponieważ <code>TransactedCancel</code> i <code>TransactedTerminate</code> tylko utworzyć element roboczy w pamięci, fakt, że istnieje transakcja nie ma żadnego skutku.</span><span class="sxs-lookup"><span data-stu-id="8dc91-109">But because there is an outstanding <code>WCF</code> request for the instance, the Workflow runtime cannot persist the workflow service instance, and an endless recursion loop leads to the stack overflow.Because <code>TransactedCancel</code> and <code>TransactedTerminate</code> only create a work item in memory, the fact that a transaction exists doesn't have any effect.</span></span> <span data-ttu-id="8dc91-110">Wycofywanie transakcji nie odrzuca elementu roboczego. Aby rozwiązać ten problem, począwszy od .NET Framework 4.7.2, firma Microsoft wprowadza <code>AppSetting</code> mogą być dodawane do <code>web.config/app.config</code> usługi przepływu pracy, która informuje, aby zignorować transakcji dla <code>TransactedCancel</code> i <code>TransactedTerminate</code>.</span><span class="sxs-lookup"><span data-stu-id="8dc91-110">A rollback of the transaction does not discard the work item.To address this issue, starting in .NET Framework 4.7.2, we have introduced an <code>AppSetting</code> that can be added to the <code>web.config/app.config</code> of the workflow service that tells it to ignore transactions for <code>TransactedCancel</code> and <code>TransactedTerminate</code>.</span></span> <span data-ttu-id="8dc91-111">Dzięki temu zatwierdzenie bez oczekiwania na wystąpienie przepływu pracy utrwalić transakcji. Ustawienie dla tej funkcji ma nazwę <code>microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate</code>.</span><span class="sxs-lookup"><span data-stu-id="8dc91-111">This allows the transaction to commit without waiting for the workflow instance to persist.The AppSetting for this feature is named <code>microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate</code>.</span></span> <span data-ttu-id="8dc91-112">Wartość <code>true</code> wskazuje, że transakcja mają być ignorowane, unikając w ten sposób witryna stack overflow.</span><span class="sxs-lookup"><span data-stu-id="8dc91-112">A value of <code>true</code> indicates that the transaction should be ignored, thus avoiding the stack overflow.</span></span> <span data-ttu-id="8dc91-113">Wartość domyślna to ustawienie jest <code>false</code>, więc nie wpływają na istniejących wystąpień usługi przepływu pracy.</span><span class="sxs-lookup"><span data-stu-id="8dc91-113">The default value of this AppSetting is <code>false</code>, so existing workflow service instances are not affected.</span></span>|
|<span data-ttu-id="8dc91-114">Sugestia</span><span class="sxs-lookup"><span data-stu-id="8dc91-114">Suggestion</span></span>|<span data-ttu-id="8dc91-115">Jeśli używasz rozwiązania AppFabric lub innym <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> klienta i czy wystąpią przepełnienia stosu w wystąpieniu usługi przepływu pracy, podczas próby anulowania lub zakończenia wystąpienia przepływu pracy, można dodać następujące polecenie, aby <code>&lt;appSettings&gt;</code> sekcji web.config/ Plik App.config dla usługi przepływu pracy:</span><span class="sxs-lookup"><span data-stu-id="8dc91-115">If you are using AppFabric or another <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> client and are encountering a stack overflow in the workflow serivce instance when trying to cancel or terminate a workflow instance, you can add the following to the <code>&lt;appSettings&gt;</code> section of the web.config/app.config file for the workflow service:</span></span><pre><code class="lang-xml">&lt;add key=&quot;microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate&quot; value=&quot;true&quot;/&gt;&#13;&#10;</code></pre><span data-ttu-id="8dc91-116">Jeśli nie napotkasz ten problem, nie musisz to zrobić.</span><span class="sxs-lookup"><span data-stu-id="8dc91-116">If you are not encountering the problem, you do not need to do this.</span></span>|
|<span data-ttu-id="8dc91-117">Zakres</span><span class="sxs-lookup"><span data-stu-id="8dc91-117">Scope</span></span>|<span data-ttu-id="8dc91-118">Krawędź</span><span class="sxs-lookup"><span data-stu-id="8dc91-118">Edge</span></span>|
|<span data-ttu-id="8dc91-119">Wersja</span><span class="sxs-lookup"><span data-stu-id="8dc91-119">Version</span></span>|<span data-ttu-id="8dc91-120">4.7.2</span><span class="sxs-lookup"><span data-stu-id="8dc91-120">4.7.2</span></span>|
|<span data-ttu-id="8dc91-121">Typ</span><span class="sxs-lookup"><span data-stu-id="8dc91-121">Type</span></span>|<span data-ttu-id="8dc91-122">Trwa przekierowywanie</span><span class="sxs-lookup"><span data-stu-id="8dc91-122">Retargeting</span></span>|

